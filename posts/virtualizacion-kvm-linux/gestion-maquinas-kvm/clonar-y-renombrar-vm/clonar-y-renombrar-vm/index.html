<!doctype html><html lang=es><head><title>Clonar y renombrar máquinas virtuales en KVM</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ddf4c4775d35e5bc3dd64c797b179f99eaf85cf9811e64bd08f8c44a68d0b229.css integrity="sha256-3fTEd1015bw91kx5exefmer4XPmBHmS9CPjESmjQsik="><link rel=icon type=image/png href=/images/site/avatar_hu_f10227dc088ad43a.jpg><meta property="og:title" content="Atlas"><meta property="og:type" content="website"><meta property="og:description" content="Portafolio y blog personal de Francisco Javier Cruces Doval"><meta property="og:image" content="/images/author/john.png"><meta property="og:url" content="https://www.javiercd.es"><meta name=description content="Aprende a clonar y renombrar máquinas virtuales en KVM usando virt-clone, virt-sysprep y virt-customize para crear plantillas reutilizables."><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/><img src=/images/site/masthead_hu_f10227dc088ad43a.png id=logo alt=Logo>
Atlas</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/#home>Inicio</a></li><li class=nav-item><a class=nav-link href=/#about>Sobre mi</a></li><li class=nav-item><a class=nav-link href=/#skills>Competencias</a></li><li class=nav-item><a class=nav-link href=/#education>Educación</a></li><li class=nav-item><a class=nav-link href=/#recent-posts>Últimas publicaciones</a></li><li class=nav-item><a class=nav-link href=/#accomplishments>Certificaciones</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-es"></span>
Español</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/clonar-y-renombrar-vm><span class="fi fi-es"></span>
Español
</a><a class="dropdown-item nav-link languages-item" href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/clonar-y-renombrar-vm><span class="fi fi-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Búsqueda data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/posts/iaw/> Aplicaciones webs</a><ul><li><a class=list-link href=/posts/iaw/lamp/ title="Instalación pila LAMP">Instalación pila LAMP</a></li><li><a class=list-link href=/posts/iaw/lemp/ title="Instalación pila LEMP">Instalación pila LEMP</a></li><li><a class=list-link href=/posts/iaw/wordpress/ title="Wordpress LAMP">Wordpress LAMP</a></li><li><a class=list-link href=/posts/iaw/wordpress_lemp/ title="Wordpress LEMP">Wordpress LEMP</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/base_de_datos/> Base de datos</a><ul><li><a class=list-link href=/posts/base_de_datos/acceso_remoto_mariadb/ title="Acceso remoto en MariaDB">Acceso remoto en MariaDB</a></li><li><a class=list-link href=/posts/base_de_datos/oracle_acceso_remoto/ title="Configuración de acceso remoto en Oracle">Configuración de acceso remoto en Oracle</a></li><li><a class=list-link href=/posts/base_de_datos/instalacion_oracle_19c_debian12/ title="Instalación de Oracle 19c bajo Debian 12">Instalación de Oracle 19c bajo Debian 12</a></li><li><a class=list-link href=/posts/base_de_datos/instalar_postgresql/ title="Instalación de PostgreSQL en Debian 12">Instalación de PostgreSQL en Debian 12</a></li><li><a class=list-link href=/posts/base_de_datos/instalar_mariadb/ title="Instalar MariaDB en Debian">Instalar MariaDB en Debian</a></li><li><a class=list-link href=/posts/base_de_datos/interconexion_de_servidores/ title="Interconexión de servidores de bases de datos">Interconexión de servidores de bases de datos</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/ci_cd/> CI/CD Jenkins</a><ul><li><a class=list-link href=/posts/ci_cd/practica_jenkins/ title="Práctica CI/CD con Jenkins">Práctica CI/CD con Jenkins</a></li><li><a class=list-link href=/posts/ci_cd/taller1_jenkins/ title="Taller 1 Corrector ortográfico de documentos markdown (test)">Taller 1 Corrector ortográfico de documentos markdown (test)</a></li><li><a class=list-link href=/posts/ci_cd/taller2_jenkins/ title="Taller 2 Comprobación de HTML5 válido y despliegue en surge.sh (test y deploy)">Taller 2 Comprobación de HTML5 válido y despliegue en surge.sh (test y deploy)</a></li><li><a class=list-link href=/posts/ci_cd/taller3_jenkins/ title="Taller 3 Integración continua de aplicación django (Test)">Taller 3 Integración continua de aplicación django (Test)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/cortafuegos/> Cortafuegos</a><ul><li><a class=list-link href=/posts/cortafuegos/fortinet_cli/ title="Fortinet CLI">Fortinet CLI</a></li><li><a class=list-link href=/posts/cortafuegos/fortinet_uno/ title="Perimetral con Fortinet I">Perimetral con Fortinet I</a></li><li><a class=list-link href=/posts/cortafuegos/fortinet_dos/ title="Perimetral con Fortinet II">Perimetral con Fortinet II</a></li><li><a class=list-link href=/posts/cortafuegos/nftables_uno/ title="Perimetral con Nftables I">Perimetral con Nftables I</a></li><li><a class=list-link href=/posts/cortafuegos/nftables_dos/ title="Perimetral con Nftables II">Perimetral con Nftables II</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/docker/> Docker</a><ul><li><a class=list-link href=/posts/docker/instalar_docker_compose/ title="Instalación de Docker Compose en Ubuntu 24">Instalación de Docker Compose en Ubuntu 24</a></li><li><a class=list-link href=/posts/docker/instalar_docker_ubuntu24/ title="Instalación de Docker en Ubuntu 24">Instalación de Docker en Ubuntu 24</a></li><li><a class=list-link href=/posts/docker/taller1/ title="Taller 1 Almacenamiento y redes en Docker">Taller 1 Almacenamiento y redes en Docker</a></li><li><a class=list-link href=/posts/docker/taller2/ title="Taller 2 Escenarios multicontenedor en Docker">Taller 2 Escenarios multicontenedor en Docker</a></li><li><a class=list-link href=/posts/docker/taller3/ title="Taller 3 Creación de imágenes Docker">Taller 3 Creación de imágenes Docker</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/drivers/> Drivers Linux</a><ul><li><a class=list-link href=/posts/drivers/nvidia_optimus/ title="Como elegir que gráfica usar en mi portátil con Linux">Como elegir que gráfica usar en mi portátil con Linux</a></li><li><a class=list-link href=/posts/drivers/nvidia_driver/ title="Drivers Nvidia">Drivers Nvidia</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/observabilidad/> Observabilidad</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/observabilidad/metricas/> Métricas</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/observabilidad/metricas/prometheus/> Prometheus</a><ul><li><a class=list-link href=/posts/observabilidad/metricas/prometheus/instalacion_basica_docker_compose/ title="Instalación de Prometheus con docker-compose y Node Exporter en Debian 12">Instalación de Prometheus con docker-compose y Node Exporter en Debian 12</a></li></ul></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/redes/> Redes</a><ul><li><a class=list-link href=/posts/redes/android_gns3/ title="Android GNS3-KVM">Android GNS3-KVM</a></li><li><a class=list-link href=/posts/redes/comandos_de_supervision_de_redes/ title="Comandos de supervisión de redes">Comandos de supervisión de redes</a></li><li><a class=list-link href=/posts/redes/switches_gns3/ title="Configuración de switches en GNS3">Configuración de switches en GNS3</a></li><li><a class=list-link href=/posts/redes/enroutamiento_openstack/ title="Enrutamiento en OpenStack">Enrutamiento en OpenStack</a></li><li><a class=list-link href=/posts/redes/escenario_ipv6_basico/ title="Escenario IPv6 Básico">Escenario IPv6 Básico</a></li><li><a class=list-link href=/posts/redes/instalar_gns3_debian12/ title="Instalacion GNS3 en Debian 12">Instalacion GNS3 en Debian 12</a></li><li><a class=list-link href=/posts/redes/instalacion_wireshark_gns3/ title="Instalacion GNS3 y Wireshark">Instalacion GNS3 y Wireshark</a></li><li><a class=list-link href=/posts/redes/configuracion_de_nat/ title="NAT en Cisco y Linux">NAT en Cisco y Linux</a></li><li><a class=list-link href=/posts/redes/arp/ title="Protocolo ARP">Protocolo ARP</a></li><li><a class=list-link href=/posts/redes/tuneles_ipv6/ title="Túneles IPV6">Túneles IPV6</a></li><li><a class=list-link href=/posts/redes/underworld/ title=Underworld>Underworld</a></li><li><a class=list-link href=/posts/redes/underworld_evolution/ title="Underworld evolution">Underworld evolution</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/seguridad/> Seguridad</a><ul><li><a class=list-link href=/posts/seguridad/https_autofirmado/ title=HTTPS>HTTPS</a></li><li><a class=list-link href=/posts/seguridad/forense/ title="Informática forense">Informática forense</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/servicios/> Servicios</a><ul><li><a class=list-link href=/posts/servicios/apache/ title=Apache>Apache</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/servicios/dhcp/> DHCP</a><ul><li><a class=list-link href=/posts/servicios/dhcp/instalacion_y_configuracion_de_un_servidor_dhcp_en_linux/ title="Instalación y configuración de un servidor DHCP en Linux">Instalación y configuración de un servidor DHCP en Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/servicios/dns/> DNS</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/posts/servicios/dns/bind9/> BIND9</a><ul><li><a class=list-link href=/posts/servicios/dns/bind9/dns_esclavo/ title="Configuring a Slave DNS Server with BIND9">Configuring a Slave DNS Server with BIND9</a></li><li><a class=list-link href=/posts/servicios/dns/bind9/instalacion_basica/ title="Instalación y configuración de BIND9 en Linux">Instalación y configuración de BIND9 en Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/servicios/dns/dnsmasq/> DNSMASQ</a><ul><li><a class=list-link href=/posts/servicios/dns/dnsmasq/instalacion_basica/ title="Servidor local con DNSMasq">Servidor local con DNSMasq</a></li></ul></li></ul></li><li><a class=list-link href=/posts/servicios/ftp/ title=FTP>FTP</a></li><li><a class=list-link href=/posts/servicios/nat_iptables/ title="NAT con iptables">NAT con iptables</a></li><li><a class=list-link href=/posts/servicios/ssh/ title=SSH>SSH</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/sistemas/> Sistemas</a><ul><li><a class=list-link href=/posts/sistemas/ad_ubuntu/ title="Active Directory en Ubuntu">Active Directory en Ubuntu</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/sistemas/comandos_linux/> Comandos en Linux</a><ul><li><a class=list-link href=/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ title="Ejercicios de manejo de módulos">Ejercicios de manejo de módulos</a></li><li><a class=list-link href=/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ title="Ejercicios de modificación de parámetros del kernel">Ejercicios de modificación de parámetros del kernel</a></li><li><a class=list-link href=/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ title="Ejercicios gestión de paquetería">Ejercicios gestión de paquetería</a></li><li><a class=list-link href=/posts/sistemas/comandos_linux/empaquetadores_compresores/ title="Empaquetadores y compresores">Empaquetadores y compresores</a></li><li><a class=list-link href=/posts/sistemas/comandos_linux/gestion_de_paquetes/ title="Gestión de paquetes">Gestión de paquetes</a></li><li><a class=list-link href=/posts/sistemas/comandos_linux/comandos_procesos/ title="Procesos en Linux">Procesos en Linux</a></li><li><a class=list-link href=/posts/sistemas/comandos_linux/programacion_tareas/ title="Programación de tareas">Programación de tareas</a></li></ul></li><li><a class=list-link href=/posts/sistemas/comparticion_de_directorios_en_windows/ title="Compartir recursos en Windows">Compartir recursos en Windows</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/sistemas/compilaciones_linux/> Compilaciones en Linnux</a><ul><li><a class=list-link href=/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/ title="Compilación de un kernel">Compilación de un kernel</a></li><li><a class=list-link href=/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/ title="Compilación de un programa en C utilizando un Makefile">Compilación de un programa en C utilizando un Makefile</a></li></ul></li><li><a class=list-link href=/posts/sistemas/activacion_selinux/ title="Configuración activación de SELinux">Configuración activación de SELinux</a></li><li><a class=list-link href=/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/ title="Creación de un sistema automatizado de instalación">Creación de un sistema automatizado de instalación</a></li><li><a class=list-link href=/posts/sistemas/samba_debian/ title="Instalar y configurar samba en Debian">Instalar y configurar samba en Debian</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/sistemas/migraciones/> Migraciones en Linnux</a><ul><li><a class=list-link href=/posts/sistemas/migraciones/eliminacion_systemd/ title="Eliminación de systemd">Eliminación de systemd</a></li><li><a class=list-link href=/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/ title="Paso de CentOS stream 8 a CentOS stream 9">Paso de CentOS stream 8 a CentOS stream 9</a></li><li><a class=list-link href=/posts/sistemas/migraciones/migracion_sistema_de_ficheros/ title="Sistema de ficheros">Sistema de ficheros</a></li><li><a class=list-link href=/posts/sistemas/migraciones/transformacion_instancia_cloud/ title="Transformación instancia cloud">Transformación instancia cloud</a></li></ul></li><li><a class=list-link href=/posts/sistemas/nfs_debian/ title="NFS en Debian">NFS en Debian</a></li><li><a class=list-link href=/posts/sistemas/recoleccion_logs_journald/ title="Recolección centralizada de logs journald">Recolección centralizada de logs journald</a></li><li><a class=list-link href=/posts/sistemas/ssh_windows/ title="Servicio ssh en Windows">Servicio ssh en Windows</a></li><li><a class=list-link href=/posts/sistemas/almacenamiento_servidor_independiente/ title="Storage Spaces en Windows Server">Storage Spaces en Windows Server</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/virtualizacion-kvm-linux/> Virtualización KVM en Linux</a><ul class=active><li><i data-feather=plus-circle></i><a class=list-link href=/posts/virtualizacion-kvm-linux/introduccion-kvm/> Introducción a la virtualización con KVM</a><ul><li><a class=list-link href=/posts/virtualizacion-kvm-linux/introduccion-kvm/conceptos-virtualizacion/ title="Conceptos de virtualización">Conceptos de virtualización</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/introduccion-kvm/tipo-hipervisores/ title="Tipos de hipervisores">Tipos de hipervisores</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/introduccion-kvm/arquitectura-kvm/ title="Arquitectura de KVM">Arquitectura de KVM</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/virtualizacion-kvm-linux/instalacion-kvm/> Instalación y configuración</a><ul><li><a class=list-link href=/posts/virtualizacion-kvm-linux/instalacion-kvm/instalar-kvm-libvirt/ title="Instalar KVM y libvirt">Instalar KVM y libvirt</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/instalacion-kvm/validar-host-kvm/ title="Validar host KVM">Validar host KVM</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/> Gestión de máquinas virtuales</a><ul class=active><li><a class=list-link href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/crear-vm-virtinstall/ title="Crear VM con virt-install">Crear VM con virt-install</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/componentes-vm/ title="Componentes de una VM">Componentes de una VM</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/administrar-virsh/ title="Administrar con virsh">Administrar con virsh</a></li><li><a class="active list-link" href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/ title="Clonar y renombrar VM">Clonar y renombrar VM</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/ampliar-recursos-vm/ title="Ampliar recursos de una VM">Ampliar recursos de una VM</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/snapshots-kvm/ title="Snapshots en KVM">Snapshots en KVM</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/plantilla-debian13/ title="Plantilla maquinas virtuales">Plantilla maquinas virtuales</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/virtualizacion-kvm-linux/redes-kvm/> Redes en KVM</a><ul><li><a class=list-link href=/posts/virtualizacion-kvm-linux/redes-kvm/tipos-redes-kvm/ title="Tipos de redes">Tipos de redes</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/redes-kvm/crear-redes-virtuales-privadas-kvm/ title="Crear redes privadas">Crear redes privadas</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/redes-kvm/crear-interfaz-puente/ title="Crear redes puente">Crear redes puente</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/virtualizacion-kvm-linux/almacenamiento-kvm/> Almacenamiento en KVM</a><ul><li><a class=list-link href=/posts/virtualizacion-kvm-linux/almacenamiento-kvm/introduccion-almacenamiento-kvm/ title="Introducción al almacenamiento">Introducción al almacenamiento</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/almacenamiento-kvm/gestion-pools-almacenamiento/ title="Gestión de pools">Gestión de pools</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/almacenamiento-kvm/gestion-volumenes-virsh/ title="Gestión de volúmenes (virsh)">Gestión de volúmenes (virsh)</a></li><li><a class=list-link href=/posts/virtualizacion-kvm-linux/almacenamiento-kvm/redimension-discos-vms/ title="Redimensión de discos (VMs)">Redimensión de discos (VMs)</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/posts/vpn/> VPN</a><ul><li><a class=list-link href=/posts/vpn/acceso_remoto_strongswang/ title="Acceso remoto Ipsec StrongSwan">Acceso remoto Ipsec StrongSwan</a></li><li><a class=list-link href=/posts/vpn/acceso_remoto_openvpn/ title="Acceso remoto OpenVPN">Acceso remoto OpenVPN</a></li><li><a class=list-link href=/posts/vpn/acceso_remoto_wireguard/ title="Acceso remoto Wireguard">Acceso remoto Wireguard</a></li><li><a class=list-link href=/posts/vpn/comparativa_ovpn_wire/ title="Comparativa OpenVPN y Wireguard">Comparativa OpenVPN y Wireguard</a></li><li><a class=list-link href=/posts/vpn/ipsec_cisco/ title="Site-to-Site IPsec Cisco">Site-to-Site IPsec Cisco</a></li><li><a class=list-link href=/posts/vpn/site_to_site_fortinet/ title="Site-to-Site IPsec Fortinet">Site-to-Site IPsec Fortinet</a></li><li><a class=list-link href=/posts/vpn/site_to_site_openvpn/ title="Site-to-Site OpenVPN">Site-to-Site OpenVPN</a></li><li><a class=list-link href=/posts/vpn/site_to_site_wireguard/ title="Site-to-Site Wireguard">Site-to-Site Wireguard</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/virtualizacion-kvm-linux/gestion-vm/hacer-clones.png)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu_2aff0fda0501496d.png alt="Author Image"><h5 class=author-name>Francisco Javier Cruces Doval</h5><p class=text-muted>jueves, 16 de octubre de 2025 | 8 minutos</p></div><div class=title><h1>Clonar y renombrar máquinas virtuales en KVM</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/tags/kvm/ class="btn btn-sm btn-info">KVM</a></li><li class=rounded><a href=/tags/virtualizacion/ class="btn btn-sm btn-info">Virtualizacion</a></li><li class=rounded><a href=/tags/libvirt/ class="btn btn-sm btn-info">Libvirt</a></li><li class=rounded><a href=/tags/linux/ class="btn btn-sm btn-info">Linux</a></li><li class=rounded><a href=/tags/vm/ class="btn btn-sm btn-info">VM</a></li><li class=rounded><a href=/tags/clonacion/ class="btn btn-sm btn-info">Clonacion</a></li></ul></div><div class=post-content id=post-content><p>Una de las ventajas de la virtualización es la capacidad de clonar máquinas virtuales para crear entornos homogéneos rápidamente. Sin embargo, cuando clonamos una VM que contiene un sistema operativo, el clon hereda identificadores únicos como el <strong>machine ID</strong>, direcciones <strong>MAC</strong>, claves <strong>SSH</strong> de host, etc., que deberían ser únicos para cada máquina.</p><p>En esta guía veremos cómo:</p><ul><li>Clonar máquinas virtuales con <code>virt-clone</code></li><li>Generalizar clones con <code>virt-sysprep</code></li><li>Personalizar nuevas instancias con <code>virt-customize</code></li><li>Renombrar máquinas virtuales con <code>virsh domrename</code></li><li>Solucionar problemas comunes tras la clonación</li></ul><hr><h2 id=requisitos-previos>Requisitos previos</h2><p>Asegúrate de tener instalados los siguientes paquetes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Debian/Ubuntu</span>
</span></span><span style=display:flex><span>sudo apt install libguestfs-tools virtinst
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># RHEL/Fedora/AlmaLinux</span>
</span></span><span style=display:flex><span>sudo dnf install libguestfs-tools virt-install
</span></span></code></pre></div><p><strong>Paquetes clave:</strong></p><ul><li><code>virt-clone</code>: Herramienta para clonar máquinas virtuales (incluida en <code>virtinst</code>)</li><li><code>virt-sysprep</code>: Herramienta para generalizar VMs (incluida en <code>libguestfs-tools</code>)</li><li><code>virt-customize</code>: Herramienta para personalizar VMs sin arrancarlas (incluida en <code>libguestfs-tools</code>)</li></ul><hr><h2 id=1-preparar-la-máquina-virtual-base>1. Preparar la máquina virtual base</h2><p>Antes de clonar, es recomendable preparar una <strong>máquina de referencia</strong> con toda la configuración base que necesites (paquetes instalados, usuarios, configuración de red básica, etc.).</p><p>En nuestro ejemplo, usaremos una VM llamada <code>debian13</code> como máquina base.</p><h3 id=apagar-la-máquina-virtual>Apagar la máquina virtual</h3><p>Antes de clonarla, debemos apagarla:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh shutdown debian13
</span></span></code></pre></div><p>Verifica que esté completamente apagada:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><p>Salida esperada:</p><pre tabindex=0><code> Id   Name              State
----------------------------------
 -    debian13          shut off
</code></pre><hr><h2 id=2-clonar-la-máquina-virtual-con-virt-clone>2. Clonar la máquina virtual con virt-clone</h2><p><code>virt-clone</code> crea una copia completa de una máquina virtual, incluyendo su configuración XML y sus discos virtuales.</p><h3 id=opción-1-clonación-automática-nombre-de-disco-generado>Opción 1: Clonación automática (nombre de disco generado)</h3><p>Puedes usar <code>--auto-clone</code> para que <code>virt-clone</code> genere automáticamente el nombre del disco añadiendo el sufijo <code>-clone</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian13 --name debian13-clone --auto-clone
</span></span></code></pre></div><p>Salida esperada:</p><pre tabindex=0><code>Allocating &#39;debian13-clone.qcow2&#39;    | 20 GB  00:00:05

Clone &#39;debian13-clone&#39; created successfully.
</code></pre><h3 id=opción-2-especificar-nombre-de-disco-personalizado>Opción 2: Especificar nombre de disco personalizado</h3><p>Para tener más control sobre el nombre del disco, usa el parámetro <code>--file</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian13 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template.qcow2
</span></span></code></pre></div><p>Salida esperada:</p><pre tabindex=0><code>Allocating &#39;debian-template.qcow2&#39;   | 20 GB  00:00:05

Clone &#39;debian-template&#39; created successfully.
</code></pre><h3 id=clonar-múltiples-discos>Clonar múltiples discos</h3><p>Si tu VM tiene varios discos, puedes especificar múltiples parámetros <code>--file</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian13 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template-disk1.qcow2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template-disk2.qcow2
</span></span></code></pre></div><hr><h2 id=3-renombrar-máquinas-virtuales-con-virsh-domrename>3. Renombrar máquinas virtuales con virsh domrename</h2><p>Puedes cambiar el nombre de una VM fácilmente con <code>virsh domrename</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh domrename debian13-clone debian-base-image
</span></span></code></pre></div><p>Salida esperada:</p><pre tabindex=0><code>Domain successfully renamed
</code></pre><p>Verifica el cambio:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><p>Salida:</p><pre tabindex=0><code> Id   Name                State
-----------------------------------
 -    debian13            shut off
 -    debian-base-image   shut off
 -    debian-template     shut off
</code></pre><blockquote><p><strong>Nota:</strong> El comando <code>virsh domrename</code> solo cambia el nombre de la VM en libvirt, <strong>no renombra el archivo de disco</strong>. Si deseas renombrar también el disco, hazlo manualmente y luego edita la configuración XML con <code>virsh edit</code>.</p></blockquote><hr><h2 id=4-generalizar-la-vm-con-virt-sysprep>4. Generalizar la VM con virt-sysprep</h2><p><code>virt-sysprep</code> elimina configuraciones específicas de la máquina para convertirla en una <strong>plantilla reutilizable</strong>. Esta herramienta está inspirada en la utilidad <code>sysprep</code> de Microsoft Windows.</p><h3 id=qué-hace-virt-sysprep>¿Qué hace virt-sysprep?</h3><p><code>virt-sysprep</code> realiza múltiples operaciones de limpieza automáticamente:</p><ul><li>Elimina el <strong>machine-id</strong> y lo regenerará en el próximo arranque</li><li>Borra las <strong>claves SSH de host</strong> (se regeneran automáticamente o manualmente)</li><li>Limpia el <strong>historial de comandos</strong> (bash_history)</li><li>Elimina las <strong>direcciones MAC</strong> fijas</li><li>Borra <strong>logs del sistema</strong></li><li>Limpia la <strong>caché de paquetes</strong></li><li>Elimina <strong>archivos temporales</strong></li><li>Y mucho más&mldr;</li></ul><h3 id=uso-básico-de-virt-sysprep>Uso básico de virt-sysprep</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template
</span></span></code></pre></div><p>Salida (fragmento):</p><pre tabindex=0><code>[   0.0] Examining the guest ...
[   5.2] Performing &#34;abrt-data&#34; ...
[   5.2] Performing &#34;backup-files&#34; ...
[   5.3] Performing &#34;bash-history&#34; ...
[   5.3] Performing &#34;machine-id&#34; ...
[   5.3] Performing &#34;net-hwaddr&#34; ...
[   5.3] Performing &#34;ssh-hostkeys&#34; ...
[   5.4] Performing &#34;tmp-files&#34; ...
[   5.4] Performing &#34;utmp&#34; ...
[   5.5] Setting a random seed
[   5.5] Setting the machine ID in /etc/machine-id
</code></pre><h3 id=virt-sysprep-con-opciones-adicionales>virt-sysprep con opciones adicionales</h3><p>Puedes establecer el <strong>hostname</strong> y la <strong>contraseña de root</strong> durante la generalización:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--root-password password:MySecurePassword123!
</span></span></code></pre></div><h3 id=opciones-útiles-de-virt-sysprep>Opciones útiles de virt-sysprep</h3><table><thead><tr><th>Opción</th><th>Descripción</th></tr></thead><tbody><tr><td><code>--hostname NOMBRE</code></td><td>Establece el nombre del host</td></tr><tr><td><code>--root-password password:PASS</code></td><td>Define la contraseña de root</td></tr><tr><td><code>--firstboot SCRIPT</code></td><td>Ejecuta un script en el primer arranque</td></tr><tr><td><code>--operations LISTA</code></td><td>Especifica qué operaciones realizar (por defecto, todas)</td></tr><tr><td><code>--enable OPERACIONES</code></td><td>Habilita operaciones específicas</td></tr><tr><td><code>--disable OPERACIONES</code></td><td>Deshabilita operaciones específicas</td></tr></tbody></table><p>Ejemplo deshabilitando la eliminación de claves SSH:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template --operations all,-ssh-hostkeys
</span></span></code></pre></div><hr><h2 id=5-crear-nuevas-vms-a-partir-de-la-plantilla>5. Crear nuevas VMs a partir de la plantilla</h2><p>Una vez que tienes una <strong>machine image</strong> generalizada, puedes crear múltiples instancias rápidamente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-debian-01.qcow2
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-debian-02 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-debian-02.qcow2
</span></span></code></pre></div><p>Verifica las VMs creadas:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><hr><h2 id=6-personalizar-vms-con-virt-customize>6. Personalizar VMs con virt-customize</h2><p><code>virt-customize</code> permite modificar una VM <strong>sin arrancarla</strong>, lo que es ideal para personalizar clones rápidamente.</p><h3 id=ejemplo-básico-establecer-hostname-y-contraseña>Ejemplo básico: Establecer hostname y contraseña</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-customize -d vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password usuario:password:MyPassword123!
</span></span></code></pre></div><p>Salida:</p><pre tabindex=0><code>[   0.0] Examining the guest ...
[   3.1] Setting a random seed
[   3.1] Setting the hostname: vm-debian-01
[   4.2] Setting passwords
[   5.0] Finishing off
</code></pre><h3 id=opciones-avanzadas-de-virt-customize>Opciones avanzadas de virt-customize</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-customize -d vm-debian-02 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-debian-02 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--root-password password:RootPass123! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password admin:password:AdminPass123! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--ssh-inject admin:file:/home/user/.ssh/id_rsa.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;apt update &amp;&amp; apt install -y nginx&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--timezone Europe/Madrid <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;systemctl enable nginx&#39;</span>
</span></span></code></pre></div><h3 id=tabla-de-opciones-útiles>Tabla de opciones útiles</h3><table><thead><tr><th>Opción</th><th>Descripción</th></tr></thead><tbody><tr><td><code>--hostname NOMBRE</code></td><td>Establece el hostname</td></tr><tr><td><code>--password USER:password:PASS</code></td><td>Define contraseña de usuario</td></tr><tr><td><code>--ssh-inject USER:file:CLAVE.pub</code></td><td>Inyecta clave SSH pública</td></tr><tr><td><code>--run-command 'COMANDO'</code></td><td>Ejecuta un comando dentro de la VM</td></tr><tr><td><code>--install PAQUETES</code></td><td>Instala paquetes (separados por coma)</td></tr><tr><td><code>--timezone ZONA</code></td><td>Establece la zona horaria</td></tr><tr><td><code>--update</code></td><td>Actualiza todos los paquetes</td></tr><tr><td><code>--selinux-relabel</code></td><td>Reestablece etiquetas SELinux</td></tr></tbody></table><h3 id=personalización-con-script>Personalización con script</h3><p>Puedes ejecutar un script completo:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-customize -d vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--upload /path/to/config.sh:/tmp/config.sh <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;bash /tmp/config.sh&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--delete /tmp/config.sh
</span></span></code></pre></div><hr><h2 id=7-problemas-comunes-y-soluciones>7. Problemas comunes y soluciones</h2><h3 id=problema-1-error-al-conectar-por-ssh---connection-refused>Problema 1: Error al conectar por SSH - &ldquo;Connection refused&rdquo;</h3><p><strong>Causa:</strong> Las claves SSH de host fueron eliminadas por <code>virt-sysprep</code>.</p><p><strong>Síntomas:</strong> Al revisar el estado del servicio SSH dentro de la VM:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl status sshd
</span></span></code></pre></div><p>Verás errores como:</p><pre tabindex=0><code>sshd[387]: error: Could not load host key: /etc/ssh/ssh_host_rsa_key
sshd[387]: error: Could not load host key: /etc/ssh/ssh_host_ecdsa_key
sshd[387]: error: Could not load host key: /etc/ssh/ssh_host_ed25519_key
sshd[387]: fatal: No supported key exchange algorithms [preauth]
</code></pre><p><strong>Solución 1:</strong> Regenerar todas las claves SSH automáticamente:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ssh-keygen -A
</span></span><span style=display:flex><span>sudo systemctl restart sshd
</span></span></code></pre></div><p>Salida:</p><pre tabindex=0><code>ssh-keygen: generating new host keys: RSA DSA ECDSA ED25519
</code></pre><p><strong>Solución 2:</strong> Regenerar claves manualmente una por una:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ssh-keygen -f /etc/ssh/ssh_host_rsa_key -N <span style=color:#e6db74>&#39;&#39;</span> -t rsa
</span></span><span style=display:flex><span>sudo ssh-keygen -f /etc/ssh/ssh_host_ecdsa_key -N <span style=color:#e6db74>&#39;&#39;</span> -t ecdsa
</span></span><span style=display:flex><span>sudo ssh-keygen -f /etc/ssh/ssh_host_ed25519_key -N <span style=color:#e6db74>&#39;&#39;</span> -t ed25519
</span></span><span style=display:flex><span>sudo systemctl restart sshd
</span></span></code></pre></div><p><strong>Solución 3:</strong> Evitar que virt-sysprep elimine las claves SSH:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template --operations all,-ssh-hostkeys
</span></span></code></pre></div><blockquote><p><strong>Advertencia:</strong> Si conservas las claves SSH en la plantilla, todas las VMs clonadas compartirán las mismas claves de host, lo cual es un riesgo de seguridad. Solo hazlo en entornos de laboratorio.</p></blockquote><h3 id=problema-2-warning-remote-host-identification-has-changed>Problema 2: &ldquo;WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!&rdquo;</h3><p><strong>Causa:</strong> Las claves SSH del host cambiaron y el cliente tiene la clave antigua en <code>~/.ssh/known_hosts</code>.</p><p><strong>Solución:</strong> Eliminar la entrada antigua del archivo <code>known_hosts</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -f <span style=color:#e6db74>&#34;/home/usuario/.ssh/known_hosts&#34;</span> -R <span style=color:#e6db74>&#34;192.168.122.50&#34;</span>
</span></span></code></pre></div><p>O editar manualmente el archivo <code>~/.ssh/known_hosts</code> y eliminar la línea correspondiente.</p><h3 id=problema-3-direcciones-mac-duplicadas>Problema 3: Direcciones MAC duplicadas</h3><p><strong>Causa:</strong> Al clonar sin <code>virt-sysprep</code>, las VMs pueden tener la misma dirección MAC.</p><p><strong>Solución:</strong> <code>virt-clone</code> genera automáticamente nuevas direcciones MAC. Si tienes problemas, edita la VM:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh edit vm-debian-01
</span></span></code></pre></div><p>Busca la sección <code>&lt;interface></code> y elimina o modifica la línea <code>&lt;mac address='...'/></code>. Libvirt generará una nueva al arrancar.</p><h3 id=problema-4-machine-id-duplicado>Problema 4: machine-id duplicado</h3><p><strong>Causa:</strong> El archivo <code>/etc/machine-id</code> es idéntico en todas las VMs clonadas.</p><p><strong>Solución:</strong> <code>virt-sysprep</code> ya se encarga de esto. Si lo hiciste manualmente, regenera el machine-id:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo rm /etc/machine-id
</span></span><span style=display:flex><span>sudo systemd-machine-id-setup
</span></span></code></pre></div><hr><h2 id=8-workflow-completo-recomendado>8. Workflow completo recomendado</h2><p>Aquí tienes un flujo de trabajo completo para crear y desplegar múltiples VMs:</p><h3 id=paso-1-crear-y-configurar-la-vm-base>Paso 1: Crear y configurar la VM base</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Crear VM base (suponiendo que ya la tienes)</span>
</span></span><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><h3 id=paso-2-apagar-y-clonar>Paso 2: Apagar y clonar</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh shutdown debian13
</span></span><span style=display:flex><span>virt-clone --original debian13 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template.qcow2
</span></span></code></pre></div><h3 id=paso-3-generalizar-la-plantilla>Paso 3: Generalizar la plantilla</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--root-password password:TemplatePass123!
</span></span></code></pre></div><h3 id=paso-4-crear-nuevas-instancias>Paso 4: Crear nuevas instancias</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Crear VM 1</span>
</span></span><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-web-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-web-01.qcow2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Personalizar VM 1</span>
</span></span><span style=display:flex><span>sudo virt-customize -d vm-web-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-web-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password admin:password:AdminWeb01! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--ssh-inject admin:file:/home/user/.ssh/id_rsa.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;apt update &amp;&amp; apt install -y nginx&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Crear VM 2</span>
</span></span><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-db-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-db-01.qcow2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Personalizar VM 2</span>
</span></span><span style=display:flex><span>sudo virt-customize -d vm-db-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-db-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password admin:password:AdminDB01! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--ssh-inject admin:file:/home/user/.ssh/id_rsa.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;apt update &amp;&amp; apt install -y postgresql&#39;</span>
</span></span></code></pre></div><h3 id=paso-5-arrancar-y-verificar>Paso 5: Arrancar y verificar</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh start vm-web-01
</span></span><span style=display:flex><span>virsh start vm-db-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Verificar IPs asignadas</span>
</span></span><span style=display:flex><span>virsh domifaddr vm-web-01
</span></span><span style=display:flex><span>virsh domifaddr vm-db-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Conectar por SSH</span>
</span></span><span style=display:flex><span>ssh admin@192.168.122.X
</span></span></code></pre></div><hr><h2 id=9-resumen-de-comandos-principales>9. Resumen de comandos principales</h2><table><thead><tr><th>Comando</th><th>Descripción</th></tr></thead><tbody><tr><td><code>virt-clone --original VM --name NUEVA --auto-clone</code></td><td>Clona una VM con nombre de disco automático</td></tr><tr><td><code>virt-clone --original VM --name NUEVA --file DISCO.qcow2</code></td><td>Clona especificando el nombre del disco</td></tr><tr><td><code>virsh domrename VIEJO NUEVO</code></td><td>Renombra una máquina virtual</td></tr><tr><td><code>sudo virt-sysprep -d VM</code></td><td>Generaliza una VM eliminando identificadores únicos</td></tr><tr><td><code>sudo virt-customize -d VM --hostname NOMBRE</code></td><td>Personaliza una VM sin arrancarla</td></tr><tr><td><code>sudo ssh-keygen -A</code></td><td>Regenera todas las claves SSH de host</td></tr><tr><td><code>virsh edit VM</code></td><td>Edita la configuración XML de una VM</td></tr></tbody></table><hr><h2 id=referencias>Referencias</h2><ul><li><a href=https://github.com/josedom24/curso_virtualizacion_linux target=_blank rel=noopener>curso_virtualizacion_linux — GitHub</a></li><li><a href=https://linux.die.net/man/1/virt-clone target=_blank rel=noopener>Documentación oficial de virt-clone</a></li><li><a href=https://libguestfs.org/virt-sysprep.1.html target=_blank rel=noopener>Documentación oficial de virt-sysprep</a></li><li><a href=https://libguestfs.org/virt-customize.1.html target=_blank rel=noopener>Documentación oficial de virt-customize</a></li><li><a href=https://libguestfs.org/ target=_blank rel=noopener>libguestfs - Tools for accessing and modifying VM disk images</a></li></ul></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Compartir en:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.javiercd.es%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fwww.javiercd.es%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f&text=Clonar%20y%20renombrar%20m%c3%a1quinas%20virtuales%20en%20KVM&via=Atlas" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.javiercd.es%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f&title=Clonar%20y%20renombrar%20m%c3%a1quinas%20virtuales%20en%20KVM" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.javiercd.es%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f&title=Clonar%20y%20renombrar%20m%c3%a1quinas%20virtuales%20en%20KVM" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Clonar%20y%20renombrar%20m%c3%a1quinas%20virtuales%20en%20KVM https%3a%2f%2fwww.javiercd.es%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Clonar%20y%20renombrar%20m%c3%a1quinas%20virtuales%20en%20KVM&body=https%3a%2f%2fwww.javiercd.es%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/javierasping/sentinel/edit/main/content/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/clonar-y-renombrar-vm.md title="Mejorar esta página" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Mejorar esta página</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Contenido</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#requisitos-previos>Requisitos previos</a></li><li><a href=#1-preparar-la-máquina-virtual-base>1. Preparar la máquina virtual base</a><ul><li><a href=#apagar-la-máquina-virtual>Apagar la máquina virtual</a></li></ul></li><li><a href=#2-clonar-la-máquina-virtual-con-virt-clone>2. Clonar la máquina virtual con virt-clone</a><ul><li><a href=#opción-1-clonación-automática-nombre-de-disco-generado>Opción 1: Clonación automática (nombre de disco generado)</a></li><li><a href=#opción-2-especificar-nombre-de-disco-personalizado>Opción 2: Especificar nombre de disco personalizado</a></li><li><a href=#clonar-múltiples-discos>Clonar múltiples discos</a></li></ul></li><li><a href=#3-renombrar-máquinas-virtuales-con-virsh-domrename>3. Renombrar máquinas virtuales con virsh domrename</a></li><li><a href=#4-generalizar-la-vm-con-virt-sysprep>4. Generalizar la VM con virt-sysprep</a><ul><li><a href=#qué-hace-virt-sysprep>¿Qué hace virt-sysprep?</a></li><li><a href=#uso-básico-de-virt-sysprep>Uso básico de virt-sysprep</a></li><li><a href=#virt-sysprep-con-opciones-adicionales>virt-sysprep con opciones adicionales</a></li><li><a href=#opciones-útiles-de-virt-sysprep>Opciones útiles de virt-sysprep</a></li></ul></li><li><a href=#5-crear-nuevas-vms-a-partir-de-la-plantilla>5. Crear nuevas VMs a partir de la plantilla</a></li><li><a href=#6-personalizar-vms-con-virt-customize>6. Personalizar VMs con virt-customize</a><ul><li><a href=#ejemplo-básico-establecer-hostname-y-contraseña>Ejemplo básico: Establecer hostname y contraseña</a></li><li><a href=#opciones-avanzadas-de-virt-customize>Opciones avanzadas de virt-customize</a></li><li><a href=#tabla-de-opciones-útiles>Tabla de opciones útiles</a></li><li><a href=#personalización-con-script>Personalización con script</a></li></ul></li><li><a href=#7-problemas-comunes-y-soluciones>7. Problemas comunes y soluciones</a><ul><li><a href=#problema-1-error-al-conectar-por-ssh---connection-refused>Problema 1: Error al conectar por SSH - &ldquo;Connection refused&rdquo;</a></li><li><a href=#problema-2-warning-remote-host-identification-has-changed>Problema 2: &ldquo;WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!&rdquo;</a></li><li><a href=#problema-3-direcciones-mac-duplicadas>Problema 3: Direcciones MAC duplicadas</a></li><li><a href=#problema-4-machine-id-duplicado>Problema 4: machine-id duplicado</a></li></ul></li><li><a href=#8-workflow-completo-recomendado>8. Workflow completo recomendado</a><ul><li><a href=#paso-1-crear-y-configurar-la-vm-base>Paso 1: Crear y configurar la VM base</a></li><li><a href=#paso-2-apagar-y-clonar>Paso 2: Apagar y clonar</a></li><li><a href=#paso-3-generalizar-la-plantilla>Paso 3: Generalizar la plantilla</a></li><li><a href=#paso-4-crear-nuevas-instancias>Paso 4: Crear nuevas instancias</a></li><li><a href=#paso-5-arrancar-y-verificar>Paso 5: Arrancar y verificar</a></li></ul></li><li><a href=#9-resumen-de-comandos-principales>9. Resumen de comandos principales</a></li><li><a href=#referencias>Referencias</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navegación</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/#about>Sobre mi</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/#skills>Competencias</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/#education>Educación</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/#recent-posts>Últimas publicaciones</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/#accomplishments>Certificaciones</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contacto</h5><ul><li><a href=mailto:contacto@javiercd.es target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contacto@javiercd.es</span></a></li><li><a href=https://github.com/javierasping target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>javierasping</span></a></li><li><a href=https://www.linkedin.com/in/javiercd target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Francisco Javier Cruces Doval</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Aviso de responsabilidad:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2023 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Funcionando con
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.88e12b83fd69c92e719c3aa554a42e6d0f20fb72d76bd329f31250ef3bd11899.js integrity="sha256-iOErg/1pyS5xnDqlVKQubQ8g+3LXa9Mp8xJQ7zvRGJk=" defer></script></body></html>