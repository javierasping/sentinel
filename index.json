[{"categories":null,"contents":"En este artículo, te presento una actualización del proceso de instalación de GNS3 en Debian 12, basado en el post anterior para Debian 11. Si necesitas detalles más profundos sobre la instalación o la configuración de GNS3, te recomiendo revisar la versión anterior.\nInstalación GNS3 Actualizamos los repositorios e instalamos las actualizaciones disponibles del sistema.\njaviercruces@HPOMEN15:~$ sudo apt update -y \u0026amp;\u0026amp; sudo apt upgrade -y Instalamos las dependencias necesarias para GNS3, incluyendo Python, herramientas de virtualización (KVM,QEMU,libvirt), bibliotecas adicionales (PyQt5,dynamips) y otras utilidades.\njaviercruces@HPOMEN15:~$ sudo apt install python3 python3-pip pipx python3-pyqt5 python3-pyqt5.qtwebsockets python3-pyqt5.qtsvg qemu-kvm qemu-utils libvirt-clients libvirt-daemon-system virtinst dynamips software-properties-common ca-certificates curl gnupg2 bridge-utils virt-manager libvirt-daemon -y Habilitamos y arrancamos el servicio de virtualización libvirtd y nos añadimos al grupo \u0026ldquo;libvirt\u0026rdquo; para otorgarle permisos sobre las máquinas virtuales y redes de KVM .\njaviercruces@HPOMEN15:~$ sudo systemctl enable --now libvirtd \u0026amp;\u0026amp; sudo usermod -aG libvirt $(whoami) Instalamos las aplicaciones principales de GNS3: el servidor (gns3-server) y la interfaz gráfica (gns3-gui) utilizando pipx para un entorno Python aislado de forma comoda , sin necesidad de crear un entorno virtual a mano.\njaviercruces@HPOMEN15:~$ pipx install gns3-server \u0026amp;\u0026amp; pipx install gns3-gui Aseguramos que el directorio de binarios de pipx esté en la variable de entorno PATH para que los comandos de GNS3 sean accesibles globalmente desde cualquier terminal.\njaviercruces@HPOMEN15:~$ pipx ensurepath Inyectamos el paquete PyQt5 en el entorno de gns3-gui, asegurándonos de que tenga todas las dependencias necesarias.\njaviercruces@HPOMEN15:~$ pipx inject gns3-gui gns3-server PyQt5 Iniciamos la red por defecto de KVM y la configuraremos para que al reiniciar se incie de forma automatica .\njaviercruces@HPOMEN15:~$ virsh --connect=qemu:///system net-start default La red default se ha iniciado javiercruces@HPOMEN15:~$ virsh --connect=qemu:///system net-autostart default La red default ha sido marcada para iniciarse automáticamente Reiniciamos el sistema para aplicar los cambios, como la configuración de grupos y PATH.\njaviercruces@HPOMEN15:~$ sudo reboot Ahora podremos iniciar gns3 , pero te recomiendo que configures los siguientes apartados que tienes en el post .\njaviercruces@HPOMEN15:~$ gns3 Instalación ubridge Clonamos el repositorio de ubridge desde GitHub. Ubridge es una herramienta necesaria para GNS3, que permite gestionar el tráfico entre las interfaces de red virtualizadas.\njaviercruces@HPOMEN15:~$ git clone https://github.com/GNS3/ubridge.git Nos movemos al directorio del proyecto recién clonado.\njaviercruces@HPOMEN15:~$ cd ubridge/ Compilamos el código fuente de ubridge utilizando \u0026ldquo;make\u0026rdquo; .\njaviercruces@HPOMEN15:~/ubridge$ make Instalamos el binario de ubridge en el sistema para que esté disponible globalmente.\njaviercruces@HPOMEN15:~/ubridge$ sudo make install Asignamos permisos de ejecución al archivo binario de ubridge\njaviercruces@HPOMEN15:~/ubridge$ chmod +x ubridge Copiamos el archivo binario a \u0026ldquo;/usr/local/bin\u0026rdquo;, una ruta estándar para comandos disponibles globalmente en el sistema.\njaviercruces@HPOMEN15:~/ubridge$ cp -p ubridge /usr/local/bin Configuramos permisos especiales para ubridge, permitiéndole acceso a operaciones de red (cap_net_admin) y envío de paquetes en bruto (cap_net_raw), necesarias para su funcionamiento.\njaviercruces@HPOMEN15:~/ubridge$ sudo setcap cap_net_admin,cap_net_raw=ep /usr/local/bin/ubridge Instalación vpcs Clonamos el repositorio de VPCS desde GitHub. VPCS (Virtual PC Simulator) es una herramienta ligera que simula PCs básicos para pruebas de red en GNS3.\njaviercruces@HPOMEN15:~$ git clone https://github.com/GNS3/vpcs.git Accedemos al directorio donde hemos clonado el repositorio y ejecutamos el script que nos compilara el codigo fuente del programa.\njaviercruces@HPOMEN15:~$ cd vpcs/src javiercruces@HPOMEN15:~/vpcs/src$ sudo ./mk.sh Dentro de la carpeta src tendremos el ejecutable de las maquinas vpcs , guarda esta ruta ya que tendras que configurarla en gns3 .\njaviercruces@HPOMEN15:~/vpcs/src$ ls | grep c vpcs javiercruces@HPOMEN15:~/vpcs/src$ pwd /home/javiercruces/vpcs/src En preferencias tienes que añadir la ruta donde has guardado el fichero compilado vpcs , en mi caso la ruta seria /home/javiercruces/vpcs/src/vpcs\n","date":"September 8, 2024","hero":"/images/redes/instalacion_wireshark_gns3/gns3_deb12.png","permalink":"https://www.javiercd.es/posts/redes/instalar_gns3_debian12/instalar_gns3_debian12/","summary":"\u003cp\u003eEn este artículo, te presento una actualización del proceso de instalación de GNS3 en Debian 12, basado en el post anterior para Debian 11. Si necesitas detalles más profundos sobre la instalación o la configuración de GNS3, te recomiendo revisar la versión anterior.\u003c/p\u003e\n\u003ch2 id=\"instalación-gns3\"\u003eInstalación GNS3\u003c/h2\u003e\n\u003cp\u003eActualizamos los repositorios e instalamos las actualizaciones disponibles del sistema.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@HPOMEN15:~$ sudo apt update -y \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt upgrade -y \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eInstalamos las dependencias necesarias para GNS3, incluyendo Python, herramientas de virtualización (KVM,QEMU,libvirt), bibliotecas adicionales (PyQt5,dynamips) y otras utilidades.\u003c/p\u003e","tags":["Redes","Wireshark","GNS3"],"title":"Instalación GNS3 en Debian 12 "},{"categories":null,"contents":"Si tienes un portátil con Linux y una gráfica Nvidia, es posible que, después de instalar los drivers de la gráfica, hayas notado que los puertos de video no funcionan correctamente. Si te suena familiar, no te preocupes, te tengo cubierto.\nHe estado investigando y encontré una herramienta que te puede ahorrar varios dolores de cabeza. Se llama EnvyControl, y es una utilidad de línea de comandos (CLI) que te permite elegir fácilmente qué tarjeta gráfica quieres usar en tu equipo. Esto es especialmente útil si tu portátil tiene una configuración de gráficos híbridos, como Intel + Nvidia o AMD + Nvidia.\nEn mi caso, configuré la herramienta para que siempre use la gráfica dedicada, y ¡voilà! Los puertos de video empezaron a funcionar sin problemas.\nEnvyControl es gratuito, de código abierto, y se distribuye bajo la licencia MIT. Eso sí, ten en cuenta que el software se proporciona tal cual, sin garantías. Además, cualquier configuración personalizada de X.org podría ser sobrescrita al cambiar de modos.\nSi quieres probarlo, te dejo el enlace al repositorio: EnvyControl en GitHub. Ahí encontrarás tutoriales específicos para instalarlo en diferentes distribuciones.\nA continuación, te guiaré por los pasos para instalarlo en Debian. ¡Vamos a ello!\nInstalación de EnvyControl Dado que ya no es posible instalar paquetes pip fuera de un entorno virtual tras la adopción de PEP668, en su lugar, utiliza el paquete .deb proporcionado por el repositorio .\nEncuentra la versión más reciente en el siguiente enlace: Releases - EnvyControl.\nEn esa página, selecciona y descarga el paquete .deb correspondiente. También puedes utilizar la herramienta wget para descargarlo desde la terminal.\nInstala el paquete descargado con el siguiente comando:\nsudo apt -y install ./python3-envycontrol_version.deb Una vez que hayas instalado la herramienta, tendrás la capacidad de seleccionar la tarjeta gráfica que deseas utilizar en tu equipo. Es importante recordar que cualquier configuración aplicada no surtirá efecto hasta que reinicies el sistema.\nSupongamos que decides utilizar la gráfica integrada para ahorrar energía, por ejemplo. El comando correspondiente sería :\nsudo envycontrol -s integrated Si por el contrario quieres utilizar el modo hibrido (ambas)\nsudo envycontrol -s hybrid --rtd3 Si prefieres utilizar solo tu gráfica dedicada, ten en cuenta que esta es la única configuración que me ha funcionado para activar los puertos de video. Para dar el salto a este modo te pedirá primero que pongas el modo anterior , el híbrido . Una vez estés en ese modo el comando para activar solo tu gráfica dedicada:\nsudo envycontrol -s nvidia --force-comp --coolbits 24 Vuelvo a insistirse pero RECUERDA REINICIAR PARA QUE SE APLIQUEN LOS CAMBIOS .\nEn este punto, te he proporcionado los comandos que he utilizado, pero el programa cuenta con su propio manual. Además, en el repositorio del autor, puedes encontrar información útil adicional.\nAdemas en esté explica que hay una extension de gnome para que puedas realizar estos cambios desde la interfaz gráfica . Aunque personalmente siempre tengo un enchufe donde trabajo con el portátil , es posible que para ahorrar batería quieras cambiar al modo híbrido o al de la gráfica integrada .\nHasta aquí, confío en que los controladores de NVIDIA estén funcionando correctamente y que ya puedas usar los puertos de video de tu equipo sin problemas.\nComo mencioné antes, la compatibilidad puede variar según tu hardware. En mi caso, los puertos de video solo funcionan cuando uso el modo de la gráfica dedicada. Así que si te encuentras en una situación similar, no dudes en probar esta configuración.\n","date":"September 1, 2024","hero":"/images/drivers/elegir_grafica.png","permalink":"https://www.javiercd.es/posts/drivers/nvidia_optimus/nvidia_optimus/","summary":"\u003cp\u003eSi tienes un portátil con Linux y una gráfica Nvidia, es posible que, después de instalar los drivers de la gráfica, hayas notado que los puertos de video no funcionan correctamente. Si te suena familiar, no te preocupes, te tengo cubierto.\u003c/p\u003e\n\u003cp\u003eHe estado investigando y encontré una herramienta que te puede ahorrar varios dolores de cabeza. Se llama EnvyControl, y es una utilidad de línea de comandos (CLI) que te permite elegir fácilmente qué tarjeta gráfica quieres usar en tu equipo. Esto es especialmente útil si tu portátil tiene una configuración de gráficos híbridos, como Intel + Nvidia o AMD + Nvidia.\u003c/p\u003e","tags":["Controladores NVIDIA","Linux"],"title":"Como elegir que gráfica usar en mi portátil con Linux"},{"categories":null,"contents":"Para permitir el acceso remoto a tu servidor MariaDB, sigue estos pasos:\nConfigura el archivo de configuración de MariaDB\nPrimero, edita el archivo de configuración de MariaDB para permitir conexiones desde direcciones IP específicas. Abre el archivo /etc/mysql/mariadb.conf.d/50-server.cnf con un editor de texto, por ejemplo, nano:\nsudo nano /etc/mysql/mariadb.conf.d/50-server.cnf Busca la línea que comienza con bind-address y cámbiala para que acepte conexiones desde cualquier dirección IP. Puedes hacer que acepte conexiones desde todas las IPs con:\nbind-address = 0.0.0.0 Si prefieres permitir conexiones solo desde direcciones IP específicas, reemplaza 0.0.0.0 con las direcciones IP deseadas, separadas por comas. Guarda el archivo y cierra el editor (Ctrl+X, luego Y para confirmar los cambios y Enter para salir en nano).\nReinicia el servicio de MariaDB\nPara que los cambios surtan efecto, reinicia el servicio de MariaDB:\nsudo systemctl restart mariadb Instala el cliente de MariaDB en la máquina desde la que quieres conectarte\nEn la máquina cliente (desde la que deseas acceder al servidor MariaDB), instala el cliente de MariaDB. En Debian o Ubuntu, puedes hacerlo con:\nsudo apt update sudo apt install mariadb-client Conéctate al servidor MariaDB desde la máquina cliente\nFinalmente, usa el cliente de MariaDB para conectarte al servidor. Reemplaza usuario, servidor_ip y base_de_datos con el nombre de usuario, la dirección IP del servidor y la base de datos a la que deseas acceder, respectivamente:\nmysql -u usuario -p -h servidor_ip Cuando se te solicite, ingresa la contraseña del usuario que has configurado en el servidor MariaDB.\nCon estos pasos, habrás configurado el acceso remoto a tu servidor MariaDB y podrás conectarte desde cualquier máquina que tenga el cliente de MariaDB instalado.\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_mariadb/acceso_remoto_mariadb.png","permalink":"https://www.javiercd.es/posts/base_de_datos/acceso_remoto_mariadb/acceso_remoto_mariadb/","summary":"\u003cp\u003ePara permitir el acceso remoto a tu servidor MariaDB, sigue estos pasos:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eConfigura el archivo de configuración de MariaDB\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePrimero, edita el archivo de configuración de MariaDB para permitir conexiones desde direcciones IP específicas. Abre el archivo \u003ccode\u003e/etc/mysql/mariadb.conf.d/50-server.cnf\u003c/code\u003e con un editor de texto, por ejemplo, \u003ccode\u003enano\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo nano /etc/mysql/mariadb.conf.d/50-server.cnf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eBusca la línea que comienza con \u003ccode\u003ebind-address\u003c/code\u003e y cámbiala para que acepte conexiones desde cualquier dirección IP. Puedes hacer que acepte conexiones desde todas las IPs con:\u003c/p\u003e","tags":["MariaDB","Debian"],"title":"Configuración de acceso remoto en MariaDB"},{"categories":null,"contents":"Para configurar el acceso remoto en Oracle, es fundamental ajustar correctamente los archivos de red ubicados en $ORACLE_HOME/network/admin. Estos archivos, como listener.ora y tnsnames.ora, permiten definir cómo se conectarán los clientes a la base de datos y qué equipos tendrán acceso.\nConfiguración acceso remoto La configuración de oracle con respecto a la red se guarda en el directorio que hayamos definido como home de oracle $ORACLE_HOME/network/admin :\nlistener.ora: Este archivo sirve para configurar el servicio de escucha (listener) de Oracle. Contiene información sobre los puntos de conexión y los protocolos que el servidor de Oracle utilizará para aceptar conexiones de clientes. samples: Dentro de este directorio, hay ejemplos de archivos de configuración para varios componentes de Oracle. Estos archivos de muestra son útiles como referencia cuando necesitamos crear archivos de configuración. shrept.lst: Este archivo forma parte del proceso de recuperación de Oracle y se utiliza para rastrear la replicación de registros de cambios en tiempo real. Es esencial cuando se trabaja con replicación de datos. sqlnet.ora: Este archivo se configuran las opciones de red de Oracle. Aquí se define cómo se resuelven los nombres de los servidores, configurar medidas de seguridad y ajustar la capa de seguridad . tnsnames.ora: Aquí se definen los alias que oracle va a utilizar . Comenzaremos configurando el listener.ora y indicaremos que equipos se pueden conectar a la base de datos en mi caso todos :\nUna vez hecho esto iniciaremos sesión con el usuario oracle y iniciaremos el servicio de escucha de oracle para poder conectarnos en red:\n*Ten en cuenta que tienes que añadir las variables de oracle en el .bashrc del usuario oracle para que puedas iniciar el servicio , si no lo has hecho no te encontrara el comando .\nEn el equipo cliente donde vayamos a realizar la conexión deberemos de editar el fichero tsnames.ora y añadir la dirección y el puerto donde esta alojado nuestro servidor :\nUna vez hecho esto el comando para conectarnos es el siguiente :\nLa sintaxis es usuario/contraseña@//IP:PUERTO/SID\nPodemos consultar tablas , he añadido el esquema del proyecto del año anterior :\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_oracle/acceso_remoto_oracle.png","permalink":"https://www.javiercd.es/posts/base_de_datos/oracle_acceso_remoto/oracle_acceso_remoto/","summary":"\u003cp\u003ePara configurar el acceso remoto en Oracle, es fundamental ajustar correctamente los archivos de red ubicados en $ORACLE_HOME/network/admin. Estos archivos, como listener.ora y tnsnames.ora, permiten definir cómo se conectarán los clientes a la base de datos y qué equipos tendrán acceso.\u003c/p\u003e\n\u003ch2 id=\"configuración-acceso-remoto\"\u003eConfiguración acceso remoto\u003c/h2\u003e\n\u003cp\u003eLa configuración de oracle con respecto a la red se guarda en el directorio que hayamos definido como home de oracle  $ORACLE_HOME/network/admin :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/base_de_datos/oracle_acceso_remoto/img/Aspose.Words.55b57132-3c19-4447-864b-0b88f1173a10.029.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003elistener.ora\u003c/strong\u003e: Este archivo sirve para configurar el servicio de escucha (listener) de Oracle. Contiene información sobre los puntos de conexión y los protocolos que el servidor de Oracle utilizará para aceptar conexiones de clientes.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003esamples\u003c/strong\u003e: Dentro de este directorio, hay ejemplos de archivos de configuración para varios componentes de Oracle. Estos archivos de muestra son útiles como referencia cuando necesitamos crear archivos de configuración.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eshrept.lst\u003c/strong\u003e: Este archivo forma parte del proceso de recuperación de Oracle y se utiliza para rastrear la replicación de registros de cambios en tiempo real. Es esencial cuando se trabaja con replicación de datos.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003esqlnet.ora\u003c/strong\u003e: Este archivo se configuran las opciones de red de Oracle. Aquí se define cómo se resuelven los nombres de los servidores, configurar medidas de seguridad y ajustar la capa de seguridad .\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003etnsnames.ora\u003c/strong\u003e: Aquí se definen los alias que oracle va a utilizar .\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eComenzaremos configurando el listener.ora y indicaremos que equipos se pueden conectar a la base de datos en mi caso todos :\u003c/p\u003e","tags":["Oracle","Debian"],"title":"Configuración de acceso remoto en Oracle"},{"categories":null,"contents":"La instalación de los controladores de NVIDIA en el universo de Linux ha sido tradicionalmente un desafío, especialmente en distribuciones como Debian, donde las políticas del software libre a menudo complican el proceso.\nEn este post voy a explicarte una forma sencilla de instalar los drivers de NVIDIA usando los repositorios oficiales de Debian . Además, al final del artículo, aprenderás a instalar una herramienta clave llamada Nvidia Optimus, que te brindará la capacidad de seleccionar qué tarjeta gráfica utilizará tu equipo.\nEsta herramienta es especialmente útil en portátiles, ya que es común que estos dispositivos presenten problemas al emitir video a través de los puertos, una situación que puede ser fácilmente con esta herramienta.\nIdentificación de Nuestra GPU Antes de embarcarnos en la instalación y configuración, es fundamental conocer el hardware de nuestro equipo. Para averiguar qué tarjetas gráficas están disponibles en nuestro sistema, utilizaremos el siguiente comando:\njaviercruces@HPOMEN15:~$ lspci -nn | egrep -i \u0026#34;3d|display|vga\u0026#34; 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) 06:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Cezanne [Radeon Vega Series / Radeon Vega Mobile Series] [1002:1638] (rev c5) Como se puede apreciar en la salida del comando anterior, mi equipo portátil cuenta con dos tarjetas gráficas. Identificar el modelo es crucial, ya que si optamos por una instalación manual del controlador, necesitaremos el específico para nuestra GPU.\nNo obstante, en Debian contamos con una utilidad que simplifica este proceso, indicándonos qué controlador debemos instalar. Sin embargo, para acceder a esta utilidad, es necesario modificar nuestros repositorios de Debian.\nPara llevar a cabo esta modificación, añadiremos la sección \u0026ldquo;non-free\u0026rdquo; a nuestros repositorios utilizando un editor de texto de nuestra preferencia:\njaviercruces@HPOMEN15:~$ sudo nano /etc/apt/sources.list deb http://deb.debian.org/debian/ bookworm main contrib non-free non-free-firmware Recuerda que cada vez que modifiques este fichero tienes que hacer un update para que se actualice.\njaviercruces@HPOMEN15:~$ sudo apt update -y Con nuestros repositorios debidamente actualizados, procederemos a instalar el script de detección de NVIDIA con el siguiente comando:\njaviercruces@HPOMEN15:~$ sudo apt install nvidia-detect Ahora ejecutaremos el script de NVIDIA; como podrás observar, nos proporcionará información detallada sobre nuestra tarjeta gráfica NVIDIA, así como los diversos controladores compatibles y el paquete de Debian recomendado para la instalación:\njaviercruces@HPOMEN15:~$ nvidia-detect Detected NVIDIA GPUs: 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) Checking card: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] (rev a1) Your card is supported by all driver versions. Your card is also supported by the Tesla drivers series. Your card is also supported by the Tesla 470 drivers series. It is recommended to install the nvidia-driver package. Instalación del driver recomendado Antes de instalar los controladores, debes obtener los encabezados del kernel adecuados para que el controlador de NVIDIA pueda compilar correctamente.\nEn un sistema típico de 64 bits que utiliza el kernel predeterminado, simplemente ejecutas:\njaviercruces@HPOMEN15:~$ sudo apt install linux-headers-amd64 Para sistemas de 32 bits con el kernel no-PAE, en su lugar, realizarías la siguiente instalación:\njaviercruces@HPOMEN15:~$ sudo apt install linux-headers-686 Una vez instalada las dependencias del driver , instalaremos el mismo :\njaviercruces@HPOMEN15:~$ sudo apt install nvidia-driver -y Durante la instalación, es probable que encuentres una pantalla típicamente azul que te informa sobre un conflicto con el controlador \u0026ldquo;nouveau\u0026rdquo;, el cual es el driver instalado automáticamente por Debian debido a sus características de software libre. Simplemente haz clic en \u0026ldquo;OK\u0026rdquo; en esta pantalla y continúa con el proceso de instalación.\nAl concluir la instalación, será necesario reiniciar tu equipo para cargar el módulo de NVIDIA. Después de reiniciar, puedes verificar si se ha cargado correctamente utilizando el siguiente comando. Utilizando la barra inclinada (/), puedes filtrar la salida escribiendo la palabra \u0026ldquo;nvidia\u0026rdquo;, lo que te llevará directamente a la información relevante de tu tarjeta gráfica, permitiéndote confirmar que el módulo de NVIDIA está cargado.\nTienes que comprobar que en la linea \u0026ldquo;Kernel driver in use\u0026rdquo; , tenga el modulo nvidia .\njaviercruces@HPOMEN15:~$ lspci -knn | less 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) DeviceName: NVIDIA Graphics Device Subsystem: Hewlett-Packard Company GA106M [GeForce RTX 3060 Mobile / Max-Q] [103c:88d1] Kernel driver in use: nvidia Kernel modules: nouveau, nvidia_current_drm, nvidia_current Puede que no te hayas dado cuenta pero ahora en tu escritorio tendrás una app llamada nvidia-settings con la cual podrás configurar tu gráfica .\nAdemas si quieres ver desde la linea de comandos información de tu GPU NVIDIA tienes a tu disposición el siguiente comando :\njaviercruces@HPOMEN15:~$ nvidia-smi Fri Dec 29 02:04:58 2023 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 525.125.06 Driver Version: 525.125.06 CUDA Version: 12.0 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |===============================+======================+======================| | 0 NVIDIA GeForce ... On | 00000000:01:00.0 Off | N/A | | N/A 42C P5 10W / 80W | 296MiB / 6144MiB | 12% Default | | | | N/A | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=============================================================================| | 0 N/A N/A 3246 G /usr/lib/xorg/Xorg 117MiB | | 0 N/A N/A 3442 G /usr/bin/gnome-shell 32MiB | | 0 N/A N/A 4807 G ...on=20231218-080113.411000 104MiB | | 0 N/A N/A 5802 G ...RendererForSitePerProcess 38MiB | +-----------------------------------------------------------------------------+ javiercruces@HPOMEN15:~$ ¡Felicidades, Maestro de los Drivers NVIDIA! Has desbloqueado un logro épico en el reino de la informática. No cualquiera es capaz de llegar hasta aquí, no quiero desilusionarte pero ¿has verificado que funcionen los puertos HDMI y DisplayPort de tu equipo?\nEn este punto, se abren dos posibles caminos:\nEn el primer escenario, tus puertos funcionan a la perfección sin requerir intervención adicional. Si este es tu caso, felicidades se ve que Dios tiene favoritos .\nSi por el contrario al igual que yo no eres uno de ellos , como acabas de comprobar los puertos no emiten video , en tu monitor veras que no tienes señal a pesar de que en el debian veas que te detecta el monitor.\nSi te ocurre este problema puedes encontrar un post en esta misma pagina explicando una posible solución , para ello haremos uso de la herramienta nvidia optimus . Te dejo el enlace a continuación https://www.javiercd.es/posts/drivers/nvidia_optimus/nvidia_optimus/\n","date":"September 1, 2024","hero":"/images/drivers/instalar_drivers_nvidia.png","permalink":"https://www.javiercd.es/posts/drivers/nvidia_driver/instalacion-controladores-nvidia-debian-12/","summary":"\u003cp\u003eLa instalación de los controladores de NVIDIA en el universo de Linux ha sido tradicionalmente un desafío, especialmente en distribuciones como Debian, donde las políticas del software libre a menudo complican el proceso.\u003c/p\u003e\n\u003cp\u003eEn este post voy a explicarte una forma sencilla de instalar los drivers de NVIDIA usando los repositorios oficiales de Debian . Además, al final del artículo, aprenderás a instalar una herramienta clave llamada Nvidia Optimus, que te brindará la capacidad de seleccionar qué tarjeta gráfica utilizará tu equipo.\u003c/p\u003e","tags":["Controladores NVIDIA","Linux"],"title":"Instalación de Controladores NVIDIA en Debian 12"},{"categories":null,"contents":"Instalar Oracle 19c en Debian 12 puede parecer complicado, pero no te preocupes, estoy aquí para guiarte en cada paso. En este post, te explicaré de manera sencilla cómo preparar tu sistema y realizar la instalación de Oracle 19c en Debian 12.\nActualizar los repositorios Lo primero es actualizar los repositorios de nuestra maquina virtual y en el caso de que no tengamos algún paquete lo actualizamos :\nInstalar dependencias Lo siguiente sera instalar las dependencias de Oracle en nuestro sistema :\nlibaio1 : Proporciona acceso asíncrono a E/S. Unixodbc : Es un controlador ODBC para conectividad de bases de datos. Bc : Es una calculadora de precisión arbitraria. Ksh : Es el shell Korn para scripts. Gawk : Es una versión mejorada de Awk para procesamiento de texto y datos. Añadir usuario oracle Crearemos el grupo dba y crearemos el usuario oracle :\nComprobamos que podemos acceder al usuario oracle :\nConfiguración de red Tenemos que tener configurada una ip estática :\nAdemás tenemos que tener una entrada en el fichero hosts de nuestra dirección privada :\nDescargar el archivo de instalación del sitio web de Oracle Una vez comprobado que podemos instalarlo en nuestro sistema o maquina virtual vamos a descargarnos desde su pagina web oficial .\nRápidamente nos daremos cuenta de que Oracle no da soporte a Debian ya que encontraremos el paquete en formato .rpm esto quiere decir que este esta preparado para instalarse en distribuciones basadas en red hat .\nPara que nosotros podamos usar este paquete deberemos transformarlo a .deb para ello existe una herramienta llamada alien que nos convertirá el paquete para que lo podamos usar .\nNos instalamos la herramienta :\nAhora usando wget nos descargaremos el metapaquete de Oracle :\nUna vez descargado usaremos la utilidad alien para que nos transforme , esto tardara un ratillo aproximadamente para aligerar el proceso lo he transformado en mi maquina física :\nNos lo pasamos a nuestra maquina virtual usando scp .\nAhora ya que tenemos nuestro paquete transformado a .deb nos lo instalamos usando dpkg en nuestra maquina virtual\nComenzaremos la instalación , tardara un buen rato así que hay que tener paciencia :\nUna vez finalice en el bashrc de nuestro usuario añadiremos las variables de entorno de oracle , ORACLE_SID nos la dirá al final de la instalación , las demás dependerán de los directorio que hayamos puesto en pasos anteriores :\nSolución errores Error [FATAL] [DBT-50000] No se ha podido comprobar la memoria disponible Nos devuelve un error , este nos indica que no puede comprobar la memoria disponible , este error lo podemos solucionar desactivando la comprobación de parámetros de configuración para ello en la linea 164 del fichero → /etc/init.d/oracledb_ORCLCDB-19c\nLa cambiaremos por la siguiente (linea 164 completa) :\n$SU -s /bin/bash $ORACLE_OWNER -c \u0026ldquo;$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET - createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS - pdbName $PDB_NAME -createListener $LISTENER_NAME:$LISTENER_PORT - datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -autoGeneratePasswords -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT -J- Doracle.assistants.dbca.validate.ConfigurationParams=false\u0026rdquo;\n*Subrayo el contenido que debes añadir , también puedes sustituir la linea entera .\nOtro error que nos puede dar es que no encuentre netstat :\nSe soluciona fácilmente instalando net-tools.\nORA-65096: nombre de usuario o rol común no valido Si no nos deja crear un usuario :\nCon esta modificación nos dejara crear usuarios\nPrimeros pasos con Oracle Nos conectaremos como administradores en la base de datos :\nLo primero que tenemos que hacer sera crear un usuario , darle permisos que necesitemos e comprobar que nos podemos conectar con el :\nY le damos los permisos que consideremos al mismo :\nDespués probamos a conectarnos con el mismo :\nCon esto habremos finalizado la instalación básica de Oracle 19c sobre Debian 12 . Es recomendable que si vas a utilizar la base de datos te instales un cliente como SQLplus o SQLdeveloper .\nInstalación SQLplus Nos descargamos el paquete básico SQLplus para Linux , es un .zip :\nNos descargamos el segundo paquete de SQLplus :\nNos creamos el directorio /opt/oracle :\nDescomprimimos los ficheros zip en el directorio que acabamos de crear :\nNos metemos en el directorio y listamos el contenido :\nY a continuación exportaremos la variable de las librería SQLplus y ejecutamos los cambios :\nSi queremos que se mantenga lo añadiremos al bashrc :\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_oracle/instalacion_oracle.png","permalink":"https://www.javiercd.es/posts/base_de_datos/instalacion_oracle_19c_debian12/instalacion_oracle/","summary":"\u003cp\u003eInstalar Oracle 19c en Debian 12 puede parecer complicado, pero no te preocupes, estoy aquí para guiarte en cada paso. En este post, te explicaré de manera sencilla cómo preparar tu sistema y realizar la instalación de Oracle 19c en Debian 12.\u003c/p\u003e\n\u003ch2 id=\"actualizar-los-repositorios\"\u003eActualizar los repositorios\u003c/h2\u003e\n\u003cp\u003eLo primero es actualizar los repositorios de nuestra maquina virtual y en el caso de que no tengamos algún paquete lo actualizamos :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/base_de_datos/instalacion_oracle_19c_debian12/img/Aspose.Words.55b57132-3c19-4447-864b-0b88f1173a10.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"instalar-dependencias\"\u003eInstalar dependencias\u003c/h2\u003e\n\u003cp\u003eLo siguiente sera instalar las dependencias de Oracle en nuestro sistema :\u003c/p\u003e","tags":["Oracle","Debian"],"title":"Instalación de Oracle 19c bajo Debian 12"},{"categories":null,"contents":"En este post, te guiaré a través del proceso de instalación de PostgreSQL en Debian 12, la creación de un usuario con permisos básicos, y cómo crear y consultar una base de datos.\n1. Instalación de PostgreSQL Para instalar PostgreSQL en Debian 12, sigue estos pasos:\nActualiza los repositorios e instala PostgreSQL:\nPrimero, asegúrate de que tu sistema esté actualizado e instala PostgreSQL:\nsudo apt update sudo apt install postgresql Verifica que el servicio esté en funcionamiento:\nDespués de la instalación, asegúrate de que el servicio de PostgreSQL esté en funcionamiento:\nsudo systemctl status postgresql Deberías ver un mensaje que indique que el servicio está activo (running).\n2. Creación de un Usuario y Asignación de Permisos Accede al usuario postgres:\nPostgreSQL crea un usuario llamado postgres durante la instalación. Accede a este usuario para realizar las tareas de configuración:\nsudo -u postgres psql Si quieres puedes cambiar la contraseña del usuario postgres de la base de datos con el siguiente comando:\nALTER USER postgres WITH PASSWORD \u0026#39;tu_nueva_contraseña\u0026#39;; Crea un nuevo usuario:\nDentro del prompt de postgres,para crear un nuevo usuario utiliza el siguiente comando.\nCREATE USER javiercruces WITH PASSWORD \u0026#39;tu_contraseña\u0026#39;; Crea una nueva base de datos:\nA continuación, crea una base de datos que estará asociada a tu nuevo usuario.\nCREATE DATABASE mypgdatabase OWNER mypguser; Crear un usuario administrador\nSi quieres crear un usuario con todos los privilegios en una base de datos introduce el siguiente comando:\nGRANT ALL PRIVILEGES ON DATABASE nombre_base_de_datos TO nombre_usuario; Sal de la consola con \\q:\n\\q 3. Prueba de Conexión Conéctate a PostgreSQL con el nuevo usuario:\nDesde el usuario postgres, o directamente desde tu terminal, intenta conectarte a PostgreSQL utilizando el nuevo usuario:\npsql -U nombre_usuario -d nombre_base_de_datos Se te pedirá la contraseña del usuario. Si puedes acceder a la base de datos, la configuración fue exitosa.\n4. Creación y Consulta de una Tabla Crea una nueva tabla:\nUna vez dentro de la consola de PostgreSQL con el nuevo usuario, crea una nueva tabla. Por ejemplo, para una tabla de equipos de fútbol:\nCREATE TABLE equipos ( id SERIAL PRIMARY KEY, nombre VARCHAR(100) NOT NULL, titulos INT NOT NULL ); Inserta datos en la tabla:\nInserta algunos datos de prueba en la tabla creada:\nINSERT INTO equipos (nombre, titulos) VALUES (\u0026#39;Real Madrid\u0026#39;, 15), (\u0026#39;Barcelona\u0026#39;, 5); Consulta los datos de la tabla:\nRealiza una consulta para verificar que los datos se han insertado correctamente:\nSELECT * FROM equipos; La salida esperada debería ser:\nid | nombre | titulos ----+--------------+--------- 1 | Real Madrid | 15 2 | Barcelona | 5 Con estos pasos, has instalado PostgreSQL, creado un usuario y base de datos, y realizado pruebas básicas para asegurar que todo funciona correctamente. ¡Ahora tienes tu entorno de PostgreSQL listo para usar!\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_postgre/instalacion_postgree.png","permalink":"https://www.javiercd.es/posts/base_de_datos/instalar_postgresql/instalar_postgresql/","summary":"\u003cp\u003eEn este post, te guiaré a través del proceso de instalación de PostgreSQL en Debian 12, la creación de un usuario con permisos básicos, y cómo crear y consultar una base de datos.\u003c/p\u003e\n\u003ch2 id=\"1-instalación-de-postgresql\"\u003e1. Instalación de PostgreSQL\u003c/h2\u003e\n\u003cp\u003ePara instalar PostgreSQL en Debian 12, sigue estos pasos:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eActualiza los repositorios e instala PostgreSQL\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003ePrimero, asegúrate de que tu sistema esté actualizado e instala PostgreSQL:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install postgresql \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVerifica que el servicio esté en funcionamiento\u003c/strong\u003e:\u003c/p\u003e","tags":["PostgreSQL","Debian"],"title":"Instalación de PostgreSQL en Debian 12"},{"categories":null,"contents":"Instalación y Configuración de MariaDB en Debian 12 Para instalar MariaDB en Debian 12, sigue estos pasos:\nActualiza los repositorios e instala el paquete de MariaDB:\nPrimero, actualiza los repositorios de tu sistema e instala MariaDB:\njaviercruces@jcruces:~$ sudo apt update javiercruces@jcruces:~$ sudo apt install mariadb-server Habilita y arranca el servicio de MariaDB:\nUna vez instalada, configura MariaDB para que se inicie automáticamente al arranque y luego arranca el servicio:\njaviercruces@jcruces:~$ sudo systemctl start mariadb javiercruces@jcruces:~$ sudo systemctl enable mariadb Configura MariaDB:\nEjecuta el script de seguridad para realizar configuraciones iniciales:\njaviercruces@jcruces:~$ sudo mysql_secure_installation A continuación, responde a las siguientes preguntas del asistente:\n# Ingresa la contraseña actual para root (presiona Enter si no hay contraseña): Enter current password for root (enter for none): `Enter` # ¿Establecer una nueva contraseña para root? [S/n]: Set root password? [Y/n]: `Y` # ¿Eliminar usuarios anónimos? [S/n]: Remove anonymous users? [Y/n]: `Y` # ¿Deshabilitar el inicio de sesión remoto para root? [S/n]: Disallow root login remotely? [Y/n]: `Y` # ¿Eliminar la base de datos de prueba y el acceso a ella? [S/n]: Remove test database and access to it? [Y/n]: `Y` # ¿Recargar las tablas de privilegios ahora? [S/n]: Reload privilege tables now? [Y/n]: `Y` Crea un nuevo usuario y asigna permisos:\nConéctate a MariaDB como root:\njaviercruces@jcruces:~$ sudo mysql -u root Luego, crea un nuevo usuario y dale permisos completos sobre la base de datos:\nCREATE USER \u0026#39;javiercruces\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;tu_contraseña\u0026#39;; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;javiercruces\u0026#39;@\u0026#39;localhost\u0026#39; WITH GRANT OPTION; FLUSH PRIVILEGES; EXIT; Conéctate usando el nuevo usuario:\nAhora puedes conectarte a MariaDB con el usuario recién creado:\njaviercruces@jcruces:~$ mysql -u javiercruces -p Crea una nueva base de datos, inserta datos y consulta la tabla:\nCrea una base de datos, una tabla y añade algunos datos:\nCREATE DATABASE futbol; USE futbol; CREATE TABLE titulos_champions ( id INT AUTO_INCREMENT PRIMARY KEY, equipo VARCHAR(100) NOT NULL, campeonatos INT NOT NULL ); INSERT INTO titulos_champions (equipo, campeonatos) VALUES (\u0026#39;Real Madrid\u0026#39;, 15), (\u0026#39;Barcelona\u0026#39;, 5); Luego, realiza una consulta para verificar los datos:\nSELECT * FROM titulos_champions; La salida esperada debería ser:\n+----+--------------+--------------+ | id | equipo | campeonatos | +----+--------------+--------------+ | 1 | Real Madrid | 15 | | 2 | Barcelona | 5 | +----+--------------+--------------+ ","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_mariadb/instalar_mariadb.png","permalink":"https://www.javiercd.es/posts/base_de_datos/instalar_mariadb/instalar_mariadb/","summary":"\u003ch2 id=\"instalación-y-configuración-de-mariadb-en-debian-12\"\u003eInstalación y Configuración de MariaDB en Debian 12\u003c/h2\u003e\n\u003cp\u003ePara instalar MariaDB en Debian 12, sigue estos pasos:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eActualiza los repositorios e instala el paquete de MariaDB\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003ePrimero, actualiza los repositorios de tu sistema e instala MariaDB:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@jcruces:~$ sudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@jcruces:~$ sudo apt install mariadb-server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eHabilita y arranca el servicio de MariaDB\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003eUna vez instalada, configura MariaDB para que se inicie automáticamente al arranque y luego arranca el servicio:\u003c/p\u003e","tags":["MariaDB","Debian"],"title":"Instalación y Configuración de MariaDB en Debian 12"},{"categories":null,"contents":"Este post aborda cómo configurar y gestionar conexiones entre diferentes bases de datos, tanto homogéneas como heterogéneas, para facilitar la interoperabilidad entre sistemas de bases de datos diversos. A lo largo del artículo, se exploran distintos escenarios de conexión, comenzando con configuraciones entre bases de datos del mismo tipo, como Oracle a Oracle o PostgreSQL a PostgreSQL, y luego avanzando hacia conexiones heterogéneas entre diferentes tecnologías, como Oracle a MySQL, PostgreSQL a Oracle, y viceversa. También se cubren los pasos necesarios para configurar enlaces, crear usuarios, y modificar archivos de configuración clave, permitiendo así realizar consultas remotas\nConexiones homogéneas Oracle a Oracle Vamos a interconectar dos bases de datos Oracle, a las cuales llamaremos oracle1 y oracle2 para diferenciarlas a lo largo de esta práctica.\nCreación de usuarios en Oracle1 Primero, crearemos un usuario en Oracle1 que tenga permisos para conectarse a la base de datos y para crear enlaces de base de datos:\nPara verificar que el usuario se ha creado correctamente, desconéctate del usuario actual y vuelve a conectarte con el nuevo usuario:\nCreación de usuarios en Oracle2 Repite los pasos realizados en Oracle1 para crear un usuario en Oracle2 con permisos adecuados para conectarse remotamente y crear enlaces de base de datos:\nVerifica la conexión con el nuevo usuario creado:\nConfiguración de los ficheros listener.ora y tnsnames.ora en ORACLE1 Para garantizar la interconexión, debemos configurar los ficheros listener.ora y tnsnames.ora. Esto permitirá que ORACLE1 escuche las conexiones y reconozca la ubicación de ORACLE2.\nConfiguración de listener.ora Edita el fichero listener.ora para que ORACLE1 pueda escuchar conexiones en la red:\nNota: Aunque se recomienda permitir conexiones solo desde direcciones específicas, en este entorno de pruebas hemos habilitado acceso general. En este archivo también se define el puerto utilizado por Oracle.\nConfiguración de tnsnames.ora Ahora configuraremos el fichero tnsnames.ora para que ORACLE1 sepa dónde está ORACLE2:\nEn este ejemplo, ORACLE2 está configurado bajo la IP 192.168.122.13 y escucha en el puerto 1521. También es importante conocer el nombre del servicio remoto. Si no lo sabes, puedes ejecutarlo en ORACLE2 utilizando:\nVerificación de conectividad Para confirmar que ORACLE1 puede comunicarse con ORACLE2, utilizaremos la herramienta tnsping con el alias configurado:\n¡Recuerda! Si no configuraste el listener.ora en el servidor remoto (ORACLE2), esta prueba fallará.\nConfiguración de los ficheros listener.ora y tnsnames.ora en ORACLE2 Ahora repetiremos los mismos pasos en ORACLE2 para que pueda comunicarse con ORACLE1.\nConfiguración de listener.ora Edita el fichero listener.ora para que ORACLE2 escuche conexiones entrantes:\nEn este caso, hemos configurado ORACLE2 para escuchar en cualquier dirección, utilizando el puerto 1521, al igual que en ORACLE1.\nConfiguración de tnsnames.ora Edita el fichero tnsnames.ora para definir un alias que permita a ORACLE2 comunicarse con ORACLE1:\nVerificación de conectividad Usa la herramienta tnsping en ORACLE2 con el alias configurado para ORACLE1:\nSi la salida es exitosa, significa que ORACLE2 puede comunicarse con ORACLE1.\n¡Recuerda! Si no configuraste el listener.ora en el servidor remoto (ORACLE1), esta prueba fallará.\nCreación del enlace de ORACLE1 a ORACLE2 En esta etapa, estableceremos un enlace desde ORACLE1 hacia ORACLE2. Utilizaremos un usuario con privilegios de creación de enlaces, como javiercruces1, que fue creado anteriormente.\nEl enlace recibirá un nombre, en este caso, ORACLE2_LINK. Especificaremos que utilizaremos las credenciales del usuario remoto javiercruces2 y la conexión definida en el fichero tnsnames.ora para ORACLE2.\nVerificación del enlace Para verificar, crearemos la tabla dept en ORACLE2 y realizaremos una consulta desde ORACLE1:\nCreación del enlace de ORACLE2 a ORACLE1 Ahora configuraremos el enlace en la dirección opuesta, de ORACLE2 a ORACLE1. Seguiremos el mismo procedimiento.\nCon el usuario javiercruces2, crearemos un enlace llamado ORACLE1_LINK. Este enlace usará las credenciales del usuario remoto javiercruces1 y la conexión definida en el fichero tnsnames.ora para ORACLE1:\nVerificación del enlace Realizaremos una consulta sencilla utilizando el enlace recién creado:\nConsultas simultáneas entre ORACLE1 y ORACLE2 Ahora, comprobaremos que es posible realizar consultas utilizando ambas bases de datos simultáneamente desde ORACLE1:\nEsta misma consulta puede realizarse desde ORACLE2 también:\nPostgreSQL a PostgreSQL Para permitir la interconexión, es esencial configurar ambas máquinas para que escuchen peticiones. Esto se logra definiendo las IPs y puertos en el archivo de configuración ubicado en /etc/postgresql/15/main/postgresql.conf:\nAdemás, es necesario configurar las redes desde las cuales se aceptarán conexiones. Esto se realiza en el archivo pg_hba.conf:\nDespués de realizar estos cambios, reiniciaremos el servicio PostgreSQL para aplicarlos:\nAl igual que en el apartado anterior, usaremos el esquema de tablas Scott, colocando una tabla en cada base de datos para realizar consultas \u0026ldquo;remotas\u0026rdquo;.\nInterconectar PostgreSQL1 a PostgreSQL2 Para interconectar las bases de datos, utilizaremos dblink, un módulo que permite realizar consultas y operaciones distribuidas entre bases de datos PostgreSQL. Esto se logra estableciendo conexiones directas entre ellas.\nCreación de usuarios y base de datos en PostgreSQL1 Primero, creamos los usuarios y la base de datos en PostgreSQL1:\nHabilitar extensión dblink Activaremos la extensión dblink en PostgreSQL1:\nCreación de la conexión hacia PostgreSQL2 Usaremos el módulo dblink para establecer una conexión hacia PostgreSQL2:\nRealizar consultas utilizando dblink Una vez creada la conexión, podemos realizar consultas remotas desde PostgreSQL1:\nNota: Es un poco tedioso definir los campos para cada consulta remota, lo que puede dificultar su uso en consultas más complejas.\nInterconectar PostgreSQL2 a PostgreSQL1 Creación de usuarios y base de datos en PostgreSQL2 Crearemos los usuarios y la base de datos en PostgreSQL2 siguiendo un proceso similar al realizado en PostgreSQL1:\nHabilitar extensión dblink y crear conexión hacia PostgreSQL1 Activaremos la extensión dblink y configuraremos la conexión hacia PostgreSQL1:\nRealizar consultas hacia PostgreSQL1 Ahora, podemos realizar consultas desde PostgreSQL2 hacia PostgreSQL1:\nConsultas simultáneas entre PostgreSQL1 y PostgreSQL2 Para simplificar consultas remotas entre ambas bases de datos, podemos crear vistas. Esto evita la necesidad de definir manualmente el tipo de cada campo en las consultas:\nLa misma consulta puede realizarse desde PostgreSQL1 hacia PostgreSQL2:\nConexión Heterogénea Oracle a MySQL Instalación del driver ODBC para MySQL Primero, descargamos el driver ODBC para MySQL junto con las dependencias necesarias:\nAccedemos a la página oficial de MySQL para descargar los drivers y proceder a su instalación:\nConfiguración de Heterogeneous Services en Oracle Accedemos al directorio hs/admin dentro de nuestra instalación de Oracle:\nEditamos el archivo initMYSQL.ora con el siguiente contenido para configurar Heterogeneous Services:\nConfiguración de ODBC para MySQL Configuramos ODBC para MySQL, asegurándonos de incluir las credenciales correctas para conectar con la base de datos MySQL:\nConfiguración del listener en Oracle Actualizamos la configuración del listener para incluir localhost y el puerto de escucha de Oracle:\nReiniciamos el servicio del listener de Oracle para aplicar los cambios:\nComprobación del driver ODBC Verificamos que el driver ODBC está funcionando correctamente conectándonos a la base de datos MySQL. También podemos utilizar el driver isql para comprobar la conexión:\nCreación del enlace entre Oracle y MySQL Creamos el enlace en Oracle para conectarnos a la base de datos MySQL:\nRealizar consultas entre Oracle y MySQL Podemos realizar una consulta sencilla hacia la base de datos MySQL:\nTambién es posible realizar consultas utilizando ambas bases de datos simultáneamente. Es importante encerrar en comillas dobles los nombres de los campos y tablas de MySQL para que sean interpretados correctamente:\nMysql a Oracle Oracle a PostgreSQL Nota: Para este apartado se utilizó una máquina con Oracle Linux 8 y Oracle Database 23.\nConfiguración previa en Oracle Como paso inicial, creamos nuevamente un usuario y base de datos en Oracle, asignando los permisos adecuados:\nInstalación del driver para PostgreSQL Instalamos el driver de PostgreSQL usando dnf. Este comando también instalará las librerías necesarias como dependencias:\nConfiguración del archivo odbcinst.ini El archivo /etc/odbcinst.ini se utiliza en sistemas Linux para configurar los controladores ODBC. Editamos este archivo para registrar el driver de PostgreSQL:\nConfiguración del archivo odbc.ini El archivo /etc/odbc.ini contiene configuraciones específicas para cada conexión a una base de datos. Aquí configuramos los detalles de la conexión a la base de datos PostgreSQL:\nConfiguración en Oracle para usar el driver Configuramos Oracle para que pueda utilizar el driver ODBC. Esto incluye actualizar los archivos necesarios para establecer la conexión:\nConfiguración del Listener en Oracle Configuramos el archivo del listener para habilitar la comunicación con la base de datos PostgreSQL:\nConfiguración del archivo tnsnames.ora Añadimos una entrada al archivo tnsnames.ora para definir la conexión a PostgreSQL:\nReinicio del Listener Reiniciamos el servicio del listener para aplicar los cambios:\nPrueba de conexión Verificamos la conectividad utilizando tnsping:\nAdemás, probamos la conexión utilizando el driver ODBC desde la terminal:\nCreación del enlace en Oracle Conectamos a Oracle y creamos el enlace a la base de datos PostgreSQL. En las consultas, los nombres de campos y tablas deben ir entre comillas dobles, y los valores entre comillas simples:\nConsultas simultáneas entre Oracle y PostgreSQL Podemos realizar consultas combinadas entre ambas bases de datos:\nPostgreSQL a Oracle Descarga e instalación de paquetes necesarios Desde la página oficial de Oracle descargaremos los siguientes paquetes requeridos:\nDado que el sistema utilizado es Debian, es necesario convertir los paquetes de formato RPM a DEB utilizando alien. El proceso tardará aproximadamente 5 minutos, y los paquetes se instalarán automáticamente al utilizar el parámetro -i:\nPrueba de conexión a Oracle Una vez instalados los paquetes, verificamos que es posible conectarse remotamente a la base de datos Oracle para garantizar que la configuración es correcta:\nDescarga y compilación de oracle_fdw El siguiente paso es instalar oracle_fdw, una extensión para PostgreSQL que permite conectarse a Oracle. Descargamos la versión más reciente desde el repositorio oficial:\nRepositorio: oracle_fdw en GitHub Clonamos el repositorio y compilamos el código fuente:\nDentro del directorio descargado, ejecutamos make para compilar:\nFinalmente, instalamos la extensión con el comando make install:\nConfiguración de PostgreSQL Creación de la extensión: Nos conectamos a la base de datos PostgreSQL donde queremos crear el enlace y configuramos la extensión oracle_fdw:\nCreación del esquema y servidor foráneo: Creamos un esquema llamado oracle y configuramos un servidor foráneo apuntando a la base de datos Oracle:\nMapeo de usuarios: Creamos un mapeo entre el usuario local de PostgreSQL (javiercruces1) y el usuario remoto de Oracle (javiercruces3). También otorgamos los permisos necesarios sobre el esquema y el servidor foráneo:\nImportación del esquema: Con el usuario local de PostgreSQL, importamos el esquema de tablas del usuario de Oracle hacia el servidor foráneo local:\nConsultas combinadas Finalmente, podemos realizar consultas que involucren datos de ambas bases de datos (PostgreSQL y Oracle). Esto permite trabajar con información distribuida de manera integrada:\n","date":"September 1, 2024","hero":"/images/base_de_datos/interconexion_de_servidores/interconexion_de_servidores.png","permalink":"https://www.javiercd.es/posts/base_de_datos/interconexion_de_servidores/interconexion_servidores/","summary":"\u003cp\u003eEste post aborda cómo configurar y gestionar conexiones entre diferentes bases de datos, tanto homogéneas como heterogéneas, para facilitar la interoperabilidad entre sistemas de bases de datos diversos. A lo largo del artículo, se exploran distintos escenarios de conexión, comenzando con configuraciones entre bases de datos del mismo tipo, como Oracle a Oracle o PostgreSQL a PostgreSQL, y luego avanzando hacia conexiones heterogéneas entre diferentes tecnologías, como Oracle a MySQL, PostgreSQL a Oracle, y viceversa. También se cubren los pasos necesarios para configurar enlaces, crear usuarios, y modificar archivos de configuración clave, permitiendo así realizar consultas remotas\u003c/p\u003e","tags":["Oracle","Mysql","PostgreSQL","Debian"],"title":"Interconexión de servidores de bases de datos"},{"categories":null,"contents":"\nEl objetivo de este post es comparar los distintos software de VPNs mas utilizados viendo cual es mas rápido , para ello nos apoyaremos en test de velocidad utilizando iperf3 .\n[!NOTE]\nLa comparativa parte de los post de esta sección en los que montamos cada tipo de VPN .\nVelocidad sin VPN Voy a comenzar comparando las velocidades de estos 2 sistemas , utilizando iperf3 . Para ello he quitado el router cisco ya que lo tenia configurado con interfaces FastEthernet y lo he cambiado por un router Linux con interfaces GigabitEthernet .\nVoy a lanzar un iperf3 utilizando las direcciones publicas para que el trafico no utilice ninguna VPN :\njaviercruces@servidor2:~$ iperf3 -c 90.0.0.2 -i 1 -t 30 Connecting to host 90.0.0.2, port 5201 [ 5] local 100.0.0.2 port 32858 connected to 90.0.0.2 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 110 MBytes 919 Mbits/sec 897 188 KBytes [ 5] 1.00-2.00 sec 102 MBytes 859 Mbits/sec 712 120 KBytes [ 5] 2.00-3.00 sec 111 MBytes 931 Mbits/sec 735 83.4 KBytes [ 5] 3.00-4.00 sec 112 MBytes 944 Mbits/sec 600 173 KBytes [ 5] 4.00-5.00 sec 109 MBytes 913 Mbits/sec 1018 126 KBytes [ 5] 5.00-6.00 sec 115 MBytes 961 Mbits/sec 889 113 KBytes [ 5] 6.00-7.00 sec 113 MBytes 947 Mbits/sec 549 90.5 KBytes [ 5] 7.00-8.00 sec 116 MBytes 976 Mbits/sec 964 198 KBytes [ 5] 8.00-9.00 sec 114 MBytes 956 Mbits/sec 591 76.4 KBytes [ 5] 9.00-10.00 sec 108 MBytes 908 Mbits/sec 736 120 KBytes [ 5] 10.00-11.00 sec 105 MBytes 881 Mbits/sec 689 126 KBytes [ 5] 11.00-12.00 sec 106 MBytes 893 Mbits/sec 745 124 KBytes [ 5] 12.00-13.00 sec 118 MBytes 990 Mbits/sec 847 93.3 KBytes [ 5] 13.00-14.00 sec 122 MBytes 1.03 Gbits/sec 899 94.7 KBytes [ 5] 14.00-15.00 sec 125 MBytes 1.05 Gbits/sec 1014 73.5 KBytes [ 5] 15.00-16.00 sec 125 MBytes 1.05 Gbits/sec 973 113 KBytes [ 5] 16.00-17.00 sec 109 MBytes 915 Mbits/sec 934 86.3 KBytes [ 5] 17.00-18.00 sec 101 MBytes 844 Mbits/sec 629 115 KBytes [ 5] 18.00-19.00 sec 105 MBytes 881 Mbits/sec 652 122 KBytes [ 5] 19.00-20.00 sec 116 MBytes 971 Mbits/sec 826 96.2 KBytes [ 5] 20.00-21.00 sec 115 MBytes 962 Mbits/sec 820 99.0 KBytes [ 5] 21.00-22.00 sec 128 MBytes 1.08 Gbits/sec 1193 99.0 KBytes [ 5] 22.00-23.00 sec 130 MBytes 1.09 Gbits/sec 1027 110 KBytes [ 5] 23.00-24.00 sec 123 MBytes 1.03 Gbits/sec 855 116 KBytes [ 5] 24.00-25.00 sec 122 MBytes 1.03 Gbits/sec 714 126 KBytes [ 5] 25.00-26.00 sec 120 MBytes 1.01 Gbits/sec 861 119 KBytes [ 5] 26.00-27.00 sec 129 MBytes 1.08 Gbits/sec 768 112 KBytes [ 5] 27.00-28.00 sec 125 MBytes 1.05 Gbits/sec 976 140 KBytes [ 5] 28.00-29.00 sec 116 MBytes 972 Mbits/sec 943 140 KBytes [ 5] 29.00-30.00 sec 119 MBytes 996 Mbits/sec 755 116 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-30.00 sec 3.39 GBytes 970 Mbits/sec 24811 sender [ 5] 0.00-30.00 sec 3.39 GBytes 970 Mbits/sec receiver La velocidad media de la red ha sido de 970 Mbits/sec , sin usar ninguna VPN .\nVelocidad de Wireguard Vemos a medir la velocidad de Wireguard :\njaviercruces@cliente3:~$ iperf3 -c 192.168.0.2 -i 1 -t 30 Connecting to host 192.168.0.2, port 5201 [ 5] local 192.168.1.2 port 39096 connected to 192.168.0.2 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 57.5 MBytes 483 Mbits/sec 63 196 KBytes [ 5] 1.00-2.00 sec 56.4 MBytes 473 Mbits/sec 37 190 KBytes [ 5] 2.00-3.00 sec 58.2 MBytes 488 Mbits/sec 85 188 KBytes [ 5] 3.00-4.00 sec 57.1 MBytes 479 Mbits/sec 65 140 KBytes [ 5] 4.00-5.00 sec 57.8 MBytes 485 Mbits/sec 6 199 KBytes [ 5] 5.00-6.00 sec 59.7 MBytes 500 Mbits/sec 62 200 KBytes [ 5] 6.00-7.00 sec 59.0 MBytes 495 Mbits/sec 26 234 KBytes [ 5] 7.00-8.00 sec 57.8 MBytes 485 Mbits/sec 13 216 KBytes [ 5] 8.00-9.00 sec 58.6 MBytes 492 Mbits/sec 88 151 KBytes [ 5] 9.00-10.00 sec 58.1 MBytes 487 Mbits/sec 13 174 KBytes [ 5] 10.00-11.00 sec 57.9 MBytes 486 Mbits/sec 22 135 KBytes [ 5] 11.00-12.00 sec 57.1 MBytes 479 Mbits/sec 30 188 KBytes [ 5] 12.00-13.00 sec 57.3 MBytes 481 Mbits/sec 19 178 KBytes [ 5] 13.00-14.00 sec 57.1 MBytes 479 Mbits/sec 15 230 KBytes [ 5] 14.00-15.00 sec 56.5 MBytes 474 Mbits/sec 20 218 KBytes [ 5] 15.00-16.00 sec 57.4 MBytes 481 Mbits/sec 38 172 KBytes [ 5] 16.00-17.00 sec 55.9 MBytes 469 Mbits/sec 137 143 KBytes [ 5] 17.00-18.00 sec 57.0 MBytes 478 Mbits/sec 26 246 KBytes [ 5] 18.00-19.00 sec 56.6 MBytes 475 Mbits/sec 42 183 KBytes [ 5] 19.00-20.00 sec 56.2 MBytes 471 Mbits/sec 43 222 KBytes [ 5] 20.00-21.00 sec 56.5 MBytes 474 Mbits/sec 11 203 KBytes [ 5] 21.00-22.00 sec 56.4 MBytes 473 Mbits/sec 69 147 KBytes [ 5] 22.00-23.00 sec 54.1 MBytes 454 Mbits/sec 25 163 KBytes [ 5] 23.00-24.00 sec 55.9 MBytes 469 Mbits/sec 54 207 KBytes [ 5] 24.00-25.00 sec 57.5 MBytes 482 Mbits/sec 99 164 KBytes [ 5] 25.00-26.00 sec 56.5 MBytes 474 Mbits/sec 39 182 KBytes [ 5] 26.00-27.00 sec 56.7 MBytes 476 Mbits/sec 24 150 KBytes [ 5] 27.00-28.00 sec 56.3 MBytes 472 Mbits/sec 6 219 KBytes [ 5] 28.00-29.00 sec 57.0 MBytes 478 Mbits/sec 15 146 KBytes [ 5] 29.00-30.00 sec 56.0 MBytes 470 Mbits/sec 48 151 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-30.00 sec 1.67 GBytes 479 Mbits/sec 1240 sender [ 5] 0.00-30.00 sec 1.67 GBytes 479 Mbits/sec receiver La velocidad media de wireguard ha sido de 479 Mbits/sec .\nVelocidad de OpenVPN Vamos a medir la velocidad de OpenVPN\njaviercruces@cliente3:~$ iperf3 -c 192.168.0.2 -i 1 -t 30 Connecting to host 192.168.0.2, port 5201 [ 5] local 192.168.1.2 port 43522 connected to 192.168.0.2 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 25.1 MBytes 211 Mbits/sec 24 139 KBytes [ 5] 1.00-2.00 sec 24.8 MBytes 208 Mbits/sec 15 163 KBytes [ 5] 2.00-3.00 sec 23.7 MBytes 199 Mbits/sec 40 103 KBytes [ 5] 3.00-4.00 sec 24.6 MBytes 207 Mbits/sec 19 114 KBytes [ 5] 4.00-5.00 sec 24.2 MBytes 203 Mbits/sec 8 119 KBytes [ 5] 5.00-6.00 sec 24.3 MBytes 204 Mbits/sec 14 155 KBytes [ 5] 6.00-7.00 sec 24.2 MBytes 203 Mbits/sec 13 139 KBytes [ 5] 7.00-8.00 sec 24.5 MBytes 206 Mbits/sec 18 115 KBytes [ 5] 8.00-9.00 sec 24.0 MBytes 201 Mbits/sec 34 132 KBytes [ 5] 9.00-10.00 sec 24.3 MBytes 204 Mbits/sec 32 120 KBytes [ 5] 10.00-11.00 sec 24.5 MBytes 206 Mbits/sec 12 100 KBytes [ 5] 11.00-12.00 sec 24.4 MBytes 205 Mbits/sec 8 139 KBytes [ 5] 12.00-13.00 sec 23.9 MBytes 201 Mbits/sec 6 171 KBytes [ 5] 13.00-14.00 sec 24.1 MBytes 202 Mbits/sec 20 156 KBytes [ 5] 14.00-15.00 sec 24.0 MBytes 202 Mbits/sec 8 135 KBytes [ 5] 15.00-16.00 sec 23.5 MBytes 197 Mbits/sec 21 143 KBytes [ 5] 16.00-17.00 sec 24.0 MBytes 202 Mbits/sec 8 168 KBytes [ 5] 17.00-18.00 sec 24.6 MBytes 206 Mbits/sec 24 154 KBytes [ 5] 18.00-19.00 sec 23.8 MBytes 200 Mbits/sec 21 132 KBytes [ 5] 19.00-20.00 sec 24.3 MBytes 204 Mbits/sec 20 139 KBytes [ 5] 20.00-21.00 sec 24.6 MBytes 206 Mbits/sec 11 142 KBytes [ 5] 21.00-22.00 sec 23.0 MBytes 193 Mbits/sec 26 115 KBytes [ 5] 22.00-23.00 sec 24.6 MBytes 207 Mbits/sec 3 128 KBytes [ 5] 23.00-24.00 sec 24.0 MBytes 202 Mbits/sec 26 104 KBytes [ 5] 24.00-25.00 sec 24.3 MBytes 204 Mbits/sec 21 106 KBytes [ 5] 25.00-26.00 sec 24.3 MBytes 204 Mbits/sec 15 108 KBytes [ 5] 26.00-27.00 sec 23.8 MBytes 200 Mbits/sec 36 132 KBytes [ 5] 27.00-28.00 sec 22.9 MBytes 192 Mbits/sec 13 118 KBytes [ 5] 28.00-29.00 sec 23.7 MBytes 199 Mbits/sec 19 163 KBytes [ 5] 29.00-30.00 sec 24.2 MBytes 203 Mbits/sec 11 126 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-30.00 sec 725 MBytes 203 Mbits/sec 546 sender [ 5] 0.00-30.00 sec 724 MBytes 202 Mbits/sec receiver La velocidad media ha sido 203 Mbits/sec .\nConclusiones Si comparamos los resultados, queda claro que en términos de velocidad, WireGuard ha demostrado ser la opción más eficiente, superando significativamente a OpenVPN , doblándolo en velocidad .\nWireGuard está diseñado para una velocidad rápida. Establece una conexión en 100 milisegundos, mientras que OpenVPN tarda 8 milisegundos. En algunas pruebas, WireGuard demostró ser un 58% más rápido que OpenVPN. En circunstancias ideales, su velocidad superó los 500 mbps.\nWireGuard es el protocolo más rápido debido a muchos factores. Estos incluyen:\nSu código ligero lo convierte intrínsecamente en el protocolo más rápido. WireGuard también admite el multithreading -procesar datos utilizando muchos núcleos de la CPU simultáneamente- y utiliza un método de cifrado más rápido. Además, WireGuard es bueno en el uso del ancho de banda disponible y opera completamente en el espacio del kernel. Para evitar la censura, OpenVPN es mejor que WireGuard. ¿Por qué? Porque el protocolo OpenVPN puede funcionar sobre las capas del Protocolo UPD y TCP.\nUDP es más rápido, mientras que TCP es fiable.TCP puede evitar la censura utilizando el puerto 443, el mismo puerto que utiliza HTTPS. Gracias a TCP, OpenVPN evita la censura de países estrictos como China y Rusia. En algunos casos, una inspección profunda avanzada puede detectar OpenVPN. Pero para estos casos, los expertos en seguridad recomiendan utilizar el Scramble dentro de la configuración avanzada del protocolo para añadir otra capa de protección al tráfico VPN.\nPor otro lado, WireGuard sólo utiliza la capa UDP para transportar datos. Y el propósito principal de UDP es transportar datos a gran velocidad, no eludir la censura. Esto hace que sea fácil de detectar. Además, es susceptible de inspección profunda de paquetes.\nOpenVPN es seguro si se configura adecuadamente. Este protocolo no tiene vulnerabilidades de seguridad conocidas, y su código ha sido auditado muchas veces. Además, tiene muchos cifrados y algoritmos de autenticación. Cuando se produce alguna vulnerabilidad de seguridad en el algoritmo, entonces OpenVPN puede configurar inmediatamente otra cosa.\nEn términos de casos de seguridad, WireGuard también se ha ganado una buena reputación. Es seguro y utiliza la última criptografía. Su código es corto y fácil de auditar. Además, WireGuard tiene un conjunto fijo de algoritmos y cifrados. Cuando se encuentra alguna vulnerabilidad, todos los puntos finales se actualizan a una nueva versión, lo que garantiza que nadie vuelva a utilizar código inseguro.\n","date":"March 28, 2024","hero":"/images/vpn/wire_ovpn.png","permalink":"https://www.javiercd.es/posts/vpn/comparativa_ovpn_wire/comparativa_ovpn_wire/","summary":"\u003cp\u003e\u003cimg src=\"/vpn/comparativa_ovpn_wire/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEl objetivo de este post es comparar los distintos software de VPNs mas utilizados viendo cual es mas rápido , para ello nos apoyaremos en test de velocidad utilizando iperf3 .\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nLa comparativa parte de los post de esta sección en los que montamos cada tipo de VPN .\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"velocidad-sin-vpn\"\u003eVelocidad sin VPN\u003c/h2\u003e\n\u003cp\u003eVoy a comenzar comparando las velocidades de estos 2 sistemas , utilizando iperf3 . Para ello he quitado el router cisco ya que lo tenia configurado con interfaces FastEthernet y lo he cambiado por un router Linux con interfaces GigabitEthernet .\u003c/p\u003e","tags":["VPN","LINUX","DEBIAN","WIREGUARD","OPENVPN"],"title":"Comparativa entre OpenVPN y Wireguard"},{"categories":null,"contents":"En un primer momento un alumno creará una Autoridad Certficadora y firmará un certificado para la página del otro alumno. Posteriormente lo pondremos a prueba en los servidores web Apache y Nginx\nCrear la Autoridad Certificadora Paso 1: Creación de directorios y archivos El primer paso será generar un directorio en el que ubicarás tu entidad certificadora, con la finalidad de mantener en todo momento una organización. El nombre del directorio será CA/. A su vez, hay que generar varios subdirectorios dentro del mismo:\ncertsdb: En dicho directorio se almacenarán los certificados firmados. certreqs: En dicho directorio se almacenarán los ficheros de solicitud de firma de certificados (CSR). crl: En dicho directorio se almacenará la lista de certificados que han sido revocados (CRL). private: En dicho directorio se almacenará la clave privada de la autoridad certificadora. debian@javiercrucesCA:~$ sudo mkdir /CA debian@javiercrucesCA:~$ cd !$ debian@javiercrucesCA:/CA$ sudo mkdir certsdb certreqs crl private debian@javiercrucesCA:/CA$ sudo chmod 700 private/ debian@javiercrucesCA:/CA$ sudo touch index.txt Una vez generados los directorios, muévete dentro del directorio padre CA/. Cuando te encuentres dentro del mismo, lista el contenido de forma gráfica para así poder apreciar que todo se ha generado correctamente, haciendo para ello uso de tree. Verás que los 4 directorios han sido correctamente generados. Antes de continuar es recomendable cambiar los permisos a 700 al directorio private/, ya que contendrá la clave privada de la CA y nos interesa que únicamente el propietario tenga acceso a la misma. Además, necesitaremos en el directorio actual un fichero que actuará como base de datos para los certificados existentes de nombre index.txt\ndebian@javiercrucesCA:/CA$ sudo tree -p [drwxr-xr-x] . ├── [drwxr-xr-x] certreqs ├── [drwxr-xr-x] certsdb ├── [drwxr-xr-x] crl ├── [-rw-r--r--] index.txt └── [drwx------] private 5 directories, 1 file debian@javiercrucesCA:/CA$ Paso 2: Fichero de configuración de openssl Lo más probable es que quieras usar un fichero de configuración de openssl que no sea el de nuestra máquina, para así tratar de que la autoridad certificadora esté en todo momento lo más aislada posible de la misma, así que haz una copia de tu fichero de configuración nativo y adáptalo a tus necesidades. Dicho fichero se encuentra normalmente en /usr/lib/ssl/openssl.cnf, aunque también podría estar en /etc/openssl.cnf o en /usr/share/ssl/openssl.cnf, tendrás que copiarlo al directorio actual y modificarlo con un editor de textos.\ndebian@javiercrucesCA:/CA$ sudo cp /usr/lib/ssl/openssl.cnf ./ debian@javiercrucesCA:/CA$ ls -l total 32 drwxr-xr-x 2 root root 4096 Jan 8 19:22 certreqs drwxr-xr-x 2 root root 4096 Jan 8 19:22 certsdb drwxr-xr-x 2 root root 4096 Jan 8 19:22 crl -rw-r--r-- 1 root root 0 Jan 8 19:23 index.txt -rw-r--r-- 1 root root 12332 Jan 8 19:26 openssl.cnf drwx------ 2 root root 4096 Jan 8 19:22 private Dentro del mismo, hay que realizar las oportunas adaptaciones para que haga uso de los directorios anteriormente generados, así como indicar determinada información básica sobre la autoridad certificadora, que vuestro compañero debe conocer, pues le será solicitada a la hora de la generación del fichero de solicitud de firma de certificado. Las modificaciones a realizar son las siguientes:\ndir = /root/CA certs = $dir/certsdb new_certs_dir = $certs\n[ CA_default ] dir = /CA # Where everything is kept certs = $dir/certsdb # Where the issued certs are kept crl_dir = $dir/crl # Where the issued crl are kept database = $dir/index.txt # database index file. #unique_subject = no # Set to \u0026#39;no\u0026#39; to allow creation of # several certs with same subject. new_certs_dir = $certs # default place for new certs. countryName_default = ES stateOrProvinceName_default = Sevilla localityName_default = Dos Hermanas 0.organizationName_default = IES Gonzalo Nazareno organizationalUnitName_default = Informatica\n[ req_distinguished_name ] countryName = Country Name (2 letter code) countryName_default = ES countryName_min = 2 countryName_max = 2 stateOrProvinceName = State or Province Name (full name) stateOrProvinceName_default = Sevilla localityName = Dos Hermanas 0.organizationName = Organization Name (eg, company) 0.organizationName_default = IES Gonzalo Nazareno # we can do this but it is not needed normally :-) #1.organizationName = Second Organization Name (eg, company) #1.organizationName_default = World Wide Web Pty Ltd organizationalUnitName = Organizational Unit Name (eg, section) organizationalUnitName_default = Informatica #challengePassword = A challenge password #challengePassword_min = 4 #challengePassword_max = 20 #unstructuredName = An optional company name\n[ req_attributes ] challengePassword = A challenge password challengePassword_min = 4 challengePassword_max = 20 unstructuredName = An optional company name Paso 3: Creación y firmado de nuestra propio certificado Tras ello, ya tendrás todo listo para generar tu par de claves y un fichero de solicitud de firma de certificado que posteriormente te autofirmarás, ejecutando para ello el comando:\ndebian@javiercrucesCA:/CA$ sudo openssl req -new -newkey rsa:4096 -keyout private/cakey.pem -out careq.pem -config ./openssl.cnf Enter PEM pass phrase: Verifying - Enter PEM pass phrase: ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Country Name (2 letter code) [ES]:ES State or Province Name (full name) [Sevilla]:Sevilla Dos Hermanas []: Organization Name (eg, company) [IES Gonzalo Nazareno]: Organizational Unit Name (eg, section) [Informatica]: Common Name (e.g. server FQDN or YOUR name) []:javiercruces.iesgn.org Email Address []:javierasping@gmail.com Como puedes ver, se solicita una frase de paso para proteger la clave privada que vamos a generar, así como determinada información básica para el fichero de solicitud de firma de certificado, que debe coincidir con la que anteriormente hemos introducido en el fichero de configuración de openssl. Los dos últimos campos no son genéricos, por lo que debemos rellenarlos según el caso. Tras ello, ya podremos proceder a autofirmarnos el certificado, que es el que posteriormente tendremos que facilitar a los clientes para que incluyan en su lista de certificados de CA, para que así no se les muestre la advertencia al utilizar HTTPS. Como he mencionado anteriormente, en una situación real, este proceso lo suelen llevar a cabo empresas con determinada reputación cuyo certificado se encuentra importado por defecto en los navegadores. Para ello, ejecuta el comando:\ndebian@javiercrucesCA:/CA$ sudo openssl ca -create_serial -out cacert.pem -days 365 -keyfile private/cakey.pem -selfsign -extensions v3_ca -config ./openssl.cnf -infiles careq.pem Using configuration from ./openssl.cnf Enter pass phrase for private/cakey.pem: Check that the request matches the signature Signature ok Certificate Details: Serial Number: 74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f2 Validity Not Before: Jan 8 19:57:17 2024 GMT Not After : Jan 7 19:57:17 2025 GMT Subject: countryName = ES stateOrProvinceName = Sevilla organizationName = IES Gonzalo Nazareno organizationalUnitName = Informatica commonName = javiercruces.iesgn.org emailAddress = javierasping@gmail.com X509v3 extensions: X509v3 Subject Key Identifier: E3:9C:A3:CF:0E:33:EB:83:45:40:00:9B:04:4A:A9:9B:C8:8C:A9:62 X509v3 Authority Key Identifier: E3:9C:A3:CF:0E:33:EB:83:45:40:00:9B:04:4A:A9:9B:C8:8C:A9:62 X509v3 Basic Constraints: critical CA:TRUE Certificate is to be certified until Jan 7 19:57:17 2025 GMT (365 days) Sign the certificate? [y/n]:y 1 out of 1 certificate requests certified, commit? [y/n]y Write out database with 1 new entries Data Base Updated debian@javiercrucesCA:/CA$ Donde:\ncreate_serial: Indicamos que genere un serial de 128 bits para comenzar. Gracias a dicha aleatoriedad, si tuviésemos que volver a empezar, no sobreescribiríamos los ya existentes. Es muy importante. out: Especificamos dónde se va a almacenar el certificado firmado. En este caso, en el directorio actual, con nombre cacert.pem. days: Especificamos la validez en días del certificado firmado. En este caso, 365 días. keyfile: Indicamos la clave privada a usar para firmar dicho certificado. En este caso, la generada en el paso anterior, private/cakey.pem. selfsign: Indicamos a openssl que vamos a autofirmarnos el certificado. extensions: Indicamos a openssl la sección del fichero de configuración en el que se encuentran las extensiones a usar. En este caso, v3_ca. config: Especificamos a openssl que utilice el fichero de configuración modificado, no el nativo, con nombre openssl.cnf. infiles: Indicamos qué queremos firmar, en este caso, el CSR para nuestra nueva autoridad certificadora creado en el paso anterior, con nombre careq.pem. Como se puede apreciar en la salida del comando, se nos ha pedido la frase de paso previamente configurada, para así asegurarnos que aunque la clave privada llegase a malas manos, no puedan realizar firmas fraudulentas. Además, antes de firmar el certificado, se nos ha mostrado toda la información referente al mismo, y se nos ha pedido confirmación. Para verificar que el certificado de la autoridad certificadora se encuentra contenido en el directorio actual, lista el contenido del mismo y comprueba que, efectivamente, existe un fichero cacert.pem que es resultado de firmar el fichero de solicitud de firma de certificado careq.pem.\ndebian@javiercrucesCA:/CA$ sudo tree . ├── cacert.pem ├── careq.pem ├── certreqs ├── certsdb │ └── 741E8AF82445149E28F183047C7D6C0F5F3BACF2.pem ├── crl ├── index.txt ├── index.txt.attr ├── index.txt.old ├── openssl.cnf ├── private │ └── cakey.pem └── serial 5 directories, 9 files debian@javiercrucesCA:/CA$ Paso 4: Firma de solicitudes de certificado Ya está todo listo para proceder a firmar el certificado para el servidor de tu compañero, así que debes situar su fichero de solicitud de firma de certificado dentro de certreqs/, que es donde deben ubicarse.\ndebian@javiercrucesCA:~$ sudo ls -l /CA/certreqs/ total 4 -rw-r--r-- 1 root root 1785 Jan 11 10:00 peperc.csr Puedes proceder a firmarlo, haciendo uso del comando:\ndebian@javiercrucesCA:/CA$ sudo openssl ca -config openssl.cnf -extensions v3_req -days 3650 -notext -md sha256 -in certreqs/peperc.csr -out certsdb/pepe.csr.pem Using configuration from openssl.cnf Enter pass phrase for /CA/private/cakey.pem: Check that the request matches the signature Signature ok Certificate Details: Serial Number: 74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f3 Validity Not Before: Jan 11 10:01:58 2024 GMT Not After : Jan 8 10:01:58 2034 GMT Subject: countryName = ES stateOrProvinceName = Sevilla organizationName = IES Gonzalo Nazareno commonName = pfoter15 emailAddress = pepepfoter15@gmail.com X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Key Usage: Digital Signature, Non Repudiation, Key Encipherment Certificate is to be certified until Jan 8 10:01:58 2034 GMT (3650 days) Sign the certificate? [y/n]:y 1 out of 1 certificate requests certified, commit? [y/n]y Write out database with 1 new entries Database updated Donde:\nconfig: Especificamos a openssl que utilice el fichero de configuración modificado, no el nativo, con nombre openssl.cnf. out: Especificamos dónde se va a almacenar el certificado firmado. En este caso, dentro del directorio certsdb/, con nombre nombre.crt. infiles: Indicamos qué queremos firmar, en este caso, el CSR de nuestro compañero, situado en certreqs/ con nombre nombre.csr. En un principio, el certificado ya se encuentra firmado dentro de certsdb/, así que para verificarlo, vas a listar el contenido de dicho directorio.\nDeben existir un total de 3 ficheros dentro del mismo: uno correspondiente al propio certificado de la autoridad certificadora, y dos correspondientes a tu compañero, que son exactamente lo mismo pero con diferentes nombres, uno de ellos con un identificador y el otro, con un nombre común que nosotros hemos establecido para así identificarlo con una mayor facilidad.\ndebian@javiercrucesCA:~$ sudo ls -l /CA/certsdb/ total 16 -rw-r--r-- 1 root root 7429 Jan 8 19:57 741E8AF82445149E28F183047C7D6C0F5F3BACF2.pem -rw-r--r-- 1 root root 2139 Jan 11 10:02 741E8AF82445149E28F183047C7D6C0F5F3BACF3.pem -rw-r--r-- 1 root root 2139 Jan 11 10:02 pepe.csr.pem Paso 5: Envío de certificados al servidor web. Hasta aquí ha llegado tu parte, ya que únicamente quedaría hacerle llegar a tu compañero el fichero certsdb/nombre.crt, que es su certificado firmado, junto al propio certificado de la autoridad certificadora, el cuál contiene la clave pública, para así poder verificar dicha firma sobre su certificado, de nombre cacert.pem. Por último, vas a mostrar el contenido del fichero index.txt, que es una especie de base de datos en texto plano con información sobre los certificados firmados por la autoridad certificadora. Dentro del mismo, encontramos información básica correspondiente a los dos certificados firmados: el de la propia autoridad certificadora y el de nuestro compañero, además de su estado de validez actual.\nVoy a enviar y a traerme de la instancia de pepe las diferentes ficheros , el ha configurado mi clave publica para que pueda conectarme :\ndebian@javiercrucesCA:~$ scp javiercd.csr 172.22.200.113:/home/debian/ javiercd.csr 100% 1886 839.4KB/s 00:00 debian@javiercrucesCA:~$ scp 172.22.200.113:/home/debian/peperc.csr ./ peperc.csr 100% 1785 432.6KB/s 00:00 -- Le envio su certificado firmado debian@javiercrucesCA:~$ scp 172.22.200.113:/CA/certsdb/pepe.csr.pem pepe.csr.pem 100% 1785 432.6KB/s 00:00 debian@javiercrucesCA:~$ scp /CA/cacert.pem 172.22.200.113:/home/debian/pub_javi.pem cacert.pem 100% 7429 582.6KB/s 00:00 debian@javiercrucesCA:~$ scp 172.22.200.113:/CA/cacert.pem ./pub_pepe.pem cacert.pem 100% 7389 1.2MB/s 00:00 Tarea 2: Configurar HTTPS Paso 1: Creación de clave y solicitud de certificado. Lo primero que tendrás que hacer es crear una solicitud de firma de certificado (CSR o Certificate Signing Request) y hacérselo llegar a tu compañero. En este caso, vamos a hacerlo con openssl, pero se podría hacer con otras múltiples opciones de software.\nPara crear una solicitud de firma de certificado, primero debemos tener una clave privada que se asociará al mismo, así que generaremos una clave privada RSA de 4096 bits, que será almacenada en /etc/ssl/private/, ejecutando para ello el comando:\ndebian@javiercrucesCA:~$ sudo openssl genrsa 4096 \u0026gt; javiercd.key debian@javiercrucesCA:~$ sudo mv javiercd.key /etc/ssl/private/ Una vez generada, cambiaremos los permisos de la misma a 400, de manera que únicamente el propietario pueda leer el contenido, pues se trata de una clave privada. Este paso no es obligatorio pero sí recomendable por seguridad. Escribe el comando necesario para ello.\ndebian@javiercrucesCA:~$ sudo chmod 400 /etc/ssl/private/javiercd.key Tras ello, crearemos un fichero .csr de solicitud de firma de certificado para que sea firmado por la autoridad certificadora (CA) creada por nuestro compañero. Dicho fichero no contiene información confidencial, así que no importará la ruta donde lo almacenemos ni los permisos asignados. En mi caso, lo almacenaré en el directorio actual, ejecutando para ello el comando openssl req, con las opciones:\nnew: Indicamos que la creación de la solicitud de firma de certificado sea interactiva, pues nos pedirá determinados parámetros. key: Indicamos la clave privada a asociar a dicha solicitud de firma de certificado. En este caso, la generada en el paso anterior, /etc/ssl/private/tunombre.key. out: Especificamos dónde se va a almacenar la solicitud de firma de certificado. En este caso, en el directorio actual, con nombre tunombre.csr. Durante la ejecución, nos pedirá una serie de valores para identificar al certificado, que tendremos que rellenar conforme a la configuracion que hemos realizado en la unidad certificadora .\nDicha información nos la tendrá que dar la autoridad certificadora, excepto los dos últimos valores, que en el caso del Common Name, pondrás el FQDN de la web en la que queremos configurar HTTPS. Además, tendrás que introducir tu correo electrónico en el apartado Email Address.\ndebian@javiercrucesCA:/CA$ sudo openssl ca -config openssl.cnf -extensions v3_req -days 3650 -notext -md sha256 -in certreqs/peperc.csr -out certsdb/pepe.csr.pem Using configuration from openssl.cnf Enter pass phrase for /CA/private/cakey.pem: Check that the request matches the signature Signature ok Certificate Details: Serial Number: 74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f3 Validity Not Before: Jan 11 10:01:58 2024 GMT Not After : Jan 8 10:01:58 2034 GMT Subject: countryName = ES stateOrProvinceName = Sevilla organizationName = IES Gonzalo Nazareno commonName = pfoter15 emailAddress = pepepfoter15@gmail.com X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Key Usage: Digital Signature, Non Repudiation, Key Encipherment Certificate is to be certified until Jan 8 10:01:58 2034 GMT (3650 days) Sign the certificate? [y/n]:y 1 out of 1 certificate requests certified, commit? [y/n]y Write out database with 1 new entries Database updated Para verificar que el fichero de solicitud de firma ha sido correctamente generado, lista el contenido del directorio actual. Debe existir un fichero de nombre tunombre.csr que debes enviar a tu compañero, para que así sea firmado por la correspondiente autoridad certificadora que ha creado.\ndebian@javiercrucesCA:~$ ls -l total 16 -rw-r--r-- 1 root root 1886 Jan 11 09:40 javiercd.csr En mi caso se lo haré llegar usando SCP :\ndebian@javiercrucesCA:~$ scp javiercd.csr 172.22.200.113:/home/debian/ javiercd.csr 100% 1886 839.4KB/s 00:00 Una vez firmado me lo traeré de su servidor\nPaso 2: Almacenamiento de certificados en el servidor Además de dicho certificado firmado, nos debe enviar la clave pública de la entidad certificadora, es decir, el certificado de la misma, para así poder verificar su firma sobre nuestro certificado. Almacena ambos ficheros en /etc/ssl/certs/ y lista el contenido de dicho directorio.\ndebian@javiercrucesCA:~$ sudo mv javiercd.csr.pem /etc/ssl/certs/ debian@javiercrucesCA:~$ sudo mv pub_pepe.pem /etc/ssl/certs Debe existir un fichero de nombre tunombre.crt que es el resultado de la firma de la solicitud de firma de certificado que previamente le hemos enviado, y otro de nombre cacert.pem, que es el certificado de la entidad certificadora, con el que posteriormente se comprobará la firma de la autoridad certificadora sobre dicho certificado del servidor.\ndebian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/certs | grep javi -rw-r--r-- 1 debian debian 2175 Jan 11 10:05 javiercd.csr.pem debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/certs | grep pepe -rw-r--r-- 1 root root 7389 Jan 11 11:24 pub_pepe.pem debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/private/ total 8 -r-------- 1 debian debian 3272 Jan 11 09:37 javiercd.key Paso 3: Configuración de Apache Al igual que apache2 incluía un VirtualHost por defecto para las peticiones entrantes por el puerto 80 (HTTP), contiene otro por defecto para las peticiones entrantes por el puerto 443 (HTTPS), de nombre default-ssl, que por defecto viene deshabilitado, así que procederemos a modificarlo teniendo en cuenta las siguientes directivas:\nServerName: Al igual que en el VirtualHost anterior, tendremos que indicar el nombre de dominio a través del cuál accederemos al servidor. SSLEngine: Activa el motor SSL, necesario para hacer uso de HTTPS, por lo que su valor debe ser on. SSLCertificateFile: Indicamos la ruta del certificado del servidor firmado por la CA. En este caso, /etc/ssl/certs/tunombre.crt. SSLCertificateKeyFile: Indicamos la ruta de la clave privada asociada al certificado del servidor. En este caso, /etc/ssl/private/tunombre.key. SSLCACertificateFile: Indicamos la ruta del certificado de la CA con el que comprobaremos la firma de nuestro certificado. En este caso, /etc/ssl/certs/cacert.pem. debian@javiercrucesCA:/CA$ sudo a2enmod ssl debian@javiercrucesCA:/CA$ sudo a2ensite default-ssl.conf debian@javiercrucesCA:~$ sudo cat /etc/apache2/sites-available/default-ssl.conf \u0026lt;VirtualHost *:80\u0026gt; ServerName javiercruces.iesgn.org Redirect permanent / https://javiercruces.iesgn.org/ \u0026lt;/VirtualHost\u0026gt; \u0026lt;VirtualHost *:443\u0026gt; ServerAdmin webmaster@localhost ServerName javiercruces.iesgn.org DocumentRoot /var/www/html ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined SSLEngine on SSLCertificateFile /etc/ssl/certs/javiercd.csr.pem SSLCertificateKeyFile /etc/ssl/private/javiercd.key \u0026lt;/VirtualHost\u0026gt; debian@javiercrucesCA:~$ sudo systemctl reload apache2.service Demostración :\nPaso 4: Configuración de Nginx Vamos a forzar la configuración de https en Nginx\nAquí te dejo la configuración del virtualhost :\ndebian@javiercrucesCA:/var/www/sad$ sudo cat /etc/nginx/sites-available/default server { listen 80; listen [::]:80; server_name javiercruces.iesgn.org; # Redirección a HTTPS return 301 https://$host$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; root /var/www/sad; index index.php index.html index.htm; server_name moodle.javiercd.es; ssl_certificate /etc/ssl/certs/javiercd.csr.pem; ssl_certificate_key /etc/ssl/private/javiercd.key; } ","date":"March 28, 2024","hero":"/images/seguridad/certificados_ssl.png","permalink":"https://www.javiercd.es/posts/seguridad/https_autofirmado/https_autofirmado/","summary":"\u003cp\u003eEn un primer momento un alumno creará una Autoridad Certficadora y firmará un certificado para la página del otro alumno. Posteriormente lo pondremos a prueba en los servidores web Apache y Nginx\u003c/p\u003e\n\u003ch2 id=\"crear-la-autoridad-certificadora\"\u003eCrear la Autoridad Certificadora\u003c/h2\u003e\n\u003ch3 id=\"paso-1-creación-de-directorios-y-archivos\"\u003ePaso 1: Creación de directorios y archivos\u003c/h3\u003e\n\u003cp\u003eEl primer paso será generar un directorio en el que ubicarás tu entidad certificadora, con la finalidad de mantener en todo momento una organización. El nombre del directorio será CA/. A su vez, hay que generar varios subdirectorios dentro del mismo:\u003c/p\u003e","tags":["LINUX","DEBIAN","HTTPS"],"title":"Crear autoridad certificadora (CA) y certificados autofirmados en Linux"},{"categories":null,"contents":"Equivalencia de GUI a CLI Inicialmente, empecé la práctica utilizando la línea de comandos (CLI) sin embargo, encontré que resulta más cómodo realizarla desde la interfaz gráfica. Por eso, decidí establecer una equivalencia entre las diferentes acciones que he llevado a cabo durante la práctica y compararlas con su contraparte en la terminal.\n[!NOTE]\nEn este post hago un pequeño resumen de las equivalencias entre la GUI y la CLI de Fortinet que he utilizado en los 2 post de cortafuegos Fortinet.\nConfigurar una interfaz Como ya tenemos el cortafuegos configurado tenemos 2 opciones a la hora de ver la configuración de una determinada interfaz .\nVer la configuración de todas las interfaces :\nshow system interface O especificar una en concreto :\nshow system interface port1 Si observamos la configuración de las tres interfaces que he establecido durante la práctica, podemos notar que la sintaxis es muy sencilla. Prácticamente, incluso sin tener conocimientos previos sobre el tema, es fácil de comprender.\nFTG # show system interface config system interface edit \u0026#34;port1\u0026#34; set vdom \u0026#34;root\u0026#34; set ip 192.168.122.77 255.255.255.0 set allowaccess https http fgfm set type physical set alias \u0026#34;WAN\u0026#34; set lldp-reception enable set role wan set snmp-index 1 next edit \u0026#34;port2\u0026#34; set vdom \u0026#34;root\u0026#34; set ip 192.168.100.1 255.255.255.0 set allowaccess ping https ssh http fgfm set type physical set alias \u0026#34;LAN\u0026#34; set device-identification enable set lldp-transmission enable set monitor-bandwidth enable set role lan set snmp-index 2 next edit \u0026#34;port3\u0026#34; set vdom \u0026#34;root\u0026#34; set ip 192.168.200.1 255.255.255.0 set type physical set alias \u0026#34;DMZ\u0026#34; set device-identification enable set lldp-transmission enable set role lan set snmp-index 3 next Como puedes ver en la interfaz puerto 1 que es la que corresponde a la WAN , anteriormente desactive el acceso para configurarlo desde esta interfaz , pero por comodidad lo he dejado activado para usar el navegador de mi portátil .\nUna configuración que nos puede interesar es configurar una interfaz por DHCP , en mi caso lo haré en el puerto 4 :\n# Accedemos al modo de configuración FTG # config system interface # Seleccionamos la interfaz 4 FTG (interface) # edit \u0026#34;port4\u0026#34; # La ponemos en modo DHCP FTG (port4) # set mode dhcp # Salimos del modo de configuración FTG (port4) # end Ahora si listamos la configurar de la interfaz se habrá aplicado el cambio :\nFTG # show system interface port4 config system interface edit \u0026#34;port4\u0026#34; set vdom \u0026#34;root\u0026#34; set mode dhcp set type physical set snmp-index 4 next end En este punto, observamos que los comandos que hemos utilizado coinciden con los que el sistema muestra al listar la configuración.\nAhora, lo que nos interesa es conocer la dirección IP de nuestra interfaz. Si deseamos listar todas las direcciones IP asignadas, simplemente no especificamos el nombre de la interfaz. En mi caso, me interesa saber la dirección IP de la interfaz del puerto 4:\nFTG # get system interface physical port4 == [onboard] ==[port4] mode: dhcp ip: 192.168.122.121 255.255.255.0 ipv6: ::/0 status: up speed: 1000Mbps (Duplex: full) FEC: none FEC_cap: none Esto es lo básico que necesitamos para comenzar a configurar las interfaces . Te dejo un enlace a la documentación oficial donde explica todos los detalles .\nPolíticas Lo siguiente que hemos realizado en la practica es crear reglas desde la CLI , así que comenzare listando las reglas existentes , recuerda que en la versión de prueba tenemos un limite de 10 reglas simultaneas así que he eliminado algunas reglas durante la realización de la misma .\nPara hacer la salida mas legible vamos a ver una regla \u0026ldquo;normal\u0026rdquo; y otra de DNAT para compararlas :\nFTG # show firewall policy config firewall policy edit 1 set name \u0026#34;LAN_WAN_SSH\u0026#34; set uuid 57bba290-e881-51ee-3bbe-3ba5903773ed set srcintf \u0026#34;port2\u0026#34; set dstintf \u0026#34;port1\u0026#34; set action accept set srcaddr \u0026#34;all\u0026#34; set dstaddr \u0026#34;all\u0026#34; set schedule \u0026#34;always\u0026#34; set service \u0026#34;SSH\u0026#34; set nat enable next edit 5 set name \u0026#34;WAN_LAN_DNAT_SSH\u0026#34; set uuid bdd84292-e884-51ee-a5d3-20eabb2fd433 set srcintf \u0026#34;port1\u0026#34; set dstintf \u0026#34;port2\u0026#34; set action accept set srcaddr \u0026#34;all\u0026#34; set dstaddr \u0026#34;DNAT_SSH\u0026#34; set schedule \u0026#34;always\u0026#34; set service \u0026#34;SSH\u0026#34; set utm-status enable set ssl-ssh-profile \u0026#34;certificate-inspection\u0026#34; set ips-sensor \u0026#34;block_xmas\u0026#34; set nat enable next Vemos que la salida es bastante clara , si nos paramos a ver los parámetros comunes :\nname: Nombre que le queremos dar a la regla . UUID: Un identificador único que le asigna automáticamente el FW a cada regla . srcintf: Interfaz de origen (Por donde entra el trafico) dstintf: Interfaz de origen (Por donde entra el trafico) action: Que acción queremos que haga la regla accept | deny . srcaddr: Dirección de origen dstaddr: Dirección de destino schedule: Programación de la regla , por si es una regla temporal esta solo estará activa durante cierto tiempo . service: Nombre del servicio (Va asignado a un numero de puerto) nat: Si queremos que la regla haga SNAT . Esto seria la sintaxis básica de cada regla como ves entre una regla \u0026ldquo;normal\u0026rdquo; y una de DNAT lo único que cambia es la dirección del trafico y la IP de destino que en este dispositivo es una IP virtual .\nSi queremos borrar una regla , haremos lo siguiente :\n# Accedemos al modo de configuracion de las politicas de seguridad FTG # config firewall policy # Borraremos la regla segun el id de la misma FTG (policy) # delete 2 # Salimos de la configuracion FTG (policy) # end Para añadir una nueva regla, la sintaxis es similar a cuando listamos las reglas, pero necesitamos especificar un número de identificación (ID) al crearla. Es recomendable que sepas el número de la última regla que añadiste. Si no indicas un número, no se creará una nueva regla.\nFTG#config firewall policy FTG (policy) # edit 12 new entry \u0026#39;12\u0026#39; added FTG (12) # set name \u0026#34;LAN_WAN_DNS\u0026#34; FTG (12) # set srcintf \u0026#34;port2\u0026#34; FTG (12) # set dstintf \u0026#34;port1\u0026#34; FTG (12) # set action accept FTG (12) # set srcaddr \u0026#34;all\u0026#34; FTG (12) # set dstaddr \u0026#34;Google_DNS\u0026#34; FTG (12) # set schedule \u0026#34;always\u0026#34; FTG (12) # set service \u0026#34;DNS\u0026#34; FTG (12) # set nat enable FTG (12) # next FTG (policy) # end Hay muchísimas mas opciones que ignoro que no ha sido necesarias utilizarlas en la practica , te dejo un enlace a la documentación oficial donde detalla todas las distintas opciones .\nServicios Los servicios son unos objetos los cuales almacenan un numero o conjunto de puertos los cuales posteriormente utilizaras al crear reglas .Aunque estos dispositivos vienen con los servicios mas comunes de fabrica , muchas veces es necesario que creemos uno nuevo acorde a nuestras necesidades .\nAl igual que con los comandos anteriores de listar , podemos listar todos los servicios o uno en concreto :\nFTG # show firewall service custom config firewall service custom edit \u0026#34;DNS\u0026#34; set category \u0026#34;Network Services\u0026#34; set tcp-portrange 53 set udp-portrange 53 next edit \u0026#34;HTTP\u0026#34; set category \u0026#34;Web Access\u0026#34; set tcp-portrange 80 next edit \u0026#34;HTTPS\u0026#34; set category \u0026#34;Web Access\u0026#34; set tcp-portrange 443 next FTG # show firewall service custom SSH_2222 config firewall service custom edit \u0026#34;SSH_2222\u0026#34; set category \u0026#34;Remote Access\u0026#34; set tcp-portrange 2222 next end Para borrar un servicio , seguiremos los siguientes pasos :\n# Accedemos a la configuración de los servicios FTG # config firewall service custom # Borramos el servicio indicando el nombre FTG (custom) # delete SSH_2222 # Salimos del modo de configuración FTG (custom) # end Si queremos crearlo seguiremos los siguientes pasos :\n# Accedemos a la configuración de los servicios FTG # config firewall service custom # Le asignamos un nombre FTG (custom) # edit SSH_2222 # Opcionalmente lo añadimos a una categoria FTG (SSH_2222) # set category \u0026#34;Remote Access\u0026#34; # Indicamos los puertos que hace referencia al mismo FTG (SSH_2222) # set tcp-portrange 2222 # Guardamos y salimos del modo de confuguración FTG (SSH_2222) # next FTG (custom) # end Te dejo un enlace a la documentación oficial referente a los servicios donde explica con detalle todas las opciones de los mismos .\nIPs Virtuales Las IP Virtuales Estáticas (VIP) se utilizan para mapear direcciones IP externas a direcciones IP internas. Esto también se llama DNAT, donde el destino de un paquete se está enviando a una dirección diferente.\nLas VIP estáticas se utilizan comúnmente para mapear direcciones IP públicas a recursos detrás del FortiGate que utilizan direcciones IP privadas. Una VIP estática uno a uno es cuando se mapea todo el rango de puertos. Una VIP de reenvío de puertos es cuando el mapeo se configura en un puerto específico o rango de puertos.\nSi queremos listar las diferentes IPs virtuales que tenemos usaremos el siguiente comando , si solo queremos listar una en concreta indicaremos su nombre :\nFTG # show firewall vip config firewall vip edit \u0026#34;DNAT_POSTFIX\u0026#34; set uuid a343ec4a-e881-51ee-0ec1-ad73db3ff299 set service \u0026#34;SMTP\u0026#34; set extip 192.168.100.1 set mappedip \u0026#34;192.168.200.2\u0026#34; set extintf \u0026#34;port2\u0026#34; next edit \u0026#34;DNAT_SSH\u0026#34; set uuid a2b62344-e884-51ee-1a11-8946fda2bd91 set service \u0026#34;SSH_2222\u0026#34; set extip 192.168.122.77 set mappedip \u0026#34;192.168.100.2\u0026#34; set extintf \u0026#34;port1\u0026#34; set portforward enable set mappedport 22 next FTG # show firewall vip DNAT_HELA_WEB config firewall vip edit \u0026#34;DNAT_HELA_WEB\u0026#34; set uuid a417a8f8-edf6-51ee-f601-43829c174966 set service \u0026#34;HTTP\u0026#34; set extip 192.168.122.77 set mappedip \u0026#34;192.168.200.2\u0026#34; set extintf \u0026#34;port1\u0026#34; next end En el caso de que queramos eliminar una de estas IPs virtuales , seguiremos los siguientes pasos :\n# Accedemos al modo de configuración FTG # config firewall vip # Borramos la IP virtual indicando su nombre FTG (vip) # delete DNAT_HELA_WEB # Salimos del modo de configuración FTG (vip) # end Por otro lado para crear una de estas , como hemos realizado desde la GUI seguiremos los siguientes pasos :\n# Accedemos al modo de configuración FTG # config firewall vip # Le asignamos el nombre que deseemos FTG (vip) # edit DNAT_HELA_WEB # Indicamos opcionalmente sobre el servicio que sera usado esta IP virtual FTG (DNAT_HELA_WEB) # set service \u0026#34;HTTP\u0026#34; # Indicamos la Ip externa FTG (DNAT_HELA_WEB) # set extip 192.168.122.77 # Indicamos la Ip interna FTG (DNAT_HELA_WEB) # set mappedip \u0026#34;192.168.200.2\u0026#34; # Indicamos la interfaz externa FTG (DNAT_HELA_WEB) # set extintf \u0026#34;port1\u0026#34; # Guardamos y salimos FTG (DNAT_HELA_WEB) # next FTG (vip) # end Las IP virtuales tienen mas parámetros de configuración que no he utilizado en la practica , te dejo un enlace a la documentación oficial donde detalla toda la configuración que podemos acceder con las mismas .\nRutas estáticas Nuestro dispositivo necesita conocer hacia donde enviar el trafico , para esto existen las rutas estáticas .\nPara listar las rutas que tiene configurado nuestro cortafuegos , usaremos el siguiente comando :\nFTG # show router static config router static edit 1 set gateway 192.168.122.1 set device \u0026#34;port1\u0026#34; next end Al igual que hemos hecho anteriormente , si queremos eliminar esta ruta por defecto seguiremos los siguientes pasos :\nFTG # config router static FTG (static) # delete 1 FTG (static) # end Si queremos añadir una ruta , puedes utilizar este ejemplo :\nFTG # config router static FTG (static) # edit 1 # El siguiete salto o puerta de enlace FTG (1) # set gateway 192.168.122.1 # La interfaz por donde saldra el trafico FTG (1) # set device \u0026#34;port1\u0026#34; FTG (1) # next FTG (static) # end ","date":"March 28, 2024","hero":"/images/cortafuegos/fortinet_cli.png","permalink":"https://www.javiercd.es/posts/cortafuegos/fortinet_cli/fortinet_cli/","summary":"\u003ch2 id=\"equivalencia-de-gui-a-cli\"\u003eEquivalencia de GUI a CLI\u003c/h2\u003e\n\u003cp\u003eInicialmente, empecé la práctica utilizando la línea de comandos (CLI) sin embargo, encontré que resulta más cómodo realizarla desde la interfaz gráfica. Por eso, decidí establecer una equivalencia entre las diferentes acciones que he llevado a cabo durante la práctica y compararlas con su contraparte en la terminal.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nEn este post hago un pequeño resumen de las equivalencias entre la GUI y la CLI de Fortinet que he utilizado en los 2 post de cortafuegos Fortinet.\u003c/p\u003e","tags":["FIREWALL","FORTINET"],"title":"Fortinet CLI"},{"categories":null,"contents":"Antes de comenzar la practica , el escenario que ves en la practica es lo mas parecido que puedo montar a la practica original . He utilizado la versión 7.0.9-1 de FortiGate , ya que las versiones superiores traen algunas restricciones . Puedes descargarte la imagen desde este link .\nPuesta en marcha del cortafuegos Los dispositivos FortiGate vienen configurados de fabrica con la IP 192.168.1.99/24 , como estoy desde GNS3 no es necesario que me conecte a esta interfaz con un dispositivo y cambie la configuración . Ya que puedo hacerlo desde la consola .\nPor defecto a través de ese puerto esta habilitada la administración por http , https , ssh y telnet .\nEn mi caso me conectare desde la consola , le cambiare el hostname y configurare el puerto 1 para que coja IP por DHCP .\nEl usuario por defecto es admin y la contraseña en blanco . Cuando iniciemos sesión por primera vez nos obligara a cambiarla :\nFortiGate-VM64-KVM login: admin Password: You are forced to change your password. Please input a new password. New Password: Confirm Password: Welcome! Lo primero que haré sera cambiarle el hostname , como ves es similar a cisco ya que tenemos un modo de configuración :\nFortiGate-VM64-KVM # conf sys global FortiGate-VM64-KVM (global) # set hostname FGT FortiGate-VM64-KVM (global) # end Ahora vamos a configurar el puerto 1 por DHCP para que así desde el cliente 2 lo pueda configurar sin tener que manualmente cambiar la IP del mismo . Ademas voy a configurar el acceso por http y https para poder configurarlo desde un navegador :\nFGT # show system interface port1 config system interface edit \u0026#34;port1\u0026#34; set vdom \u0026#34;root\u0026#34; set mode dhcp set allowaccess ping https ssh http fgfm set type physical set snmp-index 1 next end Ahora vamos a ver la IP que el DHCP le ha asignado con el siguiente comando :\nFGT # get system interface == [ port1 ] name: port1 mode: dhcp ip: 192.168.122.77 255.255.255.0 status: up netbios-forward: disable type: physical ring-rx: 0 ring-tx: 0 netflow-sampler: disable sflow-sampler: disable src-check: enable explicit-web-proxy: disable explicit-ftp-proxy: disable proxy-captive-portal: disable mtu-override: disable wccp: disable drop-overlapped-fragment: disable drop-fragment: disable Ahora desde cualquier maquina que tenga acceso a la red \u0026rsquo;externa\u0026rsquo; podremos conectarnos al FW :\nCuando te inicies sesión veras un panel con información general sobre el estado dispositivo :\nConfiguración de la red LAN Como has visto en la imagen de la topología, la red LAN está conectada al puerto 2. Por lo tanto, procederemos a configurarlo.\nVamos a dirigirnos a Network \u0026gt; Interfaces , selecciona el puerto 2 y pulsa en editar en la barra superior :\nUna vez dentro de la pantalla de configuración de la interfaz, puedes personalizar el puerto asignándole un alias. Además, para facilitar la gestión futura, le he asignado el rol LAN al puerto2, indicando que será utilizado para una red local. Posteriormente, he configurado la dirección IP del mismo, asignándole la 192.168.100.1/24. Además, he creado un objeto con esa IP, lo que facilitará la referencia a esta dirección IP en futuras configuraciones, eliminando la necesidad de recordar la IP .\nSigamos con la configuración de la interfaz. Desde la red LAN, donde estaremos la mayor parte del tiempo, permitiré el acceso vía HTTPS y SSH para configurar el FortiGate. También dejaré que respondan a los pings para asegurarme la conectividad con el mismo. Además, cada interfaz puede ser un servidor DHCP, así que le configurare uno para la LAN. Por último, activaré la opción para detectar dispositivos, así tendré control sobre quién se conecta a la red.\nUna vez configurado el acceso administrativo desde la LAN , voy a quitar el acceso administrativo desde la interfaz puerto 1 ya que esta seria Internet (WAN).\nAsí que le cambiare el ROL a WAN y le quitare el acceso administrativo :\nSi recuerdas anteriormente marcamos en la interfaz LAN la casilla Device connection , si queremos ver los dispositivos conectados a esta red accedemos a Security Fabric \u0026gt; Asset Identify Center :\nPara apartados posteriores , como voy a realizar la practica de cortafuegos de nodo , es interesante crear un objeto con ese host . Así no sera necesario que recuerde su IP :\nAunque no he mencionado nada anteriormente , la política por defecto de estos dispositivos es DROP en todas las direcciones :\nAhora vamos a crear una nueva política que permita el tráfico desde la LAN hacia Internet (WAN) en cualquier dirección. Esta política sería similar a las que tenemos en casa, donde podemos acceder a cualquier sitio web. Además, desde aquí podemos decir que haga SNAT, lo que nos permitirá navegar acceder a Internet. También podremos configurar hacia qué interfaz se realizará este SNAT.\nPara acabar con la configuración inicial , crearemos la ruta por defecto para salir a Internet . Para ello nos iremos a Network \u0026gt; Static Routes :\nUna vez aplicada esta política ya podremos comenzar a realizar la practica , ademas podemos acceder a Internet desde el cliente 1 :\nReglas del cortafuegos Para comenzar desactivare la política anterior , la editare y al final de esta le quitare el tic que la activa :\nQuedando así inactiva :\nLos equipos de la red local deben poder tener conexión al exterior. Para configurar el SNAT en dispositivos FortiGate , es un poco distinto ya que en cada regla que vayamos a permitir tendremos que marcar la casilla si queremos hacer NAT .\nAdemas podemos especificar todas las opciones posibles que se nos ocurra , en mi caso dejare este apartado sin activar y lo iré haciendo en las reglas siguientes . La imagen que ves a continuación es para indicarte donde se activaría . Ademas podemos indicar porque interfaz queremos que salga el trafico . Esto es útil si tenemos dos o mas salidas de Internet para hacer un balanceador de carga .\nUna vez aquí dentro de la configuración de la interfaz le decimos que la interfaz es de tipo NAT , ademas podemos indicarle que no haga PAT .\nPermitimos hacer ping desde la LAN a la máquina cortafuegos. En estos dispositivos no seria una regla como tal , si no que esta opción en concreto se indica desde la opción de acceso administrativo de la interfaz :\nUna vez aplicado , si nos vamos al cliente 1 podremos hacerle ping al cortafuegos :\nPermite realizar conexiones ssh desde los equipos de la LAN Crearemos la regla que permite el trafico SSH , aqui en el origen podemos poner o el cliente1 (creamos el objeto en la preparación del escenario) o directamente poner all en el origen :\nAunque actualmente en mi esquema solo tenga un cliente , ceñiendome al enunciado si quiero que TODOS los cliente de la red LAN puedan hacer ssh en origen tengo que permitir todos :\nComo te explique en el apartado a de la practica , en este tipos de dispositivo tenemos que indicarle si queremos que la regla sea de tipo NAT para que haga SNAT o no .\nUna vez aplicada la regla podremos conectarnos por ssh desde el cliente1:\nVamos a asegurarnos de que la regla tiene hits :\nPermite la navegación en la red LAN Para ello vamos a crear 2 reglas para la red LAN . Una que permita hacer consultas DNS y otra para permitir el trafico HTTPS y HTTP , ademas en ambas reglas sera necesario indicar que se haga NAT .\nComo te has fijado no he indicado el numero de puerto , si no que estos dispositivos tienen unos objetos llamados servicios en los cuales se almacenan los números de puerto de los mismos . Podemos crear los objetos que queramos y personalizar los existentes según nuestras necesidades .\nVamos a comprobar que podemos navegar en el cliente 1 :\nNi que decir tiene que por supuesto que podemos hacer un dig , con la regla actual lo podemos hacer a cualquier servidor DNS :\nVamos a comprobar que tenemos hits en las reglas :\nInstala un servidor de correos en la máquina de la LAN. Permite el acceso desde el exterior y desde el cortafuegos al servidor de correos. Para probarlo puedes ejecutar un telnet al puerto 25 tcp. Como actualmente tenemos permitido la navegación solo por https es fundamental que los repositorios de la maquina estén configurados podremos instalar paquetes en nuestro cliente , asi que vamos a instalar postfix :\nsudo apt update \u0026amp;\u0026amp; sudo apt install postfix -y Ahora vamos a configurar la primera regla de DNAT que vamos a tener en el escenario . Para ello tendremos que crear una IP virtual y decirle cual es la IP externa (WAN) y la IP donde vamos a hacer el DNAT (LAN) .\nAhora vamos a añadir la regla en nuestra política , en el destino de la regla indicaremos la IP virtual que acabamos de crear y indicamos el servicio SMTP que tiene configurado el puerto 25 TCP :\nY vamos a comprobar que desde un cliente externo , como es Cliente 2 podemos acceder a Cliente 1 :\nVamos a comprobar que la regla que acabamos de crear tiene hits :\nPermite hacer conexiones ssh desde exterior a la LAN Para realizar esto volveremos a hacer un DNAT , tendremos que volver a crear una nueva IP virtual ya que anteriormente especifique que esa IP solo se utilizaba para el protocolo SMTP . Así que voy a crear una nueva :\nUna vez creada la nueva IP virtual para el ssh , crearemos la regla de DNAT :\nVamos a probar nuestra nueva regla desde el cliente 2 :\nVamos a comprobar los hits de nuestra nueva regla :\nModifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22. Para realizar esto tendremos que generar un nuevo servicio que este en el puerto 2222 :\nAhora vamos a modificar nuestra IP virtual modificando el servicio por el nuevo que hemos creado con el puerto 2222 y haremos un port forwarding al puerto 22 :\nUna vez hecho esto podremos acceder por ssh utilizando el puerto 2222 y que nos redirija al 22 . No es necesario que modifiquemos las reglas , solo con esto ya podremos acceder :\nVamos a comprobar los hits de las reglas , ademas en el apartado de Virtual IP también tenemos un contador de hits :\nPermite hacer consultas DNS desde la LAN sólo al servidor 8.8.8.8. Comprueba que no puedes hacer un dig @1.1.1.1. Para esto vamos a modificar la regla que permite las consultas DNS y vamos a indicar que el destino solo sea 8.8.8.8 .\nPrimero necesitaremos crear un nuevo objeto con la IP del servidor DNS de Google :\nAhora modificamos la regla y pondremos este objeto como destino :\nVamos a comprobar la modificación de la regla , para que solo podamos hacer consultas dns a 8.8.8.8 :\nPodemos comprobar que los hits han subido :\nPermite que los equipos de la LAN puedan navegar por internet, excepto a la página www.realbetisbalompie.es Estos cortafuegos de nueva generación traen una serie de servicios que nos filtran en el nivel de aplicación que nos permite detectar palabras clave para filtrar el contenido (drogas , pornografía , armas \u0026hellip; ) , en este cortafuegos el filtrar por palabras clave es un servicio de pago , hay que pagar una licencia . Ademas nos permite crear filtros para bloquear ciertas paginas web , que en este caso es gratuito.\nLo primero sera crear nuestra política de filtro_web :\nY añadimos en la misma un nuevo filtro por URL :\nAhora nos dirigimos a la regla que nos permite el trafico https y en seguridad le añadimos el filtro web que acabamos de crear :\nA la izquierda accederé desde el navegador de mi maquina física y puedo acceder a la pagina del maligno , sin embargo si accedo desde el cliente 1 el firewall no nos deja acceder :\nSi accedemos a FortiView Destinations podremos ver las paginas que ha bloqueado nuestro filtro :\n","date":"March 28, 2024","hero":"/images/cortafuegos/fortinet1.png","permalink":"https://www.javiercd.es/posts/cortafuegos/fortinet_uno/fortinet_uno/","summary":"\u003cp\u003eAntes de comenzar la practica , el escenario que ves en la practica es lo mas parecido que puedo montar a la practica original . He utilizado la versión 7.0.9-1 de FortiGate , ya que las versiones superiores traen algunas restricciones .  Puedes descargarte la imagen desde este \u003ca href=\"https://drive.google.com/drive/folders/1VGmeLN5inkWoNNUsIvq9ewGUzJLTLkiM\" target=\"_blank\" rel=\"noopener\"\u003elink\u003c/a\u003e .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/cortafuegos/fortinet_uno/img/Pastedimage20240320223139.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"puesta-en-marcha-del-cortafuegos\"\u003ePuesta en marcha del cortafuegos\u003c/h2\u003e\n\u003cp\u003eLos dispositivos FortiGate vienen configurados de fabrica con la IP 192.168.1.99/24 , como estoy desde GNS3 no es necesario que me conecte a esta interfaz con un dispositivo y cambie la configuración . Ya que puedo hacerlo desde la consola .\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","FORTINET"],"title":"Implementación de un cortafuegos perimetral con Fortinet I"},{"categories":null,"contents":"Ahora vamos a emular la práctica de cortafuegos II, pero en GNS3. Para ello, he transformado al cliente 1 en Odin, además he añadido a Thor y Loki como máquinas virtuales en lugar de contenedores en la red LAN. También he creado una nueva red llamada DMZ, en la cual estará la máquina Hela.\nDado que he transformado el escenario anterior en este nuevo, contamos con algunas reglas creadas anteriormente. Por lo tanto, eliminaré del enunciado aquellas que ya estén creadas, como la de hacer SSH a Odin desde el puerto 2222, pero con el servicio escuchando en el 22.\nAdemás, ahora vamos a hacer unas reservas DHCP para tener controladas las IP de las nuevas máquinas.\nAdemas como no cuento con los servicios montados en el antiguo escenario en Opsentack y para las reglas del enunciado montare lo mínimo para hacer que funcionen las reglas .\nA lo largo de esta practica te explicare que por como esta montado la topologia de la red , todos de la red LAN pueden comunicarse entre sin necesidad de pasar por el cortafuegos . Así que en algunos ejercicios omitiré la parte de hacer que Loki y Thor se comuniquen con Odin. Ademas no voy a montar el servidor DNS ni LDAP ya que las reglas de DNAT son bastante sencillas y a lo largo de la practica aparecen varios ejercicios de hacer DNAT entre las distintas redes . En lugar de esto voy a añadir VPN al final de la misma ya que lo veo mas interesante que repetir las mismas reglas cambiando el servicio .\nPreparación del escenario Lo primero que haré sera crear una nueva red en el puerto 3 , que corresponde a la red DMZ .\nComo veras en la imagen a continuación he seleccionado que el rol sea LAN , para que me permita tener un servidor DHCP en esa red . Como es una red en la que albergara los servicios no quiero que desde esta se pueda acceder a configurar el cortafuegos así que dejare la administración desactivada .\nAhora iré accediendo a los nuevos clientes y les cambiare el nombre de maquina y configurándolas por DHCP .\nMaquina Odin , esta era anteriormente la maquina cliente 1 , solo hay que cambiarle el FQDN y el hostname :\nosboxes@odin:~$ hostname -f odin.javiercd.gonzalonazareno.org osboxes@odin:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.100.2/24 brd 192.168.100.255 scope global dynamic noprefixroute ens3 valid_lft 604790sec preferred_lft 604790sec Maquina Thor :\ndebian@thor:~$ hostname -f thor.javiercd.gonzalonazareno.org debian@thor:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.100.4/24 brd 192.168.100.255 scope global dynamic ens3 valid_lft 604791sec preferred_lft 604791sec debian@thor:~$ Maquina Loki :\ndebian@loki:~$ hostname -f loki.javiercd.gonzalonazareno.org debian@loki:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.100.3/24 brd 192.168.100.255 scope global dynamic ens3 valid_lft 604724sec preferred_lft 604724sec Maquina Hela :\ndebian@hela:~$ hostname -f hela.javiercd.gonzalonazareno.org debian@hela:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.200.2/24 brd 192.168.200.255 scope global dynamic ens3 valid_lft 604795sec preferred_lft 604795sec Ahora vamos a hacer unas reservas en el servidor DHCP , accederemos a Dashborad \u0026gt; Networks \u0026gt; DHCP , una vez aquí le daremos clic derecho sobre cada cliente de los 4 que tenemos en el escenario y le crearemos una reserva :\nNos saldrá un menú similar a este para enlazar la dirección MAC a la IP :\nUna vez hagamos esto con nuestro clientes nos indicara que tenemos la reserva hecha :\nReglas del cortafuegos Vamos a comenzar a crear las reglas , como dije anteriormente partimos del escenario anterior , así que algunas reglas para el funcionamiento mínimo de la red están creadas .\nTe dejo una captura de como se quedaron las reglas , para que veas del estado en el que partimos :\nAlgunas de las siguiente reglas ya esta configurada del ejercicio anterior , como la siguiente regla \u0026ndash;\u0026gt; La máquina Odin tiene un servidor ssh escuchando por el puerto 22, pero al acceder desde el exterior habrá que conectar al puerto 2222\njaviercruces@HPOMEN15:~$ ssh osboxes@192.168.122.77 -p 2222 osboxes@192.168.122.77\u0026#39;s password: Welcome to Ubuntu 22.04 LTS (GNU/Linux 5.15.0-25-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 560 updates can be applied immediately. 339 of these updates are standard security updates. To see these additional updates run: apt list --upgradable Last login: Fri Mar 29 11:23:44 2024 from 192.168.100.1 osboxes@odin:~$ hostname -f odin.javiercd.gonzalonazareno.org A continuación veras que hay algunas reglas que he eliminado o modificado , ya que en el escenario actual no se pueden hacer , bien o por la topología o porque anteriormente la maquina Odin era el cortafuegos . En cualquier caso alguna he mantenido y he explicado algunas cosas adicionales .\nDesde Thor y Hela se debe permitir la conexión ssh por el puerto 22 a la máquina Odin. Esta regla no la podemos realizar ya que al tener un switch de por medio interconectando los dispositivos , el trafico no pasara por el cortafuegos por lo que no podremos aplicar reglas en el cortafuego para impedir el trafico local .\nVeras que aunque cree la regla , en el cortafuegos esta no se inmutara :\nVes que por ejemplo si me conecto desde loki o desde thor puedo llegar a odin :\ndebian@loki:~$ ssh osboxes@192.168.100.2 osboxes@192.168.100.2\u0026#39;s password: Welcome to Ubuntu 22.04 LTS (GNU/Linux 5.15.0-25-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 560 updates can be applied immediately. 339 of these updates are standard security updates. To see these additional updates run: apt list --upgradable Last login: Fri Mar 29 11:42:43 2024 from 192.168.100.3 osboxes@odin:~$ Pero no llego por la regla que he creado si no por la propia topologia de la red , la regla no tiene hits :\nTodo el trafico se encarga de redirigirlo el swicht .\nA la máquina Odin se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexión (REJECT) y desde el exterior se rechazará de manera silenciosa. Para permitir que desde la red DMZ podamos hacer ping hacia Odin crearemos la siguiente regla :\nVamos a comprobar que desde la DMZ podemos hacer el ping a Odin :\ndebian@hela:~$ ping 192.168.100.2 -c 1 PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data. 64 bytes from 192.168.100.2: icmp_seq=1 ttl=63 time=2.38 ms --- 192.168.100.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 2.379/2.379/2.379/0.000 ms Como vemos la regla esta funcionando , así que vamos a comprobar los hits :\nPor el mismo motivo que en el ejercicio anterior , desde la red LAN no podemos limitar el ping hacia Odin ya que no pasa por el cortafuegos si no por el switch .\nAlgo parecido nos pasara desde la WAN , al ser un ping dirigido a la IP de la interfaz este se desactiva desde la configuración de la misma , siempre se rechaza de manera silenciosa pero no da opción a elegirlo :\nUna vez eliminado\njaviercruces@HPOMEN15:~$ ping 192.168.122.77 -c 1 PING 192.168.122.77 (192.168.122.77) 56(84) bytes of data. --- 192.168.122.77 ping statistics --- 1 packets transmitted, 0 received, 100% packet loss, time 0ms La máquina Odin puede hacer ping a la LAN, la DMZ y al exterior. La maquina Odin por la propia topologia puede hacerle ping a todas las maquinas de la LAN ya que el trafico hacia esta red pasa por el swicht .\nPara que pueda hacer ping hacia la DMZ y a la WAN vamos a crear dos reglas :\nLa regla para la WAN :\nLa regla para la DMZ :\n# LAN --\u0026gt; WAN osboxes@odin:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=114 time=10.1 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 10.088/10.088/10.088/0.000 ms # LAN --\u0026gt; DMZ osboxes@odin:~$ ping 192.168.200.2 -c 1 PING 192.168.200.2 (192.168.200.2) 56(84) bytes of data. 64 bytes from 192.168.200.2: icmp_seq=1 ttl=63 time=0.804 ms --- 192.168.200.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.804/0.804/0.804/0.000 ms # LAN --\u0026gt; LAN (No interviene el cortafuegos) osboxes@odin:~$ ping 192.168.100.3 -c 1 PING 192.168.100.3 (192.168.100.3) 56(84) bytes of data. 64 bytes from 192.168.100.3: icmp_seq=1 ttl=64 time=0.503 ms --- 192.168.100.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.503/0.503/0.503/0.000 ms Vamos a comprobar los hits de las dos reglas que acabamos de crear :\nDesde la máquina Hela se puede hacer ping y conexión ssh a las máquinas de la LAN. Para lograr esto creare la siguiente regla . Podríamos separarla en 2 reglas independientes para tener los contadores por separado , pero en este caso no es importante distinguir el trafico .\nVamos a comprobar la regla , haciendo un ping a las distintas maquinas de la red LAN , ya que anteriormente había una regla para permitir todos los pings hacia Odin :\n# HELA --\u0026gt; ODIN debian@hela:~$ ping 192.168.100.2 -c 1 PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data. 64 bytes from 192.168.100.2: icmp_seq=1 ttl=63 time=1.10 ms --- 192.168.100.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.101/1.101/1.101/0.000 ms # HELA --\u0026gt; LOKI debian@hela:~$ ping 192.168.100.3 -c 1 PING 192.168.100.3 (192.168.100.3) 56(84) bytes of data. 64 bytes from 192.168.100.3: icmp_seq=1 ttl=63 time=1.73 ms --- 192.168.100.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.730/1.730/1.730/0.000 ms # HELA --\u0026gt; THOR debian@hela:~$ ping 192.168.100.4 -c 1 PING 192.168.100.4 (192.168.100.4) 56(84) bytes of data. 64 bytes from 192.168.100.4: icmp_seq=1 ttl=63 time=0.998 ms --- 192.168.100.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.998/0.998/0.998/0.000 ms Ahora vamos a comprobar que podemos conectarnos por ssh desde Hela a la LAN :\ndebian@hela:~$ ssh osboxes@192.168.100.2 \u0026#39;hostname -f\u0026#39; osboxes@192.168.100.2\u0026#39;s password: odin.javiercd.gonzalonazareno.org debian@hela:~$ ssh 192.168.100.3 \u0026#39;hostname -f\u0026#39; debian@192.168.100.3\u0026#39;s password: loki.javiercd.gonzalonazareno.org debian@hela:~$ ssh 192.168.100.4 \u0026#39;hostname -f\u0026#39; debian@192.168.100.4\u0026#39;s password: thor.javiercd.gonzalonazareno.org La regla funciona correctamente , vamos a comprobar que ha subido los hits :\nDesde cualquier máquina de la LAN se puede conectar por ssh a la máquina Hela. Para ello vamos a crear la siguiente regla :\nAhora vamos a comprobar la regla que acabamos de crear :\nosboxes@odin:~$ ssh debian@192.168.200.2 \u0026#39;hostname -f\u0026#39; debian@192.168.200.2\u0026#39;s password: hela.javiercd.gonzalonazareno.org debian@loki:~$ ssh 192.168.200.2 \u0026#39;hostname -f\u0026#39; debian@192.168.200.2\u0026#39;s password: hela.javiercd.gonzalonazareno.org debian@thor:~$ ssh 192.168.200.2 \u0026#39;hostname -f\u0026#39; debian@192.168.200.2\u0026#39;s password: hela.javiercd.gonzalonazareno.org Vamos a comprobar que los hits de la regla han subido :\nConfigura la máquina Odin para que las máquinas de LAN y DMZ puedan acceder al exterior. El SNAT en este dispositivo podemos elegir activarlo por cada regla y no en general . Si te has fijado a lo largo de la practica en todas las reglas que implica dar un salto de interfaz he marcado la casilla NAT :\nPor lo que este apartado se va a ir realizando a lo largo de la practica conforme creemos las reglas .\nLas máquinas de la LAN pueden hacer ping al exterior y navegar. Vamos a tener que crear 3 reglas :\nPermitir el trafico HTTP/HTTPS Permitir las consultas DNS Permitir hacer ping De estas tres reglas las dos primeras están creadas con anterioridad :\nPor lo que solo nos queda añadir la regla del ping , que seria la siguiente :\nComo tengo una versión de prueba puedo tener como máximo 10 entradas , así que voy a eliminar la que solo deja hacer ping al exterior a Odin .\nVamos a comprobar las reglas , desde un cliente de la red LAN:\nosboxes@odin:~$ dig @8.8.8.8 www.javiercd.es ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.1-1ubuntu1-Ubuntu \u0026lt;\u0026lt;\u0026gt;\u0026gt; @8.8.8.8 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 25764 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.javiercd.es.\tIN\tA ;; ANSWER SECTION: www.javiercd.es.\t3600\tIN\tCNAME\tjavierasping.github.io. javierasping.github.io.\t3600\tIN\tA\t185.199.108.153 javierasping.github.io.\t3600\tIN\tA\t185.199.109.153 javierasping.github.io.\t3600\tIN\tA\t185.199.110.153 javierasping.github.io.\t3600\tIN\tA\t185.199.111.153 ;; Query time: 60 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP) ;; WHEN: Fri Mar 29 13:44:50 EDT 2024 ;; MSG SIZE rcvd: 144 osboxes@odin:~$ ping -c 1 www.javiercd.es PING javierasping.github.io (185.199.108.153) 56(84) bytes of data. 64 bytes from cdn-185-199-108-153.github.com (185.199.108.153): icmp_seq=1 ttl=55 time=11.1 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 11.111/11.111/11.111/0.000 ms osboxes@odin:~$ curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Mon, 11 Mar 2024 23:21:37 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65ef9201-6878\u0026#34; expires: Fri, 29 Mar 2024 17:56:01 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: AE88:3308D5:438AA74:448F970:6606FE58 accept-ranges: bytes date: Fri, 29 Mar 2024 17:46:01 GMT via: 1.1 varnish age: 0 x-served-by: cache-mad2200143-MAD x-cache: MISS x-cache-hits: 0 x-timer: S1711734362.862201,VS0,VE134 vary: Accept-Encoding x-fastly-request-id: 16b6048f2b032ef4b4293c52f0ae36d19b0e0da0 content-length: 26744 Así quedarían nuestras tres reglas , veremos que tenemos hits en las mismas :\nLa máquina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes aún. Para realizar esto es necesario tener permitido el DNS y la navegación . Para ello he creado la siguiente regla :\nLa he creado en una sola regla para ahorrar en el numero de las mismas , he borrado las que permitía el ping desde DMZ a LAN de ejercicios anteriores .\ndebian@hela:~$ sudo apt install proftpd postfix apache2 -y Configura la máquina Odin para que los servicios web y ftp sean accesibles desde el exterior. Para hacer el DNAT deberemos de crear 2 IPs virtuales , como hicimos en cortafuegos I .\nUna para cada servicio que queramos hacer un DNAT . Para el servidor web :\nY para el servidor FTP :\nAhora vamos a crear la propia regla de DNAT para el servidor web , en la cual como destino indicamos la IP virtual que acabamos de crear :\nVeremos que si accedemos a la IP del cortafuegos de la WAN accederemos al apache de Hela :\nTambién crearemos la regla DNAT para el servidor FTP :\nVamos a comprobar el acceso al servidor ftp :\njaviercruces@HPOMEN15:~$ ftp debian@192.168.122.77 Connected to 192.168.122.77. 220 ProFTPD Server (Debian) [::ffff:192.168.200.2] 331 Password required for debian Password: 230 User debian logged in Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; Si comprobamos los hits de las reglas veremos que en ambas ha subido :\nEl servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior. Para realizar este ejercicio deberemos de volver a generar las 2 IPs virtuales pero ahora indicaremos la IP de la tarjeta LAN del firewall .\nPara el DNAT del servidor web :\nRepetiremos lo mismo para el servicio FTP , cambiando el servicio :\nAhora crearemos las 2 reglas de DNAT para permitir el acceso desde la LAN .\nPara el servidor web :\nPara el servidor FTP:\nVamos a comprobar que podemos acceder a ambos servicios :\nosboxes@odin:~$ curl -I http://192.168.100.1 HTTP/1.1 200 OK Date: Fri, 29 Mar 2024 18:31:59 GMT Server: Apache/2.4.57 (Debian) Last-Modified: Fri, 29 Mar 2024 17:53:38 GMT ETag: \u0026#34;29cd-614d051d4d640\u0026#34; Accept-Ranges: bytes Content-Length: 10701 Vary: Accept-Encoding Content-Type: text/html osboxes@odin:~$ ftp debian@192.168.100.1 Connected to 192.168.100.1. 220 ProFTPD Server (Debian) [::ffff:192.168.200.2] 331 Password required for debian Password: 230 User debian logged in Remote system type is UNIX. Using binary mode to transfer files. Vamos a comprobar que han subido los hits en las reglas :\nEl servidor de correos sólo debe ser accesible desde la LAN. Volvemos a repetir los mismos pasos , le crearemos una IP virtual para poder hacer la regla de DNAT :\nAhora vamos a crear la regla de DNAT :\nY comprobaremos que desde un PC de la LAN haciendo un telnet llegamos al servidor de correos :\nosboxes@odin:~$ telnet 192.168.100.1 25 Trying 192.168.100.1... Connected to 192.168.100.1. Escape character is \u0026#39;^]\u0026#39;. 220 hela.javiercd.gonzalonazareno.org ESMTP Postfix (Debian/GNU) quit 221 2.0.0 Bye Connection closed by foreign host. Veremos que el hit de la regla ha subido :\nEn la máquina Loki instala un servidor Postgres si no lo tiene aún. A este servidor se puede acceder desde la DMZ, pero no desde el exterior. Volveremos a repetir el proceso de crear una nueva IP virtual para este servicio . Ademas en este caso he tenido que crear el servicio ya que no existía .\nVamos a crear la regla de DNAT :\nVamos a comprobar que tenemos acceso al servidor pgsql desde la red DMZ :\ndebian@hela:~$ psql -h 192.168.200.1 -U postgres -W Password: psql (15.6 (Debian 15.6-0+deb12u1)) SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off) Type \u0026#34;help\u0026#34; for help. postgres=# \\q Comprobaremos que la regla tiene hits :\nEvita ataques DoS por ICMP Flood, limitando a 4 el número de peticiones por segundo desde una misma IP. Dentro del apartado de políticas y objetos , encontramos un apartado para crear políticas para DoS . En mi caso he creado una con los valores recomendados que da el fabricante . Y he cambiado el limite de ICMP Flood a 4 paquetes por segundo .\nVamos a comprobar que nos bloquea el trafico si excedemos ese limite . Con este comando estamos enviando 3 paquetes por segundo que es inferior al limite establecido asi que no cortara ningún paquete :\ndebian@loki:~$ sudo hping3 --icmp -i u333333 -V 192.168.100.1 --- 192.168.100.1 hping statistic --- 124 packets transmitted, 124 packets received, 0% packet loss round-trip min/avg/max = 0.7/5.3/9.9 ms Si aumentamos los de paquetes por segundos , bloqueara todos los paquetes que superen a 4 por segundo , por eso deja pasar los 4 primeros de cada segundo :\ndebian@loki:~$ sudo hping3 --icmp -i u200000 -V 192.168.100.1 --- 192.168.100.1 hping statistic --- 44 packets transmitted, 10 packets received, 78% packet loss round-trip min/avg/max = 4.6/5.5/6.5 ms El cortafuegos ha registrado como una anomalía el trafico que ha tirado :\nEvita ataques DoS por SYN Flood. Con el filtro que hemos activado en el ejercicio anterior tenemos limitada las peticiones TCP a 2000 por minuto desde la misma IP para evitar este tipo de ataque . Vemos que el filtro elimina las peticiones maliciosas y no deja que el ataque tenga efecto :\ndebian@loki:~$ sudo hping3 --flood --rand-source -V 192.168.100.1 using ens3, addr: 192.168.100.3, MTU: 1500 HPING 192.168.100.1 (ens3 192.168.100.1): NO FLAGS are set, 40 headers + 0 data bytes hping in flood mode, no replies will be shown ^C --- 192.168.100.1 hping statistic --- 930716 packets transmitted, 0 packets received, 100% packet loss round-trip min/avg/max = 0.0/0.0/0.0 ms Evita que realicen escaneos de puertos a Odin. En lugar de hacerlo a Odin por la propia topologia vamos a hacerlo para evitar escaneos desde la WAN .\nPara ello nos abrimos una terminal y lo que vamos a hacer es crear una firma de IPS para evitar los paquetes con una determinada bandera que usa un escaneo determinado . En este caso vamos a evitar el escaneo de NMAP XMAS .\nFTG # config ips custom FTG (custom) # edit \u0026#34;Block_xmas\u0026#34; new entry \u0026#39;Block_xmas\u0026#39; added FTG (Block_xmas) # set signature \u0026#34;F-SBID(--name \u0026#39;Block_xmas\u0026#39;; --protocol tcp; --flow from_client; --tcp_flags *FUP; )\u0026#34; FTG (Block_xmas) # set action block FTG (Block_xmas) # end Una vez configurado nos aparecera la regla que hemos creado en IPs signatures :\nAhora vamos a crear una regla IPS para asociarla con esta politica de firmas :\nAñadiremos en IPS signatures and filters , el nuevo filtro que hemos creado anteriormente :\nA continuación en las reglas de DNAT donde queramos controlar que no sepan que puertos tenemos abiertos , asignaremos la nueva política IPS :\nEn mi caso vamos a probarlo para la regla DNAT de ssh :\nSi lanzo el NMAP desde mi host que esta en la red WAN , vemos que el puerto 2222 que es el que esta regla tiene abierto no lo detecta :\njaviercruces@HPOMEN15:~$ sudo nmap -sX 192.168.122.77 Starting Nmap 7.93 ( https://nmap.org ) at 2024-03-30 19:05 CET Nmap scan report for 192.168.122.77 Host is up (0.00059s latency). All 1000 scanned ports on 192.168.122.77 are in ignored states. Not shown: 1000 open|filtered tcp ports (no-response) MAC Address: 0C:18:45:93:00:00 (Unknown) Nmap done: 1 IP address (1 host up) scanned in 21.28 seconds Y el propio cortafuegos nos avisara de que ha habido un escaneo de puertos que ha bloqueado , para ver esto dirígete a Log \u0026amp; Report \u0026gt; Intrusion prevention :\nPodemos seleccionarlo para ver mas detalles del mismo :\n","date":"March 28, 2024","hero":"/images/cortafuegos/fortinet2.png","permalink":"https://www.javiercd.es/posts/cortafuegos/fortinet_dos/fortinet_dos/","summary":"\u003cp\u003eAhora vamos a emular la práctica de cortafuegos II, pero en GNS3. Para ello, he transformado al cliente 1 en Odin, además he añadido a Thor y Loki como máquinas virtuales en lugar de contenedores en la red LAN. También he creado una nueva red llamada DMZ, en la cual estará la máquina Hela.\u003c/p\u003e\n\u003cp\u003eDado que he transformado el escenario anterior en este nuevo, contamos con algunas reglas creadas anteriormente. Por lo tanto, eliminaré del enunciado aquellas que ya estén creadas, como la de hacer SSH a Odin desde el puerto 2222, pero con el servicio escuchando en el 22.\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","FORTINET"],"title":"Implementación de un cortafuegos perimetral con Fortinet II"},{"categories":null,"contents":"En este post sobre un escenario con maquinas Debian , aplicaremos reglas con Nftables para conrtrolar el trafico que entra y sale en nuestra red , intentando imitar un escenario.\n[!NOTE]\nPara desplegar el escenario para realizar estos ejercicios necesitaras desplegar el fichero .yaml que encontraras en el enlace del párrafo siguiente . Este se encargara de desplegar 2 maquinas una que hará de cortafuegos y otra que simulara un cliente que estará conectado a la primera maquina para simular una red local .\nRealiza con NFTABLES el ejercicio de la página https://fp.josedomingo.org/seguridadgs/u03/perimetral_iptables.html documentando las pruebas de funcionamiento realizadas.\nPreparación del escenario Lo primero que haremos es activar el bit de forwarding. Para ello, editaremos el archivo /etc/sysctl.conf utilizando el siguiente comando :\njaviercruces@router-fw:~$ sudo nano /etc/sysctl.conf # Descomentamos la linea net.ipv4.ip_forward=1 A continuación, aplicaremos los cambios utilizando el siguiente comando:\njaviercruces@router-fw:~$ sudo sysctl -p net.ipv4.ip_forward = 1 Ahora añadiremos la tabla filter :\njaviercruces@router-fw:~$ sudo nft add table inet filter Podemos ver las tablas creadas :\njaviercruces@router-fw:~$ sudo nft list tables table inet filter Crear las cadenas para la entrada y salida :\n# Cadena de \u0026#34;entrada\u0026#34; javiercruces@router-fw:~$ sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; } # Cadena de \u0026#34;salida\u0026#34; javiercruces@router-fw:~$ sudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; } # Cadena forward , peticiones que atraviesen : javiercruces@router-fw:~$ sudo nft add chain inet filter forward { type filter hook forward priority 0 \\; counter \\; policy drop \\; } Ahora comprobaremos que se han creado estas tres cadenas :\njaviercruces@router-fw:~$ sudo nft list chains table inet filter { chain input { type filter hook input priority filter; policy accept; } chain output { type filter hook output priority filter; policy accept; } chain forward { type filter hook forward priority filter; policy accept; } } Reglas del cortafuegos Permitir ssh hacia el cortafuegos Ahora vamos a permitir el ssh hacia la maquina router-fw :\njaviercruces@router-fw:~$ sudo nft add rule inet filter input iif ens3 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter output oif ens3 tcp sport 22 ct state established counter accept Política por defecto DROP Ahora vamos a poner la política por defecto DROP:\njaviercruces@router-fw:~$ sudo nft chain inet filter input { policy drop \\; } javiercruces@router-fw:~$ sudo nft chain inet filter output { policy drop \\; } javiercruces@router-fw:~$ sudo nft chain inet filter forward { policy drop \\; } Comprobaremos que con la nueva política podemos conectarnos por ssh y no hemos perdido la conexión , viendo que tenemos hits en las reglas .\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 174 bytes 11824 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 129 bytes 8252 accept } chain output { type filter hook output priority filter; policy drop; counter packets 169 bytes 31232 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 85 bytes 22632 accept } } SNAT Hacemos SNAT para que los equipos de la LAN puedan acceder al exterior.\nPara ello sera necesario que creemos la tabla NAT y sus cadenas . Como podemos observar hemos indicado menos prioridad en la cadena postrouting (mientras menor sea el número, mayor es su prioridad) para que las reglas de dicha cadena se ejecuten después de las reglas de prerouting.\n# Creamos la tabla NAT javiercruces@router-fw:~$ sudo nft add table nat # Cadena para el DNAT javiercruces@router-fw:~$ sudo nft add chain nat prerouting { type nat hook prerouting priority 0 \\; } # Cadena para el SNAT javiercruces@router-fw:~$ sudo nft add chain nat postrouting { type nat hook postrouting priority 100 \\; } Ahora vamos a permitir hacer SNAT a la red LAN :\njaviercruces@router-fw:~$ sudo nft add rule ip nat postrouting oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter masquerade Permitimos el ssh desde el cortafuego a la LAN javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept Ahora que podemos conectarnos por ssh a nuestra maquina LAN , vamos a comprobar las 2 reglas anteriores . Conectarnos por ssh y el SNAT :\njaviercruces@router-fw:~$ ssh debian@192.168.100.10 Linux lan 6.1.0-12-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Feb 27 18:31:10 2024 from 192.168.100.2 debian@lan:~$ ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. ^C --- 1.1.1.1 ping statistics --- 2 packets transmitted, 0 received, 100% packet loss, time 1002ms Veremos que podemos conectarnos por ssh , sin embargo el ping no esta permitido pero lo he realizado para que la regla de SNAT tenga hits.\nVamos a ver que las reglas tienen hits :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 621 bytes 63636 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 493 bytes 41948 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 81 bytes 17628 accept } chain output { type filter hook output priority filter; policy drop; counter packets 1231 bytes 141120 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 349 bytes 68222 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 103 bytes 17420 accept } chain forward { type filter hook forward priority filter; policy drop; counter packets 4 bytes 336 } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 1 bytes 84 masquerade } } Como podemos ver el SNAT tiene hits , así que la regla esta funcionando , pero como no dejamos que atraviese el firewall estas no saldrán .\nPermitimos tráfico para la interfaz loopback Añadimos las reglas , para permitir el trafico hacia la interfaz loopback :\njaviercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;lo\u0026#34; counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;lo\u0026#34; counter accept Comprobamos que tenemos conectividad :\njaviercruces@router-fw:~$ ping 127.0.0.1 PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.205 ms Vamos a ver los hits de la regla :\njaviercruces@router-fw:~$ sudo nft list ruleset | grep lo iifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept oifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept Peticiones y respuestas protocolo ICMP Vamos a permitir a la maquina router-fw aceptar peticiones ICMP y que envié la respuesta :\njaviercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter accept Le hago ping desde mi maquina :\njaviercruces@HPOMEN15:~/Documentos/2ºASIR/SAD/cortafuegos1$ ping 172.22.201.120 -c 1 PING 172.22.201.120 (172.22.201.120) 56(84) bytes of data. 64 bytes from 172.22.201.120: icmp_seq=1 ttl=61 time=85.4 ms --- 172.22.201.120 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 85.403/85.403/85.403/0.000 ms Permitir hacer ping desde la LAN Vamos a permitir que se pueda hacer ping desde la LAN :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter accept Vamos a comprobarlo :\ndebian@lan:~$ ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. 64 bytes from 1.1.1.1: icmp_seq=1 ttl=50 time=40.8 ms 64 bytes from 1.1.1.1: icmp_seq=2 ttl=50 time=40.8 ms ^C --- 1.1.1.1 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 40.821/40.834/40.848/0.013 ms Vamos a ver los hits de la regla , ademas con esta podemos comprobar la regla del SNAT :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 2637 bytes 213636 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 2346 bytes 172928 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 225 bytes 32812 accept iifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept } chain output { type filter hook output priority filter; policy drop; counter packets 4656 bytes 697080 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 1618 bytes 477018 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 291 bytes 30252 accept oifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept } chain forward { type filter hook forward priority filter; policy drop; counter packets 31 bytes 2604 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter packets 12 bytes 1008 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter packets 2 bytes 168 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 4 bytes 336 masquerade } } Consultas y respuestas DNS desde la LAN javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter accept Vamos a hacer una consulta utilizando el comando host , ya que no dispongo otra herramienta instalada para hacer consultas dns :\ndebian@lan:~$ host www.javiercd.es www.javiercd.es is an alias for javierasping.github.io. javierasping.github.io has address 185.199.111.153 javierasping.github.io has address 185.199.108.153 javierasping.github.io has address 185.199.109.153 javierasping.github.io has address 185.199.110.153 javierasping.github.io has IPv6 address 2606:50c0:8000::153 javierasping.github.io has IPv6 address 2606:50c0:8001::153 javierasping.github.io has IPv6 address 2606:50c0:8003::153 javierasping.github.io has IPv6 address 2606:50c0:8002::153 Vamos a consultar los hits de las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 10 bytes 643 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 10 bytes 2644 accept Permitimos la navegación web desde la LAN javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80,443} ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80,443} ct state established counter accept Para verificar este punto, necesitaremos modificar el archivo /etc/nsswitch.conf, el cual determina la prioridad de la resolución DNS. Realizaremos esta modificación para priorizar la consulta DNS al servicio de DNS de systemd, el cual está incluido en Debian y Ubuntu. Esto permitirá que las consultas se realicen primero en la propia máquina y, en caso necesario, serán enviadas al servidor DNS configurado ya que en este escenario las aplicaciones no nos resuelven si no realizamos esta modificación .\ndebian@lan:~$ sudo nano /etc/nsswitch.conf hosts: files dns resolve [!UNAVAIL=return] Ademas cambiaremos el servidor dns de la maquina y en lugar de ser nosotros , pondremos el del instituto :\ndebian@lan:~$ sudo cat /etc/resolv.conf nameserver 172.22.0.1 Una vez aplicados los cambios vamos a pedir una web por el nombre de dominio , así comprobaremos el funcionamiento de los dos puntos anteriores . Pediré solo las cabeceras para que la salida sea mas legible , un código 200 seria correcto . En la parte de http nos da una redirección ya que el servidor te redirige a https :\ndebian@lan:~$ curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sun, 25 Feb 2024 23:03:49 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65dbc755-675b\u0026#34; expires: Wed, 28 Feb 2024 10:10:17 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: 5CD4:0E10:CBDBE5:CFBAEA:65DF0430 accept-ranges: bytes date: Wed, 28 Feb 2024 10:00:17 GMT via: 1.1 varnish age: 0 x-served-by: cache-mad2200123-MAD x-cache: MISS x-cache-hits: 0 x-timer: S1709114417.014922,VS0,VE167 vary: Accept-Encoding x-fastly-request-id: e15d291bbff90bf9de58991f0f6477e4398c415d content-length: 26459 debian@lan:~$ curl -I http://www.javiercd.es/ HTTP/1.1 301 Moved Permanently Content-Length: 162 Server: GitHub.com Content-Type: text/html Location: https://www.javiercd.es/ X-GitHub-Request-Id: 9870:0E7F:37400AD:3848DF5:65DF0425 Accept-Ranges: bytes Date: Wed, 28 Feb 2024 10:00:27 GMT Age: 21 X-Served-By: cache-mad2200100-MAD X-Cache: HIT X-Cache-Hits: 1 X-Timer: S1709114427.468002,VS0,VE1 Vary: Accept-Encoding X-Fastly-Request-ID: e321e34041a049f6f7c99e0693be994990da6da3 X-Cache: MISS from f0 X-Cache-Lookup: HIT from f0:3128 Via: 1.1 varnish, 1.1 f0 (squid/4.6) Connection: close Permitimos el acceso a nuestro servidor web de la LAN desde el exterior Como ya tenemos resolución dns y navegación web , podremos actualizar nuestros repositorios y instalar paquetes :\ndebian@lan:~$ sudo apt update -y \u0026amp;\u0026amp; sudo apt install apache2 -y Una vez instalado apache vamos a realizar la regla de DNAT :\njaviercruces@router-fw:~$ sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 80 counter dnat to 192.168.100.10 Ahora tenemos que permitir en la cadena forward el trafico para permitir el DNAT . Las peticiones al servidor web y las respuestas\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 80 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter accept Ahora vamos a comprobar que podemos acceder al servidor web :\njaviercruces@HPOMEN15:~/Documentos/2ºASIR/SAD/cortafuegos1$ curl -I 172.22.201.120 HTTP/1.1 200 OK Date: Wed, 28 Feb 2024 10:24:26 GMT Server: Apache/2.4.57 (Debian) Last-Modified: Wed, 28 Feb 2024 10:17:20 GMT ETag: \u0026#34;29cd-6126e72b03120\u0026#34; Accept-Ranges: bytes Content-Length: 10701 Vary: Accept-Encoding Content-Type: text/html Desde un navegador :\nPor ultimo vamos a comprobar que las reglas involucradas tienen hits y te dejo el listado completo para que veas las reglas hasta este punto :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 20313 bytes 2212299 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 11896 bytes 827728 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 8093 bytes 1321072 accept iifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept } chain output { type filter hook output priority filter; policy drop; counter packets 69191 bytes 6011531 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 8461 bytes 1953220 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 9482 bytes 623484 accept oifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept } chain forward { type filter hook forward priority filter; policy drop; counter packets 42155 bytes 145465374 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter packets 32 bytes 2688 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter packets 18 bytes 1512 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 273 bytes 17860 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 273 bytes 52163 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80, 443 } ct state established,new counter packets 33973 bytes 1794576 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80, 443 } ct state established counter packets 7119 bytes 143533481 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 80 ct state established,new counter packets 47 bytes 3905 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter packets 32 bytes 24161 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; iifname \u0026#34;ens3\u0026#34; tcp dport 80 counter packets 4 bytes 240 dnat to 192.168.100.10 } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 547 bytes 38852 masquerade } } Ejercicios adicionales Debes añadir después las reglas necesarias para que se permitan las siguientes operaciones:\nPermite poder hacer conexiones ssh al exterior desde la máquina cortafuegos. javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter accept Vamos a conectarnos por ssh desde la maquina cortafuegos a otra para comprobar esto :\njaviercruces@router-fw:~$ ssh 172.22.200.47 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Feb 28 10:35:56 2024 from 172.22.201.120 javiercruces@odin:~$ Vamos a comprobar los hits en las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 66 bytes 18624 accept oifname \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 89 bytes 16572 accept Permite hacer consultas DNS desde la máquina cortafuegos sólo al servidor 8.8.8.8. Comprueba que no puedes hacer un dig @1.1.1.1. Vamos a añadir esta regla :\njaviercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 8.8.8.8 udp dport 53 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 8.8.8.8 udp sport 53 ct state established counter accept Ahora vamos a comprobar que a traves de la 1.1.1.1 no podemos resolver nombres pero con la 8.8.8.8 si :\njaviercruces@router-fw:~$ dig @1.1.1.1 www.javiercd.es ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @1.1.1.1 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; no servers could be reached javiercruces@router-fw:~$ dig @8.8.8.8 www.javiercd.es ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @8.8.8.8 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 4046 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.javiercd.es.\tIN\tA ;; ANSWER SECTION: www.javiercd.es.\t3600\tIN\tCNAME\tjavierasping.github.io. javierasping.github.io.\t3600\tIN\tA\t185.199.108.153 javierasping.github.io.\t3600\tIN\tA\t185.199.109.153 javierasping.github.io.\t3600\tIN\tA\t185.199.110.153 javierasping.github.io.\t3600\tIN\tA\t185.199.111.153 ;; Query time: 68 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP) ;; WHEN: Wed Feb 28 11:09:05 UTC 2024 ;; MSG SIZE rcvd: 144 Vamos a ver los hits de las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens3\u0026#34; ip saddr 8.8.8.8 udp sport 53 ct state established counter packets 314 bytes 36448 accept oifname \u0026#34;ens3\u0026#34; ip daddr 8.8.8.8 udp dport 53 ct state established,new counter packets 314 bytes 21912 accept Permite que la máquina cortafuegos pueda navegar por https. Vamos a añadir la regla :\njaviercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp dport 443 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp sport 443 ct state established counter accept Vamos a comprobar que pidiendo las cabeceras , que es similar a navegar podemos ver un código 200 en https :\njaviercruces@router-fw:~$ curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sun, 25 Feb 2024 23:03:49 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65dbc755-675b\u0026#34; expires: Wed, 28 Feb 2024 10:10:17 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: 5CD4:0E10:CBDBE5:CFBAEA:65DF0430 accept-ranges: bytes date: Wed, 28 Feb 2024 11:10:32 GMT via: 1.1 varnish age: 0 x-served-by: cache-mad22033-MAD x-cache: HIT x-cache-hits: 1 x-timer: S1709118632.338441,VS0,VE131 vary: Accept-Encoding x-fastly-request-id: 01056938385ca0e465882fa75fd0b19d0973df62 content-length: 26459 Los equipos de la red local deben poder tener conexión al exterior. SNAT realizado anteriormente\nPermitimos el ssh desde el cortafuegos a la LAN Permitido por regla anterior\nPermitimos hacer ping desde la LAN a la máquina cortafuegos. javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; icmp type echo-request counter accept Realizamos el ping desde LAN al cortafuegos\ndebian@lan:~$ ping 192.168.100.2 PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data. 64 bytes from 192.168.100.2: icmp_seq=1 ttl=64 time=1.09 ms 64 bytes from 192.168.100.2: icmp_seq=2 ttl=64 time=1.75 ms ^C --- 192.168.100.2 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 1.091/1.419/1.748/0.328 ms Veremos los hits para esta regla en concreto :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens4\u0026#34; icmp type echo-request counter packets 2 bytes 168 accept oifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter packets 2 bytes 168 accept Permite realizar conexiones ssh desde los equipos de la LAN Vamos a hacer las reglas :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter accept Vamos a conectarnos por ssh a una maquina fuera de la lan :\ndebian@lan:~$ ssh javiercruces@172.22.200.47 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Feb 28 10:36:26 2024 from 172.22.201.120 javiercruces@odin:~$ Vamos a ver los hits de estas reglas :\njaviercruces@router-fw:~$ sudo nft -a list table inet filter iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 10 bytes 3312 accept # handle 44 iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 7 bytes 3088 accept # handle 45 Instala un servidor de correos en la máquina de la LAN. Permite el acceso desde el exterior y desde el cortafuegos al servidor de correos. Para probarlo puedes ejecutar un telnet al puerto 25 tcp. Con estas reglas permitimos conectarnos desde fuera de la red al servidor de correos :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 25 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 25 ct state established counter accept # Regla DNAT puerto 25 javiercruces@router-fw:~$ sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 25 counter dnat to 192.168.100.10 Vamos a comprobarlo :\njaviercruces@HPOMEN15:~/Documentos/2ºASIR/SAD/cortafuegos1$ telnet 172.22.201.120 25 Trying 172.22.201.120... Connected to 172.22.201.120. Escape character is \u0026#39;^]\u0026#39;. 220 lan.openstacklocal ESMTP Postfix (Debian/GNU) Connection closed by foreign host. Vamos a ver los hits en las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset # Reglas para permitir el trafico iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 25 ct state established,new counter packets 10 bytes 544 accept # handle 46 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 25 ct state established counter packets 9 bytes 613 accept # Regla DNAT iifname \u0026#34;ens3\u0026#34; tcp dport 25 counter packets 1 bytes 60 dnat to 192.168.100.10 Permite hacer conexiones ssh desde exterior a la LAN Para ello voy a hacer un DNAT al puerto 2222 y a permitir ese trafico\n# Reglas para permitir el trafico del DNAT javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 2222 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 2222 ct state established counter accept # Regla DNAT puerto 2222 para ssh sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter dnat to 192.168.100.10 He cambiado el puerto del servicio ssh de lan al 2222 , voy a conectarme desde fuera a la LAN por ssh :\njaviercruces@HPOMEN15:~/Documentos/2ºASIR/SAD/cortafuegos1$ ssh -p 2222 debian@172.22.201.120 Linux lan 6.1.0-12-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Feb 28 14:12:18 2024 from 192.168.100.2 debian@lan:~$ Vamos a comprobar los hits de las reglas :\n# Reglas para permitir el ssh 2222 desde fuera hacia la LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 2222 ct state established,new counter packets 54 bytes 9784 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 2222 ct state established counter packets 44 bytes 10494 accept # Regla DNAT iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter packets 5 bytes 300 dnat to 192.168.100.10 Modifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22. Para esto vamos a eliminar las 3 reglas anteriores y añadiremos las siguientes :\n# Permitimos el trafico que ahora \u0026#34;cambiamos\u0026#34; el puerto con la regla DNAT de 2222 a 22 javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept # Regla DNAT javiercruces@router-fw:~$ sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter dnat to 192.168.100.10 Ahora vamos a comprobar que podemos conectarnos desde el exterior a la LAN aunque ahora hemos cambiado el servidor ssh de LAN para que escuche en el puerto 22 :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 34 bytes 7868 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 32 bytes 9066 accept iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter packets 7 bytes 420 dnat to 192.168.100.10:22 Permite hacer consultas DNS desde la LAN sólo al servidor 8.8.8.8. Comprueba que no puedes hacer un dig @1.1.1.1. Vamos a borrar la regla anterior que permite las consultas DNS :\njaviercruces@router-fw:~$ sudo nft -a list table inet filter iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 285 bytes 17036 accept # handle 35 javiercruces@router-fw:~$ sudo nft delete rule inet filter forward handle 35 Añadimos la regla nueva para permitir solo consultas al 8.8.8.8 :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ip daddr 8.8.8.8 counter accept Vamos a comprobarlo :\ndebian@lan:~$ dig @1.1.1.1 www.javiercd.es ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @1.1.1.1 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; no servers could be reached debian@lan:~$ dig @8.8.8.8 www.javiercd.es ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @8.8.8.8 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 59302 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.javiercd.es.\tIN\tA ;; ANSWER SECTION: www.javiercd.es.\t3600\tIN\tCNAME\tjavierasping.github.io. javierasping.github.io.\t3600\tIN\tA\t185.199.108.153 javierasping.github.io.\t3600\tIN\tA\t185.199.109.153 javierasping.github.io.\t3600\tIN\tA\t185.199.110.153 javierasping.github.io.\t3600\tIN\tA\t185.199.111.153 ;; Query time: 72 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP) ;; WHEN: Wed Feb 28 14:44:29 UTC 2024 ;; MSG SIZE rcvd: 144 Vamos a ver los hits de las reglas :\njaviercruces@router-fw:~$ sudo nft -a list table inet filter iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ip daddr 8.8.8.8 counter packets 3 bytes 218 accept # handle 53 Permite que los equipos de la LAN puedan navegar por internet, excepto a la página www.realbetisbalompie.es Tenemos un problema y es que nftables solo filtra hasta el nivel de transporte , es decir por puerto . Así que no podemos leer el dominio ya que este viaja en una cabecera del nivel de aplicación .\nPara prohibirlo , tendremos que bloquear esa IP en su totalidad para un determinado puerto , en mi caso van a ser el 80 y 443.\nVamos a averiguar las IPS del dominio que queremos bloquear :\njaviercruces@router-fw:~$ dig +short www.realbetisbalompie.es realbetisbalompie.es. 51.255.76.196 La añadiremos al principio de la cadena en lugar de add añadimos la palabra insert :\njaviercruces@router-fw:~$ sudo nft insert rule inet filter forward ip daddr 51.255.76.196 tcp dport {80, 443} iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; counter drop Y ahora no podremos navegar en la pagina del maligno :\ndebian@lan:~$ curl -I https://www.realbetisbalompie.es/ curl: (28) Failed to connect to www.realbetisbalompie.es port 443 after 129885 ms: Couldn\u0026#39;t connect to server Vamos a ver los hits de la regla que nos protege del mal :\njaviercruces@router-fw:~$ sudo nft list ruleset ip daddr 51.255.76.196 tcp dport { 80, 443 } iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; counter packets 7 bytes 420 drop Hacer las reglas persistentes Vamos a guardar las reglas con :\nrott@router-fw:/home/javiercruces# nft list ruleset \u0026gt; /etc/nftables.conf Si las queremos restaurar :\njaviercruces@router-fw:~$ sudo nft -f /etc/nftables.conf Para hacer que al reiniciar las reglas se restauren solas :\n# Creamos la unidad de systemd javiercruces@router-fw:~$ sudo cat /etc/systemd/system/nftables-persistent.service [Unit] Description=Cargar reglas de nftables al iniciar el sistema [Service] Type=oneshot ExecStart=/usr/sbin/nft -f /etc/nftables/nftables.rules [Install] WantedBy=multi-user.target # Activa el servicio para que al reiniciar se apliquen los cambios javiercruces@router-fw:~$ sudo systemctl enable nftables-persistent.service Reglas al final del ejercicio Te dejo la lista de las reglas en el estado del ultimo ejercicio :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 34414 bytes 6500685 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 21235 bytes 1526616 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 11648 bytes 1793088 accept iifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept iifname \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 66 bytes 18624 accept iifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp sport 443 ct state established counter packets 519 bytes 3016033 accept iifname \u0026#34;ens3\u0026#34; ip saddr 8.8.8.8 udp sport 53 ct state established counter packets 557 bytes 68077 accept iifname \u0026#34;ens4\u0026#34; icmp type echo-request counter packets 2 bytes 168 accept } chain output { type filter hook output priority filter; policy drop; counter packets 86303 bytes 8331992 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 15004 bytes 3534878 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 14125 bytes 950568 accept oifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept oifname \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 89 bytes 16572 accept oifname \u0026#34;ens3\u0026#34; ip daddr 8.8.8.8 udp dport 53 ct state established,new counter packets 557 bytes 36254 accept oifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp dport 443 ct state established,new counter packets 367 bytes 25011 accept oifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter packets 2 bytes 168 accept } chain forward { type filter hook forward priority filter; policy drop; ip daddr 51.255.76.196 tcp dport { 80, 443 } iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; counter packets 7 bytes 420 drop counter packets 45573 bytes 149083811 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter packets 32 bytes 2688 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter packets 18 bytes 1512 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 664 bytes 101857 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80, 443 } ct state established,new counter packets 34813 bytes 1843071 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80, 443 } ct state established counter packets 7583 bytes 146852066 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 80 ct state established,new counter packets 47 bytes 3905 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter packets 32 bytes 24161 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 72 bytes 18540 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 56 bytes 17296 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 25 ct state established,new counter packets 10 bytes 544 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 25 ct state established counter packets 9 bytes 613 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 90 bytes 17200 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 77 bytes 19296 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ip daddr 8.8.8.8 counter packets 81 bytes 5250 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; iifname \u0026#34;ens3\u0026#34; tcp dport 80 counter packets 4 bytes 240 dnat to 192.168.100.10 iifname \u0026#34;ens3\u0026#34; tcp dport 25 counter packets 1 bytes 60 dnat to 192.168.100.10 iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter packets 8 bytes 480 dnat to 192.168.100.10:22 } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 916 bytes 61536 masquerade } } ","date":"March 28, 2024","hero":"/images/cortafuegos/nftables1.png","permalink":"https://www.javiercd.es/posts/cortafuegos/nftables_uno/cortafuegos_uno/","summary":"\u003cp\u003eEn este post sobre un escenario con maquinas Debian , aplicaremos reglas con Nftables para conrtrolar el trafico que entra y sale en nuestra red , intentando imitar un escenario.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nPara desplegar el escenario para realizar estos ejercicios necesitaras desplegar el fichero .yaml que encontraras en el enlace del párrafo siguiente . Este se encargara de desplegar 2 maquinas una que hará de cortafuegos y otra que simulara un cliente que estará conectado a la primera maquina para simular una red local .\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","NFTABLES"],"title":"Implementación de un cortafuegos perimetral con Nftables I"},{"categories":null,"contents":"Sobre el escenario creado en el módulo de servicios con las máquinas Odin (Router), Hela (DMZ), Loki y Thor (LAN) y empleando nftables, configura un cortafuegos perimetral en la máquina Odin de forma que el escenario siga funcionando completamente teniendo en cuenta los siguientes puntos:\n• Se valorará la creación de cadenas diferentes para cada flujo de tráfico (de LAN al exterior, de LAN a DMZ, etc…). • Política por defecto DROP para todas las cadenas. • Se pueden usar las extensiones que creamos adecuadas, pero al menos debe implementarse seguimiento de la conexión cuando sea necesario. • Debemos implementar que el cortafuegos funcione después de un reinicio de la máquina. • Debes mostrar pruebas de funcionamiento de todas las reglas. Para no hacer demasiado larga la practica , voy a mostrarte los hits de las reglas al final , así como el script completo de las reglas . Ya que solo te pondré en cada ejercicio las reglas que intervienen y una comprobación del mismo .\nMontar el escenario con Nftables Voy a eliminar iptables y vamos a pasar a Nftables para que no perdamos ninguna funcionalidad del escenario .\nLo primero sera crear las tablas y cadenas :\njaviercruces@odin:~$ sudo nft add table inet filter javiercruces@odin:~$ sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; } javiercruces@odin:~$ sudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; } javiercruces@odin:~$ sudo nft add chain inet filter WAN_LAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter WAN_DMZ { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter LAN_WAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter LAN_DMZ { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter DMZ_LAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter DMZ_WAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} Así quedarían nuestras cadenas creadas :\njaviercruces@odin:~$ sudo nft list chains table inet filter { chain input { type filter hook input priority filter; policy accept; } chain output { type filter hook output priority filter; policy accept; } chain WAN_LAN { type filter hook forward priority filter; policy accept; } chain WAN_DMZ { type filter hook forward priority filter; policy accept; } chain LAN_WAN { type filter hook forward priority filter; policy accept; } chain DMZ_LAN { type filter hook forward priority filter; policy accept; } chain LAN_DMZ { type filter hook forward priority filter; policy accept; } chain DMZ_WAN { type filter hook forward priority filter; policy accept; } } La red LAN corresponde a la red de los contenedores 192.168.0.0/24 . La red DMZ corresponde a la red de hela 172.16.0.0/16 .\nContinuamos creando la tabla de NAT para poder configurar el SNAT y el DNAT , estas ya que suelen ser un numero reducido de reglas no voy a crear distintas cadenas :\n# Creamos la tabla NAT javiercruces@odin:~$ sudo nft add table nat # Cadena para el DNAT javiercruces@odin:~$ sudo nft add chain nat prerouting { type nat hook prerouting priority 0 \\; } # Cadena para el SNAT javiercruces@odin:~$ sudo nft add chain nat postrouting { type nat hook postrouting priority 100 \\; } Reglas SNAT Una vez hecho esto voy a crear las reglas de SNAT para que nuestros clientes puedan salir a Internet en la red LAN y DMZ :\nMi tarjeta de red que esta de cara al exterior es la ens4 .\n# Regla SNAT para LAN sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter masquerade # Regla SNAT para DMZ sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; iffname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 counter masquerade sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter snat to 172.22.200.47 sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter snat to 172.22.200.47 Vamos a comprobar que en los clientes ya pueden acceder a Internet , actualmente la política por defecto es ACCEPT.\nComprobación de SNAT en Hela :\n[javiercruces@hela ~]$ ping www.javiercd.es -c 1 PING javierasping.github.io (185.199.109.153) 56(84) bytes of data. 64 bytes from cdn-185-199-109-153.github.com (185.199.109.153): icmp_seq=1 ttl=51 time=39.4 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 39.439/39.439/39.439/0.000 ms Comprobación de SNAT en Thor :\njaviercruces@thor:~$ ping www.javiercd.es -c 1 PING javierasping.github.io (185.199.108.153) 56(84) bytes of data. 64 bytes from cdn-185-199-108-153.github.com (185.199.108.153): icmp_seq=1 ttl=51 time=38.1 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 38.138/38.138/38.138/0.000 ms Comprobación de SNAT en Loki :\njaviercruces@loki:~$ ping www.javiercd.es -c 1 PING javierasping.github.io (185.199.111.153) 56(84) bytes of data. 64 bytes from cdn-185-199-111-153.github.com (185.199.111.153): icmp_seq=1 ttl=51 time=37.7 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.667/37.667/37.667/0.000 ms Por ultimo nos aseguraremos de que la regla recibe hits :\njaviercruces@odin:~$ sudo nft list ruleset # Salida del comando recortada chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter packets 11 bytes 868 masquerade oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter packets 122 bytes 10594 masquerade } } Reglas de DNAT Las reglas anteriores que teníamos eran las siguientes :\njaviercruces@odin:~$ sudo iptables -L -t nat Chain PREROUTING (policy ACCEPT) target prot opt source destination DNAT tcp -- anywhere anywhere tcp dpt:http to:172.16.0.200 DNAT udp -- anywhere anywhere udp dpt:domain to:192.168.0.2 DNAT tcp -- anywhere anywhere tcp dpt:smtp to:192.168.0.3 DNAT tcp -- anywhere anywhere tcp dpt:mysql to:192.168.0.3 Así que vamos a pasarlas a nftables :\n# Para un wordpress que hay en hela sudo nft add rule ip nat prerouting tcp dport 80 counter dnat to 172.16.0.200 # Para hacer consultas DNS a thor sudo nft add rule ip nat prerouting udp dport 53 counter dnat to 192.168.0.2 # Para poder recibir correos en loki sudo nft add rule ip nat prerouting tcp dport 25 counter dnat to 192.168.0.3 # Para acceder desde fuera a un mysql que hay en loki sudo nft add rule ip nat prerouting tcp dport 3306 counter dnat to 192.168.0.3 Ahora vamos a añadir una series de reglas para permitir el trafico anterior y el resto de la preparacion del escenario :\n# PERMITIR USO DE ODIN ## Permitir consultas DNS de odin a thor (DNSSERVER) sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir tráfico HTTP y HTTPS en odin sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp sport { 80,443 } ct state established counter accept # Permitir conexiones SSH por el puerto 2222 sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Permitir conexiones SSH de odin a hela sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter accept # Permitir conexiones ssh de odin a thor y loki sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter accept # Reglas perimetrales ## Permitir consultas DNS desde br-intra hacia ens4 , necesario para el forward del dns (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir consultas dns desde LAN a DMZ (hela --\u0026gt; thor) (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept ## Reglas para permitir trafico a wordpress en hela sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept # Regla para hacer consultas DNS a thor (Permitir DNAT) sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 udp dport 53 ct state new,established counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.2 udp sport 53 ct state established,related counter accept # Regla para recibir e enviar correos en loki sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state new,established counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept # Permitir a hela usar el servidor LDAP sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp dport 389 counter accept sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport 389 counter accept Ejercicios El cortafuegos debe cumplir al menos estas reglas:\nLa máquina Odin tiene un servidor ssh escuchando por el puerto 22, pero al acceder desde el exterior habrá que conectar al puerto 2222. Para realizar este ejercicio voy a hacer un DNAT a la interfaz de DMZ de odin que es la 192.168.0.1 , asi me conectare a esa interfaz por ssh . Posteriomente hay que permitir este trafico que va desde la ens4 a la ens3 .\n# Permitimos el trafico que ahora \u0026#34;cambiamos\u0026#34; el puerto con la regla DNAT de 2222 a 22 hacia odin sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Regla DNAT sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 Pondré la política por defecto DROP una vez llegado a este punto :\nsudo nft chain inet filter input { policy drop \\; } sudo nft chain inet filter output { policy drop \\; } sudo nft chain inet filter WAN_LAN { policy drop \\; } sudo nft chain inet filter WAN_DMZ { policy drop \\; } sudo nft chain inet filter LAN_WAN { policy drop \\; } sudo nft chain inet filter DMZ_LAN { policy drop \\; } sudo nft chain inet filter LAN_DMZ { policy drop \\; } sudo nft chain inet filter DMZ_WAN { policy drop \\; } Y vamos a comprobar que la conexión funciona por el puerto 2222 :\njaviercruces@HPOMEN15:~$ ssh 172.22.200.47 -p 2222 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Mar 9 13:49:09 2024 from 172.29.0.58 javiercruces@odin:~$ Comprobamos los hits en las reglas :\njaviercruces@odin:~$ sudo nft list ruleset # IMPUT iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state established,new counter packets 241918 bytes 13788652 accept #OUTPUT oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter packets 355383 bytes 210012030 accept #DNAT iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter packets 5 bytes 300 dnat to 192.168.0.1:22 Desde Thor y Hela se debe permitir la conexión ssh por el puerto 22 a la máquina Odin. Para poder comprobar estas reglas voy a permitir las conexiones ssh desde Odin a ambas redes DMZ y LAN\n# Permitir conexiones ssh de odin a hela sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter accept # Permitir conexiones ssh de odin a thor y loki sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter accept # Permitir conexion ssh desde hela a odin sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.200 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 ct state established counter accept # Permitir conexion ssh desde thor a odin sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.2 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 tcp sport 22 ct state established counter accept Vamos a comprobar las 2 reglas anteriores conectándonos a Odin por ssh desde estos dos clientes :\n#Hela --\u0026gt; Odin javiercruces@odin:~$ ssh 172.16.0.200 -A Last login: Sat Mar 9 19:02:49 2024 from 172.16.0.1 [javiercruces@hela ~]$ ssh 172.16.0.1 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Mar 9 19:49:28 2024 from 192.168.0.2 javiercruces@odin:~$ # Thor --\u0026gt; Odin javiercruces@thor:~$ ssh 192.168.0.1 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Mar 9 19:46:12 2024 from 192.168.0.2 javiercruces@odin:~$ Te dejare los hits de las reglas al final de la practica .\nLa máquina Odin debe tener permitido el tráfico para la interfaz loopback. sudo nft add rule inet filter input iifname \u0026#34;lo\u0026#34; counter accept sudo nft add rule inet filter output oifname \u0026#34;lo\u0026#34; counter accept Comprobación :\njaviercruces@odin:~$ ping 127.0.0.1 -c 1 PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.100 ms --- 127.0.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.100/0.100/0.100/0.000 ms A la máquina Odin se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexión (REJECT) y desde el exterior se rechazará de manera silenciosa. # DMZ sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-reply counter accept # Las siguientes 2 reglas , no funcionaran como esperamos ya que hacen lo mismo que la politica por defecto , ademas no se permite este trafico . # LAN sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip protocol icmp counter reject # Exterior sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol icmp counter drop Vamos a comprobar estas reglas :\n# LAN Thor a odin javiercruces@thor:~$ ping 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. From 192.168.0.1 icmp_seq=1 Destination Port Unreachable # DMZ , Hela --\u0026gt; Odin [javiercruces@hela ~]$ ping 172.16.0.1 -c 1 PING 172.16.0.1 (172.16.0.1) 56(84) bytes of data. 64 bytes from 172.16.0.1: icmp_seq=1 ttl=64 time=0.471 ms --- 172.16.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.471/0.471/0.471/0.000 ms # Exterior a odin javiercruces@HPOMEN15:~$ ping 172.22.200.47 PING 172.22.200.47 (172.22.200.47) 56(84) bytes of data. ^C --- 172.22.200.47 ping statistics --- 419 packets transmitted, 0 received, 100% packet loss, time 428036ms Al final de la practica te dejare todos los hits de las reglas .\nLa máquina Odin puede hacer ping a la LAN, la DMZ y al exterior. # PERMITIR PING A DMZ sudo nft insert rule inet filter output oifname \u0026#34;ens3\u0026#34; icmp type echo-request counter accept sudo nft insert rule inet filter input iifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter accept # PERMITIR PING A EXTERIOR sudo nft insert rule inet filter output oifname \u0026#34;ens4\u0026#34; icmp type echo-request counter accept sudo nft insert rule inet filter input iifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter accept # PERMITIR PING A LAN sudo nft insert rule inet filter output oifname \u0026#34;br-intra2\u0026#34; icmp type echo-request counter accept sudo nft insert rule inet filter input iifname \u0026#34;br-intra2\u0026#34; icmp type echo-reply counter accept Comprobación :\njaviercruces@odin:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=116 time=8.70 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 8.701/8.701/8.701/0.000 ms javiercruces@odin:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=64 time=6.030 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.030/0.030/0.030/0.000 ms javiercruces@odin:~$ ping 172.16.0.200 -c 1 PING 172.16.0.200 (172.16.0.200) 56(84) bytes of data. 64 bytes from 172.16.0.200: icmp_seq=1 ttl=63 time=59.1 ms --- 172.16.0.200 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 59.052/59.052/59.052/0.000 ms Desde la máquina Hela se puede hacer ping y conexión ssh a las máquinas de la LAN. ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept Comprobación :\n[javiercruces@hela ~]$ ping 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=0.596 ms ^C --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.596/0.596/0.596/0.000 ms [javiercruces@hela ~]$ ssh 192.168.0.2 Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 6.1.0-18-amd64 x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Sun Mar 10 14:52:57 2024 from 192.168.0.1 javiercruces@thor:~$ Desde cualquier máquina de la LAN se puede conectar por ssh a la máquina Hela. ## Si no esta en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept Comprobación :\njaviercruces@thor:~$ ssh 172.16.0.200 Last login: Sun Mar 10 14:53:12 2024 from 192.168.0.2 [javiercruces@hela ~]$ Configura la máquina Odin para que las máquinas de LAN y DMZ puedan acceder al exterior. Estas reglas ya estaban indicadas previamente .\nsudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter masquerade sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter masquerade Las máquinas de la LAN pueden hacer ping al exterior y navegar. # Las máquinas de la LAN pueden hacer ping al exterior y navegar. ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter WAN_LAN iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept Comprobación :\njaviercruces@thor:~$ curl -I https://www.javiercd.es HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sat, 02 Mar 2024 10:17:01 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65e2fc9d-675b\u0026#34; expires: Sun, 10 Mar 2024 15:35:43 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: E24C:3800B1:1881E48:18E9A93:65EDD0F7 accept-ranges: bytes date: Sun, 10 Mar 2024 19:14:10 GMT via: 1.1 varnish age: 60 x-served-by: cache-mad22083-MAD x-cache: HIT x-cache-hits: 1 x-timer: S1710098050.166466,VS0,VE2 vary: Accept-Encoding x-fastly-request-id: 0c6c80bbef19370976aadfc6988441c5a36beccc content-length: 26459 javiercruces@thor:~$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=110 time=38.5 ms ^C --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 38.451/38.451/38.451/0.000 ms La máquina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes aún. # La máquina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes aún. # Hela ya tiene permitido hacer consultas dns a thor sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport {80, 443} counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport {80, 443} counter accept Compruebo que puedo navegar :\n[root@hela javiercruces]# curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sat, 02 Mar 2024 10:17:01 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65e2fc9d-675b\u0026#34; expires: Sun, 10 Mar 2024 15:35:43 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: E24C:3800B1:1881E48:18E9A93:65EDD0F7 accept-ranges: bytes date: Sun, 10 Mar 2024 19:13:17 GMT via: 1.1 varnish age: 7 x-served-by: cache-mad22067-MAD x-cache: HIT x-cache-hits: 1 x-timer: S1710097997.474757,VS0,VE2 vary: Accept-Encoding x-fastly-request-id: 2d2811893898abf05bebd96c6bd5a09ed7abfe5b content-length: 26459 Entiendo que quieres que instale estos 3 servicios en hela . En nuestro escenario son las otras maquinas quien alberga estos servicios .\nConfigura la máquina Odin para que los servicios web y ftp sean accesibles desde el exterior. El servidor web ya esta configurado previamente en la migración del escenario .\nsudo nft add rule ip nat prerouting tcp dport 21 counter dnat to 172.16.0.200 # No funcionan en cadenas separadas #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept El servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior. El servidor FTP esta en la LAN así que ya es accesible , voy a hacer que sea accesible desde la DMZ . Desde el exterior ambos , ya son accesibles.\n## No funcionan las reglass en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept Acceso desde la DMZ a LAN :\njaviercruces@thor:~$ curl 172.16.0.200 \u0026lt;!DOCTYPE html\u0026gt; javiercruces@thor:~$ ftp 172.16.0.200 Connected to 172.16.0.200. 220 (vsFTPd 3.0.5) El servidor de correos sólo debe ser accesible desde la LAN. Comentamos las lineas de la preparación del escenario que permito el acceso a este y añadimos :\n# No funciona en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept Accedemos a el :\n[root@hela javiercruces]# telnet 192.168.0.3 25 Trying 192.168.0.3... Connected to 192.168.0.3. Escape character is \u0026#39;^]\u0026#39;. 220 loki.javiercd.gonzalonazareno.org ESMTP Postfix (Ubuntu) En la máquina Loki instala un servidor Postgres si no lo tiene aún. A este servidor se puede acceder desde la DMZ, pero no desde el exterior. # no funciona en cadenas distintas #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept Accedemos al servidor postgree desde hela :\n[root@hela javiercruces]# psql -h 192.168.0.3 -U postgres Password for user postgres: psql (13.14, server 14.11 (Ubuntu 14.11-0ubuntu0.22.04.1)) WARNING: psql major version 13, server major version 14. Some psql features might not work. SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off) Type \u0026#34;help\u0026#34; for help. postgres=# Evita ataques DoS por ICMP Flood, limitando a 4 el número de peticiones por segundo desde una misma IP. sudo nft insert rule inet filter input icmp type echo-request limit rate 1/second burst 4 packets counter drop Si le hacemos un ataque de flood , este cortara el trafico :\n[root@hela javiercruces]# hping3 --icmp --flood --rand-source 172.16.0.1 HPING 172.16.0.1 (eth0 172.16.0.1): icmp mode set, 28 headers + 0 data bytes hping in flood mode, no replies will be shown icmp type echo-request limit rate 1/second burst 4 packets counter packets 46 bytes 2128 drop Evita ataques DoS por SYN Flood. # Evita ataques DoS por SYN Flood. sudo nft add rule inet filter input tcp flags \\\u0026amp; \u0026#39;(fin|syn|rst|ack) == syn\u0026#39; counter limit rate over 25/second drop Si probamos el ataque :\n[root@hela javiercruces]# hping3 --flood --rand-source 172.16.0.1 HPING 172.16.0.1 (eth0 172.16.0.1): NO FLAGS are set, 40 headers + 0 data bytes hping in flood mode, no replies will be shown ^C --- 172.16.0.1 hping statistic --- 1267916 packets transmitted, 0 packets received, 100% packet loss round-trip min/avg/max = 0.0/0.0/0.0 ms icmp type echo-request limit rate 1/second burst 4 packets counter packets 31 bytes 2492 drop Script con todas las reglas Te dejo aquí el script que he utilizado durante la practica .\n# Crear estructura de tablas sudo nft delete table inet filter sudo nft delete table ip nat ## Añadir tabla filter y sus cadenas sudo nft add table inet filter sudo nft add chain inet filter forward { type filter hook forward priority 10\\; counter \\; policy drop\\; } sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy drop \\; } sudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy drop \\; } sudo nft add chain inet filter WAN_LAN { type filter hook forward priority 1\\; counter \\; policy accept \\;} sudo nft add chain inet filter WAN_DMZ { type filter hook forward priority 2\\; counter \\; policy accept \\;} sudo nft add chain inet filter LAN_WAN { type filter hook forward priority 3\\; counter \\; policy accept \\;} sudo nft add chain inet filter LAN_DMZ { type filter hook forward priority 4\\; counter \\; policy accept \\;} sudo nft add chain inet filter DMZ_LAN { type filter hook forward priority 5\\; counter \\; policy accept \\;} sudo nft add chain inet filter DMZ_WAN { type filter hook forward priority 6\\; counter \\; policy accept \\;} ## Añadir Tabla NAT y sus cadenas : sudo nft add table ip nat sudo nft add chain ip nat prerouting { type nat hook prerouting priority 0 \\; } sudo nft add chain ip nat postrouting { type nat hook postrouting priority 100 \\; } # Reglas para mantener el escenario de clase anterior con IPTABLES ## Reglas SNAT ### Regla SNAT para LAN sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter masquerade ### Regla SNAT para DMZ sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter masquerade ## Reglas DNAT # Para un wordpress que hay en hela sudo nft add rule ip nat prerouting tcp dport 80 counter dnat to 172.16.0.200 # Para hacer consultas DNS a thor #sudo nft add rule ip nat prerouting udp dport 53 counter dnat to 192.168.0.2 sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; ip saddr { 172.22.0.0/16, 172.19.0.0/16 } udp dport 53 counter dnat to 192.168.0.2 # Para poder recibir correos en loki sudo nft add rule ip nat prerouting tcp dport 25 counter dnat to 192.168.0.3 # Para acceder desde fuera a un mysql que hay en loki sudo nft add rule ip nat prerouting tcp dport 3306 counter dnat to 192.168.0.3 # PERMITIR USO DE ODIN ## Permitir consultas DNS de odin a thor (DNSSERVER) sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir tráfico HTTP y HTTPS en odin sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp sport { 80,443 } ct state established counter accept # Permitir conexiones SSH por el puerto 2222 sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Permitir conexiones SSH de odin a hela sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter accept # Permitir conexiones ssh de odin a thor y loki sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter accept # Reglas perimetrales ## Permitir consultas DNS desde br-intra hacia ens4 , necesario para el forward del dns (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir consultas dns desde LAN a DMZ (hela --\u0026gt; thor) (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept ## Reglas para permitir trafico a wordpress en hela sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept # Regla para hacer consultas DNS a thor (Permitir DNAT) sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 udp dport 53 ct state new,established counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.2 udp sport 53 ct state established,related counter accept # Regla para recibir e enviar correos en loki # No funcionan en cadenas separadas #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state new,established counter accept #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state new,established counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept # Permitir a hela usar el servidor LDAP sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp dport 389 counter accept sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport 389 counter accept # Ejercicios practica ## Permitir conexiones SSH por el puerto 2222 #sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 #sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept #sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Desde Thor y Hela se debe permitir la conexión ssh por el puerto 22 a la máquina Odin. ## Permitir conexion ssh desde hela a odin sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.200 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 ct state established counter accept ## Permitir conexion ssh desde thor a odin sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.2 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 tcp sport 22 ct state established counter accept #La máquina Odin debe tener permitido el tráfico para la interfaz loopback. sudo nft add rule inet filter input iifname \u0026#34;lo\u0026#34; counter accept sudo nft add rule inet filter output oifname \u0026#34;lo\u0026#34; counter accept # A la máquina Odin se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexión (REJECT) y desde el exterior se rechazará de manera silenciosa. sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-reply counter accept ## Denegar la conexion desde LAN REJECT sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip protocol icmp counter reject ## Denegar de manera silenciosa desde EXTERIOR sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol icmp counter drop # La máquina Odin puede hacer ping a la LAN, la DMZ y al exterior. ## LAN sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; icmp type echo-request counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter accept ## EXTERIOR sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; icmp type echo-request counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter accept ## DMZ sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; icmp type echo-request counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; icmp type echo-reply counter accept #### Desde la máquina Hela se puede hacer ping y conexión ssh a las máquinas de la LAN. sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept # Desde cualquier máquina de la LAN se puede conectar por ssh a la máquina Hela. sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept ## Si no esta en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept # Configura la máquina Odin para que las máquinas de LAN y DMZ puedan acceder al exterior. ## SNAT hecho anteriormente # Las máquinas de la LAN pueden hacer ping al exterior y navegar. ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter WAN_LAN iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport {80, 443} counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp sport {80, 443} counter accept # La máquina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes aún. # Hela ya tiene permitido hacer consultas dns a thor sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport {80, 443} counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport {80, 443} counter accept # ### Configura la máquina Odin para que los servicios web y ftp sean accesibles desde el exterior. sudo nft add rule ip nat prerouting tcp dport 21 counter dnat to 172.16.0.200 # No funcionan en cadenas separadas #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept # ### El servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior. ## No funcionan las reglass en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept # ### El servidor de correos sólo debe ser accesible desde la LAN. # no funciona en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept # ### En la máquina Loki instala un servidor Postgres si no lo tiene aún. A este servidor se puede acceder desde la DMZ, pero no desde el exterior. # no funciona en cadenas distintas #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept # ### Evita ataques DoS por ICMP Flood, limitando a 4 el número de peticiones por segundo desde una misma IP. sudo nft insert rule inet filter input icmp type echo-request limit rate 1/second burst 4 packets counter drop # ### Evita ataques DoS por SYN Flood. #sudo nft insert rule inet filter input tcp flags \\\u0026amp; \u0026#39;(fin|syn|rst|ack) == syn\u0026#39; counter limit rate over 25/second drop #### Evita que realicen escaneos de puertos a Odin. #sudo nft insert rule inet filter input tcp flags \u0026amp; (fin|syn|rst|ack) == (syn) counter drop #sudo nft add rule inet filter output udp dport 53 counter accept #sudo nft add rule inet filter input udp sport 53 counter accept Hits de las reglas Cada vez que he ejecutado el script las reglas pierden los contadores pero así seria el esquema con todas las reglas al finalizar la practica :\njaviercruces@odin:~$ sudo nft list ruleset table inet filter { chain forward { type filter hook forward priority filter + 10; policy drop; counter packets 711 bytes 171730 iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter packets 107 bytes 8505 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter packets 107 bytes 93423 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter packets 11 bytes 758 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter packets 11 bytes 1818 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state established,new counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter packets 2 bytes 168 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter packets 2 bytes 168 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter packets 160 bytes 16502 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter packets 100 bytes 15086 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter packets 30 bytes 6041 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter packets 23 bytes 5213 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter packets 1 bytes 84 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter packets 1 bytes 84 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport { 80, 443 } counter packets 16 bytes 1666 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp sport { 80, 443 } counter packets 17 bytes 4947 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport { 80, 443 } counter packets 32 bytes 3332 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport { 80, 443 } counter packets 34 bytes 9903 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { established, new } counter packets 18 bytes 1064 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter packets 14 bytes 1348 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter packets 0 bytes 0 accept } chain input { type filter hook input priority filter; policy drop; icmp type echo-request limit rate 1/second burst 4 packets counter packets 13 bytes 1092 drop counter packets 1490 bytes 141906 iifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter packets 18 bytes 2352 accept iifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp sport { 80, 443 } ct state established counter packets 17 bytes 13286 accept iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state established,new counter packets 965 bytes 70084 accept iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter packets 356 bytes 39980 accept iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter packets 131 bytes 15952 accept iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.200 tcp dport 22 ct state established,new counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.2 tcp dport 22 ct state established,new counter packets 0 bytes 0 accept iifname \u0026#34;lo\u0026#34; counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-request counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; ip protocol icmp counter packets 1 bytes 84 reject with icmp port-unreachable iifname \u0026#34;ens3\u0026#34; ip protocol icmp counter packets 1 bytes 84 drop iifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 0 bytes 0 accept iifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept iifname \u0026#34;br-intra2\u0026#34; icmp type echo-reply counter packets 0 bytes 0 accept iifname \u0026#34;lo\u0026#34; counter packets 0 bytes 0 accept } chain output { type filter hook output priority filter; policy drop; counter packets 1404 bytes 207511 oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter packets 18 bytes 1304 accept oifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp dport { 80, 443 } ct state established,new counter packets 19 bytes 7331 accept oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter packets 577 bytes 142596 accept oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter packets 547 bytes 38208 accept oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter packets 194 bytes 14400 accept oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 ct state established counter packets 0 bytes 0 accept oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 tcp sport 22 ct state established counter packets 0 bytes 0 accept oifname \u0026#34;lo\u0026#34; counter packets 12 bytes 1008 accept oifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-reply counter packets 0 bytes 0 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept oifname \u0026#34;ens4\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept oifname \u0026#34;br-intra2\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept oifname \u0026#34;lo\u0026#34; counter packets 0 bytes 0 accept } chain WAN_LAN { type filter hook forward priority filter + 1; policy accept; counter packets 711 bytes 171730 } chain WAN_DMZ { type filter hook forward priority filter + 2; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter packets 107 bytes 93423 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 udp dport 53 ct state established,new counter packets 0 bytes 0 accept } chain LAN_WAN { type filter hook forward priority filter + 3; policy accept; counter packets 711 bytes 171730 } chain LAN_DMZ { type filter hook forward priority filter + 4; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter packets 11 bytes 758 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp dport 389 counter packets 0 bytes 0 accept } chain DMZ_LAN { type filter hook forward priority filter + 5; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter packets 11 bytes 1818 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport 389 counter packets 0 bytes 0 accept } chain DMZ_WAN { type filter hook forward priority filter + 6; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter packets 107 bytes 8505 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.2 udp sport 53 ct state established,related counter packets 0 bytes 0 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; tcp dport 80 counter packets 8 bytes 480 dnat to 172.16.0.200 iifname \u0026#34;ens3\u0026#34; ip saddr { 172.19.0.0/16, 172.22.0.0/16 } udp dport 53 counter packets 0 bytes 0 dnat to 192.168.0.2 tcp dport 25 counter packets 0 bytes 0 dnat to 192.168.0.3 tcp dport 3306 counter packets 12 bytes 720 dnat to 192.168.0.3 iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter packets 0 bytes 0 dnat to 192.168.0.1:22 tcp dport 21 counter packets 0 bytes 0 dnat to 172.16.0.200 } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter packets 109 bytes 8649 masquerade oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter packets 2 bytes 120 masquerade } } Hacer las reglas persistentes Vamos a guardar las reglas con :\nroot@odin:/home/javiercruces# nft list ruleset \u0026gt; /etc/nftables.conf Si las queremos restaurar :\njaviercruces@odin:~$ sudo nft -f /etc/nftables.conf Para hacer que al reiniciar las reglas se restauren solas :\n# Creamos la unidad de systemd javiercruces@odin:~$ sudo cat /etc/systemd/system/nftables-persistent.service [Unit] Description=Cargar reglas de nftables al iniciar el sistema [Service] Type=oneshot ExecStart=/usr/sbin/nft -f /etc/nftables/nftables.rules [Install] WantedBy=multi-user.target # Activa el servicio para que al reiniciar se apliquen los cambios javiercruces@odin:~$ sudo systemctl enable nftables-persistent.service ","date":"March 28, 2024","hero":"/images/cortafuegos/nftables2.png","permalink":"https://www.javiercd.es/posts/cortafuegos/nftables_dos/cortafuegos_dos/","summary":"\u003cp\u003eSobre el escenario creado en el módulo de servicios con las máquinas Odin (Router), Hela (DMZ), Loki y Thor (LAN) y empleando nftables, configura un cortafuegos perimetral en la máquina Odin de forma que el escenario siga funcionando completamente teniendo en cuenta los siguientes puntos:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e• Se valorará la creación de cadenas diferentes para cada flujo de tráfico (de LAN al exterior, de LAN a DMZ, etc…).\n• Política por defecto DROP para todas las cadenas.\n• Se pueden usar las extensiones que creamos adecuadas, pero al menos debe implementarse seguimiento de la conexión cuando sea necesario.\n• Debemos implementar que el cortafuegos funcione después de un reinicio de la máquina.\n• Debes mostrar pruebas de funcionamiento de todas las reglas.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePara no hacer demasiado larga la practica , voy a mostrarte los hits de las reglas al final , así como el script completo de las reglas . Ya que solo te pondré en cada ejercicio las reglas que intervienen y una comprobación del mismo .\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","NFTABLES"],"title":"Implementación de un cortafuegos perimetral con Nftables II"},{"categories":null,"contents":"La informática forense es el conjunto de técnicas que nos permite obtener la máxima información posible tras un incidente o delito informático. En esta práctica, realizarás la fase de toma de evidencias y análisis de las mismas sobre una máquina Linux y otra Windows. Supondremos que pillamos al delincuente \u0026lsquo;in fraganti\u0026rsquo; y las máquinas se encontraban encendidas. Opcionalmente, podéis realizar el análisis de un dispositivo Android. Sobre cada una de las máquinas debes realizar un volcado de memoria y otro de disco duro, tomando las medidas necesarias para certificar posteriormente la cadena de custodia.\nVolcado de las imágenes y memoria Windows Me voy a preparar el disco en el cual contiene las herramientas :\njaviercruces@HPOMEN15:~$ sudo guestmount -a /var/lib/libvirt/images/win_foresense-1.qcow2 -m /dev/sda1 /mnt/vdb/ javiercruces@HPOMEN15:~/Descargas$ sudo cp AccessData_FTK_Imager_4.7.1.exe /mnt/vdb Este lo pinchare en la maquina ya que le he instalado el FTK :\nVolcado de la memoria Así que vamos a proceder a sacar una imagen de la memoria :\nSeleccionamos donde la vamos a guardar :\nVolcado del registro Vamos a sacar el registro , para ello seleccionamos la opción de obtener ficheros protegidos :\nSeleccionare los ficheros de contraseñas y todos los registros , ademas lo guardare en el disco externo :\nVolcado de disco Para realizar el volcado de disco , seleccionaremos crear imagen de disco :\nNuestro disco de origen es un dispositivo físico , así que seleccionare esa opción :\nElegimos donde vamos a guardar la imagen , en mi caso en el disco externo :\nUna vez hecho , verificara la imagen creada :\nAquí tenemos los hash de la imagen del disco :\nTambién le haremos el volcado al disco de datos que esta cifrado :\nLos hashes del segundo disco :\nAhora voy a hacer llegar estos ficheros a mi maquina host , para ello montare el volumen de la mv en la cual he hecho los volcados de datos :\njaviercruces@HPOMEN15:~$ sudo guestmount -a /var/lib/libvirt/images/win10-2.qcow2 -m /dev/sda2 /mnt/vdb/ Para asegurarme de que las imagen de los discos no son manipuladas voy a sacarles a todas los hashes :\njaviercruces@HPOMEN15:~$ sudo find /mnt/vdb -type f -exec sha256sum {} + e1b9ce9b57957b1a0607a72a057d6b7a9b34ea60f3f8aa8f38a3af979bd23066 /mnt/vdb/$RECYCLE.BIN/S-1-5-21-1723251262-3026432737-944335575-1001/desktop.ini 57020f3e585d0f2a7ee783054c50886db4c65af1bbbe5e12e114dbf674326184 /mnt/vdb/AccessData_FTK_Imager_4.7.1.exe 91cbca5b445780e72522d872e0d229000849d6deb464ac707ee378c0c0e1794c /mnt/vdb/discodatos/discodatos.001 44ca1fe875ba863adbb5b2675acb3345122f8dee0ba3ce8e2c4cfb9c523d38b0 /mnt/vdb/discodatos/discodatos.001.txt 5a45f6418924d3eab3ea820b4bdb4a609e7f95a6f4665f043217593eeab5056e /mnt/vdb/discowin/discowin.001 aeb282e38ebe64be765b43e20a6a419ac1aa1ae4d6edd08cae3d8973bc0ac5a9 /mnt/vdb/discowin/discowin.001.txt 372a1157215515100f42e5a73adecc2407a1d8b586fa2c4770d2619d8094baf1 /mnt/vdb/discowin/discowin.002 e06c8472a09f209f23e49fb63195d8c471c86aea67e9587002b884ade22c8b97 /mnt/vdb/discowin/discowin.003 947ce5b6c2d7c8139de359723fecef351b1c6877b09647fb1d3015a4588f95df /mnt/vdb/discowin/discowin.004 7bc813aee24fd973f2c3563c66e92c3becbbe2a40e341e693b5c4c38df3c8eb8 /mnt/vdb/discowin/discowin.005 e7d920807e329ba1f9dfd3b6987a6c12efd7a3b9a0563302509db73d88862909 /mnt/vdb/discowin/discowin.006 94c1cd9d910a39a1df7852c69032d68cdaf8ba59b4849f84963f3728880e53c0 /mnt/vdb/discowin/discowin.007 fa01765ac897aa4c8a1c2e9569cf9b0c50c5aea2c947ae9bf932f0eec89986e3 /mnt/vdb/discowin/discowin.008 095a0b5d4e88826a88427f5a2e64d621f81315bd1307db21b34aa76fad65af84 /mnt/vdb/discowin/discowin.009 a70aa8c7c1c723d97d4845a87a33d47697d48edcacc7b9bc83f2510baee4237e /mnt/vdb/discowin/discowin.010 3e6b92b9764b3786091e5bb67e8ffb8c3271be4c977101da9fa14afa12fea171 /mnt/vdb/discowin/discowin.011 3e6b92b9764b3786091e5bb67e8ffb8c3271be4c977101da9fa14afa12fea171 /mnt/vdb/discowin/discowin.012 3e6b92b9764b3786091e5bb67e8ffb8c3271be4c977101da9fa14afa12fea171 /mnt/vdb/discowin/discowin.013 83954736003d261f58a1ce24f73cba37953df229fdfebd15d00245ba5a700197 /mnt/vdb/discowin/discowin.014 5353e34d4487ae5450be372e5ec37a0ca5dd746b206823abf561cd2af5d0d371 /mnt/vdb/memoria/memdump.mem e8380620a1d5a99c0a39da8a2c5a59af17dd4bff7a4d48d8652ecca9683ef099 /mnt/vdb/memoria/pagefile.sys 9cce8fc11ca271c3e528a48257bb5472c2f4cbdbb809c19895c36b1be51c3d0b /mnt/vdb/registro/default 816ab103521bcb7adcd11b5ac9359fc8f0de945fe10507411d0127bdcc24ff70 /mnt/vdb/registro/SAM cbac2073fe665e11e5d043c5ab054ae58c70687b0b59197559c4077e4fdaa696 /mnt/vdb/registro/SECURITY 7cd909de86fc9e9ecb73e3d432d68aa892053be3848b6c32d3aefffc347140f6 /mnt/vdb/registro/software 4cf3a831081ab8e890b5c297ed5238cecebdfecdb1805a3b2e391489cd48fe5b /mnt/vdb/registro/system 0e2961777eb214825652cc4b35b3b85dcfbdba2a58f5d2c1f586d8800abe9f83 /mnt/vdb/registro/Users/Default/NTUSER.DAT 59ffce3dd25b5f242f425a6dfdc642813f429bc0c19694aad1dcd5d2a9871c1f /mnt/vdb/registro/Users/javiercruces/Crypto/Keys/de7cf8a7901d2ad13e5c67c29e5d1662_42c962d9-bf79-4299-be81-eebad4e81473 ea127864137edff0844c2e5731c51d1d2ef22cb3a8030d413166df1114eae5a5 /mnt/vdb/registro/Users/javiercruces/NTUSER.DAT a564c8fa96557437d4b69e870ff8797a8beee20892a632735ac0a1f838ed453b /mnt/vdb/registro/Users/javiercruces/Protect/CREDHIST fb321d3671cf9f911f933e29fc9a099cd6834838c40d01fe6404b6975990c041 /mnt/vdb/registro/Users/javiercruces/Protect/S-1-5-21-1723251262-3026432737-944335575-1001/e8d02ff1-98d6-4ba4-99a4-1db28276ecda 13150cc91caed3c1d4321e8815afd5fc21eb4831eb1a93b40b4c9c48a4109fa1 /mnt/vdb/registro/Users/javiercruces/Protect/S-1-5-21-1723251262-3026432737-944335575-1001/Preferred 78596ecc21720053b44f78689bb06870bbe4f47029dc3d7e781cfe4d2d7a940f /mnt/vdb/registro/Users/javiercruces/UsrClass.dat Linux Volcado de disco javiercruces@debian:~/LiME/src$ lsblk -f NAME FSTYPE FSVER LABEL UUID FSAVAIL FSUSE% MOUNTPOINTS sda └─sda1 crypto 2 9fc1bfa7-9224-4e8e-896a-09516d4fd613 sr0 iso966 Jolie Debian 12.1.0 amd64 n 2023-07-22-10-52-30-00 vda ├─vda1 │ vfat FAT32 DB79-1C75 597,9M 37% /boot ├─vda2 │ ext4 1.0 6666d9d8-9a41-46e5-a370-0730f713d3a7 7,6G 52% / └─vda3 swap 1 e24babe0-340c-4b09-836e-dd5f447bcecc [SWAP] vdb └─vdb1 ext4 1.0 f79f0d79-209b-42b9-9087-5c72ee1595ee 54G 3% /mnt javiercruces@debian:~/LiME/src$ sudo dd if=/dev/vda2 of=/mnt/discoLinux.raw bs=64K 296784+0 records in 296784+0 records out 19450036224 bytes (19 GB, 18 GiB) copied, 27,2778 s, 713 MB/s javiercruces@debian:~/LiME/src$ Volcado de memoria javiercruces@debian:~$ git clone https://github.com/504ensicsLabs/LiME.git javiercruces@debian:~$ cd LiME/src/ javiercruces@debian:~/LiME/src$ make javiercruces@debian:~/LiME/src$ sudo insmod ./lime-6.1.0-18-amd64.ko \u0026#34;path=/mnt/vdb format=lime\u0026#34; javiercruces@HPOMEN15:~$ sudo guestmount -a /var/lib/libvirt/images/ASO-systemd-boot-1.qcow2 -m /dev/vda1 /mnt/vdb/ javiercruces@HPOMEN15:~$ sudo ls -l /mnt/vdb total 25023392 -rw-r--r-- 1 root root 19450036224 feb 18 12:07 discoLinux.raw drwx------ 2 root root 16384 feb 18 11:25 lost+found -rw-r--r-- 1 root root 1900818432 feb 18 11:47 memdebian.mem -r--r--r-- 1 root root 4273066304 feb 18 12:10 vdb Voy a guardarme los hashes de las imágenes :\njaviercruces@HPOMEN15:~$ sudo find /mnt/vdb -type f -exec sha256sum {} + 5f136603c0e34a74a58bc59f1934f5f2850ca8bec9c356a283ee7161a8f39a76 /mnt/vdb/memdebian.mem b63693142f2823a95a11d9f1fcbd845c118b2fc5d0b2508586d0fc6c8fe482af /mnt/vdb/discoLinux.raw b419ec819114f21a10bc5146a0b28183165c8b2cf77b2fe160e3044b1b5e04a0 /mnt/vdb/vdb Análisis de la maquina Windows Lo primero que haré sera crear un caso en autopsy (Esta documentación esta hecha en debian , los ejercicios los he respondido en Windows ).\nLe añadimos metainformación al caso , si lo consideramos necesario :\nEsperamos a que autopsy procese la imagen de disco :\nInstalación volatility javiercruces@HPOMEN15:~$ git clone https://github.com/volatilityfoundation/volatility3.git Clonando en \u0026#39;volatility3\u0026#39;... remote: Enumerating objects: 32373, done. remote: Counting objects: 100% (3665/3665), done. remote: Compressing objects: 100% (771/771), done. remote: Total 32373 (delta 3350), reused 2971 (delta 2894), pack-reused 28708 Recibiendo objetos: 100% (32373/32373), 6.32 MiB | 14.10 MiB/s, listo. Resolviendo deltas: 100% (24696/24696), listo. javiercruces@HPOMEN15:~$ cd volatility3/ javiercruces@HPOMEN15:~/volatility3$ python3 -m venv volatility javiercruces@HPOMEN15:~/volatility3$ source volatility/bin/activate (volatility) javiercruces@HPOMEN15:~/volatility3$ pip3 install -r requirements.txt Máquina Windows 1. Procesos en ejecución (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.pslist.PsList PID\tPPID\tImageFileName\tOffset(V)\tThreads\tHandles\tSessionId\tWow64\tCreateTime\tExitTime\tFile output 4\t0\tSystem\t0xb088ea4af080\t158\t-\tN/A\tFalse\t2024-02-05 19:30:59.000000 N/A\tDisabled 92\t4\tRegistry\t0xb088ea5b8040\t4\t-\tN/A\tFalse\t2024-02-05 19:30:56.000000 N/A\tDisabled 344\t4\tsmss.exe\t0xb0891a80e040\t2\t-\tN/A\tFalse\t2024-02-05 19:30:59.000000 N/A\tDisabled 448\t440\tcsrss.exe\t0xb088f6093140\t10\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 516\t440\twininit.exe\t0xb088ebd2e080\t1\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 528\t508\tcsrss.exe\t0xb088ebd34080\t11\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 612\t508\twinlogon.exe\t0xb08929ff6080\t3\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 648\t516\tservices.exe\t0xb088eb1b40c0\t10\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 668\t516\tlsass.exe\t0xb088eb1b9080\t10\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 768\t516\tfontdrvhost.ex\t0xb088eb1bd080\t5\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 776\t612\tfontdrvhost.ex\t0xb088f59eb140\t5\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 788\t648\tsvchost.exe\t0xb088f59ee240\t25\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 880\t648\tsvchost.exe\t0xb08919be72c0\t19\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 988\t612\tdwm.exe\t0xb088f5d7e080\t14\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 996\t612\tLogonUI.exe\t0xb088f5d81080\t13\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 400\t648\tsvchost.exe\t0xb088f654c2c0\t42\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 444\t648\tsvchost.exe\t0xb088f654e240\t73\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 584\t648\tsvchost.exe\t0xb088f82052c0\t16\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1032\t648\tsvchost.exe\t0xb088f8ea62c0\t15\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1040\t648\tsvchost.exe\t0xb088f8ea8280\t20\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1244\t648\tsvchost.exe\t0xb088f8e0a2c0\t22\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1460\t648\tsvchost.exe\t0xb088fa6e62c0\t19\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1520\t648\tsvchost.exe\t0xb088f9fc4080\t14\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1572\t648\tsvchost.exe\t0xb088fa6e8300\t3\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1768\t4\tMemCompression\t0xb088f9fc8040\t42\t-\tN/A\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1924\t648\tsvchost.exe\t0xb088fbbd42c0\t8\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1956\t648\tsvchost.exe\t0xb088fc1292c0\t9\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1052\t648\tsvchost.exe\t0xb088fe704240\t11\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1068\t648\tsvchost.exe\t0xb088fe7062c0\t5\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1232\t648\tsvchost.exe\t0xb088fe708080\t4\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1568\t648\tspoolsv.exe\t0xb088fdbde200\t8\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 2052\t648\tsvchost.exe\t0xb088f67072c0\t14\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 2300\t648\tsvchost.exe\t0xb088f834a240\t12\t-\t0\tFalse\t2024-02-05 19:31:17.000000 N/A\tDisabled 2412\t648\tMsMpEng.exe\t0xb088f5b06280\t28\t-\t0\tFalse\t2024-02-05 19:31:17.000000 N/A\tDisabled 2868\t648\tsvchost.exe\t0xb08919b82240\t27\t-\t0\tFalse\t2024-02-05 19:31:18.000000 N/A\tDisabled 3044\t1040\tdasHost.exe\t0xb088f5c08280\t3\t-\t0\tFalse\t2024-02-05 19:31:18.000000 N/A\tDisabled 664\t648\tsvchost.exe\t0xb088faadd300\t5\t-\t0\tFalse\t2024-02-05 19:31:19.000000 N/A\tDisabled 3792\t3784\tcsrss.exe\t0xb088faaf5080\t11\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3840\t3784\twinlogon.exe\t0xb08901ded080\t6\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3868\t648\tWUDFHost.exe\t0xb088f55e5080\t10\t-\t0\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3960\t3840\tfontdrvhost.ex\t0xb088f0fbb0c0\t5\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 4020\t3840\tdwm.exe\t0xb088f7551340\t16\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3456\t400\trdpclip.exe\t0xb088eb1ed2c0\t8\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3616\t444\tsihost.exe\t0xb088eaec5300\t16\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3400\t648\tsvchost.exe\t0xb088fafee340\t20\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3188\t444\ttaskhostw.exe\t0xb088f6af1380\t12\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3068\t648\tNisSrv.exe\t0xb088eadcc300\t7\t-\t0\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3344\t1040\tctfmon.exe\t0xb088f632d080\t11\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 4208\t3840\tuserinit.exe\t0xb088fc324080\t0\t-\t2\tFalse\t2024-02-05 19:31:40.000000 2024-02-05 19:32:04.000000 Disabled 4236\t4208\texplorer.exe\t0xb088fc332080\t76\t-\t2\tFalse\t2024-02-05 19:31:40.000000 N/A\tDisabled 4388\t648\tsvchost.exe\t0xb088f5430080\t14\t-\t2\tFalse\t2024-02-05 19:31:40.000000 N/A\tDisabled 4452\t648\tSearchIndexer.\t0xb0891ee2a240\t21\t-\t0\tFalse\t2024-02-05 19:31:40.000000 N/A\tDisabled 4876\t788\tStartMenuExper\t0xb088f90130c0\t14\t-\t2\tFalse\t2024-02-05 19:31:41.000000 N/A\tDisabled 5096\t788\tRuntimeBroker.\t0xb088f94ec340\t4\t-\t2\tFalse\t2024-02-05 19:31:42.000000 N/A\tDisabled 4732\t788\tSearchApp.exe\t0xb088f65130c0\t57\t-\t2\tFalse\t2024-02-05 19:31:42.000000 N/A\tDisabled 5184\t788\tRuntimeBroker.\t0xb088fb73e340\t17\t-\t2\tFalse\t2024-02-05 19:31:42.000000 N/A\tDisabled 5828\t788\tWmiPrvSE.exe\t0xb088ead52300\t8\t-\t0\tFalse\t2024-02-05 19:31:44.000000 N/A\tDisabled 6028\t3104\tGoogleCrashHan\t0xb088f871c340\t5\t-\t0\tTrue\t2024-02-05 19:31:45.000000 N/A\tDisabled 6092\t3104\tGoogleCrashHan\t0xb088f870f080\t4\t-\t0\tFalse\t2024-02-05 19:31:45.000000 N/A\tDisabled 3740\t788\tRuntimeBroker.\t0xb0891ee2f080\t9\t-\t2\tFalse\t2024-02-05 19:31:52.000000 N/A\tDisabled 1912\t788\tsmartscreen.ex\t0xb088f901d080\t7\t-\t2\tFalse\t2024-02-05 19:31:54.000000 N/A\tDisabled 3524\t4236\tSecurityHealth\t0xb088f87020c0\t6\t-\t2\tFalse\t2024-02-05 19:31:54.000000 N/A\tDisabled 3236\t648\tSecurityHealth\t0xb088f9c4e340\t15\t-\t0\tFalse\t2024-02-05 19:31:54.000000 N/A\tDisabled 820\t4236\tOneDrive.exe\t0xb088f8ec7080\t23\t-\t2\tTrue\t2024-02-05 19:31:55.000000 N/A\tDisabled 6128\t4236\tchrome.exe\t0xb088f8e61080\t40\t-\t2\tFalse\t2024-02-05 19:31:56.000000 N/A\tDisabled 2040\t6128\tchrome.exe\t0xb088f8732080\t8\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5404\t6128\tchrome.exe\t0xb088f3cb2080\t14\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5392\t6128\tchrome.exe\t0xb088f60e8080\t15\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5348\t6128\tchrome.exe\t0xb088f8fa3080\t8\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5496\t6128\tchrome.exe\t0xb088f3cc1080\t15\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6184\t6128\tchrome.exe\t0xb088f44e5080\t14\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6200\t6128\tchrome.exe\t0xb088f3cf3080\t14\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6380\t788\tTextInputHost.\t0xb088f8a0e080\t9\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6556\t788\tdllhost.exe\t0xb0891a1ec080\t11\t-\t2\tFalse\t2024-02-05 19:31:58.000000 N/A\tDisabled 6156\t6128\tchrome.exe\t0xb088f44cc080\t14\t-\t2\tFalse\t2024-02-05 19:33:00.000000 N/A\tDisabled 5284\t6128\tchrome.exe\t0xb088f872c080\t14\t-\t2\tFalse\t2024-02-05 19:33:00.000000 N/A\tDisabled 4036\t6128\tchrome.exe\t0xb088f44e4080\t14\t-\t2\tFalse\t2024-02-05 19:33:05.000000 N/A\tDisabled 6916\t4236\tFTK Imager.exe\t0xb0891a1d9080\t22\t-\t2\tFalse\t2024-02-05 19:33:11.000000 N/A\tDisabled 6044\t788\tApplicationFra\t0xb0890d7dc080\t13\t-\t2\tFalse\t2024-02-05 19:33:14.000000 N/A\tDisabled 6104\t788\tCalculator.exe\t0xb088f9bf1340\t17\t-\t2\tFalse\t2024-02-05 19:33:14.000000 N/A\tDisabled 5864\t788\tRuntimeBroker.\t0xb0890d7d9080\t6\t-\t2\tFalse\t2024-02-05 19:33:14.000000 N/A\tDisabled 7020\t648\tsvchost.exe\t0xb088f8720300\t7\t-\t0\tFalse\t2024-02-05 19:33:17.000000 N/A\tDisabled 4788\t648\tSgrmBroker.exe\t0xb088fbe4c080\t7\t-\t0\tFalse\t2024-02-05 19:33:18.000000 N/A\tDisabled 760\t648\tsvchost.exe\t0xb088fac482c0\t13\t-\t0\tFalse\t2024-02-05 19:33:18.000000 N/A\tDisabled 7348\t788\tHxCalendarAppI\t0xb088f5f5a080\t29\t-\t2\tFalse\t2024-02-05 19:33:20.000000 N/A\tDisabled 7412\t788\tRuntimeBroker.\t0xb088faf61080\t6\t-\t2\tFalse\t2024-02-05 19:33:20.000000 N/A\tDisabled 7476\t788\tHxTsr.exe\t0xb088fc642080\t13\t-\t2\tFalse\t2024-02-05 19:33:20.000000 N/A\tDisabled 7816\t4236\tTaskmgr.exe\t0xb088facb8340\t16\t-\t2\tFalse\t2024-02-05 19:33:22.000000 N/A\tDisabled 8072\t788\texplorer.exe\t0xb088ead54080\t11\t-\t2\tFalse\t2024-02-05 19:33:34.000000 N/A\tDisabled 7256\t3616\tPaintStudio.Vi\t0xb088facbe340\t45\t-\t2\tFalse\t2024-02-05 19:33:39.000000 N/A\tDisabled 7796\t788\tRuntimeBroker.\t0xb088f8e64300\t8\t-\t2\tFalse\t2024-02-05 19:33:40.000000 N/A\tDisabled 900\t788\tTime.exe\t0xb088f9c15080\t16\t-\t2\tFalse\t2024-02-05 19:33:42.000000 N/A\tDisabled 2132\t788\tRuntimeBroker.\t0xb088ead3d080\t7\t-\t2\tFalse\t2024-02-05 19:33:43.000000 N/A\tDisabled 2. Servicios en ejecución (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.getservicesids.GetServiceSIDs Volatility 3 Framework 2.5.2 Progress: 100.00\tPDB scanning finished SID\tService S-1-5-80-4151353957-356578678-4163131872-800126167-2037860865\t.NET CLR Networking 4.0.0.0 S-1-5-80-1135273183-3738781202-689480478-891280274-255333391\t.NET Memory Cache 4.0 S-1-5-80-3459415445-2224257447-3423677131-2829651752-4257665947\t3ware S-1-5-80-2917441881-3404282297-3983348447-1829381237-2935805708\tAarSvc S-1-5-80-2345285467-3342891147-82292311-2275197348-1578354944\tAarSvc_50fad S-1-5-80-1975967573-2913356537-819030703-3730719923-1995772179\tAcpiDev S-1-5-80-2670625634-2386107419-4204951937-4094372046-2600379021\tacpiex S-1-5-80-3267050047-1503497915-401953950-2662906978-1179039408\tacpipagr S-1-5-80-772678238-4220935223-620583658-4118486195-1180343772\tacpitime S-1-5-80-1863632671-1375125309-1493738800-1551534981-2387622636\tAcx01000 S-1-5-80-3261807240-4279319092-2126406095-947934052-2578847935\tADOVMPPackage S-1-5-80-2046354688-3987051615-3879164971-215375460-2633017214\tADP80XX S-1-5-80-1535954936-2128305610-2033289386-4003803006-3961564848\tad_driver S-1-5-80-521319896-1227547225-1440366370-1094984824-1952325498\tafunix S-1-5-80-3882103802-2937937445-2149894622-934926057-1088273958\tahcache S-1-5-80-3532809085-2652327567-2620918877-1058261733-582902671\tAJRouter S-1-5-80-3520885947-347258037-358237196-958877718-2177097675\tamdgpio2 S-1-5-80-3034931084-4111837248-3722498124-953434196-229084002\tamdi2c S-1-5-80-940484976-4139584748-3980625906-2403118188-3770008912\tapplockerfltr S-1-5-80-2020831507-1298702824-3288167190-116113825-4190209\tAppReadiness S-1-5-80-3690054487-1922792274-847725564-1425669114-2396631621\tAppVClient S-1-5-80-1981223234-350633043-1452159618-1133528455-2295233572\tAppvStrm S-1-5-80-1995813674-3661462697-784932380-3834207926-917317866\tAppvVemgr S-1-5-80-1543189782-2596160705-3795570588-3168413527-2925017820\tAppvVfs S-1-5-80-1949724575-2387902436-65106593-1201171665-3967308604\tAppXSvc S-1-5-80-689100834-1985168674-2379302174-2224748125-4125308070\tAssignedAccessManagerSvc S-1-5-80-3169285310-278349998-1452333686-3865143136-4212226833\tautotimesvc S-1-5-80-286416697-2074333985-3953926783-2730543180-4207904231\tbam S-1-5-80-2025233850-3714960172-3834018148-2523054830-2209135241\tBasicDisplay S-1-5-80-4178409850-1580268469-397489987-3195816699-129657517\tBasicRender S-1-5-80-3969992995-4113734098-2838120167-1440264772-583281004\tBcastDVRUserService S-1-5-80-1091833278-2140613478-3064603973-1607650773-3857006778\tBcastDVRUserService_50fad S-1-5-80-856979437-3912875207-2720685236-703935298-3759072829\tbcmfn2 S-1-5-80-3451400966-3703281935-2685268016-3285412533-1470843506\tbindflt S-1-5-80-2033999825-3741098712-1851668902-216055579-943193379\tBluetoothUserService S-1-5-80-2602215105-3353301314-225129424-3242260137-2199118732\tBluetoothUserService_50fad S-1-5-80-1988685059-1921232356-378231328-2704142597-890457928\tBrokerInfrastructure S-1-5-80-3316959809-2577409367-488518535-1805171532-1438653141\tBTAGService S-1-5-80-3397485379-1673558126-3852117732-4170930301-4011713027\tBthA2dp S-1-5-80-1264790548-4164306546-4160824920-750804445-3452039388\tBthAvctpSvc S-1-5-80-3742302039-178175996-3312716580-300089339-184318439\tBthEnum S-1-5-80-4190030514-1955060627-1650410980-2059579884-2945205035\tBthHFEnum S-1-5-80-2319449347-3660344761-1621844049-61588942-3837794983\tBthLEEnum S-1-5-80-411364929-2494992265-235336807-3339216277-1376253409\tBthMini S-1-5-80-3533787624-3536623824-1878644040-3113243162-1610647180\tBTHUSB S-1-5-80-1102738-1048517740-3681369803-3100335448-3129350187\tbttflt S-1-5-80-4235005237-3293881321-902755294-2421876860-1688724929\tbuttonconverter S-1-5-80-3988044632-483646655-3689529973-3635425272-2751329168\tCAD S-1-5-80-3369530244-1263555520-1552818992-544823788-1590281562\tcamsvc S-1-5-80-2195691530-3564058219-2185687823-1858318469-3207429352\tCaptureService S-1-5-80-2061916618-2473786339-1209003124-203996862-3865510505\tCaptureService_50fad S-1-5-80-546976454-1426073922-427304975-3694345144-4147405473\tcbdhsvc S-1-5-80-2514868401-1614040450-3339499687-2942524132-3960226468\tcbdhsvc_50fad S-1-5-80-3433512109-503559027-1389316256-1766580070-2256751264\tCDPSvc S-1-5-80-1260278928-804197538-2066346633-4268302704-2216462912\tCDPUserSvc S-1-5-80-1518900912-1420122119-1615577584-34666731-2598493892\tCDPUserSvc_50fad S-1-5-80-1055174906-2416269421-2304048803-1043379310-100576628\tcht4iscsi S-1-5-80-867907225-1838866732-3207111219-3362010221-3938223369\tcht4vbd S-1-5-80-1592074278-3653508928-2768813056-1918619345-1433065180\tCimFS S-1-5-80-1404165011-2000956283-1442398411-3799073753-1383434776\tCldFlt S-1-5-80-65843127-2189646064-2697706863-2125155322-3141006483\tClipSVC S-1-5-80-2119957892-4152124429-3625998117-4006912763-1737903618\tcloudidsvc S-1-5-80-2611951811-1959136347-1062071333-3982815153-2811717512\tclr_optimization_v4.0.30319_32 S-1-5-80-2839768381-3691089589-2614646340-3191585287-3380622033\tclr_optimization_v4.0.30319_64 S-1-5-80-4162882437-1505926369-3203888135-2472178355-2995762856\tcnghwassist S-1-5-80-1796617447-2916456010-10894564-1845345233-3515002435\tcondrv S-1-5-80-3749766068-1582991359-4182444126-1144602875-625653745\tConsentUxUserSvc S-1-5-80-1689245047-2517065848-119126955-928953782-3881496094\tConsentUxUserSvc_50fad S-1-5-80-1021139062-1866602279-1255292388-1008060685-2498416891\tCoreMessagingRegistrar S-1-5-80-109488485-4147369969-3056774085-3969564951-1913080067\tCoreUI S-1-5-80-2720979471-2110640377-1938553337-2954392914-939353058\tCredentialEnrollmentManagerUserSvc S-1-5-80-2870883986-4281173727-708603794-2134363143-2686522016\tCredentialEnrollmentManagerUserSvc_50fad S-1-5-80-3427364867-2348656012-3079877547-1505400018-1601214341\tdam S-1-5-80-2667170245-2239725068-1742831399-533342241-2651120191\tdcsvc S-1-5-80-1692619910-1358769708-3047346990-2477994898-1876611151\tDeviceAssociationBrokerSvc S-1-5-80-933457078-909669165-2371787725-499192611-2576228100\tDeviceAssociationBrokerSvc_50fad S-1-5-80-2536636004-4072673470-1048721469-2703517266-1433793019\tDeviceAssociationService S-1-5-80-2659457741-469498900-3203170401-3149177360-3048467625\tDeviceInstall S-1-5-80-3981010603-2563310902-4138807455-2513867770-1689624316\tDevicePickerUserSvc S-1-5-80-1542622939-2432071804-441627781-2155588311-412164416\tDevicePickerUserSvc_50fad S-1-5-80-1731526583-713188386-1588570932-65458670-665563417\tDevicesFlowUserSvc S-1-5-80-2139216848-1834768328-3639298086-1478984899-2276215200\tDevicesFlowUserSvc_50fad S-1-5-80-1646229720-1474186231-1049421145-3719583575-3014288788\tDevQueryBroker S-1-5-80-3837255464-839197112-3211601036-3795322556-2690640524\tDfsc S-1-5-80-3427281794-3208260282-895156161-4152208786-3156774898\tdiagnosticshub.standardcollector.service S-1-5-80-2291377395-3838044599-2142290114-2473825573-3813973113\tdiagsvc S-1-5-80-2620808479-2171380039-3191355562-2070425692-3097948119\tDiagTrack S-1-5-80-2947989659-52033649-2604989816-125447294-1386081903\tDialogBlockingService S-1-5-80-1827140278-1118305254-4004251663-1512899043-4081885502\tdisk S-1-5-80-4171086659-1617898341-2870161492-1466607281-2109097600\tDispBrokerDesktopSvc S-1-5-80-3914275374-678031271-1603343729-3906112567-2888048264\tDisplayEnhancementService S-1-5-80-538170410-2190149038-799223143-2506663053-4165713448\tDmEnrollmentSvc S-1-5-80-2597136289-665204401-1725106016-1253143166-1853691573\tdmvsc S-1-5-80-3841379657-834162867-3056945855-2577476187-70241904\tdmwappushservice S-1-5-80-3055155277-3816794035-3994065555-2874236192-2193176987\tDoSvc S-1-5-80-286057374-2594772386-1471686342-3682429118-820474675\tDsmSvc S-1-5-80-1551822644-3134808374-1042292604-2865742758-3851661496\tDsSvc S-1-5-80-4071458001-3563271761-1846288968-3700919931-3809667977\tDusmSvc S-1-5-80-1830903284-3590783070-1256105943-1989567323-3273248812\te1i65x64 S-1-5-80-3578261754-285310837-913589462-2834155770-667502746\tEaphost S-1-5-80-263376457-2115425240-177348680-1339839713-3837480443\tedgeupdate S-1-5-80-605514040-344704999-4120406818-2499438505-150840210\tedgeupdatem S-1-5-80-2169634130-1039499152-2857656644-2663134321-2733247747\tEhStorClass S-1-5-80-286318078-2644501994-4034150745-2802514947-3987682007\tEhStorTcgDrv S-1-5-80-197064213-1107091946-1970926662-1288706631-716503202\tembeddedmode S-1-5-80-2744483880-3889877944-846434063-3461941807-3140553215\tEntAppSvc S-1-5-80-880578595-1860270145-482643319-2788375705-1540778122\tEventLog S-1-5-80-2617507558-3328795327-711547822-311560295-1636921165\tfhsvc S-1-5-80-1314638815-3435960472-2727226528-1675998635-1902597435\tFileCrypt S-1-5-80-3915894004-2104103821-3047269622-1811662266-774708259\tFrameServer S-1-5-80-3181391832-1165339916-824804796-1846270512-1987055954\tgencounter S-1-5-80-4137420670-1714900858-4048147207-1486404520-2727663781\tgenericusbfn S-1-5-80-75387917-508843547-2432396020-3132913102-4137377952\tGoogleChromeElevationService S-1-5-80-3892015463-3880225558-716464106-2623782912-3537878324\tGPIOClx0101 S-1-5-80-45206258-3912194098-2707507260-3008220167-2543420661\tGpuEnergyDrv S-1-5-80-1517824832-3405227061-4234718464-3265367437-2784406453\tGraphicsPerfSvc S-1-5-80-1628851891-332911214-942992855-2381080451-357317118\tgupdate S-1-5-80-1391398224-2746689181-3888380295-1755171859-6364376\tgupdatem S-1-5-80-1708301557-710215499-1045718168-382692165-3542596111\tHdAudAddService S-1-5-80-1632474125-2303985310-1465129739-461431387-3339616311\thidi2c S-1-5-80-595487790-2902857704-1637225563-1046489922-3656573765\thidinterrupt S-1-5-80-3338532743-2167017084-2688270890-3351665506-1257551220\thidspi S-1-5-80-2718569444-1738374061-3304332439-3451140840-1824115491\thvcrash S-1-5-80-44780642-2200031541-2427509763-915290973-996987375\tHvHost S-1-5-80-2939390288-356272421-3595829934-3436785230-198171780\thvservice S-1-5-80-2274115272-1034313707-3787864051-261592831-2149061657\tHwNClx0101 S-1-5-80-1636647319-4072889561-245816251-3892323420-125393640\thyperkbd S-1-5-80-1568740187-908130129-1280451789-1901112753-2221687382\tHyperVideo S-1-5-80-2670277838-3947594761-3239889572-3393358898-1622853222\tiagpio S-1-5-80-2158641323-386083531-4194214369-34619318-3813434458\tiai2c S-1-5-80-1751987400-2816258287-31600907-3962047115-1737274117\tiaLPSS2i_GPIO2 S-1-5-80-1111475540-466917029-2679550370-2578483454-692614412\tiaLPSS2i_GPIO2_BXT_P S-1-5-80-1739240851-3621344408-1713079411-1646377490-2636667785\tiaLPSS2i_GPIO2_CNL S-1-5-80-2673509282-3250608688-4161211656-2193043397-2070765280\tiaLPSS2i_GPIO2_GLK S-1-5-80-2560230824-2699639875-2946887507-2809778676-469529665\tiaLPSS2i_I2C S-1-5-80-12980661-1673373748-4127468638-2895847452-4070398594\tiaLPSS2i_I2C_BXT_P S-1-5-80-2145177943-2751001835-2841195933-1950876073-3621000904\tiaLPSS2i_I2C_CNL S-1-5-80-780176066-3721089017-3511631931-2580781662-523231243\tiaLPSS2i_I2C_GLK S-1-5-80-1532184652-4035834151-1950529856-1922329247-3348818483\tiaLPSSi_GPIO S-1-5-80-730113209-3859422966-2743155648-3421359225-3886647409\tiaLPSSi_I2C S-1-5-80-3323158773-131258738-3057376072-3701579410-1953672022\tiaStorAV S-1-5-80-2020084033-1359107645-3278428846-795142582-1815602196\tiaStorAVC S-1-5-80-3391758085-3386442682-1652486205-1841141806-1992729197\tibbus S-1-5-80-3935728946-315639613-922904133-3250794525-491832002\ticssvc S-1-5-80-2392126525-1736915593-2210125632-2563158532-2616938475\tIndirectKmd S-1-5-80-2284069148-621670086-2606570695-3321162879-2563206788\tInstallService S-1-5-80-3327892994-1960904528-3982671949-1654996949-2464229733\tintelpep S-1-5-80-1900340034-3449890540-182776197-3466871519-875942235\tintelpmax S-1-5-80-3964494243-732302783-2234246214-3803256551-723791621\tiorate S-1-5-80-1954766798-2967939946-3605743322-553214224-2296400261\tIPT S-1-5-80-2355113075-3359631449-3346493237-3667020425-1655874352\tIpxlatCfgSvc S-1-5-80-3226934113-1398865432-993897477-3177498405-3382167683\tItSas35i S-1-5-80-2148130874-1768494572-716210-54149643-3932447678\tkbldfltr S-1-5-80-2271880911-1251856977-1706928486-259807789-537220688\tkdnic S-1-5-80-2876499719-392125430-158013367-819050375-2387260967\tksthunk S-1-5-80-3704025948-1094794811-1175534343-2088422159-783153058\tlfsvc S-1-5-80-2168654060-3115992504-1782388893-2584760693-2634250426\tLicenseManager S-1-5-80-828721388-3792639465-1596558500-741975338-1843353865\tLSI_SAS2i S-1-5-80-1292554068-3641467945-3524739894-1349342977-636852090\tLSI_SAS3i S-1-5-80-4045025553-2976580352-2420774707-2188590102-3192113229\tLSI_SSS S-1-5-80-1230977110-1477712667-2747199032-477530733-939374687\tLSM S-1-5-80-1594061079-2000966165-462148798-751814865-2644087104\tLxpSvc S-1-5-80-3028837079-3186095147-955107200-3701964851-1150726376\tMapsBroker S-1-5-80-3114654814-2921064011-1905572160-152804539-1417807178\tmausbhost S-1-5-80-1689786627-2800348145-589537150-160302296-3926153891\tmausbip S-1-5-80-482631164-113973055-3624764966-2186786627-2645029274\tMbbCx S-1-5-80-1346060813-323363712-587550660-3142329655-742851739\tMcpManagementService S-1-5-80-1684110676-2342826027-2954792854-2461032557-4007556361\tmegasas2i S-1-5-80-2869657570-1778740833-83850822-3186679656-2472655231\tmegasas35i S-1-5-80-4024713676-1017792628-381990976-3540878265-1306153904\tmegasr S-1-5-80-3999755614-3418583833-1896887384-2999918798-210212794\tMessagingService S-1-5-80-202946138-985291779-3159394747-43634094-4075641753\tMessagingService_50fad S-1-5-80-450487634-32044177-1119026171-1009345945-1629791242\tMicrosoftEdgeElevationService S-1-5-80-1290887583-3890804311-3227577290-3287571674-2651233138\tMicrosoft_Bluetooth_AvrcpTransport S-1-5-80-1543190384-3367925291-586273452-2558737455-3425399499\tMixedRealityOpenXRSvc S-1-5-80-3755756047-2886117673-2566125725-1838300879-2590056170\tmlx4_bus S-1-5-80-3088073201-1464728630-1879813800-1107566885-823218052\tmpssvc S-1-5-80-766433145-569980108-2081788762-104033110-3841863914\tMsBridge S-1-5-80-61387632-1770052757-913906803-2764154990-1232092381\tMSDTC Bridge 4.0.0.0 S-1-5-80-1709243854-2721926396-509980330-3397245316-2789600492\tmsgpiowin32 S-1-5-80-2335093085-4288963418-862046716-1348633750-1984735259\tmshidumdf S-1-5-80-3719317199-3405270365-2794832041-2304024896-2914089004\tMsKeyboardFilter S-1-5-80-2542081156-3563385132-3937647205-2588572414-2394664210\tMsLldp S-1-5-80-2804434951-625509142-572389148-2638030035-2993097285\tMsQuic S-1-5-80-3977605483-200570079-739940831-2932290302-2649018641\tMsSecCore S-1-5-80-1868534811-1113969215-1254686383-3122237719-2449736172\tMsSecFlt S-1-5-80-3642563950-456203802-1490755371-2601848954-63880797\tMsSecWfp S-1-5-80-4018724706-2388594414-778837249-3759549757-2342992247\tmvumis S-1-5-80-1693791390-661026542-4284378996-1616250691-2477593537\tNaturalAuthentication S-1-5-80-154974075-1852685594-3179713959-2755908004-3936262621\tNcaSvc S-1-5-80-3169048008-2586333165-76651690-3609634147-4147641610\tNcbService S-1-5-80-639065985-1709096039-2702309040-2770678766-2981280942\tNcdAutoSetup S-1-5-80-1929895091-2833432830-2697471735-1135988795-2264472352\tndfltr S-1-5-80-375564701-3513094222-427343084-2529536460-2480510224\tNdisImPlatform S-1-5-80-1856495872-3151408123-1737732000-490184210-1622466692\tNdisVirtualBus S-1-5-80-3687920589-2211470767-2846922358-2300776228-356028302\tndiswanlegacy S-1-5-80-1488665879-159185889-877450046-2151251822-3875779066\tNDKPing S-1-5-80-3999445478-1493703614-491198216-2250085872-3662815299\tndproxy S-1-5-80-1235769596-2241049241-3512080025-3142132805-3400791542\tNdu S-1-5-80-2475926400-260174619-1668875208-528473860-3272058262\tNetAdapterCx S-1-5-80-2038182892-1846284197-1242326240-2615352543-44767121\tNetbiosSmb S-1-5-80-3290392786-819420393-1694314755-3737624005-3552167228\tNetSetupSvc S-1-5-80-3551186791-2451211144-2320551185-397537932-3221552100\tnetvsc S-1-5-80-2381253463-2694003897-3435975801-3559003598-683041300\tNgcCtnrSvc S-1-5-80-1999281942-4196217620-51267815-1628483199-606183737\tNgcSvc S-1-5-80-389868755-419489745-3026704534-2242740522-2006634936\tnpsvctrig S-1-5-80-3903180505-3896017075-4285990333-2375284902-1925993444\tnvdimm S-1-5-80-3753458296-2578515382-296172075-2568624853-485985677\tOneSyncSvc S-1-5-80-3515428-2931623117-804653153-3478930650-257201455\tOneSyncSvc_50fad S-1-5-80-3145084533-2700894668-2078824647-1465192519-3266618331\tpdc S-1-5-80-4215928932-1248355774-1205732377-1093571376-2379325634\tperceptionsimulation S-1-5-80-1046995410-3007147168-922272172-967041193-3794187727\tpercsas2i S-1-5-80-42157666-624349265-169177574-52107575-3728749841\tpercsas3i S-1-5-80-3596911058-2952229928-1888671852-1743692427-614402820\tPerfHost S-1-5-80-2636612206-2079418197-1004231589-1812192203-4197254245\tPhoneSvc S-1-5-80-2428418161-1754247685-758903264-2475084861-4167363882\tPimIndexMaintenanceSvc S-1-5-80-3410280176-3299602888-1332419371-1911054326-2542463980\tPimIndexMaintenanceSvc_50fad S-1-5-80-2785576034-242416339-385417889-2054053173-3638954698\tPktMon S-1-5-80-3355885494-318102177-1313724702-1621550881-803011355\tpmem S-1-5-80-3239442711-4074742016-684152919-2253013163-2274039561\tPNPMEM S-1-5-80-3082810783-1413926421-1831856127-837733229-953361461\tportcfg S-1-5-80-1250897762-2760119941-576021590-2872322938-624617480\tPrintNotify S-1-5-80-3011530997-228986608-3623458339-2361303491-1043592577\tPrintWorkflowUserSvc S-1-5-80-1552224136-2279772909-4069248841-1973210782-3001653797\tPrintWorkflowUserSvc_50fad S-1-5-80-2949785411-1458004381-4011503523-1439849274-3428788682\tPushToInstall S-1-5-80-1681795462-3431334705-92433549-1962541325-160118133\tRamdisk S-1-5-80-2223301817-4248418169-3249847036-321434835-1272792247\tRDMANDK S-1-5-80-1934309797-2043993622-339923705-3871978825-766431271\tRDPUDD S-1-5-80-3072462152-34466603-861212222-1753422877-4071721522\tRdpVideoMiniport S-1-5-80-1596569074-2677311441-962104887-2749517281-2857086053\tReFS S-1-5-80-2316697869-4025289487-468236631-2575080373-2608813053\tReFSv1 S-1-5-80-457603595-166122335-4119162879-888033224-3685571132\tRetailDemo S-1-5-80-2932307366-730193993-4255125875-3321969383-2534286350\tRFCOMM S-1-5-80-3216188369-3897538938-543323431-4144952942-4182718943\trhproxy S-1-5-80-3765985997-1043742756-2756022526-3497566756-2081646175\tRmSvc S-1-5-80-3993802144-2555107232-3516638766-2735499450-3275915967\tScDeviceEnum S-1-5-80-739156932-4202345562-1098723576-2529635932-2179704457\tscmbus S-1-5-80-3730768523-2660761635-2080149804-588026050-2891317352\tsdbus S-1-5-80-2993119251-3416827737-2039089254-2988278179-172925588\tSDFRd S-1-5-80-106427005-851153787-2361826242-1841078065-3276170637\tsdstor S-1-5-80-259296475-4084429506-1152984619-38739575-565535606\tSecurityHealthService S-1-5-80-2226967063-754826275-1661302337-2802353169-2369347280\tSEMgrSvc S-1-5-80-1523878533-411328482-2798077809-3098663872-2604013308\tSense S-1-5-80-3835358604-2805616403-1686431098-2148037164-3679743528\tSensorDataService S-1-5-80-869152694-422618349-3448047118-1397179936-2828741493\tSensorService S-1-5-80-3391662211-1836087953-1525834830-1506885508-682969218\tSerCx S-1-5-80-3290564682-3359114709-1529561987-4148060287-271116923\tSerCx2 S-1-5-80-1582054788-470990004-40152839-730814383-1124151202\tSgrmAgent S-1-5-80-3706850399-3459138796-2835936764-562029542-397710147\tSgrmBroker S-1-5-80-3246321066-2451215914-3422911474-2201726393-166328789\tSharedRealitySvc S-1-5-80-4106268995-3617844033-680706512-3896918354-2380077472\tshpamsvc S-1-5-80-3842628764-1253170212-1172882037-4289227758-4267631040\tSmartSAMD S-1-5-80-1821507682-1115666477-1591553307-1734210999-3312719974\tsmbdirect S-1-5-80-230328282-2568015442-686465752-3474446193-2137307224\tsmphost S-1-5-80-2950457502-2299174248-3328245479-1326271200-3113355612\tSmsRouter S-1-5-80-217413056-3833387362-178569430-1954288181-1272411947\tSMSvcHost 4.0.0.0 S-1-5-80-2030916845-920430783-420616369-4268599728-1745276005\tspaceparser S-1-5-80-3804375463-2979979117-3280645550-3527107762-3022760719\tspaceport S-1-5-80-664203522-3160570195-1635065499-2708521076-3299712393\tSpatialGraphFilter S-1-5-80-3979690135-2752926531-2282419748-2415739691-1066856619\tSpbCx S-1-5-80-2731152606-4244467407-1946816704-3721569673-479255522\tspectrum S-1-5-80-2277354432-2697620045-1656008878-1855416240-261295475\tssh-agent S-1-5-80-4118144674-975173503-976751360-2062754009-4288402176\tStateRepository S-1-5-80-3182985763-1431228038-2757062859-428472846-3914011746\tstisvc S-1-5-80-341174513-3036333638-3617001766-2776055326-2809179524\tstorahci S-1-5-80-4243609067-2923323804-3669886039-3498181113-4202203050\tstornvme S-1-5-80-2198686546-2221861197-1858316108-2015056224-400908585\tstorqosflt S-1-5-80-2019411066-3003329723-2609168412-3625837524-2221108837\tstorufs S-1-5-80-2483706823-3321877870-553300257-593996131-450212729\tsvsvc S-1-5-80-927584136-3246479672-3996289350-2713334021-2098405977\tSynth3dVsc S-1-5-80-1662832393-3268938575-4001313665-1200257238-783911988\tSystemEventsBroker S-1-5-80-842221325-3630721446-2015653073-424833842-1069621030\tTcpip6 S-1-5-80-1003279123-1651757316-1243245493-3539186934-1753552613\tTelemetry S-1-5-80-3141112300-3466319987-880208219-2791244925-2953947883\tterminpt S-1-5-80-427241336-4111990062-2791250970-2845566439-1217505164\tTieringEngineService S-1-5-80-410965207-2550896871-1717734767-2321332215-3755966139\tTimeBrokerSvc S-1-5-80-4077216321-3151206942-641340059-4241647091-1300899357\tTokenBroker S-1-5-80-325036955-4200148024-1479951852-2634116931-2865895459\tTPM S-1-5-80-1139522462-2689595747-457373284-4037083511-4201549542\tTroubleshootingSvc S-1-5-80-3547539953-1452514991-991928397-2821742631-2888215071\tTsUsbFlt S-1-5-80-651631395-3385332028-373277408-2457879084-1955742111\tTsUsbGD S-1-5-80-2292203918-1506848946-3955473809-4024494573-4108135173\ttsusbhub S-1-5-80-3641914668-2724251012-1186334157-2460844255-322272688\ttzautoupdate S-1-5-80-3033002672-3264167506-3374793840-2611327823-1324250788\tUASPStor S-1-5-80-3559279508-480464440-2060053639-2450836018-584673110\tUcmCx0101 S-1-5-80-986347966-4291837576-3105858776-4112886612-1615276934\tUcmTcpciCx0101 S-1-5-80-2946873420-2809826944-3342656785-1798640712-1793966795\tUcmUcsiAcpiClient S-1-5-80-3947455493-1779752151-1865639843-1092346862-2012747891\tUcmUcsiCx0101 S-1-5-80-3476958810-2644384738-2655413726-1639285643-1444265662\tUcx01000 S-1-5-80-227846823-3077342265-3698762170-815164292-2633305508\tUdeCx S-1-5-80-2008930627-2960539461-4086452603-1305618659-1299222103\tUdkUserSvc S-1-5-80-2960622349-2603655608-463014845-353330955-2631882611\tUdkUserSvc_50fad S-1-5-80-259741192-1658403178-390766877-3226735796-603445823\tUEFI S-1-5-80-3429946394-717031342-3915206314-2329540128-2872892288\tUevAgentDriver S-1-5-80-1639943639-1314739636-372181295-777240325-3530900257\tUevAgentService S-1-5-80-1983721769-1446015346-1638820087-833790554-4117195697\tUfx01000 S-1-5-80-2486803200-2786917169-1479676890-818817034-2254858114\tUfxChipidea S-1-5-80-3461039289-3711732118-2967254728-2566641523-4135479736\tufxsynopsys S-1-5-80-951045732-3304998411-4140413591-2375454759-2566081399\tUnistoreSvc S-1-5-80-1232783531-1412289346-3408063018-2430219916-590553325\tUnistoreSvc_50fad S-1-5-80-948646300-214352964-3153699637-3534669071-395810831\tUrsChipidea S-1-5-80-311046983-1549683341-1485789459-3189993376-3259784172\tUrsCx01000 S-1-5-80-3858170093-3095794678-3940928812-3402197675-2417274444\tUrsSynopsys S-1-5-80-1038357558-2508750332-1127516358-2098882773-1571978916\tusbaudio S-1-5-80-3715696977-77976676-2422196092-1701963391-244329408\tusbaudio2 S-1-5-80-2532058633-1854360046-4195713749-973563373-2229526857\tUSBHUB3 S-1-5-80-322830934-407560818-413383929-2953137197-2859522744\tusbser S-1-5-80-811199202-3756583514-1800339595-8156802-767824446\tUSBXHCI S-1-5-80-2995899262-2131376444-1860748247-2210972999-1941275431\tUserDataSvc S-1-5-80-339627148-1085118590-1191147914-145126631-47496027\tUserDataSvc_50fad S-1-5-80-2008603874-3981339663-2468433650-2111681540-3858834245\tUserManager S-1-5-80-223807737-1693445485-119162242-1977420160-1403034029\tUsoSvc S-1-5-80-1989757894-211065159-731672622-1783776043-3948168785\tVacSvc S-1-5-80-2231687835-1975921998-2379643093-1123054981-1892632637\tVerifierExt S-1-5-80-2337629457-4082528419-1990172282-783805348-776062068\tvhf S-1-5-80-4056652736-3832535469-1849010726-800110142-2900318757\tVid S-1-5-80-4005553843-2860153778-2672767370-1614289598-2532660634\tVirtualRender S-1-5-80-3419770058-1088902930-2242902800-2505332296-3985202246\tvmgid S-1-5-80-3074984378-4122987768-2130325677-2031866499-3405430279\tvmicguestinterface S-1-5-80-534935901-3437432317-481271085-1710633381-983106267\tvmicheartbeat S-1-5-80-1877308096-3090306141-3032871208-3115266146-1400827410\tvmickvpexchange S-1-5-80-3076811988-2254870394-2658297454-3934945422-2393138642\tvmicrdv S-1-5-80-3110303136-3426481729-3186938678-1087894076-2178433439\tvmicshutdown S-1-5-80-3098585136-2538892366-1097114017-2832417424-2016953023\tvmictimesync S-1-5-80-235582178-102246843-358262472-4132936818-1867412993\tvmicvmsession S-1-5-80-1752088424-1054500994-3489791022-3310831482-3926524968\tvmicvss S-1-5-80-2476029939-3227366791-4018265514-4032530291-4172793725\tvolume S-1-5-80-1770745653-882454895-2389083440-3735684190-802018898\tvpci S-1-5-80-1072045427-3277916734-2175442256-760694638-1728218837\tVSTXRAID S-1-5-80-3303534547-3920260423-752829696-1552054067-268166277\tvwififlt S-1-5-80-2169053098-454685327-3448947123-3791923320-414336915\tWaaSMedicSvc S-1-5-80-1874328037-1620432936-4113708365-722077214-3851787529\tWalletService S-1-5-80-145391760-3682396335-1395736941-2543690743-1822485816\twanarp S-1-5-80-3957613141-1606606214-622769385-3049525404-2510868034\twanarpv6 S-1-5-80-2145785123-2886438689-3072542501-3020378507-1504386134\tWarpJITSvc S-1-5-80-1468946484-2183346801-2582215073-2203958287-114577455\twcifs S-1-5-80-4155767994-3874329934-3800885181-2130851812-726865888\tWcmsvc S-1-5-80-486657452-3436462838-2743705563-1382716400-3286987141\twcnfs S-1-5-80-3188579509-896559776-1549670742-2760322350-3311614235\tWdBoot S-1-5-80-2003142183-3009844670-3971145999-3073937758-3917121208\tWdFilter S-1-5-80-499275411-3916059529-905482537-4117857359-1999665194\twdiwifi S-1-5-80-2105769960-3462231971-121635667-3410645665-2561607156\tWdmCompanionFilter S-1-5-80-2946744033-2833218566-1164540619-314168540-3391284662\tWdNisDrv S-1-5-80-3668810961-2468724468-4084584310-3029221373-430494444\tWdNisSvc S-1-5-80-1282825935-788281630-359899028-1878232204-2860951615\tWEPHOSTSVC S-1-5-80-1495648203-2503502111-1597754693-3445174711-1316708627\tWFDSConMgrSvc S-1-5-80-2768376765-85268660-951480638-2317617532-3422828864\tWFPLWFS S-1-5-80-533360197-2630880149-807505739-2151714924-2570839994\tWiaRpc S-1-5-80-3488966095-3237316714-2152248236-3202922946-3275547626\tWindows Workflow Foundation 4.0.0.0 S-1-5-80-1314485122-3970895080-1653179290-3214604197-56682579\tWindowsTrustedRT S-1-5-80-2899914805-2506168806-919368875-2051509565-976885860\tWindowsTrustedRTProxy S-1-5-80-350045039-4213533676-3741949053-609707664-895491048\tWinMad S-1-5-80-4015764710-1917268369-2628323210-1820452808-4095801055\tWinNat S-1-5-80-2971715461-3208067863-1422018366-770925591-1162363329\tWINUSB S-1-5-80-1409370327-2262994431-3181734005-3492817815-127119016\tWinVerbs S-1-5-80-2429767553-128593128-2427591838-1778256749-2155598187\twisvc S-1-5-80-1428027539-3309602793-2678353003-1498846795-3763184142\tWlanSvc S-1-5-80-2952724807-2252311773-3412998076-2712868122-780978283\twlidsvc S-1-5-80-3916113136-2435487254-2535488001-4050622930-2364918814\twlpasvc S-1-5-80-3577588319-513283748-931039988-2701962192-2148388740\tWManSvc S-1-5-80-1635442456-4231674260-3066288937-1147435026-1365933032\tWof S-1-5-80-3413159032-3694667005-1396569551-1250786377-1429361823\tworkerdd S-1-5-80-3006764832-2469330069-4024865495-2754276538-3243839463\tworkfolderssvc S-1-5-80-2657955583-569354589-921901904-1883788092-850583853\tWpcMonSvc S-1-5-80-358856340-4190185137-1150018170-4132368399-2594611401\tWpdUpFltr S-1-5-80-1938892561-4120931771-3580170924-3403102300-2651602529\tWpnService S-1-5-80-951620777-1059631183-2804607755-3010024351-809615488\tWpnUserService S-1-5-80-1069300804-2231982870-930986846-425802403-2676852813\tWpnUserService_50fad S-1-5-80-1803441692-2341117941-3526855333-3767870088-2684717574\tWUDFWpdFs S-1-5-80-472864980-3821642676-709327584-2321888604-4243627364\tXblAuthManager S-1-5-80-2649222292-2060825207-2866066902-505902355-282187514\tXblGameSave S-1-5-80-794853676-1269112726-2386671565-1760138502-3367587780\txboxgip S-1-5-80-3605394182-687838168-1441221562-1662690741-4241567093\tXboxGipSvc S-1-5-80-1352715831-1104254428-97934242-2131353953-1898040052\tXboxNetApiSvc S-1-5-80-1281037624-1782002805-990284447-3522102690-2853398433\txinputhid 3. Puertos abiertos Volatility parece ser que no tiene soporte para esta funcionalidad para Windows 10/11 , así que lo haré desde la propia powershell de la maquina :\n(volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.netstat Volatility 3 Framework 2.5.2 PS C:\\Windows\\system32\u0026gt; Get-NetTCPConnection | Where-Object {$_.State -eq \u0026#39;Listen\u0026#39;} | Select-Object LocalAddress, LocalPort LocalAddress LocalPort ------------ --------- :: 49670 :: 49669 :: 49668 :: 49667 :: 49666 :: 49665 :: 49664 :: 7680 :: 5357 :: 3389 :: 445 :: 135 0.0.0.0 49670 0.0.0.0 49669 0.0.0.0 49668 0.0.0.0 49667 0.0.0.0 49666 0.0.0.0 49665 0.0.0.0 49664 0.0.0.0 5040 0.0.0.0 3389 192.168.122.203 139 0.0.0.0 135 4. Conexiones establecidas por la máquina Al igual que el punto anterior , parece que volatility no tiene soporte para las versiones actuales de windows :\n(volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.netscan.NetScan PS C:\\Windows\\system32\u0026gt; Get-NetTCPConnection | Where-Object {$_.State -eq \u0026#39;Established\u0026#39; -and $_.LocalAddress -ne \u0026#39;127.0.0.1\u0026#39;} | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State LocalAddress : 192.168.122.203 LocalPort : 49855 RemoteAddress : 142.250.200.138 RemotePort : 443 State : Established LocalAddress : 192.168.122.203 LocalPort : 49853 RemoteAddress : 184.28.177.55 RemotePort : 80 State : Established LocalAddress : 192.168.122.203 LocalPort : 49846 RemoteAddress : 2.20.253.149 RemotePort : 443 State : Established LocalAddress : 192.168.122.203 LocalPort : 49845 RemoteAddress : 184.28.177.9 RemotePort : 443 State : Established 5. Sesiones de usuario establecidas remotamente (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.sessions.Sessions Volatility 3 Framework 2.5.2 Progress: 100.00\tPDB scanning finished Session ID\tSession Type\tProcess ID\tProcess\tUser Name\tCreate Time N/A\t-\t4\tSystem\t-\t2024-02-05 19:30:59.000000 N/A\t-\t92\tRegistry\t-\t2024-02-05 19:30:56.000000 N/A\t-\t344\tsmss.exe\t-\t2024-02-05 19:30:59.000000 0\t-\t448\tcsrss.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t516\twininit.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t648\tservices.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t668\tlsass.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t768\tfontdrvhost.ex\tFont Driver Host/UMFD-0\t2024-02-05 19:31:15.000000 0\t-\t788\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:15.000000 0\t-\t880\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:15.000000 0\t-\t400\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t444\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t584\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1032\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1040\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1244\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1460\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1520\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1572\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1924\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1956\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1052\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1068\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1232\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1568\tspoolsv.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t2052\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t2300\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:17.000000 0\t-\t2412\tMsMpEng.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:17.000000 0\t-\t2868\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:18.000000 0\t-\t3044\tdasHost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:18.000000 0\t-\t664\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:19.000000 0\t-\t3868\tWUDFHost.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 0\t-\t3068\tNisSrv.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:39.000000 0\t-\t4452\tSearchIndexer.\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:40.000000 0\t-\t5828\tWmiPrvSE.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:44.000000 0\t-\t6028\tGoogleCrashHan\t-\t2024-02-05 19:31:45.000000 0\t-\t6092\tGoogleCrashHan\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:45.000000 0\t-\t3236\tSecurityHealth\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:54.000000 0\t-\t7020\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:33:17.000000 0\t-\t4788\tSgrmBroker.exe\t-\t2024-02-05 19:33:18.000000 0\t-\t760\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:33:18.000000 1\t-\t528\tcsrss.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 1\t-\t612\twinlogon.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 1\t-\t776\tfontdrvhost.ex\tFont Driver Host/UMFD-1\t2024-02-05 19:31:15.000000 1\t-\t988\tdwm.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 1\t-\t996\tLogonUI.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 N/A\t-\t1768\tMemCompression\t-\t2024-02-05 19:31:16.000000 2\t-\t3792\tcsrss.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 2\t-\t3840\twinlogon.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 2\t-\t3960\tfontdrvhost.ex\tFont Driver Host/UMFD-2\t2024-02-05 19:31:38.000000 2\t-\t4020\tdwm.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 2\t-\t3456\trdpclip.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3616\tsihost.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3400\tsvchost.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3188\ttaskhostw.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3344\tctfmon.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t4208\tuserinit.exe\t-\t2024-02-05 19:31:40.000000 2\tRDP-Tcp#1\t4236\texplorer.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:40.000000 2\t-\t4388\tsvchost.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:40.000000 2\t-\t4876\tStartMenuExper\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:41.000000 2\t-\t5096\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:42.000000 2\t-\t4732\tSearchApp.exe\t-\t2024-02-05 19:31:42.000000 2\t-\t5184\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:42.000000 2\t-\t3740\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:52.000000 2\t-\t1912\tsmartscreen.ex\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:54.000000 2\tRDP-Tcp#1\t3524\tSecurityHealth\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:54.000000 2\tRDP-Tcp#1\t820\tOneDrive.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:55.000000 2\tRDP-Tcp#1\t6128\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:56.000000 2\t-\t2040\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\tRDP-Tcp#1\t5404\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\tRDP-Tcp#1\t5392\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\tRDP-Tcp#1\t5348\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\t-\t5496\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\t-\t6184\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\t-\t6200\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\t-\t6380\tTextInputHost.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\t-\t6556\tdllhost.exe\t-\t2024-02-05 19:31:58.000000 2\t-\t6156\tchrome.exe\t-\t2024-02-05 19:33:00.000000 2\t-\t5284\tchrome.exe\t-\t2024-02-05 19:33:00.000000 2\t-\t4036\tchrome.exe\t-\t2024-02-05 19:33:05.000000 2\t-\t6916\tFTK Imager.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:11.000000 2\t-\t6044\tApplicationFra\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:14.000000 2\t-\t6104\tCalculator.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:14.000000 2\t-\t5864\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:14.000000 2\t-\t7348\tHxCalendarAppI\t-\t2024-02-05 19:33:20.000000 2\t-\t7412\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:20.000000 2\t-\t7476\tHxTsr.exe\t-\t2024-02-05 19:33:20.000000 2\t-\t7816\tTaskmgr.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:22.000000 2\t-\t8072\texplorer.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:34.000000 2\t-\t7256\tPaintStudio.Vi\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:39.000000 2\t-\t7796\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:40.000000 2\t-\t900\tTime.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:42.000000 2\t-\t2132\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:43.000000 6. Ficheros transferidos recientemente por NetBios Volatility no tiene soporte para esta función :\nAl estar en una red aislada sin ningún otro Windows , no se han transferido ficheros usando este protocolo\nPS C:\\Windows\\system32\u0026gt; Get-WinEvent -LogName Security | Where-Object {$_.Message -match \u0026#34;EventID: 5140\u0026#34;} | Select-Object TimeCreated, @{Name=\u0026#34;File\u0026#34;;Expression={$_.Properties[8].Value}} PS C:\\Users\\javiercruces\u0026gt; NBTSTAT -n Ethernet: Dirección IP del nodo: [192.168.122.203] Id. de ámbito : [] Tabla de nombres locales NetBIOS Nombre Tipo Estado --------------------------------------------- DESKTOP-KG80ESU\u0026lt;20\u0026gt; Único Registrado DESKTOP-KG80ESU\u0026lt;00\u0026gt; Único Registrado WORKGROUP \u0026lt;00\u0026gt; Grupo Registrado 7. Contenido de la caché DNS Volatility no tiene soporte para esta función :\nPS C:\\Windows\\system32\u0026gt; ipconfig /displaydns Configuración IP de Windows edgedl.me.gvt1.com ---------------------------------------- Nombre de registro . : edgedl.me.gvt1.com Tipo de registro . . : 1 Período de vida . . . : 897 Longitud de datos . . : 4 Sección . . . . . . . : respuesta Un registro (host). . : 34.104.35.123 msedge.b.tlu.dl.delivery.mp.microsoft.com ---------------------------------------- Nombre de registro . : msedge.b.tlu.dl.delivery.mp.microsoft.com Tipo de registro . . : 5 Período de vida . . . : 44 Longitud de datos . . : 8 Sección . . . . . . . : respuesta Registro CNAME. . . . : cdp-tlu-shim.trafficmanager.net 8. Variables de entorno (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.envars 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERDOMAIN\tDESKTOP-KG80ESU 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERDOMAIN_ROAMINGPROFILE\tDESKTOP-KG80ESU 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERNAME\tjaviercruces 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERPROFILE\tC:\\Users\\javiercruces 2132\tRuntimeBroker.\t0x1ae8f803400\twindir\tC:\\Windows Analizando el Registro de Windows Para esto nos descargamos el Registry Viewer 2.0.0 https://www.exterro.com/ftk-product-downloads/registry-viewer-2-0-0\nAbrimos el fichero system que es el registro de Windows :\n9. Dispositivos USB conectados Autopsy: 10. Redes wifi utilizadas recientemente. Lo podemos encontrar en \u0026ndash;\u0026gt; system/ControlSet001/Control/Network/Connections\n11. Configuración del firewall de nodo. system\\ControlSet001\\Services\\SharedAccess\\Parameters\\FirewallPolicy\n12. Programas que se ejecutan en el Inicio. software\\Microsoft\\Windows\\CurrentVersion\\Run\n13. Asociación de extensiones de ficheros y aplicaciones. Esta debajo de este directorio \u0026ndash;\u0026gt; software\\Classes\n14. Aplicaciones usadas recientemente. 15. Ficheros abiertos recientemente. 16. Software Instalado. 17. Contraseñas guardadas. 18. Cuentas de Usuario Podemos ver las respuestas a las preguntas de seguridad :\nCon Aplicaciones de terceros: 19. Historial de navegación y descargas. Cookies. Historial : Descargas :\nCookies :\n20. Volúmenes cifrados Te muestra los FICHEROS cifrados :\nSobre la imagen del disco: 21. Archivos con extensión cambiada Nos fijaremos en que el tipo MIME coincida con la extensión : También hay un artefacto que nos permite ver los ficheros que están con otra extensión :\n22. Archivos eliminados Tienes un apartado en especifico que te dice los ficheros borrados : Pero si navegas por los directorios , te informara si hay algún fichero borrado en el mismo :\n23. Archivos Ocultos 24. Archivos que contienen una cadena determinada 25. Búsqueda de imágenes por ubicación. La ubicación de autopsy no me localiza la imagen , así que usare una herramienta externa .\n26. Búsqueda de archivos por autor. Apartado B Máquina Linux. Intenta realizar las mismas operaciones en una máquina Linux para aquellos apartados que tengan sentido y no se realicen de manera idéntica a Windows.\nAl utilizar volatility para esta parte , no me reconoce los plugins para la versión especifica de Debian , los he generado siguiendo este tutorial : https://markuta.com/live-memory-acquisition-on-linux-systems/\nSin embargo no me los reconoce y he utilizado tanto volatility 2 como la versión 3 . Me conectare a la maquina y te indicare con comandos como mostrar cada ejercicio , no me queda otra . Lo que haré sera redirigir la salida de los comandos a un fichero en el dispositivo en el que he almacenado los volcados .\n1. Procesos en ejecución root@debian:~# ps aux \u0026gt; /mnt/procesos root@debian:~# cat /mnt/procesos USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.3 0.6 102660 12616 ? Ss 16:44 0:00 /sbin/init root 2 0.0 0.0 0 0 ? S 16:44 0:00 [kthreadd] root 3 0.0 0.0 0 0 ? I\u0026lt; 16:44 0:00 [rcu_gp] 2. Servicios en ejecución root@debian:~# systemctl list-units --type=service --state=running \u0026gt; /mnt/servicios_corriendo root@debian:~# systemctl list-units --type=service --state=running UNIT LOAD ACTIVE SUB DESCRIPTION accounts-daemon.service loaded active running Accounts Service avahi-daemon.service loaded active running Avahi mDNS/DNS-SD Stack colord.service loaded active running Manage, Install and Generate Color Profiles 3. Puertos abiertos root@debian:~# ss -tuln \u0026gt; /mnt/puertos_abiertos root@debian:~# ss -tuln Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port Process udp UNCONN 0 0 0.0.0.0:631 0.0.0.0:* udp UNCONN 0 0 0.0.0.0:42925 0.0.0.0:* 4. Conexiones establecidas por la máquina root@debian:~# ss -an \u0026gt; /mnt/conexiones_establecidas root@debian:~# ss -an u_dgr ESTAB 0 0 * 19629 * 19630 u_str ESTAB 0 0 /run/user/112/pipewire-0 19262 * 19261 u_str ESTAB 0 0 * 18971 * 18972 u_str ESTAB 0 0 * 18439 * 18440 5. Sesiones de usuario establecidas remotamente root@debian:~# who javiercruces pts/0 2024-02-18 16:44 (192.168.122.1) javiercruces pts/1 2024-02-18 16:46 (192.168.122.1) root@debian:~# who \u0026gt; /mnt/conexiones_remtoas 7. Contenido de la caché DNS root@debian:~# sudo journalctl -u systemd-resolved \u0026gt; /mnt/cachedns 8. Variables de entorno root@debian:~# env \u0026gt; /mnt/variables_entorno 9. Dispositivos USB conectados root@debian:~# lsusb Bus 002 Device 002: ID 46f4:0001 QEMU QEMU USB HARDDRIVE Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 001 Device 002: ID 0627:0001 Adomax Technology Co., Ltd QEMU Tablet Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub root@debian:~# lsusb \u0026gt; /mnt/usb_conectados 10. Redes wifi utilizadas recientemente Al ser un MV no tenemos historial de redes wifi 11. Configuración del firewall de nodo root@debian:~# sudo iptables -L Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination DROP tcp -- anywhere anywhere tcp dpt:9999 root@debian:~# sudo iptables -L \u0026gt; /mnt/firewall_nodo 12. Programas que se ejecutan en el Inicio root@debian:~# systemctl list-unit-files --type=service \u0026gt; /mnt/servicios_incio netfilter-persistent.service enabled enabled networking.service enabled enabled 13. Asociación de extensiones de ficheros y aplicaciones root@debian:~# cat /usr/share/applications/mimeinfo.cache \u0026gt; /mnt/asosiacion_ficheros_ext 14. Aplicaciones usadas recientemente Lo mas parecido a esto , en Linux es ver que han hecho cada usuario , así que me traeré todos los historiales :\nroot@debian:~# sudo cat /home/*/.bash_history \u0026gt; /mnt/historial_usuarios root@debian:~# sudo cat /root/.bash_history \u0026gt; /mnt/historial_root 15. Ficheros abiertos recientemente *Dependerá de la ruta de los ficheros , pondré un ejemplo para el home\nroot@debian:~# ls -lu /home/*/ \u0026gt; /mnt/ficheros_recientes 16. Software Instalado root@debian:~# dpkg --get-selections \u0026gt; /mnt/paquetes_instalados 17. Contraseñas guardadas Algunas contraseñas de configuración se guardan dentro del directorio home de nuestro usuario , si queremos ver las del navegador , la encontraremos en el mismo lugar que autopsy .\n18. Cuentas de Usuario root@debian:~# cat /etc/passwd | cut -d \u0026#34;:\u0026#34; -f 1 \u0026gt; /mnt/lista_usuarios sshd debian user1 19. Historial de navegación , descargas y Cookies Historial :\nCookies :\nDescargas :\nroot@debian:~# ls -l /home/*/Descargas \u0026gt; /mnt/descargas_usuarios 20. Volúmenes cifrados root@debian:~# lsblk -f | grep crypt └─sda1 crypto_LUKS 2 9fc1bfa7-9224-4e8e-896a-09516d4fd613 21. Archivos con extensión cambiada *No me carga el artefacto de Mismatch Detector , pero podemos verlo fijandonos en los metadatos :\n22. Archivos eliminados 23. Archivos Ocultos En Linux , todos los que empiezan por .\nroot@debian:~# find / -type f -name \u0026#34;.*\u0026#34; \u0026gt; /mnt/ficheros_ocultos 24. Archivos que contienen una cadena determinada root@debian:~# grep -rnw / -e \u0026#39;File\u0026#39; \u0026gt; /mnt/FicherosContienenFile 26. Búsqueda de archivos por autor He intentado ya que no he podido utilizar volatility para estos ejercicios , usar comandos para poder realizar lass comprobaciones manualmente . Para darle mas seriedad a los ejercicios voy a sacar los hashes de las salidas de los diferentes comandos para asegurarnos de que no se modifiquen :\nroot@debian:~# find /mnt/* -type f -exec sha256sum {} + 5b46470021e68c2f5b517fa0bf3daeea665e525d3fa427326c53f93f09968d32 /mnt/asosiacion_ficheros_ext d9ed5ccc5da76e64a158605065f9bdccbb42dfa889d1b66d8c1660a4511065b4 /mnt/conexiones_establecidas 8c65702fe0e26bf57cb2138a618a3cd023be45a23c46e50c77fc191b36c842ca /mnt/conexiones_remtoas bf22d9341614e23448d92045f9ada00f2d62b00491261ec5843adca20e5a4b3a /mnt/descargas_usuarios b63693142f2823a95a11d9f1fcbd845c118b2fc5d0b2508586d0fc6c8fe482af /mnt/discoLinux.raw f5f82603dc58e22f0e38c70321ca1b28524b565b4a85264b07e06a5f9c967024 /mnt/FicherosContienenFile faf7aa5603cb456e86c320549a4b34c12f3167260cb0e8cbfc94ec3ebd42f1ab /mnt/ficheros_ocultos f767cd7a3d0802ebaebb3f18be2d188eb4c16f6a53444e9669f153a304cdb027 /mnt/ficheros_recientes cb910e861a19148c6249fa53cc5b957fb0ae2e0f37ef4081c77aa90e7dde7eb0 /mnt/firewall_nodo 61f44639402d823b9452ad6eaf66eff0ed078fe1cf512c0fdebc9bba9fb58fb1 /mnt/historial_root fed8854df34d3687edcd85697fda768ba58b88fa1b8d788bdd0d033b29209f85 /mnt/historial_usuarios 0a2c590ff6773acf9f601586cb4b013fb65bc32070019acb7368ae4212c07f8d /mnt/lista_usuarios 5f136603c0e34a74a58bc59f1934f5f2850ca8bec9c356a283ee7161a8f39a76 /mnt/memdebian.mem 1b503447d038a0ace6b81aaaf1390ac82ce6e08838a32e0b18b7656048794ebb /mnt/paquetes_instalados 8e29c5c098b2a664c23deb84abe943b666ca0dc05ce8020d0bb110b17e12d60a /mnt/procesos 9b889a5d5a59e615dc8fbbc4de9c5dbeaac1ae97990bab3dda39c3ef18c5dd72 /mnt/puertos_abiertos cf7776ea7ca74f27b5a650ad14b074d3ac400df1b2729bca2e6a9f74696e94c3 /mnt/servicios_corriendo b83d26c9829478eac7c19ff60eecc83b3d139fda26b5e057e882aefdaaeda7da /mnt/servicios_incio 17a519d6c20c48bd9cb39c4fd39dd107ee23c909712fada41cb75ba0d5cb703d /mnt/usb_conectados 575f849aed774bef68eb9cb85823030432afc6bfa3242ef4e1efe5cf14a98a0c /mnt/variables_entorno b419ec819114f21a10bc5146a0b28183165c8b2cf77b2fe160e3044b1b5e04a0 /mnt/vdb Bibliografía https://cibersec.iescampanillas.com/archivos/3046 https://markuta.com/live-memory-acquisition-on-linux-systems/ https://cpuu.hashnode.dev/how-to-perform-memory-forensic-analysis-in-linux-using-volatility-3 https://isf-server.techanarchy.net/ https://github.com/volatilityfoundation/volatility3?tab=readme-ov-file https://github.com/volatilityfoundation/dwarf2json\n","date":"March 28, 2024","hero":"/images/seguridad/informatica_forense.png","permalink":"https://www.javiercd.es/posts/seguridad/forense/forense/","summary":"\u003cp\u003eLa informática forense es el conjunto de técnicas que nos permite obtener la máxima información posible tras un incidente o delito informático.\nEn esta práctica, realizarás la fase de toma de evidencias y análisis de las mismas sobre una máquina Linux y otra Windows. Supondremos que pillamos al delincuente \u0026lsquo;in fraganti\u0026rsquo; y las máquinas se encontraban encendidas. Opcionalmente, podéis realizar el análisis de un dispositivo Android.\nSobre cada una de las máquinas debes realizar un volcado de memoria y otro de disco duro, tomando las medidas necesarias para certificar posteriormente la cadena de custodia.\u003c/p\u003e","tags":["LINUX","DEBIAN","WINDOWS","FORENSE"],"title":"Informática Forense"},{"categories":null,"contents":"Para descargarnos la imagen de android puedes hacerlo desde esta pagina \u0026ndash;\u0026gt; https://www.fosshub.com/Android-x86.html :\nwget https://www.fosshub.com/Android-x86.html?dwl=android-x86_64-9.0-r2.iso Crea una maquina en KVM como si fuese un Debian , yo le he dado 2GB de RAM y 2 cores :\nEn nuestro caso podemos lanzar una instalación automática :\nCuando tengas la maquina instalada , apaga la maquina y vamos a importarla en gns3 . Para ello vamos a llevarnos el disco de KVM y vamos a importarlo en el directorio donde hayamos instalado las imágenes de GNS3 , luego haz propiedad del disco copiado a tu usuario .\ncp /var/lib/libvirt/images/android-wireguard.qcow2 /home/javiercruces/GNS3/images/QEMU/ javiercruces@HPOMEN15:~$ sudo chown javiercruces:javiercruces /home/javiercruces/GNS3/images/QEMU/android-wireguard.qcow2 Ahora accede a tu GNS3 y en preferencias vamos a añadir una nueva QEMU VMs :\nSelecciona el binario de emulación x86_64 y asignale la memoria que consideres oportuna , a mi con 2GB me funciona correctamente :\nComo la imagen utiliza entorno gráfico vamos a seleccionar VNC :\nY selecciona el disco que hemos copiado a la carpeta images anteriormente :\n","date":"March 28, 2024","hero":"/images/redes/android_gns3/android.png","permalink":"https://www.javiercd.es/posts/redes/android_gns3/android/","summary":"\u003cp\u003ePara descargarnos la imagen de android puedes hacerlo desde esta pagina \u0026ndash;\u0026gt;  \u003ca href=\"https://www.fosshub.com/Android-x86.html\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.fosshub.com/Android-x86.html\u003c/a\u003e :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewget https://www.fosshub.com/Android-x86.html?dwl\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eandroid-x86_64-9.0-r2.iso\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eCrea una maquina en KVM como si fuese un Debian , yo le he dado 2GB de RAM y 2 cores :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/redes/android_gns3/Pastedimage20240117194542.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEn nuestro caso podemos lanzar una instalación automática :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/redes/android_gns3/Pastedimage20240117194647.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCuando tengas la maquina instalada , apaga la maquina y vamos a importarla en gns3 . Para ello vamos a llevarnos el disco de KVM y vamos a importarlo en el directorio donde hayamos instalado las imágenes de GNS3 , luego haz propiedad del disco copiado a tu usuario .\u003c/p\u003e","tags":["GNS3","ANDORID","LINUX","DEBIAN","KVM"],"title":"Instalación de android en GNS3 con KVM"},{"categories":null,"contents":"\nEn primer lugar configurare la maquina servidor1 como servidor VPN de acceso remoto y servidor2 como cliente VPN . Posteriormente configurare un cliente Windows y Android .\nLo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\nroot@servidor1:~# sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard debian@servidor2:~$ sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard Vamos a generar los pares de claves que se utilizarán para cifrar la conexión. Necesitaremos una clave para el servidor y un par de claves adicionales por cada cliente.\nComenzaremos con el par de claves del servidor1:\ndebian@servidor1:~$ wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= # Puedes visualizar la clave privada posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_private.key 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= # Puedes visualizar la clave publica posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= Nos desplazamos al servidor2 y les generamos las suyas :\n# Generamos el par de claves para el cliente de acceso remoto servidor2 debian@servidor2:~$ wg genkey | sudo tee /etc/wireguard/client_private.key | wg pubkey | sudo tee /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= # Puedes visualizar la clave privada posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_private.key 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= # Puedes visualizar la clave publica posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= Una vez generado las claves , vamos a proceder a configurar el servidor de acceso remoto Wireguard , en mi caso voy a llamar al fichero de configuración wg0.conf . Voy a añadirte en cada parámetro de la configuración un comentario para que sepas que tienes que poner en cada campo :\ndebian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf [Interface] # IP que tendrá el túnel VPN , en concreto la interfaz wg0 que es como has llamado el fichero de conf Address = 10.99.99.1 #Clave privada del servidor PrivateKey = 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= #Puerto de escucha , 51820 es el puerto por defecto de Wireguard ListenPort = 51820 # Si no tienes activado el bit de forwarding por defecto puedes hacerlo asi : PreUp = sysctl -w net.ipv4.ip_forward=1 # Este apartado hace referencia a la configuración de los clientes : [Peer] #Clave pública del cliente Publickey = gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= #IP del túnel VPN del cliente AllowedIPs = 10.99.99.2/32 #Tiempo de espera que tendrá activo el túnel si no hay trafico PersistentKeepAlive = 25 Ahora configuraremos un cliente debian , le he dado el mismo nombre al fichero de configuración por lo que la interfaz también se llamara wg0 :\ndebian@servidor2:~$ sudo cat /etc/wireguard/wg0.conf [Interface] Address = 10.99.99.2/24 #Clave privada del cliente PrivateKey = 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= #Puerto de escucha del servidor ListenPort = 51820 [Peer] #Clave pública del servidor PublicKey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 0.0.0.0/0 #Punto de acceso del servidor Endpoint = 90.0.0.2:51820 #Tiempo de espera de la conexión PersistentKeepalive = 25 Una vez tenemos configurados ambos ficheros levantaremos el túnel , para ello tenemos varias formas de hacerlo , personalmente la mas cómoda que veo es usando el comando wg-quick .\nLevantamos el túnel en el servidor :\ndebian@servidor1:~$ sudo wg-quick up wg0 [#] sysctl -w net.ipv4.ip_forward=1 net.ipv4.ip_forward = 1 [#] ip link add wg0 type wireguard [#] wg setconf wg0 /dev/fd/63 [#] ip -4 address add 10.99.99.1 dev wg0 [#] ip link set mtu 1420 up dev wg0 [#] ip -4 route add 10.99.99.2/32 dev wg0 Levantamos el otro extremo , en este caso nuestro cliente es servidor2 :\ndebian@servidor2:~$ sudo wg-quick up wg0 [#] ip link add wg0 type wireguard [#] wg setconf wg0 /dev/fd/63 [#] ip -4 address add 10.99.99.2/24 dev wg0 [#] ip link set mtu 1420 up dev wg0 [#] wg set wg0 fwmark 51820 [#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820 [#] ip -4 rule add not fwmark 51820 table 51820 [#] ip -4 rule add table main suppress_prefixlength 0 [#] sysctl -q net.ipv4.conf.all.src_valid_mark=1 [#] iptables-restore -n Una vez hecho esto comprobaremos que en ambos extremos se nos ha creado una nueva interfaz , que se llama igual que nuestro fichero de configuración sin la extensión .conf .\nComprobamos que se haya creado en servidor1 :\ndebian@servidor1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3 valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4 valid_lft forever preferred_lft forever 6: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000 inet 10.99.99.1/32 scope global wg0 valid_lft forever preferred_lft forever Comprobamos que se haya creado en servidor2 :\ndebian@servidor2:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 100.0.0.2/24 brd 100.0.0.255 scope global ens3 valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4 valid_lft forever preferred_lft forever 6: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000 inet 10.99.99.2/24 scope global wg0 valid_lft forever preferred_lft forever También comprobaremos las rutas que se nos ha creado en el servidor y en el cliente :\ndebian@servidor1:~$ ip r default via 90.0.0.1 dev ens3 onlink 10.99.99.2 dev wg0 scope link 10.99.99.4 dev wg0 scope link 90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 debian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.0/24 dev wg0 proto kernel scope link src 10.99.99.2 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Vamos a comprobar que desde nuestro cliente (servidor2) tenemos acceso a las distintas maquinas de nuestra red :\n## Ping con el túnel del extremo servidor1 debian@servidor2:~$ ping 10.99.99.1 -c 1 PING 10.99.99.1 (10.99.99.1) 56(84) bytes of data. 64 bytes from 10.99.99.1: icmp_seq=1 ttl=64 time=14.9 ms --- 10.99.99.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 14.862/14.862/14.862/0.000 ms ## Pings con cliente1 : debian@servidor2:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=17.5 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.503/17.503/17.503/0.000 ms # Ping con cliente2 debian@servidor2:~$ ping 192.168.0.3 -c 1 PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data. 64 bytes from 192.168.0.3: icmp_seq=1 ttl=63 time=16.5 ms --- 192.168.0.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 16.522/16.522/16.522/0.000 ms ## Ping con la ip privada del servidor1 debian@servidor2:~$ ping 192.168.0.1 -c 1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=20.3 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 20.272/20.272/20.272/0.000 ms Aunque como esta montado mi escenario , las direcciones IP privadas no están erutadas vamos a comprobar que el trafico va por el túnel , haciendo uso de traceroute :\ndebian@servidor2:~$ traceroute 192.168.0.2 traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets 1 10.99.99.1 (10.99.99.1) 18.692 ms 28.987 ms 28.951 ms 2 192.168.0.2 (192.168.0.2) 28.912 ms 28.877 ms 28.859 ms Configuración cliente android La maquina virtual de android es bastante incomoda de controlar , así que voy a generarle las claves y su fichero de configuración en el servidor1 . Posteriormente se lo haremos llegar descargandonoslo de este con apache .\nNos generamos las claves para android :\ndebian@servidor1:~$ wg genkey | tee androidprivate | wg pubkey \u0026gt; androidpublic debian@servidor1:~$ cat androidprivate CBY5o2iko7xXQrNAFcFDIKohOngawB1uvws7aDDgl0g= debian@servidor1:~$ cat androidpublic cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g= El fichero de configuración seria el siguiente :\ndebian@servidor1:~$ sudo cat android.conf [Interface] Address = 10.99.99.4 PrivateKey = CBY5o2iko7xXQrNAFcFDIKohOngawB1uvws7aDDgl0g= ListenPort = 51820 [Peer] Publickey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 0.0.0.0/0 Endpoint = 90.0.0.2:51820 Me he instalado apache y copiare este archivo al document root para hacerlo llegar a la maquina android . Uso este medio ya que es un escenario ficticio .\ndebian@servidor1:~$ sudo cp android.conf /var/www/html/ Desde una terminal , ya que el navegador no funciona demasiado bien nos descargamos el fichero : Ahora vamos a añadir en el fichero de configuración del servidor este nuevo cliente :\ndebian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf #Al final del todo :) [Peer] Publickey = cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g= AllowedIPs = 10.99.99.4/32 PersistentKeepAlive = 25 No olvides reiniciar el túnel :\ndebian@servidor1:~$ sudo wg-quick down wg0 debian@servidor1:~$ sudo wg-quick up wg0 Ahora abre la aplicación de wireguard y dale a importar desde archivo y activa la conexión . Activa el túnel y asegúrate de que se produce el handshake :\nSi abrimos una terminal podremos hacerle pings a los clientes :\nConfiguración del cliente Windows Vamos a repetir el proceso pero ahora con nuestro cliente Windows .\nPara poder copiar y pegar voy a realizar la generación de claves de este cliente en la maquina servidor1 .\nComenzaremos generando el par de claves\ndebian@servidor1:~$ wg genkey | tee winprivate | wg pubkey \u0026gt; winpublic debian@servidor1:~$ cat winprivate QKGQEdrB9FBYRZsLNgc3qr9m8/lx+uc9n5vvj67I9m8= debian@servidor1:~$ cat winpublic E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo= Nos creamos el fichero de configuración para este cliente :\ndebian@servidor1:~$ cat win.conf [Interface] Address = 10.99.99.5 PrivateKey = QKGQEdrB9FBYRZsLNgc3qr9m8/lx+uc9n5vvj67I9m8= ListenPort = 51820 [Peer] Publickey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 0.0.0.0/0 Endpoint = 90.0.0.2:51820 Lo moveré al document root para poder descargarlo en mi Windows , no hagas esto en un entorno real .\ndebian@servidor1:~$ sudo cp win.conf /var/www/html/ Recuerda configurar en la maquina servidor1 este nuevo cliente :\ndebian@servidor1:~$ sudo nano /etc/wireguard/wg0.conf [Peer] Publickey = E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo= AllowedIPs = 10.99.99.5/32 PersistentKeepAlive = 25 Para que se apliquen los cambios reinicia el túnel :\ndebian@servidor1:~$ sudo wg-quick down wg0 debian@servidor1:~$ sudo wg-quick up wg0 Una vez tenemos todo configurado , accede a la maquina Windows y descargate el fichero de configuración :\nAbre la aplicación de wireguard y selecciona importar desde archivo :\nUna vez añadido activa el túnel y comprueba que se ha producido el handshake :\nSi volvemos a nuestro Windows , se nos habrá creado una nueva interfaz :\nY tendremos conectividad con las maquinas de la red 192.168.0.0/24 :\nA modo de curiosidad podemos ver en el servidor que clientes están conectados :\ndebian@servidor1:~$ sudo wg show interface: wg0 public key: 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= private key: (hidden) listening port: 51820 peer: cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g= endpoint: 100.0.0.2:51820 allowed ips: 10.99.99.4/32 latest handshake: 1 minute, 14 seconds ago transfer: 6.43 KiB received, 788 B sent persistent keepalive: every 25 seconds peer: E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo= endpoint: 100.0.0.2:49981 allowed ips: 10.99.99.5/32 latest handshake: 1 minute, 32 seconds ago transfer: 46.23 KiB received, 1.64 KiB sent persistent keepalive: every 25 seconds peer: gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= allowed ips: 10.99.99.2/32 persistent keepalive: every 25 seconds ","date":"March 28, 2024","hero":"/images/vpn/wireguard_acceso_remoto.png","permalink":"https://www.javiercd.es/posts/vpn/acceso_remoto_wireguard/acceso_remoto_wireguard/","summary":"\u003cp\u003e\u003cimg src=\"/vpn/acceso_remoto_wireguard/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEn primer lugar configurare la maquina servidor1  como servidor VPN de acceso remoto y servidor2 como cliente VPN . Posteriormente configurare un cliente Windows y Android .\u003c/p\u003e\n\u003cp\u003eLo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@servidor1:~# sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edebian@servidor2:~$ sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVamos a generar los pares de claves que se utilizarán para cifrar la conexión. Necesitaremos una clave para el servidor y un par de  claves adicionales por cada cliente.\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","WIREGUARD"],"title":"VPN acceso remoto Wireguard"},{"categories":null,"contents":"StrongSwan es una implementación de VPN (Red Privada Virtual) basada en IPsec, de código abierto, multiplataforma, completa y ampliamente utilizada. Funciona en sistemas operativos como Linux, FreeBSD, OS X, Windows, Android e iOS. Principalmente, es un demonio de intercambio de claves que admite los protocolos de Intercambio de Claves de Internet (IKEv1 e IKEv2) para establecer asociaciones de seguridad (SA) entre dos pares.\n[!NOTE]\nVoy a partir del post de VPN acceso remoto con OpenVPN , asi que es posible que haga referencia a este durante este articulo . Si quieres tener el mismo escenario ve primero a este .\nRecuerda que para la configuración que vamos a hacer tienes que activar el bit de forwarding en las maquinas Servidor1 y Servidor2 .\nInstalación de StrongSwan Comenzaremos instalando el paquete StrongSwan en ambas maquinas :\ndebian@servidor1:~$ sudo apt install strongswan -y debian@servidor2:~$ sudo apt install strongswan -y Configuración de StrongSwan Servidor 1 A continuación configuraremos el servidor 1 , voy a ponerte un comentario para que sepas que significada cada opción :\ndebian@servidor1:~$ sudo cat /etc/ipsec.conf # Configuración global de strongSwan config setup charondebug=\u0026#34;ike 2, knl 2, cfg 2, net 2, esp 2, dmn 2, mgr 2\u0026#34; # Configuración por defecto para conexiones VPN conn %default ikelifetime=1h # Tiempo de vida de la negociación de intercambio de claves y SA. keylife=1h # Tiempo de vida de la llave del cifrado. rekeymargin=5m # Margen de tiempo antes de la expiración para la renovación. keyingtries=3 # Número máximo de intentos de renegociación. keyexchange=ikev2 # Versión del protocolo IKE. authby=secret # Uso de autenticación con clave precompartida (PSK). ike=aes256-sha1-modp1024 # Configuración de algoritmos para la fase IKE. esp=aes256-sha1 # Configuración de algoritmos para la fase ESP. conn servidor2a1 left=90.0.0.2 # Dirección IP publica de la maquina (servidor1). leftsubnet=192.168.0.0/24 # Subred privada de la maquina servidor 1. right=100.0.0.2 # Dirección IP publica del otro extremo (servidor2). rightsubnet=192.168.1.0/24 # Subred privada del otro extremo (servidor 2). auto=start # Iniciar la conexión automáticamente al arrancar strongSwan. Servidor 2 A continuación configuraremos el servidor 2 , voy a ponerte un comentario para que sepas que significada cada opción :\ndebian@servidor2:~$ sudo cat /etc/ipsec.conf # Configuración global de strongSwan config setup charondebug=\u0026#34;ike 2, knl 2, cfg 2, net 2, esp 2, dmn 2, mgr 2\u0026#34; # Configuración por defecto para conexiones VPN conn %default ikelifetime=1h # Tiempo de vida de la negociación de intercambio de claves y SA. keylife=1h # Tiempo de vida de la llave del cifrado. rekeymargin=5m # Margen de tiempo antes de la expiración para la renovación. keyingtries=3 # Número máximo de intentos de renegociación. keyexchange=ikev2 # Versión del protocolo IKE. authby=secret # Uso de autenticación con clave precompartida (PSK). ike=aes256-sha1-modp1024 # Configuración de algoritmos para la fase IKE. esp=aes256-sha1 # Configuración de algoritmos para la fase ESP. conn servidor2a1 left=100.0.0.2 # Dirección IP publica de la maquina. leftsubnet=192.168.1.0/24 # Subred privada de la maquina. right=90.0.0.2 # Dirección IP publica del servidor1. rightsubnet=192.168.0.0/24 # Subred privada del servidor 1. auto=start # Iniciar la conexión automáticamente al arrancar strongSwan. Generación de la clave compartida Una vez que hayas configurado ambas máquinas, es necesario acordar el uso de una clave compartida denominada PSK (Pre-Shared Key). Puedes generar una PSK de manera aleatoria para mejorar la seguridad de la conexión. A continuación, te proporciono un ejemplo de cómo generar una clave aleatoria :\ndebian@servidor1:~$ head -c 24 /dev/urandom | base64 cXPeOAcKIVszFHp68CcGX6dLXcWcbrIl Ahora en el fichero /etc/ipsec.secrets configuraremos la clave PSK , que en ambos extremos tiene que ser la misma :\ndebian@servidor1:~$ sudo cat /etc/ipsec.secrets # Ip publica de la maquina servidor 1 90.0.0.2 : PSK \u0026#34;cXPeOAcKIVszFHp68CcGX6dLXcWcbrIl\u0026#34; debian@servidor2:~$ sudo cat /etc/ipsec.secrets # Ip publica de la maquina servidor 2 100.0.0.2 : PSK \u0026#34;cXPeOAcKIVszFHp68CcGX6dLXcWcbrIl\u0026#34; Una vez configurado , reiniciaremos el servicio en ambos extremos :\ndebian@servidor1:~$ sudo ipsec restart debian@servidor2:~$ sudo ipsec restart Comprobación de funcionamiento Ahora comprobaremos que se ha levantado el túnel en ambos extremos :\ndebian@servidor1:~$ sudo ipsec status Security Associations (1 up, 0 connecting): servidor1a2[1]: ESTABLISHED 62 seconds ago, 90.0.0.2[90.0.0.2]...100.0.0.2[100.0.0.2] servidor1a2{1}: INSTALLED, TUNNEL, reqid 1, ESP SPIs: ccb4e51d_i c186cf93_o servidor1a2{1}: 192.168.0.0/24 === 192.168.1.0/24 debian@servidor2:~$ sudo ipsec status Security Associations (1 up, 0 connecting): servidor2a1[2]: ESTABLISHED 45 seconds ago, 100.0.0.2[100.0.0.2]...90.0.0.2[90.0.0.2] servidor2a1{2}: INSTALLED, TUNNEL, reqid 1, ESP SPIs: c186cf93_i ccb4e51d_o servidor2a1{2}: 192.168.1.0/24 === 192.168.0.0/24 Es cierto que, a diferencia de OpenVPN y WireGuard, StrongSwan no crea automáticamente una interfaz virtual para la conexión VPN. En lugar de ello, utiliza las rutas del sistema operativo para dirigir el tráfico a través del túnel IPSec.\nTablas de enrutamiento Podemos ver estas rutas de la siguiente manera , estas están guardadas en la tabla 220:\ndebian@servidor1:~$ ip r show table 220 192.168.1.0/24 via 90.0.0.1 dev ens3 proto static src 192.168.0.1 debian@servidor2:~$ ip route list table 220 192.168.0.0/24 via 100.0.0.1 dev ens3 proto static src 192.168.1.1 Comprobación de conectividad Una vez hecho esto vamos a comprobar que la maquina servidor2 puede llegar a las maquinas de la red 192.168.0.0/24 :\ndebian@servidor2:~$ ping -c 1 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=12.7 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 12.721/12.721/12.721/0.000 ms debian@servidor2:~$ ping -c 1 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=11.5 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 11.485/11.485/11.485/0.000 ms Estadísticas de los túneles Si quieres ver si el trafico ha pasado por el \u0026ldquo;túnel\u0026rdquo; , puedes hacer un statusall y ver las estadísticas :\ndebian@servidor1:~$ sudo ipsec statusall Status of IKE charon daemon (strongSwan 5.9.8, Linux 6.1.0-17-cloud-amd64, x86_64): uptime: 9 minutes, since Jan 28 10:44:01 2024 malloc: sbrk 2166784, mmap 0, used 1242160, free 924624 worker threads: 11 of 16 idle, 5/0/0/0 working, job queue: 0/0/0/0, scheduled: 2 loaded plugins: charon test-vectors ldap pkcs11 aes rc2 sha2 sha1 md5 mgf1 random nonce x509 revocation constraints pubkey pkcs1 pkcs7 pkcs12 pgp dnskey sshkey pem openssl gcrypt pkcs8 af-alg fips-prf gmp curve25519 agent chapoly xcbc cmac hmac kdf ctr ccm gcm drbg curl attr kernel-netlink resolve socket-default connmark forecast farp stroke updown eap-identity eap-aka eap-md5 eap-gtc eap-mschapv2 eap-radius eap-tls eap-ttls eap-tnc xauth-generic xauth-eap xauth-pam tnc-tnccs dhcp lookip error-notify certexpire led addrblock unity counters Listening IP addresses: 90.0.0.2 192.168.0.1 Connections: servidor1a2: 90.0.0.2...100.0.0.2 IKEv2 servidor1a2: local: [90.0.0.2] uses pre-shared key authentication servidor1a2: remote: [100.0.0.2] uses pre-shared key authentication servidor1a2: child: 192.168.0.0/24 === 192.168.1.0/24 TUNNEL Security Associations (1 up, 0 connecting): servidor1a2[1]: ESTABLISHED 9 minutes ago, 90.0.0.2[90.0.0.2]...100.0.0.2[100.0.0.2] servidor1a2[1]: IKEv2 SPIs: 80b3e1894dc769f5_i* 92c50ec8c2dedde7_r, pre-shared key reauthentication in 43 minutes servidor1a2[1]: IKE proposal: AES_CBC_256/HMAC_SHA1_96/PRF_HMAC_SHA1/MODP_1024 servidor1a2{1}: INSTALLED, TUNNEL, reqid 1, ESP SPIs: ccb4e51d_i c186cf93_o servidor1a2{1}: AES_CBC_256/HMAC_SHA1_96, 252 bytes_i (3 pkts, 358s ago), 280 bytes_o (3 pkts, 355s ag o), rekeying in 41 minutes servidor1a2{1}: 192.168.0.0/24 === 192.168.1.0/24 Captura con Wireshark Ademas puedes hacer una captura del trafico y asegurarte de que los mensajes van cifrados :\nComprobación con traceroute Ademas es curioso porque si haces un traceroute el primer salto que da es a la interfaz 192.168.0.1 del servidor1 :\ndebian@servidor2:~$ traceroute 192.168.0.2 traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets 1 192.168.0.1 (192.168.0.1) 13.695 ms 13.658 ms 13.712 ms 2 192.168.0.2 (192.168.0.2) 13.704 ms 13.695 ms 13.678 ms ","date":"March 28, 2024","hero":"/images/vpn/strongswan.png","permalink":"https://www.javiercd.es/posts/vpn/acceso_remoto_strongswang/strongswang/","summary":"\u003cp\u003eStrongSwan es una implementación de VPN (Red Privada Virtual) basada en IPsec, de código abierto, multiplataforma, completa y ampliamente utilizada. Funciona en sistemas operativos como Linux, FreeBSD, OS X, Windows, Android e iOS. Principalmente, es un demonio de intercambio de claves que admite los protocolos de Intercambio de Claves de Internet (IKEv1 e IKEv2) para establecer asociaciones de seguridad (SA) entre dos pares.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nVoy a partir del post de VPN acceso remoto con OpenVPN , asi que es posible que haga referencia a este durante este articulo . Si quieres tener el mismo escenario ve primero a este .\u003c/p\u003e","tags":["VPN","LINUX","DEBIAN","STRONGSWAN"],"title":"VPN de acceso remoto con Ipsec StrongSwan"},{"categories":null,"contents":" Uno de los dos equipos (el que actuará como servidor) estará conectado a dos redes Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación. Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La dirección 10.99.99.1 se asignará al servidor VPN. Los ficheros de configuración del servidor y del cliente se crearán en el directorio /etc/openvpn de cada máquina, y se llamarán servidor.conf y cliente.conf respectivamente. Tras el establecimiento de la VPN, la máquina cliente debe ser capaz de acceder a una máquina que esté en la otra red a la que está conectado el servidor. Montando el escenario Para realizar este ejercicio he montado el siguiente escenario en GNS3 :\nConfiguración del router cisco Vamos a darle a cada interfaz la configuración de red correspondiente :\n# Interfaz que nos dará internet R1#configure terminal R1(config)#interface fastEthernet 0/0 R1(config-if)#ip add dhcp R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 1 R1(config)#interface fastEthernet 1/0 R1(config-if)#ip add 90.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 2 R1(config)#interface fastEthernet 1/1 R1(config-if)#ip add 100.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Ruta por defecto para internet R1(config)#ip route 0.0.0.0 0.0.0.0 192.168.122.1 # Guarda la configuración R1#write # Configuración de SNAT R1#conf term R1(config)#access-list 1 permit 90.0.0.0 0.0.0.255 R1(config)#access-list 1 permit 100.0.0.0 0.0.0.255 R1(config)# ip nat pool NAT-Pool 192.168.122.127 192.168.122.127 prefix-length 24 R1(config)#ip nat inside source list 1 pool NAT-Pool overload R1(config)#interface FastEthernet0/0 R1(config-if)#ip nat outside R1(config)#interface FastEthernet1/0 R1(config-if)#ip nat inside R1(config)#interface FastEthernet1/1 R1(config-if)#ip nat inside Configuración del Servidor 1 Configuración de red servidor 1 :\ndebian@servidor1:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 90.0.0.2 netmask 255.255.255.0 gateway 90.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.0.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor1:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor1:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.0.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor1:~$ sudo apt install iptables-persistent Configuración del Servidor 2 Configuración de red servidor 2 :\ndebian@servidor2:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 100.0.0.2 netmask 255.255.255.0 gateway 100.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.1.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor2:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor2:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.1.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor2:~$ sudo apt install iptables-persistent Comprobación enroutamiento Vamos a comprobar que hemos enroutado bien nuestro escenario , para ello desde los servidores haremos un ping al contrario y ha Internet .\nDesde servidor 1 :\ndebian@servidor1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=37.4 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.374/37.374/37.374/0.000 ms debian@servidor1:~$ debian@servidor1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=63 time=18.6 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.567/18.567/18.567/0.000 ms debian@servidor1:~$ Desde el servidor 2 :\ndebian@servidor2:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=63 time=19.1 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 19.099/19.099/19.099/0.000 ms debian@servidor2:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=160 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 160.147/160.147/160.147/0.000 ms debian@servidor2:~$ También comprobaremos desde los clientes ya que hay configurado un snat .\nDesde el cliente 1 :\ndebian@cliente1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=62 time=19.0 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.968/18.968/18.968/0.000 ms debian@cliente1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=61.6 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 61.598/61.598/61.598/0.000 ms Desde el cliente 3 :\ndebian@cliente3:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=62 time=15.7 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 15.656/15.656/15.656/0.000 ms debian@cliente3:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=45.8 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 45.760/45.760/45.760/0.000 ms Instalación de OpenVPN Instalaremos en ambos servidores el paquete openvpn\n# Servidor 1 debian@servidor1:~$ sudo apt install -y openvpn # Servidor 2 debian@servidor2:~$ sudo apt install -y openvpn Generación de claves y certificados Podemos generar los certificados manualmente, pero existe una herramienta llamada Easy RSA que automatiza este proceso. Además, Easy RSA facilita la generación de los módulos Diffie-Hellman, que son esenciales para el funcionamiento del servidor OpenVPN.\nNo es necesario que nos la descarguemos ya que esta viene con el paquete openvpn .\nPara OpenVPN necesitamos crear:\nUna clave privada y un certificado x509 para la autoridad certificante que firma (CA) Una clave privada y un certificado x509 firmado para el servidor. Una clave privada y un certificado x509 firmado para cada cliente. Un grupo Diffie-Hellman para el servidor. En el servidor 1, copiaremos el archivo de ejemplo de variables para evitar la solicitud repetitiva de información como organización, país, provincia, etc., por parte de EasyRSA.\ndebian@servidor1:/usr/share/easy-rsa$ sudo cp vars.example vars Editaremos el mismo y cambiaremos los siguientes valores :\ndebian@servidor1:/usr/share/easy-rsa$ sudo nano vars set_var EASYRSA_REQ_COUNTRY \u0026#34;ES\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;Sevilla\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;Dos Hermanas\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;iesgn\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;contacto@javiercd.es\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Informatica\u0026#34; Una vez cambiado los valores por defecto por los nuestros , vamos a iniciar la infraestructura de clave pública (PKI) utilizando el script EasyRSA. Al ejecutar este comando, se crea un nuevo directorio PKI con la estructura necesaria para gestionar las claves y certificados.\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa init-pki * Notice: init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: * /usr/share/easy-rsa/pki Generación de los parámetros Diffie-Hellman La clave de intercambio de Diffie-Hellman, es un método criptográfico que permite a dos partes acordar de forma segura una clave de sesión compartida sobre un canal no seguro. Así que vamos a generarla haciedo uso del siguiente comando :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-dh * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Generating DH parameters, 2048 bit long safe prime ......... * Notice: DH parameters of size 2048 created at /usr/share/easy-rsa/pki/dh.pem Se nos habrá generado la clave en /usr/share/easy-rsa/pki/dh.pem , tal y como indica la salida del comando .\nGeneración del certificado de la CA Vamos a proceder a generar el certificado de nuestra CA :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Using configuration from /usr/share/easy-rsa/pki/52a64968/temp.25a8f31d You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:ca.javiercd.es * Notice: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /usr/share/easy-rsa/pki/ca.crt Se nos habrá generado en /usr/share/easy-rsa/pki/ca.crt\nGeneración del certificado del servidor 1 Con el siguiente comando generaremos los certificados para el servidor 1 . Se generaran varios archivos :\nservidor1.req : Este archivo contiene la solicitud de certificado generada para el servidor servidor1.key : Este archivo contiene la clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor1 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) ....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+........+...+.+......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+............+...+....+...+.....+...+...+......+....+.....+......+...+.+..+...+....+..+...............+......+.........+......+.......+.....+......+.+........+.+.....+......+...............+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ....+............+..+.+...+...........+....+...........+......+...+.+...+..+.+........+....+...+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+............+...+.....+....+..+...+.+...............+.....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......+........+..........+...+.................+.+..+....+.....+..........+...+......+.........+.....+.+............+..+..................+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor1]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor1.req key: /usr/share/easy-rsa/pki/private/servidor1.key Ahora vamos a firmar el certificado del servidor1 con la clave privada de la CA .\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server servidor1 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 825 days: subject= commonName = servidor1 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/e66a9d70/temp.40a6d9dd Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor1\u0026#39; Certificate is to be certified until Apr 18 16:15:16 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor1.crt Como puedes ver tendremos los 3 ficheros referentes a nuestro servidor 1 generados :\n# Certificado firmado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/issued | grep servidor1 -rw------- 1 root root 4637 Jan 14 16:15 servidor1.crt # Clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/private | grep servidor1 -rw------- 1 root root 1704 Jan 14 16:09 servidor1.key # Solicitud de firma del certificado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/reqs | grep servidor1 -rw------- 1 root root 891 Jan 14 16:09 servidor1.req Generación del certificado del servidor 2 Repetiremos el mismo proceso que hemos realizado para el servidor 1 , pero ahora para nuestro servidor 2 .\nGeneraremos la clave y el certificado :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor2 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) .+.+.................+...+...+.......+..+.+...........+.+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+....+..+..........+....................+.......+.....+.......+...+..+................+..+.......+.........+...........+....+..+...+.+......+..+...+....+.....+.........+....+......+......+.........+..+...+............+...+.+...+..+....+............+...............+..+...+.............+............+.....+.......+.....+.+......+........+.....................+.+......+..+.+......+.....+.........+......+.........+.......+...+...............+.....+...............+.+....................+......+...+................+...+...+............+.....+...............+.......+......+........+......+....+......+........+.+.....+....+..+.+........+.+.....+.+.....+...........................+......+.+...+.....+......+....+..+....+......+........+.............+..+...+.........+....+..+...+....+...+...+...........+......+...................+.....+................+...+..+....+...+..+......+...+..........+..+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ..........+............+...+....+...+.....+...+......+.+.....+.......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+.+......+..+.+..+...+.........+............+..................+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+...........+.+...+..+....+..............+......+...............+.+......+..............+....+......+..................+...+............+..+....+.....+.......+...+.........+..+......+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor2]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor2.req key: /usr/share/easy-rsa/pki/private/servidor2.key Fíjate que ahora a este certificado a la hora de firmarlo diremos que es de tipo cliente . Ya que el servidor 2 \u0026ldquo;actuara como un cliente\u0026rdquo;:\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req client servidor2 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 825 days: subject= commonName = servidor2 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/8e1b2785/temp.504078d9 Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor2\u0026#39; Certificate is to be certified until Apr 18 16:57:49 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor2.crt Generación de la clave TLS Este paso es opcional , pero es recomendable generar una clave compartida (también conocida como clave de parámetro adicional o clave ta.key) en el contexto de OpenVPN.)\nEn el contexto de OpenVPN, esta clave compartida (ta.key) se utiliza para firmar y verificar todos los paquetes de datos transmitidos a través de la conexión VPN. Su propósito principal es proporcionar una capa adicional de seguridad y autenticación, ayudando a prevenir ataques como el de replay.\ndebian@servidor1:/usr/share/easy-rsa$ sudo openvpn --genkey --secret ta.key Distribuir las claves Ahora tenemos que hacer llegar cada clave a su lugar correspondiente .\nEn el servidor 1 crearemos el directorio /etc/openvpn/keys y guardaremos los siguientes ficheros :\n# Creamos el directorio donde guardaremos las claves debian@servidor1:/usr/share/easy-rsa$ sudo mkdir /etc/openvpn/keys # Nos la copiamos al directorio creado debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/dh.pem /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/ca.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/private/servidor1.key /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/issued/servidor1.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/ta.key /etc/openvpn/keys # Comprobamos que tenemos todoos los ficheros necesarios debian@servidor1:~$ sudo ls -l /etc/openvpn/keys total 24 -rw------- 1 root root 1216 Jan 14 17:08 ca.crt -rw------- 1 root root 424 Jan 14 17:08 dh.pem -rw------- 1 root root 4637 Jan 14 17:08 servidor1.crt -rw------- 1 root root 1704 Jan 14 17:08 servidor1.key -rw------- 1 root root 636 Jan 14 17:08 ta.key Ahora haremos lo mismo para el servidor2 , pero tendremos que llevarnos las claves haciendo uso de SCP\n# Creamos el directorio donde guardaremos las claves debian@servidor2:~$ sudo mkdir /etc/openvpn/keys # Desde servidor1 pasare a servidor2 las claves debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/ca.crt debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/ta.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/private/servidor2.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/issued/servidor2.crt debian@100.0.0.2:/home/debian # Las movemos a /etc/openvpn/keys debian@servidor2:~$ sudo mv * /etc/openvpn/keys # Nos aseguramos de tener los 4 ficheros que hemos enviado : debian@servidor2:~$ sudo ls -l /etc/openvpn/keys total 20 -rw------- 1 debian debian 1216 Jan 14 17:12 ca.crt -rw------- 1 debian debian 4515 Jan 14 17:14 servidor2.crt -rw------- 1 debian debian 1704 Jan 14 17:13 servidor2.key -rw------- 1 debian debian 636 Jan 14 17:13 ta.key Configuración de OpenVPN Configuración de OpenVPN en el servidor 1 Asegúrate de tener activado el bit de forwarding en tu servidor :\ndebian@servidor1:~$ sudo sysctl net.ipv4.ip_forward net.ipv4.ip_forward = 1 Vamos a editar el fichero /etc/default/openvpn y descomentaremos la siguiente linea para indicar que se inicien automaticamente todos los túneles vpn :\nAUTOSTART=\u0026#34;all\u0026#34; Crearemos un fichero de configuración para nuestro servidor , en mi caso mi configuración es la siguiente :\ndebian@servidor1:~$ sudo nano /etc/openvpn/servidor1.conf # Use a dynamic TUN device dev tun # Use tcp for communicating with the client proto tcp # Virtual IP range for the VPN clients server 10.99.99.0 255.255.255.0 # Push the route for the local subnet to the clients push \u0026#34;route 192.168.0.0 255.255.255.0\u0026#34; # Enable TLS and assume the server role tls-server # Diffie-Hellman parameters dh /etc/openvpn/keys/dh.pem # Certificate Authority\u0026#39;s certificate ca /etc/openvpn/keys/ca.crt # Server\u0026#39;s certificate cert /etc/openvpn/keys/servidor1.crt # Server\u0026#39;s private key key /etc/openvpn/keys/servidor1.key # Use fast LZO compression comp-lzo # Ping the remote every 10 seconds and restart after 60 seconds keepalive 10 60 # Set output verbosity to normal usage range verb 3 Ahora reinicia el servicio para que se apliquen los cambios y se levante la interfaz . Es posible que necesites reiniciar la maquina :\ndebian@servidor1:~$ sudo systemctl restart openvpn.service Y veremos que se ha levantado la interfaz tun0 :\ndebian@servidor1:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:21:18:28:00:00 brd ff:ff:ff:ff:ff:ff altname enp0s3 inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3 valid_lft forever preferred_lft forever inet6 fe80::e21:18ff:fe28:0/64 scope link valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:21:18:28:00:01 brd ff:ff:ff:ff:ff:ff altname enp0s4 inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4 valid_lft forever preferred_lft forever inet6 fe80::e21:18ff:fe28:1/64 scope link valid_lft forever preferred_lft forever 4: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::8491:9eb9:104e:6bf7/64 scope link stable-privacy valid_lft forever preferred_lft forever Configuración de OpenVPN en el servidor 2 Asegúrate de tener activado el bit de forwarding en tu servidor :\ndebian@servidor2:~$ sudo sysctl net.ipv4.ip_forward net.ipv4.ip_forward = 1 Vamos a editar el fichero /etc/default/openvpn y descomentaremos la siguiente linea para indicar que se inicien automaticamente todos los túneles vpn :\nAUTOSTART=\u0026#34;all\u0026#34; Crearemos un fichero de configuración para nuestro servidor , en mi caso mi configuración es la siguiente :\ndebian@servidor2:~$ sudo nano /etc/openvpn/servidor2.conf # Use a dynamic TUN device dev tun # Connect to server remote 90.0.0.2 # Set virtual point-to-point IP addresses ifconfig 10.99.99.0 255.255.255.0 pull # Use TCP for communicating with server proto tcp-client # Enable TLS and assume client role during TLS handshake tls-client # Certificado de la CA ca /etc/openvpn/keys/ca.crt # Certificado del cliente cert /etc/openvpn/keys/servidor2.crt # Clave privada del cliente key /etc/openvpn/keys/servidor2.key # Use fast LZO compression comp-lzo # Ping remote every 10sg and restart after 60sg passed without sign of life from remote keepalive 10 60 # Set output verbosity to normal usage range verb 3 # Output logging messages to openvpn.log file log /var/log/openvpn.log Ahora reinicia el servicio para que se apliquen los cambios y se levante la interfaz . Es posible que necesites reiniciar la maquina :\ndebian@servidor2:~$ sudo systemctl restart openvpn.service Y veremos que se ha levantado la interfaz tun0 :\ndebian@servidor2:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:82:67:88:00:00 brd ff:ff:ff:ff:ff:ff altname enp0s3 inet 100.0.0.2/24 brd 100.0.0.255 scope global ens3 valid_lft forever preferred_lft forever inet6 fe80::e82:67ff:fe88:0/64 scope link valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:82:67:88:00:01 brd ff:ff:ff:ff:ff:ff altname enp0s4 inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4 valid_lft forever preferred_lft forever inet6 fe80::e82:67ff:fe88:1/64 scope link valid_lft forever preferred_lft forever 4: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.6 peer 10.99.99.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::67f5:fd86:d948:132a/64 scope link stable-privacy valid_lft forever preferred_lft forever Comprobación de funcionamiento Ahora vamos a comprobar que desde servidor2 podemos acceder a las maquinas clientes de la red 192.168.0.0/24 .\ndebian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.1 via 10.99.99.5 dev tun0 10.99.99.5 dev tun0 proto kernel scope link src 10.99.99.6 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.0.0/24 via 10.99.99.5 dev tun0 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Como puedes ver tendremos conectividad desde el servidor hacia los equipos de la otra red.\ndebian@servidor2:~$ ping 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=16.4 ms 64 bytes from 192.168.0.2: icmp_seq=2 ttl=63 time=14.3 ms 64 bytes from 192.168.0.2: icmp_seq=3 ttl=63 time=19.1 ms ^C --- 192.168.0.2 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2004ms rtt min/avg/max/mdev = 14.308/16.582/19.060/1.945 ms También podremos conectarnos por ssh , me conectare hacia el cliente 1 :\ndebian@servidor2:~$ ssh debian@192.168.0.2 The authenticity of host \u0026#39;192.168.0.2 (192.168.0.2)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:zn2i5rAyilMi1i+Kqb6ys8GhldKuHKYZCDKbD1aXqjQ. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;192.168.0.2\u0026#39; (ED25519) to the list of known hosts. debian@192.168.0.2\u0026#39;s password: Linux cliente1 6.1.0-15-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.66-1 (2023-12-09) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sun Jan 14 15:29:30 2024 debian@cliente1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.0.2/24 brd 192.168.0.255 scope global ens3 valid_lft forever preferred_lft forever ","date":"March 28, 2024","hero":"/images/vpn/remoteaccess.png","permalink":"https://www.javiercd.es/posts/vpn/acceso_remoto_openvpn/accesoremoto_openvpn/","summary":"\u003cul\u003e\n\u003cli\u003eUno de los dos equipos (el que actuará como servidor) estará conectado a dos redes\n\u003cul\u003e\n\u003cli\u003ePara la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con  los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.\u003c/li\u003e\n\u003cli\u003eSe utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La dirección 10.99.99.1 se asignará al servidor VPN.\u003c/li\u003e\n\u003cli\u003eLos ficheros de configuración del servidor y del cliente se crearán en el directorio /etc/openvpn de cada máquina, y se llamarán servidor.conf y cliente.conf respectivamente.\u003c/li\u003e\n\u003cli\u003eTras el establecimiento de la VPN, la máquina cliente debe ser capaz de acceder a una máquina que esté en la otra red a la que está conectado el servidor.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"montando-el-escenario\"\u003eMontando el escenario\u003c/h2\u003e\n\u003cp\u003ePara realizar este ejercicio he montado el siguiente escenario en GNS3 :\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","OPENVPN"],"title":"VPN de acceso remoto con OpenVPN y certificados x509"},{"categories":null,"contents":"Montando el escenario Para realizar este ejercicio he montado el siguiente escenario en GNS3 :\nConfiguración del router cisco Vamos a darle a cada interfaz la configuración de red correspondiente :\n# Interfaz que nos dará internet R1#configure terminal R1(config)#interface fastEthernet 0/0 R1(config-if)#ip add dhcp R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 1 R1(config)#interface fastEthernet 1/0 R1(config-if)#ip add 90.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 2 R1(config)#interface fastEthernet 1/1 R1(config-if)#ip add 100.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Ruta por defecto para internet R1(config)#ip route 0.0.0.0 0.0.0.0 192.168.122.1 # Guarda la configuración R1#write # Configuración de SNAT R1#conf term R1(config)#access-list 1 permit 90.0.0.0 0.0.0.255 R1(config)#access-list 1 permit 100.0.0.0 0.0.0.255 R1(config)# ip nat pool NAT-Pool 192.168.122.127 192.168.122.127 prefix-length 24 R1(config)#ip nat inside source list 1 pool NAT-Pool overload R1(config)#interface FastEthernet0/0 R1(config-if)#ip nat outside R1(config)#interface FastEthernet1/0 R1(config-if)#ip nat inside R1(config)#interface FastEthernet1/1 R1(config-if)#ip nat inside Configuración del Servidor 1 Configuración de red servidor 1 :\ndebian@servidor1:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 90.0.0.2 netmask 255.255.255.0 gateway 90.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.0.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor1:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor1:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.0.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor1:~$ sudo apt install iptables-persistent Configuración del Servidor 2 Configuración de red servidor 2 :\ndebian@servidor2:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 100.0.0.2 netmask 255.255.255.0 gateway 100.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.1.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor2:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor2:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.1.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor2:~$ sudo apt install iptables-persistent Comprobación enroutamiento Vamos a comprobar que hemos enroutado bien nuestro escenario , para ello desde los servidores haremos un ping al contrario y ha Internet .\nDesde servidor 1 :\ndebian@servidor1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=37.4 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.374/37.374/37.374/0.000 ms debian@servidor1:~$ debian@servidor1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=63 time=18.6 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.567/18.567/18.567/0.000 ms debian@servidor1:~$ Desde el servidor 2 :\ndebian@servidor2:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=63 time=19.1 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 19.099/19.099/19.099/0.000 ms debian@servidor2:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=160 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 160.147/160.147/160.147/0.000 ms debian@servidor2:~$ También comprobaremos desde los clientes ya que hay configurado un snat .\nDesde el cliente 1 :\ndebian@cliente1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=62 time=19.0 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.968/18.968/18.968/0.000 ms debian@cliente1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=61.6 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 61.598/61.598/61.598/0.000 ms Desde el cliente 3 :\ndebian@cliente3:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=62 time=15.7 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 15.656/15.656/15.656/0.000 ms debian@cliente3:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=45.8 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 45.760/45.760/45.760/0.000 ms Instalación de OpenVPN Instalaremos en ambos servidores el paquete openvpn\n# Servidor 1 debian@servidor1:~$ sudo apt install -y openvpn # Servidor 2 debian@servidor2:~$ sudo apt install -y openvpn Generación de claves y certificados Podemos generar los certificados manualmente, pero existe una herramienta llamada Easy RSA que automatiza este proceso. Además, Easy RSA facilita la generación de los módulos Diffie-Hellman, que son esenciales para el funcionamiento del servidor OpenVPN.\nNo es necesario que nos la descarguemos ya que esta viene con el paquete openvpn .\nPara OpenVPN necesitamos crear:\nUna clave privada y un certificado x509 para la autoridad certificante que firma (CA) Una clave privada y un certificado x509 firmado para el servidor. Una clave privada y un certificado x509 firmado para cada cliente. Un grupo Diffie-Hellman para el servidor. En el servidor 1, copiaremos el archivo de ejemplo de variables para evitar la solicitud repetitiva de información como organización, país, provincia, etc., por parte de EasyRSA.\ndebian@servidor1:/usr/share/easy-rsa$ sudo cp vars.example vars Editaremos el mismo y cambiaremos los siguientes valores :\ndebian@servidor1:/usr/share/easy-rsa$ sudo nano vars set_var EASYRSA_REQ_COUNTRY \u0026#34;ES\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;Sevilla\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;Dos Hermanas\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;iesgn\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;contacto@javiercd.es\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Informatica\u0026#34; Una vez cambiado los valores por defecto por los nuestros , vamos a iniciar la infraestructura de clave pública (PKI) utilizando el script EasyRSA. Al ejecutar este comando, se crea un nuevo directorio PKI con la estructura necesaria para gestionar las claves y certificados.\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa init-pki * Notice: init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: * /usr/share/easy-rsa/pki Generación de los parámetros Diffie-Hellman La clave de intercambio de Diffie-Hellman, es un método criptográfico que permite a dos partes acordar de forma segura una clave de sesión compartida sobre un canal no seguro. Así que vamos a generarla haciedo uso del siguiente comando :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-dh * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Generating DH parameters, 2048 bit long safe prime ......... * Notice: DH parameters of size 2048 created at /usr/share/easy-rsa/pki/dh.pem Se nos habrá generado la clave en /usr/share/easy-rsa/pki/dh.pem , tal y como indica la salida del comando .\nGeneración del certificado de la CA Vamos a proceder a generar el certificado de nuestra CA :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Using configuration from /usr/share/easy-rsa/pki/52a64968/temp.25a8f31d You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:ca.javiercd.es * Notice: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /usr/share/easy-rsa/pki/ca.crt Se nos habrá generado en /usr/share/easy-rsa/pki/ca.crt\nGeneración del certificado del servidor 1 Con el siguiente comando generaremos los certificados para el servidor 1 . Se generaran varios archivos :\nservidor1.req : Este archivo contiene la solicitud de certificado generada para el servidor servidor1.key : Este archivo contiene la clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor1 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) ....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+........+...+.+......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+............+...+....+...+.....+...+...+......+....+.....+......+...+.+..+...+....+..+...............+......+.........+......+.......+.....+......+.+........+.+.....+......+...............+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ....+............+..+.+...+...........+....+...........+......+...+.+...+..+.+........+....+...+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+............+...+.....+....+..+...+.+...............+.....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......+........+..........+...+.................+.+..+....+.....+..........+...+......+.........+.....+.+............+..+..................+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor1]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor1.req key: /usr/share/easy-rsa/pki/private/servidor1.key Ahora vamos a firmar el certificado del servidor1 con la clave privada de la CA .\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server servidor1 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 825 days: subject= commonName = servidor1 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/e66a9d70/temp.40a6d9dd Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor1\u0026#39; Certificate is to be certified until Apr 18 16:15:16 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor1.crt Como puedes ver tendremos los 3 ficheros referentes a nuestro servidor 1 generados :\n# Certificado firmado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/issued | grep servidor1 -rw------- 1 root root 4637 Jan 14 16:15 servidor1.crt # Clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/private | grep servidor1 -rw------- 1 root root 1704 Jan 14 16:09 servidor1.key # Solicitud de firma del certificado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/reqs | grep servidor1 -rw------- 1 root root 891 Jan 14 16:09 servidor1.req Generación del certificado del servidor 2 Repetiremos el mismo proceso que hemos realizado para el servidor 1 , pero ahora para nuestro servidor 2 .\nGeneraremos la clave y el certificado :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor2 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) .+.+.................+...+...+.......+..+.+...........+.+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+....+..+..........+....................+.......+.....+.......+...+..+................+..+.......+.........+...........+....+..+...+.+......+..+...+....+.....+.........+....+......+......+.........+..+...+............+...+.+...+..+....+............+...............+..+...+.............+............+.....+.......+.....+.+......+........+.....................+.+......+..+.+......+.....+.........+......+.........+.......+...+...............+.....+...............+.+....................+......+...+................+...+...+............+.....+...............+.......+......+........+......+....+......+........+.+.....+....+..+.+........+.+.....+.+.....+...........................+......+.+...+.....+......+....+..+....+......+........+.............+..+...+.........+....+..+...+....+...+...+...........+......+...................+.....+................+...+..+....+...+..+......+...+..........+..+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ..........+............+...+....+...+.....+...+......+.+.....+.......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+.+......+..+.+..+...+.........+............+..................+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+...........+.+...+..+....+..............+......+...............+.+......+..............+....+......+..................+...+............+..+....+.....+.......+...+.........+..+......+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor2]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor2.req key: /usr/share/easy-rsa/pki/private/servidor2.key Fíjate que ahora a este certificado a la hora de firmarlo diremos que es de tipo cliente . Ya que el servidor 2 \u0026ldquo;actuara como un cliente\u0026rdquo;:\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req client servidor2 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 825 days: subject= commonName = servidor2 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/8e1b2785/temp.504078d9 Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor2\u0026#39; Certificate is to be certified until Apr 18 16:57:49 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor2.crt Generación de la clave TLS Este paso es opcional , pero es recomendable generar una clave compartida (también conocida como clave de parámetro adicional o clave ta.key) en el contexto de OpenVPN.)\nEn el contexto de OpenVPN, esta clave compartida (ta.key) se utiliza para firmar y verificar todos los paquetes de datos transmitidos a través de la conexión VPN. Su propósito principal es proporcionar una capa adicional de seguridad y autenticación, ayudando a prevenir ataques como el de replay.\ndebian@servidor1:/usr/share/easy-rsa$ sudo openvpn --genkey --secret ta.key Distribuir las claves Ahora tenemos que hacer llegar cada clave a su lugar correspondiente .\nEn el servidor 1 crearemos el directorio /etc/openvpn/keys y guardaremos los siguientes ficheros :\n# Creamos el directorio donde guardaremos las claves debian@servidor1:/usr/share/easy-rsa$ sudo mkdir /etc/openvpn/keys # Nos la copiamos al directorio creado debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/dh.pem /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/ca.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/private/servidor1.key /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/issued/servidor1.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/ta.key /etc/openvpn/keys # Comprobamos que tenemos todoos los ficheros necesarios debian@servidor1:~$ sudo ls -l /etc/openvpn/keys total 24 -rw------- 1 root root 1216 Jan 14 17:08 ca.crt -rw------- 1 root root 424 Jan 14 17:08 dh.pem -rw------- 1 root root 4637 Jan 14 17:08 servidor1.crt -rw------- 1 root root 1704 Jan 14 17:08 servidor1.key -rw------- 1 root root 636 Jan 14 17:08 ta.key Ahora haremos lo mismo para el servidor2 , pero tendremos que llevarnos las claves haciendo uso de SCP\n# Creamos el directorio donde guardaremos las claves debian@servidor2:~$ sudo mkdir /etc/openvpn/keys # Desde servidor1 pasare a servidor2 las claves debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/ca.crt debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/ta.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/private/servidor2.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/issued/servidor2.crt debian@100.0.0.2:/home/debian # Las movemos a /etc/openvpn/keys debian@servidor2:~$ sudo mv * /etc/openvpn/keys # Nos aseguramos de tener los 4 ficheros que hemos enviado : debian@servidor2:~$ sudo ls -l /etc/openvpn/keys total 20 -rw------- 1 debian debian 1216 Jan 14 17:12 ca.crt -rw------- 1 debian debian 4515 Jan 14 17:14 servidor2.crt -rw------- 1 debian debian 1704 Jan 14 17:13 servidor2.key -rw------- 1 debian debian 636 Jan 14 17:13 ta.key Configuración de OpenVPN Configuración del servidor 1 [!NOTE] Este apartado lo esta comparando con el post de VPN de acceso remoto.\nComo ves los únicos parámetros que hemos cambiado en la configuración es la IP virtual y el parámetro route para generar la ruta hacia la red privada del otro extremo:\ndebian@servidor1:~$ sudo nano /etc/openvpn/servidor1.conf # Utilizar un dispositivo TUN dinámico dev tun # IP virtual ifconfig 10.99.99.1 10.99.99.2 # Ruta para llegar a la red del otro extremo route 192.168.1.0 255.255.255.0 # Habilitar TLS y asumir el rol de servidor tls-server # Parámetros de Diffie-Hellman dh /etc/openvpn/keys/dh.pem # Certificado de la Autoridad Certificadora ca /etc/openvpn/keys/ca.crt # Certificado del servidor cert /etc/openvpn/keys/servidor1.crt # Clave privada del servidor key /etc/openvpn/keys/servidor1.key # Utilizar compresión LZO rápida comp-lzo # Ping al remoto cada 10 segundos y reiniciar después de 60 segundos keepalive 10 60 # Establecer la verbosidad de salida en un rango de uso normal verb 3 Reinicia el servicio OpenVPN del servidor 1 :\ndebian@servidor1:~$ sudo systemctl restart openvpn Comprueba que se te ha generado la interfaz tun0 :\ndebian@servidor1:~$ ip a show tun0 9: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::a6be:e8ba:17e5:35e3/64 scope link stable-privacy valid_lft forever preferred_lft forever Y por ultimo comprueba que la ruta para llegar a la red del otro extremo es correcta , es decir que va a través de la interfaz tun0 :\ndebian@servidor1:~$ ip r default via 90.0.0.1 dev ens3 onlink 10.99.99.2 dev tun0 proto kernel scope link src 10.99.99.1 90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 192.168.1.0/24 via 10.99.99.2 dev tun0 Configuración del servidor 2 debian@servidor2:~$ sudo nano /etc/openvpn/servidor2.conf # Utilizar un dispositivo TUN dinámico dev tun # Conectar al servidor remote 90.0.0.2 # Establecer direcciones IP virtuales punto a punto ifconfig 10.99.99.2 10.99.99.1 # Ruta para llegar a la red remota (local del servidor 1) route 192.168.0.0 255.255.255.0 # Habilitar TLS y asumir el rol de cliente durante el handshake de TLS tls-client # Certificado de la Autoridad Certificadora ca /etc/openvpn/keys/ca.crt # Certificado del cliente cert /etc/openvpn/keys/servidor2.crt # Clave privada del cliente key /etc/openvpn/keys/servidor2.key # Utilizar compresión LZO rápida comp-lzo # Hacer ping al remoto cada 10 segundos y reiniciar después de 60 segundos si no hay señal de vida del \u0026gt; keepalive 10 60 # Establecer la verbosidad de salida en un rango de uso normal verb 3 # Registrar mensajes en el archivo openvpn.log log /var/log/openvpn.log Reinicia el servicio OpenVPN en el servidor 2 para que se aplique la nueva configuración :\ndebian@servidor2:~$ sudo systemctl restart openvpn Comprueba que se te ha generado la interfaz tun0 :\ndebian@servidor2:~$ ip a show tun0 10: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.2 peer 10.99.99.1/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::ded7:8620:c295:146a/64 scope link stable-privacy valid_lft forever preferred_lft forever Y por ultimo comprueba que la ruta para llegar a la red del otro extremo es correcta , es decir que va a través de la interfaz tun0 :\ndebian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.1 dev tun0 proto kernel scope link src 10.99.99.2 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.0.0/24 via 10.99.99.1 dev tun0 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Comprobación de funcionamiento Ahora, ambas redes privadas, tanto la 192.168.0.0/24 como la 192.168.1.0/24, contarán con conectividad gracias a los servidores VPN .\nPing desde cliente 1 hacia cliente 2 :\ndebian@cliente1:~$ ping 192.168.1.2 -c 1 PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data. 64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=15.6 ms --- 192.168.1.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 15.645/15.645/15.645/0.000 ms Ping desde cliente 2 hacia cliente 1 :\ndebian@cliente3:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=17.3 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.345/17.345/17.345/0.000 ms Ping desde servidor 1 hacia servidor 2 :\ndebian@servidor1:~$ ping 192.168.1.1 -c 1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=18.0 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.988/17.988/17.988/0.000 ms Ping desde servidor 1 hacia servidor 2 :\ndebian@servidor2:~$ ping 192.168.0.1 -c 1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=12.6 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 12.558/12.558/12.558/0.000 ms Por supuesto también podremos acceder a cualquier servicio en la otra red o conectarnos por SSH desde un extremo del túnel a otro :\ndebian@cliente3:~$ ssh 192.168.0.1 debian@192.168.0.1\u0026#39;s password: Linux servidor1 6.1.0-15-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.66-1 (2023-12-09) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Jan 16 18:51:53 2024 from 192.168.1.2 debian@servidor1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3 valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4 valid_lft forever preferred_lft forever 9: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0 valid_lft forever preferred_lft forever Cliente Android [!TIP] En los post de redes encontraras una guia para instalar una maquina virtual de android en KVM y GNS3\nLa configuración de red del mismo se realiza desde el wifi :\nComprueba que desde la red local del mismo tienes conectividad con la ip asignada :\ndebian@cliente3:~$ ping 192.168.1.4 PING 192.168.1.4 (192.168.1.4) 56(84) bytes of data. 64 bytes from 192.168.1.4: icmp_seq=1 ttl=64 time=0.534 ms ^C --- 192.168.1.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.534/0.534/0.534/0.000 ms Ademas este cuenta en las aplicaciones con un emulador de terminal que nos servirá para comprobar que tiene conectividad :\n","date":"March 28, 2024","hero":"/images/vpn/sitetosite.png","permalink":"https://www.javiercd.es/posts/vpn/site_to_site_openvpn/site_to_site_openvpn/","summary":"\u003ch2 id=\"montando-el-escenario\"\u003eMontando el escenario\u003c/h2\u003e\n\u003cp\u003ePara realizar este ejercicio he montado el siguiente escenario en GNS3 :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/vpn/site_to_site_wireguard/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"configuración-del-router-cisco\"\u003eConfiguración del router cisco\u003c/h3\u003e\n\u003cp\u003eVamos a darle a cada interfaz la configuración de red correspondiente :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Interfaz que nos dará internet \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1#configure terminal \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface fastEthernet 0/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip add dhcp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#no shut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Interfaz red Servidor 1 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface fastEthernet 1/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip add 90.0.0.1 255.255.255.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#no shut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Interfaz red Servidor 2 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface fastEthernet 1/1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip add 100.0.0.1 255.255.255.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#no shut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Ruta por defecto para internet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip route 0.0.0.0 0.0.0.0 192.168.122.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Guarda la configuración\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1#write\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Configuración de SNAT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1#conf term\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#access-list 1 permit 90.0.0.0 0.0.0.255\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#access-list 1 permit 100.0.0.0 0.0.0.255\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e# ip nat pool NAT-Pool 192.168.122.127 192.168.122.127 prefix-length 24\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat inside source list 1 pool NAT-Pool overload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface FastEthernet0/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat outside\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface FastEthernet1/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat inside\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface FastEthernet1/1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat inside\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"configuración-del-servidor-1\"\u003eConfiguración del Servidor 1\u003c/h4\u003e\n\u003cp\u003eConfiguración de red servidor 1 :\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","OPENVPN"],"title":"VPN site to site con OpenVPN y certificados x509"},{"categories":null,"contents":"\n[!NOTE]\nVoy a partir del post de VPN acceso remoto con Wireguard , asi que es posible que haga referencia a este durante este articulo .\nGeneración de claves Lo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\nroot@servidor1:~# sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard debian@servidor2:~$ sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard Vamos a generar los pares de claves que se utilizarán para cifrar la conexión. Necesitaremos una clave para el servidor y un par de claves adicionales por cada cliente.\nComenzaremos con el par de claves del servidor1:\ndebian@servidor1:~$ wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= # Puedes visualizar la clave privada posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_private.key 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= # Puedes visualizar la clave publica posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= Nos desplazamos al servidor2 y les generamos las suyas :\n# Generamos el par de claves para el cliente de acceso remoto servidor2 debian@servidor2:~$ wg genkey | sudo tee /etc/wireguard/client_private.key | wg pubkey | sudo tee /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= # Puedes visualizar la clave privada posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_private.key 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= # Puedes visualizar la clave publica posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= Configuración de Wireguard Vamos a modificar el archivo de configuración en la máquina servidor1. La única modificación necesaria será en el parámetro \u0026ldquo;AllowedIPs\u0026rdquo;, donde debemos agregar la dirección de red a la que nos conectaremos. Además, incluiremos en el campo \u0026ldquo;Peer Endpoint\u0026rdquo; la dirección IP de la otra máquina, ya que ambas actuarán como servidores en esta configuración.\ndebian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf [Interface] Address = 10.99.99.1 PrivateKey = 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= ListenPort = 51820 [Peer] Publickey = gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= AllowedIPs = 10.99.99.2/32,192.168.1.0/24 PersistentKeepAlive = 25 Endpoint = 100.0.0.2:51820 Lo mismo para la maquina servidor2 , la configuración quedaría así:\ndebian@servidor2:~$ sudo cat /etc/wireguard/wg0.conf [Interface] Address = 10.99.99.2/24 PrivateKey = 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= ListenPort = 51820 [Peer] PublicKey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 10.99.99.1/32,192.168.0.0/24 Endpoint = 90.0.0.2:51820 PersistentKeepalive = 25 Como yo tengo levantado los túneles del ejercicio anterior los bajaremos y los subiremos para que se aplique la nueva configuración :\ndebian@servidor1:~$ sudo wg-quick down wg0 debian@servidor2:~$ sudo wg-quick down wg0 debian@servidor1:~$ sudo wg-quick up wg0 debian@servidor1:~$ sudo wg-quick up wg0 Comprobaremos que en ambos servidores se ha creado la interfaz wg0 , que es la que nos corresponde por el nombre del fichero de configuración :\ndebian@servidor1:~$ sudo ip link show wg0 11: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/none debian@servidor2:~$ sudo ip link show wg0 11: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/none A continuación voy a mostrarte las tablas de enroutamiento de los 2 servidores para que veas que se han creado rutas para llegar a ambas redes privadas por la interfaz wg0:\ndebian@servidor1:~$ ip r default via 90.0.0.1 dev ens3 onlink 10.99.99.2 dev wg0 scope link 90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 192.168.1.0/24 dev wg0 scope link debian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.0/24 dev wg0 proto kernel scope link src 10.99.99.2 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.0.0/24 dev wg0 scope link 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Comprobación de funcionamiento Ahora, ambas redes privadas están completamente conectadas, lo que nos permite acceder desde cualquiera de las dos a la otra. Vamos a llevar a cabo algunas pruebas desde los clientes para asegurarnos de que la conexión esté funcionando correctamente.\nVoy a hacer un ping desde la red 192.168.0.0 a la 192.168.1.0 con cliente1 :\n# cliente1 --\u0026gt; servidor2 debian@cliente1:~$ ping 192.168.1.1 -c 1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=17.6 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.554/17.554/17.554/0.000 ms # Cliente1 --\u0026gt; Cliente 3 debian@cliente1:~$ ping 192.168.1.2 -c 1 PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data. 64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=12.9 ms debian@cliente1:~$ ping 192.168.1.1 -c 1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=17.8 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.803/17.803/17.803/0.000 ms # Cliente1 --\u0026gt; Windows debian@cliente1:~$ ping 192.168.1.5 -c 1 PING 192.168.1.5 (192.168.1.5) 56(84) bytes of data. 64 bytes from 192.168.1.5: icmp_seq=1 ttl=126 time=19.9 ms --- 192.168.1.5 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 19.906/19.906/19.906/0.000 ms # Cliente1 --\u0026gt; Android debian@cliente1:~$ ping 192.168.1.4 -c 1 PING 192.168.1.4 (192.168.1.4) 56(84) bytes of data. 64 bytes from 192.168.1.4: icmp_seq=1 ttl=62 time=20.8 ms --- 192.168.1.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 20.834/20.834/20.834/0.000 ms Como ves tengo conectividad desde cualquier cliente de la red 192.168.0.0 con la 192.168.1.0 .\nVamos a comprobarlo en la dirección contraria , es decir desde la red 192.168.1.0 hacia la 192.168.0.0 :\n# Cliente3 --\u0026gt; Servidor1 debian@cliente3:~$ ping 192.168.0.1 -c 1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=63 time=16.6 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 16.581/16.581/16.581/0.000 ms # Cliente3 --\u0026gt; Cliente1 debian@cliente3:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=21.0 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 21.031/21.031/21.031/0.000 ms # Cliente3 --\u0026gt; Cliente2 debian@cliente3:~$ ping 192.168.0.3 -c 1 PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data. 64 bytes from 192.168.0.3: icmp_seq=1 ttl=62 time=16.1 ms --- 192.168.0.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 16.115/16.115/16.115/0.000 ms Para cerciorarnos de que el trafico esta pasando por el túnel en los 2 extremos vamos a hacer un traceroute desde las 2 redes :\nDesde la red 192.168.0.0 a la 192.168.1.0 :\ndebian@cliente1:~$ traceroute 192.168.1.2 traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets 1 192.168.0.1 (192.168.0.1) 0.629 ms 0.601 ms 0.595 ms 2 10.99.99.2 (10.99.99.2) 13.677 ms 13.667 ms 13.657 ms 3 192.168.1.2 (192.168.1.2) 13.649 ms 13.636 ms 13.626 ms Desde la red 192.168.1.0 a la 192.168.0.0 :\ndebian@cliente3:~$ traceroute 192.168.0.3 traceroute to 192.168.0.3 (192.168.0.3), 30 hops max, 60 byte packets 1 192.168.1.1 (192.168.1.1) 0.430 ms 0.399 ms 0.393 ms 2 10.99.99.1 (10.99.99.1) 19.343 ms 19.337 ms 19.329 ms 3 192.168.0.3 (192.168.0.3) 19.324 ms 19.320 ms 19.313 ms ","date":"March 28, 2024","hero":"/images/vpn/wireguard_site_to_site.png","permalink":"https://www.javiercd.es/posts/vpn/site_to_site_wireguard/site_to_site_wireguard/","summary":"\u003cp\u003e\u003cimg src=\"/vpn/site_to_site_wireguard/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nVoy a partir del post de VPN acceso remoto con Wireguard , asi que es posible que haga referencia a este durante este articulo .\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"generación-de-claves\"\u003eGeneración de claves\u003c/h2\u003e\n\u003cp\u003eLo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@servidor1:~# sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edebian@servidor2:~$ sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVamos a generar los pares de claves que se utilizarán para cifrar la conexión. Necesitaremos una clave para el servidor y un par de  claves adicionales por cada cliente.\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","WIREGUARD"],"title":"VPN site to site Wireguard"},{"categories":null,"contents":"En este post voy a montar una VPN IPSEC usando routers cisco .\n[!NOTE]\nEn este post se detalla la configuración de los routers R2 y R3 , sin embargo R1 esta explicado en el post de \u0026ldquo;VPN acceso remoto OpenVPN\u0026rdquo; . Si quieres ver la configuración de este ultimo mírate el apartado preparando el escenario .\nConfiguración del escenario Como he cambiado de escenario , hay que configurar los 2 nuevos routers en la red R2 y R3 .\nComenzare por R2 :\nR2(config)#interface FastEthernet0/0 R2(config-if)# ip address 192.168.0.1 255.255.255.0 R2(config-if)#no shut R2(config)#interface FastEthernet1/0 R2(config-if)# ip address 90.0.0.2 255.255.255.0 R2(config-if)# no shutdown R2(config)#ip route 0.0.0.0 0.0.0.0 90.0.0.1 #SNAT R2(config)#$ ip nat pool NAT-Pool 90.0.0.2 90.0.0.2 prefix-length 24 R2(config)#ip nat inside source list 1 pool NAT-Pool overload R2(config)#interface FastEthernet0/0 R2(config-if)#ip nat inside R2(config-if)#interface FastEthernet1/0 R2(config-if)#ip nat outside Lo mismo pero con R3 :\nR3(config)#Interface FastEthernet0/0 R3(config-if)#ip address 192.168.1.1 255.255.255.0 R3(config-if)#no shut R3(config-if)#exit R3(config)#Interface FastEthernet1/0 R3(config-if)#ip address 100.0.0.2 255.255.255.0 R3(config-if)#no shut R3(config-if)#exit R3(config)#ip route 0.0.0.0 0.0.0.0 100.0.0.1 R3(config)#ip nat pool NAT-Pool 100.0.0.2 100.0.0.2 prefix-length 24 R3(config)#ip nat inside source list 1 pool NAT-Pool overload R3(config)#interface FastEthernet0/0 R3(config-if)#ip nat inside R3(config-if)#interface FastEthernet1/0 R3(config-if)#ip nat outside Configuración VPN IPSEC Cisco Una vez tenemos configurado el escenario como en los ejercicios anteriores pero ahora todos los routers del escenario son cisco vamos a proceder con la configuración de la VPN IPSEC . Lo ideal es que compruebes que el escenario esta bien enrutado , para no hacer mas largo este documento voy a omitirlo .\nRouter 2 A continuación te describo paso a paso la configuración que hay que realizar en R2 , haciendo uso de comentarios te indicare que estamos haciendo en cada momento :\n# Entramos en el modo de configuración R2#conf term # Creamos una política ISAKMP , en mi caso con un número de secuencia de 10. R2(config)#crypto isakmp policy 10 # Establecemos el algoritmo de cifrado AES para la política ISAKMP. R2(config-isakmp)# encryption aes # Configuramos el algoritmo de hash SHA para la política ISAKMP. R2(config-isakmp)# hash sha # Configuramos la autenticación precompartida (pre-shared key) para la política ISAKMP. R2(config-isakmp)# authentication pre-share # Establecemos el grupo de difie-hellman con 2048 bits para la política ISAKMP. R2(config-isakmp)# group 14 # Configuramos la clave precompartida para autenticación con el par remoto 100.0.0.2. R2(config-isakmp)#crypto isakmp key TuClavePrecompartida address 100.0.0.2 # Creamos un conjunto de transformación para la fase 2 (IPsec) con cifrado AES y hash SHA. R2(config)#crypto ipsec transform-set myset esp-aes esp-sha-hmac # Creamos una lista de acceso (ACL) para especificar el tráfico a proteger con IPsec. R2(cfg-crypto-trans)# access-list 100 permit ip 192.168.1.0 0.0.0.255 192.168.0.0 0.0.0.255 # Creamos un mapa criptográfico asociado a ISAKMP e IPsec con número de secuencia 10. R2(config)#crypto map mymap 10 ipsec-isakmp # Especificamos la dirección IP del peer remoto. R2(config-crypto-map)# set peer 100.0.0.2 # Asociamos el conjunto de transformación al mapa criptográfico. R2(config-crypto-map)# set transform-set myset # Asociamos la lista de acceso al mapa criptográfico para identificar el tráfico a proteger. R2(config-crypto-map)# match address 100 # Entramos a la interfaz FastEthernet1/0 (PUBLICA) y le asignamos el mapa criptografico para que envie por esta el trafico de la VPN . R2(config-crypto-map)#interface FastEthernet1/0 R2(config-if)# crypto map mymap Router 3 A continuación te describo paso a paso la configuración que hay que realizar en R3 , haciendo uso de comentarios te indicare que estamos haciendo en cada momento :\n# Entramos en el modo de configuración R3#conf term # Creamos una política ISAKMP , en mi caso con un número de secuencia de 10. R3(config)#crypto isakmp policy 10 # Establecemos el algoritmo de cifrado AES para la política ISAKMP. R3(config-isakmp)# encryption aes # Configuramos el algoritmo de hash SHA para la política ISAKMP. R3(config-isakmp)# hash sha # Configuramos la autenticación precompartida (pre-shared key) para la política ISAKMP. R3(config-isakmp)# authentication pre-share # Establecemos el grupo de difie-hellman con 2048 bits para la política ISAKMP. R3(config-isakmp)# group 14 # Configuramos la clave precompartida para autenticación con el par remoto 100.0.0.2. R3(config-isakmp)#crypto isakmp key TuClavePrecompartida address 90.0.0.2 # Creamos un conjunto de transformación para la fase 2 (IPsec) con cifrado AES y hash SHA. R3(config)#crypto ipsec transform-set myset esp-aes esp-sha-hmac # Creamos una lista de acceso (ACL) para especificar el tráfico a proteger con IPsec. R3(cfg-crypto-trans)#access-list 100 permit ip 192.168.1.0 0.0.0.255 192.168.0.0 0.0.0.255 # Creamos un mapa criptográfico asociado a ISAKMP e IPsec con número de secuencia 10. R3(config)#crypto map mymap 10 ipsec-isakmp # Especificamos la dirección IP del peer remoto. R3(config-crypto-map)# set peer 90.0.0.2 # Asociamos el conjunto de transformación al mapa criptográfico. R3(config-crypto-map)# set transform-set myset # Asociamos la lista de acceso al mapa criptográfico para identificar el tráfico a proteger. R3(config-crypto-map)# match address 100 # Entramos a la interfaz FastEthernet1/0 (PUBLICA) y le asignamos el mapa criptografico para que envie por esta el trafico de la VPN . R3(config-crypto-map)#interface FastEthernet1/0 R3(config-if)# crypto map mymap Comprobaciones Una vez aplicada la configuración vamos a ver que en ambos extremos la configuración sea correcta , viendo que los túneles estén levantados :\nR3#show crypto session Crypto session current status Interface: FastEthernet1/0 Session status: UP-ACTIVE Peer: 90.0.0.2 port 500 IKE SA: local 100.0.0.2/500 remote 90.0.0.2/500 Active IPSEC FLOW: permit ip 192.168.1.0/255.255.255.0 192.168.0.0/255.255.255.0 Active SAs: 2, origin: crypto map R2#show crypto session Crypto session current status Interface: FastEthernet1/0 Session status: UP-ACTIVE Peer: 100.0.0.2 port 500 IKE SA: local 90.0.0.2/500 remote 100.0.0.2/500 Active IPSEC FLOW: permit ip 192.168.0.0/255.255.255.0 192.168.1.0/255.255.255.0 Active SAs: 2, origin: crypto map Ya viendo esto podemos cerciorarnos de que la VPN esta levantada pero existen mas comandos que nos brindan diferente información :\n**show crypto isakmp sa : ** Para comprobar las asociaciones ISAKMP **show crypto ipsec sa : ** **Para comprobar las asociaciones IPsec Prueba de conectividad Vamos a comprobar que los distintos clientes de la red 192.168.0.0 pueden comunicarse con los otros de la red 192.168.1.0 :\n# Cliente 1 --\u0026gt; R3 debian@cliente1:~$ ping -c 1 192.168.1.1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=89.2 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 89.167/89.167/89.167/0.000 ms # Cliente1 --\u0026gt; Cliente 3 debian@cliente1:~$ ping -c 1 192.168.1.2 PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data. 64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=46.4 ms --- 192.168.1.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 46.412/46.412/46.412/0.000 ms Vamos a comprobar que los distintos clientes de la red 192.168.1.0 pueden comunicarse con los otros de la red 192.168.0.0 :\n# Cliente 3 --\u0026gt; R2 debian@cliente3:~$ ping -c 1 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=254 time=54.4 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 54.440/54.440/54.440/0.000 ms # Cliente 3 --\u0026gt; Cliente 1 debian@cliente3:~$ ping -c 1 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=33.5 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 33.498/33.498/33.498/0.000 ms ","date":"March 28, 2024","hero":"/images/vpn/ipsec_cisco.png","permalink":"https://www.javiercd.es/posts/vpn/ipsec_cisco/ipsec_cisco/","summary":"\u003cp\u003eEn este post voy a montar una VPN IPSEC usando routers cisco .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/vpn/ipsec_cisco/img/Pastedimage20240128120659.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nEn este post se detalla la configuración de los routers R2 y R3 , sin embargo R1 esta explicado en el post de \u0026ldquo;VPN acceso remoto OpenVPN\u0026rdquo; . Si quieres ver la configuración de este ultimo mírate el apartado preparando el escenario .\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"configuración-del-escenario\"\u003eConfiguración del escenario\u003c/h3\u003e\n\u003cp\u003eComo he cambiado de escenario , hay que configurar los 2 nuevos routers en la red R2 y R3 .\u003c/p\u003e","tags":["VPN","LINUX","CISCO"],"title":"VPN sitio a sitio con IPsec Cisco"},{"categories":null,"contents":"En este post voy a montar una VPN IPSEC usando cortafuegos Fortinet , para ello los visualizaré en GNS3 .\nPreparación del escenario Para crear la VPN añadiré al escenario un nuevo Fortigate .\nAsí que vamos a proceder a configurarlo , lo primero sera conocer la IP que le ha dado el DHCP :\nFortiGate-VM64-KVM login: admin Password: You are forced to change your password. Please input a new password. New Password: Confirm Password: Welcome! FortiGate-VM64-KVM # get system interface physical port1 == [onboard] ==[port1] mode: dhcp ip: 192.168.122.22 255.255.255.0 ipv6: ::/0 status: up speed: 1000Mbps (Duplex: full) FEC: none FEC_cap: none Esta IP que me ha dado por DHCP se la configurare como estática .\nEn cuanto a la red local del nuevo FortiNet , va a tener la red 192.168.30.0 :\nPor ultimo configurare en este la ruta por defecto hacia la dirección IP de de la nube NAT la 192.168.122.1/24 :\nUna vez hecho esto vamos a ver que tenemos conectividad entre ambos cortafuegos , desde FGT \u0026ndash;\u0026gt; FTG2 :\nY al revés desde FTG2 \u0026ndash;\u0026gt; FTG :\nVPN site to site Nos dirigimos primero al FortiGate FTG que es el que contiene los clientes de Odin,Loki,Thor y Hela . Y iremos a IPsec Wizard , le pondré un nombre significativo con el nombre de los hosts :\nEn el siguiente paso vamos a indicar la IP del FortiGate FTG2 , la interfaz por donde saldrá el trafico y por ultimo una \u0026ldquo;llave\u0026rdquo; compartida entre los dos extremos , esta ultima parte puede sustituirse por certificados :\nA continuación indicaremos las redes locales de ambos extremos donde queremos tener conectividad :\nNos saldrá un panel con los distintos objetos que se van a crear y le daremos a crear :\nRepetiremos el mismo proceso en el otro Fortigate , crearemos un túnel site to site :\nLe diremos la IP publica del otro extremo y pondremos la misma clave compartida :\nAhora le diremos cual es nuestra red local y la red remota :\nPor ultimo nos dirá los objetos que se van a crear y le damos a crear :\nAhora si accedemos a los paneles de IPsec Tunnels veremos que en unos segundos ambos túneles se levantaran :\nComprobación de funcionamiento Una vez llegado a este punto veremos que la VPN esta funcionando . Podemos hacer un ping en ambas direcciones :\ndebian@cliente1:~$ ping 192.168.100.4 -c 1 PING 192.168.100.4 (192.168.100.4) 56(84) bytes of data. 64 bytes from 192.168.100.4: icmp_seq=1 ttl=62 time=1.22 ms --- 192.168.100.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.220/1.220/1.220/0.000 ms debian@thor:~$ ping 192.168.30.2 -c 1 PING 192.168.30.2 (192.168.30.2) 56(84) bytes of data. 64 bytes from 192.168.30.2: icmp_seq=1 ttl=62 time=1.52 ms --- 192.168.30.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.516/1.516/1.516/0.000 ms Como vemos tenemos conectividad entre las 2 redes privadas a través de la VPN .\nSi nos paramos a ver los objetos que nos ha creado cada túnel , este nos ha creado un total de 4 , los cuales tendremos que borrar si deseamos eliminar el túnel :\nPor defecto la política que nos ha creado permite TODO el trafico en ambas direcciones , estas 2 políticas la tenemos creada en cada cortafuegos y modificando estas o añadiendo nuevas podemos limitar el trafico que pasa por la VPN en función de nuestras necesidades .\nAdemas nos habrá creado una ruta para encaminar el trafico hacia la red privada del otro extremo :\n","date":"March 28, 2024","hero":"/images/vpn/fortinet_site_to_site.png","permalink":"https://www.javiercd.es/posts/vpn/site_to_site_fortinet/site_to_site_fortinet/","summary":"\u003cp\u003eEn este post voy a montar una VPN IPSEC usando cortafuegos Fortinet  , para ello los visualizaré en GNS3 .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/vpn/site_to_site_fortinet/img/Pastedimage20240330235321.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"preparación-del-escenario\"\u003ePreparación del escenario\u003c/h2\u003e\n\u003cp\u003ePara crear la VPN añadiré al escenario un nuevo Fortigate .\u003c/p\u003e\n\u003cp\u003eAsí que vamos a proceder a configurarlo , lo primero sera conocer la IP que le ha dado el DHCP :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eFortiGate-VM64-KVM login: admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePassword: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eYou are forced to change your password. Please input a new password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNew Password: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eConfirm Password: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWelcome!\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eFortiGate-VM64-KVM \u003cspan style=\"color:#75715e\"\u003e# get system interface physical port1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eonboard\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#f92672\"\u003e==[\u003c/span\u003eport1\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tmode: dhcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tip: 192.168.122.22 255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tipv6: ::/0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tstatus: up\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tspeed: 1000Mbps \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDuplex: full\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tFEC: none\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tFEC_cap: none\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEsta IP que me ha dado por DHCP se la configurare como estática .\u003c/p\u003e","tags":["VPN","LINUX","FORTINET"],"title":"VPN sitio a sitio con IPsec Fortinet"},{"categories":null,"contents":"El objetivo de esta práctica es el desarrollo gradual de un Pipeline que vaya realizando tareas sobre el repositorio de una aplicación.\nLa aplicación con la que vamos a trabajar será tu fork de la aplicación django Polls. Como hemos visto esta aplicación que implementa el tutorial de Django tiene implementado un módulo de pruebas.\nVamos a construir el Pipeline en varias fases:\nEjercicio 1: Construcción de una imagen docker Partimos del pipeline que hemos desarrollado en el Taller 3: Integración continua de aplicación django (Test), donde hemos automatizado el test de la aplicación.\nModifica el pipeline para que después de hacer el test sobre la aplicación, genere una imagen docker. tienes que tener en cuenta que los pasos para generar la imagen lo tienes que realizar en la máquina donde está instalado Jenkins. Tendrás que añadir las siguientes acciones:\nConstruir la imagen con el Dockerfile que tengas en el repositorio. Subir la imagen a tu cuenta de Docker Hub. Borrar la imagen que se ha creado. Por lo tanto tienes que estudiar el apartado Ejecución de un pipeline en varios runner para ejecutar el pipeline en dos runner:\nEn el contenedor docker a partir de la imagen python:3 los pasos del taller 3. En la máquina de Jenkins los pasos de este ejercicio. Otras consideraciones:\nCuando termine de ejecutar el pipeline te mandará un correo de notificación. El pipeline se guardará en un fichero Jenkinsfile en tu repositorio, y la configuración del pipeline hará referencia a él. Entrega Una captura de pantalla donde se vea la salida de un build que se ha ejecutado de manera correcta. Una captura de pantalla de tu cuenta de Docker Hub donde se vea la imagen subida de último build. Introduce un fallo en el Dockerfile y muestra la salida del build donde se produce el error. Entrega la URL del repositorio para ver el Jenkinsfile. https://github.com/javierasping/django_tutorial_docker.git Pantallazo con el correo que has recibido de la ejecución del pipeline. Ejercicio 2: Despliegue de la aplicación Amplía el pipeline anterior para que tenga una última etapa donde se haga el despliegue de la imagen que se ha subido a Docker Hub en tu entorno de producción (VPS). Algunas pistas:\nBusca información de cómo hacer el despliegue a un servidor remoto (ssh, buscando algún plugin con esa funcionalidad,…) Si vas a hacer conexiones por ssh, tendrás que guardar una credencial en tu Jenkins con el nombre de usuario y contraseña. Para el despliegue deberá usar el fichero docker-compose.yaml que has generado en otras prácticas. Se deberá borrar el contenedor con la versión anterior, descargar la nueva imagen y crear un nuevo contenedor. Otras consideraciones:\nCambia el disparador del pipeline. Configúralo con un webhook de github, para que cada vez que se produce un push se ejecute el pipeline. Para que el webhook pueda acceder a tu Jenkins puedes usar ngrok. Entrega El contenido del fichero Jenkinsfile. Las credenciales que has guardado en Jenkins. Demuestra al profesor como se realiza la IC/DC completo. Ejecución normal del pipeline :\nLa configuración de nginx y los contenedores ejecutandose\njaviercruces@atlas:~$ sudo cat /etc/nginx/sites-available/django_docker server { listen 80; server_name djangodocker.javiercd.es; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name djangodocker.javiercd.es; ssl_certificate /etc/letsencrypt/live/javiercd.es/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/javiercd.es/privkey.pem; location / { proxy_pass http://localhost:8082; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } javiercruces@atlas:~$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4d7947fc359f javierasping/django_tutorial_ic \u0026#34;/bin/sh -c \u0026#39;python3…\u0026#34; 33 minutes ago Up 33 minutes 0.0.0.0:8082-\u0026gt;3000/tcp, :::8082-\u0026gt;3000/tcp django_tutorial_web bdf947a4bccc mariadb \u0026#34;docker-entrypoint.s…\u0026#34; 33 minutes ago Up 33 minutes 3306/tcp mariadb-django La aplicación funcionando en el VPS :\nLa configuración de Ngrok y el Webhook\ncurl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc \\ | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc \u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;deb https://ngrok-agent.s3.amazonaws.com buster main\u0026#34; \\ | sudo tee /etc/apt/sources.list.d/ngrok.list \u0026amp;\u0026amp; sudo apt update \u0026amp;\u0026amp; sudo apt install ngrok javiercruces@atlas:~$ ngrok config add-authtoken 2d2CfE debian@jenkins:~$ ngrok http http://localhost:8082 Si provocamos el fallo :\n","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/practica.png","permalink":"https://www.javiercd.es/posts/ci_cd/practica_jenkins/practica_jenkins/","summary":"\u003cp\u003eEl objetivo de esta práctica es el desarrollo gradual de un Pipeline que vaya realizando tareas sobre el repositorio de una aplicación.\u003c/p\u003e\n\u003cp\u003eLa aplicación con la que vamos a trabajar será tu fork de la aplicación django Polls. Como hemos visto esta aplicación que implementa el tutorial de Django tiene implementado un módulo de pruebas.\u003c/p\u003e\n\u003cp\u003eVamos a construir el Pipeline en varias fases:\u003c/p\u003e\n\u003ch2 id=\"ejercicio-1-construcción-de-una-imagen-docker\"\u003e\u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/practica.html#ejercicio-1-construcci%C3%B3n-de-una-imagen-docker\" target=\"_blank\" rel=\"noopener\"\u003eEjercicio 1: Construcción de una imagen docker\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ePartimos del pipeline que hemos desarrollado en el \u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/taller3.html\" target=\"_blank\" rel=\"noopener\"\u003eTaller 3: Integración continua de aplicación django (Test)\u003c/a\u003e, donde hemos automatizado el test de la aplicación.\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Práctica CI/CD con Jenkins"},{"categories":null,"contents":"Taller 1: Almacenamiento y redes en Docker Almacenamiento Vamos a trabajar con volúmenes docker:\nCrea un volumen docker que se llame miweb. javiercruces@docker:~$ docker volume create miweb miweb Crea un contenedor desde la imagen php:7.4-apache donde montes en el directorio /var/www/html (que sabemos que es el DocumentRoot del servidor que nos ofrece esa imagen) el volumen docker que has creado. javiercruces@docker:~$ docker run -d --name my-apache-app -v miweb:/var/www/html -p 8080:80 php:7.4-apache Utiliza el comando docker cp para copiar un fichero index.html (donde aparece tu nombre) en el directorio /var/www/html. javiercruces@docker:~$ echo \u0026#34;\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\u0026#34; \u0026gt; index.html javiercruces@docker:~$ docker cp index.html my-apache-app:/var/www/html/ Successfully copied 2.05kB to my-apache-app:/var/www/html/ Accede al contenedor desde el navegador para ver la información ofrecida por el fichero index.html. javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt; Borra el contenedor javiercruces@docker:~$ docker rm -f my-apache-app my-apache-app Crea un nuevo contenedor y monta el mismo volumen como en el ejercicio anterior. javiercruces@docker:~$ docker run -d --name Taller1 -v miweb:/var/www/html -p 8080:80 php:7.4-apache 9edd4b2dd2499f923090ce6a246e44db136f162528a51f84ddb33659503bafd7 Accede al contenedor desde el navegador para ver la información ofrecida por el fichero index.html. ¿Seguía existiendo ese fichero? javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt; Vamos a trabajar con bind mount:\nCrea un directorio en tu host y dentro crea un fichero index.html (donde aparece tu nombre). javiercruces@docker:~$ mkdir taller1 javiercruces@docker:~$ cp index.html taller1/ Crea un contenedor desde la imagen php:7.4-apache donde montes en el directorio /var/www/html el directorio que has creado por medio de bind mount. javiercruces@docker:~$ docker run -d --name Taller1 -v /home/javiercruces/taller1/:/var/www/html -p 8080:80 php:7.4-apache Accede al contenedor desde el navegador para ver la información ofrecida por el fichero index.html. javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt; Modifica el contenido del fichero index.html en tu host y comprueba que al refrescar la página ofrecida por el contenedor, el contenido ha cambiado. javiercruces@docker:~$ echo \u0026#34;\u0026lt;h1\u0026gt;Javier Cruces Doval\u0026lt;/h1\u0026gt;\u0026#34; \u0026gt; taller1/index.html javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces Doval\u0026lt;/h1\u0026gt; Borra el contenedor javiercruces@docker:~$ docker rm -f Taller1 Taller1 Crea un nuevo contenedor y monta el mismo directorio como en el ejercicio anterior. javiercruces@docker:~$ docker run -d --name Taller1 -v /home/javiercruces/taller1/:/var/www/html -p 8080:80 php:7.4-apache Accede al contenedor desde el navegador para ver la información ofrecida por el fichero index.html. ¿Se sigue viendo el mismo contenido? javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces Doval\u0026lt;/h1\u0026gt; Redes Despliegue de Nextcloud + mariadb Vamos a desplegar la aplicación Nextcloud con una base de datos (NOTA: Para que no te de errores utiliza la imagen mariadb:10.5). Te puede servir el ejercicio que hemos realizado para desplegar Wordpress. Para ello sigue los siguientes pasos:\nCrea una red de tipo bridge. javiercruces@docker:~$ docker network create taller1 a1f8faf5a100ad01013bc147e7c2a9577a5a4376d7e33c7d961c5aaca93000b0 Crea el contenedor de la base de datos conectado a la red que has creado. La base de datos se debe configurar para crear una base de datos y un usuario. Además el contenedor debe utilizar almacenamiento (volúmenes o bind mount) para guardar la información. Puedes seguir la documentación de mariadb o la de PostgreSQL. javiercruces@docker:~$ docker run -d --name wp_db \\ --network taller1 \\ -v db_vol:/var/lib/mysql \\ -e MYSQL_ROOT_PASSWORD=wordpress \\ -e MYSQL_DATABASE=wordpress \\ -e MYSQL_USER=wordpress \\ -e MYSQL_PASSWORD=wordpress \\ mariadb:10.5 A continuación, siguiendo la documentación de la imagen Nextcloud, crea un contenedor conectado a la misma red, e indica las variables adecuadas para que se configure de forma adecuada y realice la conexión a la base de datos. El contenedor también debe ser persistente usando almacenamiento. javiercruces@docker:~$ docker run -d --name nextcloud \\ --network taller1 \\ -e MYSQL_DATABASE=wordpress \\ -e MYSQL_USER=wordpress \\ -e MYSQL_PASSWORD=wordpress \\ -e MYSQL_HOST=wp_db \\ -p 8080:80 \\ nextcloud:latest Accede a la aplicación usando un navegador web. ","date":"March 14, 2024","hero":"/images/docker/taller1.png","permalink":"https://www.javiercd.es/posts/docker/taller1/taller1_docker/","summary":"\u003ch2 id=\"taller-1-almacenamiento-y-redes-en-docker\"\u003eTaller 1: Almacenamiento y redes en Docker\u003c/h2\u003e\n\u003ch3 id=\"almacenamiento\"\u003eAlmacenamiento\u003c/h3\u003e\n\u003cp\u003eVamos a trabajar con volúmenes docker:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCrea un volumen docker que se llame \u003ccode\u003emiweb\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker volume create miweb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emiweb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eCrea un contenedor desde la imagen \u003ccode\u003ephp:7.4-apache\u003c/code\u003e donde montes en el directorio \u003ccode\u003e/var/www/html\u003c/code\u003e (que sabemos que es el \u003cem\u003eDocumentRoot\u003c/em\u003e del servidor que nos ofrece esa imagen) el volumen docker que has creado.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker run -d --name my-apache-app -v miweb:/var/www/html -p 8080:80 php:7.4-apache\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eUtiliza el comando \u003ccode\u003edocker cp\u003c/code\u003e para copiar un fichero \u003ccode\u003eindex.html\u003c/code\u003e (donde aparece tu nombre) en el directorio \u003ccode\u003e/var/www/html\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\u0026#34;\u003c/span\u003e \u0026gt; index.html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker cp index.html my-apache-app:/var/www/html/\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSuccessfully copied 2.05kB to my-apache-app:/var/www/html/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"4\"\u003e\n\u003cli\u003eAccede al contenedor desde el navegador para ver la información ofrecida por el fichero \u003ccode\u003eindex.html\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ curl http://localhost:8080\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"5\"\u003e\n\u003cli\u003eBorra el contenedor\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker rm -f my-apache-app\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emy-apache-app\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"6\"\u003e\n\u003cli\u003eCrea un nuevo contenedor y monta el mismo volumen como en el ejercicio anterior.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker run -d --name Taller1 -v miweb:/var/www/html -p 8080:80 php:7.4-apache\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e9edd4b2dd2499f923090ce6a246e44db136f162528a51f84ddb33659503bafd7\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"7\"\u003e\n\u003cli\u003eAccede al contenedor desde el navegador para ver la información ofrecida por el fichero \u003ccode\u003eindex.html\u003c/code\u003e. ¿Seguía existiendo ese fichero?\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ curl http://localhost:8080\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVamos a trabajar con bind mount:\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Taller 1: Almacenamiento y redes en Docker"},{"categories":null,"contents":"Taller 1: Corrector ortográfico de documentos markdown (test) ¿Qué tienes que entregar? La URL del tu repositorio GitHub. https://github.com/javierasping/taller1_jenkins_ic-diccionario El contenido de la tu fichero Jenkinfile. pipeline { agent { docker { image \u0026#39;debian\u0026#39; args \u0026#39;-u root:root\u0026#39; } } stages { stage(\u0026#39;Clone\u0026#39;) { steps { git branch:\u0026#39;master\u0026#39;, url:\u0026#39;https://github.com/javierasping/taller1_jenkins_ic-diccionario.git\u0026#39; } } stage(\u0026#39;Install\u0026#39;) { steps { sh \u0026#39;apt-get update \u0026amp;\u0026amp; apt-get install -y aspell-es \u0026#39; } } stage(\u0026#39;Test\u0026#39;) { steps { sh \u0026#39;\u0026#39;\u0026#39; export LC_ALL=C.UTF-8 OUTPUT=`cat doc/*.md | aspell list -d es -p ./.aspell.es.pws` if [ -n \u0026#34;$OUTPUT\u0026#34; ]; then echo $OUTPUT exit 1 fi \u0026#39;\u0026#39;\u0026#39; } } } post { always { mail to: \u0026#39;javierasping@gmail.com\u0026#39;, subject: \u0026#34;Status of pipeline: ${currentBuild.fullDisplayName}\u0026#34;, body: \u0026#34;${env.BUILD_URL} has result ${currentBuild.result}\u0026#34; } } } Una captura de pantalla donde se vea la configuración del disparador del pipeline. Una captura de un correo electrónico recibido sin ningún error, y otro con algún error en al ejecución del pipeline. ","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/taller1.png","permalink":"https://www.javiercd.es/posts/ci_cd/taller1_jenkins/taller1/","summary":"\u003ch1 id=\"taller-1-corrector-ortográfico-de-documentos-markdown-test\"\u003eTaller 1: Corrector ortográfico de documentos markdown (test)\u003c/h1\u003e\n\u003ch2 id=\"qué-tienes-que-entregar\"\u003e\u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/taller1.html#qu%C3%A9-tienes-que-entregar\" target=\"_blank\" rel=\"noopener\"\u003e¿Qué tienes que entregar?\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eLa URL del tu repositorio GitHub.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehttps://github.com/javierasping/taller1_jenkins_ic-diccionario\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eEl contenido de la tu fichero \u003ccode\u003eJenkinfile\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epipeline \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    agent \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        docker \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            image \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;debian\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            args \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-u root:root\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    stages \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        stage\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Clone\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            steps \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                git branch:\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;master\u0026#39;\u003c/span\u003e, url:\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://github.com/javierasping/taller1_jenkins_ic-diccionario.git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        stage\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Install\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            steps \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                sh \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;apt-get update \u0026amp;\u0026amp; apt-get install -y aspell-es \u0026#39;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        stage\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Test\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            steps \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                sh \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                export LC_ALL=C.UTF-8\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                OUTPUT=`cat doc/*.md | aspell list -d es -p ./.aspell.es.pws`\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                if [ -n \u0026#34;$OUTPUT\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                    echo $OUTPUT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                    exit 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                fi\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                \u0026#39;\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    post \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        always \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            mail to: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;javierasping@gmail.com\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            subject: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Status of pipeline: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003ecurrentBuild.fullDisplayName\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            body: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eenv.BUILD_URL\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e has result \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003ecurrentBuild.result\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eUna captura de pantalla donde se vea la configuración del disparador del pipeline.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/ci_cd/taller1_jenkins/img/Pasted_image_20240229084423.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Taller 1: Corrector ortográfico de documentos markdown (test)"},{"categories":null,"contents":"En este ejercicio queremos desplegar una página HTML5 en el servicio surge.sh, además queremos comprobar si el código HTML5 es válido. Estas dos operaciones: comprobar si el HTML5 es válido (test) y el despliegue en surge.sh (deploy) lo vamos a hacer con Jenkins de forma automática (IC y DC). Recuerda que el repositorio es https://github.com/josedom24/ic-html5.\nComo vimos en el ejemplo 2, para hacer el despliegue necesitamos guardar el token que hemos obtenido de surge para que nos autentifiquemos. veamos como trabajar con credenciales en Jenkins.\nCrear credenciales Podemos crear varios tipos de credenciales: usuario y contraseña, credenciales ssh,… Nosotros vamos a crear un Secret text para guardar el token de surge.\ndebian@jenkins:~$ sudo apt install npm debian@jenkins:~$ sudo npm install -g surge debian@jenkins:~$ surge token Login (or create surge account) by entering email \u0026amp; password. email: javierasping@gmail.com password: pipeline { environment { TOKEN = credentials(\u0026#39;SURGE_TOKEN\u0026#39;) } agent { docker { image \u0026#39;josedom24/debian-npm\u0026#39; args \u0026#39;-u root:root\u0026#39; } } stages { stage(\u0026#39;Clone\u0026#39;) { steps { git branch:\u0026#39;master\u0026#39;,url:\u0026#39;https://github.com/javierasping/taller2_ic-html5.git\u0026#39; } } stage(\u0026#39;Install surge\u0026#39;) { steps { sh \u0026#39;npm install -g surge\u0026#39; } } stage(\u0026#39;Deploy\u0026#39;) { steps{ sh \u0026#39;surge ./_build/ josedom24.surge.sh --token $TOKEN\u0026#39; } } } } Instalamos y configuraramos Ngrok con nuestro token\ndebian@jenkins:~$ curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc \\ | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc \u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;deb https://ngrok-agent.s3.amazonaws.com buster main\u0026#34; \\ | sudo tee /etc/apt/sources.list.d/ngrok.list \u0026amp;\u0026amp; sudo apt update \u0026amp;\u0026amp; sudo apt install ngrok debian@jenkins:~$ ngrok config add-authtoken 2d2CfEVHT Authtoken saved to configuration file: /home/debian/.config/ngrok/ngrok.yml Indicamos en jenkins que vamos a utilizar un WebHook :\nLanzo un ejemplo de HTML correcto y otro con errores :\nComprobamos que los cambios en el repositorio son recibidos en el WebHook :\nEn GitHub comprobamos que le esta mandando la petición al WebHook :\n","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/taller2.png","permalink":"https://www.javiercd.es/posts/ci_cd/taller2_jenkins/taller2/","summary":"\u003cp\u003eEn este ejercicio queremos desplegar una página HTML5 en el servicio \u003cem\u003esurge.sh\u003c/em\u003e, además queremos comprobar si el código HTML5 es válido. Estas dos operaciones: comprobar si el HTML5 es válido (test) y el despliegue en surge.sh (deploy) lo vamos a hacer con Jenkins de forma automática (IC y DC). Recuerda que el repositorio es \u003ca href=\"https://github.com/josedom24/ic-html5\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/josedom24/ic-html5\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eComo vimos en el ejemplo 2, para hacer el despliegue necesitamos guardar el token que hemos obtenido de surge para que nos autentifiquemos. veamos como trabajar con credenciales en Jenkins.\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Taller 2 Comprobación de HTML5 válido y despliegue en surge.sh (test y deploy)"},{"categories":null,"contents":"Taller 2: Escenarios multicontenedor en Docker Despliegue de Nextcloud Vamos a desplegar la aplicación nextcloud con una base de datos (puedes elegir mariadb o PostgreSQL) utilizando la aplicación docker-compose. Puedes coger cómo modelo el fichero docker-compose.yml el que hemos estudiado para desplegar WordPress.\nInstala docker-compose en tu ordenador. Dentro de un directorio crea un fichero docker-compose.yml para realizar el despliegue de nextcloud con una base de datos. Recuerda las variables de entorno y la persistencia de información. javiercruces@docker:~/taller2$ cat docker-compose.yaml version: \u0026#39;2\u0026#39; volumes: nextcloud: db: services: db: image: mariadb:10.6 restart: always command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW volumes: - db:/var/lib/mysql environment: - MYSQL_ROOT_PASSWORD=root - MYSQL_PASSWORD=javiercruces - MYSQL_DATABASE=nextcloud - MYSQL_USER=nextcloud app: image: nextcloud restart: always ports: - 8081:80 links: - db volumes: - nextcloud:/var/www/html environment: - MYSQL_PASSWORD=javiercruces - MYSQL_DATABASE=nextcloud - MYSQL_USER=nextcloud - MYSQL_HOST=db Levanta el escenario con docker-compose. javiercruces@docker:~/taller2$ docker compose up -d [+] Running 2/2 ✔ Container taller2-db-1 Started 0.0s ✔ Container taller2-app-1 Started 0.0s Muestra los contenedores con docker-compose. javiercruces@docker:~/taller2$ docker compose ps NAME IMAGE COMMAND SERVICE CREATED STATUS PORTS taller2-app-1 nextcloud \u0026#34;/entrypoint.sh apache2-foreground\u0026#34; app 7 minutes ago Up 5 minutes 0.0.0.0:8081-\u0026gt;80/tcp, :::8081-\u0026gt;80/tcp taller2-db-1 mariadb:10.6 \u0026#34;docker-entrypoint.sh --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW\u0026#34; db 7 minutes ago Up 5 minutes 3306/tcp Accede a la aplicación y comprueba que funciona. Comprueba el almacenamiento que has definido y que se ha creado una nueva red de tipo bridge. javiercruces@docker:~/taller2$ docker network ls NETWORK ID NAME DRIVER SCOPE 5dd43eadf03b bridge bridge local 40fad2a3552b host host local 9f5f2450d012 none null local a1f8faf5a100 taller1 bridge local fcf9b3b0fed4 taller2_default bridge local javiercruces@docker:~/taller2$ docker volume ls DRIVER VOLUME NAME local 0dd5f1f824800210c4ce522371cb31ef1075c779566ed986b8718a88eb4b50a9 local 5d742d485cd427d22f688488a3d28f562e6e8037ecf2e56f7fb81dc6db71e26b local 9eeb57dc83abfd57998498152b2a03527b8743ccf1eee5cba2e7ef891030e496 local 87622e5677a467c635c75f868ae123679269507fbe7f6a47b0804999a0845f01 local d9cb1b25e8892ef2f8b51b1352a00d44451616eb0f52db43cb8d42d391b9ab1b local db_vol local miweb local taller2_db local taller2_nextcloud Borra el escenario con docker-compose. javiercruces@docker:~/taller2$ docker compose rm -sf [+] Stopping 2/2 ✔ Container taller2-app-1 Stopped 3.6s ✔ Container taller2-db-1 Stopped 6.1s Going to remove taller2-app-1, taller2-db-1 [+] Removing 2/0 ✔ Container taller2-db-1 Removed 0.1s ✔ Container taller2-app-1 Removed ","date":"March 14, 2024","hero":"/images/docker/taller2.png","permalink":"https://www.javiercd.es/posts/docker/taller2/taller2_docker/","summary":"\u003ch2 id=\"taller-2-escenarios-multicontenedor-en-docker\"\u003eTaller 2: Escenarios multicontenedor en Docker\u003c/h2\u003e\n\u003ch3 id=\"despliegue-de-nextcloud\"\u003eDespliegue de Nextcloud\u003c/h3\u003e\n\u003cp\u003eVamos a desplegar la aplicación nextcloud con una base de datos (puedes elegir mariadb o PostgreSQL) utilizando la aplicación docker-compose. Puedes coger cómo modelo el fichero \u003ccode\u003edocker-compose.yml\u003c/code\u003e el que hemos estudiado para desplegar WordPress.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eInstala docker-compose en tu ordenador.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eDentro de un directorio crea un fichero \u003ccode\u003edocker-compose.yml\u003c/code\u003e para realizar el despliegue de nextcloud con una base de datos. Recuerda las variables de entorno y la persistencia de información.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~/taller2$ cat docker-compose.yaml \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eversion: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evolumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  nextcloud:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  db:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  db:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    image: mariadb:10.6\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    restart: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    command: --transaction-isolation\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eREAD-COMMITTED --log-bin\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebinlog --binlog-format\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eROW\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - db:/var/lib/mysql\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_ROOT_PASSWORD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eroot\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_PASSWORD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejaviercruces\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_DATABASE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_USER\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  app:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    image: nextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    restart: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - 8081:80\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    links:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - db\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - nextcloud:/var/www/html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_PASSWORD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejaviercruces\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_DATABASE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_USER\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_HOST\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eLevanta el escenario con \u003ccode\u003edocker-compose\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~/taller2$ docker compose up -d \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Running 2/2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e ✔ Container taller2-db-1   Started                                                                0.0s \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e ✔ Container taller2-app-1  Started                                                                0.0s\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"4\"\u003e\n\u003cli\u003eMuestra los contenedores con \u003ccode\u003edocker-compose\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~/taller2$ docker compose ps\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNAME            IMAGE          COMMAND                                                                                              SERVICE   CREATED         STATUS         PORTS\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etaller2-app-1   nextcloud      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/entrypoint.sh apache2-foreground\u0026#34;\u003c/span\u003e                                                                  app       \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e minutes ago   Up \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e minutes   0.0.0.0:8081-\u0026gt;80/tcp, :::8081-\u0026gt;80/tcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etaller2-db-1    mariadb:10.6   \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;docker-entrypoint.sh --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW\u0026#34;\u003c/span\u003e   db        \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e minutes ago   Up \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e minutes   3306/tcp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"5\"\u003e\n\u003cli\u003eAccede a la aplicación y comprueba que funciona.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/docker/taller2/img/Pasted_image_20240202091554.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Taller 2: Escenarios multicontenedor en Docker"},{"categories":null,"contents":"Taller 3: Creación de imágenes Docker Creación de una imagen a partir de un Dockerfile\n1.Crea una página web estática (por ejemplo busca una plantilla HTML5). O simplemente crea un index.html.\n2.Crea un fichero Dockerfile que permita crear una imagen con un servidor web sirviendo la página. Puedes usar una imagen base debian o ubuntu, o una imagen que tenga ya un servicio web, como hemos visto en el apartado Ejemplo 1: Construcción de imágenes con una página estática.\njaviercruces@docker:~/taller3$ cat Dockerfile # syntax=docker/dockerfile:1 FROM httpd:2.4 COPY ./public_html/ /usr/local/apache2/htdocs/ EXPOSE 80 3.Ejecuta el comando docker que crea la nueva imagen. La imagen se debe llamar /mi_servidor_web:v1.\njaviercruces@docker:~/taller3$ docker build -t javiersaping/mi_servidor_web:v1 . Sending build context to Docker daemon 3.584kB Step 1/3 : FROM httpd:2.4 ---\u0026gt; 92fa43a2ff60 Step 2/3 : COPY ./public_html/ /usr/local/apache2/htdocs/ ---\u0026gt; b03556dd59b6 Step 3/3 : EXPOSE 80 ---\u0026gt; Running in 1cc04e1deee4 Removing intermediate container 1cc04e1deee4 ---\u0026gt; 3078183767ef Successfully built 3078183767ef Successfully tagged javiersaping/mi_servidor_web:v1 javiercruces@docker:~/taller3$ docker run -d -p 8081:80 javiersaping/mi_servidor_web:v1 2a753adcd098c49b7b215b7c97267a09e09194303bee131150765222a4295dea 4.Conéctate a Docker Hub y sube la imagen que acabas de crear.\njaviercruces@docker:~/taller3$ docker login javiercruces@docker:~/taller3$ docker push javiersaping/mi_servidor_web:v1 The push refers to repository [docker.io/javiersaping/mi_servidor_web] c2a1a8df6153: Pushed daede99f9966: Mounted from library/httpd a7eff924c5ac: Mounted from library/httpd 24282ddb8cca: Mounted from library/httpd 5f70bf18a086: Mounted from library/httpd 8ba5f6d45106: Mounted from library/httpd 571ade696b26: Mounted from library/nextcloud v1: digest: sha256:85a8e341e3fd89b313a263a45c91ad846d673f198301e482c4f07352aef8bd42 size: 1779 5.Descarga la imagen en otro ordenador donde tengas docker instalado, y crea un contenedor a partir de ella. (Si no tienes otro ordenador con docker instalado, borra la imagen en tu ordenador y bájala de Docker Hub).\njaviercruces@docker:~/taller3$ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE javiersaping/mi_servidor_web v1 3078183767ef 7 minutes ago 167MB nextcloud latest 142b11cc42d8 3 weeks ago 1.21GB wordpress latest fe93c4b645b9 8 weeks ago 739MB mariadb latest 2b54778e06a3 2 months ago 404MB mariadb 10.6 10fbb70b8165 2 months ago 396MB mariadb 10.5 72610f6b03ac 2 months ago 393MB httpd 2.4 92fa43a2ff60 3 months ago 167MB php 7.4-apache 20a3732f422b 14 months ago 453MB javiercruces@docker:~/taller3$ docker image rm 3078183767ef Untagged: javiersaping/mi_servidor_web:v1 Untagged: javiersaping/mi_servidor_web@sha256:85a8e341e3fd89b313a263a45c91ad846d673f198301e482c4f07352aef8bd42 Deleted: sha256:3078183767efd71fffccce7fb4e6806afa46a4cff42c37ad505d376e0b842108 Deleted: sha256:b03556dd59b6f2ab935450b4d5eb09dedfc4ee86f4c11a9140d8e17f89d89a73 Deleted: sha256:5f245addf2a19a8f2d9314dc1283ab53d0f85ae6a6a73aa5d264f070f0d71e01 javiercruces@docker:~/taller3$ docker pull javiersaping/mi_servidor_web:v1 v1: Pulling from javiersaping/mi_servidor_web 2f44b7a888fa: Already exists 5abb3599da34: Already exists 4f4fb700ef54: Already exists fa608a886227: Already exists afe6bbf00437: Already exists fd0ef2a49677: Already exists 6d9a1035e41b: Pull complete Digest: sha256:85a8e341e3fd89b313a263a45c91ad846d673f198301e482c4f07352aef8bd42 Status: Downloaded newer image for javiersaping/mi_servidor_web:v1 docker.io/javiersaping/mi_servidor_web:v1 6.Vamos a hacer una modificación de la página web: haz una modificación al fichero index.html.\njaviercruces@docker:~/taller3/public_html$ echo \u0026#34;\u0026lt;h1\u0026gt;Taller3 FJCD V2\u0026lt;/h1\u0026gt;\u0026#34; \u0026gt; index.html 7.Vuelve a crear una nueva imagen, en esta caso pon ta etiqueta v2. Súbela a Docker Hub.\njaviercruces@docker:~/taller3$ docker build -t javiersaping/mi_servidor_web:v2 . Sending build context to Docker daemon 3.584kB Step 1/3 : FROM httpd:2.4 ---\u0026gt; 92fa43a2ff60 Step 2/3 : COPY ./public_html/ /usr/local/apache2/htdocs/ ---\u0026gt; 94e5c065b88a Step 3/3 : EXPOSE 80 ---\u0026gt; Running in 5849a7ba6b3b Removing intermediate container 5849a7ba6b3b ---\u0026gt; 2e68e7708285 Successfully built 2e68e7708285 Successfully tagged javiersaping/mi_servidor_web:v2 javiercruces@docker:~/taller3$ docker push javiersaping/mi_servidor_web:v2 The push refers to repository [docker.io/javiersaping/mi_servidor_web] 1f5b52d08ce0: Pushed daede99f9966: Layer already exists a7eff924c5ac: Layer already exists 24282ddb8cca: Layer already exists 5f70bf18a086: Layer already exists 8ba5f6d45106: Layer already exists 571ade696b26: Layer already exists v2: digest: sha256:a2af8396c3dfaa8d0312868161bff238c17b742cd46d57296ed304a9495b2a7a size: 1779 8.Por último, baja la nueva imagen en el ordenador donde está corriendo el contenedor. Para hacer la implantación de la nueva versión debes borrar el contenedor y crear uno nuevo desde la nueva versión de la imagen.\njaviercruces@docker:~/taller3$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2a753adcd098 javiersaping/mi_servidor_web:v1 \u0026#34;httpd-foreground\u0026#34; 3 minutes ago Up 3 minutes 0.0.0.0:8081-\u0026gt;80/tcp, :::8081-\u0026gt;80/tcp nervous_lewin 5a362b768a25 nextcloud:latest \u0026#34;/entrypoint.sh apac…\u0026#34; 2 weeks ago Up 2 weeks 0.0.0.0:8080-\u0026gt;80/tcp, :::8080-\u0026gt;80/tcp nextcloud dcc9f10a6cad mariadb:10.5 \u0026#34;docker-entrypoint.s…\u0026#34; 2 weeks ago Up 2 weeks 3306/tcp wp_db javiercruces@docker:~/taller3$ docker rm -f 2a753adcd098 2a753adcd098 javiercruces@docker:~/taller3$ docker run -d -p 8081:80 javiersaping/mi_servidor_web:v2 e632b46bb8cf8aac8019effdf5ac69cc20d8b9e76b17342638bc4858c63aef32 ","date":"March 14, 2024","hero":"/images/docker/taller3.png","permalink":"https://www.javiercd.es/posts/docker/taller3/taller3_docker/","summary":"\u003ch2 id=\"taller-3-creación-de-imágenes-docker\"\u003eTaller 3: Creación de imágenes Docker\u003c/h2\u003e\n\u003cp\u003eCreación de una imagen a partir de un Dockerfile\u003c/p\u003e\n\u003cp\u003e1.Crea una página web estática (por ejemplo busca una plantilla HTML5). O simplemente crea un index.html.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2.Crea un fichero Dockerfile que permita crear una imagen con un servidor web sirviendo la página. Puedes usar una imagen base debian o ubuntu, o una imagen que tenga ya un servicio web, como hemos visto en el apartado Ejemplo 1: Construcción de imágenes con una página estática.\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Taller 3: Creación de imágenes Docker"},{"categories":null,"contents":"Vamos a trabajar con el repositorio de la aplicación django_tutorial. Esta aplicación tiene definidas una serie de test, que podemos estudiar en el fichero tests.py del directorio polls.\nCada test viene definido por una función. En el fichero puedes leer los comentarios para saber que es lo que prueba cada test, o puedes ver el documento Tests en la aplicación tutorial Django.\nPara ejecutar los test ejecutamos:\npython3 manage.py test En ese momento se crea una base de datos temporal, donde se van a ir realizando las pruebas que están definidas:\npython3 manage.py test Creating test database for alias \u0026#39;default\u0026#39;... System check identified no issues (0 silenced). .......... ---------------------------------------------------------------------- Ran 10 tests in 0.024s OK Destroying test database for alias \u0026#39;default\u0026#39;... Por ejemplo, hay dos tests definidos en la función test_no_questions y en la función test_future_question que comprueban que si no hay preguntas en la base de datos debe aparecer el mensaje “No polls are available”. Si un programador modifica la aplicación y en el fichero polls/templates/polls/index.html y cambia el mensaje:\n... \u0026lt;p\u0026gt;No hay encuestas disponibles.\u0026lt;/p\u0026gt; ... Al pasar los test, tendremos dos errores en los dos tests:\npython3 manage.py test Creating test database for alias \u0026#39;default\u0026#39;... System check identified no issues (0 silenced). ..F.F..... ====================================================================== FAIL: test_future_question (polls.tests.QuestionIndexViewTests) Questions with a pub_date in the future aren\u0026#39;t displayed on ---------------------------------------------------------------------- Traceback (most recent call last): File \u0026#34;/home/jose/github/django_tutorial/polls/tests.py\u0026#34;, line 143, in test_future_question self.assertContains(response, \u0026#34;No polls are available.\u0026#34;) File \u0026#34;/home/jose/virtualenv/django_tutorial/lib/python3.9/site-packages/django/test/testcases.py\u0026#34;, line 471, in assertContains self.assertTrue(real_count != 0, msg_prefix + \u0026#34;Couldn\u0026#39;t find %s in response\u0026#34; % text_repr) AssertionError: False is not true : Couldn\u0026#39;t find \u0026#39;No polls are available.\u0026#39; in response ====================================================================== FAIL: test_no_questions (polls.tests.QuestionIndexViewTests) If no questions exist, an appropriate message is displayed. ---------------------------------------------------------------------- Traceback (most recent call last): File \u0026#34;/home/jose/github/django_tutorial/polls/tests.py\u0026#34;, line 115, in test_no_questions self.assertContains(response, \u0026#34;No polls are available.\u0026#34;) File \u0026#34;/home/jose/virtualenv/django_tutorial/lib/python3.9/site-packages/django/test/testcases.py\u0026#34;, line 471, in assertContains self.assertTrue(real_count != 0, msg_prefix + \u0026#34;Couldn\u0026#39;t find %s in response\u0026#34; % text_repr) AssertionError: False is not true : Couldn\u0026#39;t find \u0026#39;No polls are available.\u0026#39; in response ---------------------------------------------------------------------- Ran 10 tests in 0.022s FAILED (failures=2) Recuerda que para hacer fallar un test, no hay que tocar el fichero test.py. Los test no se pasan porque al modificar el código de la aplicación se dejan de cumplir las condiciones indicadas en los test.\nPipeline para realizar un test automáticoPermalink Sabiendo como se ejecutan los test, es fácil hacer un pipeline que lo haga por nosotros de forma automática:\npipeline { agent { docker { image \u0026#39;python:3\u0026#39; args \u0026#39;-u root:root\u0026#39; } } stages { stage(\u0026#39;Clone\u0026#39;) { steps { git branch:\u0026#39;master\u0026#39;,url:\u0026#39;https://github.com/josedom24/django_tutorial.git\u0026#39; } } stage(\u0026#39;Install\u0026#39;) { steps { sh \u0026#39;pip install -r requirements.txt\u0026#39; } } stage(\u0026#39;Test\u0026#39;) { steps { sh \u0026#39;python3 manage.py test\u0026#39; } } } } Para poder instalar los paquetes con pip necesitamos ejecutar las instrucciones en el contenedor como root (args '-u root:root'). Clonamos el repositorio. Instalamos los requerimientos. Realizamos los test. Prueba a cambiar el código para que un test falle y comprueba como el pipeline falla.\nUna captura de pantalla donde se vea la salida de un build que se ha ejecutado de manera correcta. Modifica el código de la aplicación para que se produzca un fallo en el código. Recuerda que para hacer fallar un test, no hay que tocar el fichero test.py. Los test no se pasan porque al modificar el código de la aplicación se dejan de cumplir las condiciones indicadas en los test. Recuerda no elegir en el que hemos visto en este taller:mensaje “No polls are available”. def was_published_recently(self): now = timezone.now() return now - datetime.timedelta(days=1) \u0026gt;= self.pub_date \u0026lt;= now was_published_recently.admin_order_field = \u0026#39;pub_date\u0026#39; was_published_recently.boolean = True was_published_recently.short_description = \u0026#39;Published recently?\u0026#39; Una captura de pantalla donde se vea la salida de un build que se ha ejecutado con errores de testeo. ","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/taller3.png","permalink":"https://www.javiercd.es/posts/ci_cd/taller3_jenkins/taller3/","summary":"\u003cp\u003eVamos a trabajar con el repositorio de la aplicación \u003ca href=\"https://github.com/josedom24/django_tutorial\" target=\"_blank\" rel=\"noopener\"\u003edjango_tutorial\u003c/a\u003e. Esta aplicación tiene definidas una serie de test, que podemos estudiar en el fichero \u003ccode\u003etests.py\u003c/code\u003e del directorio \u003ccode\u003epolls\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eCada test viene definido por una función. En el fichero puedes leer los comentarios para saber que es lo que prueba cada test, o puedes ver el documento \u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/test_tutorial_django.html\" target=\"_blank\" rel=\"noopener\"\u003eTests en la aplicación tutorial Django\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003ePara ejecutar los test ejecutamos:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epython3 manage.py test\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eEn ese momento se crea una base de datos temporal, donde se van a ir realizando las pruebas que están definidas:\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Taller 3: Integración continua de aplicación django (Test)"},{"categories":null,"contents":"Introducción Para la realización de la practica voy a elegir el kernel 6.4.4 que me he descargado desde el repositorio backports :\nPara descargarnos el código fuente usaremos apt source :\nNos creara un directorio con el código fuente\nSi listamos el contenido del directorio con el código fuente veremos que la estructura es la misma que para compilar un paquete en C .\nPrimera compilación Lo primero que vamos a hacer es usar el fichero .config que tiene cargado nuestro kernel , actualmente el mio tiene 10640 lineas.\nA continuación vamos a lanzar la orden make oldconfig para que utilice el fichero actual del kernel que estemos usando .\nSi vemos tenemos configurados 2413 módulos de forma estática y 3855 de forma dinámica:\nVamos a pasarle el parámetro localmodconfig , dejare el enter pulsado para que seleccione las distintos parámetros por defecto .\nVemos que con este parámetro hemos bajado significativamente el numero de módulos , ya que con el método usado en el paso anterior solo se utilizan los que tenemos actualmente cargados en el kernel :\nCompilaremos el kernel y lo probaremos , en mi caso arranca :\nSegunda compilación Voy a quitar algunos componentes manualmente usando la herramienta make xconfig :\nDespués de eliminar varios puntos del .config se me ha quedado con :\nAhora vamos a usar un método para compilar el cual nos hará paquetes .deb y utilizaremos 15 núcleos para ello :\nNos generara 4 paquetes .deb en el directorio superior :\nVamos a instalárnoslos , para ello haremos uso de un comodín para instalar todos los .deb :\nPor ultimo vamos a asegurarnos de que el kernel se ha instalado :\nFirmar un kernel Como tengo el arranque seguro activado en el portátil sera necesario que firme el kernel para poder arrancarlo .\nAsí que para ello vamos a seguir los pasos que nos indica debian para realizarlo .\nSi deseas saber qué claves están en uso en tu sistema, varias otras llamadas de mokutil te ayudarán, por ejemplo, sudo mokutil \u0026ndash;list-enrolled para mostrar la lista actual de claves MOK\nPara generarnos unas nuevas keys para firmar el kernel nos crearemos el siguiente directorio :\nVamos a generarnos la clave privada y certificado en formato DER\nAhora vamos a convertir el certificado DER a formato PEM:\nAhora para inscribir una nueva clave MOK, primero emito la solicitud utilizando el comando mokutil. Ejecuto el siguiente comando:\nDurante este proceso, se me solicitará ingresar un \u0026ldquo;one-time password\u0026rdquo; (contraseña de un solo uso) para confirmar la inscripción. Esta contraseña es crucial para validar y autorizar la operación.\nLuego de emitir la solicitud y proporcionar la contraseña, la inscripción de la clave no se completa de inmediato. En lugar de eso, necesito reiniciar el sistema.\nCuando reiniciemos nos aparecerá una pantalla azul , nos dirigiremos a la segunda opción enroll MOK:\nNos dirá si queremos añadir las llaves :\nY nos pedirá que pongamos la contraseña que hemos indicado de un solo uso :\nUna vez hecho esto reiniciamos el equipo :\nUna vez añadida la llave podemos comprobarlo con el siguiente comando :\nPara que DKMS (Dynamic Kernel Module Support) firme automáticamente los módulos del kernel, es necesario indicarle con qué clave debe firmar el módulo. Esto se realiza añadiendo dos valores de configuración al archivo \u0026ldquo;/etc/dkms/framework.conf\u0026rdquo;, ajustando las rutas según sea necesario.\nAdemás añadiremos el siguiente script :\nEl script tendrá el siguiente contenido :\nAhora vamos a definir las variables necesarios para proceder a firmar el kernel , la de versión la hace con uname -r en la documentación de debian pero mis módulos tienen el prefijo 6.4.4 . Puedes comprobarlo en la ruta ls /lib/modules/ .\nAhora vamos a firmar el kernel :\nUna vez firmado el kernel podemos reiniciarlo y comprobar que arranca . A mi me ha tardado mas de lo normal al arrancarme pero en 2 min aproximadamente finalmente arranca .\n","date":"November 29, 2023","hero":"/images/sistemas/compilacion_de_un_kernel/compilacion_de_un_kernel.jpg","permalink":"https://www.javiercd.es/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/compilacion_de_un_kernel/","summary":"\u003ch2 id=\"introducción\"\u003eIntroducción\u003c/h2\u003e\n\u003cp\u003ePara la realización de la practica voy a elegir el kernel 6.4.4 que me he descargado desde el repositorio backports :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePara descargarnos el código fuente usaremos apt source :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eNos creara un directorio con el código fuente\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eSi listamos el contenido del directorio con el código fuente veremos que la estructura es la misma que para compilar un paquete en C .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.004.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"primera-compilación\"\u003ePrimera compilación\u003c/h2\u003e\n\u003cp\u003eLo primero que vamos a hacer es usar el fichero .config que tiene cargado nuestro kernel , actualmente el mio tiene 10640 lineas.\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Compilación de un kernel"},{"categories":null,"contents":"Introducción La compilación de programas en el lenguaje de programación C es un proceso fundamental en el desarrollo de software. Permite traducir el código fuente escrito por los programadores en instrucciones comprensibles por la computadora. Uno de los desafíos asociados con la compilación es la gestión eficiente de los archivos y dependencias del proyecto, lo cual se vuelve aún más crucial cuando se trabaja en proyectos grandes y complejos.\nEste trabajo tiene como objetivo explorar uno de los mecanismos más utilizados para compilar proyectos en C: el uso de un archivo Makefile. Un Makefile es un archivo de configuración que describe cómo se deben compilar los archivos fuente de un proyecto y cómo se deben gestionar las dependencias entre ellos. Además, permite automatizar el proceso de compilación y facilita la tarea de mantener y actualizar el código.\nA lo largo de este trabajo, examinaremos en detalle el proceso de compilación de un programa en C utilizando un Makefile. Comenzaremos por entender la estructura de un Makefile y cómo se define el flujo de compilación. Luego, exploraremos las ventajas de su uso, como la detección automática de cambios en los archivos fuente y la recopilación selectiva. También abordaremos las prácticas recomendadas para crear Makefiles efectivos y fáciles de mantener.\nAdemás, analizaremos un ejemplo práctico de compilación de un programa C, detallando los pasos necesarios para crear un Makefile y compilar el proyecto. Asimismo, discutiremos la instalación del programa resultante en un directorio personal, evitando interferencias con el sistema de paquetes.\nEn última instancia, aprenderemos cómo desinstalar limpiamente el programa y comprenderemos la importancia de una gestión adecuada del software en sistemas Unix/Linux.\nA medida que avanzamos en este trabajo, ganaremos una comprensión más profunda de la compilación en C y la utilidad de un Makefile como una herramienta esencial en el desarrollo de software.\nCompilación de un programa en C utilizando un Makefile Lo primero que vamos a instalar son fundamentales para la compilación de paquetes en C en Debian.\nEl paquete build-essential proporciona las herramientas de compilación necesarias, y dpkg-dev facilita la gestión de paquetes y la obtención del código fuente. Puedes instalar otros paquetes de desarrollo específicos según tus necesidades, pero estos dos son los más esenciales para comenzar a compilar software en C en Debian.\nAhora vamos a descargar los ficheros fuente del paquete que queramos compilar en mi caso lo haré de samba :\nUna vez hecho esto veremos en nuestro directorio que se han creado una serie de ficheros y directorios :\nsamba-4.17.12+dfsg: Este es el directorio que contiene el código fuente de Samba, que se descargó desde los repositorios de Debian. Es la fuente que se utilizará para compilar e instalar Samba en tu sistema.\nsamba_4.17.12+dfsg-0+deb12u1.debian.tar.xz: Este archivo comprimido contiene las modificaciones específicas de Debian para el paquete Samba. Puede incluir parches, scripts de construcción y otros archivos relacionados con la construcción del paquete.\nsamba_4.17.12+dfsg-0+deb12u1.dsc: Este archivo es el fichero de control de las fuentes Debian (Debian Source Control). Contiene información sobre la fuente y las versiones del paquete, así como enlaces a otros archivos relacionados con la fuente.\nsamba_4.17.12+dfsg.orig.tar.xz: Este archivo comprimido es la fuente original de Samba tal como se publicó en el sitio web oficial de Samba. Se utiliza como base para construir el paquete Debian.\nVamos a meternos en el directorio principal y podemos ver el código fuente del paquete :\nLo primero que haremos sera instalar las dependencias del paquete que queremos compilar en mi caso samba :\nAhora vamos a lanzar el script configure . Este script se utiliza para configurar la compilación de samba en función de tus necesidades y las características del sistema :\nAhora vamos a compilar el código fuente utilizando el comando make . Este se encargara de compilar el código y creara las ejecutables y bibliotecas que a creado el script configure :\nEste tardara en función del tamaño del paquete en mi caso me ha tardado 8 min :\nUna vez compilado el código para instalarlo vamos a usar make install :\nUna vez hecho esto tendremos nuestro paquete instalado en la ruta /usr/local :\nAhora para iniciar el servicio de samba ejecutaremos el fichero nmbd y nos aseguraremos de que este esta funcionando :\nVemos que la versión instalada es la que hemos compilado :\nDesinstalar el paquete compilado Para eliminar el paquete que hemos compilado :\nVemos que solo nos deja los ficheros de configuración del servicio :\nEs posible que queden en nuestro sistema rastros de samba ya que el fichero makefile no esta configurado en este caso para eliminarlo completamente , ejecutamos whereis y eliminamos el contenido de las rutas :\nUna vez hecho esto habremos eliminado el rastro de samba :\n","date":"November 29, 2023","hero":"/images/sistemas/compilacion_de_un_programa_en_c/compilacion_de_un_programa_en_c.jpg","permalink":"https://www.javiercd.es/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/compilacion_de_un_programa_en_c_utilizando_un_makefile/","summary":"\u003ch2 id=\"introducción\"\u003eIntroducción\u003c/h2\u003e\n\u003cp\u003eLa compilación de programas en el lenguaje de programación C es un proceso fundamental en el desarrollo de software. Permite traducir el código fuente escrito por los programadores en instrucciones comprensibles por la computadora. Uno de los desafíos asociados con la compilación es la gestión eficiente de los archivos y dependencias del proyecto, lo cual se vuelve aún más crucial cuando se trabaja en proyectos grandes y complejos.\u003c/p\u003e\n\u003cp\u003eEste trabajo tiene como objetivo explorar uno de los mecanismos más utilizados para compilar proyectos en C: el uso de un archivo Makefile. Un Makefile es un archivo de configuración que describe cómo se deben compilar los archivos fuente de un proyecto y cómo se deben gestionar las dependencias entre ellos. Además, permite automatizar el proceso de compilación y facilita la tarea de mantener y actualizar el código.\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Compilación de un programa en C utilizando un Makefile"},{"categories":null,"contents":"Instalación automática de una iso En la pagina oficial de debian nos descargaremos una imagen de debian , en mi caso he seleccionado una netinstall :\nUna vez descargada la imagen de debian, vamos a copiar su contenido en una carpeta para después hacer unas modificaciones. Para ello montaremos la iso como dispositivo loop :\nUna vez montada podremos ver su contenido :\nVamos a hacernos una copia de los ficheros que vamos a utilizar a un directorio nuestro para poder realizar cambios en los mismos , una vez hagamos esto podemos desmontar la imagen :\nUna vez copiados los ficheros vamos a movernos al directorio para crear el archivo preseed :\nDentro del mismo copiaremos el fichero de plantilla de bookworm que nos proporciona debian , lo puedes encontrar en su pagina oficial → https://www.debian.org/releases/bookworm/example-preseed.txt . Yo metere este fichero dentro de la carpeta fjcd_auto .\nProcederemos a editar la plantilla y seleccionaremos las distintas opciones :\nUna vez configurado el fichero preseed.cfg , le damos permisos al directorio install.amd y descomprimimos el initrd.gz :\nAñadimos las lineas de nuestro fichero preseed al initrd :\nVolvemos a comprimir el fichero initrd y le quitamos los permisos dados anteriormente al directorio padre :\nAhora añadiremos una entrada a este fichero para que al arrancar la iso tendríamos una entrada que realizara automáticamente la instalación con nuestro fichero preseed.cfg:\nPor ultimo queda sacar los hash de los distintos archivos de la iso y añadirlos al fichero md5sum.txt:\nCon esto ya solo nos queda generar la iso :\nSi arrancamos con la iso veremos la entrada que hemos creado :\nResultado :\nServidor PXE Ahora vamos a preparar el servidor PXE para que hagamos una instalación en red , para ello configurare SNAT en el mismo para que los clientes tengan internet :\nPara que el cambio sea permanente tengo instalado y configurado iptables-persistent , además recuerda activar el bit del forwarding\nAhora instalamos vamos a instalar dnsmasq :\nY configuraremos el servicio:\nReiniciamos el servicio para que se aplique la configuración :\nAhora en el directorio root de nuestro tftp vamos a descargarnos el netboot de nuestra version de debian :\nAhora vamos a descomprimir el siguiente contenido :\nUna vez descomprimido el fichero crearemos enlaces simbólicos a los siguientes ficheros :\nAhora nos queda configurar el servidor web para pasar el fichero preseed.cfg , yo lo he puesto en el document root del virtual host por defecto :\nPor ultimo nos queda configurar la entrada del menú de la iso que hemos descargado , indicamos que el archivo preseed.cfg esta en la siguiente url :\nAhora podemos arrancar la maquina por pxe:\nY si pulsamos sobre la entrada personalizada que acabamos de crear se instalara automáticamente a partir del fichero preseed.cfg:\nResultado :\n","date":"November 29, 2023","hero":"/images/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/creacion_de_un_sistema_automatizado_de_instalacion.jpg","permalink":"https://www.javiercd.es/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/creacion_de_un_sistema_automatizado_de_instalacion/","summary":"\u003ch2 id=\"instalación-automática-de-una-iso\"\u003eInstalación automática de una iso\u003c/h2\u003e\n\u003cp\u003eEn la pagina oficial de debian nos descargaremos una imagen de debian , en mi caso he seleccionado una netinstall :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/img/Aspose.Words.87912b93-5caf-4cac-995f-066fba11b8b6.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eUna vez descargada la imagen de debian, vamos a copiar su contenido en una carpeta para después hacer unas modificaciones. Para ello montaremos la iso como dispositivo loop :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/img/Aspose.Words.87912b93-5caf-4cac-995f-066fba11b8b6.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eUna vez montada podremos ver su contenido :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/img/Aspose.Words.87912b93-5caf-4cac-995f-066fba11b8b6.003.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eVamos a hacernos una copia de los ficheros que vamos a utilizar  a un directorio nuestro para poder realizar cambios en los mismos , una vez hagamos esto podemos desmontar la imagen :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Creación de un sistema automatizado de instalación"},{"categories":null,"contents":"1.Comprueba los módulos cargados en tu equipo. 2.Cuenta el número de módulos disponibles en el núcleo que estás usando. 3.Conecta un lápiz USB y observa la salida de la instrucción sudo dmesg. Vemos como el kernel detecta el dispositivo usb y se cargan los módulos necesarios para el mismo :\nVemos como el numero de módulos cargados han aumentado :\n4.Elimina el módulo correspondiente a algún dispotivo no esencial y comprueba qué ocurre. Vuelve a cargarlo. Si lo descargamos no podremos hacer uso de sistemas de ficheros exfat :\nPara volver a cargarlo :\n5.Selecciona un módulo que esté en uso en tu equipo y configura el arranque para que no se cargue automáticamente. Para ello lo añadimos a la “lista negra ” , luego actualizamos el initframes :\nCuando reiniciemos este no estará cargado :\n6.Carga el módulo loop, obtén información de qué es y para qué sirve. Lista el contenido de /sys/modules/loop/parameters y configura el equipo para que se puedan cargar como máximo 12 dispositivos loop la próxima vez que se arranque. Lo cargamos y comprobamos que este este cargado :\nVemos la información del mismo :\nListo el contenido del directorio /sys/module/loop/parameters . Esto mostrará los parámetros disponibles para el módulo loop\nSi queremos limitar que haya 12 dispositivos loop , creamos el siguiente fichero y añadimos la siguiente configuración :\nTendremos que actualizar el initframes sudo update-initramfs -u , para que se apliquen los cambios , además tendremos que reiniciar .\nUna vez reiniciamos , si vemos el contenido del parámetro max_loops . Veremos que este se ha aplicado :\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos/","summary":"\u003ch2 id=\"1comprueba-los-módulos-cargados-en-tu-equipo\"\u003e1.Comprueba los módulos cargados en tu equipo.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2cuenta-el-número-de-módulos-disponibles-en-el-núcleo-que-estás-usando\"\u003e2.Cuenta el número de módulos disponibles en el núcleo que estás usando.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"3conecta-un-lápiz-usb-y-observa-la-salida-de-la-instrucción-sudo-dmesg\"\u003e3.Conecta un lápiz USB y observa la salida de la instrucción sudo dmesg.\u003c/h2\u003e\n\u003cp\u003eVemos como el kernel detecta el dispositivo usb y se cargan los módulos necesarios para el mismo :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.003.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eVemos como el numero de módulos cargados han aumentado :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4elimina-el-módulo-correspondiente-a-algún-dispotivo-no-esencial-y-comprueba-qué-ocurre-vuelve-a-cargarlo\"\u003e4.Elimina el módulo correspondiente a algún dispotivo no esencial y comprueba qué ocurre. Vuelve a cargarlo.\u003c/h2\u003e\n\u003cp\u003eSi lo descargamos no podremos hacer uso de sistemas de ficheros exfat :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Ejercicios de manejo de módulos"},{"categories":null,"contents":"1.Deshabilita apparmor en el arranque. 2.Deshabilita si es posible el Kernel Mode Setting (KSM) de la tarjeta gráfica. Añadimos la siguiente linea en la configuraron del grub : Actualizamos el grub para que se apliquen los cambios :\n3.Cambia provisionalmente la swappiness para que la swap de tu equipo se active cuando se use más de un 90% de la RAM. 4.Haz que el cambio de la swappiness sea permanente. Tienes que ejecutar sudo sysctl -p para que se aplique . 5.Muestra el valor del bit de forward para IPv6.\n6.Deshabilita completamente las Magic Sysrq en el arranque y vuelve a habilitarlas después de reiniciar. Para deshabilitaras :\nPara volver a habilitarlas cambia el valor de 0 a 1 y reinicia el equipo o ejecuta sudo sysctl -p:\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_modificacion_de_parametros_del_kernel/ejercicios_de_modificacion_de_parametros_del_kernel.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ejercicios_de_modificacion_de_parametros_del_kernel/","summary":"\u003ch2 id=\"1deshabilita-apparmor-en-el-arranque\"\u003e1.Deshabilita apparmor en el arranque.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2deshabilita-si-es-posible-el-kernel-mode-setting-ksm-de-la-tarjeta-gráfica-añadimos-la-siguiente-linea-en-la-configuraron-del-grub-\"\u003e2.Deshabilita si es posible el Kernel Mode Setting (KSM) de la tarjeta gráfica. Añadimos la siguiente linea en la configuraron del grub :\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eActualizamos el grub para que se apliquen los cambios :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"3cambia-provisionalmente-la-swappiness-para-que-la-swap-de-tu-equipo-se-active-cuando-se-use-más-de-un-90-de-la-ram\"\u003e3.Cambia provisionalmente la swappiness para que la swap de tu equipo se active cuando se use más de un 90% de la RAM.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4haz-que-el-cambio-de-la-swappiness-sea-permanente\"\u003e4.Haz que el cambio de la swappiness sea permanente.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.005.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Ejercicios de modificación de parámetros del kernel"},{"categories":null,"contents":"Trabajo con apt, aptitude, dpkg Ejercicio 1 Que acciones consigo al realizar apt update y apt upgrade. Explica detalladamente. El comando apt update es el primer paso fundamental en la actualización de paquetes. Realiza las siguientes acciones:\nRecupera Metadatos Remotos: apt update se comunica con los repositorios de software en línea y recupera los metadatos relacionados con los paquetes disponibles. Estos metadatos incluyen información sobre las últimas versiones de los paquetes, sus dependencias y otra información esencial. Actualiza la Copia Local de Metadatos: Luego, apt reconstruye y actualiza la copia local de estos metadatos. Esto permite que el sistema acceda rápidamente a información sobre los paquetes sin necesidad de descargarla repetidamente. Una vez que apt update ha actualizado la información sobre los paquetes disponibles, el siguiente paso es utilizar el comando apt upgrade. Este comando realiza una serie de pasos importantes:\nSelección de Versiones Candidatas: apt selecciona las versiones candidatas de los paquetes disponibles. Estas versiones suelen ser las más recientes, aunque hay excepciones. Resolución de Dependencias: apt verifica y resuelve las dependencias entre los paquetes para garantizar que la actualización se realice de manera coherente y que todas las dependencias estén satisfechas. Descarga de Paquetes: Si se encuentran nuevas versiones de paquetes, apt descarga estas versiones desde los repositorios en línea a la caché local del sistema. Desempaquetado de Paquetes: apt desempaqueta los paquetes binarios recuperados. Ejecución de Órdenes Preinst: Durante la actualización, se ejecutan los archivos de órdenes preinstalación, que pueden contener configuraciones y ajustes necesarios antes de la instalación. Instalación de Archivos Binarios: Los archivos binarios de las nuevas versiones de los paquetes se instalan en el sistema. Ejecución de Órdenes Postinst: Finalmente, se ejecutan los archivos de órdenes postinstalación, que pueden realizar configuraciones adicionales después de la instalación. Ejercicio 2 Lista la relación de paquetes que pueden ser actualizados. ¿Qué información puedes sacar a tenor de lo mostrado en el listado? Puedes verificar la lista de paquetes que pueden ser actualizados utilizando el siguiente comando apt list \u0026ndash;upgradable. Este comando mostrará una lista de paquetes disponibles para la actualización y proporcionará información sobre cada uno de ellos. Aquí hay una breve descripción de la información que puedes obtener a partir de este listado:\nNombre del Paquete: El nombre del paquete es la primera columna de la lista. Te muestra el nombre del paquete que se puede actualizar, por ejemplo, nombre-del-paquete. Versión Actual: La versión actualmente instalada del paquete se encuentra a la derecha del nombre del paquete, en la segunda columna. Por ejemplo, 1.2.3. Versión Disponible: La tercera columna muestra la versión disponible más reciente del paquete en los repositorios. Por ejemplo, 1.2.4. Estado de la Actualización: En la última columna, se indica el estado de la actualización. Si hay un asterisco (*) junto al nombre del paquete, significa que ese paquete está marcado para ser actualizado. Descripción del Paquete: Además de esta información básica, el listado también proporciona una breve descripción del paquete, que te brinda una idea general de la función del paquete y su propósito. Ejercicio 3 Indica la versión instalada, candidata así como la prioridad del paquete openssh-client Ejercicio 4 ¿Cómo puedes sacar información de un paquete oficial instalado o que no este instalado?** Podemos usar el comando apt show para paquetes instalados como para no instalados . También podemos hacerlo con dpkg pero el paquete tiene que estar instalado → dpkg -s :\nEjercicio 5 Saca toda la información que puedas del paquete openssh-client que tienes actualmente instalado en tu máquina Ejercicio 6 Saca toda la información que puedas del paquete openssh-client candidato a actualizar en tu máquina Ejercicio 7 Lista todo el contenido referente al paquete openssh-client actual de tu máquina. Utiliza para ello tanto dpkg como apt. Usando dpkg :\nUsando apt :\nEjercicio 8 Listar el contenido de un paquete sin la necesidad de instalarlo o descargarlo. Podemos usar apt file :\napt-file list [paquete] Ejercicio 9 Simula la instalación del paquete openssh-client Ejercicio 10 ¿Qué comando te informa de los posible bugs que presente un determinado paquete? Ejercicio 11 Después de realizar un apt update \u0026amp;\u0026amp; apt upgrade. Si quisieras actualizar únicamente los paquetes que tienen de cadena openssh. ¿Qué procedimiento seguirías?. Realiza esta acción, con las estructuras repetitivas que te ofrece bash, así como con el comando xargs. Usando la estructura repetitiva de bash , usando un one line :\nUsando xargs :\nEjercicio 12 ¿Cómo encontrarías qué paquetes dependen de un paquete específico? Con este vemos las dependencias del paquete directas :\nMientras que con este las dependencias indirectas :\nEjercicio 13 ¿Cómo procederías para encontrar el paquete al que pertenece un determinado fichero? Podemos usar dpkg :\nPodemos usar apt-file :\nEjercicio 14 ¿Que procedimientos emplearías para liberar la caché en cuanto a descargas de paquetería? Para limpiar la caché de descargas :\nPara eliminarlos paquetes descargados que ya no están en uso:\nO podemos hacer las dos cosas a la vez con apt clean :\nEjercicio 15 Realiza la instalación del paquete keyboard-configuration pasando previamente los valores de los parámetros de configuración como variables de entorno. Nos aseguramos de que tenemos instalado el paquete :\nPara ello nos instalamos debconfs-utils:\nEn un fichero declaramos las variables que queramos configurar en el teclado :\nY se las proporcionamos al debconf:\nY comprobaremos que se han aplicado los cambios :\nEjercicio 16 Reconfigura el paquete locales de tu equipo, añadiendo una localización que no exista previamente. Comprueba a modificar las variables de entorno correspondientes para que la sesión del usuario utilice otra localización. Si queremos almacenar nuestra configuración para cada usuario exportaremos nuestras variables y las pondremos en el bashrc :\nA continuación ejecutaremos dpkg-reconfigure y observaremos que tendremos seleccionado el valor de la variable :\nEjercicio 17 Interrumpe la configuración de un paquete y explica los pasos a dar para continuar la instalación Una vez irrumpamos la instalación de un paquete , para continuar la instalación del mismo podemos usar el comando dpkg:\nPodemos usar el parámetro -a para todos los paquetes o especificar el nombre para continuar su instalación :\nEjercicio 18 Explica la instrucción que utilizarías para hacer una actualización completa de todos los paquetes de tu sistema de manera completamente no interactiva Ejercicio 19 Bloquea la actualización de determinados paquetes Lo marcamos para evitar las actualizaciones y listamos los marcados para comprobar que no se actualizara :\nTrabajo con ficheros .deb Ejercicio 1 Descarga un paquete sin instalarlo, es decir, descarga el fichero .deb correspondiente. Indica diferentes formas de hacerlo. Podemos usar el comando apt :\nPodemos usar wget y descargarlo desde los repositorios de debían :\nEjercicio 2 ¿Cómo puedes ver el contenido, que no extraerlo, de lo que se instalará en el sistema de un paquete deb? Ejercicio 3 Sobre el fichero .deb descargado, utiliza el comando ar. ar permite extraer el contenido de una paquete deb. Indica el procedimiento para visualizar con ar el contenido del paquete deb. Con el paquete que has descargado y utilizando el comando ar, descomprime el paquete. ¿Qué información dispones después de la extracción?. Indica la finalidad de lo extraído. Para visualizar el contenido :\nPara descomprimir el directorio :\nHemos extraído 3 archivos del paquete :\ncontrol.tar.xz : Contiene scripts que dpkg utiliza para instalar el paquete data.tar.xz : contiene los archivos del paquete debian-binary : indica la version del paquete Indica el procedimiento para descomprimir lo extraído por ar del punto anterior. ¿Qué información contiene?\nPara descomprimir ficheros usaremos tar -xJf :\nNos encontraremos los siguientes directorios y ficheros :\ncontrol: Este archivo contiene metadatos sobre el paquete, como su nombre, versión, descripción, dependencias y otros detalles importantes. conffiles: Este archivo enumera los archivos de configuración que son parte del paquete y que deben ser tratados de manera especial durante las actualizaciones para preservar las configuraciones personalizadas del usuario. preinst: Este es un script de preinstalación que se ejecuta antes de que el paquete sea instalado en el sistema. Puede contener acciones de preconfiguración necesarias. postinst: Este es un script de postinstalación que se ejecuta después de que el paquete ha sido instalado en el sistema. Puede contener acciones de postconfiguración necesarias. prerm: Este es un script de preremoción que se ejecuta antes de que el paquete sea desinstalado del sistema. Puede contener acciones de preeliminación necesarias. postrm: Este es un script de postremoción que se ejecuta después de que el paquete ha sido desinstalado del sistema. Puede contener acciones de posteliminación necesarias. md5sums: Este archivo contiene las sumas de control MD5 de los archivos que se instalan con el paquete. Se utiliza para verificar la integridad de los archivos durante la instalación. El archivo data.tar.xz contiene los archivos y directorios que se instalarán en el sistema cuando se instale el paquete.\nTrabajo con repositorios Ejercicio 1 Añade a tu fichero sources.list los repositorios de bullseye-backports y sid. Ejercicio 2 Configura el sistema APT para que los paquetes de debian bullseye tengan mayor prioridad y por tanto sean los que se instalen por defecto. Ejercicio 3 Configura el sistema APT para que los paquetes de bullseye-backports tengan mayor prioridad que los de unstable. Ejercicio 4 ¿Cómo añades la posibilidad de descargar paquetería de la arquitectura i386 en tu sistema. ¿Que comando has empleado?. Lista arquitecturas no nativas. ¿Cómo procederías para desechar la posibilidad de descargar paquetería de la arquitectura i386? Para añadirla :\nPara eliminarla :\nEjercicio 5 Si quisieras descargar un paquete, ¿cómo puedes saber todas las versiones disponible de dicho paquete? Ejercicio 6 Indica el procedimiento para descargar un paquete del repositorio stable. Tal y como lo tenemos configurado los paquetes por prioridad se descargaran del repositorio estable . Pero podemos indicárselo :\nEjercicio 7 Indica el procedimiento para descargar un paquete del repositorio de buster-backports Tienes que tener el repositorio indicado en el sources.list luego puedes indicarlo con el parámetro -t.\nEjercicio 8 Indica el procedimiento para descargar un paquete del repositorio de sid Igual que el ejercicio anterior solo que aquí indicamos sid ya que tenemos indicado el repositorio en el sources.list:\nEjercicio 9 Indica el procedimiento para descargar un paquete de arquitectura i386.** Indicamos el nombre del paquete seguido de :i386 Trabajo con directorios Que cometidos tienen\n/var/lib/apt/lists/: Este directorio contiene listas de paquetes disponibles en los repositorios configurados en mi sistema. Estas listas son archivos con extensión .list que contienen información sobre los paquetes disponibles, sus versiones y las fuentes de donde se pueden descargar. Cuando ejecuto apt update, actualizo estas listas .\n/var/lib/dpkg/available: Este archivo contiene información sobre los paquetes instalados y sus versiones. Es utilizado por mi sistema de gestión de paquetes dpkg para mantener un registro de los paquetes que tengo instalados y sus estados. Proporciona información sobre los paquetes disponibles y sus dependencias.\n/var/lib/dpkg/status: Este archivo también contiene información sobre los paquetes instalados en mi sistema, pero proporciona una vista más detallada que /var/lib/dpkg/available. Contiene información sobre el estado de los paquetes, como si están instalados, desinstalados o si hay problemas con su configuración.\n/var/cache/apt/archives/: Este directorio almacena los archivos de paquetes que descargo antes de que sean instalados en mi sistema. Cuando ejecuto comandos como apt-get install o apt-get upgrade, los paquetes se descargan primero en este directorio y luego se instalan. Mantener una copia de los paquetes descargados en este directorio puede ser útil si deseo reinstalar o desinstalar un paquete sin volver a descargarlo desde los repositorios, lo que ayuda a ahorrar tiempo y ancho de banda.\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ejercicios_gestion_de_paqueteria/","summary":"\u003ch2 id=\"trabajo-con-apt-aptitude-dpkg\"\u003eTrabajo con apt, aptitude, dpkg\u003c/h2\u003e\n\u003ch3 id=\"ejercicio-1-que-acciones-consigo-al-realizar-apt-update-y-apt-upgrade-explica-detalladamente\"\u003eEjercicio 1 Que acciones consigo al realizar apt update y apt upgrade. Explica detalladamente.\u003c/h3\u003e\n\u003cp\u003eEl comando apt update es el primer paso fundamental en la actualización de paquetes. Realiza las siguientes acciones:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eRecupera Metadatos Remotos:\u003c/strong\u003e apt update se comunica con los repositorios de software en línea y recupera los metadatos relacionados con los paquetes disponibles. Estos metadatos incluyen información sobre las últimas versiones de los paquetes, sus dependencias y otra información esencial.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eActualiza la Copia Local de Metadatos:\u003c/strong\u003e Luego, apt reconstruye y actualiza la copia local de estos metadatos. Esto permite que el sistema acceda rápidamente a información sobre los paquetes sin necesidad de descargarla repetidamente.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUna vez que apt update ha actualizado la información sobre los paquetes disponibles, el siguiente paso es utilizar el comando apt upgrade. Este comando realiza una serie de pasos importantes:\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Ejercicios gestión de paquetería"},{"categories":null,"contents":"Indica los pasos a seguir para modificar la configuración de red de DHCP a estática Para configurar la interfaz ens1 con una dirección IP estática (por ejemplo, 192.168.122.10), debes modificar el archivo /etc/sysconfig/network-scripts/ifcfg-ens1 :\nPara aplicar la configuración reiniciamos el Network Manager :\nActualiza el sistema a las versiones más recientes de los paquetes instalados Instala el repositorio adicional EPEL. Instala el paquete bash-completion. Instala el paquete que proporciona el programa dig, explicando los pasos que has dado para encontrarlo\nInstalamos el paquete :\nExplica qué comando utilizarías para ver la información del paquete kernel instalado Instala el repositorio adicional \u0026ldquo;elrepo\u0026rdquo;. Importamos la clave publica del repositorio : Instalamos el repositorio :\nBusca las versiones disponibles para instalar del núcleo Linux e instala la más nueva Listamos los kernel mas recientes : Lo instalamos:\nMuestra el contenido del paquete del último núcleo instalado ","date":"November 29, 2023","hero":"/images/sistemas/gestion_de_paquetes/gestion_de_paquetes.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/gestion_de_paquetes/gestion_de_paquetes/","summary":"\u003ch2 id=\"indica-los-pasos-a-seguir-para-modificar-la-configuración-de-red-de-dhcp-a-estática\"\u003eIndica los pasos a seguir para modificar la configuración de red de DHCP a estática\u003c/h2\u003e\n\u003cp\u003ePara configurar la interfaz ens1 con una dirección IP estática (por ejemplo, 192.168.122.10), debes modificar el archivo /etc/sysconfig/network-scripts/ifcfg-ens1 :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePara aplicar la configuración reiniciamos el Network Manager :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.002.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"actualiza-el-sistema-a-las-versiones-más-recientes-de-los-paquetes-instalados\"\u003eActualiza el sistema a las versiones más recientes de los paquetes instalados\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"instala-el-repositorio-adicional-epel\"\u003eInstala el repositorio adicional EPEL.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.004.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"instala-el-paquete-bash-completion\"\u003eInstala el paquete bash-completion.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.005.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eInstala el paquete que proporciona el programa dig, explicando los pasos que has dado para encontrarlo\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Gestion de paquetes"},{"categories":null,"contents":"Actualizar los paquetes Antes de migrar, asegúrate de que tu sistema CentOS Stream 8 tenga todos los paquetes y actualizaciones más recientes.\nElimina los paquetes innecesarios que nos aparezcan al utilizar el siguiente comando ya que son paquetes huérfanos\nActualización a CentOS9 Instala los repositorios de CentOS 9 :\nAhora vamos a actualizar los paquetes a CentOS 9:\nCuando finalice la instalación nos lo indicara , es posible que se eliminen algunos paquetes :\nActualizamos la base de datos de los paquetes locales :\nEliminamos los paquetes de la cache dnf :\nActualizamos los paquetes instalados :\nInstalamos los paquetes para la instalación mínima de un server core (sin entorno gráfico):\nAhora reiniciaremos el sistema y arrancamos con CentOS 9 :\nAl iniciar podemos comprobar que ya oficialmente tenemos CentOS 9 :\nLimpieza adicional Si quieres puedes eliminar el kernel antiguo :\nAdemás si no tienes subscripción puedes eliminar el mánager de suscripciones :\nGenerar entrada de rescate en el grub Moveremos los kerneles antiguos de rescate a una carpeta temporal como copia de seguridad :\nAhora vamos a regenerar las entradas del kernel , el comando no nos devolverá nada así que podemos comprobarlo mirando en la partición boot :\nUna vez hecho podremos reiniciar y comprobar que tenemos la entrada de recuperación de CentOS 9:\nBibliografía Guía para migrar de CentOS 8 stream a CenOS 9 stream\n","date":"November 29, 2023","hero":"/images/sistemas/paso_de_centos_stream_8_a_centos_stream_9/paso_de_centos_stream_8_a_centos_stream_9.png","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/paso_de_centos_stream_8_a_centos_stream_9/","summary":"\u003ch2 id=\"actualizar-los-paquetes\"\u003eActualizar los paquetes\u003c/h2\u003e\n\u003cp\u003eAntes de migrar, asegúrate de que tu sistema CentOS Stream 8 tenga todos los paquetes y actualizaciones más recientes.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eElimina los paquetes innecesarios que nos aparezcan al utilizar el siguiente comando ya que son paquetes huérfanos\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"actualización-a-centos9\"\u003eActualización a CentOS9\u003c/h2\u003e\n\u003cp\u003eInstala los repositorios de CentOS 9 :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.003.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora vamos a actualizar los paquetes a CentOS 9:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCuando finalice la instalación nos lo indicara , es posible que se eliminen algunos paquetes  :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Paso de CentOS stream 8 a CentOS stream 9"},{"categories":null,"contents":"Creación del esquema LVM Nos instalamos el paquete LVM2\nAhora crearemos las particiones en el segundo disco :\nCreamos el grupo de volúmenes :\nCreamos los volúmenes raíz y home :\nLa particiones tienes que tener el siguiente formato :\n-vdb2 etx4\n-FJCD-vg-home ext4\n-FJCD-vg-raiz ext4\nNos quedara darle formato a la efi :\nAsí quedaría nuestro esquema de particiones :\nCopiar el contenido de las particiones Ahora vamos a montar las particiones :\nAhora vamos a copiar las particiones , comenzamos con la boot :\nContinuamos con la efi :\nSeguimos con la raiz :\nFinalizamos con la home :\nInstalar el grub en el segundo disco Podemos aprovechar para cambiar el fichero /etc/fstab del segundo disco :\nTe dejo grabado en vídeo la prueba en directo de que el sistema arranca quitándole el primer disco. https://youtu.be/zAlMqKIaLCQ\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/transformacion_instancia_cloud/transformacion_instancia_cloud/","summary":"\u003ch2 id=\"creación-del-esquema-lvm\"\u003eCreación del esquema LVM\u003c/h2\u003e\n\u003cp\u003eNos instalamos el paquete LVM2\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora crearemos las particiones en el segundo disco :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCreamos el grupo de volúmenes :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCreamos los volúmenes raíz y home :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eLa particiones tienes que tener el siguiente formato :\u003c/p\u003e\n\u003cp\u003e-vdb2 etx4\u003c/p\u003e\n\u003cp\u003e-FJCD-vg-home ext4\u003c/p\u003e\n\u003cp\u003e-FJCD-vg-raiz ext4\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.005.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eNos quedara darle formato a la efi :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.006.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAsí quedaría nuestro esquema de particiones :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.007.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"copiar-el-contenido-de-las-particiones\"\u003eCopiar el contenido de las particiones\u003c/h2\u003e\n\u003cp\u003eAhora vamos a montar las particiones :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Transformación instancia cloud"},{"categories":null,"contents":"Instalación pila LAMP en Debian 12 Si estás utilizando Debian 12, sigue los pasos a continuación para instalar un servidor web LAMP completo en Debian GNU/Linux 12 \u0026ldquo;Bookworm\u0026rdquo; (Stable). Ten en cuenta que Debian 12 incluye PHP 8.2 en sus repositorios, lo que puede ser diferente de versiones anteriores de Debian.\nInstalación del servidor web Lo primero en un servidor LAMP es la \u0026ldquo;A\u0026rdquo; de Apache. Para instalar Apache, ejecuta los siguientes comandos:\njaviercruces@IWEB:~$ sudo apt install apache2 javiercruces@IWEB:~$ sudo systemctl enable apache2 \u0026amp;\u0026amp; sudo systemctl start apache2 Con estos comandos, habrás instalado y activado el servidor web Apache. Puedes verificarlo escribiendo la IP del servidor en tu navegador favorito y debería mostrarte la página de inicio de Apache por defecto.\nInstalación de PHP Por lo general, necesitarás instalar algunos paquetes específicos para PHP, llamados módulos en función de la base de datos que utilices. Puedes instalarlos con el siguiente comando:\njaviercruces@IWEB:~$ sudo apt install php8.2 libapache2-mod-php8.2 php8.2-mysql Si instalas CMS como WordPress, Moodle o Prestashop en tu servidor, es posible que te pidan paquetes adicionales para su correcto funcionamiento. Estas aplicaciones suelen indicar claramente qué paquetes necesitas instalar.\nPara que Apache aplique los cambios y active PHP, reinicia el servicio con el siguiente comando:\njaviercruces@IWEB:~$ sudo systemctl restart apache2 Instalación y configuración de MariaDB Puedes usar indistintamente MariaDB o Mysql , en mi caso usare MariaDB :\njaviercruces@IWEB:~$ sudo apt install mariadb-server javiercruces@IWEB:~$ sudo systemctl enable mysql \u0026amp;\u0026amp; sudo systemctl start mysql Durante la instalación, se te pedirá establecer una contraseña para el usuario root de MySQL. Una vez que haya finalizado la instalación, ejecuta el siguiente comando para asegurar tu instalación de MariaDB:\njaviercruces@IWEB:~$ sudo mysql_secure_installation Sigue las instrucciones para asegurar tu instalación de MariaDB, como configurar la contraseña del usuario root y eliminar usuarios anónimos y bases de datos de prueba.\nDespués de completar estos pasos, habrás configurado MariaDB y podrás conectarte a través de la terminal:\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 32 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [(none)]\u0026gt; Con esto ya tendrías instalada la pila LAMP en debian 12\n","date":"October 28, 2023","hero":"/images/iweb/lamp/portada_lamp.png","permalink":"https://www.javiercd.es/posts/iaw/lamp/lamp/","summary":"\u003ch1 id=\"instalación-pila-lamp-en-debian-12\"\u003eInstalación pila LAMP en Debian 12\u003c/h1\u003e\n\u003cp\u003eSi estás utilizando Debian 12, sigue los pasos a continuación para instalar un servidor web LAMP completo en Debian GNU/Linux 12 \u0026ldquo;Bookworm\u0026rdquo; (Stable). Ten en cuenta que Debian 12 incluye PHP 8.2 en sus repositorios, lo que puede ser diferente de versiones anteriores de Debian.\u003c/p\u003e\n\u003ch2 id=\"instalación-del-servidor-web\"\u003eInstalación del servidor web\u003c/h2\u003e\n\u003cp\u003eLo primero en un servidor LAMP es la \u0026ldquo;A\u0026rdquo; de Apache. Para instalar Apache, ejecuta los siguientes comandos:\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian","LAMP"],"title":"Instalación pila LAMP en debian 12"},{"categories":null,"contents":"Instalación pila LEMP en debian 12 con PHP-8 En esta guía, te explicare los pasos necesarios para instalar una pila LEMP (Linux, Nginx, MariaDB y PHP) en un servidor con Debian 12. La configuración incluirá PHP 8.2 como versión principal. La pila LEMP es esencial para alojar sitios web y aplicaciones web basadas en PHP, como WordPress u otras aplicaciones dinámicas. Sigue los pasos detallados a continuación para configurar tu servidor LEMP con PHP 8.2.\nRequisitos previos Antes de comenzar, asegúrate de que cumples con los siguientes requisitos:\nUn servidor Linux. Un usuario no root con privilegios sudo. Un nombre de dominio completo que apunte al servidor. Primero, actualiza y actualiza los paquetes del sistema:\njaviercruces@IWEB:~$ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade Además, asegúrate de que los siguientes paquetes estén instalados en tu sistema , ya que los utilizaremos mas adelante :\njaviercruces@IWEB:~$ sudo apt install wget nano unzip tar -y Instalación PHP Debian 12 incluye PHP 8.2 por defecto. Puedes instalarlo ejecutando el siguiente comando:\njaviercruces@IWEB:~$ sudo apt install php-fpm php-cli php-mysql php-mbstring php-xml php-gd Hemos instalado las extensiones MySQL, CLI, GD, Mbstring y XML de PHP. Puedes instalar cualquier extensión adicional según tus necesidades. Para verificar la instalación de PHP, puedes ejecutar:\njaviercruces@IWEB:~$ php --version PHP 8.2.7 (cli) (built: Jun 9 2023 19:37:27) (NTS) Copyright (c) The PHP Group Zend Engine v4.2.7, Copyright (c) Zend Technologies with Zend OPcache v8.2.7, Copyright (c), by Zend Technologies javiercruces@IWEB:~$ Instalación MariaDB Puedes usar indistintamente MariaDB o Mysql , en mi caso usare MariaDB :\njaviercruces@IWEB:~$ sudo apt install mariadb-server javiercruces@IWEB:~$ sudo systemctl enable mysql \u0026amp;\u0026amp; sudo systemctl start mysql Durante la instalación, se te pedirá establecer una contraseña para el usuario root de MySQL. Una vez que haya finalizado la instalación, ejecuta el siguiente comando para asegurar tu instalación de MariaDB:\njaviercruces@IWEB:~$ sudo mysql_secure_installation Sigue las instrucciones para asegurar tu instalación de MariaDB, como configurar la contraseña del usuario root y eliminar usuarios anónimos y bases de datos de prueba.\nDespués de completar estos pasos, habrás configurado MariaDB y podrás conectarte a través de la terminal .\nSi te has saltado lanzar el script de la instalación segura , el usuario root de la base de datos no tiene contraseña asi que pulsa espacio para iniciar sesión una vez lanzado el comando .\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 32 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [(none)]\u0026gt; Instalar Nginx Primero, asegurémonos de que Nginx esté instalado en tu servidor:\njaviercruces@IWEB:~$ sudo apt install nginx Una vez que Nginx esté instalado, procederemos a configurar un socket TCP para trabajar con PHP-FPM.\nAbre el archivo de configuración de PHP-FPM para realizar la configuración necesaria:\njaviercruces@IWEB:~$ sudo nano /etc/php/8.2/fpm/pool.d/www.conf Dentro del archivo, busca la sección que define la dirección en la que PHP-FPM acepta solicitudes FastCGI.\nComenta la línea que comienza con listen y reemplázala por la siguiente línea para configurar un socket TCP en la dirección 127.0.0.1 y el puerto 9000:\n; The address on which to accept FastCGI requests. ; Valid syntaxes are: ; \u0026#39;ip.add.re.ss:port\u0026#39; - to listen on a TCP socket to a specific IPv4 address on ; a specific port; ; \u0026#39;[ip:6:addr:ess]:port\u0026#39; - to listen on a TCP socket to a specific IPv6 address on ; a specific port; ; \u0026#39;port\u0026#39; - to listen on a TCP socket to all addresses ; (IPv6 and IPv4-mapped) on a specific port; ; \u0026#39;/path/to/unix/socket\u0026#39; - to listen on a Unix socket. ; Note: This value is mandatory. ;listen = /run/php/php8.2-fpm.sock --\u0026gt; Comenta esta linea listen = 127.0.0.1:9000 Guarda los cambios y cierra el archivo.\nAhora vamos a editar la configuración del sitio virtual por defecto para hacerlo funcionar con fpm .\nPara lograrlo, vamos a modificar el contenido dentro de la sección location en la configuración del servidor. Aquí te proporciono un ejemplo de archivo de configuración que puedes utilizar:\nserver { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; index index.html index.php index.htm index.nginx-debian.html ; server_name _; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; #fastcgi_pass unix:/var/run/php/php8.2-fpm.sock; # fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } Ahora vamos a reiniciar los servicios tanto de php como de Nginx para asegurar de que sea aplicado la configuración , pero primero vamos a comprobar si tienes errores de sintaxis en ambos ficheros .\nPara comprobar errores de sintaxis en Nginx :\njaviercruces@IWEB:~$ sudo nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful Si la salida es correcta continua comprobando si has cometido errores de sintaxis en la configuración de PHP-FPM :\njaviercruces@IWEB:~$ sudo php-fpm8.2 -t [02-Nov-2023 17:33:02] NOTICE: configuration file /etc/php/8.2/fpm/php-fpm.conf test is successful Una vez las dos salidas de estos comandos no contienen errores , vamos a reiniciar ambos servicios para que se aplique la configuración :\njaviercruces@IWEB:/etc/nginx$ sudo systemctl restart php8.2-fpm nginx.service Comprobación de funcionamiento Para asegurarnos de que el servidor está funcionando correctamente con PHP-FPM, vamos a crear un archivo llamado info.php que mostrará información sobre la configuración de PHP en el servidor. A continuación, te mostraré cómo crear el archivo:\njaviercruces@IWEB:~$ sudo nano /var/www/html/info.php Dentro del archivo info.php, agrega el siguiente contenido:\n\u0026lt;?php phpinfo(); ?\u0026gt; Guarda y cierra el archivo\nEste archivo PHP mostrará información detallada sobre la configuración de PHP en tu servidor. Puedes acceder a él en tu navegador visitando http://tudominio.com/info.php (reemplaza tudominio.com con tu nombre de dominio real) o también puedes acceder al mismo poniendo en el navegador la IP de tu maquina.\nUna vez hecho esto , ya tienes instalado la pila LEMP para que la utilices en tus CMS.\n","date":"October 28, 2023","hero":"/images/iweb/lamp/portada_lemp.png","permalink":"https://www.javiercd.es/posts/iaw/lemp/lemp/","summary":"\u003ch1 id=\"instalación-pila-lemp-en-debian-12-con-php-8\"\u003eInstalación pila LEMP en debian 12 con PHP-8\u003c/h1\u003e\n\u003cp\u003eEn esta guía, te explicare los pasos necesarios para instalar una pila LEMP (Linux, Nginx, MariaDB y PHP) en un servidor con Debian 12. La configuración incluirá PHP 8.2 como versión principal. La pila LEMP es esencial para alojar sitios web y aplicaciones web basadas en PHP, como WordPress u otras aplicaciones dinámicas. Sigue los pasos detallados a continuación para configurar tu servidor LEMP con PHP 8.2.\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian","LEMP"],"title":"Instalación pila LEMP en debian 12 con PHP-8"},{"categories":null,"contents":"Instalación WordPress en Debian 12 con pila LAMP PHP-8 WordPress es un sistema de gestión de contenidos (CMS, por sus siglas en inglés) de código abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y diseñadores.\nPreparación Antes de empezar con la instalación de WordPress vamos a dejar claro en una lista cual es el ecosistema de nuestro servidor para que todo funcione correctamente:\nServidor LAMP completo: Apache + MySQL -o MariaDB- y PHP 8.x. Configurado un VirtualHost para nuestro dominio. Creación de base de datos con usuario. Si no tienes instalado la pila LAMP sigue puedes hacerlo en este enlace.\nCreación del VirtualHost Copiamos el archivo de configuración predeterminado de Apache y lo renombramos a wordpress.conf\njaviercruces@IWEB:/etc/apache2/sites-available$ sudo cp 000-default.conf wordpress.conf Configuramos el sitio virtual , recuerda cambiar el ServerName y DocumentRoot\n\u0026lt;VirtualHost *:80\u0026gt; # The ServerName directive sets the request scheme, hostname and port that # the server uses to identify itself. This is used when creating # redirection URLs. In the context of virtual hosts, the ServerName # specifies what hostname must appear in the request\u0026#39;s Host: header to # match this virtual host. For the default virtual host (this file) this # value is not decisive as it is used as a last resort host regardless. # However, you must set it for any further virtual host explicitly. ServerName wordpress.fjcd.es ServerAdmin webmaster@localhost DocumentRoot /var/www/wordpress # Available loglevels: trace8, ..., trace1, debug, info, notice, warn, # error, crit, alert, emerg. # It is also possible to configure the loglevel for particular # modules, e.g. #LogLevel info ssl:warn ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined # For most configuration files from conf-available/, which are # enabled or disabled at a global level, it is possible to # include a line for only one particular virtual host. For example the # following line enables the CGI configuration for this host only # after it has been globally disabled with \u0026#34;a2disconf\u0026#34;. #Include conf-available/serve-cgi-bin.conf \u0026lt;/VirtualHost\u0026gt; Habilitamos el sitio virtual wordpress.conf\njaviercruces@IWEB:/etc/apache2/sites-available$ sudo a2ensite wordpress.conf Enabling site wordpress. To activate the new configuration, you need to run: systemctl reload apache2 Recargamos Apache para aplicar la nueva configuración\njaviercruces@IWEB:/etc/apache2/sites-available$ sudo systemctl reload apache2 Para acceder a este VirtualHost , en la maquina donde vayas a acceder al wordpress , al no tener servidor dns recuerda poner en el fichero host la ip de tu servidor con el ServerName :\njaviercruces@HPOMEN15:~$ cat /etc/hosts #Añade la IP de tu servidor y el ServerName correspondiente (wordpress.fjcd.es) #Ponlo al final del fichero y no modifiques las lineas existentes en tu fichero 192.168.125.27 wordpress.fjcd.es Creación de la base de datos con un usuario. Te recomiendo que apuntes los datos introducidos a continuación ya que los necesitaras mas adelante . Nos conectamos a la base de datos :\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 31 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. #Creamos una base de datos : MariaDB [(none)]\u0026gt; CREATE DATABASE fjcd_wordpress; Query OK, 1 row affected (0,001 sec) #Nos creamos el usuario para nuestra base de datos MariaDB [(none)]\u0026gt; CREATE USER \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;tu_contraseña\u0026#39;; Query OK, 0 rows affected (0,013 sec) #Le damos permisos sobre la base de datos que hemos creado: MariaDB [(none)]\u0026gt; GRANT ALL PRIVILEGES ON fjcd_wordpress.* TO \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39;; Query OK, 0 rows affected (0,010 sec) #Actualizamos los permisos: MariaDB [(none)]\u0026gt; FLUSH PRIVILEGES; Query OK, 0 rows affected (0,000 sec) #Nos salimos de la CLI de mysql MariaDB [(none)]\u0026gt; EXIT; Bye Instalación de WordPress Lo primero que haremos será descargarnos WordPress, podemos hacerlo usando wget o si lo tenemos descargado en nuestro anfitrión pasarlo haciendo uso de SCP o FTP .\njaviercruces@IWEB:~$ wget https://wordpress.org/latest.tar.gz --2023-10-27 12:33:17-- https://wordpress.org/latest.tar.gz Resolviendo wordpress.org (wordpress.org)... 198.143.164.252 Conectando con wordpress.org (wordpress.org)[198.143.164.252]:443... conectado. Petición HTTP enviada, esperando respuesta... 200 OK Longitud: 23465047 (22M) [application/octet-stream] Grabando a: «latest.tar.gz» latest.tar.gz 100%[=====================================\u0026gt;] 22,38M 14,8MB/s en 1,5s 2023-10-27 12:33:19 (14,8 MB/s) - «latest.tar.gz» guardado [23465047/23465047] Y descomprimiremos el fichero y copiaremos los ficheros dentro del DocumentRoot de nuestro VirtualHost:\njaviercruces@IWEB:~$ sudo mkdir /var/www/wordpress/ javiercruces@IWEB:~$ sudo tar -zxf latest.tar.gz -C /var/www/ Entramos a la ruta del WordPress para realizar poner correctamente el esquema de permisos :\njaviercruces@IWEB:~$ cd /var/www/ Cambiamos usuario y grupos:\njaviercruces@IWEB:/var/www$ sudo chown -R www-data:www-data wordpress/ Y ponemos los permisos correctos a WordPress:\nfind . -type d -exec chmod 755 {} \\; find . -type f -exec chmod 644 {} \\; Una vez hemos configurado todo esto, ahora ya podemos acceder con nuestro navegador a nuestro dominio para iniciar la instalación de WordPress.\nInstalación Web Accedemos a la url que hemos puesto en el ServerName de nuestro sitio virtual y posteriormente hemos configurado en el fichero hosts .\nLo primero sera seleccionar el idioma :\nA continuación nos dará una breve explicación de que es el CMS WordPress :\nAhora deberás de introducir los datos referente a los usuarios y el nombre de la base de datos que has creado con anterioridad\nUna vez introducidos los datos correctos continuaremos con la instalación :\nAhora deberás de introducir los datos para tu wordpress , como el nombre del sitio asi como la creación de un usuario administrador para que posteriormente puedas acceder a wp-admin:\nListo !! Ya has instalado wordpress\nAhora para acceder al panel de administración de wordpress deberás de introducir la siguiente url en tu navegador e inicia sesión con el usuario que has creado:\nListo !! Asi se ve el panel de administración de wordpress:\n","date":"October 28, 2023","hero":"/images/iweb/wordpress/wordpress_lamp.png","permalink":"https://www.javiercd.es/posts/iaw/wordpress/instalacion_wordpress/","summary":"\u003ch1 id=\"instalación-wordpress-en-debian-12-con-pila-lamp-php-8\"\u003eInstalación WordPress en Debian 12 con pila LAMP PHP-8\u003c/h1\u003e\n\u003cp\u003eWordPress es un sistema de gestión de contenidos (CMS, por sus siglas en inglés) de código abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y diseñadores.\u003c/p\u003e\n\u003ch2 id=\"preparación\"\u003ePreparación\u003c/h2\u003e\n\u003cp\u003eAntes de empezar con la instalación de WordPress vamos a dejar claro en una lista cual es el ecosistema de nuestro servidor para que todo funcione correctamente:\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian"],"title":"Instalación WordPress en Debian 12 con pila LAMP PHP-8"},{"categories":null,"contents":"Instalación WordPress en Debian 12 con pila LEMP PHP-8 WordPress es un sistema de gestión de contenidos (CMS, por sus siglas en inglés) de código abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y diseñadores.\nRequisitos previos Servidor con Linux: Debes disponer de un servidor que ejecute Linux , la guía esta pensada para Debian 12 . Usuario con permisos de superusuario: Debes tener acceso a un usuario con privilegios sudo en el servidor para poder llevar a cabo las tareas de instalación y configuración. Nombre de Dominio Completo (FQDN): Si deseas acceder a tu sitio WordPress a través de un dominio personalizado, asegúrate de tener configurado y apuntando un nombre de dominio completo (FQDN) al servidor. Acceso a Internet: Necesitas acceso a Internet para descargar paquetes y realizar actualizaciones durante el proceso de instalación. Asegúrate de cumplir con todos estos requisitos antes de comenzar con la instalación de WordPress en tu servidor .\nSi no tienes instalado la pila LEMP sigue puedes hacerlo en este enlace.\nCreación de un VirtualHost en Nginx La creación de un VirtualHost en Nginx te permite configurar múltiples sitios web en un único servidor. Sigue estos pasos para crear un VirtualHost en Nginx.\nCopia el archivo de configuración por defecto de Nginx para usarlo como ejemplo y nómbralo como quieras. En este ejemplo, lo nombraremos \u0026ldquo;wordpress\u0026rdquo; , ya que vamos a instalarlo sin embargo el nombre es meramente informativo.\njaviercruces@IWEB:~$ sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/wordpress Vamos a editar el contenido del mismo , para ello :\njaviercruces@IWEB:~$ sudo nano /etc/nginx/sites-available/wordpress Aquí te dejo el ejemplo del fichero de configuración de mi sitio , asegúrate de definir el nombre del servidor (tu dominio) y el directorio raíz del sitio.\nserver { listen 80; root /var/www/wordpress; # Cambia esta linea por la ubicación del directorio root de tu wordpress index index.php index.html index.htm; server_name wordpress.fjcd.es; # Cambia esta linea y pon el FQDN , a traves de este accederás a tu wordpress client_max_body_size 500M; location / { try_files $uri $uri/ /index.php?$args; } location = /favicon.ico { log_not_found off; access_log off; } location ~* \\.(js|css|png|jpg|jpeg|gif|ico)$ { expires max; log_not_found off; } location = /robots.txt { allow all; log_not_found off; access_log off; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } Para hacer esta configuración activa vamos a crear un enlace simbólico\njaviercruces@IWEB:~$ sudo ln -s /etc/nginx/sites-available/wordpress /etc/nginx/sites-enabled/ Ahora vamos a reiniciar nginx , para que se apliquen los cambios :\njaviercruces@IWEB:~$ sudo systemctl reload nginx Para acceder a este VirtualHost , en la maquina donde vayas a acceder al wordpress , al no tener servidor dns recuerda poner en el fichero host la ip de tu servidor con el ServerName :\njaviercruces@HPOMEN15:~$ cat /etc/hosts #Añade la IP de tu servidor y el ServerName correspondiente (wordpress.fjcd.es) #Ponlo al final del fichero y no modifiques las lineas existentes en tu fichero 192.168.125.27 wordpress.fjcd.es Creación de la base de datos con un usuario. Te recomiendo que apuntes los datos introducidos a continuación ya que los necesitaras mas adelante . Nos conectamos a la base de datos :\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 31 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. #Creamos una base de datos : MariaDB [(none)]\u0026gt; CREATE DATABASE fjcd_wordpress; Query OK, 1 row affected (0,001 sec) #Nos creamos el usuario para nuestra base de datos MariaDB [(none)]\u0026gt; CREATE USER \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;tu_contraseña\u0026#39;; Query OK, 0 rows affected (0,013 sec) #Le damos permisos sobre la base de datos que hemos creado: MariaDB [(none)]\u0026gt; GRANT ALL PRIVILEGES ON fjcd_wordpress.* TO \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39;; Query OK, 0 rows affected (0,010 sec) #Actualizamos los permisos: MariaDB [(none)]\u0026gt; FLUSH PRIVILEGES; Query OK, 0 rows affected (0,000 sec) #Nos salimos de la CLI de mysql MariaDB [(none)]\u0026gt; EXIT; Bye Instalación de WordPress Lo primero que haremos será descargarnos WordPress, podemos hacerlo usando wget o si lo tenemos descargado en nuestro anfitrión pasarlo haciendo uso de SCP o FTP .\njaviercruces@IWEB:~$ wget https://wordpress.org/latest.tar.gz --2023-10-27 12:33:17-- https://wordpress.org/latest.tar.gz Resolviendo wordpress.org (wordpress.org)... 198.143.164.252 Conectando con wordpress.org (wordpress.org)[198.143.164.252]:443... conectado. Petición HTTP enviada, esperando respuesta... 200 OK Longitud: 23465047 (22M) [application/octet-stream] Grabando a: «latest.tar.gz» latest.tar.gz 100%[=====================================\u0026gt;] 22,38M 14,8MB/s en 1,5s 2023-10-27 12:33:19 (14,8 MB/s) - «latest.tar.gz» guardado [23465047/23465047] Y descomprimiremos el fichero y copiaremos los ficheros dentro del DocumentRoot de nuestro VirtualHost:\njaviercruces@IWEB:~$ sudo mkdir /var/www/wordpress/ javiercruces@IWEB:~$ sudo tar -zxf latest.tar.gz -C /var/www/ Entramos a la ruta del WordPress para realizar poner correctamente el esquema de permisos :\njaviercruces@IWEB:~$ cd /var/www/ Cambiamos usuario y grupos:\njaviercruces@IWEB:/var/www$ sudo chown -R www-data:www-data wordpress/ Una vez hemos configurado todo esto, ahora ya podemos acceder con nuestro navegador a nuestro dominio para iniciar la instalación de WordPress.\nInstalación Web Accedemos a la url que hemos puesto en el ServerName de nuestro sitio virtual y posteriormente hemos configurado en el fichero hosts .\nLo primero sera seleccionar el idioma :\nA continuación nos dará una breve explicación de que es el CMS WordPress :\nAhora deberás de introducir los datos referente a los usuarios y el nombre de la base de datos que has creado con anterioridad\nUna vez introducidos los datos correctos continuaremos con la instalación :\nAhora deberás de introducir los datos para tu wordpress , como el nombre del sitio asi como la creación de un usuario administrador para que posteriormente puedas acceder a wp-admin:\nListo !! Ya has instalado wordpress\nAhora para acceder al panel de administración de wordpress deberás de introducir la siguiente url en tu navegador e inicia sesión con el usuario que has creado:\nListo !! Asi se ve el panel de administración de wordpress:\n","date":"October 28, 2023","hero":"/images/iweb/wordpress/wordpress_lemp.png","permalink":"https://www.javiercd.es/posts/iaw/wordpress_lemp/instalacion_wordpress_lemp/","summary":"\u003ch1 id=\"instalación-wordpress-en-debian-12-con-pila-lemp-php-8\"\u003eInstalación WordPress en Debian 12 con pila LEMP PHP-8\u003c/h1\u003e\n\u003cp\u003eWordPress es un sistema de gestión de contenidos (CMS, por sus siglas en inglés) de código abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y diseñadores.\u003c/p\u003e\n\u003ch2 id=\"requisitos-previos\"\u003eRequisitos previos\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eServidor con Linux:\u003c/strong\u003e Debes disponer de un servidor que ejecute Linux , la guía esta pensada para Debian 12 .\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eUsuario con permisos de superusuario:\u003c/strong\u003e Debes tener acceso a un usuario con privilegios sudo en el servidor para poder llevar a cabo las tareas de instalación y configuración.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eNombre de Dominio Completo (FQDN):\u003c/strong\u003e Si deseas acceder a tu sitio WordPress a través de un dominio personalizado, asegúrate de tener configurado y apuntando un nombre de dominio completo (FQDN) al servidor.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAcceso a Internet:\u003c/strong\u003e Necesitas acceso a Internet para descargar paquetes y realizar actualizaciones durante el proceso de instalación.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eAsegúrate de cumplir con todos estos requisitos antes de comenzar con la instalación de WordPress en tu servidor .\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian"],"title":"Instalación WordPress en Debian 12 con pila LEMP PHP-8"},{"categories":null,"contents":"A lo largo de esta guía, exploraremos la configuración de un escenario básico utilizando redes IPv6 tanto en sistemas Linux como en dispositivos Cisco. Además, abordaremos la configuración de un servidor Apache aprovechando las capacidades de IPv6.\nLinux Autoconfiguración IPV6 Conecta dos máquinas Linux al mismo switch y comprueba que tienen conectividad con IPv6 usando la dirección de enlace local.\nComprobaremos las IPV6 que tienen los distintos pcs . El PC1 tiene –\u0026gt; fe80::ef7:42ff:fe92:0/64\nMientras que el PC2 tiene –\u0026gt; fe80::e5f:61ff:feee:0/64\nEstas dos direcciones se denominan de enlace local y se asignan automáticamente a cada interfaz de red . Este tipo solo nos permitirá comunicarnos con los dispositivos de nuestra red local y tienen el prefijo –\u0026gt; FE80::/10\nSi hacemos un ping desde uno de estos a otros con la dirección de enlace local podremos comunicarnos :\nSLAAC Añade a la misma red una tercera máquina Linux y configúrala como router de forma que dé direcciones IPv6 globales a las otras dos usando SLAAC. No olvides instalar RADVD. Comprueba que tienen conectividad.\nLo primero que haremos sera configurar la interfaz de red por ipv6 de nuestro router en este caso le asignare el prefijo 3333:db7::\nCalculamos la parte fija de nuestra dirección :\nR1 –\u0026gt; 0c:01:30:a0:00:00 –\u0026gt; 0c:01:30:ff:fe:a0:00:00 –\u0026gt; 0E:01:30:FF:FE:A0:00:00\nEditamos el interfaces y aplicamos la configuración de nuestra tarjeta de red :\nReiniciamos al servicio y tendríamos una direccion global :\nSLAAC(Stateless Address Autoconfiuration) es un mecanismo de configuración único para IPV6 no existe un equivalente en IPV4. El cual nos permite que los nodos de nuestra red se configuren automáticamente .\nA partir de la dirección de enlace local que tienen todos los host , mediante el protocolo neighbour discovery solicita si hay algún router dentro de la red local le facilite los parámetros de configuración de la red\nLo primero que haremos para configurar SLAAC sera instalar el paquete radvd :\nSi miramos el estado del demonio este nos dirá que no encuentra su fichero de configuración :\nAsí que le generaremos uno indicándole la interfaz que va a repartir direcciones y además le diremos el comportamiento que tendrá en nuestra red :\nMinRtrAdvInterval : Indica el tiempo mínimo en segundos por el cual el router mandara un mensaje en segundos .\nMaxRtrAdvInterval: Indica el tiempo máximo en segundo por el cual el router mandara un mensaje .\nAdvSendAdvert: Indica si por la interfaz se mandaran avisos o no .\nAdvManagedFlag: Indica si queremos que el servicio utilice DHCPv6(on) o no (off) .\nPrefix: Indica el prefijo de red que usara SLAAC para asignar direcciones .\nAdvValidLifetime: Indica el tiempo en segundos que una dirección IPV6 sera valida.\nAdvPreferredLifetime: Indica el tiempo en segundos que una dirección generada a partir del prefijo sera preferida en lugar de otras direcciones .\nUna vez hecho esto reiniciamos el servicio y el demonio comenzara a configurar a nuestros clientes :\nAdemás deberemos de configurar el bit de forwarding para ipv6 en nuestro router , al igual que con ipv4 editamos el archivo /etc/sysctl.conf :\nMensajes de SLAAC Podemos ver como se ha configurado el PC1 usando SLAAC :\nTambién el PC2 se ha configurado :\nVamos a estudiar los mensajes que han intervenido en esta configuración de SLAAC , si los numeramos como en esta captura de Wireshark :\nRouter solicitation (RS) (No aparece en la captura) : El PC le envía un mensaje de RS a todos los routers para indicar que necesita un RA , este mensaje se envía si no recibe ningún RA pasado un tiempo. Router Advertisement (RA): Una vez el router recibe el RS o periódicamente envía un RA en el cual se incluye el prefijo de la red y su longitud . El mensaje RA se envía a la dirección IPv6 de multidifusión de todos los nodos, FF02::1, con la dirección link-local del router como la dirección IPv6 de origen. (N0 6 y 12). Multicast Listener Report Message v2:Indica que el dispositivo x ha iniciado una sesión de escucha para trafico multicast (No 7 y 9). Neighbor Solicitation (NS): Se utiliza para conocer la dirección MAC de un dispositivo de tu red , es similar al protocolo ARP .(No 10,11,613). Neighbor Advertisement (NA) : Es el mensaje de respuesta de un NS (No 614). Una vez que el cliente a recibido un RA , este procede a configurar su dirección IPV6 , con un prefijo de red de 64 bits pero necesita una IID(Interface Identifier) .\nHay dos maneras en las que los clientes pueden crear su propia IID única:\nEUI-64: mediante el proceso EUI-64, la PC1 crea una IID utilizando su dirección MAC de 48 bits. De generación aleatoria: la IID de 64 bits puede ser un número aleatorio generado por el sistema operativo cliente. Dado que SLAAC es un proceso sin estado, para que los clientes pueda utilizar esta dirección IPv6 creada recientemente, debe verificar que sea única. El cliente enviara un NS con su propia dirección como la dirección IPv6 de destino. Si ningún otro dispositivo responde con un mensaje de anuncio de vecino, la dirección es única y puede ser utilizada por el cliente. Si este recibe un NA, la dirección no es única, y el sistema operativo debe determinar una nueva ID de interfaz para utilizar.\nEste proceso forma parte de la detección de vecinos ICMPv6 y se conoce como “detección de direcciones duplicadas (DAD)”.\nEsta imagen explica la configuración de una interfaz por SLAAC. Ahora vamos a comprobar que los distintos clientes tienen conectividad entre si :\nPC1 –\u0026gt; 3333:db7::ef7:42ff:fe92:0 PC2 –\u0026gt; 3333:db7::e5f:61ff:feee:0\nR1 –\u0026gt; 3333:db7::e01:30ff:fea0:0\nRouter 1 :\nPC2:\nTenemos que tener en cuenta que estas “concesiones” de direcciones no se almacenan en ningún sitio , es decir en el servidor no almacenamos las configuraciones que ha realizado el servicio .\nDHCPv6 con SLAAC Cambia la configuración para que utilice DHCPv6 en vez de SLAAC enviando también los servidores DNS. Comprueba que las máquinas tienen conectividad.\nPara ello nos instalamos el servidor DHCPv6 , el paquete es el mismo para ipv4 :\nEditamos el fichero de configuración para IPV6 –\u0026gt; sudo nano /etc/dhcp/dhcpd6.conf:\nEn el fichero /etc/default/isc-dhcp-server indicaremos no solo la interfaz que queremos repartir direcciones si no también especificaremos que el servidor funcionara por IPV6 :\nReiniciamos el servicio y comprobamos que esta funcionando con los parámetros que le hemos asignado en la configuraron :\nVamos a comprobar que los clientes se configuraran usando ipv6 , para ello la configuración en el network interfaces es bastante similar a IPV4 :\nReiniciamos el servicio networking.service y obtendremos la configuración por DHCP en la tarjeta :\nAdemás también podemos ver las concesiones el fichero de concesiones , en el servidor en la siguiente ruta /var/lib/dhcp/dhcpd6.leases :\nNo lo he mencionado anteriormente pero para que al producirse la configuración el cliente obtenga los parámetros que hemos configurado por DHCPv6 tendremos que poner este parámetro a ON en el fichero de configuración de SLAAC :\nComo podemos ver el único parámetro que hemos especificado en el servidor DHCP a sido el DNS de google ha sido correctamente configurado en nuestro cliente :\nMensajes DHCPv6 con SLAAC Acabamos de configurar SLAAC y DHCPv6 sin estado , esto significa que :\nUsa SLAAC para obtener una dirección IPV6 de tipo global unicast , además de la puerta de enlace . Usa el servidor DHCPv6 sin estado, para el resto de parámetros de configuración de nuestra red . Es decir hemos configurado la segunda opción de la siguiente imagen :\nLas capturas que verás a continuación NO están recortadas debido a que se ven pixeladas. Los mensajes de la comunicación están en orden. Si observamos la captura de Wireshark y la comparamos con la configuración única de SLAAC :\nOperaciones de SLAAC:\nPodemos ver que el PC1 a solicitado un RS , a todos los routers de la red (Multicast) R1 le responde a PC1 con un RA(Indica si necesitara comunicarse con un DHCPv6 con estado o sin estado) NS , para comprobar que la dirección asignada no esta duplicada Operaciones de DHCPv6:\nSolicit a todos los servidores DHCPv6 de la red (Multicast a ff02::1:2) incluye un identificador de cliente CID. Advertise : Es la respuesta del servidor DHCPv6 a un solicit , este incluye las opciones de configuración oportunos , incluido una IPv6 . También incluye un CID y un XID(Id transacción). Request: El cliente envía este mensaje a todos los servidores DHCPv6 para indicar que desea los parámetros ofertados en el Adverstise . También incluyen CID y XID. Reply: El servidor DHCPv6 responde y confirma que la dirección ha sido asignada así como todos los parámetros adicionales de configuración .También incluyen CID y XID. Aquí te dejo una imagen en la que se observa el orden de los mensajes que hemos recibido y una breve descripción del mismo , además nos indica si los mensajes son unicast o multicast :\nApache en IPV6 Para las versiones de Apache superiores a 2.X tienen soporte para IPV6 habilitado por defecto así que al instalar el servicio ya estaremos escuchando por este protocolo sin necesidad de realizar ninguna configuración adicional en el servicio .\nPodemos comprobar si al instalarlo nuestro servidor esta escuchando por ese puerto :\nEn el caso de que creemos un virtualhost podemos especificar como queremos que trabajen si usando ambos protocolos IPV6 y IPV4 o solo uno de ellos . Vemos que ssh también utiliza ipv6 por defecto .\nAcceso al servidor web desde dentro de la red Vamos a acceder desde las maquinas de nuestra red en mi caso lo he montado en el router ya que es el único que tiene acceso a internet en este escenario .\nMe conectare a el utilizando la direccion global pero podríamos usar la local sin problema ya que pertenecemos a la misma red local .\nAcceso desde PC2:\nAcceso al servidor web desde fuera de la red Para esto deberemos de configurar R1 y ‘PC3’ en la misma red usando IPV6 :\nPC3:\nR1:\nLe haremos la petición a PC1 desde PC3 que esta fuera de esa red local , como vemos no es necesario hacer NAT .\nIncluso puedo hacerle ping a un host desde otra red :\nSi analizamos estas peticiones con Wireshark podemos ver que en ningún momento se produce NAT:\nFuera de la red :\nDentro de la red:\nPor supuesto un host de nuestra red local puede acceder al servidor web :\nCISCO Configuración de un router cisco en IPV6 Lo primero que haremos sera calcular la direccion IPV6 que le corresponden a las MACS :\nF 0/0 –\u0026gt; CA:01:6C:FA:00:00 –\u0026gt; CA:01:6C:FF:FE:FA:00:00 –\u0026gt; C801:6CFF:FEFA:0\nF 1/0 –\u0026gt; CA:01:6C:FA:00:1C-→ CA:01:6C:FF:FE:FA:00:1C –\u0026gt; C801:6CFF:FEFA:001C\nPara que nuestro router se configure usando SLACC y no tengamos que hacer esto manualmente introduciremos los siguientes comandos para cada una de las interfaces que queramos que se configuren por SLAAC :\nTambién deberemos de indicarle no shut para que se levante la interfaz .\nCon el siguiente comando comprobaremos que nuestro router se ha configurado correctamente automáticamente usando SLAAC :\nYa con las direcciones de enlace local tendremos conectividad con el router :\nSLAAC Ahora vamos a hacer que el router configure a los clientes usando SLAAC .\nVamos a configurar una dirección global a nuestro router en la interfaz que da a la red que queremos darle este servicio , con el prefijo de red : 3333:db7::\nVamos a utilizar EUI-64 para configurar nuestras interfaces :\nFastEthernet 0/0 –\u0026gt; 3333::C801:6CFF:FEFA:0/64\nFastEthernet 1/0 –\u0026gt; 2222::C801:6CFF:FEFA:1C/64\nComprobamos las direcciones IPV6 se han “generado” correctamente :\nPara que el router nos configure a los clientes deberemos de introducir el siguiente comando este , hará que nuestro router mande RA y conteste a las peticiones de RS:\nUna vez hecho esto nuestros clientes se habrán configurado correctamente :\nPC1:\nPC2:\nLos mensajes que se han producido al configurar los clientes :\nRouter solicitation (RS): El PC le envía un mensaje de RS a todos los routers para indicar que necesita un RA , este mensaje se envía si no recibe ningún RA pasado un tiempo.\nRouter Advertisement (RA): Una vez el router recibe el RS o periódicamente envía un RA en el cual se incluye el prefijo de la red y su longitud . En el caso de que el router responda a un RS este le envía un RA especifico al host que lo ha solicitado . En el caso de que sea un mensaje RA periódico se envía a la dirección IPv6 de multidifusión de todos los nodos, FF02::1, con la dirección link-local del router como la dirección IPv6 de origen.\nNeighbor Solicitation (NS): Se utiliza para conocer la direccion MAC de un dispositivo de tu red , es similar al protocolo ARP .\nNeighbor Advertisement (NA) : Es el mensaje de respuesta de un NS .\nDHCPv6 con SLAAC Configurar un servidor de DHCPv6 con estado es similar a configurar un servidor sin estado. La diferencia más importante es que un servidor con estado también incluye información de direccionamiento IPv6 de manera similar a un servidor DHCPv4.\nLo primero que tendremos que hacer sera para habilitar el routing IPv6. Este comando no es necesario para que el router sea un servidor de DHCPv6 con estado, pero se requiere para que el router origine los mensajes RA ICMPv6.\n–\u0026gt; ipv6 unicast-routing\nLo tenemos configurado en el apartado anterior así que no lo volveremos a hacer . Configuraremos un pool DHCPV6 :\nCon DHCPv6 con estado, todos los parámetros de direccionamiento y otros parámetros de configuración deben ser asignados por el servidor de DHCPv6. El comando address prefix se utiliza para indicar el conjunto de direcciones que debe asignar el servidor. La opción lifetime indica el tiempo de arrendamiento válido y preferido en segundos. Al igual que con DHCPv6 sin estado, el cliente utiliza la dirección IPv6 de origen del paquete que contenía el mensaje RA.\nLe indicamos el prefijo de red y el tiempo de vida de cada dirección :\nAhora le indicamos los servidores DNS :\nAun podemos configurar mas parámetros como el nombre del dominio pero en mi caso solo me interesa esto , así que procederemos a indicarle en que interfaz tiene que funcionar el servicio :\nAhora comprobaremos que el servidor DHCP , esta funcionado en nuestra interfaz :\nVeremos como en el cliente se ha asignado el servido DNS:\nY la concesión en el servidor DHCP :\nOperaciones de SLAAC:\nPodemos ver que el PC2 a solicitado un RS , a todos los routers de la red (Multicast) R1 le responde a PC1 con un RA(Indica si necesitara comunicarse con un DHCPv6 con estado o sin estado) Operaciones de DHCPv6:\nSolicit a todos los servidores DHCPv6 de la red (Multicast a ff02::1:2) incluye un identificador de cliente CID. Advertise : Es la respuesta del servidor DHCPv6 a un solicit , este incluye las opciones de configuración oportunos , incluido una IPv6 . También incluye un CID y un XID(Id transacción). Request: El cliente envía este mensaje a todos los servidores DHCPv6 para indicar que desea los parámetros ofertados en el Adverstise . También incluyen CID y XID. Reply: El servidor DHCPv6 responde y confirma que la dirección ha sido asignada así como todos los parámetros adicionales de configuración .También incluyen CID y XID. Acceso al servidor web desde dentro de la red Desde nuestra red local podremos hacer la petición al servidor web usando tanto la dirección local de enlace como la dirección global :\nAcceso al servidor web desde fuera de la red SWEB –\u0026gt; 3333:db7::ef7:42ff:fe92:0\nVemos que con la configuración anterior que teníamos en apache podemos acceder sin problema al servidor web desde una maquina de fuera de nuestra red :\nConfiguración básica de apache para IPV6 Como comentaba antes no es necesario a partir de la version 2.X en adelante de configurar nada adicionalmente en apache para que nuestro servidor funcione usando el protocolo IPV6 ya por defecto este escucha en IPV4 y IPV6 .\nSin embargo podemos configurar para que este solo escuche por IPV6 , para ello deberemos de realizar una simple configuración en el servicio . Accederemos al fichero –\u0026gt; /etc/apache2/ports.conf\nComentaremos la linea Listen 80 ya que hace referencia a IPV4 y le añadiremos la referente a ipv6.\nCon esta configuración escucharemos todas las peticiones de cualquier dirección IPV6 , en los corchetes podemos especificar una dirección para responderle peticiones solo a esta .\nAhora accederemos a nuestro host virtual y cambiaremos la declaración de este , al igual que hemos hecho arriba modificando la etiqueta que hace referencia a todas las direcciones IPV4 y la cambiaremos por esta para hacer referencia a todas las direcciones IPV6 por el puerto 80 :\nAhora reiniciaremos el servicio apache y comprobaremos que el estado del mismo es exitoso :\nCon esto ya nuestro servidor apache funcionaria solo en IPV6 :\nBibliografía ¿Que es SLAAC?-Alberto Molina Mensajes de SLAAC Montar un servidor DHCPv6 Debian Mensajes DHCPv6 con SLAAC Apache IPV6 ","date":"October 8, 2023","hero":"/images/redes/escenario_ipv6_basico/portada.png","permalink":"https://www.javiercd.es/posts/redes/escenario_ipv6_basico/escenario_ipv6_basico/","summary":"\u003cp\u003eA lo largo de esta guía, exploraremos la configuración de un escenario básico utilizando redes IPv6 tanto en sistemas Linux como en dispositivos Cisco. Además, abordaremos la configuración de un servidor Apache aprovechando las capacidades de IPv6.\u003c/p\u003e\n\u003ch2 id=\"linux-autoconfiguración-ipv6\"\u003eLinux Autoconfiguración IPV6\u003c/h2\u003e\n\u003cp\u003eConecta dos máquinas Linux al mismo switch y comprueba que tienen conectividad con IPv6 usando la dirección de enlace local.\u003c/p\u003e\n\u003cp\u003eComprobaremos las IPV6 que tienen los distintos pcs . El PC1 tiene –\u0026gt; fe80::ef7:42ff:fe92:0/64\u003c/p\u003e","tags":["Redes","Enrutamiento","IPV6"],"title":"Escenario IPv6 Básico"},{"categories":null,"contents":"En este post, exploraremos cómo configurar un entorno de Active Directory en un servidor Ubuntu utilizando herramientas como Kerberos y Samba. Active Directory es una solución integral de Microsoft para la gestión de identidades y el control de acceso en redes empresariales. A través de esta guía, aprenderemos paso a paso cómo implementar un servidor Ubuntu como controlador de dominio, establecer la autenticación basada en Kerberos y configurar servicios de directorio mediante Samba.\nIntroducción Se quiere configurar un servidor Linux (Ubuntu Server 20.04 LTS) para dar servicio a un conjunto de equipos clientes (Windows y Linux).\nAprovecharé que el escenario lo tenemos montado de las anteriores actividades de clase y restauraré las instantáneas para disponer de las máquinas limpias .\nPreparación del entorno 1. El servidor Linux no tendrá entorno gráfico. Tendrá al menos las particiones: raiz, home y de intercambio. Aquí podemos ver que no tengo instalado entorno gráfico , podemos ver que el servicio está activo, sin embargo, no se lanza ningún entorno . Además, si buscamos algún proceso con los nombres de escritorio más conocidos no nos lanza ningún resultado .\nAquí te muestro las particiones que tiene mi servidor Ubuntu (raíz , boot , home y swap):\n2.El servidor debe estar preparado para que pueda administrarse de forma remota (a partir de este momento toda la gestión se hará remotamente desde otro equipo de la red). Para administrarlo de forma remota utilizaré ssh, para ello lo instalamos en el servidor :\nUna vez que se instale lo tendremos funcionando , no es necesario realizar ninguna configuración .\nSi consultamos el estado del servicio podemos ver que ha tomado la configuración por defecto :\nPara conectarnos remotamente necesitaremos saber la IP del equipo o el nombre :\nEn mi caso me conectaré desde la red externa a nuestro servidor (enp0s3) , previamente hemos configurado la red con netplan :\nY hemos aplicado los cambios :\nUna vez conociendo estos datos nos conectaremos por ssh desde una máquina de nuestra red para seguir con los demás apartados, en mi caso utilizaré mi máquina host, para ello me he instalado el paquete openssh-client previamente:\n3. Crea los usuarios y grupos siguientes Grupos: profesores, alumnos, smr, asir. Creo los grupos : Usuario a crear : profedesiree, profejose , proferaul , erik, manu, oliver, sandra, fabio y domi Creo los usuarios :\nLos he creado con directorio home y les he asignado la contraseña 1234:\nUsuarios del grupo profesores: profedesiree, profejose y proferaul. Los añadimos : Podemos comprobar que se han añadido con el siguiente comando :\nUsuarios del grupo alumnos: erik, manu, oliver, sandra, fabio y domi. Los añadimos :\nComprobamos que se han añadido :\nUsuarios del grupo smr: profedesiree, profejose, proferaul, erik, manu y oliver. Los añadimos:\nComprobamos que se han añadido :\nUsuarios del grupo asir: sandra, fabio y domi. Comprobamos que se han añadido :\n4. Todos los usuarios serán usuarios Samba. Para ello deberemos tener instalado samba : Para añadir un usuario samba debemos de introducir el siguiente comando y asignarle una contraseña :\nEsto lo haremos con los 9 usuarios , una vez añadidos podemos utilizar este comando para listar los usuarios samba que tenemos :\nControlador de dominio samba 5. Crea y configura un controlador de dominio Samba en el Servidor. Antes de comenzar con la instalación debemos de tener en cuenta una serie de datos :\nNombre del controlador de dominio de Active Directory: FJCD\nNombre DNS del dominio de Active Directory: javiercruces.local Nombre del Reino Kerberos: javiercruces.local Nombre NetBIOS del dominio: javiercruces Dirección IP fija del servidor: 192.168.0.1 Rol del servidor: Domain Controller (DC) Reenviador DNS:192.168.0.1 Una vez con estos datos claros comenzaremos con la instalación , lo primero será actualizar el sistema :\nA continuación deberemos de cambiar el nombre de nuestro servidor para estar acorde con los datos que hemos seleccionado anteriormente, para ello yo he seleccionado mis iniciales , para ello editamos el fichero /etc/hostname :\nAhora será necesario que reiniciemos el equipo para que se apliquen los cambios , perderemos la conexión por ssh :\nRetomamos el control remoto por ssh en unos minutos cuando haya reiniciado :\nComo puedes observar nos hemos conectado usando el antiguo nombre que tenia nuestro servidor , esto es porque el archivo /etc/hosts, contiene una relación de direcciones IP con sus correspondientes nombres lógicos. Este archivo contenía una referencia al nombre antiguo del propio servidor, que cambiaremos para que haga referencia al nuevo nombre :\nUna vez hemos aplicado estos dos cambios , antes de continuar solo nos quedara asegurarnos de que nuestro servidor tiene correctamente configurada la red . En nuestro escenario disponemos de dos tarjetas de red en nuestro servidor :\nenp0s3 (Tarjeta externa , nos da acceso a internet) enp0s8 (Tarjeta interna , es la que se comunica con nuestra red local) Debido a esto la primera está configurada por DHCP, ya que no nos importa la configuración que se le asigne , sin embargo, la segunda está configurada estáticamente, ya que debemos de controlar la configuración de la misma para que tengamos control sobre la misma y posteriormente unir los equipos al dominio .\nUna vez aclarado esto , al principio del documento indico como se configuraran las interfaces , aquí dejo un pantallazo para recordar las direcciones :\nAhora necesitaremos disponer de unos paquetes que deberán de estar instalados antes de comenzar ,estos son :\nsamba: servidor de archivos, impresión y autenticación para SMB/CIFS. smbclient: clientes de línea de comandos para SMB/CIFS. krb5-config: Archivos de configuración para Kerberos Version 5. winbind: Servicio para resolver información sobre usuarios y grupos de servidores Windows NT. Podremos hacer la instalación de estos cuatro paquetes con un simple comando :\nKerberos, nos preguntará por el reino (nombre de dominio ) durante la instalación de los paquetes, en nuestro caso será javiercruces.local :\nAquí introduciremos el nombre de nuestro equipo servidor :\nAquí volveremos a introducir el nombre de nuestro servidor :\nDespués de esto, la instalación continuará un poco más, pero sin necesitar que aportemos más información:\nAhora configuraremos samba , pero antes de hacerlo le cambiaremos el nombre al archivo de configuración smb.conf para que no lo use mientras que lo configuramos y así además tendremos una copia del archivo original :\nUsaremos el comando samba-tool domain provision, para que sea el propio comando sea el que nos solicite los valores que necesite y, cuando sea posible, nos sugiera sus valores predeterminados. Así, si estos coinciden con los que nosotros esperamos, será muy probable que los pasos anteriores hayan sido los correctos:\nComo puedes observar es muy intuitivo hacerlo, ya que salvo la IP de forwarder y la contraseña de administrador hemos elegido las respuestas que el mismo comando nos ofrece . Esta debe cumplir unos requisitos de complejidad mínimos :\n8 caracteres como mínimo 1 mayúscula 1 numero o símbolo Con esto, además de configurarse Samba , se ha generado un archivo de configuración para Kerberos en la ruta /var/lib/samba/private/krb5.conf. Asi que lo copiaremos a /etc :\nLo siguiente será configurar la resolución de nombres, para ello comenzaremos deteniendo los servicios implicados :\nTambién quitaremos que se inicien automáticamente al reiniciar el equipo :\nA continuación, nos aseguraremos de que el servicio samba-ad-dc se podrá iniciar sin dificultades, evitando cualquier enmascaramiento que pueda existir:\nDespués, eliminamos el archivo resolv.conf que, en realidad, será un enlace a stub-resolv.conf. Así que lo eliminamos y creamos uno nuevo para sustiruirlo:\nAhora introducimos los valores adecuados en función de nuestro dominio , para mi caso :\nGuardamos los cambios y salimos del fichero.\nIniciaremos el servicio de samba-ad-dc y lo habilitaremos para que se inicie al reiniciar el equipo :\nComprobar la instalación Si hemos conseguido llegar hasta aquí , tenemos todas las papeletas para que nuestra instalación haya sido correcta . Pero nunca está de más hacer unas comprobaciones\nConsultar el nivel del dominio y crear un nuevo usuario Para saber nuestro nivel de dominio simplemente introducimos este comando :\nAl hacerlo, comprobamos que el nivel del dominio, y del bosque donde se encuentra, equivale a una instalación Windows Server 2008 R2\nProbaremos a crear una nueva cuenta de usuario en el dominio con el comando(deberemos de tener en cuenta la política de contraseñas):\nConfirmar que el servidor DNS funciona de forma adecuada Lo primero será comprobar el servicio LDAP sobre el protocolo TCP, para lo que escribiremos la siguiente orden:\nSi tenemos una respuesta parecida a esa, todo funciona como debe.\nA continuación, comprobaremos el registro SRV para el protocolo Kerberos sobre UDP, para lo que usamos la siguiente orden:\nLa respuesta debe ser parecida a la anterior, si es así registro SRV es correcto.\nPor último, comprobamos la resolución del nombre de nuestro servidor:\nComprobar el funcionamiento de Kerberos Para comprobar el funcionamiento podemos, por ejemplo, usar el comando smbclient para comprobar los servicios que puede obtener un determinado usuario. Para ello utilizaremos el siguiente comando :\nSi la autenticación es correcta , ya sabremos que Kerberos está haciendo su trabajo . Si queremos, incluso podemos iniciar sesión en el servidor empleando la cuenta de administrador. Para lograrlo, usaremos una sintaxis como esta:\nYa hemos verificado todo así que podemos empezar a unir clientes a nuestro dominio .\nUnir clientes al dominio 6. Integra al menos un cliente con Windows en el dominio Samba. Cliente Windows Lo primero que haremos será configurar la red de nuestro cliente :\nIP : 192.168.0.10 Mascará de subred : /24 Puerta de enlace 192.168.0.1 DNS 192.168.0.1 Ambas tarjetas (Interna del servidor y la de Windows cliente ) deberán de estar en red interna para que se comuniquen .\nUna vez configurada la tarjeta le haremos un ping al servidor para comprobar la conectividad:\nAhora accedemos a panel de control → sistema y seguridad → sistema → configuración avanzada del sistema → nombre de equipo → id de red . Seleccionamos la primera opción para unirnos al dominio\nSeleccionaremos la primera opción, ya que nuestra red tiene un dominio :\nAhora deberemos de introducir los datos del usuario administrador y el nombre de nuestro dominio :\nEl usuario administrador que se crea por defecto en samba se llama administrator\nUna vez introducido los datos nos preguntará si queremos crear una cuenta de dominio en este equipo , yo seleccionare que no :\nY para que se apliquen los cambios deberemos de reiniciar :\nUna vez reiniciado podremos iniciar sesión con los diferentes usuarios de nuestro dominio :\nPodemos ver que podemos iniciar sesión en el equipo con las cuentas de nuestro dominio:\nCliente Linux Lo primero será configurar la red, para ello le he asignado la dirección IP 192.168.0.2\nAhora deberemos añadir a nuestro servidor en el fichero hosts, una línea en la que ira la dirección IP de nuestro servidor seguido del nombre de este y el nombre completo del dominio de nuestro servidor :\nPara comprobar este cambio que hemos realizado le haremos un ping al servidor usando su nombre :\nAhora actualizaremos el equipo para poder descargar las versiones más recientes desde los repositorios :\nPara tener internet en el cliente he configurado previamente NAT en el servidor .\nUna vez actualizado el sistema instalaremos los siguientes paquetes :\nsssd (System Security Services Daemon): Administra los mecanismos de autenticación y el acceso a directorios remotos. Sustituye al clásico Winbind aportando más velocidad y estabilidad. heimdal-clients: Se trata de una implementación libre de Kerberos 5 creada con la intención de ser compatible con el protocolo Kerberos implementado por el MIT. msktutil: La utilidad que obtiene y administra los keytabs de Kerberos en un entorno de Microsoft Active Directory. Podemos hacerlo con 1 comando :\nMientras instalamos nos solicitara el nombre de nuestro servidor de active directory asi que lo introducimos :\nAhora nos preguntará el nombre del equipo que actúa como servidor en nuestro caso es :\nPor último nos preguntará por el servidor administrativo que en nuestro caso es el mismo:\nUna vez hecho esto, la instalación continuará sin que tengamos que introducir más datos.\nAhora vamos a añadir en Kerberos unos datos adicionales para asegurarnos que se comporte correctamente. Comenzaremos por cambiar el nombre del archivo de configuración, para poder volver a los parámetros originales si fuese preciso:\nAhora utilizaremos nano para editar la configuración del archivo , este estará vacío así que añadiremos lo siguiente :\nUna vez rellenado con los datos de nuestro dominio, guardamos el archivos y comprobaremos si podemos iniciarnos sesión en el dominio :\nSi la salida no nos ofrece ningún tipo de error, es porque el proceso de autenticación ha funcionado correctamente.\nProcederemos a unirnos al dominio, para ello utilizaremos el siguiente comando :\nEste comando deberemos de rellenarlo conforme a los datos de nuestro dominio , en el caso de que no nos salga ninguna salida , nos habremos unido al dominio .\nPara completar la tarea, eliminaremos los tickets de autorización de kerberos que activamos al ejecutar kinit. Para lograrlo, basta con utilizar el comando kdestroy.\nCompartir carpetas 7. Se necesitan carpetas personales en el servidor para cada usuario. También habrá una carpeta para cada grupo, a la que solo podrán acceder y escribir los miembros de cada grupo. Vamos a crear los directorios en la partición raíz para cada usuario y uno para cada grupo. Estos los crearé con el nombre del grupo o usuario:\nTenemos que tener en cuenta que los usuarios samba que hemos generado al principio del documento se han eliminado al instalar el dominio y deberemos de producirlos nuevamente.\nVamos a compartir estas carpetas a través de samba, para ello editamos el fichero /etc/samba/smb.conf :\nPara indicar que pueda acceder un grupo deberemos de poner una @ delante dele nombre del grupo :\nSolo nos quedaría asignar correctamente los permisos locales adecuados para nuestros recursos y cambiar los propietarios de las carpetas para que los usuarios puedan escribir en ellas :\nEsto sería lo correcto, pero si le asignamos los permisos 775 no podremos escribir en la carpeta, así que le asignaremos todos los permisos :\nAhora repetiremos esto con todos los directorios , primero le daré los permisos:\nY por último cambiaremos los propietarios de las carpetas y haremos a cada usuario o grupo sus respectivos dueños :\nVamos a asegurarnos de que hemos aplicado correctamente estos cambios :\nVamos a comprobar que podemos acceder a los recursos compartidos desde el usuario oliver , accederemos a la carpeta Oliver y a crear un directorio dentro :\n8. Desde Windows acceder a estas carpetas a través de unidades de red. Desde el explorador de archivos podremos ver todos los recursos compartidos en la red .Ahora vamos a crear unidades de red, así que por ejemplo vamos a añadir la carpeta Oliver al usuario Oliver como unidad de red, para esto , hacemos clic derecho en la carpeta \u0026gt; conectar a unidad de red :\nY seleccionaremos una letra para asignarle a la unidad de red :\nAhora esta unidad nos aparecerá en este equipo :\nPerfiles móviles 9. Definir perfiles móviles en el servidor Linux mediante Samba, de forma que los usuarios se puedan autentificar en diferentes máquinas Windows, manteniendo su configuración. Para realizar esto vamos a instalarlos RSAT (Remote Server Administration Tools) que nos permitirá administrar nuestro controlador de dominio samba de forma idéntica a windows server . Para añadirlas buscaremos en la búsqueda de Windows *Añadir características opcionales una vez aquí le daremos a añadir característica :\nUna vez aquí buscaremos las siguientes características con RSAT y las instalaremos :\nUna vez instaladas se nos creará una aplicación similar a la de un Windows server llamada herramientas administrativas :\nSe nos abrirá una carpeta con las herramientas de administración :\nY buscaremos administración de usuarios y equipos de active directory o escribimos en ejecutar dsa.msc , esto lo haremos con el usuario administrador de nuestro dominio para poder acceder a esta:\nAntes de crear nuestro usuario móvil crearemos un recurso de red al igual que hemos hecho anteriormente llamado perfiles y le daremos permisos al grupo móviles para que estos puedan escribir en ellos :\nPara que nuestro usuario pueda escribir en este directorio lo añadiremos al grupo :\nAhora nos vamos a la configuración de nuestro usuario y le cambiamos la ruta del perfil . Pondremos la ruta de nuestra carpeta compartida perfiles seguida de %username% :\nGuardamos y ya tendríamos hecho nuestro perfil móvil creado .\nVamos a demostrar el funcionamiento del perfil móvil , para ello le he cambiado el fondo y he creado dos carpetas :\nAhora vamos a cerrar sesión e iniciarla en el Windows de la derecha :\nVemos que se ha realizado correctamente el perfil móvil .\nNFS 10. Mediante NFS, se compartirán en el servidor las carpetas: proyectos, documentación, programas_y_drivers. De la primera solo se podrá leer; en las dos últimas también se podrá escribir. Los equipos Linux montarán las carpetas automáticamente en el arranque. Lo primero que haremos será instalarnos los siguientes paquetes :\nAhora crearemos en la raíz los directorios que vamos a compartir :\nY le cambiaremos el propietario y los permisos a estos directorios :\nDespués de esto, debemos editar el archivo /etc/exports. Este es el archivo donde se indican a NFS las carpetas que vamos a compartir . La primera será solo de lectura y las dos últimas se podrán escribir :\nPara poder acceder a estos recursos en el servidor vamos a instalarlos los siguientes paquetes :\nAhora vamos a crear los directorios donde montaremos nuestras carpetas :\nPara montarlas manualmente en Linux haremos el siguiente comando :\nVamos a comprobar que en proyectos no podremos escribir :\nMientras que en las otras dos si podremos escribir :\nSi queremos acceder a estos recursos en Windows \u0026ndash;\u0026gt; \\192.168.0.1\\documentacion\n\\192.168.0.1\\proyectos (directorio de solo lectura)\n\\192.168.0.1\\programas_y_drivers\nPara poder visualizarlos será necesario tener instalados las siguientes características en Windows (Podemos acceder a este programa a través del buscador de Windows escribiendo características de Windows)\nPara finalizar con este punto vamos a configurar que los equipos Linux monten automáticamente al arrancar los directorios . Editaremos el fichero /etc/fstab añadiendo las siguientes líneas :\nUna vez hecho esto reiniciamos y veremos que se nos habrán montado automáticamente:\nCuotas 11. La carpeta /home del servidor tendrá un sistema de cuotas para evitar la saturación con archivos de los usuarios (100 MB por usuario). Lo primero que haremos será instalar los paquetes para implementar cuotas :\nAhora permitiremos las cuotas en la partición /home añadiendo esto al fstab de nuestro servidor :\nRemontamos la partición home para que se apliquen estos cambios :\nY aplicamos cuotas en la partición /home\nComprobaremos que en la raíz de la partición se nos ha creado dos archivos (aquota.group y aquota.user):\nAhora le aplicaremos la cuota de 100Mb a oliver usando edquota :\nAhora usaremos una herramienta la cual es gawk, el cual nos permitirá concatenándolo con este comando, aplicarle la cuota que le acabamos de crear a Oliver a todos nuestros usuarios :\nLa orden que acabamos de lanzar ha extraído una lista de todos los usuarios y ha aplicado la cuota de Oliver a todos usuarios con un UID mayor a 499 .\nAhora revisaremos las cuotas para ver como han quedado :\nPara comprobar que funciona vamos a agotar la cuota del usuario proferaul , para ello crearemos un archivo de 30 MB :\nAhora lo moveremos al directorio home de él y le haremos propietario del archivo :\nVemos que se actualiza el espacio usado en el directorio del usuario :\nWebmin 12. Instala Webmin en el servidor para tener la posibilidad de gestionarlo gráficamente desde un cliente. Demuestra alguna de sus funcionalidades. Webmin es un panel de control web moderno que le permite administrar su servidor Linux a través de una interfaz basada en navegador.\nNecesitaremos instalar apache para poder instalar webmin en nuestro servidor :\nAhora deberemos de añadir el repositorio de webmin , así que editaremos el sources.list y lo añadiremos :\nGuardamos el archivo y haremos un apt update para actualizar los repositorios , nos saldrá un error advirtiéndonos de que el repositorio no es fiable .\nAsí que ahora descargaremos la clave PGP de Webmin y la añadiremos a nuestro sistema :\nVolvemos a hacer un apt update y veremos que ahora el repositorio es fiable\nA continuación descargaremos el paquete webmin :\nLas últimas líneas de la instalación nos dará los datos para acceder vía web a este servicio :\nAsí que en un cliente vamos al navegador y accedemos a esta url :\nNos dirá que la conexión no es privada , para saltarnos esta advertencia Configuración avanzada \u0026gt; acceder\nTendremos un portal donde deberemos entrar con un usuario administrador de nuestro servidor :\nLo primero que veremos en la interfaz web será un monitor de recursos, así como datos de nuestro equipo :\nPodremos ver un histórico del monitor de recursos, el cual nos mostrara las horas y el porcentaje de uso de nuestro hardware, así como información del sistema :\nTenemos más apartados como el de logins recientes o interfaces de red , el cual nos dará información de quien se ha conectado y las configuraciones de las mismas respectivamente :\nPara finalizar con el panel tendremos una última ventana la cual nos dirá el uso del disco y particiones :\nUna vez que hemos echado un vistazo a la página principal vamos a aprovechar una funcionalidad que tiene que nos permite ver los directorios compartidos por nfs , para acceder aquí vamos a networking \u0026gt; NFS exports :\nVamos, que además nos permite editar los directorios compartidos actuales, así como añadir o eliminar estos .\nAdemás, esta herramienta nos permite configurar un Firewall con iptables , lo cual hoy día es de vital importancia disponer de seguridad en nuestra red :\nIncluso dispone de una terminal web para que podamos administrar el servidor desde un cliente , para acceder a esta desplegamos el menú y pulsamos sobre el símbolo de terminal o pulsamos Alt + K :\nVemos que usara ssh con el usuario conectado en la aplicación , en mi caso javiercruces :\nWebmin incluye muchas más funciones de administración que nos ayuda a trabajar con el servidor de forma gráfica para hacer más ameno la administración del mismo ,desde actualizar paquetes hasta configurar un Firewall . Además, usa https, por lo que nuestro tráfico viajara cifrado , lo que nos permitiría configurar nat para poder acceder desde un dispositivo que este fuera de nuestra red , sin que un snifer pueda descifrar nuestro trafico fácilmente. Es aconsejable que cambiemos el certificado auto-firmado que usa webmin por uno propio que podemos generar con Let`s encrypt, por ejemplo .\nCUPS 13. Habrá un servidor de impresión CUPS, que se administrará desde un cliente Ubuntu. Lo primero que deberemos de hacer es instalar en el servidor cups : Una vez hecho esto vamos a configurar el servicio para permitir ser administrado desde nuestro cliente Ubuntu , para ello editamos el siguiente fichero :\nAhora añadiremos los siguientes parámetros :\nListen 192.168.0.1:631 allow 192.168.0.0/24 Para permitir que nuestro cliente Ubuntu sea capaz de administrar el servicio\nAhora solo nos quedaría reiniciar el servicio :\nNos desplazaremos al cliente y en el navegador introduciremos la ip de nuestro servidor seguido de dos puntos y 631 :\nCon esto hemos comprobado que el cliente puede administrar cups .\n14. Configura una impresora en red para todos los usuarios, con límites de páginas diarias para todos los usuarios. Para compartir nuestra impresora en red , accedemos al panel web y en el apartado de administración marcamos compartir impresoras conectadas a este sistema :\nAntes de establecer los límites vamos a habilitar que el servicio registre el nombre de los usuarios al mandar archivos , para ello en el fichero cupsd.conf cambiamos este valor de default a none :\nAhora reiniciaremos el servicio :\nPara establecer un límite diario para cada usuarios de 20 páginas por ejemplo , aplicaríamos el siguiente comando para nuestra impresora .\nUna vez aplicado este comando los usuarios solo podrán imprimir el número indicado de páginas ,cuando supere el límite los trabajos se mandaran a cups , pero este los desechara de la cola y no los imprimirá :\nEs decir, el trabajo 21 en este ejemplo no se creará hasta qué pasen 24 horas .\nBibliografía Como saber que escritorio tengo Montar controlador de dominio samba Configurar la red con netplan Unir cliente linux a dominio parte 1 Unir cliente linux a dominio parte 2 Administrar dominio con RSAT Acceder carpetas compartidas w10 Cuotas Instalación y uso de webmin Comandos CUPS ","date":"September 20, 2023","hero":"/images/sistemas/ad_ubuntu/portada.jpeg","permalink":"https://www.javiercd.es/posts/sistemas/ad_ubuntu/ad_ubuntu/","summary":"\u003cp\u003eEn este post, exploraremos cómo configurar un entorno de Active Directory en un servidor Ubuntu utilizando herramientas como Kerberos y Samba. Active Directory es una solución integral de Microsoft para la gestión de identidades y el control de acceso en redes empresariales. A través de esta guía, aprenderemos paso a paso cómo implementar un servidor Ubuntu como controlador de dominio, establecer la autenticación basada en Kerberos y configurar servicios de directorio mediante Samba.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Active Directory en Ubuntu"},{"categories":null,"contents":"La gestión eficiente de tareas programadas es esencial para los administradores de sistemas, ya que facilita la ejecución automática de procesos rutinarios. En este contexto, contar con un conjunto sólido de comandos en Linux para programar y controlar tareas se convierte en una herramienta fundamental.\nCommand sleep El comando sleep pausa la ejecución en la terminal durante un intervalo de tiempo especificado antes de regresar a la línea de comandos. Puedes indicar el tiempo en segundos, minutos, horas o días. Este comando se encuentra en el paquete coreutils.\ns : segundos m : minutos h : horas d : días Ej: sleep 10m –\u0026gt; esperar 10 min\nPor si solo no tiene ninguna utilidad , sin embargo es muy útil en Scripts . Aquí un pequeño ejemplo :\ndate +\u0026quot;%H:%M:%S\u0026quot;;sleep 5;date +\u0026quot;%H:%M:%S\u0026quot;\nCommand watch La utilidad watch es parte del paquete procps (o procps-ng) que está preinstalado en casi todas las distribuciones Gnu/Linux.\nCuando se usa sin argumentos, esta utilidad ejecutará el comando especificado cada dos segundos:\nPodemos especificar el tiempo de repetición utilizando el parámetro -n , especificando el parámetro en segundos :\nwatch -n 5 date –\u0026gt; Cada 5 segundos\nSi queremos eliminar el encabezado , es decir que nos muestre cada cuanto tiempo se repite , utilizamos el parámetro -t :\nSi queremos poner un mensaje de error en caso de que el comando no pueda ejecutarse utilizamos el parámetro -e seguido del mensaje de error :\nwatch -e ‘error’\nLa opción -b de watch emite un pitido cada vez que el comando sale con un código de estado distinto de cero.\nwatch -b\nCon el parámetro -d nos señala los cambios que han ocurrido en la ejecución del comando : watch -d\nCommand at Este comando se usa para ejecutar comandos a una determinada hora , principalmente se usa para programar tareas periódicas como puedes ser , copias de seguridad .\nLos principales parámetros son :\nV :imprime el número de versión en el error estándar y sale con éxito.\nm :Enviar correo al usuario cuando el trabajo haya finalizado aunque no haya habido salida. -M: Nunca envía correo al usuario.\nf :archivo Lee el trabajo desde un archivo en lugar de la entrada estándar.\nt :time Ejecuta el trabajo a la hora, dada en el formato [[CC]YY]MMDDhhmm[.ss]\nl :Es un alias para atq.\nr :Es un alias para atrm.\nd: Es un alias para atrm.\nb: Es un alias para batch.\nv: Muestra el tiempo que se ejecutará el trabajo antes de leerlo.\nLos tiempos mostrados estarán en el formato \u0026ldquo;Thu Feb 20 14:50:00 1997\u0026rdquo;.\nc recoge los trabajos listados en la línea de comandos en la salida estándar.\nPodemos programar tareas desde la linea de comandos , con echo :\necho \u0026ldquo;sh copia-seguridad.sh\u0026rdquo; | at 10:00 PM\nHa esta tarea se le asignara un numero automáticamente , para listar las tareas que tenemos invocamos el comando at sin ningún parámetro\nSi queremos borrar una tarea programada , utilizamos el parámetro -c seguido con el numero de la tarea a eliminar .\nAlgunos ejemplos para programar tareas son :\nDentro de 30 min : at now + 30 minutes 11AM del próximo 14 abril : at 11:00 AM April 14 Command crontab El comando crontab se utiliza en sistemas UNIX para programar la ejecución de otros comandos, es decir, para automatizar tareas. Podemos ver los crontabs que se están programados y también editarlos, lógicamente.\nPara verlos, utilizamos este comando: sudo crontab -l Para editarlos: sudo crontab -e\nLas tareas cron siguen una determinada sintaxis. Tienen 5 asteriscos seguidos del comando a ejecutar. Ahora explicaré para qué sirve cada cosa.\n* * * * * /bin/ejecutar/script.sh\nLos 5 asteriscos , de izquierda a derecha, los asteriscos representan:\nMinutos: de 0 a 59. Horas: de 0 a 23. Día del mes: de 1 a 31. Mes: de 1 a 12. Día de la semana: de 0 a 6, siendo 0 el domingo. Si se deja un asterisco, quiere decir \u0026ldquo;cada\u0026rdquo; minuto, hora, día de mes, mes o día de la semana.\nSi queremos que un archivo se ejecute a las 5 de la mañana todos los días : 0 5 * * * ruta_absoluta_del_script\nPara que se ejecute dos veces al día a las 6 AM Y a las 6 PM: 0 6,18 * * * ruta_absoluta_del_script\nMuchas veces tenemos palabras reservadas para facilitar el uso de programas o lenguajes de programación. Cron no podía ser menos, así que tenemos algunas que suelen ser las más comunes. Ya cada uno que lo configure conforme a sus necesidades. Aquí van:\n@reboot: se ejecuta una única vez al inicio. @yearly/@annually: ejecutar cada año. @monthly: ejecutar una vez al mes. @weekly: una vez a la semana. @daily/@midnight: una vez al día. @hourly: cada hora. También debemos conocer los usos de los parámetros :\ncrontab archivo.cron (establecerá el archivo.cron como el crontab del usuario)\ncrontab -e (abrirá el editor preestablecido donde se podrá crear o editar el archivo crontab) crontab -l (lista el crontab actual del usuario, sus tareas de cron)\ncrontab -r (elimina el crontab actual del usuario)\nCuando hagamos algún cambio deberemos de reiniciar el servicio para asegurarnos de que nuestros cambios surtan efecto :\nservice crond restart\nEstos comandos nos dará la posibilidad de automatizar procesos , haciendo mas cómoda y amena la administración de nuestros sistemas .\nBibliografía Command watch Command crontab ","date":"September 20, 2023","hero":"/images/sistemas/programacion_tareas/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/programacion_tareas/programacion_tareas/","summary":"\u003cp\u003eLa gestión eficiente de tareas programadas es esencial para los administradores de sistemas, ya que facilita la ejecución automática de procesos rutinarios. En este contexto, contar con un conjunto sólido de comandos en Linux para programar y controlar tareas se convierte en una herramienta fundamental.\u003c/p\u003e\n\u003ch2 id=\"command-sleep\"\u003eCommand sleep\u003c/h2\u003e\n\u003cp\u003eEl comando sleep pausa la ejecución en la terminal durante un intervalo de tiempo especificado antes de regresar a la línea de comandos. Puedes indicar el tiempo en segundos, minutos, horas o días. Este comando se encuentra en el paquete coreutils.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Commands programación de tareas en Linux"},{"categories":null,"contents":"Habilita SELinux en un servidor basado en Rocky y asegúrate que los servicios samba y nfs funcionan correctamente con una configuración estricta y segura de SELinux. Realiza las pruebas de acceso correspondientes.\nEl escenario consta de dos máquinas , nuestro servidor esta basado en Rocky 9 y nuestro cliente es un Debian 12 .\nEn nuestro servidor tendremos activado SELinux en modo enforcing .\n[rocky@rocky-javiercruces ~]$ sestatus SELinux status: enabled SELinuxfs mount: /sys/fs/selinux SELinux root directory: /etc/selinux Loaded policy name: targeted Current mode: enforcing Mode from config file: enforcing Policy MLS status: enabled Policy deny_unknown status: allowed Memory protection checking: actual (secure) Max kernel policy version: 33 Comenzaremos actualizando los paquetes necesarios para configurar samba y nfs :\n[rocky@rocky-javiercruces ~]$ sudo dnf update -y [rocky@rocky-javiercruces ~]$ sudo dnf install samba samba-common samba-client nfs-utils -y Samba Un recurso compartido de samba es esencialmente un directorio que se compartirá entre los sistemas cliente de la red. Por lo tanto, crearemos un directorio como se muestra. Yo lo hare en el directorio home de mi usuario :\n[rocky@rocky-javiercruces ~]$ mkdir sambashare Le daremos los permisos y la propiedad correspondientes al directorio que acabamos de crear para que sea accesible a través del servicio :\n[rocky@rocky-javiercruces ~]$ sudo chmod -R 755 /home/rocky/sambashare [rocky@rocky-javiercruces ~]$ sudo chown -R nobody:nobody /home/rocky/sambashare [rocky@rocky-javiercruces ~]$ sudo chcon -t samba_share_t /home/rocky/sambashare Ahora vamos a crear un recurso compartido dentro de la configuración de samba , lo añadiré al final del fichero :\n[rocky@rocky-javiercruces ~]$ sudo vim /etc/samba/smb.conf [sambashare] path = /home/rocky/sambashare browsable =yes writable = yes guest ok = yes read only = no Para verificar el archivo de configuración, ejecuta el siguiente comando :\n[rocky@rocky-javiercruces ~]$ sudo testparm Con la configuración actual podremos acceder al recurso de forma anónima , aunque podemos configurar usuarios samba :\n[rocky@rocky-javiercruces ~]$ sudo smbpasswd -a rocky Luego añade al fichero de configuración la linea \u0026ldquo;valid users = usuario\u0026rdquo; al final de cada declaración de recurso , te dejo un ejemplo :\n[sambashare] path = /home/rocky/sambashare guest only = no writable = yes force create mode = 0666 force directory mode = 0777 browseable = yes valid users = rocky Ahora vamos a arrancar el servicio :\n[rocky@rocky-javiercruces ~]$ sudo systemctl start smb [rocky@rocky-javiercruces ~]$ sudo systemctl enable smb [rocky@rocky-javiercruces ~]$ sudo systemctl start nmb [rocky@rocky-javiercruces ~]$ sudo systemctl enable nmb Vamos a confirmas que ambos servicios están funcionando :\n[rocky@rocky-javiercruces ~]$ sudo systemctl status smb ● smb.service - Samba SMB Daemon Loaded: loaded (/usr/lib/systemd/system/smb.service; enabled; preset: disabled) Active: active (running) since Mon 2024-02-05 11:21:45 UTC; 1min 50s ago Docs: man:smbd(8) man:samba(7) man:smb.conf(5) Main PID: 49025 (smbd) Status: \u0026#34;smbd: ready to serve connections...\u0026#34; Tasks: 3 (limit: 4340) Memory: 8.6M CPU: 70ms CGroup: /system.slice/smb.service ├─49025 /usr/sbin/smbd --foreground --no-process-group ├─49027 /usr/sbin/smbd --foreground --no-process-group └─49028 /usr/sbin/smbd --foreground --no-process-group Feb 05 11:21:45 rocky-javiercruces.novalocal systemd[1]: Starting Samba SMB Daemon... Feb 05 11:21:45 rocky-javiercruces.novalocal smbd[49025]: [2024/02/05 11:21:45.649440, 0] ../../source3/smbd/server.c:1746(main) Feb 05 11:21:45 rocky-javiercruces.novalocal smbd[49025]: smbd version 4.18.6 started. Feb 05 11:21:45 rocky-javiercruces.novalocal smbd[49025]: Copyright Andrew Tridgell and the Samba Team 1992-2023 Feb 05 11:21:45 rocky-javiercruces.novalocal systemd[1]: Started Samba SMB Daemon. [rocky@rocky-javiercruces ~]$ sudo systemctl status nmb ● nmb.service - Samba NMB Daemon Loaded: loaded (/usr/lib/systemd/system/nmb.service; enabled; preset: disabled) Active: active (running) since Mon 2024-02-05 11:22:49 UTC; 1min 7s ago Docs: man:nmbd(8) man:samba(7) man:smb.conf(5) Main PID: 49065 (nmbd) Status: \u0026#34;nmbd: ready to serve connections...\u0026#34; Tasks: 1 (limit: 4340) Memory: 2.8M CPU: 48ms CGroup: /system.slice/nmb.service └─49065 /usr/sbin/nmbd --foreground --no-process-group Feb 05 11:22:49 rocky-javiercruces.novalocal nmbd[49065]: [2024/02/05 11:22:49.116367, 0] ../../source3/nmbd/nmbd.c:901(main) Feb 05 11:22:49 rocky-javiercruces.novalocal nmbd[49065]: nmbd version 4.18.6 started. Feb 05 11:22:49 rocky-javiercruces.novalocal nmbd[49065]: Copyright Andrew Tridgell and the Samba Team 1992-2023 Feb 05 11:22:49 rocky-javiercruces.novalocal systemd[1]: Started Samba NMB Daemon. Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: [2024/02/05 11:23:12.157234, 0] ../../source3/nmbd/nmbd_become_lmb.c:398(become_local_master_stage2) Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: ***** Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: Samba name server ROCKY-JAVIERCRUCES is now a local master browser for workgroup SAMBA on subnet 10.0.0.150 Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: ***** Los resultados anteriores indican que los servicios se están ejecutando. Ahora habilitemos el protocolo samba en el firewall para permitir que los clientes puedan conectarse :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=samba success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --reload success Ahora en nuestro cliente , nos instalamos el cliente y comprobamos a conectarnos remotamente :\njaviercruces@odin:~$ sudo apt install samba-client -y javiercruces@odin:~$ sudo smbclient //172.22.201.86/sambashare -U rocky Password for [WORKGROUP\\rocky]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Feb 12 09:42:09 2024 .. D 0 Mon Feb 5 11:50:24 2024 fichero_prueba N 0 Mon Feb 12 09:42:09 2024 9286656 blocks of size 1024. 7952516 blocks available smb: \\\u0026gt; Comprobaremos que en ambos extremos tenemos los mismos ficheros :\n[rocky@rocky-javiercruces ~]$ sudo ls -l /home/rocky/sambashare/ total 0 -rwxr-xr-x. 1 nobody nobody 0 Feb 12 09:42 fichero_prueba NFS Nos instalamos el servidor nfs en rocky :\n[rocky@rocky-javiercruces ~]$ sudo dnf install nfs-utils En el cliente debian , en este caso odin nos descargamos \u0026ldquo;el cliente\u0026rdquo;\njaviercruces@odin:~$ sudo apt install nfs-common Creamos el directorio que queremos compartir :\n[rocky@rocky-javiercruces ~]$ sudo mkdir /var/nfs/general -p Le damos los permisos adecuados para que nfs funcione correctamente.\n[rocky@rocky-javiercruces ~]$ sudo chown nobody /var/nfs/general Mostramos la configuración actual de los servicios permitidos a través del firewall usando firewalld :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --list-all | grep services services: cockpit dhcpv6-client samba ssh Como no tenemos permitido nfs , lo permitiremos haciendo uso del servicio :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=nfs success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=mountd success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=rpc-bind success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --reload success Volvemos a listar los servicios permitidos y nos aseguramos que este nfs , mountd y rcp-bind :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --list-all | grep services services: cockpit dhcpv6-client mountd nfs rpc-bind samba ssh Ahora en el cliente elegiremos donde montaremos el directorio compartido , yo creare uno nuevo :\njaviercruces@odin:~$ sudo mkdir -p /nfs/general Y montaremos el nuevo directorio :\njaviercruces@odin:~$ sudo mount 172.22.201.86:/var/nfs/general /nfs/general Comprobamos que se ha montado :\njaviercruces@odin:~$ df -h Filesystem Size Used Avail Use% Mounted on udev 965M 0 965M 0% /dev tmpfs 197M 684K 197M 1% /run /dev/vda1 15G 7.0G 7.1G 50% / tmpfs 984M 0 984M 0% /dev/shm tmpfs 5.0M 0 5.0M 0% /run/lock /dev/vda15 124M 12M 113M 10% /boot/efi tmpfs 197M 0 197M 0% /run/user/1000 172.22.201.86:/var/nfs/general 8.9G 1.3G 7.6G 15% /nfs/general Y comprobamos que en ambos extremos tenemos los mismos ficheros :\n[rocky@rocky-javiercruces ~]$ sudo ls -l /var/nfs/general/ total 0 -rw-r--r--. 1 nobody nobody 0 Feb 12 09:38 fichero_prueba javiercruces@odin:~$ ls -l /nfs/general total 0 -rw-r--r-- 1 nobody nogroup 0 Feb 12 09:38 fichero_prueba ","date":"September 20, 2023","hero":"/images/sistemas/selinux/selinux.jpg","permalink":"https://www.javiercd.es/posts/sistemas/activacion_selinux/activacion_selinux/","summary":"\u003cp\u003eHabilita SELinux en un servidor basado en Rocky y asegúrate que los servicios samba y nfs funcionan correctamente con una configuración estricta y segura de SELinux. Realiza las pruebas de acceso correspondientes.\u003c/p\u003e\n\u003cp\u003eEl escenario consta de dos máquinas , nuestro servidor esta basado en Rocky 9 y nuestro cliente es un Debian 12 .\u003c/p\u003e\n\u003cp\u003eEn nuestro servidor tendremos activado SELinux en modo enforcing .\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003erocky@rocky-javiercruces ~\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e$ sestatus\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELinux status:                 enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELinuxfs mount:                /sys/fs/selinux\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELinux root directory:         /etc/selinux\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLoaded policy name:             targeted\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCurrent mode:                   enforcing\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMode from config file:          enforcing\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePolicy MLS status:              enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePolicy deny_unknown status:     allowed\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMemory protection checking:     actual \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esecure\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMax kernel policy version:      \u003cspan style=\"color:#ae81ff\"\u003e33\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eComenzaremos actualizando los paquetes necesarios para configurar samba y nfs :\u003c/p\u003e","tags":["ASO","REDHAT","ROCKY","CENTOS"],"title":"Configuración activación de SELinux"},{"categories":null,"contents":"Systemd y System V (SysV) son dos sistemas de inicio utilizados en distribuciones de Linux para gestionar el arranque del sistema y los servicios. System V (SysV) es un sistema de inicio tradicional que utiliza scripts de shell almacenados en diferentes niveles de ejecución (runlevels) para iniciar y detener servicios de manera secuencial. Fue ampliamente utilizado en muchas distribuciones de Unix y Linux durante décadas. Por otro lado, systemd es un sistema de inicio más moderno y avanzado que reemplaza a SysV. Introducido para mejorar la velocidad y eficiencia del arranque del sistema, systemd utiliza un enfoque basado en unidades y depende de la paralelización para iniciar servicios simultáneamente. Además, incluye características adicionales como la gestión de servicios, sockets, temporizadores, y dependencias, lo que lo convierte en una opción más robusta y flexible en comparación con SysV.\nMigración de systemd a systemV Modifica /etc/apt/sources.list para que apunte a los repositorios de Daedalus que es el equivalente de Debian 12 en Devuan.\nroot@ASOjaviercruces:~# nano /etc/apt/sources.list Modifica sources.list para que se parezca al proporcionado. Comenta todas las demás líneas.\nroot@ASOjaviercruces:~# cat /etc/apt/sources.list deb http://deb.devuan.org/merged daedalus main deb http://deb.devuan.org/merged daedalus-updates main deb http://deb.devuan.org/merged daedalus-security main deb http://deb.devuan.org/merged daedalus-backports main Actualiza las listas de paquetes desde los repositorios de Daedalus , permitiendo los orígenes inseguros ya que esta firmado los repositorios .\nroot@ASOjaviercruces:~# apt-get update --allow-insecure-repositories Instala el anillo de claves de Devuan para autenticar el repositorio y los paquetes.\nroot@ASOjaviercruces:~# apt-get install devuan-keyring --allow-unauthenticated Actualiza las listas de paquetes nuevamente para autenticar los repositorios y paquetes.\nroot@ASOjaviercruces:~# apt-get update Actualiza los paquetes instalados a las versiones más recientes. Ten en cuenta que esto no completa la migración a system-v.\nroot@ASOjaviercruces:~# apt-get upgrade (ten cuidado de NO usar dist-upgrade aquí) Instalamos los paquetes eudev y sysvinit-core para gestionar eficientemente la detección y configuración de dispositivos a través de eudev, mientras que sysvinit-core se encarga del control del sistema de inicio y procesos .\nroot@ASOjaviercruces:~# apt-get install eudev sysvinit-core Es posible que el último comando cause roturas de paquetes, pero se resolverán como parte del proceso de migración.\nroot@ASOjaviercruces:~# apt-get -f install Se requiere un reinicio para cambiar aplicar el cambio de systemd a systemV.\nroot@ASOjaviercruces:~# reboot Actualizaremos la distribución para que los paquetes pasen de utilizar systemd a systemV.\nroot@ASOjaviercruces:~# apt-get dist-upgrade Una vez completada la migración a Devuan, elimina los paquetes relacionados con systemd.\nroot@ASOjaviercruces:~# apt-get purge systemd libnss-systemd Elimina cualquier paquete huérfano generado por el proceso de migración y cualquier archivo de caché no utilizable.\nroot@ASOjaviercruces:~# apt-get autoremove --purge root@ASOjaviercruces:~# apt-get autoclean Comprobación y uso de systemV Comprueba que el proceso 1 es init , esto significa que el sistema ha arrancado haciendo uso de systemV :\nroot@ASOjaviercruces:~# ps -s1 PID TTY TIME CMD 1 ? 00:00:00 init Me instalare un servicio que debería de depender de systemd pero como hemos cambiado a systemv , no lo usara ya que ahora usamos los repositorios de Devuan :\ndebian@ASOjaviercruces:~$ sudo apt install apache2 -y Entonces para manejar el servicio lo haremos a partir del directorio /etc/init.d/ y buscando el \u0026ldquo;servicio\u0026rdquo; de cada demonio :\n# Para iniciar el servicio debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 start Starting Apache httpd web server: apache2. # Para parar el servicio debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 stop Stopping Apache httpd web server: apache2. # Para reiniciar el servicio debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 restart Restarting Apache httpd web server: apache2AH00558: apache2: Could not reliably determine the server\u0026#39;s fully qualified domain name, using 192.168.122.208. Set the \u0026#39;ServerName\u0026#39; directive globally to suppress this message . # Para ver el estado debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 status apache2 is running. ","date":"September 20, 2023","hero":"/images/sistemas/eliminar_systemd/eliminar_systemd.jpg","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/eliminacion_systemd/eliminacion_systemd/","summary":"\u003cp\u003eSystemd y System V (SysV) son dos sistemas de inicio utilizados en distribuciones de Linux para gestionar el arranque del sistema y los servicios. System V (SysV) es un sistema de inicio tradicional que utiliza scripts de shell almacenados en diferentes niveles de ejecución (runlevels) para iniciar y detener servicios de manera secuencial. Fue ampliamente utilizado en muchas distribuciones de Unix y Linux durante décadas. Por otro lado, systemd es un sistema de inicio más moderno y avanzado que reemplaza a SysV. Introducido para mejorar la velocidad y eficiencia del arranque del sistema, systemd utiliza un enfoque basado en unidades y depende de la paralelización para iniciar servicios simultáneamente. Además, incluye características adicionales como la gestión de servicios, sockets, temporizadores, y dependencias, lo que lo convierte en una opción más robusta y flexible en comparación con SysV.\u003c/p\u003e","tags":["ASO","DEBIAN"],"title":"Eliminación de systemd"},{"categories":null,"contents":"Samba es una implementación libre y de código abierto del protocolo Server Message Block (SMB), que se utiliza para compartir archivos e impresoras en redes de computadoras. El protocolo SMB es un protocolo de red que permite que los sistemas operativos Windows se comuniquen con otros dispositivos de red, como servidores de archivos, impresoras y otros recursos compartidos.\nSamba facilita la interoperabilidad entre sistemas Windows y sistemas operativos basados en Unix/Linux al permitir que los sistemas Unix compartan archivos y recursos con sistemas Windows utilizando el protocolo SMB/CIFS. Esto significa que un servidor Samba puede actuar como un servidor de archivos para clientes Windows, permitiéndoles acceder y compartir archivos como si estuvieran en un entorno Windows.\n1.Instalación Lo primero sera instalarnos el servidor samba :\nEn el fichero /etc/samba/smb.conf realizaremos la configuración de nuestra carpeta :\nNos crearemos un usuario de samba para poder acceder a los recursos :\nReiniciaremos el servicio para que se aplique la configuración :\n2.Acceso desde Windows Ahora podemos acceder desde un cliente Windows con el usuario que acabamos de crear -–\u0026gt; \\IP\\DIRECTORIO\\COMPARTIDO\nNos pedirá que nos autentiquemos :\nPodremos ver el contenido y crear :\n3.Acceso desde Linux Nos instalamos el paquete smbclient para poder conectarnos a unidades compartidas con samba:\nListar los directorios compartidos :\nNos conectamos al recurso compartido\nCreare un directorio y comprobare que existe :\nBibliografía -Habilitar el acceso de invitado\n","date":"September 20, 2023","hero":"/images/sistemas/samba_debian/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/samba_debian/samba_debian/","summary":"\u003cp\u003eSamba es una implementación libre y de código abierto del protocolo Server Message Block (SMB), que se utiliza para compartir archivos e impresoras en redes de computadoras. El protocolo SMB es un protocolo de red que permite que los sistemas operativos Windows se comuniquen con otros dispositivos de red, como servidores de archivos, impresoras y otros recursos compartidos.\u003c/p\u003e\n\u003cp\u003eSamba facilita la interoperabilidad entre sistemas Windows y sistemas operativos basados en Unix/Linux al permitir que los sistemas Unix compartan archivos y recursos con sistemas Windows utilizando el protocolo SMB/CIFS. Esto significa que un servidor Samba puede actuar como un servidor de archivos para clientes Windows, permitiéndoles acceder y compartir archivos como si estuvieran en un entorno Windows.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Instalar y configurar samba en Debian"},{"categories":null,"contents":"Paso 1 Instalar systemd-journal-remote En nuestro entorno, el primer paso consistirá en instalar el paquete systemd-journal-remote, que nos permitirá acceder a estas máquinas de forma remota. Para llevar a cabo la instalación en las máquinas de nuestro escenario, utilizaremos el gestor de paquetes apt en Odin, que ejecuta Debian 12. Asimismo, instalaremos el mismo paquete en Thor y Loki, que son contenedores alojados dentro de Odin. En cuanto a Hela, un sistema operativo Rocky, requerirá el uso de dnf para la instalación.\njaviercruces@odin:~$ sudo apt install systemd-journal-remote -y javiercruces@thor:~$ sudo apt install systemd-journal-remote -y javiercruces@loki:~$ sudo apt install systemd-journal-remote -y [javiercruces@hela ~]$ sudo dnf install systemd-journal-remote -y En el servidor, habilita y activa los dos componentes de systemd necesarios para recibir mensajes de registro con el siguiente comando:\njaviercruces@odin:~$ sudo systemctl enable --now systemd-journal-remote.socket javiercruces@odin:~$ sudo systemctl enable systemd-journal-remote.service En el cliente, habilita el componente que systemd utiliza para enviar los mensajes de registro al servidor:\n[javiercruces@hela ~]$ sudo systemctl enable systemd-journal-upload.service A continuación, en el servidor, abre los puertos 19532 y 80 en el firewall . Esto permitirá al servidor recibir los mensajes de registro del cliente. El puerto 80 es el puerto que certbot utilizará para generar el certificado TLS. En nuestro caso no hay ningun cortafuegos asi que no sera necesario .\nPaso 2: Generación de claves y certificados Dado que utilizaremos el servicio con cifrado para garantizar que nadie pueda acceder a nuestros registros, procederé a generar los certificados mediante OpenSSL.\nPodemos generar los certificados manualmente, pero existe una herramienta llamada Easy RSA que automatiza este proceso. Yo generare en Odin todos los certificados de las maquinas y posteriormente los llevare a las maquinas correspondientes .\njaviercruces@odin:~$ sudo apt install easy-rsa openssl -y Esta utilidad trae un fichero de ejemplo para que nos sea mas facil generar los certificados , dentro de este cambiaremos los siguientes valores :\njaviercruces@odin:/usr/share/easy-rsa$ sudo cp vars.example vars javiercruces@odin:/usr/share/easy-rsa$ sudo nano vars set_var EASYRSA_REQ_COUNTRY \u0026#34;ES\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;Sevilla\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;Dos Hermanas\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;iesgn\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;contacto@javiercd.es\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Informatica\u0026#34; Vamos a crear la estructura de directorios y archivos necesarios para comenzar a trabajar con EasyRSA :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa init-pki * Notice: init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: * /usr/share/easy-rsa/pki Vamos a construir nuestra CA :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:odin.javiercd.gonzalonazareno.org * Notice: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /usr/share/easy-rsa/pki/ca.crt Vamos a generar la clave privada de thor y generaremos a la vez una solicitud de firma del certificado :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req thor nopass ----- Common Name (eg: your user, host, or server name) [thor]:thor.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/thor.req key: /usr/share/easy-rsa/pki/private/thor.key Vamos a generar la clave privada de loki y generaremos a la vez una solicitud de firma del certificado :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req loki nopass ----- Common Name (eg: your user, host, or server name) [loki]:loki.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/loki.req key: /usr/share/easy-rsa/pki/private/loki.key Haremos lo mismo con odin :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req odin nopass ---- Common Name (eg: your user, host, or server name) [odin]:odin.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/odin.req key: /usr/share/easy-rsa/pki/private/odin.key Haremos lo mismo con hela :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req hela nopass ---- Common Name (eg: your user, host, or server name) [odin]:hela.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/hela.req key: /usr/share/easy-rsa/pki/private/hela.key Una vez generado las claves privadas y las peticiones de firma de los certificados toca firmarlos , para no hacerlo repetitivo mostrare la firma de odin , los demás se hacen de la misma forma :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server odin * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 825 days: subject= commonName = odin.javiercd.gonzalonazareno.org Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/06312595/temp.f57dfbc5 Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;odin.javiercd.gonzalonazareno.org\u0026#39; Certificate is to be certified until May 5 18:34:45 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/odin.crt Llevar los certificados a las maquinas correspondientes Ahora tendremos que hacerle llegar a las distintas maquinas haciendo uso de ssh . Para cada uno de ellos nos llevaremos el certificado firmado que los hemos generado en /usr/share/easy-rsa/pki/issued/ y su clave privada que esta en /usr/share/easy-rsa/pki/private/ .\nAdemas para los clientes tendremos que hacerle llegar el certificado de la CA , que esta en /usr/share/easy-rsa/pki/ca.crt\nUna vez que tengamos los ficheros en las maquinas correspondientes , lo tendremos que almacenar con los siguientes permisos :\n# Cliente hela [javiercruces@hela ~]$ sudo ls -l /etc/letsencrypt/live/hela.javiercd.es/ total 60 -rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1294 Jan 31 18:59 ca.crt -rw-r-----. 1 systemd-journal-upload systemd-journal-upload 4841 Jan 25 11:17 hela.crt -rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1704 Jan 25 11:17 hela.key # Servidor Odin javiercruces@odin:~$ sudo ls -l /etc/letsencrypt/live/javiercd.es/ total 20 -rw-r--r-- 1 root systemd-journal-remote 7840 Jan 31 18:39 combined.pem -rw-r----- 1 root systemd-journal-remote 4841 Jan 31 18:35 odin.crt -rw-r----- 1 root systemd-journal-remote 1704 Jan 31 18:35 odin.key Como habrás notado en odin hay un fichero llamado combined.pem , para conseguir este tendrás que concatenar tu certificado con tu clave privada en un solo archivo\njaviercruces@odin:~$ sudo cat /etc/letsencrypt/live/javiercd.es/odin.crt /etc/letsencrypt/live/javiercd.es/odin.key \u0026gt; /etc/letsencrypt/live/javiercd.es/combined.pem *Aunque he utilizado el directorio donde se guardan los certificados de Let\u0026rsquo;s Encrypt , no he podido usarlo ya que no tenemos el control del dominio gonzalonazareno.org . Por eso los he generado manualmente anteriormente . Puntualizar que el directorio donde guardes estos no importa siempre y cuando tengan los permisos correctos .\nPaso 3 : Configurar el servidor Ya solo nos quedaría indicar la configuración del servicio , solo tendrías que cambiar las rutas correspondientes a tus ficheros :\njaviercruces@odin:~$ sudo cat /etc/systemd/journal-remote.conf [Remote] Seal=false SplitMode=host ServerKeyFile=/etc/letsencrypt/live/javiercd.es/odin.key ServerCertificateFile=/etc/letsencrypt/live/javiercd.es/odin.crt TrustedCertificateFile=/etc/letsencrypt/live/javiercd.es/combined.pem Una vez configurado reiniciamos el servicio y comprobamos que este levantado :\njaviercruces@odin:~$ sudo systemctl restart systemd-journal-remote.service javiercruces@odin:~$ sudo systemctl status systemd-journal-remote.service ● systemd-journal-remote.service - Journal Remote Sink Service Loaded: loaded (/lib/systemd/system/systemd-journal-remote.service; indirect; preset: disabled) Active: active (running) since Wed 2024-01-31 18:46:25 UTC; 49min ago TriggeredBy: ● systemd-journal-remote.socket Docs: man:systemd-journal-remote(8) man:journal-remote.conf(5) Main PID: 4623 (systemd-journal) Status: \u0026#34;Processing requests...\u0026#34; Tasks: 1 (limit: 2313) Memory: 7.9M CPU: 238ms CGroup: /system.slice/systemd-journal-remote.service └─4623 /lib/systemd/systemd-journal-remote --listen-https=-3 --output=/var/log/journal/remote/ Paso 4 : Configurar el cliente Añadiremos los ficheros correspondientes a la configuración , tu clave privada y tu certificado correspondiente así como el certificado de la CA con el que hayas generado estos :\n[javiercruces@hela ~]$ sudo cat /etc/systemd/journal-upload.conf [Upload] URL=https://odin.javiercd.gonzalonazareno.org/ ServerKeyFile=/etc/letsencrypt/live/hela.javiercd.es/odin.key ServerCertificateFile=/etc/letsencrypt/live/hela.javiercd.es/odin.crt TrustedCertificateFile=/etc/letsencrypt/live/hela.javiercd.es/ca.crt Reiniciamos el servicio y comprobamos el estado del mismo :\n[javiercruces@hela ~]$ sudo systemctl restart systemd-journal-upload.service [javiercruces@hela ~]$ sudo systemctl status systemd-journal-upload.service ● systemd-journal-upload.service - Journal Remote Upload Service Loaded: loaded (/usr/lib/systemd/system/systemd-journal-upload.service; enabled; preset: disabled) Active: active (running) since Wed 2024-01-31 19:38:53 UTC; 2s ago Docs: man:systemd-journal-upload(8) Main PID: 4628 (systemd-journal) Status: \u0026#34;Processing input...\u0026#34; Tasks: 1 (limit: 10840) Memory: 4.1M CPU: 53ms CGroup: /system.slice/systemd-journal-upload.service └─4628 /usr/lib/systemd/systemd-journal-upload --save-state Jan 31 19:38:53 hela.javiercd.gonzalonazareno.org systemd[1]: Started Journal Remote Upload Service. Paso 5 : Comprobación de funcionamiento Una vez estén los dos servicios levantados , se nos guardaran en el servidor un fichero con los logs de nuestro cliente :\njaviercruces@odin:~$ sudo ls -la /var/log/journal/remote/ total 8204 drwxr-xr-x 2 systemd-journal-remote systemd-journal-remote 4096 Jan 31 18:59 . drwxr-sr-x+ 4 root systemd-journal 4096 Jan 24 13:01 .. -rw-r----- 1 systemd-journal-remote systemd-journal-remote 8388608 Jan 31 19:38 remote-172.16.0.200.journal Podemos ver los logs de los diferentes servicios , por ejemplo filtrare por httpd :\njaviercruces@odin:~$ sudo journalctl -u httpd --file=/var/log/journal/remote/remote-172.16.0.200.journal Jan 30 08:32:30 hela.javiercd.gonzalonazareno.org systemd[1]: Starting The Apache HTTP Server... Jan 30 08:32:31 hela.javiercd.gonzalonazareno.org httpd[775]: [Tue Jan 30 08:32:31.395719 2024] [so:warn] [pid 775:tid 775] AH01574: module rewrite_module is already loaded, skipping Jan 30 08:32:31 hela.javiercd.gonzalonazareno.org httpd[775]: Server configured, listening on: port 80 Jan 30 08:32:31 hela.javiercd.gonzalonazareno.org systemd[1]: Started The Apache HTTP Server. ","date":"September 20, 2023","hero":"/images/sistemas/recoleccion_logs_journald/journal.jpg","permalink":"https://www.javiercd.es/posts/sistemas/recoleccion_logs_journald/recoleccion_logs_journald/","summary":"\u003ch2 id=\"paso-1-instalar-systemd-journal-remote\"\u003ePaso 1 Instalar systemd-journal-remote\u003c/h2\u003e\n\u003cp\u003eEn nuestro entorno, el primer paso consistirá en instalar el paquete systemd-journal-remote, que nos permitirá acceder a estas máquinas de forma remota. Para llevar a cabo la instalación en las máquinas de nuestro escenario, utilizaremos el gestor de paquetes apt en Odin, que ejecuta Debian 12. Asimismo, instalaremos el mismo paquete en Thor y Loki, que son contenedores alojados dentro de Odin. En cuanto a Hela, un sistema operativo Rocky, requerirá el uso de dnf para la instalación.\u003c/p\u003e","tags":["ASO","DEBIAN"],"title":"Recolección centralizada de logs de sistema, mediante journald"},{"categories":null,"contents":"Documento en el cual se detallan los principales comandos a la hora de detectar incidencias en redes y lograr solucionarlos .\nComandos en Windows Explica el significado de los distintos parámetros a configurar en las Propiedades de TCP/IP en Windows Tenemos que tener en cuenta que cada configuración que hagamos es independiente para cada uno de nuestros adaptadores de red .\nPara acceder a configurar estos parámetros seguiremos la siguiente ruta en nuestro sistema :\nPanel de control \u0026gt;Redes e Internet \u0026gt; Centro de redes y recursos compartidos \u0026gt; Cambiar configuración del adaptador :\nUna vez aquí le daremos Clic derecho \u0026gt; Propiedades \u0026gt; Protocolo de version 4 (TCP/IP)\nUna vez aquí veremos dos pestañas a la cual podemos dirigirnos para configurar nuestra tarjeta , en la pestaña general podemos observar los siguiente apartados :\nEl primer apartado (General) relacionado con nuestra dirección ip :\nObtener una dirección ip automáticamente : Marcaremos esta opción cuando queramos que se use el servicio DHCP para asignar mediante el servicio dirección IP , mascara de subred y la puerta de enlace predeterminada . Usar la siguiente dirección IP : Aquí introduciremos nosotros manualmente la configuración de red deseada : Dirección IP: es una etiqueta numérica que identifica a nuestra maquina de manera única en nuestra red , no puede estar repetida . Mascara de subred : conjunto numérico cuya función es indicar a los dispositivos qué parte de la dirección IP es el número de la red incluyendo la subred, y qué parte es la correspondiente al host. Puerta de enlace predeterminada : Es la dirección ip predeterminada que se le asigna a un equipo para enviar los paquetes a otras redes . En el segundo apartado de esta pestaña realizaremos la configuración referente a los servidores DNS los cuales permitirán traducirnos nombres a direcciones IP para poder navegar .\nObtener la dirección del servidor DNS automáticamente : Esta opción hará que la dirección se obtenga del servidor DHCP que tengamos configurado en nuestra red . Usar la siguientes direcciones del servidor DNS : Esta opción nos sirve para manualmente seleccionar la dirección ip de nuestros servidores DNS: Servidor DNS preferido : La dirección que pongamos aquí sera la primera en consultar en caso de que necesite hacer una resolución Servidor DNS alternativo : Si el servidor primario fallase o estuviera caído en ese momento pasaríamos a utilizar el secundario . En la pestaña configuración alternativa , esta pensado para equipos que necesiten usarse en mas de una red , suele verse en entornos profesionales :\nDirección ip privada automática : Hará uso del servidor DHCP para configurarse . Configurada por el usuario : Nos permitirá introducirla manualmente la configuración (omitiré los campos explicados anteriormente ) : WINS preferido : es un servidor de nombres de Microsoft para NetBIOS, que mantiene una tabla con la correspondencia entre direcciones IP y nombres NetBIOS de ordenadores . WINS alternativo : Si el servidor primario fallase o estuviera caído en ese momento pasaríamos a utilizar el secundario . Utilidad del comando ping Ping es un comando o una herramienta de diagnóstico que permite hacer una verificación del estado de una determinada conexión de un host local con al menos un equipo remoto contemplado en una red de tipo TCP/IP , es la herramienta de diagnostico de redes mas conocida .\nLos usos mas comunes de esta herramienta son :\nComprobar la conectividad de una red. Medir la latencia que tardan en comunicarse dos puntos . Conocer la dirección IP utilizada por un nombre de dominio. Scripts que permiten llevar un registro de la disponibilidad de un servidor remoto. Scripts que permiten conocer cuando existe conexión en un equipo. Para hacer uso de este abriremos una cmd , pulsaremos WIN + R y escribiremos cmd .\nUso general de Ping La sintaxis mas simple de ping es la siguiente : ping [Parámetros] [IP/Nombre]\nSi nos fijamos en la salida del comando vemos que nos permite conoces :\nDirección IP que corresponde al nombre de la máquina remota. El número de secuencia ICMP (“Código que nos devuelve , ej : 0=red inaccesible”). TTL: Tiempo de vida en segundos; como este valor se decrementa en cada máquina en la cual es procesado, debe ser al menos igual o mayor que el número de saltos que dará .Si alguna vez este número es cero, el router interpretará que el paquete está viajando en círculos, por lo tanto, finaliza el proceso. **Latencia :**corresponde al lapso de tiempo en milisegundos que se necesita para dar una vuelta entre las máquinas fuente y destino. Como regla general, la demora de un paquete no debe ser mayor a 200 ms. Estadísticas del ping : Nos reúne toda la información mostrándonos los paquetes perdidos , enviados y recibidos . Además nos muestra el paquete con menor latencia y con mayor así como una media aritmética . PING -T Este parámetro nos permitirá hacer un ping infinito es decir no finalizara hasta que matemos el proceso , si no lo pusiésemos por defecto solo se enviaran 4 trazas . Para finalizar este la ejecución de este comando pulsaremos CTRL + C .\nCuando detengamos la ejecución nos mostrara las estadísticas que ha recopilado , paquetes enviados, paquetes recibidos y paquetes perdidos así como los tiempos medios de ida y vuelta .\nPING -A Este parámetro sirve para que nos resuelva una ip en un nombre de host ,imprimiendo una linea indicando el nombre de host al cual le estamos dirigiendo las trazas , lo que nos permite identificar mas fácilmente las maquinas :\nPING -N Este parámetro sirve para especificar el numero de solicitudes echo que deseemos al enviar paquetes , este lo indicaremos con un numero comprendido entre 1 – 4294967295 .\nPor ejemplo si queremos enviar 10 trazas el comando seria el siguiente :\nPodemos comprobar en la parte inferior que ha enviado en numero que le hemos indicado .\nPING -L Nos permite modificar el tamaño en bytes de los paquetes enviados , deberemos especificar un numero entre 0 y 65000 .\nPING -F Este parámetro sirve para evitar que los paquetes se fragmenten , el tamaño máximo de los paquetes sin fragmentar es de 1472 bytes .\nPodemos ver que si superamos este numero , nos dará un error informándonos que es necesario fragmentar el paquete :\nPING -I Este parámetro nos permite especificar el numero máximo que se pueden dar hasta alcanzar al destino , el valor máximo que podemos introducir 255 .\nCuando especificamos un TTL esto fija el número máximo de saltos, al pasar por un nuevo dispositivo (un router) este descuenta 1 al TTL especificando hasta que llega a 0, en este caso el destino se mostrará como inalcanzable, de esta forma se evita que un paquete viaje por la red indefinidamente buscando un destino que puede que no exista.\nPING -4 -6 Ping -4 : Fuerza la respuesta del host especificado con una dirección IPv4. Es necesario que tanto el equipo que lanza el ping como el destino tengan una configuración IPv4 correcta.\nPing -6 : Fuerza la respuesta del host especificado con una dirección IPv6. Es necesario que tanto el equipo que lanza el ping como el destino tengan una configuración IPv6 correcta.\nComprobar conectividad en una red Vamos a efectuar una serie de pruebas para verificar el funcionamiento y encontrar errores . Lo primero sera hacernos ping a nosotros mismos para ello :\nSi la salida es correcta esto demuestra que nuestro adaptador de red funciona correctamente .\nVamos a hacerle ping a una maquina de nuestra red local , así demostraremos que las conexiones físicas son correctas :\nVamos a hacerle ping a la puerta de enlace , de tener éxito demuestra que existe conexión con el equipo que suministra internet :\nHaremos ping a un sitio de internet usando ip , para comprobar que tenemos conexión a internet :\nPor ultimo hacer ping a un dominio en internet ,de tener éxito demuestra que existe conexión a internet y los servidores DNS configurados en la conexión funcionan correctamente:\nUso general del comando ipconfig Este comando se usa para ver la configuración actual de los adaptadores de red de nuestro equipo , un ejemplo de uso general del comando es el siguiente :\nEste nos muestra la siguiente información :\nDescripción del adaptador : Nombre del adaptador o tarjeta de red utilizado en la conexión. Dirección IPV4: Es la dirección IP asignada al equipo en la red local. Puerta de enlace predeterminada: Es la dirección IP del equipo proporciona acceso a internet. Servidores DNS: Dirección ip del encargado de resolver nombre de dominio a dirección IP de las paginas solicitadas. Generalmente son dos, el principal y el secundario. Estado de DHCP: Configuración dinámica de host, en el caso del equipo mostrado se encuentra habilitada, eso significa que siempre se utilizará una dirección IP asignada por este servicio . A partir de estos parámetros podemos consultar la información del adaptador o identificar una incoherencia en la configuración del mismo .\nIPCONFIG /ALL Nos devolverá toda la información disponible de los adaptadores de red , es una salida mas detallada que si omitimos este parámetro , con este podemos consultar los servidores DNS y las direcciones MAC .\nIPCONFIG /RELEASE Se utiliza para liberar una dirección ip en el servicio DHCP , no se nos volverá a asignar una hasta que ejecutemos ipconfig /renew\nPodemos especificar el adaptador del cual queremos que se libere la ip escribiéndolo a continuación, si omitimos el nombre los aplicara a todos .\nEJ: ipconfig /release Ethernet0 –\u0026gt; Solo liberara la ip del adaptador Ethernet0 *****Si queremos liberar una dirección ipv6 utilizaremos el parámetro /release6\nIPCONFIG /RENEW Una vez ejecutado el comando anterior deberemos de ejecutar este para solicitar al servidor DHCP una nueva concesión de dirección IP .\nPodemos especificar el adaptador del cual queremos que se renueve la oferta DHCP escribiéndolo a continuación.\nEJ: ipconfig /renew Ethernet0 –\u0026gt; Solo renovara la concesión del adaptador Ethernet0 *****Si queremos renovar una dirección ipv6 utilizaremos el parámetro /renew6\nIPCONFIG /FLUSHDNS Se utiliza para vaciar la cache de resolución DNS de nuestro equipo local , suele utilizarse cuando queremos comprobar el correcto funcionamiento del servidor DNS .\nIPCONFIG /REGISTERDNS Actualiza todas las concesiones DHCP y vuelve a registrar los nombres DNS. Este comando esta orientado al trabajo en entornos de dominio y a la actualización de los registros dinámicos del servidor de DNS del sistema en el que se esta ejecutando, teniendo en cuenta que si esta bloqueada de alguna forma la actualización dinámica no se efectuará.\nIPCONFIG /DISPLAYDNS Este comando simplemente nos muestra las consultas DNS que se están almacenados en la caché de nuestro sistema de la forma que se muestran en la imagen, muestran datos de registros del protocolo IPv4 como de IPv6.\nIPCONFIG /SHOWCLASSID Este comando nos permite comprobar las clases de usuario configuradas en nuestro servidor DHCP y que estarán disponibles para los diferentes clientes.\n*Si queremos comprobarlo para IPV6 utilizaremos el parámetro /showclassid6 .\nUso general ARP El comando arp muestra y modifica las tablas de conversión de direcciones IP en direcciones\nMAC que utiliza el protocolo de resolución de direcciones (ARP).\nARP -A Pide los datos de protocolo actuales y muestra las entradas ARP actuales. Si se especifica inet_addr, solo se muestran las direcciones IP y física del equipo especificado. Si existe más de una interfaz de red que utilice ARP, se muestran las entradas de cada tabla ARP.\n* La opción -g hace la misma función :\nComo se muestra en la captura de pantalla el comando arp –a enumera todos los dispositivos que se encuentran actualmente en la caché ARP del host, lo cual incluye la dirección IPv4, la dirección física y el tipo de direccionamiento (estático/dinámico) para cada dispositivo.\nSi queremos borrar la cache arp utilizaremos la opción -d seguida del comodín * para borrar todas las entradas en esta tabla , si solo quisiéramos eliminar una consulta pondríamos la dirección IP .\nPodemos solicitar la MAC de una dirección usando arp + IP del dispositivo y posteriormente verla en nuestra tabla con arp -a .\nUso general netstat El comando netstat genera visualizaciones que muestran el estado de la red y estadísticas de protocolo. El estado de los protocolos TCP, SCTP y los puntos finales de UDP puede visualizarse en formato de tabla. También puede visualizarse información sobre la tabla de enrutamiento e información de interfaces.\nNETSTAT -A Muestra las todas conexiones y puertos de escucha de nuestro equipo , así como el estado del puerto y la dirección remota la cual esta usando el mismo :\nNETSTAT -B Muestra el archivo ejecutable implicado en la creación de cada conexión o puerto de escucha.\nNETSTAT -E Nos muestra estadísticas sobre las interfaces de red , sirve para ver la actividad que ha tenido esta:\nNETSTAT -R Nos muestra la tabla de enrutamiento , así podemos ver los sitios a los cual nuestro equipo es capaz de llegar a través de la red :\nNETSTAT -N Nos muestra las conexiones activas con un formato de tabla , similar al parámetro -a solo que este nos indica el numero de puerto en lugar del nombre .\nNETSTAT -O Similar al parámetro anterior pero este nos añade el PID del proceso :\nNETSTAT -P Nos permite filtrar las conexiones según el protocolo (TCP, UDP, tcpv6 o tcpv4…)\nNETSTAT -T Muestra el estado de descarga de la conexión actual :\nNetstat es muy interesante para ver datos estadísticos de la conexión, pero también va a ser muy útil para analizar los puertos abiertos en un momento determinado y así identificar problemas. Es esencial para determinadas aplicaciones y poder lograr un rendimiento óptimo .\nUso general nslookup Es una aplicación incluida en todos los sistemas Windows, para consultar, obtener información, probar y solucionar problemas con los servidores DNS .\nAl invocarlo sin especificar ningún parámetro, devolverá el nombre del servidor DNS predeterminado y su dirección IP :\nEl comando dispone de dos modos de uso , el tradicional a través de linea de comandos y el interactivo . Podemos usarlo para resolver nombres de direcciones desde la terminal poniendo nslookup seguido del nombre que queramos resolver :\nTambién podemos hacer consultas inversas , es decir que a través de la ip nos diga el nombre :\nPor ejemplo podemos seleccionar el tipo de registros DNS para hacer peticiones los cuales son :\nA: para buscar registros A que son los relacionados con la dirección IPv4.. AAAA: para buscar registros AAAA que son los relacionados con la dirección IPv6. Si una web utiliza direccionamiento IPv6 y nosotros también, entonces tendremos que indicar este registro DNS. PTR: para buscar registros reversos. MX :para buscar los registros Mail Exchange del correo. TXT:, para buscar registros de texto como SPF o DKIM. CNAME: para buscar alias del dominio, esto también se conoce como subdominios, por ejemplo, el «www» siempre es un subdominio del principal» o el típico «ftp.» que es también un subdominio. Para cambiar el tipo de registro utilizamos la orden set type=Nombre del registro , por ejemplo :\nTambién podemos elegir el servidor desde el cual realizamos las consultas de la siguiente manera :\nUso general tracert Sirve para trazar la ruta que hace un paquete entrante que viene desde un host o punto de red hasta tu ordenador , así conocemos por donde viaja nuestro viaje .\nDiciendo uno a uno todos los nodos y routers por los que pasa el mensaje de prueba que has enviado, sus direcciones IP y la latencia de cada uno de ellos hasta llegar a su destino.\nHay algunos nodos que no son capaces de respondernos por eso las entradas de tiempo de espera agotado .\nTenemos algunos parámetros interesantes como :\n-d : No convierte direcciones en nombres de host -h : Nos permite seleccionar el numero máximos de saltos -4 o -6 : Fuerza usar IPV4 o IPV6 : -w : Nos permite especificar el tiempo de espera en milisegundos : Uso general route print El comando Route se utiliza para visualizar y modificar la tabla de enrutamiento. Route print muestra una lista con las rutas actuales conocidas por IP para el host. Route add se utiliza para añadir rutas a la tabla, y route delete se utiliza para borrar rutas de la tabla.\nAsí podemos especificar el camino para llegar a una red o dispositivo .\nLa sintaxis es la siguiente : route [-f] [-p] [comando [destino]] [MASK máscara de red]\nComando route print sin parámetros para mostrar todo el contenido de la tabla de enrutamiento :\nSi deseamos borrar la tabla de enrutamiento deberemos de utilizar el parámetro -f :\nAdemás podemos añadir , rutas manuales de la siguiente manera :\n→ route add IP_Destino Mascara_Destino Puerta_de_enlace métrica interfaz\nSi queremos cambiar una ruta , la sintaxis es la misma que el comando anterior cambiando la orden add por change :\nCuando solo queramos eliminar una ruta , utilizaremos la orden delete seguida del destino :\n¿Cómo puedes averiguar la IP pública de tu router? Hay muchas forma de saber esto desde Windows , podemos utilizar el comando curl para pedir la siguiente web y que nos devuelva la ip :\nOtra forma desde la linea de comandos es hacer una consulta dns con nslookup al servicio opendns :\nSi tenemos un navegador podemos usar una de las muchas webs que nos dicen la dirección ip publica del router , yo uso la siguiente https://ipchicken.com/ :\nLinux Configurar una interfaz de red Para configurar una tarjeta de red en Linux podemos hacerlo desde la interfaz gráfica o desde linea de comandos .\nDesde interfaz gráfica nos dirigimos a Configuración \u0026gt; Inalámbrica o Red . Una vez aquí encenderemos la tarjeta y le daremos al engranaje .\nUna vez aquí podemos configurar manualmente la configuración de red de nuestra tarjeta .\nEsto mismo podremos hacerlo desde la linea de comandos editando el fichero /etc/network/interfaces con permisos de superusuario .\nDentro de este podemos indicar la configuración de nuestros adaptadores de red , aquí te indico con lineas comentadas los parámetros básicos que podemos indicar en este archivo .\nUna vez hayamos configurado nuestras interfaces los cambios no se aplicaran automáticamente , para hacer esto tenemos varias formas , la mas cómodas es reiniciar el servicio :\nOtra forma de cambiar los servidores DNS que se utilizan es a través del fichero /etc/resolf.conf\nAquí seguido de nameserver pondremos la dirección ip o nombre de nuestro servidor DNS\nUso general ifconfig Explica la utilidad del comando ifconfig a partir de una captura real. ¿Hay alguna información de las que se obtiene con ipconfig /all que no aparezca? Trata de conseguirla de otra forma.\nEs similar a ifconfig y esta enfocado a las mismas funciones , este comando también se utiliza para ver, cambiar y administrar todas las configuraciones actuales de la red informática.\nEsta se instala con el paquete net-tools , para instalarlo:\nPara utilizar esta herramienta necesitaremos hacerlo como superusuario , con su uso mas simple nos mostrara la configuración básica TCP/IP de nuestra tarjeta de red así como unas estadísticas de la misma :\nPor ejemplo con ipconfig /all podemos ver los servidores DNS configurados cosa que con ifconfig no podremos ver .\nAsí que tendremos que ver el fichero /etc/resolf.conf\nUn uso común de este comando es configurar rápidamente una interfaz de red , por ejemplo :\nEsto podemos ponerlo en una sola linea\nAdemás también podremos levantar y bajar la tarjeta de red\nUso general dhclient Este utiliza el protocolo de configuración dinámica de host para configurar dinámicamente los parámetros de red de la interfaz de red.\nEl siguiente comando indicará a dhclient que libere la concesión actual que tiene del servidor DHCP ,es decir que queremos liberar la ip actual . Utilizaremos los parámetros -r y -v\nSi queremos volver a pedir una configuración de red al comando dhcp utilizaremos solamente el parámetro -v .\nPrincipalmente este comando se usa para esto , para solucionar problemas con la configuración del servicio DHCP .\nAlgunos parámetros que no he mencionado y pueden resultar útil son :\n-6 : Sirve para indicar que quieres IPV6 -p: Sirve para indicar otro puerto para hacer la consulta -s : Sirve para indicar la dirección del servidor DHCP Diferencias de los comandos netstat y ping respecto a los empleados en Windows netstat muestra información sobre el subsistema de red en nuestro equipo al igual que Windows . Si nos fijamos en el manual nos indica que Esta aplicación está parcialmente obsoleta. El reemplazo de netstat es ss, para netstat -r tiene ip route, para netstat -i puede usar ip -s link y para netstat -g dispone de ip maddr.\nSi lanzamos el parámetro podemos ver a simple vista que nos muestra mas información sin indicar ningún parámetro , por lo demás estos son los mismo que en Windows .\nMientras que el comando ping la diferencia es que es por defecto infinito , a diferencia de Windows este no acabara hasta que lo detengamos nosotros .\nEn este los parámetros con respecto a Windows cambia su “letra ” , aquí serian :\n-i : Indicar el intervalo para enviar el siguiente paquete en segundos (por defecto es 1 ) -s : Cambiar el tamaño del paquete en bytes -f : inundación , para probar el rendimiento de la red bajo una carga pesada (envía una gran cantidad de paquetes lo más rápido posible) -c : Indicar el numero de trazas enviadas -w: Dejara de imprimir los resultados después de los segundos indicados -q: Elimina la salida del comando , opción silenciosa -a : hace un sonido cuando hay una respuesta -V indica la version del comando La utilidad de este sigue siendo la misma , solucionar problemas de accesibilidad de hosts en una red. Esto nos ayuda a comprender por qué un sitio web no se carga.\nUso general comando dig Dig es un comando que permite realizar consultas a servidores DNS para obtener información relacionada con este servicio. Para instalarlo en nuestro sistema , haremos un apt install dnsutils .\nPodemos hacer una consulta dns , por ejemplo al instituto para comprobar si somos capaces de obtener su dirección ip :\nUtilizando la opción +trace realiza consultas iterativas para resolver la búsqueda de nombres. Consultará los nombres de servidores a partir de la raíz y posteriormente atravesará el árbol del espacio de nombres mediante consultas iterativas siguiendo las referencias en el camino:\nTambién podemos realizar consultas inversas con la opción -x :\nDiferencias del comando traceroute de Linux con el comando tracert de Windows La herramienta traceroute es exactamente la misma que el tracert, pero se denomina de otra forma, aunque internamente puede hacer uso de diferentes protocolos, ya que en algunos sistemas operativos se hace uso del protocolo ICMP Echo Request/reply, y en otros de hace uso de mensajes UDP directamente para comprobar cuantos saltos hay de un host a otro .\nEstas se usan para detectar donde esta el error a la hora de acceder a un determinado equipo y saber en que nodo se produce el “error” .\nAlgunos parámetros que pueden interesarnos son :\n-f, :Establece la distancia entre el primer salto y el siguiente salto. -g,: nos permite indicar la puerta de enlace. -I : Usa ICMP ECHO -m, :Establece el número de saltos; el valor predeterminado es 64. -M, :las rutas de seguimiento se realizan con ICMP o UDP; el método predeterminado es UDP. -p: Define el puerto de red; el valor predeterminado es 33434. -q: Define el numero de paquetes por salto. –resolve-hostnames: puede usar esta sintaxis para corregir los nombres de host. -w, : Define el tiempo de espera en segundos. Uso general wget Wget es una herramienta informática creada por el Proyecto GNU. Puedes usarlo para recuperar contenido y archivos de varios servidores web. El nombre es una combinación de World Wide Web y la palabra get. Admite descargas a través de FTP, SFTP, HTTP y HTTPS.\nPara instalarlo usamos el comando apt install wget .\nUn ejemplo es para descargar archivos , por ejemplo una iso . Pondríamos el comando seguido de la url :\nEste nos descargara el archivo en el directorio actual de trabajo .\nPodemos utilizar el comando -o para indicar un nombre diferente al descargar el archivo :\nAlgunos parámetros interesantes son :\n-P : Indicar el directorio donde queremos guardar el archivos \u0026ndash;limit-rate : sirve para limitar la velocidad de descarga -tries : nos permite indicar el numero de reintentos de la descarga -b : Realizara la descarga en segundo plano -c para indicar que se reanude una descarga Si quisiéramos descargar archivos desde un servidor ftp utilizaríamos la siguiente sintaxis : wget –ftp-user=usuario\u0026ndash;ftp-password=contraseña\nUso general de tcpdump Tcpdump es una herramienta para línea de comandos cuya utilidad principal es analizar el tráfico que circula por la red. Permite al usuario capturar y mostrar en tiempo real los paquetes transmitidos y recibidos por la red a la cual el ordenador está conectado\nLos parámetros mas comunes son :\n-i Permite especificar la interfaz de red en la que vamos a atender el tráfico. -c Permite limitar la cantidad de paquetes capturados en un número determinado. -n Evita la resolución de puertos y direcciones ip a nombres. -e Muestra las cabeceras ethernet además del paquete ip. -t No imprime la estampa de tiempo de captura de cada paquete. -x Muestra el contenido hexadecimal de la trama capturada. -xx Idem a -x, pero además muestra el contenido de la cabecera Ethernet. -X Muestra el contenido hexadecimal y en ASCII de la trama capturada. -A Solo muesta el contenido ASCII del paquete capturado. -s Muestra solo los primeros bytes desde el principio del paquete. -vv Muestra información adicional, incluyendo parámetros de las cabeceras de protocolo. -w file Permite guardar la salida en un archivo con formato pcap. -r file Permite leer los paquetes previamente capturados y almacenados en un archivo pcap. Por ejemplo podemos hacer una captura de nuestra red de un máximo de 50 paquetes :\nComo ves la salida es indescifrable , para leerla usaremos el comando ngrep para buscar coincidencias sin tener en cuenta mayúsculas y minúsculas .\nUso general del comando arp El comando arp nos permitirá interactuar con la cache de resolución arp , modificándola por ejemplo .\nTambién podemos averiguar la dirección MAC de un dispositivo , buscándolo en la tabla :\nLos parámetros son los mismo que podemos encontrar en Windows :\n-a : Encontrar una determinada dirección en la tabla -v : Muestra todas las entradas -n : Muestra todas las entradas de forma numérica -d : elimina una resolución determinada También podemos hacer esto mismo con el comando ip :\nPara este la sintaxis básica es de la siguiente forma :\nadd : Añadir resolución del : Eliminar resolución change : Cambiar una resolución replace : Remplazar una resolución Por ejemplo para añadir una tabla :\nComando ip Podremos ver y configurar direcciones IP, ver y configurar tablas de enrutamiento, ver y configurar túneles IP, y también ver y configurar la interfaz física .\nEste se le añade un “segundo comando ” para indicar su funcion , son los siguientes :\nlink: nos sirve para configurar las interfaces de red físicas o lógicas, por ejemplo, para ver el estado de todas las interfaces de red. address: permite ver y configurar las direcciones IPv4 y IPv6 asociadas a las diferentes interfaces de red. Cada interfaz debe tener al menos, una dirección IP configurada. addrlabel: permite añadir una etiqueta neighbour: permite ver los enlaces de vecindad, es decir, se puede ver la tabla ARP del sistema operativo. rule: permite ver y configurar políticas de enrutado y cambiarlas, esto se utiliza sobre todo cuando vas a configurar varias tablas de enrutamiento. route: permite ver y configurar las tablas de enrutamiento, tanto de la tabla de enrutamiento principal, como de las «secundarias» que configures. tunnel: permite ver los túneles IP y también configurarlos. maddr: permite ver y configurar las direcciones multienlace. mroute: permite ver y configurar la tabla de enrutamiento multicast. mrule: permite ver y configurar políticas de enrutamiento de direcciones multicast. monitor: permite monitorizar el estado de las tarjetas de red de manera continua, también direcciones IP y rutas. ntable: gestiona el caché de neighbour (ARP) tuntap: gestiona las interfaces TUN/TAP, orientado a las VPN como OpenVPN o WireGuard. maddress: configuración de las direcciones multicast xfrm: gestiona las políticas IPsec. netns: administrar espacios de nombres de red l2tp: configuración de L2TP tcp_metrics: gestiona métricas TCP. token: gestiona los identificadores con token de las interfaces. Bibliografía Cambiar configuración TCP/IP Información general sobre comandos Información protocolo ICMP\nComando PING\nComando NSLOOKUP\nDescripción parámetros de los comandos Configuración red debian Comando ifconfig\nComando ip\n","date":"September 8, 2023","hero":"/images/redes/comando_de_supervision_de_redes/comando_de_supervision_de_redes.png","permalink":"https://www.javiercd.es/posts/redes/comandos_de_supervision_de_redes/comandos_de_supervisi%C3%B3n_de_redes/","summary":"\u003cp\u003eDocumento en el cual se detallan los principales comandos a la hora de detectar incidencias en redes y lograr solucionarlos .\u003c/p\u003e\n\u003ch2 id=\"comandos-en-windows\"\u003eComandos en Windows\u003c/h2\u003e\n\u003ch3 id=\"explica-el-significado-de-los-distintos-parámetros-a-configurar-en-las-propiedades-de-tcpip-en-windows\"\u003eExplica el significado de los distintos parámetros a configurar en las Propiedades de TCP/IP en Windows\u003c/h3\u003e\n\u003cp\u003eTenemos que tener en cuenta que cada configuración que hagamos es independiente para cada uno de nuestros adaptadores de red .\u003c/p\u003e\n\u003cp\u003ePara acceder a configurar estos parámetros seguiremos la siguiente ruta en nuestro sistema  :\u003c/p\u003e","tags":["Redes","comandos"],"title":"Comandos de supervisión de redes"},{"categories":null,"contents":"La tecnología NFS (Network File System) ha sido una pieza fundamental en la compartición de archivos en entornos de red. Desarrollada por Sun Microsystems, NFS permite a sistemas operativos Unix y Linux compartir recursos de archivos de manera transparente, brindando acceso a archivos y directorios remotos como si estuvieran almacenados localmente.\n1.Instalación y configuración NFS Instalamos el paquete nfs-kernel-server.\nCrearemos el directorio que vamos a compartir y le cambiamos los dueños y los permisos del mismo :\nEn el fichero etc/exports indicaremos cual es nuestro directorio y sus respectivos permisos :\nro: permiso de solo lectura del directorio rw: permiso de lectura y escritura del directorio subtree_check: especifica la verificación de subdirectorios no_subtree_check: previene verificación de subdirectorios sync: Escribe todos los cambios en el disco antes de aplicarlo Async: ignora la verificación de sincronización para mejorar la velocidad Aplicamos los cambios y reiniciamos el servicio :\n2.Visualizarlo en un cliente debian Nos instalaremos el siguiente paquete :\nLa montamos en nuestro cliente :\nTambién podemos hacerlo de forma permanente en el fstab :\nPodemos visualizar el contenido :\nVamos a crear un archivo y a comprobar que se ha creado en el servidor :\n3.Visualización en Windows Nos descargamos la característica de cliente NFS:\nMapeamos la unidad de red :\nCreamos un fichero de forma remota y comprobamos que se ha creado .\nLo comprobamos también en el servidor :\n","date":"September 8, 2023","hero":"/images/sistemas/nfs/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/nfs_debian/nfs/","summary":"\u003cp\u003eLa tecnología NFS (Network File System) ha sido una pieza fundamental en la compartición de archivos en entornos de red. Desarrollada por Sun Microsystems, NFS permite a sistemas operativos Unix y Linux compartir recursos de archivos de manera transparente, brindando acceso a archivos y directorios remotos como si estuvieran almacenados localmente.\u003c/p\u003e\n\u003ch2 id=\"1instalación--y-configuración-nfs\"\u003e1.Instalación  y configuración NFS\u003c/h2\u003e\n\u003cp\u003eInstalamos el paquete nfs-kernel-server.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/nfs_debian/img/Aspose.Words.11ce2099-f519-43cd-a00b-9a47a367ade4.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCrearemos el directorio que vamos a compartir  y le cambiamos los dueños y los permisos del mismo :\u003c/p\u003e","tags":["Linux","Sistemas","ISO","ASO"],"title":"Compartir directorios con NFS en debian"},{"categories":null,"contents":"En el entorno empresarial, la capacidad de compartir recursos en red es esencial para la colaboración y la eficiencia operativa. En este artículo, exploraremos cómo compartir directorios en un entorno Windows Server, abordando los métodos tanto a través de la interfaz gráfica como mediante cmd y PowerShell.\nDesde la interfaz gráfica Podemos compartir un directorio de nuestro servidor , accediendo a las propiedades del mismo . Una vez aquí pulsamos sobre el menú compartir :\nAhora le daremos permisos a los usuarios que deseemos que tengan acceso a este :\nUna vez compartido nos mostrara la ruta que tendremos que poner para acceder a este recurso , que podemos modificarla a nuestro gusto en uso compartido avanzado :\nDesde un cliente podemos ver los recursos que esta compartiendo nuestro servidor usando net view :\nPodemos mapear la unidad de red desde la linea de comandos usando net use :\nVamos a crear un directorio y comprobar que se ha creado :\nVemos que en el servidor se ha creado :\nTambién podemos hacer esto desde la administración de usuarios y grupos de active directory :\nCompartir recursos desde cmd Ahora vamos a usar net share para compartir un recurso en red a traves de la linea de comandos :\nSi desde otro cliente vemos los recursos que comparte el server core , lo veremos :\nSi queremos cambiar los permisos de un recurso compartido podemos usar los comandos cacls y icacls . También tenemos la posibilidad de hacerlo usando la interfaz gráfica con las RSAT.\nComandos powershell Crearemos el recurso compartido\nNew-SmbShare -Name JCD\\_comp -Path \u0026#34;C:\\compartir\\\u0026#34; -FullAccess \u0026#34;Administrador\u0026#34; Si queremos añadir permisos específicos a un grupo a la hora de crear el recurso compartido seria :\nNew-SmbShare -Name \u0026lt;Nombre-de-la-carpeta\u0026gt; -Path \u0026lt;Ruta-de-la-carpeta\u0026gt; -ReadAccess \u0026#34;\u0026lt;Grupo-o-usuario-que-tiene-acceso-de-lectura\u0026gt;\u0026#34; -FullAccess \u0026#34;\u0026lt;Grupo-o-usuario-que-tiene- acceso-total\u0026gt;\u0026#34; Si después de esto queremos añadirle o quitarle permisos a algún usuario o grupo al directorio samba compartido :\nSet-SmbPathAcl -Path \u0026#34;C:\\compartir\u0026#34; -AceType Allow -AccessType Write -AccountName UsuariosCompartidos Si por el contrario queremos eliminar permisos al usuario o grupo :\nRemove-SmbPathAcl -Path \u0026#34;C:\\compartir\u0026#34; -AceType Allow -AccessType Write -AccountName UsuariosCompartidos Para montar este directorio compartido en otro host Windows :\nNew-PSDrive -Name J -PSProvider FileSystem -Root [\\\\172.22.9.143\\JCD_comp](file://172.22.9.143/JCD_comp) Además podemos listar para ver si se ha montado correctamente :\nListaremos el contenido del mismo para ver si tenemos acceso a el :\n","date":"September 8, 2023","hero":"/images/sistemas/compartir_directorios_win/portada.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comparticion_de_directorios_en_windows/comparticion_de_directorios_en_windows/","summary":"\u003cp\u003eEn el entorno empresarial, la capacidad de compartir recursos en red es esencial para la colaboración y la eficiencia operativa. En este artículo, exploraremos cómo compartir directorios en un entorno Windows Server, abordando los métodos tanto a través de la interfaz gráfica como mediante cmd y PowerShell.\u003c/p\u003e\n\u003ch2 id=\"desde-la-interfaz-gráfica\"\u003eDesde la interfaz gráfica\u003c/h2\u003e\n\u003cp\u003ePodemos compartir un directorio de nuestro servidor , accediendo a las propiedades del mismo . Una vez aquí pulsamos sobre el menú compartir :\u003c/p\u003e","tags":["Windows","Sistemas","ISO","ASO"],"title":"Compartir recursos en red en Windows Server"},{"categories":null,"contents":"Instalar un servidor web Apache para el uso en una Intranet Para instalar el servidor debemos ejecutar como root el siguiente comando:\nCrea dentro del directorio /var/www/html un fichero llamado entrada.html en el que pongáis un mensaje de bienvenida\nAhora lo meteré dentro de la ruta :\nA continuación vamos a publicar una página más completa en nuestro servidor, para ello\nutiliza tu sitio web de aplicaciones web.\nAdemas debemos de darle permisos de lectura a otros para que podamos visualizarla :\nAccede desde los clientes, poniendo en un navegador la siguiente URL:\nDesde debian cliente :\nA continuación vamos a publicar una página más completa en nuestro servidor, para ello utiliza tu sitio web de aplicaciones web:\nResolución local de nombres : modifica los ficheros necesarios en el servicio BIND y accede usando el nombre que has indicado :\nComo ya tenia echo el dns anteriormente he utilizado este nombre :\nConfiguración de sitios web virtuales usando Apache La primera web tendrá el directorio base será /var/www/iesgn y contendrá una página llamada index.html, donde sólo se verá una bienvenida a la página del instituto Gonzalo Nazareno .\nLa segunda web tendrá el directorio base será /var/www/departamentos. En este sitio sólo tendremos una página inicial index.html, dando la bienvenida a la página de los departamentos del instituto.\nNecesitamos tener dos ficheros para realizar la configuración de los dos sitios virtuales, para ello vamos a copiar el fichero 000-default.conf\nUna vez hayamos creado los ficheros añadiremos dentro de cada uno el siguiente contenido :\nAhora deberemos crear un enlace simbólico en el directorio /etc/apache2/sites-enabled.\nPara que se apliquen estos cambios debemos reiniciar el servicio :\nAhora deberemos de actualizar el dns :\nUna vez reiniciado el dns podremos acceder a ambos sitios desde el navegador :\nAcceso autentificado al servidor web Apache Para activar la autentificación básica debemos de añadir las siguientes lineas a nuestro archivo de configuración del sitio :\nAhora creamos el archivo de las contraseñas , con el usuario previamente creado :\nReiniciamos el servicio y nos conectamos :\nAhora vamos ha hacer que a la pagina departamentos solo acceda el director y el profesor , ademas que a dirección solo acceda el director , para eso añadimos en departamentos:\nAhora vamos a añadir los usuarios de las zonas para eso , utilizamos este comando :\nUsuario profesor a departamentos : Usuario director a departamentos : Usuario director a zona dirección : Ahora reiniciaremos el servicio y comprobaremos que podemos acceder :\nAccederemos a departamentos :\nAhora a la zona equipo directivo :\n","date":"September 8, 2023","hero":"/images/servicios/apache/portada-apache.jpg","permalink":"https://www.javiercd.es/posts/servicios/apache/apache/","summary":"\u003ch2 id=\"instalar-un-servidor-web-apache-para-el-uso-en-una-intranet\"\u003eInstalar un servidor web Apache para el uso en una Intranet\u003c/h2\u003e\n\u003cp\u003ePara instalar el servidor debemos ejecutar como root el siguiente comando:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/apache/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.125.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCrea dentro del directorio /var/www/html un fichero llamado entrada.html en el que pongáis un mensaje de bienvenida\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/apache/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.126.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora  lo meteré dentro de la ruta :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/apache/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.127.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eA continuación vamos a publicar una página más completa en nuestro servidor, para ello\u003c/p\u003e\n\u003cp\u003eutiliza tu sitio web de aplicaciones web.\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT","SSH","FORWARDING","APACHE"],"title":"Configuración Apache bajo debian"},{"categories":null,"contents":"En este artículo, exploraremos la configuración de SNAT (Source Network Address Translation) y DNAT (Destination Network Address Translation) en escenarios con direcciones públicas, haciendo uso de routers en entornos Linux y dispositivos Cisco.\nEscenario con maquinas debian Preparación del entorno Instalación de paquetes Una vez colocadas las maquinas deberemos de descargarnos apache para los servidores web , para realizar esto conectaremos ambos servidores a un switch y este a la nube NAT para disponer de acceso a internet .\nAhora actualizaremos los repositorios haciendo un apt update :\nA continuación ya podremos descargar los paquetes , para los servidores instalaremos apache :\nY para el router de casa descargaremos el servidor DHCP :\nAl acabar la instalación saltara un código de error similar a este , esto es debido a que no hay una configuración valida en el servicio :\nPor ahora ignoraremos esto y posteriormente configuraremos el servidor DHCP .\nCon esto habríamos instalado todos los paquetes necesarios para instalar la practica así que podemos montar el escenario .\nConfiguración de las tarjetas de red Nos encontraremos con un pequeño obstáculo a la hora de hacer el escenario ya que necesitamos que algunos routers tengan mas de una tarjeta de red .\nPara añadir mas de una tarjeta con el dispositivo apagado y sin estar conectado a nadie , hacemos sobre el clic derecho y pulsamos sobre configure \u0026gt; network , y seleccionamos el numero de adaptadores que necesitamos tener en cada uno , por ejemplo para el router de casa necesito tener dos adaptadores :\nUna vez hecho esto con las maquinas que necesitan mas de una tarjeta , montaremos el escenario y procederemos a configurar sus tarjetas .\nPara modificar la configuración de las tarjetas de red lo haremos editando el fichero /etc/network/interfaces .Para que se aplique la configuración de las tarjetas de red que hemos realizado tenemos varias opciones .\nSubir y bajar la tarjeta que hemos modificado :\nTambién podemos ahorrar tiempo y reiniciar el servicio de networking , esto funcionara para todas las tarjetas simultáneamente así que nos ahorrara tiempo :\nRouter CASA:\nRouter R1:\nRouter ISP:\nRouter R2:\nAsí seria la relación de ips que tienen las tarjetas de red de los routers . Para aplicar esta configuración a las tarjetas de red tendremos que reiniciar la misma como indico al principio de este apartado .\nPara que el escenario funcione debemos activar el bit de forwarding para estos 4 routers , en este caso lo haré de forma permanente para ello editamos el fichero /etc/sysctl.conf y descomentamos esta linea :\nRutas necesarias Para mi esquema actual las rutas que necesitamos en los routers son :\nRouter R1:\nRouter ISP:\nRouter R2:\nRouter CASA:\nComprobación de conectividad Vamos a hacer ping desde cada uno de los routers a su extremos “mas lejanos” para asegurarnos de que hemos realizado correctamente el enrutamiento .\nRouter R1 –\u0026gt; R2\nRouter R1 –\u0026gt; CASA\nRouter R2 –\u0026gt; R1\nRouter R2 –\u0026gt; CASA\nRouter CASA –\u0026gt; R1\nRouter CASA –\u0026gt; R2\nVemos que todos los dispositivos que tiene direcciónes ips publicas tienen conectividad entre si pero que pasa con los que tienen direcciónamiento privado en nuestro escenario , estos no tendrán conectividad ya que no se enrutan direcciónes privadas en los routers de internet .\nEs decir si lanzamos un ping hacia una dirección privada que sea de otra red , por ejemplo del servidor1 al servidor2 este no llegara , ya que en las tablas de enrutamiento del router del ISP no existen rutas para direcciónes privadas .\nPor lo que sera imposible alcanzar una red privada diferente a la que pertenezcamos .\nPor ejemplo desde casa si le hacemos ping a google se lo hacemos a la dirección PUBLICA 8..8.8.8 no a la dirección privada que tiene el servidor , puede ser la 172.22.1.15\nConfiguración del servicio DHCP en router CASA Retomando lo que habíamos hecho anteriormente en el apartado de instalación de paquetes ya hemos descargado el servidor DHCP para debian (isc-dhcp-server). Así que ahora vamos a configurarlo .\nLo primero que necesitamos hacer es decirle a nuestro servidor a través de que tarjeta de red queremos que este reparta direcciónes ip , en nuestro caso es la tarjeta ens5 .\nPara ello editaremos el fichero /etc/default/isc-dhcp-server y añadiremos el nombre de la tarjeta en la sección de IPV4 :\nAhora vamos a indicarle a nuestro servidor DHCP que configuración queremos que le asigne a nuestros clientes para ello editamos el fichero /etc/dhcp/dhcpd.conf , podemos aprovechar uno de los ejemplos que vienen comentados y aplicar nuestra configuración :\nEste es un ejemplo muy sencillo de un servidor dhcp pero con esto es suficiente para nuestro escenario .\nLos campos significan :\nsubnet : dirección de red de la cual queremos repartir direcciónes ip con este servicio . netmask : Mascara de red de la red la cual queremos configurar los dispositivos. range: Rango de direcciónes de la cual queremos repartir ips siendo la primera la inicial y la ultima la final . option routers: Seria la puerta de enlace de nuestra red option broadcast-address : dirección de broadcast de nuestra red . Una vez configurado con los parámetros de nuestra red reiniciaremos el servicio :\nY comprobaremos que el servicio esta activo :\nAhora para que los clientes puedan recibir una dirección utilizando este servicio deberemos de configurar las tarjetas de red de PC1 y PC2 de la siguiente manera :\nReiniciamos el servicio para que esta se aplique y el servidor nos asigne automáticamente la configuración de red :\nComprobamos que efectivamente nos ha asignado la configuración de la red :\nTambién podemos hacer un seguimiento de a quien le hemos asignado la ip través del servidor viendo el siguiente archivo /var/lib/dhcp/dhcpd.leases el cual guarda las concesiones que hemos realizado .\nPodemos ver cuando empieza así como a quien se le ha asignado viendo su dirección MAC.\nConfiguración de NAT Router CASA Vamos a configurar el SNAT en el router de casa viendo el esquema actual la regla para hacer esto es :\nSin embargo así se eliminaría cuando reiniciase la maquina así que en este caso voy a añadirla al /etc/network/interfaces :\nAsí podemos ver que se han aplicado después de reiniciar el servicio networking :\nVamos a comprobar que funciona la regla viendo si lanzo un ping a otra red (R1) si este cambia mi dirección IP :\nVemos que haciendo la captura este me ha cambiado la dirección privada de la maquina por la publica del router de casa por lo que la regla de SNAT estaría funcionando correctamente .\nRouter R2 Vamos a configurar SNAT y DNAT para ello añadiré las reglas al /etc/network/interfaces :\nReiniciamos el servicio networking y vemos si se ha aplicado :\nComprobaremos que funciona el SNAT haciendo ping del servidor hacia fuera a una dirección publica :\nVemos que esta funcionando correctamente la regla de SNAT :\nYa que nos ha cambiado la dirección ip privada por la publica correspondiente al router . En los apartados posteriores probare el DNAT .\nRouter R1 Para este router vamos a realizar la creación de las reglas de una forma diferente , para ella crearemos un servicio que se encargue de levantar las reglas de DNAT y SNAT cuando la maquina se reinicie para evitar añadirlas al fichero interfaces .\nLas reglas de DNAT y SNAT para esta maquina son :\nLo primero que tendremos que hacer sera crear un script con nuestras reglas , así que las volcare con el comando iptables-save \u0026gt; /etc/iptables/rules.v4 para volcar las reglas existentes .\nAhora crearemos un script en en el cual restauraremos las reglas que hemos volcado y lo crearemos en la siguiente ruta /usr/local/bin/ :\nNos tendremos que asegurar que tiene permisos de ejecución :\nCrearemos un archivo de servicio de Systemd , este archivo debe tener permisos de lectura y escritura solo para root, por lo que se debe ejecutar el siguiente comando como root:\nDentro de este añadiremos el siguiente contenido , solo tendrías que añadir la ruta donde se encuentre tu script de iptables que restaura las reglas :\nLe diremos al servicio que se inicie automáticamente al reiniciar la maquina :\nY lo iniciamos :\nSi queremos asegurarnos de que ha realizado su cometido correctamente miraremos el estado del servicio :\nVeremos que las reglas se han añadido automáticamente :\nComprobaremos que nos ha realizado el SNAT correctamente lanzando un ping :\nVemos que nos ha cambiado la dirección ip privada por la publica .\nComprobación de navegación y DNAT Ahora vamos a comprobar que desde la red de casa podemos acceder a los servidores web .\nCliente Debian Desde el cliente debian podemos hacer un curl para comprobar el correcto funcionamiento del DNAT en el Router R1:\nDesde el cliente debian podemos hacer un curl para comprobar el correcto funcionamiento del DNAT en el Router R2:\nAhora vamos a comprobar que pasa si ponemos la dirección privada de los distintos servidores web :\nVemos que no podemos llegar a esa red ya que los routers de internet son incapaces de encaminarnos hacia esta red privada ya que puede haber miles de dispositivos con la misma ip :\nTampoco recibiríamos respuesta si hiciésemos una petición web .\nSi interceptamos una petición http vemos que el SNAT se realiza correctamente , cambiando la ip privada del solicitante por la publica de su router :\nAhora voy a interceptar una petición en la que se haga DNAT para comprobar que este se realiza correctamente :\nPodemos ver que el origen es una dirección ip publica mientras que el destino es una dirección ip privada podemos ver que el DNAT se ha realizado correctamente .\nAhora voy a pinchar un Firefox y volveré a comprobar que podemos acceder a los servidores web solo usando su dirección ip publica :\nServer 1 :\nServer 2:\nVemos que usando dirección ip publica podemos conectarnos , sin embargo no podremos usando las direcciónes ips privada de las maquinas :\nServer 1 :\nServer 2 :\nFunciona correctamente ya que hemos conseguido que nuestros routers Linux sean capaces de hacer SNAT y DNAT pudiendo hacer que estos “utilicen” internet y puedan acceder a los recursos de otras redes . Ya que las direcciónes privadas no se enrutan en los mismos así que si comprobamos usando estas no obtendremos ningún resultado .\nDepuración NAT Para ver cuantos hits ha tenido una regla o para ver cuanta información ha “utilizado” cada regla utilizaremos el siguiente comando :\nPara borrar los contadores de todas las cadenas y reglas usaremos iptables -Z :\nSi nuestra cadena tiene hits la regla estará funcionando correctamente si por el contrario esta se mantiene en 0 , la regla no se esta aplicando así que tendremos que revisarla .\nEscenario con routers Cisco Volveremos a repetir el mismo escenario que con los routers Linux pero ahora usando routers cisco 7200.\nPreparación del entorno Configuración de las tarjetas de red Lo primeros que haremos sera añadirle los slots necesarios a nuestros routers ya que necesitamos 2 tarjetas de red en R1,R2 y CASA . Edemas de 3 para el router ISP .\nPara los primeros le añadiremos el slot PA-FE-TX , que nos añadirá una interfaz FastEthernet:\nMientras que para el router del ISP le añadiremos PA-2FE-TX que nos añadirá dos interfaces de red FastEthernet.\nAhora podemos arrancar los routers y comenzar con la configuración de las tarjetas de red . Usare las mismas direcciónes que en el escenario anterior .\nRouter CASA Configuramos las tarjetas de red :\nQuedando así nuestras interfaces :\nRouter R1 Configuramos las tarjetas de red :\nQuedando así nuestras interfaces :\nRouter R2 Configuramos las tarjetas de red :\nQuedando así nuestras interfaces :\nRouter ISP Configuramos las tarjetas de red :\nQuedando así nuestras interfaces :\nRutas necesarias Rutas ISP: Rutas CASA : Rutas R2: Rutas R1: Seria necesario únicamente que añadamos las rutas por defecto en los Routers R1 , R2 y CASA .\nPrueba de conectividad R1 –\u0026gt; R2\nR1 –\u0026gt; CASA\nR2-→ R1\nR2 –\u0026gt; CASA\nCASA –\u0026gt; R1\nCASA –\u0026gt; R2\nVemos que todos los dispositivos que tiene direcciónes ips publicas tienen conectividad entre si pero que pasa con los que tienen direcciónamiento privado en nuestro escenario , estos no tendrán conectividad ya que no se enrutan direcciónes privadas en los routers de internet .\nConfiguración del servicio DHCP en router CASA Lo primero que haremos sera establecer el rango de IP´s excluidas del conjunto (pool) de direcciónes que podrá asignar el servicio indicando la ip inicial y final del rango, ambas incluidas:\nPonemos un nombre al rango del servicio DHCP:\nDefinimos la red a la que dará servicio de DHCP:\nIncluimos la puerta de enlace que ofrecerá el servicio :\nCon esto ya estaría configurado el servidor DHCP del router de CASA , nos salimos y guardamos los cambios . Ahora encenderemos nuestras maquinas y veremos que están recibirán automáticamente su configuración por DHCP , con el siguiente comando podemos ver las estadísticas del servicio :\nAdemás podemos ver las concesiones con el siguiente comando :\nEste nos sera útil para realizar un seguimiento de quien tiene asignada cada IP sin tener que ir individualmente a casa maquina .\nConfiguración del NAT Router CASA Lo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nip nat pool ip_publica 102.168.0.2 102.168.0.2 netmask 255.255.255.0 Activamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nEl SNAT estaría funcionando , así que vamos a comprobarlo :\nVemos que nos cambia correctamente la ip privada de nuestro host por la publica del router de casa .\nRouter R1 Lo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nip nat pool ip_publica 101.168.0.2 101.168.0.2 netmask 255.255.255.0 Activamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nY comprobaremos que se esta realizando correctamente :\nNos cambia la ip 172.22.1.1 por la 101.168.0.2 que es la publica del router al realizar un ping , por lo que esta funcionando correctamente el SNAT.\nAhora configuraremos la regla de DNAT , la sintaxis es la siguiente :\nip nat inside source static tcp ip_privada puerto ip_publica puerto *Posteriormente comprobaremos que el DNAT funciona correctamente .\nRouter R2 Lo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nip nat pool ip_publica 103.168.0.2 103.168.0.2 netmask 255.255.255.0 Activamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nY comprobaremos que se esta realizando correctamente :\n*Nos cambia la ip 10.0.0.1 por la 103.168.0.2 que es la publica del router al realizar un ping , por lo que esta funcionando correctamente el SNAT.\nAhora configuraremos la regla de DNAT , la sintaxis es la siguiente :\nip nat inside source static tcp ip_privada puerto ip_publica puerto *Posteriormente comprobaremos que el DNAT funciona correctamente .\nComprobación de navegación y DNAT Ahora vamos a comprobar que desde la red de casa podemos acceder a los servidores web .\nAccederé usando curl desde un host de la red de casa . Primero me conectare al servidor 1 :\nVemos que este nos responde correctamente y se aplica el DNAT , ya que ha cambiado la ip publica del router por la privada del servidor web :\nAhora comprobaremos el servidor 2 :\nVemos que este nos responde correctamente y se aplica el DNAT , ya que ha cambiado la ip publica del router por la privada del servidor web :\nAhora comprobaremos que puedo acceder desde un Tiny Core con Firefox a ambos servidores :\nAl servidor 1 :\nAl servidor 2 :\nVemos que también podemos conectarnos ya que las reglas de NAT están funcionando correctamente .\nVamos a comprobar que ocurre si solicitamos la web a través de sus direcciónes ip privadas :\nPues que obviamente no recibimos respuesta ya que en nuestro escenario estamos simulando internet y en este no se pueden enrutar direcciónes ips privadas ya que están pueden estar repetidas en infinidad de redes .\nDepuración de las reglas NAT Además para asegurarnos de que las reglas de NAT están funcionando .\nEl primer comando nos permite ver la tabla de traducciones de direcciónes DNAT :\nCon este comando podremos ver cuantos hits tienen nuestras reglas , si no tiene ninguno es que esta no esta funcionando salvo que nosotros hayamos inicializado este :\nSi queremos poner los contadores a cero usaremos el comando clear ip nat statistics .\nSi queremos ver en tiempo real los paquetes que muestra información sobre cada paquete que traduce el router :\nCuando decodifique el resultado de este comando, observe los significados de los siguientes símbolos y valores:\n* : el asterisco junto a NAT indica que la traducción se realiza en la ruta de switching rápido. Al primer paquete en una conversación siempre se aplica el switching de procesos, que es más lento. Si existe una entrada de caché, el resto de los paquetes atraviesan la ruta de switching rápido. S: Este símbolo hace referencia a la dirección IPv4 de origen. a.b.c.d→ w.x.y.z: este valor indica que la dirección de origen a.b.c.d se traduce a w.x.y.z. d: = Este símbolo hace referencia a la dirección IPv4 de destino. [xxxx] = El valor entre corchetes es el número de identificación IPv4. Esta información puede ser útil para la depuración, ya que habilita la correlación con otros seguimientos de paquetes realizados por los analizadores de protocolos. Bibliografía Depuración NAT ","date":"September 8, 2023","hero":"/images/redes/configuracion_nat/portada.png","permalink":"https://www.javiercd.es/posts/redes/configuracion_de_nat/configuracion_de_nat/","summary":"\u003cp\u003eEn este artículo, exploraremos la configuración de SNAT (Source Network Address Translation) y DNAT (Destination Network Address Translation) en escenarios con direcciones públicas, haciendo uso de routers en entornos Linux y dispositivos Cisco.\u003c/p\u003e\n\u003ch2 id=\"escenario-con-maquinas-debian\"\u003eEscenario con maquinas debian\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/redes/configuracion_de_nat/img/Aspose.Words.5d96acd8-9177-4bad-9621-78ead201ec37.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"preparación-del-entorno\"\u003ePreparación del entorno\u003c/h3\u003e\n\u003ch4 id=\"instalación-de-paquetes\"\u003eInstalación de paquetes\u003c/h4\u003e\n\u003cp\u003eUna vez colocadas las maquinas deberemos de descargarnos apache para los servidores web , para realizar esto conectaremos ambos servidores a un switch y este a la nube NAT para disponer de acceso a internet .\u003c/p\u003e","tags":["Redes","Enrutamiento","NAT","SNAT","DNAT","Cisco","Linux"],"title":"Configuración de NAT Cisco y Linux"},{"categories":null,"contents":"Aprenderás a configurar switches en GNS3, tanto dispositivos genéricos como switches Cisco, utilizando el concepto de VLANs para segmentar la red y explorar las complejidades de la gestión de redes.\nPreparación escenario Lo primero que haré sera montar el escenario :\nConfiguración de red de los clientes A continuación configurare las tarjetas de red de los clientes , aprovechando que la nube NAT incluye un servidor DHCP.\nPara hacer esto escribimos en los VPCS el siguiente comando :\nEjercicio A 1 PC1 y PC3 pertenecen a la VLAN 10, PC2 y PC4 pertenecen a la VLAN 20. Demuestra el funcionamiento correcto de ambas VLAN y que no hay conectividad entre PC2 y PC3. ¿Puedes hacerlo con los switches Ethernet que trae GNS3? ¿Encuentras alguna limitación? ¿Cuáles son las distintos tipos (types) que puede tener un puerto y en qué se diferencian?\nPara configurar las VLANS en los switches , le damos clic derecho y a continuación realizamos la siguiente configuración :\nPara el switch 3 (PC1 y PC2)\nPara el switch 2 (PC3 y PC4)\nPara el switch (PC5 Y NAT1)\nPC1 , solo tendrá conectividad con los PCs que pertenecen a su VLAN :\nPC2 , solo tendrá conectividad con los PCs que pertenecen a su VLAN:\nCon sus respectivas parejas del otro switch obtendremos el mismo resultado. PC3 , solo tendrá conectividad con los PCs que pertenecen a su VLAN:\nPC4 , solo tendrá conectividad con los PCs que pertenecen a su VLAN:\nTenemos que tener en cuenta que los dispositivos que no pertenecen a la VLAN 10 deberemos de configurados manualmente ya que estos no tienen conectividad con el servidor DHCP.\nEl ejercicio A podemos hacerlo perfectamente con los switches que trae GNS3 , encontraremos una limitación importante , ya que los switches solo permiten que las bocas pertenezcan a una VLAN .\nAl realizar el ejercicio debemos de tener en cuenta los types que puede tener un puerto , los que hemos utilizado son los dos primeros :\nAccess: Este es el destinado para un equipo final , es decir un cliente ya que se encarga de eliminar el etiquetado que va en el encabezado. Dot1q:Este es el encargado de interconectar dispositivos de red entre si , se encarga de añadir el etiquetado en el encabezado para mandar el paquete a otro dispositivo y que este sepa a que VLAN pertenece . QinQ : Es similar a dot1q pero este además se encarga de añadir en el etiquetado , el tipo de paquete para identificarlos . Teniendo esto en cuenta podemos hacer una analogía con la practica de switches físicos : Los puertos untagged –\u0026gt; Access\nLos puertos tagged –\u0026gt; Dot1q\nAl utilizar estos switches el protocolo 802.1Q pero “con menos funciones” no podemos indicar que VLANS queremos que utilice los puertos configurados como Dot1q , sino que este a través de la VLAN por defecto pasara los paquetes etiquetados de todas las VLANS .\nEjercicio B 2 Todos los ordenadores deben poder acceder al servidor de datos, pero solo PC1 y PC3 deben acceder a Internet. Lo harán a través de vuestra máquina física usando el elemento llamado NAT, que deberéis comprender y configurar. ¿Puedes hacerlo con los switches Ethernet que trae GNS3? ¿Qué limitación te encuentras? Para superar dicha limitación, descarga el CISCO 3725 como appliance y úsalo en lugar de los switches Ethernet configurándolos adecuadamente.\nSwitches Ethernet Aquí encontramos la primera limitación de estos switches , ya que solo podemos tener 1 VLAN por puerto esto quiere decir que solo una VLAN tendrá acceso a estos recursos .\nComo queremos que solo la VLAN 10 navegue por internet configuraremos la boca de nuestra nube a una boca con tipo Access y que pertenezca a esta VLAN :\nPor lo que para este punto no hay problema , nuestros PC1 y PC3 , ambos serán capaces de navegar por internet :\nComo estos 2 PCS pertenecen a la misma VLAN que la nube NAT pueden comunicarse sin problema y utilizar el servidor DHCP que incluye la misma para configurarse . Mientras que los PC2 y PC4 no podrán ni navegar ni configurarse por DHCP al no pertenecer a la misma VLAN que la nube NAT :\nCon el servidor de datos nos toparemos con la limitación ya que únicamente un puerto puede pertenecer a una VLAN , solo una pareja de nuestros PCs podrán comunicarse . Esto podríamos evitarlo configurando el servidor como una “maquina real” con 2 interfaces virtuales y diciéndole al switch que cada una pertenece a una VLAN distinta .\nCISCO 3725 Para comenzar a utilizar este dispositivo , tendremos que añadirle espacio al disco para que podamos iniciarlo , además podemos añadir el modulo de 16 bocas Ethernet de forma predeterminada así no tendremos que hacerlo a mano mas adelante .\nPara realizar esta configuración deberemos de tener importado el router y acceder a Edit \u0026gt; preferences \u0026gt; IOS routers .\nUna vez modificada la plantilla colocaremos los 3725 en el escenario y montaremos el mismo escenario :\nDebemos de tener en cuenta que las interfaces FastEthernet0/0 y FastEthernet0/1 funcionan como routers , es decir no podemos utilizarlos como switch . Los puertos que se comportan como switch son todos los de FastEthernet1 así que sera los que utilicemos .\nA continuación le diremos a estos puertos que tienen que funcionar como si fuesen un switch para ello introduciremos los siguientes comandos en cada uno de los 3725.\nAhora crearemos las vlans usando los siguientes comandos , para cada uno de los switches :\nPodemos listarlas con el siguiente comando :\nAhora le asignaremos a los puertos su VLAN correspondiente :\nA continuación configuraremos el puerto que une a los dos 3725 , para esto lo ponemos en modo trunk y permitimos el trafico encapsulado de todas las VLANS por este puerto .\nPor ultimo guardaremos los cambios para que si se apaga el equipo mantenga las modificaciones que hemos realizado :\nCon esto habremos configurado el primer 3725 , su homologo a este , es decir el que conecta a PC3 y PC4 , tendríamos que hacer lo mismo adaptado a los puertos en los que estén conectado los dispositivos .\nContinuaremos configurando el 3725 que une ambos “switches” y da salida al servidor de datos y a internet . Para ello crearemos las VLANS 10 y 20 :\nY le asignaremos al servidor de datos ambas VLANS mientras que a la salida a internet solo la VLAN 10:\nAhora configuraremos las interfaces que interconectan los switches :\nA continuación crearemos las dos subintrantes para permitir el trafico entre ellas y le asignaremos direcciones ip .\nAhora el servidor de datos lo conectaremos al puerto Fe0/0 y en el crearemos dos subintrantes , yo utilizare una maquina debian . Esto lo haremos editando en network interfaces :\nComprobamos que las interfaces estén subidas :\nAhora crearemos las rutas de enroutamiento:\nUna vez hecho esto podremos hacerle ping al servidor de datos desde las dos interfaces :\nPodemos hacerle ping al servidor de datos y tendremos conectividad con el :\nVemos que el trafico es capaz de llegar al servidor de datos sin embargo este no es capaz de “hacer el camino de vuelta ”.\nTambién he configurado enroutamiento inter vlan , siguiendo los enlaces de la bibliografía sin embargo no me ha funcionado tampoco.\nEjercicio C Responde a las siguientes preguntas sobre los apartados anteriores:\nC.1 ¿Qué pasa con el direccionamiento cuando añades la nube de NAT? ¿Cuál es el motivo de este cambio?\nCuando ponemos la nube NAT , esta incluye un servidor DHCP el cual tiene la direccion ip 192.168.122.1 y asignas direcciones de la red 192.168.122.1/24 . A través de la configuración que nos proporciona este nos permitirá navegar por internet .\nC.2¿Por qué es necesario asignar un disco duro a cada uno de los dispositivos y qué tamaño mínimo debe tener para que el escenario funcione?\nPara los routers cisco 3725 , para que este inicie y supere el chequeo inicial este debe tener como mínimo un espacio de 1MB , además si queremos guardar las configuraciones esto sera necesario .Por ejemplo para guardar la información de las vlans sera necesario.\nC.3¿Qué diferencia hay entre configurar un puerto del switch en modo access y en modo trunk y cuándo hay que usar cada uno de ellos?\nEl modo access esta pensado para conectar un cliente final es decir , un pc . Es el equivalente a el “ puerto untagged “ , sin embargo este tiene una limitación el cual es que solo puede pertenecer a una vlan , este puerto se encarga además de eliminar el encabezado que añaden los puertos trunk para que los dispositivos finales puedan entender los paquetes .\nPor otro lado el modo trunk permite interconectar un dispositivo de red con otro , por ejemplo un switch con otro switch , seria el equivalente a un “puerto tagged” , este además permite el trafico de varios vlans , etiquetando las tramas para que los demás dispositivos puedan interpretar la VLAN a la que pertenece el paquete .\nEjercicio D Sustituye ahora PC1 y PC3 por dos máquinas Linux con Firefox instalado (puedes encontrar las imágenes en el MarketPlace de GNS3) y comprueba que navegan correctamente.\nLo añadimos al escenario y los conectamos a las mismas bocas que teníamos nuestros VPCS para que mantengan la configuración anterior de las VLANS y tengamos acceso a la nube NAT .\nUna vez hecho esto accederemos a la interfaz de la maquina y configuraremos su tarjeta de red por DHCP , para ello accederemos al panel de control :\nEn el panel de control accedemos a network para configurar la red :\nEn el panel de network diremos que use DHCP y guardamos la configuración :\nEn la terminal podemos cerciorarnos de que la configuración de red se ha realizado correctamente .\nY podemos ver que haciendo este procedimiento ya podremos navegar con el tinycore con Firefox :\nAquí la prueba con el segundo tiny core :\nEjercicio E Monta un Port Bonding entre el switch de cabecera y los otros dos. Demuestra su correcto funcionamiento y explica detalladamente como lo has configurado. Explica los flags que puede tener un portchannel.\nA continuación deberemos de configurar los puertos extra que hemos añadido al escenario para que estén en modo trunk y se respete nuestro escenario con las VLANS , es repetir lo que hemos hecho anteriormente.\nLo primero que deberemos de hacer sera crear las interfaces lógicas ,sin embargo este paso lo podemos omitir ya que posteriormente si no existe la interfaz la creara automáticamente .\nIndicaremos que interfaces queremos que pertenezcan al port-channel 1 para el enlace lógico entre R1-R2 y que pertenezcan al port-channel 2 para el enlace lógico entre R2-R3.\nPara R1-R2 :\nPara R2-R1 :\nPara R2-R3 :\nPara R3-R2 :\nTambién podemos configurar el EtherChannel como un enlace trunk, y así conseguimos multiplexación estadística del tráfico de las VLANs y que ante la caída de un enlace sigue funcionando el otro con ambas VLANs. Esto lo haremos con todos los enlaces lógicos :\nUna vez hecho esto podemos comprobar si están funcionando los etherchannels:\nLa configuración de un EtherChannel se puede hacer utilizando uno de estos protocolos :Port Aggregation Protocol (PAgP) o Link Aggregation Control Protocol (LACP).Ambos extremos se deben de configurar en el mismo modo.\nEstos tienen unas serie de “modos ” en los cuales cambiara el comportamiento del puerto a la hora de crear enlaces :\non: En este modo, los enlaces miembros del grupo se agregarán manualmente y no se monitorizarán automáticamente. Este modo se utiliza cuando se desea tener un mayor control sobre los enlaces miembros del grupo. desirable: En este modo, el switch intentará negociar con el dispositivo conectado en el otro extremo del enlace. Si el dispositivo del otro extremo también está configurado en modo \u0026ldquo;desirable\u0026rdquo;, se agregará automáticamente el enlace. auto: En este modo, el switch no intentará negociar sino que agregará automáticamente el enlace si el dispositivo conectado en el otro extremo del enlace está configurado en modo \u0026ldquo;desirable\u0026rdquo;. active: En este modo, el switch enviará constantemente LACP PDUs para determinar si el dispositivo conectado en el otro extremo del enlace está disponible y también está configurado para usar LACP. Si el dispositivo del otro extremo está disponible y también está configurado para usar LACP, se agregará automáticamente el enlace. Ejercicio F Port Mirroring: Conecta un PC5 al Switch1 y monitoriza el tráfico que sale de PC1. Realiza una captura con Wireshark en la boca correspondiente al PC5 y explica el tráfico capturado.\nLo primero que haremos sera configurar el port mirroring , en mi caso enviara el trafico de la boca 1/5 a la 1/4.\nHare en el pc5 un ping a google y monitorizare el cable que va desde el router a pc4 , para comprobar que este funcionando el port mirroring :\nVemos que hemos podido “interceptar ” un ping , proveniente de la dirección ip del PC6 .\nEsto hará que el trafico entrante y saliente del puerto que hemos puesto como sniffer nos lo reenvié al puerto que escucha .\nPodemos comprobar el estado de la sesión del port mirroring con este comando :\nBibliografía Switching and GNS3 The NAT node Simulando switch cisco en GNS3 GNS3, añadiendo hosts a nuestras topologías Trabajando con switch en GNS3: VLAN y Trunk LACP y PAGP Routing interVLAN Enroutamiento VLAN Configurar PortBonding LinkAggregationControlProtocol(LACP)andPortAggregationProtocol(PAgP) Wikipedia Ether-channel Comunicación Inter VLAN ","date":"September 8, 2023","hero":"/images/redes/switches_gns3/portada.png","permalink":"https://www.javiercd.es/posts/redes/switches_gns3/configuracion_de_switches_en_gns3/","summary":"\u003cp\u003eAprenderás a configurar switches en GNS3, tanto dispositivos genéricos como switches Cisco, utilizando el concepto de VLANs para segmentar la red y explorar las complejidades de la gestión de redes.\u003c/p\u003e\n\u003ch2 id=\"preparación-escenario\"\u003ePreparación escenario\u003c/h2\u003e\n\u003cp\u003eLo primero que haré sera montar el escenario :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/redes/switches_gns3/img/Aspose.Words.1880b7c0-3050-4e53-a32a-505911fdf872.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"configuración-de-red-de-los-clientes\"\u003eConfiguración de red de los clientes\u003c/h3\u003e\n\u003cp\u003eA continuación configurare las tarjetas de red de los clientes , aprovechando que la nube NAT incluye un servidor DHCP.\u003c/p\u003e\n\u003cp\u003ePara hacer esto escribimos en los VPCS el siguiente comando :\u003c/p\u003e","tags":["Redes","Wireshark","GNS3","Cisco","Switches"],"title":"Configuración de switches en GNS3"},{"categories":null,"contents":"1.Instalación de la característica Lo primero que comprobaremos es comprobar si el servidor ssh esta instalado en la maquina a la cual queremos conectarnos .\nGet-WindowsCapability -Online | Where-Object Name -like \u0026#39;OpenSSH\\*\u0026#39; En el caso de que tengamos la característica la instalaremos :\nAdd-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 Por defecto el servicio estará parado así que lo arrancamos :\nPodemos configurarlo para que arranque automáticamente al reiniciar el equipo :\n2.Conectarnos usando par de claves Lo primero que haremos sera generar un par de claves en el cliente , con ssh-keygen :\nUsando SCP podemos llevarnos nuestra clave publica o añadirla manualmente al fichero de authorized_keys :\nY probamos a conectarnos usando la clave :\nSi queremos que solo el servicio funcione con claves publicas y privadas , editamos el fichero C:\\ProgramData\\ssh\\sshd_config.\nSi queremos conectarnos con un cliente Linux , deberemos hacer el mismo proceso . Si el servidor fuese Linux podríamos usar la utilidad ssh-copy-id sin embargo no es compatible con servidores Windows así que usaremos scp :\nUna vez añadida podremos conectarnos :\n","date":"September 8, 2023","hero":"/images/sistemas/ssh_win/windows-ssh.jpg","permalink":"https://www.javiercd.es/posts/sistemas/ssh_windows/ssh_windows/","summary":"\u003ch2 id=\"1instalación-de-la-característica\"\u003e1.Instalación de la característica\u003c/h2\u003e\n\u003cp\u003eLo primero que comprobaremos es comprobar si el servidor ssh esta instalado en la maquina a la cual queremos conectarnos .\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ps\" data-lang=\"ps\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eGet-WindowsCapability\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-Online\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eWhere-Object\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eName\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-like\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e\u0026#39;OpenSSH\\*\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEn el caso de que tengamos la característica la instalaremos :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ps\" data-lang=\"ps\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eAdd-WindowsCapability\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-Online\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-Name\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eOpenSSH.Server~~~~0.0.1.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePor defecto el servicio estará parado así que lo arrancamos :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePodemos configurarlo para que arranque automáticamente al reiniciar el equipo :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2conectarnos-usando-par-de-claves\"\u003e2.Conectarnos usando par de claves\u003c/h2\u003e\n\u003cp\u003eLo primero que haremos sera generar un par de claves en el cliente , con ssh-keygen :\u003c/p\u003e","tags":["Windows","Sistemas","ISO","ASO"],"title":"Configuración servicio ssh en Windows"},{"categories":null,"contents":"Configuración servidor DHCP bajo debian En este artículo aprenderás cómo configurar el servidor DHCP isc-dhcp-server. Además, configurarás una reserva y lo configuraras para que funcione en dos ámbitos.\nInstalación del servidor isc-dhcp-server Para instalar nuestro servidor dhcp ejecutamos:\nNos dará el siguiente error ya que no esta configurado :\nConfiguración del servidor isc-dhcp-server Lo primero que tenemos que hacer es configurar el interfaz de red por el que va a trabajar el servidor dhcp, para ello editamos el siguiente fichero:\nY añadimos nuestra interfaz que repartirá direcciones :\nConfigura el servidor dhcp con las siguientes características:\nRango de direcciones a repartir: 192.168.0.100 - 192.168.0.110 Máscara de red: 255.255.255.0 Duración de la concesión: 1 hora Puerta de enlace: 192.168.0.1 Servidores DNS: 8.8.8.8 Para ello editamos el siguiente archivo :\nAhora añadimos lo siguiente :\nAquí estamos configurando nuestro ámbito conforme al enunciado .\nAhora deberemos de reiniciar el servicio con el siguiente comando :\nConfiguraciòn de los clientes para obtener un direccionamiento dinámico Editaremos la configuración de red para que use el dhcp :\nEn el debian editamos el network/interfaces:\nAhora reiniciamos la tarjeta de red :\nAhora comprobaremos si nos a asignado ip con ipconfig:\nVemos que se ha asignado correctamente . Repetiremos lo mismo con nuestro cliente windows .\nConfiguramos la tarjeta de red para que utilice el protocolo dhcp, reiniciamos la tarjeta y comprobamos la ip que nos ha asignado :\nAhora vamos a comprobar las concesiones de direcciones para ello deberemos ver el siguiente archivo . Lo abriremos con cat ya que es importante no editarlo , puede causar problemas .\nReserva de una direccion IP Para ello deberemos editar el archivo de configuración de nuestro servidor dhcp :\nUna vez aquí vamos a añadir las siguientes lineas :\nNombre de la reserva hardware Ethernet: Es la dirección MAC de la tarjeta de red del host. fixed-address: La dirección IP que le vamos a asignar. Quedaría nuestra reserva así(la pondremos fuera de la configuración de nuestro ámbito):\nAhora reiniciaremos el servicio\nVamos a comprobar que se ha realizado la concesión , para ello nos vamos a windows . Es posible que tengamos que renovar la concesión o reiniciar la tarjeta de red .\nVamos a comprobar qué ocurre con la configuración de los clientes en determinadas circunstancias, para ello vamos a poner un tiempo de concesión muy bajo . Le pondré 1 min .\n1.Los clientes toman una configuración, y a continuación apagamos el servidor dhcp. ¿Qué ocurre con el cliente windows? ¿Y con el cliente Linux?\nEn windows nos asignara una dirección de APIPA\nMientras que en Linux no me asigna ninguna dirección ip , aunque después me asigno una dirección de APIPA\n¿Que ocurre cuando modificamos la configuraciòn? Los clientes toman una configuración, y a continuación cambiamos la configuración del servidor dhcp (por ejemplo, el rango). ¿Qué ocurre con el cliente windows? ¿Y con el cliente Linux?\nModificamos el rango :\nY reiniciamos el servicio\nCon windows mantengo la dirección de la reserva :\nY con Linux nos asigna la dirección del nuevo rango :\nConfigurar dos ambitos Realizar las modificaciones necesarias en la configuración actual de nuestro servidor dhcp para que reparta direcciones ip a dos redes diferentes, la 192.168.0.0 y la 192.168.2.0.\nLo primero que haremos sera añadir una cuarta tarjeta de red y la configuraremos manualmente . Si no sabemos el nombre de la interfaz podemos verlo con ip a :\nAhora la configuraremos estática , siguiendo el enunciado y la añadimos al /etc/default/isc-dhcp-server.\nY configuramos nuestro segundo rango :\nAhora reiniciamos el servicio :\nAhora le añadiré varias tarjetas de red a mi cliente para comprobar las concesiones y configuramos las tarjetas :\nY nos habría concedido dirección ip en ambos rangos :\n","date":"September 8, 2023","hero":"/images/servicios/dhcp_v4/isc-dhcp.webp","permalink":"https://www.javiercd.es/posts/servicios/dhcp/dhcp_ipv4/","summary":"\u003ch1 id=\"configuración-servidor-dhcp-bajo-debian\"\u003eConfiguración servidor DHCP bajo debian\u003c/h1\u003e\n\u003cp\u003eEn este artículo aprenderás cómo configurar el servidor DHCP isc-dhcp-server. Además, configurarás una reserva y lo configuraras para que funcione en dos ámbitos.\u003c/p\u003e\n\u003ch2 id=\"instalación-del-servidor-isc-dhcp-server\"\u003eInstalación del servidor isc-dhcp-server\u003c/h2\u003e\n\u003cp\u003ePara instalar nuestro servidor dhcp ejecutamos:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/dhcp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.015.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eNos dará el siguiente error ya que no esta configurado :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/dhcp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.016.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"configuración-del-servidor-isc-dhcp-server\"\u003eConfiguración del servidor isc-dhcp-server\u003c/h2\u003e\n\u003cp\u003eLo primero que tenemos que hacer es configurar el interfaz de red por el que va a trabajar el servidor dhcp, para ello editamos el siguiente fichero:\u003c/p\u003e","tags":["Servicios","NAT","SMR","DHCP","SNAT"],"title":"Configuración servidor DHCP bajo debian"},{"categories":null,"contents":"Configuración servidor DNS en Debian Dnsmasq El paquete dnsmasq permite poner en marcha un servidor DNS de una forma muy sencilla. Simplemente instalando y arrancando el servicio dnsmasq, sin realizar ningún tipo de configuración adicional, nuestro PC se convertirá en un servidor caché DNS y además, resolverá los nombres que tengamos configurados en el archivo /etc/hosts de nuestro servidor. La resolución funcionará tanto en sentido directo como en sentido inverso, es decir, resolverá la IP dado un nombre de PC y el nombre del PC dada la IP.\nInstalación Para instalarlo solo sera necesario introducir el siguiente comando :\nConfiguración A continuación, editamos el fichero /etc/dnsmasq.conf y modificamos las siguientes líneas:\n1.Descomentamos strict-order para que se realicen las peticiones DNS a los servidores que aparecen en el fichero /etc/resolv.conf en el orden en él aparecen.\n2.Incluimos las interfaces de red que deben aceptar peticiones DNS, descomentar la línea interface por ejemplo: interface=eth0\nAhora crearemos nuestro archivo de configuración :\n3.Creamos el fichero de configuración de nuestra zona :\n4.El dominio que hemos elegido es iesgn.org\n5.Suponemos que el nombre del servidor es miservidor.\n6.Vamos a suponer que tenemos un servidor ftp que se llame ftp.iesgn.org y que está en 192.168.1.201 (esto es ficticio) y que tenemos dos sitios webs: www.iesgn.org y departamentos.iesgn.org.\n7.Además queremos nombrar al cliente que tenía asignada una reserva: lisa.\n8.Reiniciamos el servicio\nModificacion en el servidor DHCP Configura los clientes e indica que su DNS es nuestro servidor. Si tienes un servidor DHCP modificarlo para que envíe el nuevo DNS a los clientes.\nEditamos el fichero :\nY reiniciamos el servicio :\nAhora comprobaremos si el cliente nos ha cambiado el dns mirando el siguiente archivo :\nSe nos ha cambiado satisfactoriamente .\nComandos para comprobar funcionamiento dns Comprueba el funcionamiento usando el comando dig/nslookup desde los clientes preguntando por los distintos nombres. Comprueba que el servidor DNS hace de forwarder preguntando con dig/nslookup la dirección ip de www.josedomingo.org.\nPara la pagina de Jose domingo la respuesta es no autorizada porque nuestro servidor no tiene la resolución en su fichero y tiene que utilizar un forwarder\nComo ves arriba yo he creado mi propia zona y a pesar de haber seguido los pasos de esta pagina de Jose domingo , no he conseguido que las respuestas estén autorizadas .\nHe creado el archivo dns.conf .\nY he creado mi zona :\nTambién he probado mas cosas sin embargo la única forma que he conseguido que me de respuesta autorizada es teniendo solo las resoluciones en el fichero host del servidor , sin crear mi zona .\nDNS BIND 9 Instalación Lo primero que haremos sera desinstalar dnsmasq ya que ambos no son compatibles :\nAdemas podemos ver que nos dice que el directorio /etc/dnsmasq.d/ al no estar vació no se ha borrado seria bueno que lo borrásemos manualmente para eliminar todo rastro de anteriores configuraciones :\nAhora vamos a instalarlos bind:\nConfiguración Ahora vamos a editar el fichero /etc/bind/named.conf.local donde crearemos las zonas (directas e inversas). En el caso de la práctica nos piden una directa (isgn.com) y otra inversa (red 192.168.1).\nAñadiremos las siguientes líneas a dicho fichero :\nEn el directorio / etc/bind están los ficheros db.empty y db.127 (ficheros de configuración de la zona directa e inversa respectivamente). Los copiamos al directorio / var/cache/bind para empezar a añadir los registros\nModificamos el fichero / var/cache/bind/db.isgn e incluimos las siguientes líneas para la resolución directa :\n*javiercruces es el nombre de mi maquina lo he cambiado para facilitar las cosas\nAhora haremos lo mismo para la resolución inversa :\nAhora reiniciaremos el servicio para que se apliquen los cambios :\nAdemas para asegurarnos de que hemos realizado bien la configuración vamos a mirar el estado del servicio para ver si nuestras zonas están funcionando :\nEste paso es opcional , pero gracias a revisar esto he descubierto porque no me hacia la resolución inversa y gracias a ver las zonas que estaban cargadas me di cuenta de que el error estaba en el fichero de configuración /etc/bind/named.conf.local y pude solucionarlo .\nReenviador Hasta ahora, sólo nos resolvería los nombres e ip de nuestra red local. Si queremos configurar un reenviador al que preguntar en caso de que el DNS local no pueda darnos la respuesta, debemos editar el fichero nano / etc/bind/named.conf.options y añadir lo siguiente:\nAntes de hacer este apartado aclarar que como en el apartado de dnsmasq ya comentamos el fichero host y modificamos la configuración del dhcp para que asigne el dns automáticamente , lo omitiré de esta parte.\nComandos para comprobar el funcionamiento del servicio Comprueba el funcionamiento usando el comando dig/nslookup desde los clientes preguntando por los distintos nombres. Comprueba que el servidor DNS hace de forwarder preguntando con dig/nslookup la dirección ip de www.josedomingo.org .\nVemos aquí que las respuestas son correctas , las que están en nuestro servidor estas autorizadas mientras que la pagina de Jose domingo nos la ha echo un forwarder .\nAhora haré las mismas peticiones pero inversas :\nCon esto hemos comprobado que el servidor dns funciona correctamente .\n","date":"September 8, 2023","hero":"/images/servicios/dns/portada-dns.jpg","permalink":"https://www.javiercd.es/posts/servicios/dns/dns/","summary":"\u003ch1 id=\"configuración-servidor-dns-en-debian\"\u003eConfiguración servidor DNS en Debian\u003c/h1\u003e\n\u003ch2 id=\"dnsmasq\"\u003eDnsmasq\u003c/h2\u003e\n\u003cp\u003eEl paquete dnsmasq permite poner en marcha un servidor DNS de una forma muy sencilla. Simplemente instalando y arrancando el servicio dnsmasq, sin realizar ningún tipo de configuración adicional, nuestro PC se convertirá en un servidor caché DNS y además, resolverá los nombres que tengamos configurados en el archivo /etc/hosts de nuestro servidor. La resolución funcionará tanto en sentido directo como en sentido inverso, es decir, resolverá la IP dado un nombre de PC y el nombre del PC dada la IP.\u003c/p\u003e","tags":["Servicios","NAT","SMR","DHCP","SNAT","DNS","BIND9","DNSMASQ"],"title":"Configuración servidor DNS en Debian"},{"categories":null,"contents":"Los empaquetadores y compresores son elementos fundamentales en la gestión de archivos y datos en el ámbito informático. Los empaquetadores permiten agrupar varios archivos en un solo contenedor, facilitando su manipulación y transporte. Por otro lado, los compresores aplican técnicas para reducir el tamaño de los archivos, contribuyendo al ahorro de espacio de almacenamiento y agilizando la transferencia de datos. Estas herramientas desempeñan un papel crucial en la optimización de recursos y la eficiencia operativa al organizar, distribuir y respaldar información de manera más eficaz.\nTAR Es un empaquetador de archivos que como su propio nombre indica utiliza el formato .tar, básicamente se utiliza para almacenar ficheros y directorios en un mismo archivo.\nEl nombre del paquete es tar .\nCrear un archivo .tar Puedes crear compresiones .tar tanto para un archivo como para directorios. Un ejemplo de este tipo de archivo es:\ntar -cvf sampleArchive.tar /home/sampleArchive Aquí /home/sampleArchive es el directorio que necesita ser comprimido creandosampleArchive.tar. Este comando usa las opciones –cvf que significan:\nc – crear un nuevo archivo .tar v – muestra una descripción detallada del progreso de la compresión f – nombre del archivo Crear un archivo .tar.gz Si deseas una mejor compresión, también puedes usar .tar.gz. Un ejemplo de esto es:\ntar -cvzf sampleArchive.tar.gz /home/sampleArchive La opción adicional z representa la compresión gzip. Alternativamente, puedes crear un archivo .tgz que sea similar a tar.gz. Te mostramos un ejemplo de esto último a continuación:\ntar -cvzf sampleArchive.tgz /home/sampleArchive Crear un archivo .tar.bz2 El archivo .bz2 proporciona más compresión en comparación con gzip. Sin embargo, esta alternativa tomará mas tiempo para comprimir y descomprimir. Para usarla, debes usar la opción -j. Un ejemplo de cómo se vería la operación es el siguiente:\ntar -cvjf sampleArchive.tar.bz2 /home/sampleArchive Dicha operación es similar a .tar.tbz o .tar.tb2. Te muestro un ejemplo a continuación:\ntar -cvjf sampleArchive.tar.tbz /home/sampleArchive tar -cvjf sampleArchive.tar.tb2 /home/sampleArchive Cómo descomprimir archivos .tar El comando Tar de Linux también se puede utilizar para extraer un archivo. El siguiente comando extraerá los archivos en el directorio actual:\ntar -xvf sampleArchive.tar Si deseas extraer tus archivos a un directorio diferente, puedes usar la opción -C. Te mostramos un ejemplo de esto a continuación:\ntar -xvf sampleArchive.tar -C /home/ExtractedFiles/ Puedes usar un comando similar para descomprimir archivos .tar.gz, tal como se muestra a continuación:\ntar -xvf sampleArchive.tar.gz tar -xvf sampleArchive.tar.gz -C /home/ExtractedFiles/ Los archivos .tar.bz2 o .tar.tbz o .tar.tb2 pueden descomprimirse de manera similar. Para esto deberás teclear el siguiente comando en la línea de comando:\ntar -xvf sampleArchive.tar.bz2 Cómo listar el contenido de un archivo .tar Una vez que hayas creado el archivo, puedes listar el contenido mediante un comando similar al siguiente:\ntar -tvf sampleArchive.tar Esto mostrará la lista completa de archivos junto con las marcas de tiempo y los permisos. Del mismo modo, para .tar.gz, puedes usar un comando como:\ntar -tvf sampleArchive.tar.gz Esto también funcionaría para archivos .tar.bz2 como se muestra a continuación: tar -tvf sampleArchive.tar.bz2\nCómo descomprimir un único archivo .tar Una vez que creas un archivo comprimido, puedes extraer un único archivo de ese comprimido. Esto lo puedes lograr con el comando que te mostramos a continuación:\ntar -xvf sampleArchive.tar example.sh Aquí example.sh es un archivo único que se extraerá del comprimido sampleArchive.tar. Alternativamente, también puedes usar el siguiente comando:\ntar --extract --file= sampleArchive.tar example.sh Para extraer un solo archivo de un comprimido .tar.gz puedes usar un comando similar al mostrado a continuación:\ntar -zxvf sampleArchive.tar.gz example.sh O alternativamente:\ntar --extract --file= sampleArchive.tar.gz example.sh Para extraer un solo archivo de un comprimido .tar.bz2 puedes usar un comando como este:\ntar -jxvf sampleArchive.tar.bz2 example.sh O, alternativamente, uno como este:\ntar --extract --file= sampleArchive.tar.bz2 example.sh Cómo extraer múltiples archivos de los archivos .tar En caso de que desees extraer varios archivos, usa el siguiente formato del comando:\ntar -xvf sampleArchive.tar \u0026#34;file1\u0026#34; \u0026#34;file2\u0026#34; Para .tar.gz puedes usar:\ntar -zxvf sampleArchive.tar.gz \u0026#34;file1\u0026#34; \u0026#34;file2\u0026#34; Para .tar.bz2 puedes usar:\ntar -jxvf sampleArchive.tar.bz2 \u0026#34;file1\u0026#34; \u0026#34;file2\u0026#34; Extraer múltiples archivos con un patrón Si deseas extraer del comprimido patrones específicos de archivos como solo los .jpg, usa el comando wildcards. Una muestra de dicho comando se muestra a continuación:\ntar -xvf sampleArchive.tar --wildcards \u0026#39;\\*.jpg\u0026#39; Para .tar.gz puedes usar:\ntar -zxvf sampleArchive.tar.gz --wildcards \u0026#39;\\*.jpg\u0026#39; Para .tar.bz2 puedes usar:\ntar -jxvf sampleArchive.tar.bz2 --wildcards \u0026#39;\\*.jpg\u0026#39; Cómo agregar archivos a un archivo .tar Si bien puedes extraer archivos específicos, también puedes agregar archivos nuevos a un archivo comprimido existente. Para hacerlo, debes usar la opción -r que significa agregar. El comando Tar puede agregar tanto archivos como directorios.\nA continuación se muestra un ejemplo en el que estamos agregando example.jpg al sampleArchive.tar existente.\ntar -rvf sampleArchive.tar example.jpg También podemos agregar un directorio. En el ejemplo que te mostramos a continuación, el directorio image_dir se agrega al archivo sampleArchive.tar\ntar -rvf sampleArchive.tar image\\_dir No puedes agregar archivos o carpetas a comprimidos .tar.gz o .tar.bz2.\nCómo verificar un archivo .tar Usando Tar puedes verificar un archivo. Esta es una de las formas en que puedes hacerlo:\ntar -tvf sampleArchive.tar Esto no se puede aplicar en archivos .tar.gz o .tar.bz2.\nCómo verificar el tamaño del archivo .tar Una vez que crees un archivo, puedes verificar su tamaño. Este se mostrará en KB (Kilobytes).\nA continuación te mostramos varios ejemplos del comando a usar para verificar el tamaño de diferentes tipos de archivos comprimidos:\ntar -czf - sampleArchive.tar | wc -c tar -czf - sampleArchive.tar.gz | wc -c tar -czf - sampleArchive.tar.bz2 | wc -c GZIP Puede comprimir un archivo usando gzip con el comando llamado gzip . El nombre de este paquete es gzip .\nEste es el uso más simple: gzip filename\nEsto comprimirá el archivo y agregará un .gz extensión a ella. Se elimina el archivo original. Para evitar esto, puede utilizar el- c y use la redirección de salida para escribir la salida en elfilename.gzexpediente:\ngzip -c filename \u0026gt; filename.gz los -c La opción especifica que la salida irá al flujo de salida estándar, dejando el archivo original intacto o puede usar el -k opción:\ngzip -k filename Hay varios niveles de compresión. Cuanto mayor sea la compresión, más tiempo llevará comprimir (y descomprimir). Los niveles van de 1 (más rápido, peor compresión) a 9 (más lento, mejor compresión), y el valor predeterminado es 6.\nPuede elegir un nivel específico con el - opción:\ngzip -1 filename Puede comprimir varios archivos enumerándolos:\ngzip filename1 filename2 Puede comprimir todos los archivos de un directorio, de forma recursiva, utilizando el -r :\ngzip -r folder gziptambién se puede utilizar para descomprimir un archivo, utilizando el -d opción:\ngzip -d filename.gz BZIP2 El bzip2 es muy similar al programa gzip. La principal diferencia es que utiliza un algoritmo de compresión diferente llamado algoritmo de compresión de texto de clasificación de bloques Burrows-Wheeler y codificación Huffman. Los archivos comprimidos con bzip2 finalizarán con la extensión .bz2.\nComo dije, el uso de bzip2 es casi lo mismo que gzip. Simplemente tendremos que reemplazar gzip en los ejemplos anteriores por bzip2, gunzip por bunzip2, zcat con bzcat y así sucesivamente.\nPara comprimir un archivo usando bzip2, reemplazándolo por una versión comprimida, ejecutaremos:\nbzip2 prueba.txt # Nos creara un archivo prueba.txt.bz2 Comprimir los archivos sin eliminar el archivo original\nSi no queremos reemplazar el archivo original, utilizaremos la opción -c y escribiremos el resultado en un nuevo archivo.\nBzip2 -c prueba.txt # prueba.txt.bz2 Descomprimir archivos\nPara descomprimir un archivo comprimido utilizaremos alguna de las dos siguientes posibilidades:\nbzip2 -d prueba.txt.bz2 bunzip2 prueba.txt.bz2 Ver el contenido de los archivos comprimidos sin descomprimirlos\nPara ver el contenido de un archivo comprimido sin descomprimirlo, no tendremos más que utilizar cualquiera de las opciones:\nbunzip2 -c ubunlog.txt.bz2 bzcat ubunlog.txt.bz2 XZ El paquetes es xz-utils\nComprimir\nEl ejemplo más simple de compresión de un archivo con xz es el siguiente. Compresión de archivos con XZ\nxz deb.iso También se puede utilizar la opción -z para realizar la compresión:\nxz -z deb.iso Estas órdenes comprimirán el fichero, pero eliminará el archivo origen. Si no buscamos borrar los archivos de origen, usaremos la opción -k de la siguiente manera:\nxz -k deb.iso Descomprimir\nPara descomprimir un archivo, vamos a poder utilizar la opción -d:\nxz -d deb.iso unxz deb.iso Forzar compresión\nSi una operación falla, por ejemplo, si existe un archivo comprimido con el mismo nombre, usaremos la opción -f para forzar el proceso:\nxz -kf deb.iso Establecer niveles de compresión\nEsta herramienta admite diferentes niveles preestablecidos de compresión (de 0 a 9. Con un valor predeterminado de 6). También vamos a poder utilizar alias como –fast (será rápido, pero con menos compresión) para establecer como valor 0 y –best para establecer como valor 9 (compresión lenta pero más alta). Algunos ejemplos de cómo establecer estos niveles, son los siguientes:\nxz -k -8 deb.iso xz -k --best deb.iso Limitar la memoria\nEn caso de tener una cantidad pequeña de memoria del sistema y querer comprimir un archivo enorme, vamos a tener la posibilidad de utilizar la opción -memory = límite (el valor límite puede estar en MB o como porcentaje de RAM) para establecer un límite de uso de memoria para la compresión:\nxz -k --best --memlimit-compress=10% deb.iso Habilitar modo silencioso\nSi nos interesa ejecutar la compresión en modo silencioso solo habrá que añadir la opción -q. También podremos habilitar el modo detallado con -v, como se muestra a continuación:\nxz -k -q deb.iso xz -k -qv deb.iso Crear un archivo tar.xz\nEl siguiente es un ejemplo del uso para conseguir un archivo con la extensión tar.xz.\ntar -cf *.txt | xz -7 \u0026gt; deb.tar.xz Crear un archivo tar.xz opción 2\ntar -cJf deb.tar.xz *.txt Comprobar la integridad de los archivos comprimidos\nPodremos probar la integridad de los archivos comprimidos utilizando la opción -t. Utilizando -l podremos ver la información sobre un archivo comprimido.\nxz -t deb.tar.xz xz -l deb.tar.xz 7Z Este compresor cuenta con dos paquetes :\np7zip ofrece soporte para 7zr (una versión ligera de 7z y 7za). Permite comprimir y descomprimir paquetes en estos formatos mediante la herramienta gráfica de tu sistema (file-roller en Ubuntu y Debian) pero no dispone de la funcionalidad de cifrado. p7zip-full es, por decirlo de algún modo, la versión más completa. Soporta los formatos 7z y 7za e incorpora la funcionalidad de cifrado, además de las herramientas para la compresión ZIP Comprimir Uno o Varios Archivos\nEl formato es siempre es la misma, consiste en colocar 7z, seguido de la opción a (para comprimir o empaquetar), seguido del nombre que quieres dar al paquete final (no hace falta colocar la extensión .7z) y acabando con el nombre del archivo a comprimir. Podrás observar que 7-Zip es capaz de aprovechar todos los núcleos de tu procesador durante la operación.\n7z a paquete-comprimido archivo-a-comprimir 7z a paquete-comprimido archivo-1 archivo-2 Si queremos ponerle contraseña utilizamos el parámetro -p :\n7z a -p paquete-comprimido archivo-a-comprimir 7-Zip soporta varios formatos de compresión o empaquetado, aparte del suyo propio, con esta sentencia podrás optar por indicar explícitamente que formato quieres utilizar (puedes escoger entre 7z, zip, gzip, bzip2 o tar).\n7z a -tgzip paquete-comprimido archivo-a-comprimir Listar Contenido de la Carpeta Comprimido\nOtra opción interesante puede ser listar el contenido dentro de un archivador y ver los detalles. Para ello tienes que situarte igualmente en el directorio en el que se encuentra el archivador o carpeta comprimida y teclear la siguiente sentencia.\n7z l paquete-comprimido.7z Descomprimir Paquete y Extraer Ficheros\nUna vez conocido el contenido dentro del archivador, para extraer de golpe todo el contenido dentro del directorio de trabajo actual, puedes valerte del siguiente comando:\n7z e paquete-comprimido.7z Comprobar Integridad de los Datos\nComo opción adicional, también puedes comprobar la integridad de los diferentes archivos que se encuentran dentro del fichero comprimido. Para ello utiliza esto:\n7z t paquete-comprimida.7z RAR El paquete para instalarlo es rar .\nCómo comprimir RAR en Linux\nPara comprimir un fichero o todos los de una carpeta:\nrar a nombre_fichero_comprimido.rar nombre_fichero_a_comprimir rar a nombre_fichero_comprimido.rar Cómo descomprimir RAR en Linux\nY para descomprimir en el mismo directorio o en otro diferente:\nunrar x nombre\\_del\\_rar.rar unrar x nombre\\_del\\_rar.rar /ruta/destino/descomprimido ZIP El nombre del paquete es zip.\nPara comprimir archivos :\nzip archivo.zip archivos Para descomprimir archivos :\nunzip archivo.zip Ver contenido :\nunzip -v archivo.zip Bibliografía Guía comando tar Guía comando gzip Guía comando bzip2 Guía xz Guía comando 7z Guía comando rar ","date":"September 8, 2023","hero":"/images/sistemas/empaquetadores/portada.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/empaquetadores_compresores/empaquetadores-compresores-descompresores/","summary":"\u003cp\u003eLos empaquetadores y compresores son elementos fundamentales en la gestión de archivos y datos en el ámbito informático. Los empaquetadores permiten agrupar varios archivos en un solo contenedor, facilitando su manipulación y transporte. Por otro lado, los compresores aplican técnicas para reducir el tamaño de los archivos, contribuyendo al ahorro de espacio de almacenamiento y agilizando la transferencia de datos. Estas herramientas desempeñan un papel crucial en la optimización de recursos y la eficiencia operativa al organizar, distribuir y respaldar información de manera más eficaz.\u003c/p\u003e","tags":["Linux","Sistemas","ISO","ASO"],"title":"Empaquetadores y compresores en Linux"},{"categories":null,"contents":"En esta práctica, exploraremos la creación de un escenario mediante la orquestación de OpenStack y, posteriormente, llevaremos a cabo el enrutamiento para asegurar la conectividad entre las distintas máquinas virtuales. Este ejercicio nos permitirá comprender y aplicar el uso de OpenStack para gestionar entornos virtuales, además de configurar la red de manera eficiente para facilitar la comunicación entre los diferentes dispositivos en el escenario.\nEscenario a montar en OpenStack Para poder montar nuestro escenario en OpenStack debido a la situación actual de las imágenes que hay disponibles , necesitaremos preparar una instancia la cual tenga habilitado el acceso por contraseña . Además si posteriormente a partir de una queremos configurar otra habilitar el acceso ssh por contraseña para este usuario .\nEsta tendremos que crearla con el mismo flavour con las que generaremos el escenario para evitar errores .\nCuanto tengamos a punto nuestra instancia comprobaremos que puedes iniciar sesión desde horizon :\nAhora crearemos una instantánea :\nCopiaremos el ID de las instantánea :\nY lo añadiremos al fichero :\nY lo desplegaremos :\nVemos que se ha creado correctamente :\nEsquema gráfico de la configuración El esquema quedaría de la siguiente manera :\nTeniendo la siguiente relación de IPS :\nMAQUINA IP INTERFAZ PC1 10.0.100.144 ens3 R1-PC1 10.0.100.68 ens3 R1-R2 10.0.110.78 ens4 R2-R1 10.0.110.30 ens3 R2-PC2 10.0.120.191 ens4 PC2 10.0.120.203 ens3 R2-R3 10.0.130.146 ens5 R3-R2 10.0.130.36 ens3 R3-PC3 10.0.140.127 ens4 PC3 10.0.140.158 ens3 Tablas de enrutamiento\nR1 10.0.100.0/24 0.0.0.0 ens3 10.0.110.0/24 0.0.0.0 ens4 10.0.120.0/24 10.0.110.30 ens4 10.0.130.0/24 10.0.110.30 ens4 10.0.140.0/24 10.0.110.30 ens4 0.0.0.0/0 10.0.110.30 ens4 *Las redes en las que estamos directamente conectados se crearan automáticamente las rutas.\nR2 10.0.100.0/24 10.0.110.178 ens3 10.0.110.0/24 0.0.0.0 ens3 10.0.120.0/24 0.0.0.0 ens4 10.0.130.0/24 0.0.0.0 ens5 10.0.140.0/24 10.0.130.36 ens5 0.0.0.0/0 10.0.130.36 ens5 *Las redes en las que estamos directamente conectados se crearan automáticamente las rutas.\nR3 10.0.100.0/24 10.0.130.146 ens3 10.0.110.0/24 10.0.130.146 ens3 10.0.120.0/24 10.0.130.146 ens3 10.0.130.0/24 0.0.0.0 ens3 10.0.140.0/24 0.0.0.0 ens4 0.0.0.0/0 10.0.130.146 ens4 Comandos de configuración de cada nodo Router 1 Como es un router deberemos de activar el bit de forwarding para ello introduciremos el siguiente comando :\necho 1 \u0026gt; /proc/sys/net/ipv4/ip\\_forward Crearemos la tabla de enrutamiento :\nLas rutas estáticas :\nip route add 10.0.100.0/24 via 0.0.0.0 dev ens3 La ruta por defecto:\nip route add default via 10.0.110.30 dev ens4 Nos quedaría así la tabla de enrutamiento :\nPC1 Borraremos la ruta por defecto que exista en el dispositivo\nY añadiremos la nueva ruta\nRouter 2 Como es un router deberemos de activar el bit de forwarding para ello introduciremos el siguiente comando :\necho 1 \u0026gt; /proc/sys/net/ipv4/ip\\_forward Crearemos la tabla de enrutamiento :\nQuedaría así :\nPC2 Al igual que hicimos anteriormente eliminaremos la ruta por defecto que trae y la añadiremos la nueva :\nActivaremos el bit de forwarding con el siguiente comando :\necho 1 \u0026gt; /proc/sys/net/ipv4/ip\\_forward Crearemos la tabla de enrutamiento para nuestro escenario :\nLa tabla de enrutamiento quedaría así :\nPC3 Al igual que con los demás deberemos de cambiar la ruta por defecto por la ip del router a la que estamos conectado :\nResumen de configuración y aclaraciones Para los routers Activar el bit de forwarding Crear las tablas de enrutamiento Modificar la ruta por defecto Para los PCs Modificar la ruta por defecto Lo de modificar la ruta por defecto , es debido a que no puedo modificar la configuración de las tarjetas de red por lo que no puedo modificar la puerta de enlace .\nPor defecto al utilizar el script esta viene con la puerta de enlace X.X.X.1 sin embargo esta no coincide con la puerta de enlace de los clientes .\nPara los routers debemos de modificarla también para indicar por donde mandaremos el trafico “por defecto”.\nSi queremos hacer que el bit del forwarding se guarde permanentemente para que cuando reiniciemos el equipo este no vuelva a 0 :\n–\u0026gt; Escribimos directamente en el archivo /etc/sysctl.conf:\nSi queremos volcar en un archivo la configuración de las tablas de enrutamiento para tener una copia de seguridad de las mismas usamos :\nSi queremos restaurar la copia :\nVerificación de conectividad (ping) entre nodos PC1 PC1 – PC2\nPC1-PC3\nPC2 PC2-PC1\nPC2-PC3\nPC3 PC3-PC1\nPC3-PC2\nCaptura de tráfico en el router r2 o r3 mostrando tráfico entre h1 y h3. Para hacer una captura de una determinada interfaz y guardarla en un archivo utilizaremos tcpdump:\ntcpdump -i NOMBRE\\_INTERFAZ -w NOMBRE\\_ARCHIVO Si queremos tener una salida al comando en lugar de guardar el archivo usaremos el parámetro -n: Aquí vemos como llegan los ICMP REQUEST de PC3 a PC1 y los ICMP REPLY DE PC1 a PC3\nAdemás he capturado una petición y respuesta arp de PC3:\nBibliografía Como hacer tablas de enrutamiento ","date":"September 8, 2023","hero":"/images/redes/enrutamiento_os/portada.png","permalink":"https://www.javiercd.es/posts/redes/enroutamiento_openstack/enroutamiento_openstack/","summary":"\u003cp\u003eEn esta práctica, exploraremos la creación de un escenario mediante la orquestación de OpenStack y, posteriormente, llevaremos a cabo el enrutamiento para asegurar la conectividad entre las distintas máquinas virtuales. Este ejercicio nos permitirá comprender y aplicar el uso de OpenStack para gestionar entornos virtuales, además de configurar la red de manera eficiente para facilitar la comunicación entre los diferentes dispositivos en el escenario.\u003c/p\u003e\n\u003ch2 id=\"escenario-a-montar-en-openstack\"\u003eEscenario a montar en OpenStack\u003c/h2\u003e\n\u003cp\u003ePara poder montar nuestro escenario en OpenStack debido a la situación actual de las imágenes que hay disponibles , necesitaremos preparar una instancia la cual tenga habilitado el acceso por contraseña . Además si posteriormente a partir de una queremos configurar otra habilitar el acceso ssh por contraseña para este usuario .\u003c/p\u003e","tags":["Redes","Enrutamiento"],"title":"Enrutamiento en OpenStack"},{"categories":null,"contents":"Servidor FTP bajo debian Instalación y configuración del servidor proFTPd autentificado 1.Primero nos crearemos un grupo que se llame ftpgroup : 2.Crea dos usuarios locales que pertenezcan al grupo ftp que hemos creado: Jose y Maria\n3.Nos instalamos el servicio ftp :\n4.Configuración básica del fichero proftpd.conf:\nTodos los usuarios accedan solo a su directorio :\nAhora podemos acceder desde el navegador con los usuarios Jose y Maria :\nCada uno de estos he creado una carpeta con su nombre dentro de sus directorios personales para poder identificarlos .\nPara que cada usuario pueda conectarse realmente al servidor FTP en Debian y le sea posible subir y descargar los datos en su propio directorio, debes introducir su directorio de entrada en proftpd.conf :\nPodemos transferir archivos correctamente :\nConfiguración de proFTPd para crear ftp anónimo Lo primero que tenemos que hacer es crear el directorio y darle el propietario adecuado:\nAhora cambiaremos esta regla y permitiremos que todos puedan unirse :\nAdemas añadimos las siguientes lineas e indicaremos la ruta a la que accederán los anónimos :\nPor lo que cuando reiniciemos podrán conectarse los usuarios anónimos :\nPero no con los usuarios que hemos creado anteriormente :\nPara permitir que nuestros usuarios se puedan conectar ademas de los anónimos:\nAhora aplicamos estos cambios y probamos a conectarnos . Vemos que con anónimos no podemos copiar nada al servidor pero si podemos descargar.\nAhora con un usuario del grupo , podremos copiar archivos :\n","date":"September 8, 2023","hero":"/images/servicios/ftp/portada-ftp.png","permalink":"https://www.javiercd.es/posts/servicios/ftp/ftp/","summary":"\u003ch1 id=\"servidor-ftp-bajo-debian\"\u003eServidor FTP bajo debian\u003c/h1\u003e\n\u003ch2 id=\"instalación-y-configuración-del-servidor-proftpd-autentificado\"\u003eInstalación y configuración del servidor proFTPd autentificado\u003c/h2\u003e\n\u003cp\u003e1.Primero nos crearemos un grupo que se llame ftpgroup :\n\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.160.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e2.Crea dos usuarios locales que pertenezcan al grupo ftp que hemos creado: Jose y Maria\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.161.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e3.Nos instalamos el servicio ftp :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.162.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e4.Configuración básica del fichero proftpd.conf:\u003c/p\u003e\n\u003cp\u003eTodos los usuarios accedan  solo a su directorio :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.163.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora podemos acceder desde el navegador con los usuarios Jose y Maria  :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.164.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT","SSH","FORWARDING","APACHE","FTP"],"title":"FTP bajo debian "},{"categories":null,"contents":"En el ecosistema de Linux, un proceso es la ejecución de un programa específico que realiza una tarea particular. Cada proceso tiene su propio identificador único (PID) y está compuesto por un conjunto de recursos, como memoria y CPU, que le permiten funcionar de manera independiente.\nEn el universo de Linux, la gestión efectiva de procesos es una habilidad crucial para optimizar el rendimiento y asegurar la estabilidad del sistema. Este post te sumergirá en los fundamentos esenciales de la gestión de procesos\nPS Si no añadimos ningún parámetro, ps mostrará los procesos del usuario con el que estamos logueados. Por otra parte, los parámetros más básicos a conocer son los siguientes:\naux : Lista los procesos de todos los usuarios con información añadida (destacamos más abajo).\n-a Lista los procesos de todos los usuarios.\n-u Lista información del proceso como por ejemplo el usuario que lo está corriendo, la utilización de CPU y memoria, etc.\n-x Lista procesos de todas las terminales y usuarios\n-l Muestra información que incluye el UID y el valor «nice«.\n–-forest Muestra el listado procesos en un formato tipo árbol que permite ver como los procesos interactúan entre si, podría ser algo similar al comando pstree.\nPSTREE El programa pstree facilita información sobre la finalización de una serie de procesos relacionados entre sí, esto es, todos los descendientes de un proceso particular. El programa deja claro desde un principio que proceso es el primario y cuales son los secundarios. Esto evita buscar las relaciones entre los diversos procesos de manera manual.\nParámetros comúnmente utilizados :\n-H: Si nos interesa podemos ver el árbol de un proceso específico:\n-g: Nos agrupara los procesos por grupos :\n-n: Nos permite ordenar la salida por el numero de PID:\n-p: Muestra el numero de PID\n-s:Muestra los procesos padres\nSYSTEMCTL STATUS Este comando se utiliza para ver el estado en el que se encuentra un servicio , Específicamente, muestra información sobre si el servicio o unidad está activo o inactivo, y si está en ejecución o detenido. También muestra cualquier mensaje de error o advertencia relacionado con el servicio o unidad. Este comando es útil para verificar el estado de un servicio o unidad en el sistema y para resolver problemas relacionados con ellos.\nTOP Es un programa todo en uno: simultáneamente cumple las funciones de ps y kill. Es un comando de modo consola, por lo que debe iniciarlo desde una terminal .\nDentro de este podemos controlarlo usando las siguientes teclas:\n-k: este comando se usa para enviar una señal a un proceso. Luego, top le preguntará por el PID del proceso, seguido del número de la señal a enviar (predeterminadamente TERM — o 15);\n-M: este comando se usa para ordenar el listado de los procesos de acuerdo a la memoria que usan (campo %MEM);\n-P: este comando se usa para\nordenar el listado de procesos de acuerdo al tiempo de CPU que consumen(campo %CPU; este es el método de ordenamiento predeterminado);\n-u: este comando se usa para mostrar los procesos de un usuario en particular, top le preguntará de cual. Debe ingresar el nombre del usuario.\n-i: este comando actúa como un interruptor; predeterminadamente se muestran todos los procesos, incluso los que están dormidos; este comando asegura que se muestran sólo los procesos que están en curso de ejecución :\nHTOP Htop es la version mejorada y actual de top la cual tiene una interfaz mas amigable y mas funcionalidades las cuales nos ayudaran a la supervisión de procesos . Este se divide en varias partes :\nEl encabezado divide la parte superior de la interfaz en secciones izquierda y derecha. Estos muestran el uso de la CPU/memoria, el espacio de intercambio, el tiempo de actividad de la máquina, las tareas y la carga promedio.\nLa sección superior izquierda muestra una línea para cada núcleo de CPU. Por ejemplo, la captura de pantalla anterior muestra dos núcleos de CPU, con el porcentaje que representa la carga en cada uno.\nTambién puede ver el código de colores proporcionado por htop para identificar qué tipo de procesos utilizan la CPU:\nRojo: porcentaje ocupado por procesos del sistema Azul: porcentaje ocupado por proceso de baja prioridad Verde: porcentaje ocupado por procesos de usuario Las líneas de memoria también usan códigos de colores, esta vez para representar:\nAmarillo: porcentaje ocupado por caché contenido Verde: porcentaje ocupado por la memoria utilizada Azul: porcentaje ocupado por contenido buffer El panel central muestra todos los procesos en ejecución con sus estadísticas asociadas según la utilización de la CPU. Muestra la siguiente información para cada proceso:\nID de proceso (PID) El propietario (Usuario) Consumo de memoria virtual porcentaje de procesador memoria física Para finalizar este programa también es interactivo , abajo tenemos un índice donde podemos comprobar las funciones que nos permite usar :\nAdemás disponemos de varios atajos de teclados :\nu Ordenar procesos por nombre de usuario p Alternar con la ruta del programa F2 o S Entrar en Configuración F3 o / Proceso de búsqueda F5 o t Vista ordenada o de árbol F6 +/- Seleccione el proceso principal para expandir/contraer el árbol F7 o [ Aumentar la prioridad solo para root F8 o ] Prioridad baja (bueno +) F9 o k Matar proceso H Alterna con subprocesos de proceso de usuario K Alterna con subprocesos de proceso del kernel \u0026amp; El símbolo \u0026amp; es un operador de shell en Unix y Linux que permite ejecutar un proceso en segundo plano. Al colocar \u0026amp; al final de un comando, se ejecutará el proceso en segundo plano y se le asignará una tarea en segundo plano. Esto significa que el proceso se ejecutará en paralelo con otras tareas y no bloqueará la terminal o la línea de comandos hasta que finalice.\nJOBS Este comando listara los procesos que se encuentran en segundo pano así como su estado , nos permite saber su PID:\nFG Complementando al comando anterior , este nos permite reanudar en primer plano el último trabajo que fue suspendido.:\nListando con jobs podemos mandar un proceso en especifico a primer plano :\nBG Cuando un comando se está ejecutando puedes suspenderlo usando ctrl-Z. El comando se detendrá inmediatamente, y volverás al shell de la terminal.\nPuedes reanudar la ejecución del comando en segundo plano, así que seguirá ejecutándose pero no te impedirá hacer otro trabajo en la terminal.\nKILL Los procesos de Linux pueden recibir señales y reaccionar a ellas. Esa es una forma en la que podemos interactuar con los programas en ejecución. El programa kill puede enviar una variedad de señales a un programa. No sólo se usa para terminar un programa, como el nombre lo sugiere, sino que es su principal trabajo Por defecto, este manda una señal TERM al identificador de proceso indicado.\nPodemos listar las señales con kill -l :\nMandamos una señal con el parámetro -s seguida del numero de esta y el PID del proceso :\nXKILL Este es el método más sencillo y el más práctico. El cursor del mouse se transformará en una pequeña calavera. Todo lo que resta es hacer clic en la ventana que querés cerrar y voilá. Chau proceso.\nKILLALL Similar al comando kill, killall enviará la señal a múltiples procesos a la vez en lugar de enviar una señal a un identificador de proceso específico . Por ejemplo, puedes tener múltiples instancias del programa top en ejecución, y killall top terminará con todos ellos.\nPuedes especificar la señal, como con kill :\nPor ejemplo podemos matar todos los tops :\nPIDOF Te permite encontrar el ID del proceso de un programa en ejecución:\n-s: Petición única - ordena al programa devolver un único identificador de proceso\nPID BASH echo t$$ → id bash\nEs una forma rápida de encontrar el identificador actual de la bash :\nNICE Ejecuta un comando con una prioridad determinada, o modifica la prioridad a de un proceso (programa en ejecución). Utiliza una prioridad variable que parte de la prioridad del shell y suma o resta valores. Mientras menor es el valor de la prioridad mayor prioridad tiene el proceso.\nEl valor de la prioridad del proceso find aumenta en 5, disminuye su prioridad.\nRENICE Sirve para cambiar la prioridad de un proceso :\nPKILL Este comando nos permite matar un proceso del que conocemos su nombre completo o parte de él. Veamos un ejemplo:\nBibliografía Guía de uso pstree Guía de uso envío de señales Guía de uso htop Guía de uso nice , renice , kill \u0026hellip; ","date":"September 8, 2023","hero":"/images/sistemas/comandos_procesos/portata_procesos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/comandos_procesos/comandos_procesos/","summary":"\u003cp\u003eEn el ecosistema de Linux, un proceso es la ejecución de un programa específico que realiza una tarea particular. Cada proceso tiene su propio identificador único (PID) y está compuesto por un conjunto de recursos, como memoria y CPU, que le permiten funcionar de manera independiente.\u003c/p\u003e\n\u003cp\u003eEn el universo de Linux, la gestión efectiva de procesos es una habilidad crucial para optimizar el rendimiento y asegurar la estabilidad del sistema. Este post te sumergirá en los fundamentos esenciales de la gestión de procesos\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Gestión de Procesos en Linux"},{"categories":null,"contents":" ⚠️ Advertencia: Este post fue desarrollado para Debian 11. Si tienes una versión más reciente, puedes revisar el post para Debian 12 que encontrarás en el apartado de redes de esta misma página. La única parte que no deberías seguir si cumples con esta condición es la instalación de GNS3. Todo el resto del contenido sigue siendo valido .\n1. Introducción Wireshark es un analizador de protocolos utilizado para realizar análisis y solucionar problemas en redes de comunicaciones, para análisis de datos y protocolos, y como una herramienta didáctica.\nAñade una interfaz gráfica y muchas opciones de organización y filtrado de información. Así, permite ver todo el tráfico que pasa a través de una red estableciendo la configuración en modo promiscuo de nuestra tarjeta de red . También incluye una versión basada en texto llamada tshark.\nPermite examinar datos o de un archivo de captura salvado en disco. Se puede analizar la información capturada, a través de los detalles y sumarios por cada paquete. Wireshark incluye un completo lenguaje para filtrar lo que queremos ver y la habilidad de mostrar el flujo reconstruido de una sesión de TCP.\nWireshark es software libre, y se ejecuta sobre la mayoría de sistemas operativos Unix y compatibles.\nLos requisitos mínimos para utilizar este software son :\nCualquier procesador moderno AMD64/x86-64 de 64 bits o x86 de 32 bits. 500 MB de RAM disponibles. Los archivos de captura más grandes requieren más RAM. 500 MB de espacio disponible en disco. Los archivos de captura requieren espacio en disco adicional. Cualquier pantalla moderna. Se recomienda una resolución de 1280 × 1024 o superior. Wireshark utilizará resoluciones HiDPI o Retina si están disponibles. Los usuarios avanzados encontrarán útiles varios monitores. Una tarjeta de red compatible para capturar 1.1 Descarga del paquete en debían Para descargar el paquete en nuestro equipo deberemos de mirar en la pagina oficial de descargas si incluye soporte para nuestro sistema operativo .\nVemos que no aparece en la lista ningún sistema operativo GNU/Linux , esto es porque Wireshark está disponible a través del sistema de empaquetado predeterminado en la mayoría de estas plataformas . Es decir esta presente en los repositorios de nuestra distribución , en el caso de que no estuviese tenemos el código fuente al ser un software libre y podríamos compilarlo .\nPodemos comprobar si esta disponible en nuestro sistema operativo visitando la pagina oficial :\nVemos que Debian aparece en la lista esto quiere decir que el paquete esta en los repositorios oficiales de debían.\nEn Debian contamos con el gestor de paquetes apt , así que podemos comprobar la versión del paquete disponible para la instalación y comprobar desde que repositorios se nos descargara con el siguiente comando :\nPara realizar la instalación de wireshark introduciremos el siguiente comando :\nA continuación para hacer capturas de red en el equipo necesitaremos permisos para nuestro usuario para ello , utilizaremos el siguiente comando :\n1.2 Comprobación de funcionamiento Ahora abriremos el programa para comprobar que todo funciona correctamente :\nAhora iniciaremos una captura de paquetes para ello si queremos hacerla sobre un interfaz en concreta pulsamos sobre ella , en mi caso usare la tarjeta de red inalámbrica wlo1 y haré una petición web a la pagina jagger.es .\nAquí te muestro la petición DNS que ha viajado desde mi portátil hasta el router .\n1.3 Componentes de wireshark generales Wireshark hace uso de unos determinados paquetes : Wireshark : el analizador de protocolos de red que todos conocemos . TShark : un analizador de protocolo de red de línea de comandos. Complementos y extensiones : extras para los motores de disección Wireshark y TShark Complementos Dissector : complementos con algunas disecciones extendidas. Complementos de estadísticas de árbol -:Estadísticas extendidas. Mate: motor de seguimiento y meta análisis : extensiones configurables por el usuario del motor de filtro de pantalla; consulte el Capítulo 12, MATE para obtener más detalles. MIB de SNMP: MIB de SNMP para una disección de SNMP más detallada. Herramientas : herramientas de línea de comandos adicionales para trabajar con archivos de captura Editcap : lee un archivo de captura y escribe algunos o todos los paquetes en otro archivo de captura. Text2Pcap : lee un volcado hexadecimal ASCII y escribe los datos en un archivo de captura pcap. Reordercap : reordena un archivo de captura por marca de tiempo. Mergecap : combina varios archivos de captura guardados en un único archivo de salida. Capinfos : proporciona información sobre los archivos de captura. Rawshark : filtro de paquetes sin procesar. Guía del usuario : instalación local de la Guía del usuario. Los botones de Ayuda en la mayoría de los cuadros de diálogo requerirán una conexión a Internet para mostrar las páginas de ayuda si la Guía del usuario no está instalada localmente. 2 Instalación de GNS3 en Debian 11 2.1 Introducción GNS3 es un simulador gráfico de red lanzado en 2008, que te permite diseñar topologías de red complejas y poner en marcha simulaciones sobre ellos,permitiendo la combinación de dispositivos tanto reales como virtuales.\nPara permitir completar simulaciones, GNS3 está estrechamente vinculada con:\nDynamips: un emulador de IOS que permite a los usuarios ejecutar imágenes de IOS . Dynagen: un front-end basado en texto para Dynamips . Qemu y VirtualBox: para permitir utilizar máquinas virtuales como un firewall PIX o estaciones de trabajo . VPCS: un emulador de PC con funciones básicas de networking . IOU: (IOS en Unix), compilaciones especiales de IOS provistas por Cisco para correr directamente en sistemas UNIX y derivados . Los requisitos mínimos para hacer uso de esta herramienta son :\nProcesador : 2 o más núcleos lógicos Virtualización: Se requieren extensiones de virtualización. Es posible que deba habilitar esto a través del BIOS de su computadora. Memoria RAM: 4 GB de RAM Almacenamiento : 1 GB de espacio disponible (la instalación de Windows es \u0026lt; 200 MB). Notas adicionales : Es posible que necesite almacenamiento adicional para su sistema operativo y las imágenes del dispositivo. 2.2 Instalación Lo primero que haremos antes de instalar sera comprobar que nuestro sistema este actualizado , para ello haremos un apt update y si tenemos paquetes desactualizados haremos un apt upgrade .\nA continuación instalaremos todas las dependencias que necesita GNS3 :\nAhora te describiré la función de los paquetes que vamos a instalar :\nPaquete Descripción python3-pip El módulo pip es el instalador de paquetes de Python. python3-pyqt5 El módulo PyQt5 expone la API de Qt5 a Python 3 . python3-pyqt5.qtsvg El módulo SVG de PyQt5 proporciona clases para mostrar el contenido de los archivos SVG. python3-pyqt5.qtwebsockets El módulo WebSockets de PyQt5 proporciona enlaces de Python 3 para la especificación WebSockets (tanto cliente como servidor). qemu Software de Virtualización , actualmente se encuentra dividido en varios paquetes . qemu-kvm Binarios de emulación de sistema completo QEMU . qemu-utils Binario de utilidades de emulación de QEMU . libvirt-clients Libvirt es un conjunto de herramientas en C para interactuar con las capacidades de virtualización de versiones recientes de Linux . libvirt-daemon-system Este paquete contiene los archivos de configuración para ejecutar el demonio libvirt como un servicio del sistema. Virtinst Este paquete contiene algunas utilidades de línea de comandos para crear y editar máquinas virtuales . wireshark Es un analizador de red que captura paquetes para su posterior análisis . xtightvncviewer Sistema de visualización remota que le permite ver un entorno de \u0026rsquo;escritorio\u0026rsquo; no solo en la máquina donde se está ejecutando, sino desde cualquier lugar en Internet . apt-transport-https Este es un paquete de transición ficticio: la compatibilidad con https . ca-certificates Contiene los certificados de las autoridades certificadoras que se incluyen en el navegador de Mozilla para permitir que las aplicaciones basadas en SSL . curl curl es una herramienta de línea de comandos para transferir datos con sintaxis URL . gnupg2 Se puede utilizar para cifrar datos y crear firmas digitales. Incluye una función avanzada de administración de claves y cumple con el estándar de Internet OpenPGP propuesto. software-properties-common Le permite administrar fácilmente su distribución y las fuentes de software de proveedores de software independientes. Una vez instalados estos paquetes , nos descargaremos GNS3 utilizando pip3 :\nAdemás nos fijaremos en la salida del comando para comprobar si hay algún error :\nLo siguiente sera instalar docker , el cual nos permitirá crear contenedores . Para ello importaremos su clave GPG para que nuestro sistema confié en el :\nLo siguiente sera añadir el repositorio a nuestro sistema para ello utilizaremos el siguiente comando:\nActualizaremos los repositorios que utiliza apt haciendo un apt update :\nY finalmente podremos instalar docker :\nAgregue las siguientes líneas a su /etc/apt/sources.list , para que podamos instalar dynamips y ubridge:\nPara poder instalar los paquetes necesarios de estos repositorios , añadiremos las claves gpg del mismo :\nActualizaremos los repositorios que utiliza apt haciendo un apt update :\nNos instalaremos los paquetes Dynamips y ubridge :\nSaldrá un recuadro como este , para indicar si los usuarios que no son superusuarios pueden capturar paquetes , le diremos que si en nuestro caso :\nPara evitar la instalación accidental de cualquier otra cosa de ese repositorio (por ahora), elimine o comente esas dos líneas en su archivo /etc/apt/sources.list y haga un apt update:\nTambién podemos eliminar la clave GPG de estos repositorios si lo deseamos :\nAñadiremos a los usuarios que vayan a utilizar la herramienta a los siguientes grupos :\nReinicie su sesión de usuario cerrando sesión y volviendo a iniciarla, o reiniciando el sistema para que se apliquen estos cambios .\n2.3 Nuestra primera topología en GNS3 Una vez reiniciado el sistema iniciaremos la aplicación , y nos saldrá un recuadro como este :\nAquí indicaremos que voy a correr las aplicaciones localmente en mi maquina .A continuación seleccionaremos la ruta del servidor , el nombre de host y el puerto asociado :\nSi todo ha sido correcto , nos dirá que se ha realizado correctamente :\nCuando abramos el programa , nos dará opción a crear un proyecto o podemos crear uno nuevo , en mi caso creare uno :\nSi nos fijamos en la parte izquierda del programa veremos los siguientes símbolos que sirven para lo siguiente :\nAñadiremos arrastrando 2 VPCS :\nLe añadiremos un Ethernet swicht :\nHaremos clic en el botón Agregar un enlace para dejar de agregar enlaces , nos quedaría así el escenario :\nPodemos hacer visible la interfaz a la cual los hemos conectado pulsando en el siguiente botón :\nEl botón verde \u0026ldquo;Reproducir\u0026rdquo; en la barra de herramientas GNS3 encenderá todos los dispositivos en la topología, mientras que el botón amarillo \u0026ldquo;Pausa\u0026rdquo; los suspenderá y el botón rojo \u0026ldquo;Detener\u0026rdquo; apagará todo en la topología:\nNos saldrá una advertencia , para que confirmemos si queremos añadir todos los dispositivos , le daremos a si :\nVeremos que tanto a la izquierda en el resumen de dispositivos como en las conexiones salientes de los dispositivos su “luz” de estado a cambiado de rojo a verde , puestos que estos ahora están encendidos :\nAhora abriremos una terminal en todos nuestros VPCS , con el siguiente botón :\nA través de estas terminales le asignaremos direcciones ips a nuestros dispositivos con el siguiente comando :\nUna vez configurada las tarjetas de red , comprobaremos si hay conectividad entre ellos haciendo un ping :\nAñadiremos un tercer VPCS a nuestro esquema :\nLo encenderemos y abriremos una terminal para configurarlo al igual que hemos hecho con los anteriores :\nY comprobare que esta nueva maquina tiene conectividad con las anteriores :\nSi queremos que se guarden las configuraciones de nuestros equipos introduciremos el comando save :\n2.4 Acceso a internet a través de NAT en GNS3 La manera mas fácil de conseguir acceso a internet es a través de la nube NAT .\nEsta cuenta con acceso a internet , así como un servicio DHCP corriendo con IPV4 .Para hacer uso de ella , la pondremos en nuestro escenario y la conectaremos en un swicht .\nA continuación si queremos salir a internet , tendremos que configurar nuestros clientes para que estos obtengan la configuración de red adecuada . Aprovecharemos que tenemos un servidor DHCP .\nPara que los clientes se configuren a través de este servicio introduciremos el comando dhcp :\nProbaremos a hacer un ping a google.es para comprobar la conectividad :\n3 Problemas comunes en la instalación 3.1 Error VPCS executable version must be \u0026gt;=0.6.1 but not 0.8 Este error viene al hacer la instalación de los VPCS , se descarga de los repositorios una versión que no admite actualmente el programa .\nPor suerte es muy fácil de solucionar , accederemos al repositorio del desarrollador en github y nos descargaremos el siguiente paquete :\nUna vez descargado lo descomprimiremos usando el siguiente comando :\nDonde hagamos este comando nos creara un directorio en el cual accederemos para compilar el programa :\nEjecutaremos el siguiente script :\nNos creara en esta ruta el directorio vpcs , este tendremos que añadirlo en gns3 :\nAccederemos a gns3 , pulsaremos CTRL + SHIFT + P para acceder al panel de preferencias . Una vez aquí nos desplazamos al apartado de las vpcs y seleccionamos la ruta del directorio que acabamos de generar :\nAplicamos los cambios y ya podríamos utilizar las vpcs .\n3.2 Xterm no instalado Este error aparece cuando queremos acceder a una consola de un dispositivo de nuestra tipología de red .Para solucionar este problema lo primero es cerrar GNS3 y a continuación dirigirnos a una terminal para descargarlo, utilizaremos el siguiente comando :\nVolveremos a abrir el programa y podremos acceder a las consolas de nuestras maquinas .\n4 Instalar imágenes IOS Si queremos añadir a nuestro sistema hardware real como puede ser un router cisco por ejemplo deberemos de acceder a la pagina oficial de GNS3 y descargar concretamente el que deseemos añadir en mi caso añadiré un cisco 3725 .\nSi pulsamos sobre el botón de descarga nos descargara un archivo con extensión , el cual es una plantilla .\nSi nos fijamos en este caso no tenemos la posibilidad de descargar la imagen desde este repositorio , nos dice que no hay link disponible . Para estos casos existe un repositorio de cisco el cual tiene todas las imágenes de sus productos –\u0026gt; tfr.org/cisco-ios\nPara saber cual nos tenemos que traer de aquí , abriremos gns3 y a través del menú superior izquierdo pulsaremos sobre el apartado file \u0026gt; import appilance , seleccionaremos la plantilla que vamos a importar . Le daremos a instalar en nuestro ordenador local :\nUna vez aquí nos , veremos el nombre del archivo y lo buscaremos en el repositorio externo , ya que podemos observar que no se encuentra el archivo\nEn este caso descargare , esta version que coincide con la plantilla que he descargado :\nCuando hayamos hecho esto tendremos el siguiente problema , las firmas de las imágenes no coincidirán para paliar ese paso marcaremos la opción allow custom files en la parte inferior y importaremos el binario que acabamos de descargar :\nNos informara que para la plantilla seleccionada , el archivo que hemos descargado del repositorio no coinciden los hashes . En nuestro caso es normal ya que la imagen no es la misma que tendría que venir con la plantilla , así que aceptaremos los riesgos .\nVeremos que cambiara el estado a listo para instalar , así que le daremos a siguiente en la parte inferior .\nNos pedirá confirmación para añadir nuestro dispositivo , confirmaremos la acción :\nNos informara de que nuestro dispositivo se ha añadido en las plantillas de los router , para este caso .\nAdemás nos informara del nombre que se le ha asignado .\nComo nos indico , lo encontraremos en la sección de routers :\nAhora haremos una pequeña prueba de funcionamiento , lo añadiremos a nuestro escenario y comprobaremos que podemos arrancarlo y conectarnos a la consola :\nVeremos la conexión a la consola es correcta :\n5 Instalación en Windows de GNS3 5.1 Paquetes necesarios para Windows Aunque tengamos instalado el software de GNS3 este hará uso de paquetes adicionales para realizar algunas funciones o incluso añadir nuevas funcionalidades como emular enrutadores de determinados fabricantes .\nArtículo Requerido Descripción WinPCAP Requerido Requerido para conectar GNS3 a su red informática. Utilizado por los nodos Cloud y NAT para permitir que sus proyectos se comuniquen con el mundo exterior. Npcap Opcional El reemplazo moderno de WinPCAP sabe solucionar problemas pero está menos probado que WinPCAP.Instale Npcap con la opción \u0026ldquo;Modo compatible con la API de WinPcap\u0026rdquo; seleccionada, si se usa sin WinPcap.Npcap puede coexistir con WinPcap, si esa opción no está seleccionada. Wireshark Recomendado Le permite capturar y ver el tráfico de red enviado entre nodos. Dynamips Requerido Requerido para ejecutar una instalación local de GNS3 con enrutadores Cisco. QEMU 3.1.0 y 0.11.0 Opcional Un software de virtualización .La versión anterior de Qemu 0.11.0 está instalada para admitir dispositivos ASA antiguos. Se recomienda utilizar la vm GNS3 en su lugar.\nVPCS Recomendado Un emulador de PC muy ligero que admite comandos básicos como ping y traceroute Cpulimit Opcional Se usa para evitar que QEMU use el 100% de su CPU (cuando se está ejecutando) en algunos casos, como con los dispositivos ASA antiguos GNS3 Requerido El software principal de GNS3.Esto siempre es obligatorio. Visor TightVNC Recomendado Un cliente VNC utilizado para conectarse a las interfaces gráficas de usuario del dispositivo. Solar-Putty Recomendado La nueva aplicación de consola predeterminada. Virt-viewer Recomendado Visualizador alternativo de máquinas virtuales de escritorio Qemu que tienen qemu-spice preinstalado. Intel Hardware Acceleration Manager (HAXM) Opcional Solo disponible en sistemas con CPU Intel (y VT-X habilitado), que no usan Hyper-V. Se utiliza para la aceleración de hardware de la emulación de Android, así como para QEMU. 5.2. Requisitos mínimos Para entornos pequeños en Windows los desarrolladores exigen tener como mínimo las siguientes características :\nCaracterísticas Requisitos Sistema operativo Windows 7 (64 bits) o posterior Procesador 2 o más núcleos lógicos Virtualización Se requieren extensiones de virtualización. Es posible que deba habilitar esto a través del BIOS de su ordenador . Memoria 4 GB de RAM Almacenamiento 1 GB de espacio disponible (la instalación de Windows es \u0026lt; 200 MB). 5.3 Instalación GNS3 Lo primero que tendremos que sera descargarnos el ejecutable oficial de su pagina web , para ello tendremos que estar registrados previamente .\nLanzaremos el ejecutable y nos pedirá permisos de administrados , se los concedemos :\nSaldrá una pantalla informándonos sobre el producto , le damos a next .\nA continuación deberemos de aceptar los términos y licencias de uso :\nNos preguntara donde queremos crear los atajos del programa , lo dejare por defecto ya que asi los añadirá al escritorio :\nA continuación debemos de prestar atención ya que debemos de seleccionar instalación local y todos los paquetes que vayamos a hacer uso , si hubiésemos instalado antes alguno de ellos los desmarcamos (Los mencionados en el punto 5.1) :\nSeleccionaremos la ruta donde se instalara el programa , yo dejare la predeterminada . También nos informa el espacio que necesitara la instalación :\nEsperaremos a que se realice la instalación :\nInstalación WinCap\nRequerido para conectar GNS3 a su red informática. Utilizado por los nodos Cloud y NAT para permitir que sus proyectos se comuniquen con el mundo exterior.\nMientras se realiza la instalación de GNS3 comenzara la instalación de todos los programas que hemos marcado anteriormente .\nNos mostrara información sobre el programa esta primera ventana así que le damos a siguiente :\nAceptamos la licencia de términos y uso :\nMarcamos la opción para que arranque automáticamente el driver y le damos a instalar\nNos informa de que la instalación a sido correcta y cerramos la ventana :\nInstalación Ncap\nEl reemplazo moderno de WinPCAP sabe solucionar problemas pero está menos probado que WinPCAP.Instale Npcap con la opción \u0026ldquo;Modo compatible con la API de WinPcap\u0026rdquo; seleccionada, si se usa sin WinPcap.Npcap puede coexistir con WinPcap, si esa opción no está seleccionada.\nOtra vez el mismo proceso , aceptamos los términos y licencias de uso .\nDejamos la opción marcada por defecto y le damos a install\nCuando finalice la instalación le damos a siguiente :\nY cerramos el instalador :\nVolvemos a GNS3 ya que el proceso de instalación ha quedado detenido mientras hemos instalado los componentes que va a hacer uso , esta se reanuda automáticamente :\nUna vez finalice la instalación , le damos a siguiente\nGNS3 nos ofrece una licencia gratuita de Solarwinds , le daremos a si :\nHabremos finalizado correctamente la instalación de GNS3\nAbriremos el programa y seleccionaremos correr los dispositivos en nuestra maquina local :\nAquí configuraremos nuestro servidor local de GNS3\nAnteriormente lo deje por defecto , si nuestra configuración es correcta nos dirá que la conexión se ha realizado satisfactoriamente :\nNos mostrara un resumen de la configuración dada anteriormente :\n5.4 Prueba de funcionamiento Montaremos el mismo escenario que en debian para comprobar su funcionamiento , el proceso es el mismo .\nConfiguraremos las direcciones ips de las maquinas y comprobamos que tengan conectividad a través de solarputty .\nPC1 :\nPC2:\nPodemos observar que ambos equipos tienen conectividad a través del escenario .\n6 Instalación Wireshark en Windows 6.1 Instalación La instalación de este producto es muy sencilla , si hemos instalado GNS3 anteriormente y hemos marcado la casilla de este , se nos habrá instalado automáticamente .\nPor el contrario si partimos desde cero podemos hacer su instalación , bajandonoslo de su sitio web oficial :\nCuando abramos el instalador nos pedirá permisos de administrador , se lo concedemos :\nSi al igual que yo lo has instalado con GNS3 nos detectara que ya existe una instalaron , así que yo la cancelare .\nSi no lo tuviésemos la instalación es idéntica a cualquier programa que hemos instalado en la practica . Aquí te lo muestro , lo primero que veras sera una pantalla informativa del ejecutable :\nAl igual que todos los programas te pedirá que aceptes los términos y condiciones de uso :\nSeleccionaremos los productos que deseemos instalar en mi caso todos :\nAdemás nos preguntara que accesos directos y donde los queremos crear\nSeleccionaremos la ruta donde queremos que se instale :\nSeleccionaremos si nos interesa el paquete Ncap .(Lo hemos instalado con GNS3)\nA continuación nos preguntara para instalar la extensión que nos permite analizar trafico USB , en mi caso la desmarcare ya que no me interesa .\nEsperaremos a que finalice la instalación y le daremos a siguiente :\nNos informara de que la instalación ha sido realizada correctamente :\n6.2 Prueba de funcionamiento He realizado una petición DNS a www.sevillafc.es y aquí podemos ver la consulta DNS :\n7 GNS VM Si queremos desplegar maquinas virtuales en una instancia virtual desplegaremos la maquina virtual que nos da GNS3 para que este lleve la carga de la Virtualización .\nNos descargaremos la OVA desde la pagina web oficial\nUna vez descargada la importaremos en Vmware y le daremos las características hardware que consideremos oportuno :\nUna vez echo esto abriremos GNS3 y editaremos las preferencias de GNS VM y seleccionaremos la maquina virtual que acabamos de importar :\nSe nos iniciara la maquina virtual y podremos ver los datos de la misma en la pestaña info :\nLanzaremos el set-up wizard desde la pestaña help de GNS3 y seleccionaremos la opción de ejecutar las apilances en una maquina virtual :\nSeleccionaremos la configuración de nuestra maquina virtual :\nSeleccionaremos de nuevo nuestra maquina virtual y las características hardware que deseemos :\nSolo nos quedara importar los dispositivos en la maquina virtual , esto se hace igual que hemos echo anteriormente cambiando el sitio donde lo importamos :\nSi queremos ver donde se ejecutara un dispositivo podemos verlo a través de preferencias :\nAdemás podemos ver en apartado servers sumarry el consumo de recursos de nuestras maquinas :\n8 Conclusión Podemos ver que la instalación es infinitamente mas cómoda en Windows ya que automáticamente te instala las dependencias, siendo la típica instalación de “siguiente a siguiente ” .\nAdemás en Windows al acabar la instalación el producto estaba listo para usarse y no he sufrido ningún error al iniciar el programa ni al usar sus características como si me ha pasado en Debian .\n9 Bibliografía Documentacion oficial wireshark\nPaquete wireshark en debian\nRequisitos mínimos wireshark\nError “VPCS executable version must be \u0026gt;=0.6.1 but not 0.8” Descarga VPCS\n","date":"September 8, 2023","hero":"/images/redes/instalacion_wireshark_gns3/portada_instalacion_wireshark_gns3.png","permalink":"https://www.javiercd.es/posts/redes/instalacion_wireshark_gns3/instalacion-gns3-y-wireshark/","summary":"\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e⚠️ Advertencia:\u003c/strong\u003e Este post fue desarrollado para Debian 11. Si tienes una versión más reciente, puedes revisar el post para Debian 12 que encontrarás en el apartado de redes de esta misma página. La única parte que no deberías seguir si cumples con esta condición es la instalación de GNS3. Todo el resto del contenido sigue siendo valido .\u003c/p\u003e\u003c/blockquote\u003e\n\u003c!-- ![2](/images/redes/instalacion_wireshark_gns3/portada_instalacion_wireshark_gns3.jpeg)\r\n\r\n![](/images/redes/instalacion_wireshark_gns3/Aspose.Words.7be2264a-b643-4cb1-9a61-896b263a0d52.003.jpeg) --\u003e\r\n\u003ch2 id=\"1-introducción\"\u003e1. \u003cstrong\u003eIntroducción\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eWireshark es un analizador de protocolos utilizado para realizar análisis y solucionar problemas en redes de comunicaciones, para análisis de datos y protocolos, y como una herramienta didáctica.\u003c/p\u003e","tags":["Redes","Wireshark","GNS3"],"title":"Instalación GNS3 y Wireshark en Debian"},{"categories":null,"contents":"En ocasiones, es necesario actualizar el almacenamiento de nuestro sistema Debian para satisfacer las crecientes necesidades de espacio y mejorar la organización del disco. En esta guía, exploraremos el proceso de migración desde un disco con una única partición hacia uno con mayor capacidad, además de dividirlo en particiones separadas para una gestión más eficiente.\nEste proceso no solo ampliará el espacio de almacenamiento disponible, sino que también brindará una estructura más ordenada al sistema, facilitando tareas como la gestión de respaldos, el rendimiento del sistema y la administración del espacio en disco.\nCaracterísticas de la maquina Crea una máquina virtual en virt-manager con las siguientes características:\nSe instalará sistema operativo GNU/Linux Debian11. Tamaño de memoria: 1GB. CPU:1 Tamaño de disco duro: 2GB Detalles del hipervisor: chipset:Q35 Firmware: UEFIx86 Esquema de particiones La instalación de debian la realizarás, con el siguiente esquema de particiones: partición efi: 50MB\npartición /: 2GB\nswap: el resto de espacio sobrante.\nNo se instalará ningún entorno de escritorio.\nUna vez instalado el sistema, nos damos cuenta que estaríamos muy justos de espacio.\nAmpliación del disco Particionado Añade un disco a tu sistema de 10GB.\nParticiona este disco, eligiendo el tamaño apropiado para cada una de las particiones, teniendo en cuentas que cada partición será asignada a un directorio de los indicados:\n/boot/efi FAT32 partición efi –\u0026gt; 100MB / ext4 –\u0026gt; 8GB\n/home ext4 –\u0026gt;1GB\n/var ext4 –\u0026gt; 400MB\n/usr ext4 –\u0026gt; 400MB\nswap swap –\u0026gt; 200MB\nDando sistema de ficheros a las particiones Para darle formato a esta partición /boot/efi FAT32 partición efi –\u0026gt; 100MB\nPara estas particiones le daré formato ext4: / ext4 –\u0026gt; 8GB\n/home ext4 –\u0026gt;1GB\n/var ext4 –\u0026gt; 400MB\n/usr ext4 –\u0026gt; 400MB\nPara dar formato de swap: swap swap –\u0026gt; 200MB\nPara “activar la swap” –\u0026gt; sudo swapon dev/vdb6 y posteriormente para hacerlo permanente lo añadiremos al /etc/fstab .\nNos quedaría el disco con los siguientes formatos :\nMigración de datos Partición EFI A continuación realizaremos una copia fidedigna de cada una de nuestras particiones para ello , creare un directorio para montar cada disco en un directorio con su nombre :\nY montaremos las particiones en estos directorios :\nComenzaremos a pasar la información de nuestras particiones . Es importante usar el parámetro a (lo mismo que dpR) que permite hacer la copia recursivamente además se conservan intactos los permisos y enlaces que se encuentren en el sistema. Con el parámetro f, forzamos la copia.\nCopia de la partición EFI :\nPartición HOME Lo montaremos en un directorio cualquiera , a continuación lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobación de forma manual .\nAhora lo añadiremos al fstab :\nLo montamos con un mount -a . Lo desmontamos y borraremos el directorio home del antiguo disco :\nPartición VAR Lo montaremos en un directorio cualquiera , a continuación lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobación de forma manual .\nAhora lo añadiremos al fstab :\nLo montamos con un mount -a . Lo desmontamos y borraremos el directorio var del antiguo disco :\nPartición USR Lo montaremos en un directorio cualquiera , a continuación lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobación de forma manual .\nAhora lo añadiremos al fstab :\nLo montamos con un mount -a :\nLo desmontamos y borraremos el directorio home del antiguo disco :\nY volveremos a montarlos con un mount -a .\nPartición RAIZ Lo montaremos en un directorio cualquiera , a continuación lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobación de forma manual .\nExcluyendo los directorios que hemos separado anteriormente :\nAhora lo añadiremos al fstab :\nPara montar esta partición deberemos de reiniciar el sistema .\nGenerar la nueva EFI Para esto hay que seguir un procedimiento distinto , lo primero que haremos sera darle formato fat32 a la partición . Después igual que las demás la montaremos y instalaremos un nuevo grub especificando donde queremos instalarlo , en el segundo disco.\nAhora lo añadiremos al fstab :\nReiniciaremos el equipo y comprobaremos que funciona :\nAhora actualizaremos el grub :\nAhora para construir el nuevo efi tendremos que a través de un cd live o desde el modo rescate construir un nuevo grub :\nMontamos nuestra nueva partición del sistema y le damos a reinstalar el cargador de arranque grub :\nUna vez hecho esto apagamos la maquina y ponemos el segundo disco primero e el orden de arranque y reiniciamos el equipo :\nCuando reinicie elegimos la primera opción que es el arranque de vdb :\nY habremos conseguido migrar el sistema a un disco mas grande :\nMi /etc/fstab ha quedado de la siguiente manera :\nBibliografía Migrar de un disco a otro Copiar particiones Recuperar grub ","date":"September 8, 2023","hero":"/images/sistemas/migracion_de_sistema_de_ficheros/portada.jpg","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/migracion_sistema_de_ficheros/sistemas-de-ficheros/","summary":"\u003cp\u003eEn ocasiones, es necesario actualizar el almacenamiento de nuestro sistema Debian para satisfacer las crecientes necesidades de espacio y mejorar la organización del disco. En esta guía, exploraremos el proceso de migración desde un disco con una única partición hacia uno con mayor capacidad, además de dividirlo en particiones separadas para una gestión más eficiente.\u003c/p\u003e\n\u003cp\u003eEste proceso no solo ampliará el espacio de almacenamiento disponible, sino que también brindará una estructura más ordenada al sistema, facilitando tareas como la gestión de respaldos, el rendimiento del sistema y la administración del espacio en disco.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Migración de un sistema de ficheros"},{"categories":null,"contents":"NAT con iptables En este artículo aprenderás a configurar un pequeño escenario en el cual podrás configurar una serie de servicios. Crearás el escenario descrito a continuacion , además, harás que a través de una red interna, usando un servidor Linux, tengas acceso a Internet configurando SNAT en el mismo haciendo uso de iptables.\nInstalación del entorno de pruebas Vamos a instalar el siguiente entorno:\nConfiguración de VirtualBox Servidor debian :\nCliente windows\nCliente debian\nConfiguración de red Lo primero que haremos sera configurar las tarjetas de red de nuestras maquinas .\nServidor debian Editamos el fichero con nano /ect/network/interfaces como superusuario y añadimos las siguientes lineas .\nLos cuadros rojos corresponden a la configuración de las tarjetas de red enp0s3(tarjeta externa) y enp0s8(red interna). El cuadro azul corresponde a las reglas iptables para permitir las peticiones al exterior y prohibir las interiores .\nCliente debian Editamos el fichero con nano /etc/network/interfaces como superusuario y añadimos las siguientes lineas .La puerta de enlace sera la dirección ip de la tarjeta del servidor interna .\nCliente Windows 10 En windows 10 configuramos manualmente accediendo a conexiones de red \u0026gt; configuracion del adaptador \u0026gt; ipv4 y le asignamos lo siguiente .Al igual que el cliente debian cambiando la dirección ip . He puesto dns de Google porque utilizo mi red movil .\nConfiguración de nat en el servidor Modificar el fichero /etc/sysctl.conf. Hay que descomentar la línea :\nComprobamos si se ha aplicado\nComprobación de internet en los clientes Windows 10 Debian 11 ","date":"September 8, 2023","hero":"/images/servicios/nat_iptables/portada_iptables.jpeg","permalink":"https://www.javiercd.es/posts/servicios/nat_iptables/nat_iptables/","summary":"\u003ch1 id=\"nat-con-iptables\"\u003eNAT con iptables\u003c/h1\u003e\n\u003cp\u003eEn este artículo aprenderás a configurar un pequeño escenario en el cual podrás configurar una serie de servicios. Crearás el escenario descrito a continuacion , además, harás que a través de una red interna, usando un servidor Linux, tengas acceso a Internet configurando SNAT en el mismo haciendo uso de iptables.\u003c/p\u003e\n\u003ch2 id=\"instalación-del-entorno-de-pruebas\"\u003eInstalación del entorno de pruebas\u003c/h2\u003e\n\u003cp\u003eVamos a instalar el siguiente entorno:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/nat_iptables/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"configuración-de-virtualbox\"\u003eConfiguración de VirtualBox\u003c/h3\u003e\n\u003cp\u003eServidor debian :\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT"],"title":"NAT con iptables"},{"categories":null,"contents":"El Protocolo de Resolución de Direcciones (ARP) es fundamental en redes informáticas para mapear direcciones IP a direcciones físicas de capa de enlace (MAC). Su función principal es encontrar la dirección MAC asociada a una dirección IP específica en una red local. Cuando un dispositivo necesita comunicarse con otro en la misma red, utiliza ARP para determinar la dirección MAC del destino antes de enviar datos.\n¿Crees que la pregunta ARP es un mensaje de difusión? Realiza una captura en Wireshark de una petición ARP y analízala para justificar tu respuesta. Si , es un mensaje de difusión ya que en la cabecera podemos ver que el destino tiene una dirección de broadcast . Esta dirección es la que tiene todos sus bits a 1 que en las direcciones mac se traduce en FF:FF:FF:FF:FF:FF .\nCuando esta le llegue , en este caso al que tiene la dirección IP 192.168.1.1 nos devolverá la petición y en el origen obtendremos su dirección MAC.\n¿Crees que la respuesta ARP es un mensaje de difusión? Realiza una captura en Wireshark de una respuesta ARP y analízala para justificar tu respuesta. Podemos ver en la respuesta que en la dirección de destino viene la del pc que mando la pregunta , por lo que la respuesta no es un mensaje de broadcast sino una comunicación punto a punto .\nLos ordenadores de una red almacenan en memoria una caché con las correspondencias IP-MAC que van conociendo. Explica el proceso de actualización de la caché ARP después de observar como se va rellenando en las máquinas de un pequeño escenario en GNS3 con una red local con cuatro ordenadores conectados a un switch. Ve comprobando como cambia la caché ARP de todos los ordenadores cuando vas haciendo ping entre un ordenador y otro. Cuando hacemos un ping el emisor y el receptor “se añaden mutuamente a la tabla ARP” , si las consultamos en ambas veremos que están incluidos :\nPodemos ver que el tiempo por el que se guardan en cache es de 120 segundos , cuando este tiempo se acaba, se borra la entrada.\nMientras que en los pcs que no han intervenido no almacenaran nada en la cache arp sobre la “transacción realizada”:\nAnaliza el comando ip neigh para ver las posibilidades que ofrece y piensa cual puede ser el uso real de cada una de ellas. Este comando nos permite interactuar con la tabla arp donde se guardan la relación de direcciones IP-MAC . Por ejemplo podemos visualizarla , añadir entradas o borrarlas así como modificarlas . Además podemos cambiar el tiempo durante el cual se guarda una petición en la tabla .\nPor ejemplo , listar el contenido :\nPodemos resumir sus funciones :\nMostrar la tabla ARP completa: ip neighbour show Agregar una entrada a la tabla ARP: ip neighbour add (IP) lladdr {MAC} dev {interface} Eliminar una entrada de la tabla ARP: ip neighbour del {IP} dev {interface} Establecer el tiempo de vida de una entrada en la tabla ARP: ip neighbour change {IP} dev {interface} nud {state} Buscar una entrada específica en la tabla ARP: ip neighbour | grep {IP} Básicamente esto es lo que debemos conocer para poder controlar las tablas ARP con el comando IP en sustitución (o como complemento) a «arp».\nAverigua qué es un ARP gratuito y cuál es el sentido de su existencia. Es una solicitud emitida por un dispositivo con el objetivo de actualizar la tabla arp del resto de dispositivos de una red . Este simplemente informa a los demás dispositivos de la red de su propia dirección IP y MAC .\nEl propósito principal de las ARP gratuitas es asegurar que todos los dispositivos en una red tengan la información más actualizada posible sobre las direcciones IP y MAC de los demás dispositivos en la red.\nUna de sus utilidades es detectar conflictos de IP\u0026rsquo;s, \u0026ldquo;esta ip ya está cogida\u0026rdquo; esto es debido a que otro equipo ha respondido con estos paquetes.\nPor lo que a partir de esta información se puede resolver esta incidencia.\nExplica con tus palabras en qué se basa un ataque ARP Spoofing y cómo se lleva a cabo. ¿Puede usarse como técnica de ataque desde tu casa a una red ajena? ¿Cómo podríamos defendernos de él? El ataque viene a modificar el flujo de los datos enviados desde un PC Víctima que pasa a través de un Gateway para hacer un ataque de tipo MITM (Man in the Middle) consiguiendo que el tráfico de la víctima pase por una máquina Atacante de forma inocua para la víctima.\nAsí el atacante intercepta los mensajes y es capaz de obtener todo el trafico de la red obteniendo contraseñas e información confidencial o sensible .\nLos pasos que sigue un atacante al realizar este ataque son :\nEscanear la red , para obtener una relación de los dispositivos conectados . Enviar paquetes arp falsos para asociar en las víctimas su dirección ip a su propia mac. Una vez que el cliente ha sido “engañado” , el atacante comenzara a interceptar todo el trafico. Estos ataques solo se producen si el atacante consigue acceso a tu red local , así que para protegernos podemos usar :\nHerramientas de detección de ARP Spoofing . Utilizar un firewall , ya que ese es capaz de bloquear paquetes ARP sospechosos . Utilizar protocolos como Ipsec y SSL/TLS . Configurar la tabla arp de manera estática. Hay dos tipos de ataques a switches llamados MAC Flooding y MAC Spoofing. ¿En qué consisten y cómo podemos defendernos de ellos? MAC Flooding consiste en llenar la tabla arp de un dispositivo de red , por ejemplo un switch y hacer que este no sea capaz de localizar a que boca va el trafico a si este lo mandara por todas las bocas provocando que en el peor de los casos dejar sin servicio al dispositivo .\nPara mitigar este ataque se recomienda configurar un limite en el tamaño de la tabla ARP y la detección y bloqueo de trafico sospechoso .\nMientras que el MAC Spoofing consiste en falsificar una dirección MAC para interceptar un determinado trafico , pudiendo tener acceso a contenido privado .\nPara mitigar este ataque en el caso de que suplante una maquina de mi red y tenga acceso a contenido podemos implementar herramientas de segundo factor de autentificaron o usar certificados digitales .\nAdemás podemos implementar en nuestra red las siguientes estrategias :\nEntradas estáticas en tabla ARP\nLa primera solución que existe corresponde a trabajar con rutas estáticas en los equipos de red. Esto permite invalidar los mensajes ARP, debido a que las IP se asocian una dirección MAC y esta no cambia en el tiempo. Es una solución simple y en general se aplica para asegurar que la puerta de enlace predetermina sea realmente la de la red y no un atacante. Sin embargo, es una estrategia difícil de aplicar si se posee una red con una gran cantidad de terminales.\nDHCP snooping\nEs una estrategia que mantiene un registro de las MAC que están conectadas en cada puerto y detecta inmediatamente si existe una suplantación. Varios fabricantes de equipos de red incorpora esta solución en sus equipos, como es el caso de CISCO.\nDynamic ARP Inspection\nPara evitar la suplantación de ARP (ARP spoofing) y el envenenamiento por ARP (ARP poisoning) resultante, un switch debe garantizar que solo se transmitan ARP Requests y ARP Replies válidas.\nLa Inspección Dinámica de ARP/ Dynamic ARP Inspection (DAI) requiere de DHCP snooping y ayuda a prevenir ataques ARP así:\nNo retransmitiendo respuestas/Replies ARP invalidas o gratuitas/gratuitous a otros puertos en la misma VLAN. Intercepta todas las solicitudes/Requests y respuestas/Replies ARP en puertos no confiables. Verificando cada paquete interceptado para un enlace válido de IP a MAC. Descarte y registro de respuestas no válidas de ARP para evitar el envenenamiento por ARP. Error-disabling la interfaz si se excede el número de paquetes ARP DAI configurado. RARP\nRARP es Reversal ARP, esto quiere decir que consulta a partir de una dirección MAC la IP correspondiente. En caso de que retorne más de una dirección IP, entonces la MAC ha sido clonada.\nBibliografía ip neigh arp spoofing ARP gratuitos medidas de mitigación ","date":"September 8, 2023","hero":"/images/redes/arp/portada.png","permalink":"https://www.javiercd.es/posts/redes/arp/arp/","summary":"\u003cp\u003eEl Protocolo de Resolución de Direcciones (ARP) es fundamental en redes informáticas para mapear direcciones IP a direcciones físicas de capa de enlace (MAC). Su función principal es encontrar la dirección MAC asociada a una dirección IP específica en una red local. Cuando un dispositivo necesita comunicarse con otro en la misma red, utiliza ARP para determinar la dirección MAC del destino antes de enviar datos.\u003c/p\u003e\n\u003ch2 id=\"crees-que-la-pregunta-arp-es-un-mensaje-de-difusión-realiza-una-captura-en-wireshark-de-una-petición-arp-y-analízala-para-justificar-tu-respuesta\"\u003e¿Crees que la pregunta ARP es un mensaje de difusión? Realiza una captura en Wireshark de una petición ARP y analízala para justificar tu respuesta.\u003c/h2\u003e\n\u003cp\u003eSi , es un mensaje de difusión ya que en la cabecera podemos ver que el destino tiene una dirección de broadcast . Esta dirección es la que tiene todos sus bits a 1 que en las direcciones mac se traduce en FF:FF:FF:FF:FF:FF .\u003c/p\u003e","tags":["Redes","ARP"],"title":"Protocolo ARP"},{"categories":null,"contents":"servidor SSH bajo debian Gestión remota usando SSH Lo primeros que deberemos de hacer sera instalarnos el paquete en el servidor y el cliente :\nPor seguridad se suele no permitir la conexión del root al servidor; para ello, se debe modificar el archivo /etc/ssh/sshd_config, y se pone la siguiente opción:\nY reiniciamos el servicio para que se apliquen los cambios :\nConectarse al servidor ssh Vamos a instalarnos el cliente ssh, para ello:\nPara acceder desde el cliente al servidor tecleamos:\nNos abríamos conectado remotamente\nEjecución remota de aplicaciones gráficas Mediante ssh existe la posibilidad de ejecutar aplicaciones gráficas en el servidor y manejarlas y visualizarlas en el cliente. El servidor ssh deberá tener activada la redirección del protocolo X, es decir, deberá tener el siguiente parámetro en el archivo de configuración /etc/ssh/sshd_config:\nEn mi caso ya estaba habilitado , si no lo tuviésemos lo cambiamos y reiniciamos el servicio para que se apliquen los cambios . Ahora deberemos de conectarnos con el parámetro -X :\ny posteriormente podemos ejecutar cualquier aplicación gráfica, por ejemplo, gedit:\nSe nos abrirá el programa gráficamente :\nAhora vemos en el servidor que se ha creado :\nTransferir ficheros con ssh Para copiar un fichero desde el cliente al servidor introducimos el siguiente comando :\nAhora vamos a comprobar si se ha copiado al servidor :\nAcceso remoto por cifrado asimetricó Configuracion del acceso por claves Vamos a generar nuestras claves desde nuestro cliente :\nAhora vamos a añadirla a nuestro servidor :\nUna vez echo esto deshabilitamos el acceso con contraseña en el servidor editando el archivo /etc/ssh/sshd_config :\nA continuación solo debemos reiniciar el servicio y al volver a registrarnos, ya estaremos utilizando clave publica :\nSi nos intentamos registrar con usuario el cual no tenemos la clave publica nos dirá lo siguiente :\nCambio de puerto Ahora vamos a editar el fichero de configuración para indicar el puerto :\nY reiniciaremos el servicio :\nAhora si nos intentamos conectar como lo hemos hecho anterior mente , nos dara el siguiente error :\nPara conectarnos deberemos de especificar el puerto por el cual nos conectamos con -p :\nConectarnos con un cliente de acceso remoto usando túneles Usaremos kitty , cuando lo abramos en la primera pantalla introducimos la ip del servidor y el puerto que haya configurado en el servidor para el ssh en mi caso 2222\nAhora añadimos el puerto por el cual nos conectaremos usando el túnel y después la ip seguida de dos puntos y el mismo puerto .\nAhora introducimos nuestro usuario y contraseña y nos habremos conectado :\nSi queremos hacer lo mismo pero usando una clave publica desde windows , pulsamos windows +r y escribimos lo siguiente :\nY generamos las claves publicas :\nAhora vamos a la ruta que lo hemos guardado copiamos la clave publica y la introducimos en el servidor , por comodidad la he copiado desde el cliente usando ssh.\nUna vez añadida guardamos el archivo :\nVamos a desactivar la autenticación por contraseña y reiniciamos el servicio\nAhora desde el kitty deberemos de irnos al apartado ssh\u0026gt;auth , le damos a browse y seleccionamos nuestra clave privada , que deberá tener la extension .ppk . Yo la copie en otro directorio por comodidad para las pruebas .\nY nos conectamos :\nAquí hemos combinado conectarnos con kitty usando un túnel + otro puerto + clave publica .\nVNCserver Lo instalamos con el siguiente comando :\nA continuación configuramos las credenciales de configuración para administradores y usuarios de acceso con el siguiente comando :\nAhora vamos al cliente y introducimos la ip seguida del puerto por dos puntos, si no lo sabemos lo podemos mirar con :\nNos saldrá una advertencia al no estar cifrada la comunicación , le damos a continuar y introducimos la contraseña de acceso , que hayamos puesto anteriormente :\nComo no tenemos entrono grafico en el servidor no nos mostrara imagen pero podemos ver que hemos establecido conexión tanto en windows como en Linux :\nGestión de páginas web mediante ssh 1.Una vez creado los dos sitio virtuales deseamos establecer una conexión segura a cada uno de nuestros sitios, para ello debemos establecer un túnel ssh de la misma manera que lo hemos establecido para establecer una conexión remota por vnc .\n2.Crear un túnel desde el cliente ssh para que el acceso a la sección privada de la web de departamentos se establezca por el puerto 9999\n3.Con ambos túneles establecidos comprobar que el acceso a la web iesgn.org se puede realizar sin problemas por el puerto 80\nSolo he conseguido hacer a mi pagina por defecto , para eso hacemos un túnel con kitty por ejemplo:\nAhora añadimos los puertos origen y destino del puerto :\nAhora nos registramos con nuestro usuario :\nUna vez establecido el túnel introducimos en el navegador localhost:8888 :\nY así hemos establecido una conexión segura web .\nSi cerramos el túnel perderemos la conexión :\n","date":"September 8, 2023","hero":"/images/servicios/ssh/portada-ssh.png","permalink":"https://www.javiercd.es/posts/servicios/ssh/ssh/","summary":"\u003ch1 id=\"servidor-ssh-bajo-debian\"\u003eservidor SSH bajo debian\u003c/h1\u003e\n\u003ch2 id=\"gestión-remota-usando-ssh\"\u003eGestión remota usando SSH\u003c/h2\u003e\n\u003cp\u003eLo primeros que deberemos de hacer sera instalarnos el paquete  en el servidor y el cliente :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ssh/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.079.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePor seguridad se suele no permitir la conexión del root al servidor; para ello, se debe modificar el archivo /etc/ssh/sshd_config, y se pone la siguiente opción:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ssh/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.080.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eY reiniciamos el servicio para que se apliquen los cambios :\u003c/p\u003e\n\u003ch3 id=\"conectarse-al-servidor-ssh\"\u003eConectarse al servidor ssh\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ssh/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.081.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eVamos a  instalarnos el cliente ssh, para ello:\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT","SSH","FORWARDING"],"title":"SSH bajo debian "},{"categories":null,"contents":"Storage Spaces es una característica de almacenamiento definido por software en el sistema operativo Windows Server que permite a los administradores de sistemas combinar varios discos físicos en un único espacio de almacenamiento lógico llamado \u0026ldquo;pool de almacenamiento\u0026rdquo;. Este pool de almacenamiento se puede utilizar para crear espacios de almacenamiento virtuales llamados \u0026ldquo;espacios de almacenamiento\u0026rdquo; que ofrecen diversas funciones de redundancia y capacidades avanzadas de administración de almacenamiento.\nGrupos de almacenamiento Los siguientes cmdlets de Windows PowerShell realizan la misma función que el procedimiento anterior. Escriba cada cmdlet en una sola línea, aunque aquí pueden aparecer con saltos de línea entre varias líneas aquí debido a restricciones de formato.\nEl siguiente ejemplo muestra qué discos físicos están disponibles en el grupo primordial.\nGet-StoragePool -IsPrimordial $true | Get-PhysicalDisk -CanPool $True El siguiente ejemplo crea un nuevo grupo de almacenamiento denominado StoragePool1 que usa todos los discos disponibles:\nNew-StoragePool –FriendlyName StoragePool1 –StorageSubsystemFriendlyName \u0026#34;Windows Storage\\*\u0026#34; –PhysicalDisks (Get-PhysicalDisk –CanPool $True) Por defecto el tipo de aprovisionamiento es mirror.\nSi necesitamos añadir mas discos :\nAdd-PhysicalDisk -StoragePoolFriendlyName StoragePool1 -PhysicalDisks (Get-PhysicalDisk - CanPool $True) Crear un disco virtual Vamos a crear un disco virtual :\nNew-VirtualDisk –StoragePoolFriendlyName StoragePool1 –FriendlyName VirtualDisk1 –Size (8GB) Automáticamente nos creara un volumen y nos lo montara en una letra disponible: :\nPodemos interactuar con el y guardar información :\nVemos que este es el “equivalente” a LVM en Windows . Vemos que hay similitudes no solo en la estructura a la hora de crearlo si no que también podemos observar que hacen referencia en la documentación oficial a RAID 5 y RAID 6:\nA la forma de almacenar los datos en ya sea en stripes o guardando el espacio completo , al igual que sucede en Linux :\nBibliografía Documentación oficial ","date":"September 8, 2023","hero":"/images/sistemas/storage_spaces/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/almacenamiento_servidor_independiente/almacenamiento_servidor_independiente/","summary":"\u003cp\u003eStorage Spaces es una característica de almacenamiento definido por software en el sistema operativo Windows Server que permite a los administradores de sistemas combinar varios discos físicos en un único espacio de almacenamiento lógico llamado \u0026ldquo;pool de almacenamiento\u0026rdquo;. Este pool de almacenamiento se puede utilizar para crear espacios de almacenamiento virtuales llamados \u0026ldquo;espacios de almacenamiento\u0026rdquo; que ofrecen diversas funciones de redundancia y capacidades avanzadas de administración de almacenamiento.\u003c/p\u003e\n\u003ch2 id=\"grupos-de-almacenamiento\"\u003eGrupos de almacenamiento\u003c/h2\u003e\n\u003cp\u003eLos siguientes cmdlets de Windows PowerShell realizan la misma función que el procedimiento anterior. Escriba cada cmdlet en una sola línea, aunque aquí pueden aparecer con saltos de línea entre varias líneas aquí debido a restricciones de formato.\u003c/p\u003e","tags":["Linux","Sistemas","ISO","ASO"],"title":"Storage Spaces en Windows Server"},{"categories":null,"contents":"Introducción En este post detallado, exploramos el proceso de configuración de túneles IPv6 a IPv4 y viceversa en entornos Linux y Cisco. A medida que la migración hacia IPv6 gana importancia, la capacidad de establecer comunicaciones entre redes IPv4 e IPv6 se vuelve fundamental. Cubriremos los conceptos básicos de la configuración de túneles, incluyendo los tipos de túneles más comunes, como 6to4 y Teredo. Además, proporcionaremos instrucciones paso a paso para la configuración tanto en sistemas Linux como en dispositivos Cisco.\nTúneles 6to4 en Cisco 1. Configuración de las interfaces de red de los routers R1 FastEthernet 0/0 Prefijo de red: 3333:db7::/64 Enlace: FE80::C801:20FF:FE69:0 Global: 3333:DB7::C801:20FF:FE69:0 FastEthernet 1/0 FastEthernet 2/0 Para los clientes del router R1, configuraremos SLAAC:\nR2 FastEthernet 0/0 Prefijo de red: 3333:db7:1::/64 Enlace: FE80::C802:20FF:FE79:0 Global: 3333:DB7:1:0:C802:20FF:FE79:0 FastEthernet 1/0 FastEthernet 2/0 Para los clientes del router R2, configuraremos SLAAC:\nR3 FastEthernet 0/0 Prefijo de red: 3333:db7:2::/64 Enlace: FE80::C803:20FF:FE89:0 Global: 3333:DB7:2:0:C803:20FF:FE89:0 FastEthernet 1/0 FastEthernet 2/0 Para los clientes del router R3, configuraremos SLAAC:\nNota: En este escenario, no es necesario configurar rutas IPv4 manualmente, ya que con la configuración dada en las tarjetas de red, el tráfico será enrutable en IPv4.\n2. Túneles GRE GRE es un protocolo de túnel VPN de sitio a sitio no seguro que puede encapsular una amplia variedad de paquetes de protocolos dentro de túneles IP. Esto permite que una organización transmita otros protocolos a través de una WAN basada en IP.\nEsto permite agregar una cabecera IPv4 a un paquete IPv6 para que pueda viajar por redes IPv4.\nR1 → R3 Crearemos una interfaz de túnel:\nConfiguración de Túnel GRE con IPv6 sobre IPv4 Establecemos el modo del túnel a GRE con IP que encapsulará nuestros paquetes IPv6 dentro de IPv4:\nLe asignamos una dirección IPv4 a nuestro túnel:\nEstablecemos la dirección WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la dirección WAN del extremo del túnel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento dinámico:\nEste comando agrega la red del túnel a OSPF:\nAsignamos una dirección IPv6 a nuestro túnel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:0A00:0001::1/64:\nCreamos la ruta para llegar a la red:\nCreamos una interfaz de túnel:\nEstablecemos el modo del túnel a GRE con IP que encapsulará nuestros paquetes IPv6 dentro de IPv4:\nLe asignamos una dirección IPv4 a nuestro túnel:\nEstablecemos la dirección WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la dirección WAN del extremo del túnel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento dinámico:\nEste comando agrega la red del túnel a OSPF:\nAsignamos una dirección IPv6 a nuestro túnel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:0A00:0002::1/64:\nCreamos la ruta para llegar a la red:\nCreamos una interfaz de túnel:\nEstablecemos el modo del túnel a GRE con IP que encapsulará nuestros paquetes IPv6 dentro de IPv4:\nLe asignamos una dirección IPv4 a nuestro túnel:\nEstablecemos la dirección WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la dirección WAN del extremo del túnel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento dinámico:\nEste comando agrega la red del túnel a OSPF:\nAsignamos una dirección IPv6 a nuestro túnel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:1400:0001:\nCreamos la ruta para llegar a la red:\nR3 → R1 Creamos una interfaz de túnel:\nEstablecemos el modo del túnel a GRE con IP, que encapsulará nuestros paquetes IPv6 dentro de IPv4:\nAsignamos una dirección IPv4 a nuestro túnel:\nEstablecemos la dirección WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la dirección WAN del extremo del túnel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento dinámico:\nEste comando agrega la red del túnel a OSPF:\nAsignamos una dirección IPv6 a nuestro túnel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:1400:0002::1/64:\nCreamos la ruta para llegar a la red:\nR3 → R2 Creamos una interfaz de túnel:\nEstablecemos el modo del túnel a GRE con IP, que encapsulará nuestros paquetes IPv6 dentro de IPv4:\nAsignamos una dirección IPv4 a nuestro túnel:\nEstablecemos la dirección WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la dirección WAN del extremo del túnel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento dinámico:\nEste comando agrega la red del túnel a OSPF:\nAsignamos una dirección IPv6 a nuestro túnel, con el prefijo de red 2002 a partir de la IPv4 del router 30.0.0.2 → 2002:1e00:0002::1/64:\nCreamos la ruta para llegar a la red:\nR2 → R3 Creamos una interfaz de túnel:\nEstablecemos el modo del túnel a GRE con IP, que encapsulará nuestros paquetes IPv6 dentro de IPv4:\nAsignamos una dirección IPv4 a nuestro túnel:\nEstablecemos la dirección WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la dirección WAN del extremo del túnel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento dinámico:\nEste comando agrega la red del túnel a OSPF:\nAsignamos una dirección IPv6 a nuestro túnel, con el prefijo de red 2002 a partir de la IPv4 del router 30.0.0.1 → 2002:1e00:0001::1/64:\nCreamos la ruta para llegar a la red:\n3. Comprobaciones de funcionamiento Vamos a comprobar que se han creado los túneles. Para ello, introduciremos el siguiente comando en los tres routers de nuestro escenario:\nEsto aparecerá una vez ambos extremos del túnel se hayan creado. Si no, no aparecerá nada. En nuestro caso, podemos ver que los túneles se han creado exitosamente.\nPing Comprobaremos el funcionamiento de los túneles haciendo un ping.\nPC1 → 3333:db7::e60:ddff:fea6:0 PC2 → 3333:db7:1:0:e2e:3bff:fe83:0 PC3 → 3333:db7:2:0:e62:5dff:fedf:0 PC1 → PC2\nPC1 → PC3\nPC2 → PC1\nPC2 → PC3\nPC3 → PC1\nPC3 → PC2\nVemos que tenemos conectividad entre todas nuestras máquinas del escenario con IPv6, aunque tengamos que atravesar redes IPv4.\nTraceroute Vamos a comprobar la trayectoria que siguen los paquetes.\nTrayectoria que sigue un paquete PC1 a PC2:\nTrayectoria que sigue un paquete PC1 a PC3:\nTrayectoria que sigue un paquete PC2 a PC1:\nTrayectoria que sigue un paquete PC2 a PC3:\nTrayectoria que sigue un paquete PC3 a PC1:\nTrayectoria que sigue un paquete PC3 a PC2:\n4. Estudio de un paquete encapsulado Antes de pasar por el túnel\nPaquete que viaja de PC1 a PC2.\nVemos que, al no haber atravesado el túnel aún, no tiene las cabeceras IPv4, solo tiene las IPv6. Podemos ver que el origen es PC1 y el destino es PC3:\nVeremos cómo, en el siguiente tramo, una vez atraviese el túnel, el router le pondrá una cabecera IPv4 para que pueda atravesar ese tramo.\nDespués de atravesar el túnel Si nos fijamos en un paquete que ha atravesado un túnel, podemos ver que tiene \u0026ldquo;2 niveles de red\u0026rdquo;:\nSi nos fijamos en el nivel de red, vemos que las IPs de origen y destino son las de los extremos del túnel. Además, vemos que utiliza el protocolo 47, lo que significa que ha atravesado un túnel GRE.\nPor último, podemos ver en la cabecera IPv6 que no se distingue de una que no ha atravesado un túnel.\nUna vez llega a la red de destino Vemos que, una vez llega al destino (es decir, una vez ha recorrido el tramo IPv4 y vuelve a entrar a la red IPv6), el router eliminará la cabecera correspondiente a IPv4 y dejará la de IPv6 para que el paquete llegue a su destino.\nVemos que la cabecera IPv6 sigue intacta, es la misma durante todo el trayecto del paquete:\nTúneles 6to4 en Linux 1. Configuración de las interfaces de red Voy a respetar las direcciones IPv4 del escenario con Cisco.\nR1 Para aplicar la configuración, haremos un sudo systemctl restart networking.service.\nVoy a configurar SLAAC para configurar los clientes de nuestra red IPv6. Previamente, tendremos que tener instalado el paquete radvd con sudo apt install radvd.\nUna vez configurado el servicio, reiniciaremos radvd y nuestros clientes se configurarán automáticamente con el prefijo indicado.\nR2 Para aplicar la configuración, haremos un sudo systemctl restart networking.service.\nVoy a configurar SLAAC para configurar los clientes de nuestra red IPv6. Previamente, tendremos que tener instalado el paquete radvd con sudo apt install radvd.\nUna vez configurado el servicio, reiniciaremos radvd y nuestros clientes se configurarán automáticamente con el prefijo indicado.\nR3 Para aplicar la configuración, haremos un sudo systemctl restart networking.service.\nVoy a configurar SLAAC para configurar los clientes de nuestra red IPv6. Previamente, tendremos que tener instalado el paquete radvd con sudo apt install radvd.\nUna vez configurado el servicio, reiniciaremos radvd y nuestros clientes se configurarán automáticamente con el prefijo indicado.\nNota: En este escenario no es necesario que configuremos rutas IPv4 manualmente, ya que con la configuración dada en las tarjetas de red, el escenario estará enrutado en IPv4.\nSin embargo, será necesario para todos los routers que habilitemos el bit de forwarding tanto para IPv4 como para IPv6.\nPara ello, editamos el fichero sudo nano /etc/sysctl.conf y descomentamos las siguientes líneas:\nEsto mismo lo repetiremos para cada uno de nuestros routers y reiniciaremos para que se apliquen los cambios.\n2. Configuración de los túneles SIT El funcionamiento es similar a los túneles GRE en Cisco. Este cogerá nuestros paquetes y, a través de una interfaz tipo túnel, le añadirá una cabecera IPv4 para que pueda atravesar redes IPv4.\nUna vez el túnel esté levantado, le diremos al router que, para llegar al prefijo de la red X, tendrá que utilizar este túnel para que le añada la cabecera a nuestros paquetes.\nPara mayor comodidad, he creado un pequeño script en cada router con los comandos necesarios para que el túnel funcione.\nConsta de 4 comandos:\nCreará la interfaz de túnel con el destino y, a continuación, el origen de este. Levantará la tarjeta de red. Le asignará la IPv6 al túnel a partir de la dirección IPv4 de origen del mismo. Crearemos la ruta del tráfico que utilizará el túnel. Podemos ponerle al túnel el nombre que deseemos. En mi caso, he puesto tunnel seguido de un número para poder identificarlos.\nTúneles de R2 Así quedaría el \u0026ldquo;script\u0026rdquo; de los túneles de R2:\nUna vez creado el script, le daremos permiso y lo ejecutaremos:\nComprobaremos que las interfaces se han creado correctamente:\nTúneles de R3 Así quedaría el \u0026ldquo;script\u0026rdquo; de los túneles de R3:\nUna vez creado el script, le daremos permiso y lo ejecutaremos:\nComprobaremos que las interfaces se han creado correctamente:\n3. Comprobación de funcionamiento PC1 → 3333:db7::e47:bfff:fe86:0 PC2 → 2222:db7::ebc:f6ff:fe7d:0 PC3 → 4444:db7::e43:78ff:fec6:0 Ping PC1 → PC2\nPC1 → PC3\nPC2 → PC1\nPC2 → PC3\nPC3 → PC1\nPC3 → PC2\nTraceroute Una vez que hemos comprobado que tenemos conectividad, vamos a ver si los paquetes utilizan los túneles.\nPC1 → PC2\nPC1 → PC3\nPC2 → PC1\nPC2 → PC3\nPC3 → PC1\nPC3 → PC2\n4. Estudio de un paquete encapsulado Antes de pasar por el túnel Paquete que viaja de PC1 a PC2.\nVemos que, al no haber atravesado el túnel aún, no tiene las cabeceras IPv4, solo tiene las IPv6. Podemos ver que el origen es PC1 y el destino es PC3:\nVeremos cómo, en el siguiente tramo, una vez atraviese el túnel, el router le pondrá una cabecera IPv4 para que pueda atravesar ese tramo.\nDespués de atravesar el túnel Si nos fijamos en un paquete que ha atravesado un túnel, podemos ver que tiene \u0026ldquo;2 niveles de red\u0026rdquo;.\nSi nos fijamos en el nivel de red, vemos que las IPs de origen y destino son las de los extremos del túnel. Además, vemos que utiliza el protocolo 47, lo que significa que ha atravesado un túnel GRE.\nPor último, podemos ver en la cabecera IPv6 que no se distingue de una que no ha atravesado un túnel.\nUna vez llega a la red de destino Vemos que, una vez llega al destino (es decir, una vez ha recorrido el tramo IPv4 y vuelve a entrar a la red IPv6), el router eliminará la cabecera correspondiente a IPv4 y dejará la de IPv6 para que el paquete llegue a su destino.\nVemos que la cabecera IPv6 sigue intacta, es la misma durante todo el trayecto del paquete:\nBibliografía Túneles automáticos 6to4 Túneles Automáticos Para Ipv6 Túneles GRE Túneles SIT 6to4 Linux ","date":"September 8, 2023","hero":"/images/redes/tuneles_ipv6/portada.png","permalink":"https://www.javiercd.es/posts/redes/tuneles_ipv6/tuneles_ipv6/","summary":"\u003ch2 id=\"introducción\"\u003eIntroducción\u003c/h2\u003e\n\u003cp\u003eEn este post detallado, exploramos el proceso de configuración de túneles IPv6 a IPv4 y viceversa en entornos Linux y Cisco. A medida que la migración hacia IPv6 gana importancia, la capacidad de establecer comunicaciones entre redes IPv4 e IPv6 se vuelve fundamental. Cubriremos los conceptos básicos de la configuración de túneles, incluyendo los tipos de túneles más comunes, como 6to4 y Teredo. Además, proporcionaremos instrucciones paso a paso para la configuración tanto en sistemas Linux como en dispositivos Cisco.\u003c/p\u003e","tags":["Redes","IPv6","IPv4","Cisco","Linux"],"title":"Túneles IPv6"},{"categories":null,"contents":"Introducción Vives en UNDERWORLD. En tu mundo, se presentan diferentes tipos de especies con un único fin, “cruzarse” entre sí. Estas criaturas son:\nVAMPIROS\nLICÁNTROPOS: hombres lobo con la capacidad de regresar a su estado humano.\nHOMBRES LOBO: hombres lobo que tras su primera conversión a lobo, no pudieron regresar a su estado humano.\nHUMANOS: unos mierdecillas.\nTÚ: un guerrero informático con superpoderes como darse la vuelta a un juego que todavía no ha salido al mercado o poseer la facultad de volverse invisible cuando sale de fiesta y trata de cortejar a una fémina diciéndole frases del tipo: ¿quieres que te compile el kernel nena?\nEl aspecto de UNDERWORLD es el siguiente:\n1.Enturar el escenario Tablas de enrutamiento a “papel” ROUTER HUMANO 192.168.1.0/24 0.0.0.0 F0/0 192.168.2.0/24 0.0.0.0 F1/0 192.168.3.0/24 192.168.2.2 F1/0 192.168.4.0/24 192.168.2.2 F1/0 192.168.5.0/24 192.168.2.2 F1/0 192.168.6.0/24 192.168.2.2 F1/0 192.168.7.0/24 192.168.2.2 F1/0 0.0.0.0/0 192.168.2.2 F1/0 ROUTER VAMPIROS 192.168.1.0/24 192.168.2.1 F1/0 192.168.2.0/24 0.0.0.0 F1/0 192.168.3.0/24 0.0.0.0 F0/0 192.168.4.0/24 0.0.0.0 F2/0 192.168.5.0/24 192.168.4.2 F2/0 192.168.6.0/24 192.168.4.2 F2/0 192.168.7.0/24 192.168.4.2 F2/0 0.0.0.0/0 192.168.4.2 F2/0 ROUTER LICÁNTROPOS 192.168.1.0/24 192.168.4.1 F2/0 192.168.2.0/24 192.168.4.1 F2/0 192.168.3.0/24 192.168.4.1 F2/0 192.168.4.0/24 0.0.0.0 F2/0 192.168.5.0/24 0.0.0.0 F0/0 192.168.6.0/24 0.0.0.0 F1/0 192.168.7.0/24 192.168.6.2 F1/0 0.0.0.0/0 192.168.4.1 F1/0 ROUTER HOMBRE LOBO 192.168.1.0/24 192.168.6.1 F1/0 192.168.2.0/24 192.168.6.1 F1/0 192.168.3.0/24 192.168.6.1 F1/0 192.168.4.0/24 192.168.6.1 F1/0 192.168.5.0/24 192.168.6.1 F1/0 192.168.6.0/24 0.0.0.0 F1/0 192.168.7.0/24 0.0.0.0 F0/0 0.0.0.0/0 192.168.6.1 F1/0 2.Configuración direcciones Ips interfaces Router humanos Guardamos la configuración :\nRouter vampiros Guardamos la configuración :\nRouter licántropos Guardamos la configuración :\nRouter vampiros Guardamos la configuración :\n3. Añadiendo la tabla de enrutamiento a los routers Router humanos Nos creara por defecto las rutas a las redes que estamos conectados solo necesitaremos añadir la ruta por defecto :\nNos quedaría la tabla de enrutamiento :\nGuardamos la configuración :\nRouter vampiros Añadiremos las siguientes rutas :\nAsí quedaría la tabla de enrutamiento :\nGuardamos la configuración :\nRouter licántropos Añadimos las siguientes rutas :\nAsí quedaría nuestra tabla de enrutamiento :\nGuardamos la configuración :\nRouter hombres lobo Añadimos las siguientes rutas :\nAsí quedaría nuestra tabla de enrutamiento :\nGuardamos la configuración :\n4.Prueba de enrutamiento Para no hacer muy extenso este apartado comprobare que desde PC1 llego a todos los PCs:\n5.Configuración ACLs Todo el mundo utiliza la red para mandarse mensajitos y ligar (por lo que deberás configurar la red para que esto sea posible en un principio, es decir, que todos los equipos tengan conexión entre sí). Tú, que ya estás hasta la *#%?! de tanto bicho raro como consecuencia de los cruces que se producen cuando un vampiro se cruza por ejemplo con un licántropo y el hijo de éstos con un hombre lobo y así sucesivamente, decides ponerle fin a la historia haciendo lo siguiente, metiéndole unas cuantas ACLs a los routers que los comunican:\nLos VAMPIROS no podrán comunicarse con el resto de especies. Creamos la regla para denegar el trafico de la red 192.168.3.0:\nLa aplicamos a la interfaz FastEthernet 0/0(192.168.3.1) y la aplicamos a la salida de esta :\nComprobaremos que los PCs de la red de Vampiros no pueden comunicarse con el resto , nos dice que hay una ACL cortándonos el paso :\nSi desde cualquier otro reino nos comunicamos con ellos los mensajes serán capaces de llegar a ellos sin embargo la respuesta no llegaran ya que la ACL lo impide , la respuesta es cortada ya que sale de la red de los vampiros :\nLos HOMBRES LOBO y los LICÁNTROPOS, dado que no son tan repulsivos cuando se cruzan, podrán comunicarse entre sí. Con el resto de especies no tendrán comunicación. Este apartado podemos darle diferentes soluciones , yo he optado por poner una ACL , en la interfaz F2/0 del router de licántropos .\nCreamos la ACL :\nY la aplicamos de salida de la interfaz F2/0 de salida :\nComprobaremos que la ACL funciona , haciendo pings entre las maquinas.\nDesde PC7 vemos que no nos permite salir del router de licántropos , este nos corta la comunicación pero sin embargo podemos llegar a las demás redes :\nDesde PC5 podemos observar el mismo resultado :\nDesde PC1 vemos que no obtenemos respuesta ya que solo estamos cortando el trafico de salida impidiendo que las maquinas de “dentro” se comuniquen con las de fuera .\nHUMANOS tampoco podrán comunicarse con el resto de especies\nCon el esquema actual de ACLs no seria necesario implementar una nueva regla en ya que con el esquema actual no es posible la comunicación con ellos . Aunque los mensajes que PC1 realice lleguen a su destino este no recibirá ninguna respuesta .\nPero si aun así queremos impedir que los humanos puedan enviar mensajes a los demás desde su red implementaremos la siguiente regla en su router :\nAhora estamos cortando los mensajes de los humanos desde el Router 1:\n6.Servidor DHCP Al final decides hacer negocio con las especies raras porque no tienen ni pajolera idea de informática y eres contratado por estos entes malignos para que lleves a cabo las siguientes tareas:\nHombres lobo\nLos hombres lobo que son bastante burros metiendo direcciones IP a sus máquinas, te piden que les configures el servicio DHCP para que todas sus máquinas reciban automáticamente una IP libre:\nTendremos que hacer los siguientes pasos :\nEl comando ip dhcp excluded-address 192.168.7.1 –\u0026gt; Señalamos las direcciones que no queremos que se repartan por DHCP , es decir las exclusiones . El comando ip dhcp pool HOMBRES_LOBO nombramos al rango de direcciones que estamos repartiendo Nos meterá a la configuración del rango, ahora le decimos la red que queremos que reparta las direcciones network 192.168.7.0 255.255.255.0 Ahora le indicaremos que puerta de enlace queremos que asigne default-router 192.168.7.1 Si quisiéramos configurar un servidor DNS , por ejemplo el de google seria así dns-server 8.8.8.8 Podemos ver que el servidor DHCP esta funcionando correctamente con los parámetros que le hemos indicado anteriormente :\nLicántropos\nLos licántropos por su parte, te contratan para que les asignes también por DHCP sus IPs, pero te indican que no pueden recibir las primeras 10 direcciones de su rango (sin contar la de red ni la de la puerta de enlace), ya que éstas, están reservadas para los jefes de su clan que están de viaje y volverán en unos días.\nDeclaramos las ips que vamos a excluir :\nNombramos al rango de direcciones que estamos repartiendo para así poder configurarlo:\nLe decimos la red que queremos que reparta las direcciones :\nAhora le indicaremos que puerta de enlace queremos que asigne :\nComprobaremos que el servidor dhcp esta funcionando :\n7.Modificación ACLs Permitir ligar con las vampiros\nDe tanto hacer negocio con los vampiros, te fijas en un par de vampiritas que están de muy buen ver y te gustaría poder enviarles mensajitos desde el chalet que te acabas de comprar en HUMANLAND con el pastizal que les estás sacando a las pobres “criaturicas”. Tu IP es la 192.168.1.4 y la de SELENE y SONJA son la 192.168.3.4 y 192.168.3.5 respectivamente. Añade una máquina a HUMANLAND para tu equipo denominado IT KNIGHT y 2 máquinas denominadas SELENE y SONJA con las mencionadas IPs en TRANSILVANIA.\nSi queremos realizar esto deberemos de configurar ACLs avanzadas para poder controlar el origen y el destino de los paquetes.\nLa sintaxis es bastante sencilla en este caso :\npermit ip IP_ORIGEN WILDCARD IP_DESTINO WILDCARD Crearemos la ACL para los humanos :\nTambién crearemos la ACL para los vampiros :\nLa aplicaremos a la interfaz de entrada en cada red , ambas son la FastEthernet 0/0 :\n*****Deberemos de haber quitado anteriormente las lista asignada a la interfaz si no dará un error , para quitarla es el mismo comando que para ponerla poniendo un no delante .\nAhora comprobaremos la efectividad de estas reglas que hemos implementado :\nIT KNIGHT –\u0026gt; SELENE y SONJA\nVemos que solo nos permite el trafico hacia estos dos host específicos tal y como hemos indicado en nuestras ACLs\nSELENE –\u0026gt; IT KNIGHT\nVemos que solo nos permite el trafico hacia estos dos host específicos tal y como hemos indicado en nuestras ACLs , si intentamos comunicarnos con otro host cortara el trafico la ACL:\nSONJA–\u0026gt; IT KNIGHT\nVemos que solo nos permite el trafico hacia estos dos host específicos tal y como hemos indicado en nuestras ACLs , si intentamos comunicarnos con otro host cortara el trafico la ACL:\nTambién podemos ver las estadísticas de la ACL en el router fijándonos en los hits de la regla para ver si están funcionando :\nAunque en ninguna de las listas hemos especificado en deny any , no seria necesario ya que esta implícito , es decir por defecto al no cumplirse ninguna regla desechara el trafico .\n8. Servidor web Desde que no se puede ligar en UNDERWORLD, están todos más aburridos que un ajo, así que decides ponerles un servidor WEB interno a UNDERWORLD. Añade al router PUENTE 1, un servidor denominado FICHEROS que tendrá la IP 192.168.8.2/24, creando las ACLs necesarias para que la comunidad entera de UNDERWORLD, pueda entretenerse viendo algunas web chulas.\nLo primero sera configurar la nueva interfaz del router de los HUMANOS:\nLo siguiente sera configurar para nuestro esquema actual en el router de VAMPIROS la ruta a la nueva red para que se route el escenario correctamente :\nYa por ultimo configuraremos la ip de nuestro debian de forma estática con la dirección 192.168.8.2:\nAdemás le instalaremos apache (deberemos hacerlo previamente conectado a la nube NAT ) :\nUna vez ya tenemos el servidor web preparado y enrutado en nuestro escenario , vamos a modificar las distintas ACLs para que solo puedan llegar al servidor web por el puerto 80 .\nEn el router de los humanos añadimos la siguiente regla , la cual permite todo el trafico hacia el host 192.168.8.2 que vaya al puerto 80:\nPara refrescar la lista y que se apliquen los cambios deberemos de volver a asignársela al router :\nAhora haremos lo mismo con el router de los vampiros ya que tiene configuradas ACLs extendidas al igual que los humanos :\nAhora vamos a configurar una ACL avanzada para los licántropos y los hombres lobo :\nVamos a comprobar que NO podemos hacerle ping al servidor desde los VPCs:\nEn resumen hemos mantenido las reglas anteriores pero hemos permitido el trafico al servidor web siempre y cuando venga por el puerto 80 , por eso no podemos hacerle ping .\nVamos a comprobar que podemos acceder al servidor web desde las redes : –\u0026gt;HUMANOS :\n–\u0026gt;VAMPIROS:\n–\u0026gt;LICÁNTROPOS:\n–\u0026gt; HOMBRES LOBO :\n","date":"September 8, 2023","hero":"/images/redes/underworld/portada_underwolrd.webp","permalink":"https://www.javiercd.es/posts/redes/underworld/underworld/","summary":"\u003ch2 id=\"introducción\"\u003eIntroducción\u003c/h2\u003e\n\u003cp\u003eVives en UNDERWORLD. En tu mundo, se presentan diferentes tipos de especies con un único fin, “cruzarse” entre sí. Estas criaturas son:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eVAMPIROS\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLICÁNTROPOS: hombres lobo con la capacidad de regresar a su estado humano.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHOMBRES LOBO: hombres lobo que tras su primera conversión a lobo, no pudieron regresar a su estado humano.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHUMANOS: unos mierdecillas.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eTÚ: un guerrero informático con superpoderes como darse la vuelta a un juego que todavía no ha salido al mercado o poseer la facultad de volverse invisible cuando sale de fiesta y trata de cortejar a una fémina diciéndole frases del tipo: ¿quieres que te compile el kernel nena?\u003c/p\u003e","tags":["Redes","Wireshark","GNS3","Cisco","Enrutamiento","ACLS"],"title":"Underworld"},{"categories":null,"contents":"El mundo de UNDERWORLD ha evolucionado mucho en los últimos meses, así que debes realizar tareas de administración de la red para afrontar la nueva situación.\nPor un lado, se ha descubierto Internet en el Inframundo, de forma que cada uno de los submundos (recuerda: vampiros, licántropos, hombres lobo y humanos) se conecta a un router que, a su vez, les conecta a uno de los dos grandes routers que forman la Internet de Underworld, llamados Marcus (para humanos y vampiros) y Alexander (para hombres lobo y licántropos). Marcus y Alexander están conectados entre sí.\nEl esquema sería el siguiente:\nPor otro lado, los seres del inframundo han descubierto una vulnerabilidad en los routers CISCO que les permite saltarse las listas de control de acceso, volviendo al caos que lograste impedir en su día con las ACL.\nTu tarea consistirá entonces en:\nSustituir en la infraestructura de red los routers CISCO por máquinas Linux siguiendo el esquema de la figura. Configurar adecuadamente las máquinas Linux para que funcionen como routers. Crear las tablas de enrutamiento necesarias para que todas las máquinas se comuniquen con todas en principio, teniendo en cuenta que las redes internas tendrán direcciones privadas y en Internet tendremos direcciones públicas. Configurar los cortafuegos necesarios en los routers para que: Los VAMPIROS no puedan comunicarse con el resto de especies. Los HOMBRES LOBO y los LICÁNTROPOS, dado que no son tan repulsivos cuando se cruzan, podrán comunicarse entre sí. Con el resto de especies no tendrán comunicación. HUMANOS tampoco podrán comunicarse con el resto de especies. Configurar el servicio DHCP que tenían los hombres lobo y los licántropos en las mismas condiciones que tenían cuando se usaban routers CISCO. Configurar en los cortafuegos las reglas necesarias para que, desde HUMANLAND, IT KNIGHT siga comunicándose con sus dos vampiras favoritas (SONJA Y SELENE). Realiza las configuraciones necesarias para montar en HUMANLAND un servidor web accesible desde cualquier parte de UNDERWORLD. Preparación del escenario en Linux Configuración de las tarjetas de red Lo primero que haremos sera añadir las tarjetas de red necesarias a cada router , para ello con la maquina apagada hacemos sobre la misma clic derecho \u0026gt; configuración \u0026gt; network y añadimos los slots que sean necesarios para cada maquina :\nNecesitaremos el siguiente numero de tarjetas de red por cada dispositivo :\nRouter 1 , 2 ,3 y 4 : Necesitaran 2 tarjetas de red MARCUS y ALEXANDER : Necesitaran 3 tarjetas de red PCs : Necesitaran 1 tarjeta de red Una vez hecho esto editaremos el fichero /etc/network/interfaces para realizar nuestra configuración de red .\nPosteriormente reiniciaremos el servicio networking con systemctl restart networking.service para que se aplique la configuración de red que hemos indicado .\nConfiguración de la tarjeta de red Router 1 :\nConfiguración de la tarjeta de red Router 2 :\nConfiguración de la tarjeta de red Router 3 :\nConfiguración de la tarjeta de red Router 4 :\nConfiguración de la tarjeta de red Router MARCUS :\nConfiguración de la tarjeta de red Router ALEXANDER :\nActivar el bit de forwarding Si queremos hacer que una maquina Linux actué como router , es decir que enroute los paquetes que no tienen como destino esta deberemos de activar el bit de forwarding .\nAdemás aprovecharemos para activar el bit de forwarding permanentemente en los routers del escenario para ello editamos el fichero /etc/sysctl.conf y descomentamos esta linea :\nEsto mismo repetiremos para los 6 routers que tenemos en el escenario :\nRouter 1:\nRouter 2:\nRouter 3:\nRouter 4:\nRouter MARCUS:\nRouter ALEXANDER:\nAhora todas nuestras maquinas están configuradas para actuar como routers y encaminaran los paquetes que le lleguen y no sean para esta .\nConfiguración de rutas Aquí te mostrare si he añadido alguna ruta manualmente y las tablas de enrutamiento de los dispositivos .\nRouter MARCUS:\nRouter ALEXANDER:\nRouter 1:\nRouter 2:\nRouter 4:\nTeniendo la configuración de red que tengo en las tarjetas solo he añadido 2 rutas manuales , en los routers de MARCUS y ALEXANDER en el resto no ha sido necesario ya que esta se genera automáticamente con la puerta de enlace que hayamos colocado al configurar las interfaces de red .\nPodría haberme ahorrado escribirlas si les hubiese colocado en las interfaz que esta configurada en la red 100.X.X.X la dirección ip del otro como puerta de enlace .\nPrueba de conectividad Vamos a comprobar que hemos realizado el enrutamiento correctamente así que voy a lanzar un ping desde cada router a cada uno de los extremos del escenario .\nRouter 1 :\nRouter 2 :\nRouter 3:\nRouter 4:\nQueda comprobado que tenemos conectividad entre todos los routers , los PCS no podrán tener “conectividad” hasta que configuremos el SNAT .\nConfiguración DHCP Licántropos Los licántropos por su parte, te contratan para que les asignes también por DHCP sus IPs, pero te indican que no pueden recibir las primeras 10 direcciónes de su rango (sin contar la de red ni la de la puerta de enlace), ya que éstas, están reservadas para los jefes de su clan que están de viaje y volverán en unos días.\nCon la maquina conectada a la nube NAT y la tarjeta que este conectada configurada por DHCP nos descargaremos el servidor DHCP , para esto primero deberemos de hacer un apt update ya que la maquina no trae cargados los repositorios en memoria :\nCuando acabe de instalarse nos dará un error , este es debido a que no esta configurado el servicio y no sabe por que interfaz tiene que repartir direcciónes el servidor :\nPara ello editaremos el fichero /etc/default/isc-dhcp-server y añadiremos el nombre de la tarjeta en la sección de IPV4 :\nAhora configuraremos el ámbito con los requisitos que nos solicitan los licántropos para ello editaremos el fichero /etc/dhcp/dhcpd.conf :\nTendremos que tener en cuenta que la configuración que pongamos aquí sea coherente con la configuración de red que tenemos , tenemos que tener en cuenta que tenemos una /28 así que en este caso solo podremos tener 14 direcciónes asignables .\nPero si seguimos el enunciado las 10 primeras no las quieren por lo que solo podremos asignar 3 a nuestros clientes .\nUna vez hecho esto reiniciaremos el servicio :\nY veremos si esta funcionando , viendo el estado :\nLe asignaremos ip a un PC para comprobar que funciona :\nHombres lobo Los hombres lobo que son bastante burros metiendo direcciónes IP a sus máquinas, te piden que les configures el servicio DHCP para que todas sus máquinas reciban automáticamente una IP libre.\nCon la maquina conectada a la nube NAT y la tarjeta que este conectada configurada por DHCP nos descargaremos el servidor DHCP , para esto primero deberemos de hacer un apt update ya que la maquina no trae cargados los repositorios en memoria :\nCuando acabe de instalarse nos dará un error , este es debido a que no esta configurado el servicio y no sabe por que interfaz tiene que repartir direcciónes el servidor :\nPara ello editaremos el fichero /etc/default/isc-dhcp-server y añadiremos el nombre de la tarjeta en la sección de IPV4 :\nPor suerte los hombres lobo son menos exigentes y ellos quieres que se reparta su rango de direcciónes completo así que para ello editaremos el fichero /etc/dhcp/dhcpd.conf :\nAhora reiniciaremos el servicio :\nComprobaremos el estado del mismo para comprobar que este funcionando correctamente :\nLe asignaremos una dirección a un cliente para asegurarnos que todo funciona correctamente :\nConfiguración SNAT Para acabar la fase de preparación necesitaremos de configurar SNAT para que las distintas razas puedan comunicarse entre si .\nRouter 1 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aquí vemos una captura entre el Router 1 y el PC1 :\nVemos que una vez fuera de la red entre R1 y MARCUS se ha aplicado SNAT :\nRouter 2 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aquí vemos una captura entre el Router 2 y el PC3. Vemos que el origen es una dirección ip privada :\nVemos que una vez fuera de la red entre R2 y MARCUS se ha aplicado SNAT , ya que el origen ahora es una dirección ip publica :\nRouter 3 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aquí vemos una captura entre el Router 3 y el PC5. Vemos que el origen es una dirección ip privada :\nVemos que una vez fuera de la red entre R3 y ALEXANDER se ha aplicado SNAT , ya que el origen ahora es una dirección ip publica :\nRouter 4 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aquí vemos una captura entre el Router 4 y el PC7. Vemos que el origen es una dirección ip privada :\nVemos que una vez fuera de la red entre R4 y ALEXANDER se ha aplicado SNAT , ya que el origen ahora es una dirección ip publica :\nCon el escenario actual cualquier PC es capaz de llegar a todas las direcciónes publicas de nuestra red :\nConfiguración DNAT Para que las maquinas puedan comunicarse entre si se les ha instalado ssh , así que tendremos que configurar el DNAT .\nR1\nPara esta red como tenemos dos clientes le he cambiado el puerto que usa el ssh :\nComprobamos que puedo conectarme a ambos host desde otra red , así vemos que funciona el DNAT.\nSonja:\nSelene:\nR2\nEn esta red solo tenemos un cliente que queremos que se pueda acceder desde el exterior así que solo tendremos una regla de DNAT :\nPara comprobar la regla me meteré desde los vampiros a los humanos :\nR3\nEn esta red al haber un servicio DHCP corriendo para que la regla de DNAT funcione correctamente deberemos de hacerle una reserva a nuestro host o configurarle la tarjeta de manera estática.\nYo haré lo primero por comodidad , para ello nos dirigimos al fichero /etc/dhcp/dhcpd.conf y escribimos lo siguiente:\nhost NombreDeLaReserva { hardware ethernet DIR_MAC_HOST; fixed-address IP_RESERVA;} Una vez hecho esto reiniciamos el servicio :\nY pondré la siguiente regla:\nAhora vamos a comprobar que me puedo conectar a este host:\nR4\nEn esta red también le configuraremos una reserva en el servidor para que nuestras reglas se mantengan activas , en este caso le asignare la dirección 192.168.4.5.\nReiniciaremos el servicio y comprobamos que nuestro host tenga asignada la ip de la reserva , en caso contrario solicitaremos otra con dhclient :\nAhora añadiremos la regla de DNAT para que se pueda llegar al servidor ssh :\nComprobamos que la regla esta funcionando y podemos conectarnos desde otra red :\nConfiguración cortafuegos Los Vampiros no puedan comunicarse con el resto de especies Pondré una política por defecto DROP en la tabla FORWARD para que tire todo el trafico proveniente de la red de los vampiros :\nComprobaremos que los vampiros son incapaces de llegar a las demás redes :\nPodemos ver los hits que ha realizado para ver que esta funcionando la regla :\nPermitir comunicación entre Hombres Lobo y Licántropos Los HOMBRES LOBO y los LICÁNTROPOS, dado que no son tan repulsivos cuando se cruzan, podrán comunicarse entre sí. Con el resto de especies no tendrán comunicación.\nPondré una política por defecto DROP en la tabla FORWARD y a continuación permitiré el trafico que entre por la interfaz ens4 y salga por la ens5 , y la inversa para permitir el trafico entre esta dos redes :\nVemos que entre ellos pueden comunicarse sin embargo no pueden acceder a los Humanos ni a los Vampiros :\nComprobaremos que las reglas tienen hits :\nHUMANOS tampoco podrán comunicarse con el resto de especies Con las reglas que tenemos actualmente la comunicación con otras especies por parte de los humanos no es posible, podemos ver que en R2 sin ninguna regla adicional no podemos conectarnos :\nVemos que no podemos comunicarnos :\nSi queremos prohibir el trafico en nuestro router y no depender de las reglas externas en caso de que estas cambien añadiremos una política por defecto DROP :\nVeremos los hits en la política por defecto :\nConfigurar en los cortafuegos las reglas necesarias para que, desde HUMANLAND, IT KNIGHT siga comunicándose con sus dos vampiros favoritas (SONJA Y SELENE). Las ips de estas maquinas son :\nIT KNIGHT (SSH)–\u0026gt; 192.168.2.3:22 SONJA (SSH) –\u0026gt; 192.168.1.4:22 SELENE (SSH) –\u0026gt; 192.168.1.5:2222 En el router 1 las reglas necesarias para poder permitir esta comunicación son :\nEn el router 2 las reglas necesarias para poder permitir esta comunicación son :\nVamos a ir comprobando acción a acción para asegurarnos de que estas reglas realizan su cometido.\nSELENE –\u0026gt; ITKNIGHT\nEn el router 1 :\nEn el router 2:\nSONJA –\u0026gt; ITKNIGHT\nHacemos ssh :\nVemos los hits del router 1:\nVemos los hits del router 2(Misma regla que el apartado anterior) :\nITKNIGHT –\u0026gt; SONJA\nHacemos ssh :\nVemos los hits del router 1 :\nVemos los hits del router 2 :\nITKNIGHT –\u0026gt; SELENE\nLanzamos el ssh :\nVemos los hits del router 1 :\nVemos los hits del router 2:\nServidor web HUMANLAND Realiza las configuraciones necesarias para montar en HUMANLAND un servidor web accesible desde cualquier parte de UNDERWORLD.\nLe he dado a este la ip 192.168.2.10 .\nLo primero que debemos de configurar es el DNAT en el router R2(HUMALAND):\nAhora en el router 2 permitiremos que se reciban peticiones al servidor y sus respuestas :\nEn el router 1 permitimos que puedan hacer peticiones y sus respuestas :\nPara terminar en ALEXANDER permitimos que puedan atravesar peticiones web :\nVamos a comprobar que se pueden acceder desde todas las redes .\nVAMPIROS :\nComprobamos los hits en router 1 :\nHOMBRES LOBO Y LICÁNTROPOS\nHacemos la petición web desde ambas redes :\nComprobamos los hits en router ALEXANDER :\nPor ultimo vemos los hits en el Router 2 (HUMANOS) de la regla DNAT\nEscenario con routers Cisco Configuración de las interfaces R1\nR2\nR3\nR4\nMARCUS\nALEXANDER\nTablas de enrutamiento R1\nAñadimos la ruta por defecto :\nAsí quedaría la tabla de enrutamiento de R1:\nR2\nAñadimos la ruta por defecto :\nAsí quedaría la tabla de enrutamiento de R2:\nR3\nAñadimos la ruta por defecto :\nAsí quedaría la tabla de enrutamiento de R3:\nR4\nAñadimos la ruta por defecto :\nAsí quedaría la tabla de enrutamiento de R4:\nMARCUS\nAñadimos la ruta por defecto :\nAsí quedaría la tabla de enrutamiento de MARCUS:\nALEXANDER\nAñadimos la ruta por defecto :\nAsí quedaría la tabla de enrutamiento de ALEXANDER:\nPrueba de conectividad Vamos a comprobar que hemos realizado el enrutamiento correctamente así que voy a lanzar un ping desde cada router a cada uno de los extremos del escenario .\nR1 → A los extremos :\nR2 → A los extremos :\nR3 –\u0026gt; a los extremos:\nR4 –\u0026gt; a los extremos\nConfiguración DHCP Licántropos Los licántropos por su parte, te contratan para que les asignes también por DHCP sus IPs, pero te indican que no pueden recibir las primeras 10 direcciónes de su rango (sin contar la de red ni la de la puerta de enlace), ya que éstas, están reservadas para los jefes de su clan que están de viaje y volverán en unos días.\nLo primero que haremos sera establecer el rango de IP´s excluidas del conjunto (pool) direcciónes que podrá asignar el servicio indicando la ip inicial y final del rango, ambas incluidas:\nPonemos un nombre al rango del servicio DHCP:\nDefinimos la red a la que dará servicio de DHCP:\nIncluimos la puerta de enlace que ofrecerá el servicio :\nCon esto ya tendríamos montado el servidor DHCP , con el siguiente comando podemos ver las estadísticas del servicio para ver si este esta funcionando :\nComprobaremos a demás que se ha realizado la concesión a nuestro host :\nDHCP Hombres lobo Los hombres lobo que son bastante burros metiendo direcciónes IP a sus máquinas, te piden que les configures el servicio DHCP para que todas sus máquinas reciban automáticamente una IP libre.\nEn el apartado anterior detallo cada apartado de la configuración de un servidor DHCP en cisco , aquí te muestro la configuración para la red de los Hombre Lobo :\nComprobaremos que esta funcionando :\nConfiguración SNAT Router 1:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nEl SNAT estaría funcionando , así que vamos a comprobarlo :\nVemos que la regla tiene HITS:\nRouter 2:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nEl SNAT estaría funcionando , así que vamos a comprobarlo viendo si la regla tiene HITS:\nRouter 3:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nEl SNAT estaría funcionando , así que vamos a comprobarlo viendo si la regla tiene HITS:\nRouter 4:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de “dentro” :\nIndicamos la interfaz de “fuera”:\nEl SNAT estaría funcionando , así que vamos a comprobarlo viendo si la regla tiene HITS:\nConfiguración de DNAT R1\nComprobación :\nR2\nComprobación :\nR3\nComprobación :\nR4\nComprobación :\nConfiguración cortafuegos Los Vampiros no puedan comunicarse con el resto de especies Para ello vamos a borrar la regla existente que hay en la lista :\nAhora denegaremos el trafico saliente de la red de los vampiros :\nComprobamos que no pueden comunicarse :\nMiramos los hits de las reglas :\nPermitir comunicación entre Hombres Lobo y Licántropos Los HOMBRES LOBO y los LICÁNTROPOS, dado que no son tan repulsivos cuando se cruzan, podrán comunicarse entre sí. Con el resto de especies no tendrán comunicación.\nCon estas dos reglas permitimos a cualquier host de nuestra redes locales salir cuando el destino es los hombres lobos o los licántropos :\nR3-→ 180.0.0.1 R4 –\u0026gt; 190.0.0.1 Vemos que nos tira los paquetes que no van desde HL a LC o de LC a HL :\nHUMANOS tampoco podrán comunicarse con el resto de especies Con las reglas que tenemos actualmente la comunicación con otras especies por parte de los humanos no es posible, podemos ver que en R2 sin ninguna regla adicional no podemos conectarnos ya que nuestros paquetes llegaran a las redes .\nPara que verdaderamente los humanos no puedan comunicarse sin depender de las reglas de los demos reinos , vamos a impedir que estos salgan del reino :\nSi lo comprobamos ahora ellos no podrán salir del reino :\nMiramos los hits :\nConfigurar en los cortafuegos las reglas necesarias para que, desde HUMANLAND, IT KNIGHT siga comunicándose con sus dos vampiros favoritas (SONJA Y SELENE). Las ips de estas maquinas son :\nIT KNIGHT (SSH) -–\u0026gt; 192.168.2.3:22 SONJA (SSH) -–\u0026gt; 192.168.1.4:22 SELENE (SSH) -–\u0026gt; 192.168.1.5:2222 Para permitir que los vampiros puedan salir a comunicarse con los humanos :\nPermitimos los mensajes de salida a la publica de los vampiros cuando el puerto sea el 22 y 2222:\nAhora vamos a permitir que los vampiros puedan conectarse a los humanos usando el puerto 22 :\nNo se porque no funciona .. solo va si no coloco ninguna regla incluso permitiendo TODO el trafico ssh tampoco … También he permitido todo el ICMP pero nada sigue ocurriendo lo mismo .\nEl nat y el SNAT están funcionando bien pero a la hora de hacer las reglas ssh pasa lo siguiente en la red local al ser mandados de vuelta el router los corta a pesar de que el trafico esta permitido\n","date":"September 8, 2023","hero":"/images/redes/underworld_evolution/portada.jpeg","permalink":"https://www.javiercd.es/posts/redes/underworld_evolution/underworld_evolution/","summary":"\u003cp\u003eEl mundo de UNDERWORLD ha evolucionado mucho en los últimos meses, así que debes realizar tareas de administración de la red para afrontar la nueva situación.\u003c/p\u003e\n\u003cp\u003ePor un lado, se ha descubierto Internet en el Inframundo, de forma que cada uno de los submundos (recuerda: vampiros, licántropos, hombres lobo y humanos) se conecta a un router que, a su vez, les conecta a uno de los dos grandes routers que forman la Internet de Underworld, llamados Marcus (para humanos y vampiros) y Alexander (para hombres lobo y licántropos). Marcus y Alexander están conectados entre sí.\u003c/p\u003e","tags":["Redes","SNAT","DNAT","Cisco","Linux"],"title":"Underworld evolution"}]