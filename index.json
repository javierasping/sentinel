[{"categories":null,"contents":"La instalaci√≥n de los controladores de NVIDIA en el universo de Linux ha sido tradicionalmente un desaf√≠o, especialmente en distribuciones como Debian, donde las pol√≠ticas del software libre a menudo complican el proceso.\nEn este post voy a explicarte una forma sencilla de instalar los drivers de NVIDIA usando los repositorios oficiales de Debian 13 (Trixie). Adem√°s, al final del art√≠culo, aprender√°s a instalar una herramienta clave llamada Nvidia Optimus, que te brindar√° la capacidad de seleccionar qu√© tarjeta gr√°fica utilizar√° tu equipo.\nEsta herramienta es especialmente √∫til en port√°tiles, ya que es com√∫n que estos dispositivos presenten problemas al emitir video a trav√©s de los puertos, una situaci√≥n que puede ser f√°cilmente solucionada con esta herramienta.\nIdentificaci√≥n de Nuestra GPU Antes de embarcarnos en la instalaci√≥n y configuraci√≥n, es fundamental conocer el hardware de nuestro equipo. Para averiguar qu√© tarjetas gr√°ficas est√°n disponibles en nuestro sistema, utilizaremos el siguiente comando:\njaviercruces@HPOMEN15:~$ lspci -nn | egrep -i \u0026#34;3d|display|vga\u0026#34; 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) 06:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Cezanne [Radeon Vega Series / Radeon Vega Mobile Series] [1002:1638] (rev c5) Una vez identificado el hardware, podemos comprobar qu√© controlador est√° usando actualmente el sistema:\njaviercruces@HPOMEN15:~$ lspci -knn 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) DeviceName: NVIDIA Graphics Device Subsystem: Hewlett-Packard Company Device [103c:88d1] Kernel driver in use: nouveau Kernel modules: nouveau Como se observa, por defecto Debian utiliza el driver libre nouveau, que aunque funcional, no ofrece el mismo rendimiento ni compatibilidad que los controladores oficiales de NVIDIA.\nConfiguraci√≥n de los repositorios Para instalar los controladores propietarios, necesitamos asegurarnos de que los repositorios tengan habilitadas las secciones contrib y non-free. Edita el fichero /etc/apt/sources.list con tu editor favorito y aseg√∫rate de que quede as√≠:\njaviercruces@HPOMEN15:~$ sudo nano /etc/apt/sources.list deb http://deb.debian.org/debian/ trixie main contrib non-free non-free-firmware deb-src http://deb.debian.org/debian/ trixie main contrib non-free non-free-firmware deb http://security.debian.org/debian-security trixie-security main contrib non-free non-free-firmware deb-src http://security.debian.org/debian-security trixie-security main contrib non-free non-free-firmware deb http://deb.debian.org/debian/ trixie-updates main contrib non-free non-free-firmware deb-src http://deb.debian.org/debian/ trixie-updates main contrib non-free non-free-firmware Recuerda actualizar los √≠ndices de paquetes despu√©s de cualquier cambio:\njaviercruces@HPOMEN15:~$ sudo apt update -y Detecci√≥n autom√°tica del controlador recomendado Debian nos proporciona una herramienta que detecta qu√© versi√≥n del driver debemos instalar. Inst√°lala con:\njaviercruces@HPOMEN15:~$ sudo apt install nvidia-detect -y Ejecutamos la utilidad:\njaviercruces@HPOMEN15:~$ nvidia-detect Detected NVIDIA GPUs: 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) Checking card: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] (rev a1) Your card is supported by all driver versions. Your card is also supported by the Tesla 535 drivers series. It is recommended to install the nvidia-driver package. Instalaci√≥n del driver recomendado Antes de instalar los controladores, es necesario tener los encabezados del kernel:\njaviercruces@HPOMEN15:~$ sudo apt install linux-headers-amd64 -y Y ahora s√≠, instalamos el driver NVIDIA recomendado:\njaviercruces@HPOMEN15:~$ sudo apt install nvidia-driver -y Durante la instalaci√≥n, puede que aparezca un aviso sobre el driver nouveau, ya que este estara cargado y tendra conflictos con el de nvidia . Simplemente es un aviso , al reiniciar el equipo se cargara el de nvidia y se solucionara . Selecciona \u0026ldquo;OK\u0026rdquo; y contin√∫a.\nTras reiniciar el sistema, podemos comprobar que el m√≥dulo de NVIDIA est√° cargado:\njaviercruces@HPOMEN15:~$ lspci -knn 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) DeviceName: NVIDIA Graphics Device Subsystem: Hewlett-Packard Company Device [103c:88d1] Kernel driver in use: nvidia Kernel modules: nvidia Verificaci√≥n con NVIDIA-SMI Una vez completada la instalaci√≥n, podemos utilizar la herramienta nvidia-smi para verificar el estado de la GPU:\njaviercruces@HPOMEN15:~$ nvidia-smi Sun Aug 24 21:55:26 2025 +-----------------------------------------------------------------------------------------+ | NVIDIA-SMI 550.163.01 Driver Version: 550.163.01 CUDA Version: 12.4 | |-----------------------------------------+------------------------+----------------------| | GPU Name Persistence-M | Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap | Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |=========================================+========================+======================| | 0 NVIDIA GeForce RTX 3060 ... Off | 00000000:01:00.0 Off | N/A | | N/A 42C P5 10W / 25W | 9MiB / 6144MiB | 0% Default | | | | N/A | +-----------------------------------------+------------------------+----------------------| +-----------------------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=========================================================================================| | 0 N/A N/A 1999 G /usr/lib/xorg/Xorg 4MiB | +-----------------------------------------------------------------------------------------+ Si todo funciona correctamente, ya tendr√°s tu GPU NVIDIA funcionando con los drivers oficiales en Debian 13 .\n¬øY si los puertos HDMI o DisplayPort no funcionan? En algunos port√°tiles, a pesar de que la tarjeta gr√°fica NVIDIA se instala y detecta correctamente, los puertos externos no emiten video. Si este es tu caso, la soluci√≥n pasa por utilizar la herramienta NVIDIA Optimus.\nHe preparado un art√≠culo espec√≠fico explicando este proceso. Puedes leerlo aqu√≠:\nüëâ Configurar NVIDIA Optimus en Debian\n¬°Felicidades, Maestro de los Drivers NVIDIA en Debian 13! Has superado otro reto en el vasto reino de la inform√°tica. üöÄ\n","date":"August 24, 2025","hero":"/images/drivers/instalar_drivers_nvidia_trixie.png","permalink":"https://www.javiercd.es/posts/drivers/nvidia_driver/instalacion-controladores-nvidia-debian-13/","summary":"\u003cp\u003eLa instalaci√≥n de los controladores de NVIDIA en el universo de Linux ha sido tradicionalmente un desaf√≠o, especialmente en distribuciones como Debian, donde las pol√≠ticas del software libre a menudo complican el proceso.\u003c/p\u003e\n\u003cp\u003eEn este post voy a explicarte una forma sencilla de instalar los drivers de NVIDIA usando los repositorios oficiales de Debian 13 (Trixie). Adem√°s, al final del art√≠culo, aprender√°s a instalar una herramienta clave llamada Nvidia Optimus, que te brindar√° la capacidad de seleccionar qu√© tarjeta gr√°fica utilizar√° tu equipo.\u003c/p\u003e","tags":["Controladores NVIDIA","Linux"],"title":"Instalaci√≥n de Controladores NVIDIA en Debian 13"},{"categories":null,"contents":" En esta gu√≠a aprender√°s a configurar un servidor DNS esclavo usando BIND9 en Debian. Este servidor se sincronizar√° con el servidor maestro (dns1.javiercruces.org) y permitir√° distribuir la carga de resoluci√≥n de nombres en tu red local. Adem√°s, se te guiar√° para verificar que la transferencia de zonas se realiza correctamente.\nEn este caso, el servidor esclavo se encuentra en la red 192.168.10.0/24, con la IP 192.168.10.200.\n1. Preparaci√≥n inicial del servidor esclavo Nombre de la m√°quina Primero, asignamos el nombre correcto al host. Edita el archivo /etc/hostname:\ndns2 Luego, configura el archivo /etc/hosts para asociar el nombre completo con la IP local:\n127.0.1.1 dns2.javiercruces.org dns2 Verifica que el FQDN se resuelve correctamente con hostname -f. Deber√≠as obtener la siguiente salida:\ndebian@dns2:~$ hostname -f dns2.javiercruces.org 2. Instalaci√≥n de BIND9 Instala el paquete de BIND9 como lo hicimos en el servidor maestro:\nsudo apt update \u0026amp;\u0026amp; sudo apt install bind9 bind9utils bind9-doc rsync -y 3. Configuraci√≥n b√°sica Editar named.conf.options En el servidor esclavo, edita el archivo /etc/bind/named.conf.options para permitir consultas desde las redes internas:\noptions { directory \u0026#34;/var/cache/bind\u0026#34;; allow-query { 127.0.0.1; 192.168.10.0/24; }; recursion yes; dnssec-validation no; forwarders { 1.1.1.1; 8.8.8.8; }; }; 4. Configuraci√≥n de zonas esclavas Edita el archivo /etc/bind/named.conf.local para definir las zonas esclavas. Estas deben coincidir con las configuradas en el servidor maestro:\nzone \u0026#34;javiercruces.org\u0026#34; { type slave; masters { 192.168.10.1; }; file \u0026#34;/var/cache/bind/slaves/db.javiercruces.org\u0026#34;; }; zone \u0026#34;10.168.192.in-addr.arpa\u0026#34; { type slave; masters { 192.168.10.1; }; file \u0026#34;/var/cache/bind/slaves/db.192.168.10\u0026#34;; }; Crea el directorio para almacenar los archivos esclavos si a√∫n no existe:\nsudo mkdir -p /var/cache/bind/slaves sudo chown bind:bind /var/cache/bind/slaves 5. Reiniciar el servicio Una vez que todo est√© configurado, reinicia el servicio de BIND9:\nsudo systemctl restart bind9 Verifica que no haya errores en el registro de eventos:\nsudo journalctl -xeu bind9 Tambi√©n puedes comprobar que las zonas se han transferido correctamente con:\nls -l /var/cache/bind/slaves 6. Actualizaci√≥n del servidor maestro Para que el servidor esclavo reciba las zonas correctamente, es necesario autorizarlo desde el servidor maestro (dns1).\nEdita el archivo /etc/bind/named.conf.local en el servidor maestro y a√±ade la opci√≥n allow-transfer con la IP del esclavo:\nzone \u0026#34;javiercruces.org\u0026#34; { type master; file \u0026#34;/var/cache/bind/db.javiercruces.org\u0026#34;; allow-transfer { 192.168.10.200; }; }; zone \u0026#34;10.168.192.in-addr.arpa\u0026#34; { type master; file \u0026#34;/var/cache/bind/db.192.168.10\u0026#34;; allow-transfer { 192.168.10.200; }; }; Adem√°s, actualizaremos los registros DNS para a√±adir el nuevo servidor. Debes agregar un registro A y un registro NS. Aqu√≠ tienes el archivo completo:\ndebian@dns1:~$ sudo cat /var/cache/bind/db.javiercruces.org $TTL 86400 @ IN SOA dns1.javiercruces.org. root.javiercruces.org. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 86400 ) ; Negative Cache TTL ; @ IN NS dns1.javiercruces.org. @ IN NS dns2.javiercruces.org. @ IN MX 10 correo.javiercruces.org. $ORIGIN javiercruces.org. dns1 IN A 192.168.10.1 dns2 IN A 192.168.10.200 correo IN A 192.168.10.2 thor IN A 192.168.10.3 hela IN A 192.168.10.4 www IN CNAME thor informatica IN CNAME thor ftp IN CNAME hela Tambi√©n debemos actualizar la zona inversa:\n$TTL 86400 @ IN SOA dns1.javiercruces.org. root.javiercruces.org. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 86400 ) ; Negative Cache TTL ; @ IN NS dns1.javiercruces.org. $ORIGIN 10.168.192.in-addr.arpa. 1 IN PTR dns1.javiercruces.org. 2 IN PTR correo.javiercruces.org. 3 IN PTR thor.javiercruces.org. 4 IN PTR hela.javiercruces.org. 200 IN PTR dns2.javiercruces.org. Despu√©s de guardar los cambios, recarga la configuraci√≥n de BIND:\nsudo rndc reload O reinicia el servicio:\nsudo systemctl restart bind9 Con esto, el servidor maestro est√° autorizado para enviar las zonas al esclavo cuando sea necesario.\n7. Comprobaciones Cada vez que reinicies el servicio en dns1, este enviar√° los cambios a dns2. Para comprobar que la transferencia de zonas est√° funcionando correctamente, ejecuta el siguiente comando en dns2 para ver los logs en tiempo real:\ndebian@dns2:~$ sudo journalctl -u named -f Luego, a√±ade un registro en el servidor maestro:\nsentinel IN A 192.168.10.25 Puedes forzar la transferencia de la zona con:\ndebian@dns2:~$ sudo rndc sync Y los logs de la transferencia exitosa ser√°n similares a los siguientes:\ndebian@dns2:~$ sudo journalctl -u named -f May 10 23:11:08 dns2 named[936]: received control channel command \u0026#39;sync\u0026#39; May 10 23:11:08 dns2 named[936]: dumping all zones: success Finalmente, realiza una consulta a ambos servidores para verificar que ambos devuelven el mismo resultado:\ndebian@cliente1:~$ dig @192.168.10.1 sentinel.javiercruces.org ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.33-1~deb12u2-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @192.168.10.1 sentinel.javiercruces.org ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 31484 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 1232 ; COOKIE: 067375f875fc084c01000000681fdf328945678dcc84fea2 (good) ;; QUESTION SECTION: ;sentinel.javiercruces.org.\tIN\tA ;; ANSWER SECTION: sentinel.javiercruces.org. 86400 IN\tA\t192.168.10.25 ;; Query time: 0 msec ;; SERVER: 192.168.10.1#53(192.168.10.1) (UDP) ;; WHEN: Sat May 10 23:20:18 UTC 2025 ;; MSG SIZE rcvd: 98 debian@cliente1:~$ dig @192.168.10.200 sentinel.javiercruces.org ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.33-1~deb12u2-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @192.168.10.200 sentinel.javiercruces.org ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NXDOMAIN, id: 29032 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 1, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 1232 ; COOKIE: 4fd30029eb8c1f3d01000000681fdf34b473e093120ca15c (good) ;; QUESTION SECTION: ;sentinel.javiercruces.org.\tIN\tA ;; AUTHORITY SECTION: javiercruces.org.\t86400\tIN\tSOA\tdns1.javiercruces.org. root.javiercruces.org. 1 604800 8 6400 2419200 86400 ;; Query time: 0 msec ;; SERVER: 192.168.10.200#53(192.168.10.200) (UDP) ;; WHEN: Sat May 10 23:20:20 UTC 2025 ;; MSG SIZE rcvd: 128 ","date":"May 10, 2025","hero":"/images/servicios/dns/dns_esclavo.png","permalink":"https://www.javiercd.es/posts/servicios/dns/bind9/dns_esclavo/dns_esclavo/","summary":"\u003chr\u003e\n\u003cp\u003eEn esta gu√≠a aprender√°s a configurar un servidor DNS esclavo usando BIND9 en Debian. Este servidor se sincronizar√° con el servidor maestro (\u003ccode\u003edns1.javiercruces.org\u003c/code\u003e) y permitir√° distribuir la carga de resoluci√≥n de nombres en tu red local. Adem√°s, se te guiar√° para verificar que la transferencia de zonas se realiza correctamente.\u003c/p\u003e\n\u003cp\u003eEn este caso, el servidor esclavo se encuentra en la red 192.168.10.0/24, con la IP 192.168.10.200.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"1-preparaci√≥n-inicial-del-servidor-esclavo\"\u003e1. Preparaci√≥n inicial del servidor esclavo\u003c/h2\u003e\n\u003ch3 id=\"nombre-de-la-m√°quina\"\u003eNombre de la m√°quina\u003c/h3\u003e\n\u003cp\u003ePrimero, asignamos el nombre correcto al host. Edita el archivo \u003ccode\u003e/etc/hostname\u003c/code\u003e:\u003c/p\u003e","tags":["DNS","BIND9","SMR","ASIR"],"title":"Configuraci√≥n de un servidor DNS esclavo con BIND9"},{"categories":null,"contents":" En esta gu√≠a aprender√°s a instalar y configurar un servidor DNS en Linux utilizando BIND9. Configurar√°s zonas de resoluci√≥n directa e inversa para tu dominio, permitir√°s consultas desde otras m√°quinas en la red y realizar√°s pruebas utilizando herramientas como dig. Adem√°s, ver√°s c√≥mo configurar forwarders para resolver nombres externos eficientemente.\n1. Preparaci√≥n inicial Crear la m√°quina DNS Crea una m√°quina y config√∫rala con el nombre dns1.tunombre.org.\nPara ello edita el fichero /etc/hostname:\njaviercruces@dns1:~$ sudo cat /etc/hostname dns1 Luego a√±ade al fichero /etc/hosts la resoluci√≥n est√°tica de este nombre y el FQDN del servidor DNS.\njaviercruces@dns1:~$ sudo nano /etc/hosts En mi caso llamare a la maquina dns1.javiercruces.org\n127.0.1.1 dns1.javiercruces.org dns1 Verifica el FQDN con:\njaviercruces@dns1:~$ hostname -f Tendr√° que devolverte algo similar a esto :\njaviercruces@dns1:~$ hostname -f dns1.javiercruces.org 2. Instalaci√≥n de BIND9 Instalamos el servidor DNS BIND9:\ndebian@dns1:~$ sudo apt update \u0026amp;\u0026amp; sudo apt install bind9 bind9utils bind9-doc -y 3. Configuraci√≥n b√°sica Evitar uso de IPv6 (opcional) Editamos /etc/default/named para que BIND9 no use IPv6:\nOPTIONS=\u0026#34;-4 -f -u bind\u0026#34; Permitir consultas desde redes espec√≠ficas Editamos /etc/bind/named.conf.options:\noptions { directory \u0026#34;/var/cache/bind\u0026#34;; allow-query { 127.0.0.1; 192.168.10.0/24; 192.168.20.0/24; }; recursion yes; dnssec-validation no; forwarders { 1.1.1.1; 8.8.8.8; }; }; Reiniciamos BIND9:\nsudo systemctl restart bind9 4. Configurar zona de resoluci√≥n directa Editamos /etc/bind/named.conf.local:\nzone \u0026#34;javiercruces.org\u0026#34; { type master; file \u0026#34;/var/cache/bind/db.javiercruces.org\u0026#34;; }; Creamos el archivo de zona:\nsudo cp /etc/bind/db.empty /var/cache/bind/db.javiercruces.org sudo nano /var/cache/bind/db.javiercruces.org Ejemplo de contenido:\n$TTL 86400 @ IN SOA dns1.javiercruces.org. root.javiercruces.org. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 86400 ) ; Negative Cache TTL ; @ IN NS dns1.javiercruces.org. @ IN MX 10 correo.javiercruces.org. $ORIGIN javiercruces.org. dns1 IN A 192.168.10.1 correo IN A 192.168.10.2 thor IN A 192.168.10.3 hela IN A 192.168.10.4 www IN CNAME thor informatica IN CNAME thor ftp IN CNAME hela 5. Configurar zona de resoluci√≥n inversa Editamos /etc/bind/named.conf.local:\nzone \u0026#34;10.168.192.in-addr.arpa\u0026#34; { type master; file \u0026#34;/var/cache/bind/db.192.168.10\u0026#34;; }; Aseguramos que la l√≠nea correspondiente en /etc/bind/zones.rfc1918 est√© comentada:\n//zone \u0026#34;10.168.192.in-addr.arpa\u0026#34; { type master; file \u0026#34;/etc/bind/db.empty\u0026#34;; }; Creamos el archivo de zona:\nsudo cp /etc/bind/db.empty /var/cache/bind/db.192.168.10 sudo nano /var/cache/bind/db.192.168.10 Contenido de ejemplo:\n$TTL 86400 @ IN SOA dns1.javiercruces.org. root.javiercruces.org. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 86400 ) ; Negative Cache TTL ; @ IN NS dns1.javiercruces.org. $ORIGIN 10.168.192.in-addr.arpa. 1 IN PTR dns1.javiercruces.org. 2 IN PTR correo.javiercruces.org. 3 IN PTR thor.javiercruces.org. 4 IN PTR hela.javiercruces.org. 6. Comprobaciones Con la configuracion realizada en los otros apartados tendremos funcionado nuestro servidor DNS.\nConsultas b√°sicas con dig Si no indicamos el servidor DNS al usar la consulta con el par√°metro @ utilizara el configurado en el fichero etc/resolv.conf . Recuerda modificar la configuraci√≥n de tu DHCP para que este le asigne la direcci√≥n de tu servidor DNS local a tus clientes .\n# Consulta del registro A para hela.javiercruces.org dig @192.168.10.1 hela.javiercruces.org # Consulta inversa (PTR) de la IP 192.168.10.4 (correspondiente a hela) dig @192.168.10.1 -x 192.168.10.4 # Consulta de registros MX para javiercruces.org dig @192.168.10.1 javiercruces.org MX # Consulta de registros NS para javiercruces.org dig @192.168.10.1 javiercruces.org NS Observa los tiempos y los registros utilizados para resolver nombres. La segunda consulta deber√≠a ser m√°s r√°pida por el uso de cach√©.\nEn el caso de que quieras limpiar la cache de la resoluci√≥n de tu servidor dns utiliza el siguiente comando :\nsudo rndc flush ","date":"May 4, 2025","hero":"/images/servicios/dns/bind9_install.jpg","permalink":"https://www.javiercd.es/posts/servicios/dns/bind9/instalacion_basica/instalacion_configuracion/","summary":"\u003chr\u003e\n\u003cp\u003eEn esta gu√≠a aprender√°s a instalar y configurar un servidor DNS en Linux utilizando BIND9. Configurar√°s zonas de resoluci√≥n directa e inversa para tu dominio, permitir√°s consultas desde otras m√°quinas en la red y realizar√°s pruebas utilizando herramientas como dig. Adem√°s, ver√°s c√≥mo configurar forwarders para resolver nombres externos eficientemente.\u003c/p\u003e\n\u003chr\u003e\n\u003ch2 id=\"1-preparaci√≥n-inicial\"\u003e1. Preparaci√≥n inicial\u003c/h2\u003e\n\u003ch3 id=\"crear-la-m√°quina-dns\"\u003eCrear la m√°quina DNS\u003c/h3\u003e\n\u003cp\u003eCrea una m√°quina y config√∫rala con el nombre \u003ccode\u003edns1.tunombre.org\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003ePara ello edita el fichero \u003ccode\u003e/etc/hostname\u003c/code\u003e:\u003c/p\u003e","tags":["DNS","BIND9","SMR","ASIR"],"title":"Instalaci√≥n y configuraci√≥n de BIND9 en Linux"},{"categories":null,"contents":"Esta gu√≠a es un tutorial introductorio que muestra c√≥mo instalar, configurar y utilizar una instancia b√°sica de Prometheus mediante Docker Compose. Adem√°s, se configurar√° un equipo con Linux (en este caso Debian 12) para que exponga sus m√©tricas del sistema, las cuales ser√°n recolectadas por Prometheus mediante el uso de Node Exporter.\nRequisitos previos Tener instalado Docker y Docker compose Tener un equipo Linux con el que cuentes con permisos de administrador Creaci√≥n de ficheros Creaci√≥n del docker-compose Todos los ficheros utilizados en este post los podr√°s encontrar en mi github .\nLo primero que haremos sera crear nuestro fichero docker-compose .\nEn este destacaremos 2 apartados :\nEl puerto en el que trabaja Prometheus es el 9090 , en mi caso lo mantendr√© y no lo cambiare . El fichero de configuraci√≥n que le a√±adiremos al contenedor , esto es para que nos sea mas c√≥modo modificar su configuraci√≥n . javiercruces@HPOMEN15:~/learn_observability/exercise1$ cat docker-compose.yaml version: \u0026#39;3.8\u0026#39; services: prometheus: image: prom/prometheus:latest container_name: prometheus ports: - \u0026#34;9090:9090\u0026#34; volumes: - ./prometheus.yml:/etc/prometheus/prometheus.yml Creaci√≥n del archivo prometheus.yml El archivo prometheus.yml es el principal fichero de configuraci√≥n de Prometheus. En √©l definimos tanto los par√°metros globales como los targets desde los que Prometheus recoger√° las m√©tricas. Tambi√©n se pueden configurar etiquetas y personalizar la frecuencia de muestreo.\nEn este ejemplo que podemos encontrar en la pagina de getting started de Prometheus , a√±adiremos nuestra maquina debian 12 , en mi caso como el Prometheus esta corriendo en docker he a√±adido como IP la puerta de enlace de su red ya que corresponde a mi maquina f√≠sica Debian 12 .\nPara m√°s detalles sobre todas las opciones disponibles, consulta la documentaci√≥n oficial de Prometheus.\nglobal: scrape_interval: 15s external_labels: monitor: \u0026#39;javiercd-metrics\u0026#39; # En esta secci√≥n configuraremos todos los targets de los cual vamos a extraer m√©tricas scrape_configs: # Scrape del propio Prometheus - job_name: \u0026#39;prometheus\u0026#39; scrape_interval: 5s static_configs: - targets: [\u0026#39;localhost:9090\u0026#39;] # Monitorizaci√≥n del sistema Debian 12 - job_name: \u0026#39;node-exporter-debian12\u0026#39; scrape_interval: 5s static_configs: - targets: [\u0026#39;172.17.0.1:9100\u0026#39;] Configuraci√≥n del Node Exporter en Debian 12 Para permitir que Prometheus recoja m√©tricas del sistema operativo, instalaremos Node Exporter, un servicio que se encargara de sacar las m√©tricas de nuestro sistema para que prometheus pueda scrapearlas .\nInstalaci√≥n del paquete Ejecuta el siguiente comando para instalar prometheus-node-exporter desde los repositorios de Debian:\njaviercruces@HPOMEN15:~/learn_observability/exercise1$ sudo apt install prometheus-node-exporter Verificaci√≥n del servicio Una vez instalado el demonio estar√° corriendo autom√°ticamente en nuestro sistema , pero puedes lanzar el siguiente comando para asegurarte de ello :\njaviercruces@HPOMEN15:~/learn_observability/exercise1$ sudo systemctl is-enabled prometheus-node-exporter enabled Tambi√©n puedes comprobarlo y obtener mas informaci√≥n con el siguiente comando :\nSalida esperada (resumida):\njaviercruces@HPOMEN15:~/learn_observability/exercise1$ sudo systemctl status prometheus-node-exporter ‚óè prometheus-node-exporter.service - Prometheus exporter for machine metrics Loaded: loaded (/lib/systemd/system/prometheus-node-exporter.service; enabled; preset: enabled) Active: active (running) since Sat 2025-05-17 01:59:00 CEST; 1min 10s ago Docs: https://github.com/prometheus/node_exporter Main PID: 8488 (prometheus-node) Tasks: 6 (limit: 18302) Memory: 3.7M CPU: 6ms CGroup: /system.slice/prometheus-node-exporter.service ‚îî‚îÄ8488 /usr/bin/prometheus-node-exporter may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=thermal_zone may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=time may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=timex may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=udp_queues may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=uname may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=vmstat may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=xfs may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=node_exporter.go:117 level=info collector=zfs may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=tls_config.go:232 level=info msg=\u0026#34;Listening on\u0026#34; address=[::]:9100 may 17 01:59:00 HPOMEN15 prometheus-node-exporter[8488]: ts=2025-05-16T23:59:00.893Z caller=tls_config.go:235 level=info msg=\u0026#34;TLS is disabled.\u0026#34; http2=false address=[::]:9100 Si te fijas , en las dos ultimas lineas nos dice que esta escuchando en el puerto 9100. Como informaci√≥n adicional del servicio , la ruta de la unidad de systemd esta en /lib/systemd/system/prometheus-node-exporter.service y la configuraci√≥n de node-exporter en /etc/default/prometheus-node-exporter.\nLevantamos el escenario Una vez preparado el fichero de configuraci√≥n de nuestro prometheus y nuestro node exporter esta funcionando . Vamos a levantar nuestro prometheus :\njaviercruces@HPOMEN15:~/learn_observability/exercise1$ docker compose up -d Una vez levantado accederemos con un navegador al puerto que hemos expusto nuestro prometheus , en mi caso al 9090 :\nVamos a comprobar que prometheus recibe las metricas de nuestro Debian 12 para ello accedemos a http://localhost:9090/targets , en mi caso ambos estan levantados y estamos recibiendo sus metricas :\nPor ultimo vamos a consultar un par de metricas :\nBibliografia Getting started Prometheus Prometheus configuration DockerHub Prometheus Node-exporter ","date":"April 17, 2025","hero":"/images/observabilidad/metricas/prometheus/prometheus_docker_compose.png","permalink":"https://www.javiercd.es/posts/observabilidad/metricas/prometheus/instalacion_basica_docker_compose/prometheus_docker_compose_debian12/","summary":"\u003cp\u003eEsta gu√≠a es un tutorial introductorio que muestra c√≥mo instalar, configurar y utilizar una instancia b√°sica de Prometheus mediante Docker Compose. Adem√°s, se configurar√° un equipo con Linux (en este caso Debian 12) para que exponga sus m√©tricas del sistema, las cuales ser√°n recolectadas por Prometheus mediante el uso de Node Exporter.\u003c/p\u003e\n\u003ch2 id=\"requisitos-previos\"\u003eRequisitos previos\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eTener instalado Docker y Docker compose\u003c/li\u003e\n\u003cli\u003eTener un equipo Linux con el que cuentes con permisos de administrador\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"creaci√≥n-de-ficheros\"\u003eCreaci√≥n de ficheros\u003c/h2\u003e\n\u003ch3 id=\"creaci√≥n-del-docker-compose\"\u003eCreaci√≥n del docker-compose\u003c/h3\u003e\n\u003cp\u003eTodos los ficheros utilizados en este post los podr√°s encontrar en mi \u003ca href=\"https://github.com/javierasping/learn_observability\" target=\"_blank\" rel=\"noopener\"\u003egithub\u003c/a\u003e .\u003c/p\u003e","tags":["M√©tricas","Prometheus","Observabilidad"],"title":"Instalaci√≥n de Prometheus con docker-compose y Node Exporter en Debian 12"},{"categories":null,"contents":"Gu√≠a completa para instalar y gestionar Docker Compose en sistemas Linux.\nInstalaci√≥n desde repositorio Para sistemas basados en Debian/Ubuntu sudo apt-get update sudo apt-get install docker-compose-plugin Para sistemas basados en RHEL/CentOS sudo yum check-update sudo yum install docker-compose-plugin Para sistemas basados en Fedora sudo dnf update sudo dnf install docker-compose-plugin Actualizaci√≥n del complemento Actualizar en Ubuntu/Debian sudo apt-get update \u0026amp;\u0026amp; sudo apt-get upgrade docker-compose-plugin Actualizar en RHEL/CentOS sudo yum update docker-compose-plugin Instalaci√≥n manual Descarga directa del binario DOCKER_CONFIG=${DOCKER_CONFIG:-$HOME/.docker} mkdir -p $DOCKER_CONFIG/cli-plugins curl -SL https://github.com/docker/compose/releases/download/v2.25.0/docker-compose-linux-$(uname -m) -o $DOCKER_CONFIG/cli-plugins/docker-compose chmod +x $DOCKER_CONFIG/cli-plugins/docker-compose Instalaci√≥n global (todos los usuarios) sudo curl -SL https://github.com/docker/compose/releases/download/v2.25.0/docker-compose-linux-$(uname -m) -o /usr/local/lib/docker/cli-plugins/docker-compose sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose ","date":"March 9, 2025","hero":"/images/docker/instalar_docker_compose.png","permalink":"https://www.javiercd.es/posts/docker/instalar_docker_compose/instalar_docker_compose/","summary":"\u003cp\u003eGu√≠a completa para instalar y gestionar Docker Compose en sistemas Linux.\u003c/p\u003e\n\u003ch2 id=\"instalaci√≥n-desde-repositorio\"\u003eInstalaci√≥n desde repositorio\u003c/h2\u003e\n\u003ch3 id=\"para-sistemas-basados-en-debianubuntu\"\u003ePara sistemas basados en Debian/Ubuntu\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get install docker-compose-plugin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"para-sistemas-basados-en-rhelcentos\"\u003ePara sistemas basados en RHEL/CentOS\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo yum check-update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo yum install docker-compose-plugin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"para-sistemas-basados-en-fedora\"\u003ePara sistemas basados en Fedora\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo dnf update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo dnf install docker-compose-plugin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003ch2 id=\"actualizaci√≥n-del-complemento\"\u003eActualizaci√≥n del complemento\u003c/h2\u003e\n\u003ch3 id=\"actualizar-en-ubuntudebian\"\u003eActualizar en Ubuntu/Debian\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt-get update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt-get upgrade docker-compose-plugin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"actualizar-en-rhelcentos\"\u003eActualizar en RHEL/CentOS\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo yum update docker-compose-plugin\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e\n\u003ch2 id=\"instalaci√≥n-manual\"\u003eInstalaci√≥n manual\u003c/h2\u003e\n\u003ch3 id=\"descarga-directa-del-binario\"\u003eDescarga directa del binario\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDOCKER_CONFIG\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eDOCKER_CONFIG\u003cspan style=\"color:#66d9ef\"\u003e:-\u003c/span\u003e$HOME/.docker\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emkdir -p $DOCKER_CONFIG/cli-plugins\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ecurl -SL https://github.com/docker/compose/releases/download/v2.25.0/docker-compose-linux-\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003euname -m\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e -o $DOCKER_CONFIG/cli-plugins/docker-compose\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003echmod +x $DOCKER_CONFIG/cli-plugins/docker-compose\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"instalaci√≥n-global-todos-los-usuarios\"\u003eInstalaci√≥n global (todos los usuarios)\u003c/h3\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo curl -SL https://github.com/docker/compose/releases/download/v2.25.0/docker-compose-linux-\u003cspan style=\"color:#66d9ef\"\u003e$(\u003c/span\u003euname -m\u003cspan style=\"color:#66d9ef\"\u003e)\u003c/span\u003e -o /usr/local/lib/docker/cli-plugins/docker-compose\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003chr\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Instalaci√≥n de Docker Compose en Ubuntu 24"},{"categories":null,"contents":"Para comenzar con Docker Engine en Ubuntu, aseg√∫rate de cumplir con los requisitos previos y sigue los pasos de instalaci√≥n.\nRequisitos Previos Requisitos del Sistema Operativo Para instalar Docker Engine, necesitas la versi√≥n de 64 bits de una de estas versiones de Ubuntu:\nUbuntu Oracular 24.10 Ubuntu Noble 24.04 (LTS) Ubuntu Jammy 22.04 (LTS) Ubuntu Focal 20.04 (LTS) Docker Engine para Ubuntu es compatible con arquitecturas x86_64 (o amd64), armhf, arm64, s390x y ppc64le (ppc64el).\nNota: La instalaci√≥n en distribuciones derivadas de Ubuntu, como Linux Mint, no est√° oficialmente soportada (aunque puede funcionar).\nDesinstalar versiones antiguas Antes de instalar Docker Engine, debes desinstalar cualquier paquete conflictivo.\nTu distribuci√≥n de Linux puede proporcionar paquetes no oficiales de Docker, que pueden entrar en conflicto con los paquetes oficiales proporcionados por Docker. Debes desinstalar estos paquetes antes de instalar la versi√≥n oficial de Docker Engine.\nLos paquetes no oficiales a desinstalar son:\ndocker.io docker-compose docker-compose-v2 docker-doc podman-docker Adem√°s, Docker Engine depende de containerd y runc. Docker Engine agrupa estas dependencias en un solo paquete: containerd.io. Si has instalado containerd o runc anteriormente, desinst√°lalos para evitar conflictos con las versiones incluidas en Docker Engine.\nEjecuta el siguiente comando para desinstalar todos los paquetes conflictivos:\nfor pkg in docker.io docker-doc docker-compose docker-compose-v2 podman-docker containerd runc; do sudo apt-get remove $pkg; done apt-get podr√≠a informar que no tienes ninguno de estos paquetes instalados.\nLas im√°genes, contenedores, vol√∫menes y redes almacenados en /var/lib/docker/ no se eliminan autom√°ticamente cuando desinstalas Docker. Si deseas empezar con una instalaci√≥n limpia y limpiar los datos existentes, consulta la secci√≥n de desinstalaci√≥n de Docker Engine.\nM√©todos de Instalaci√≥n Puedes instalar Docker Engine de diferentes maneras, dependiendo de tus necesidades:\nDocker Engine viene incluido con Docker Desktop para Linux. Esta es la forma m√°s f√°cil y r√°pida de comenzar. Configura e instala Docker Engine desde el repositorio de apt de Docker. Inst√°lalo manualmente y gestiona las actualizaciones manualmente. Usa un script de conveniencia. Solo recomendado para entornos de prueba y desarrollo. Instalar usando el repositorio de apt Antes de instalar Docker Engine por primera vez en una nueva m√°quina host, necesitas configurar el repositorio de Docker apt. Despu√©s, podr√°s instalar y actualizar Docker desde el repositorio.\nConfigura el repositorio de apt de Docker:\nAgrega la clave GPG oficial de Docker:\nsudo apt-get update sudo apt-get install ca-certificates curl sudo install -m 0755 -d /etc/apt/keyrings sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc sudo chmod a+r /etc/apt/keyrings/docker.asc Agrega el repositorio a las fuentes de Apt:\necho \u0026#34;deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu $(. /etc/os-release \u0026amp;\u0026amp; echo \u0026#34;${UBUNTU_CODENAME:-$VERSION_CODENAME}\u0026#34;) stable\u0026#34; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null sudo apt-get update Instala los paquetes de Docker:\nsudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin Verifica que la instalaci√≥n fue exitosa ejecutando la imagen hello-world:\nsudo docker run hello-world Este comando descarga una imagen de prueba y la ejecuta en un contenedor. Cuando el contenedor se ejecute, imprimir√° un mensaje de confirmaci√≥n y terminar√°.\nAhora has instalado y arrancado Docker Engine correctamente.\nConsejo:\nSi tienes errores al intentar ejecutar sin root, aseg√∫rate de permitir que usuarios no privilegiados ejecuten comandos de Docker. Consulta los pasos posteriores para la instalaci√≥n en Linux para permitirlo.\nActualizar Docker Engine Para actualizar Docker Engine, sigue el paso 2 de las instrucciones de instalaci√≥n, eligiendo la nueva versi√≥n que deseas instalar.\nInstalar desde un paquete Si no puedes usar el repositorio apt de Docker para instalar Docker Engine, puedes descargar el archivo .deb para tu versi√≥n y instalarlo manualmente. Deber√°s descargar un nuevo archivo cada vez que desees actualizar Docker Engine.\nDir√≠gete a https://download.docker.com/linux/ubuntu/dists/.\nSelecciona tu versi√≥n de Ubuntu en la lista, luego ve a pool/stable/ y selecciona la arquitectura aplicable (amd64, armhf, arm64 o s390x).\nDescarga los siguientes archivos .deb:\ncontainerd.io_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb docker-ce_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb docker-ce-cli_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb docker-buildx-plugin_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb docker-compose-plugin_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb Instala los paquetes .deb:\nsudo dpkg -i ./containerd.io_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb ./docker-ce_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb ./docker-ce-cli_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb ./docker-buildx-plugin_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb ./docker-compose-plugin_\u0026lt;versi√≥n\u0026gt;_\u0026lt;arch\u0026gt;.deb El demonio de Docker se iniciar√° autom√°ticamente.\nVerifica que la instalaci√≥n fue exitosa ejecutando la imagen hello-world:\nsudo service docker start sudo docker run hello-world Ahora has instalado y arrancado Docker Engine correctamente.\nInstalar utilizando el script de conveniencia Docker proporciona un script de conveniencia en https://get.docker.com/ para instalar Docker en entornos de desarrollo de manera no interactiva. No se recomienda este script para entornos de producci√≥n, pero es √∫til para crear un script de provisi√≥n adaptado a tus necesidades.\ncurl -fsSL https://get.docker.com -o get-docker.sh sudo sh ./get-docker.sh Desinstalar Docker Engine Para desinstalar Docker Engine, ejecuta el siguiente comando:\nsudo apt-get purge docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras Las im√°genes, contenedores, vol√∫menes o archivos de configuraci√≥n personalizados no se eliminan autom√°ticamente. Para eliminar todos los elementos de Docker, ejecuta:\nsudo rm -rf /var/lib/docker sudo rm -rf /var/lib/containerd Elimina la lista de fuentes y las claves:\nsudo rm /etc/apt/sources.list.d/docker.list sudo rm /etc/apt/keyrings/docker.asc Deber√°s eliminar cualquier archivo de configuraci√≥n editado manualmente.\nPr√≥ximos pasos Administrar Docker como un usuario no root El demonio de Docker se vincula a un socket Unix, no a un puerto TCP. Por defecto, el usuario root es el que posee el socket Unix, y otros usuarios solo pueden acceder a √©l utilizando sudo. El demonio de Docker siempre se ejecuta como usuario root.\nSi no deseas anteponer el comando docker con sudo, puedes crear un grupo Unix llamado docker y agregar usuarios a √©l. Cuando el demonio de Docker se inicia, crea un socket Unix accesible para los miembros del grupo docker. En algunas distribuciones de Linux, el sistema crea autom√°ticamente este grupo al instalar Docker Engine utilizando un gestor de paquetes. En ese caso, no es necesario que crees el grupo manualmente.\nAdvertencia\nEl grupo docker otorga privilegios a nivel root al usuario. Para obtener m√°s detalles sobre c√≥mo esto afecta la seguridad en tu sistema, consulta Docker Daemon Attack Surface.\nNota\nPara ejecutar Docker sin privilegios de root, consulta Ejecutar el demonio de Docker como un usuario no root (modo Rootless).\nCrear el grupo docker y agregar tu usuario 1. Crear el grupo docker: sudo groupadd docker 2. Agregar tu usuario al grupo docker: sudo usermod -aG docker $USER 3. Cerrar sesi√≥n y volver a iniciar sesi√≥n para que se reeval√∫e tu membres√≠a en el grupo. Si est√°s ejecutando Linux en una m√°quina virtual, puede ser necesario reiniciar la m√°quina virtual para que los cambios tengan efecto.\nTambi√©n puedes ejecutar el siguiente comando para activar los cambios en los grupos:\nnewgrp docker 4. Verificar que puedes ejecutar los comandos de Docker sin sudo: docker run hello-world Este comando descarga una imagen de prueba y la ejecuta en un contenedor. Cuando el contenedor se ejecuta, imprime un mensaje de confirmaci√≥n y termina.\nSi inicialmente ejecutaste los comandos de Docker CLI utilizando sudo antes de agregar a tu usuario al grupo docker, podr√≠as ver el siguiente error:\nWARNING: Error loading config file: /home/user/.docker/config.json - stat /home/user/.docker/config.json: permission denied Este error indica que la configuraci√≥n de permisos para el directorio ~/.docker/ es incorrecta, debido a que usaste el comando sudo anteriormente.\nSoluci√≥n Para solucionar este problema, elimina el directorio ~/.docker/ (se recrear√° autom√°ticamente, pero se perder√°n las configuraciones personalizadas), o cambia la propiedad y los permisos utilizando los siguientes comandos:\nsudo chown \u0026#34;$USER\u0026#34;:\u0026#34;$USER\u0026#34; /home/\u0026#34;$USER\u0026#34;/.docker -R sudo chmod g+rwx \u0026#34;$HOME/.docker\u0026#34; -R Configurar Docker para que se inicie autom√°ticamente con systemd Muchas distribuciones modernas de Linux utilizan systemd para gestionar qu√© servicios se inician cuando el sistema arranca. En Debian y Ubuntu, el servicio de Docker se inicia autom√°ticamente al arranque. Para iniciar autom√°ticamente Docker y containerd al arrancar en otras distribuciones de Linux que usan systemd, ejecuta los siguientes comandos:\nsudo systemctl enable docker.service sudo systemctl enable containerd.service Para detener este comportamiento, utiliza disable en lugar de enable:\nsudo systemctl disable docker.service sudo systemctl disable containerd.service Puedes utilizar archivos de unidad de systemd para configurar el servicio de Docker al inicio, por ejemplo, para agregar un proxy HTTP, establecer un directorio o partici√≥n diferente para los archivos de ejecuci√≥n de Docker, o realizar otras personalizaciones. Para obtener un ejemplo, consulta Configurar el demonio para usar un proxy.\nConfigurar el controlador de registro predeterminado Docker proporciona controladores de registro para recopilar y ver datos de registro de todos los contenedores que se ejecutan en un host. El controlador de registro predeterminado, json-file, escribe los datos de registro en archivos con formato JSON en el sistema de archivos del host. Con el tiempo, estos archivos de registro aumentan de tama√±o, lo que podr√≠a llevar al agotamiento de los recursos del disco.\nPara evitar problemas con el uso excesivo del disco debido a los datos de registro, considera una de las siguientes opciones:\nConfigura el controlador de registro json-file para activar la rotaci√≥n de registros. Utiliza un controlador de registro alternativo como el controlador de registro \u0026ldquo;local\u0026rdquo;, que realiza rotaci√≥n de registros de manera predeterminada. Utiliza un controlador de registro que env√≠e los registros a un agregador de registros remoto. ","date":"March 9, 2025","hero":"/images/docker/instalar_docker.png","permalink":"https://www.javiercd.es/posts/docker/instalar_docker_ubuntu24/instalacion_docker_ubuntu24/","summary":"\u003cp\u003ePara comenzar con Docker Engine en Ubuntu, aseg√∫rate de cumplir con los requisitos previos y sigue los pasos de instalaci√≥n.\u003c/p\u003e\n\u003ch2 id=\"requisitos-previos\"\u003eRequisitos Previos\u003c/h2\u003e\n\u003ch3 id=\"requisitos-del-sistema-operativo\"\u003eRequisitos del Sistema Operativo\u003c/h3\u003e\n\u003cp\u003ePara instalar Docker Engine, necesitas la versi√≥n de 64 bits de una de estas versiones de Ubuntu:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUbuntu Oracular 24.10\u003c/li\u003e\n\u003cli\u003eUbuntu Noble 24.04 (LTS)\u003c/li\u003e\n\u003cli\u003eUbuntu Jammy 22.04 (LTS)\u003c/li\u003e\n\u003cli\u003eUbuntu Focal 20.04 (LTS)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eDocker Engine para Ubuntu es compatible con arquitecturas x86_64 (o amd64), armhf, arm64, s390x y ppc64le (ppc64el).\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Instalaci√≥n de Docker en Ubuntu 24"},{"categories":null,"contents":"En este art√≠culo, te presento una actualizaci√≥n del proceso de instalaci√≥n de GNS3 en Debian 12, basado en el post anterior para Debian 11. Si necesitas detalles m√°s profundos sobre la instalaci√≥n o la configuraci√≥n de GNS3, te recomiendo revisar la versi√≥n anterior.\nInstalaci√≥n GNS3 Actualizamos los repositorios e instalamos las actualizaciones disponibles del sistema.\njaviercruces@HPOMEN15:~$ sudo apt update -y \u0026amp;\u0026amp; sudo apt upgrade -y Instalamos las dependencias necesarias para GNS3, incluyendo Python, herramientas de virtualizaci√≥n (KVM,QEMU,libvirt), bibliotecas adicionales (PyQt5,dynamips) y otras utilidades.\njaviercruces@HPOMEN15:~$ sudo apt install python3 python3-pip pipx python3-pyqt5 python3-pyqt5.qtwebsockets python3-pyqt5.qtsvg qemu-kvm qemu-utils libvirt-clients libvirt-daemon-system virtinst dynamips software-properties-common ca-certificates curl gnupg2 bridge-utils virt-manager libvirt-daemon -y Habilitamos y arrancamos el servicio de virtualizaci√≥n libvirtd y nos a√±adimos al grupo \u0026ldquo;libvirt\u0026rdquo; para otorgarle permisos sobre las m√°quinas virtuales y redes de KVM .\njaviercruces@HPOMEN15:~$ sudo systemctl enable --now libvirtd \u0026amp;\u0026amp; sudo usermod -aG libvirt $(whoami) Instalamos las aplicaciones principales de GNS3: el servidor (gns3-server) y la interfaz gr√°fica (gns3-gui) utilizando pipx para un entorno Python aislado de forma comoda , sin necesidad de crear un entorno virtual a mano.\njaviercruces@HPOMEN15:~$ pipx install gns3-server \u0026amp;\u0026amp; pipx install gns3-gui Aseguramos que el directorio de binarios de pipx est√© en la variable de entorno PATH para que los comandos de GNS3 sean accesibles globalmente desde cualquier terminal.\njaviercruces@HPOMEN15:~$ pipx ensurepath Inyectamos el paquete PyQt5 en el entorno de gns3-gui, asegur√°ndonos de que tenga todas las dependencias necesarias.\njaviercruces@HPOMEN15:~$ pipx inject gns3-gui gns3-server PyQt5 Iniciamos la red por defecto de KVM y la configuraremos para que al reiniciar se incie de forma automatica .\njaviercruces@HPOMEN15:~$ virsh --connect=qemu:///system net-start default La red default se ha iniciado javiercruces@HPOMEN15:~$ virsh --connect=qemu:///system net-autostart default La red default ha sido marcada para iniciarse autom√°ticamente Reiniciamos el sistema para aplicar los cambios, como la configuraci√≥n de grupos y PATH.\njaviercruces@HPOMEN15:~$ sudo reboot Ahora podremos iniciar gns3 , pero te recomiendo que configures los siguientes apartados que tienes en el post .\njaviercruces@HPOMEN15:~$ gns3 Instalaci√≥n ubridge Clonamos el repositorio de ubridge desde GitHub. Ubridge es una herramienta necesaria para GNS3, que permite gestionar el tr√°fico entre las interfaces de red virtualizadas.\njaviercruces@HPOMEN15:~$ git clone https://github.com/GNS3/ubridge.git Nos movemos al directorio del proyecto reci√©n clonado.\njaviercruces@HPOMEN15:~$ cd ubridge/ Compilamos el c√≥digo fuente de ubridge utilizando \u0026ldquo;make\u0026rdquo; .\njaviercruces@HPOMEN15:~/ubridge$ make Instalamos el binario de ubridge en el sistema para que est√© disponible globalmente.\njaviercruces@HPOMEN15:~/ubridge$ sudo make install Asignamos permisos de ejecuci√≥n al archivo binario de ubridge\njaviercruces@HPOMEN15:~/ubridge$ chmod +x ubridge Copiamos el archivo binario a \u0026ldquo;/usr/local/bin\u0026rdquo;, una ruta est√°ndar para comandos disponibles globalmente en el sistema.\njaviercruces@HPOMEN15:~/ubridge$ cp -p ubridge /usr/local/bin Configuramos permisos especiales para ubridge, permiti√©ndole acceso a operaciones de red (cap_net_admin) y env√≠o de paquetes en bruto (cap_net_raw), necesarias para su funcionamiento.\njaviercruces@HPOMEN15:~/ubridge$ sudo setcap cap_net_admin,cap_net_raw=ep /usr/local/bin/ubridge Instalaci√≥n vpcs Clonamos el repositorio de VPCS desde GitHub. VPCS (Virtual PC Simulator) es una herramienta ligera que simula PCs b√°sicos para pruebas de red en GNS3.\njaviercruces@HPOMEN15:~$ git clone https://github.com/GNS3/vpcs.git Accedemos al directorio donde hemos clonado el repositorio y ejecutamos el script que nos compilara el codigo fuente del programa.\njaviercruces@HPOMEN15:~$ cd vpcs/src javiercruces@HPOMEN15:~/vpcs/src$ sudo ./mk.sh Dentro de la carpeta src tendremos el ejecutable de las maquinas vpcs , guarda esta ruta ya que tendras que configurarla en gns3 .\njaviercruces@HPOMEN15:~/vpcs/src$ ls | grep c vpcs javiercruces@HPOMEN15:~/vpcs/src$ pwd /home/javiercruces/vpcs/src En preferencias tienes que a√±adir la ruta donde has guardado el fichero compilado vpcs , en mi caso la ruta seria /home/javiercruces/vpcs/src/vpcs\n","date":"September 8, 2024","hero":"/images/redes/instalacion_wireshark_gns3/gns3_deb12.png","permalink":"https://www.javiercd.es/posts/redes/instalar_gns3_debian12/instalar_gns3_debian12/","summary":"\u003cp\u003eEn este art√≠culo, te presento una actualizaci√≥n del proceso de instalaci√≥n de GNS3 en Debian 12, basado en el post anterior para Debian 11. Si necesitas detalles m√°s profundos sobre la instalaci√≥n o la configuraci√≥n de GNS3, te recomiendo revisar la versi√≥n anterior.\u003c/p\u003e\n\u003ch2 id=\"instalaci√≥n-gns3\"\u003eInstalaci√≥n GNS3\u003c/h2\u003e\n\u003cp\u003eActualizamos los repositorios e instalamos las actualizaciones disponibles del sistema.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@HPOMEN15:~$ sudo apt update -y \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt upgrade -y \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eInstalamos las dependencias necesarias para GNS3, incluyendo Python, herramientas de virtualizaci√≥n (KVM,QEMU,libvirt), bibliotecas adicionales (PyQt5,dynamips) y otras utilidades.\u003c/p\u003e","tags":["Redes","Wireshark","GNS3"],"title":"Instalaci√≥n GNS3 en Debian 12 "},{"categories":null,"contents":"Si tienes un port√°til con Linux y una gr√°fica Nvidia, es posible que, despu√©s de instalar los drivers de la gr√°fica, hayas notado que los puertos de video no funcionan correctamente. Si te suena familiar, no te preocupes, te tengo cubierto.\nHe estado investigando y encontr√© una herramienta que te puede ahorrar varios dolores de cabeza. Se llama EnvyControl, y es una utilidad de l√≠nea de comandos (CLI) que te permite elegir f√°cilmente qu√© tarjeta gr√°fica quieres usar en tu equipo. Esto es especialmente √∫til si tu port√°til tiene una configuraci√≥n de gr√°ficos h√≠bridos, como Intel + Nvidia o AMD + Nvidia.\nEn mi caso, configur√© la herramienta para que siempre use la gr√°fica dedicada, y ¬°voil√†! Los puertos de video empezaron a funcionar sin problemas.\nEnvyControl es gratuito, de c√≥digo abierto, y se distribuye bajo la licencia MIT. Eso s√≠, ten en cuenta que el software se proporciona tal cual, sin garant√≠as. Adem√°s, cualquier configuraci√≥n personalizada de X.org podr√≠a ser sobrescrita al cambiar de modos.\nSi quieres probarlo, te dejo el enlace al repositorio: EnvyControl en GitHub. Ah√≠ encontrar√°s tutoriales espec√≠ficos para instalarlo en diferentes distribuciones.\nA continuaci√≥n, te guiar√© por los pasos para instalarlo en Debian. ¬°Vamos a ello!\nInstalaci√≥n de EnvyControl Dado que ya no es posible instalar paquetes pip fuera de un entorno virtual tras la adopci√≥n de PEP668, en su lugar, utiliza el paquete .deb proporcionado por el repositorio .\nEncuentra la versi√≥n m√°s reciente en el siguiente enlace: Releases - EnvyControl.\nEn esa p√°gina, selecciona y descarga el paquete .deb correspondiente. Tambi√©n puedes utilizar la herramienta wget para descargarlo desde la terminal.\nInstala el paquete descargado con el siguiente comando:\nsudo apt -y install ./python3-envycontrol_version.deb Una vez que hayas instalado la herramienta, tendr√°s la capacidad de seleccionar la tarjeta gr√°fica que deseas utilizar en tu equipo. Es importante recordar que cualquier configuraci√≥n aplicada no surtir√° efecto hasta que reinicies el sistema.\nSupongamos que decides utilizar la gr√°fica integrada para ahorrar energ√≠a, por ejemplo. El comando correspondiente ser√≠a :\nsudo envycontrol -s integrated Si por el contrario quieres utilizar el modo hibrido (ambas)\nsudo envycontrol -s hybrid --rtd3 Si prefieres utilizar solo tu gr√°fica dedicada, ten en cuenta que esta es la √∫nica configuraci√≥n que me ha funcionado para activar los puertos de video. Para dar el salto a este modo te pedir√° primero que pongas el modo anterior , el h√≠brido . Una vez est√©s en ese modo el comando para activar solo tu gr√°fica dedicada:\nsudo envycontrol -s nvidia --force-comp --coolbits 24 Vuelvo a insistirse pero RECUERDA REINICIAR PARA QUE SE APLIQUEN LOS CAMBIOS .\nEn este punto, te he proporcionado los comandos que he utilizado, pero el programa cuenta con su propio manual. Adem√°s, en el repositorio del autor, puedes encontrar informaci√≥n √∫til adicional.\nAdemas en est√© explica que hay una extension de gnome para que puedas realizar estos cambios desde la interfaz gr√°fica . Aunque personalmente siempre tengo un enchufe donde trabajo con el port√°til , es posible que para ahorrar bater√≠a quieras cambiar al modo h√≠brido o al de la gr√°fica integrada .\nHasta aqu√≠, conf√≠o en que los controladores de NVIDIA est√©n funcionando correctamente y que ya puedas usar los puertos de video de tu equipo sin problemas.\nComo mencion√© antes, la compatibilidad puede variar seg√∫n tu hardware. En mi caso, los puertos de video solo funcionan cuando uso el modo de la gr√°fica dedicada. As√≠ que si te encuentras en una situaci√≥n similar, no dudes en probar esta configuraci√≥n.\n","date":"September 1, 2024","hero":"/images/drivers/elegir_grafica.png","permalink":"https://www.javiercd.es/posts/drivers/nvidia_optimus/nvidia_optimus/","summary":"\u003cp\u003eSi tienes un port√°til con Linux y una gr√°fica Nvidia, es posible que, despu√©s de instalar los drivers de la gr√°fica, hayas notado que los puertos de video no funcionan correctamente. Si te suena familiar, no te preocupes, te tengo cubierto.\u003c/p\u003e\n\u003cp\u003eHe estado investigando y encontr√© una herramienta que te puede ahorrar varios dolores de cabeza. Se llama EnvyControl, y es una utilidad de l√≠nea de comandos (CLI) que te permite elegir f√°cilmente qu√© tarjeta gr√°fica quieres usar en tu equipo. Esto es especialmente √∫til si tu port√°til tiene una configuraci√≥n de gr√°ficos h√≠bridos, como Intel + Nvidia o AMD + Nvidia.\u003c/p\u003e","tags":["Controladores NVIDIA","Linux"],"title":"Como elegir que gr√°fica usar en mi port√°til con Linux"},{"categories":null,"contents":"Para permitir el acceso remoto a tu servidor MariaDB, sigue estos pasos:\nConfigura el archivo de configuraci√≥n de MariaDB\nPrimero, edita el archivo de configuraci√≥n de MariaDB para permitir conexiones desde direcciones IP espec√≠ficas. Abre el archivo /etc/mysql/mariadb.conf.d/50-server.cnf con un editor de texto, por ejemplo, nano:\nsudo nano /etc/mysql/mariadb.conf.d/50-server.cnf Busca la l√≠nea que comienza con bind-address y c√°mbiala para que acepte conexiones desde cualquier direcci√≥n IP. Puedes hacer que acepte conexiones desde todas las IPs con:\nbind-address = 0.0.0.0 Si prefieres permitir conexiones solo desde direcciones IP espec√≠ficas, reemplaza 0.0.0.0 con las direcciones IP deseadas, separadas por comas. Guarda el archivo y cierra el editor (Ctrl+X, luego Y para confirmar los cambios y Enter para salir en nano).\nReinicia el servicio de MariaDB\nPara que los cambios surtan efecto, reinicia el servicio de MariaDB:\nsudo systemctl restart mariadb Instala el cliente de MariaDB en la m√°quina desde la que quieres conectarte\nEn la m√°quina cliente (desde la que deseas acceder al servidor MariaDB), instala el cliente de MariaDB. En Debian o Ubuntu, puedes hacerlo con:\nsudo apt update sudo apt install mariadb-client Con√©ctate al servidor MariaDB desde la m√°quina cliente\nFinalmente, usa el cliente de MariaDB para conectarte al servidor. Reemplaza usuario, servidor_ip y base_de_datos con el nombre de usuario, la direcci√≥n IP del servidor y la base de datos a la que deseas acceder, respectivamente:\nmysql -u usuario -p -h servidor_ip Cuando se te solicite, ingresa la contrase√±a del usuario que has configurado en el servidor MariaDB.\nCon estos pasos, habr√°s configurado el acceso remoto a tu servidor MariaDB y podr√°s conectarte desde cualquier m√°quina que tenga el cliente de MariaDB instalado.\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_mariadb/acceso_remoto_mariadb.png","permalink":"https://www.javiercd.es/posts/base_de_datos/acceso_remoto_mariadb/acceso_remoto_mariadb/","summary":"\u003cp\u003ePara permitir el acceso remoto a tu servidor MariaDB, sigue estos pasos:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eConfigura el archivo de configuraci√≥n de MariaDB\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003ePrimero, edita el archivo de configuraci√≥n de MariaDB para permitir conexiones desde direcciones IP espec√≠ficas. Abre el archivo \u003ccode\u003e/etc/mysql/mariadb.conf.d/50-server.cnf\u003c/code\u003e con un editor de texto, por ejemplo, \u003ccode\u003enano\u003c/code\u003e:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo nano /etc/mysql/mariadb.conf.d/50-server.cnf\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eBusca la l√≠nea que comienza con \u003ccode\u003ebind-address\u003c/code\u003e y c√°mbiala para que acepte conexiones desde cualquier direcci√≥n IP. Puedes hacer que acepte conexiones desde todas las IPs con:\u003c/p\u003e","tags":["MariaDB","Debian"],"title":"Configuraci√≥n de acceso remoto en MariaDB"},{"categories":null,"contents":"Para configurar el acceso remoto en Oracle, es fundamental ajustar correctamente los archivos de red ubicados en $ORACLE_HOME/network/admin. Estos archivos, como listener.ora y tnsnames.ora, permiten definir c√≥mo se conectar√°n los clientes a la base de datos y qu√© equipos tendr√°n acceso.\nConfiguraci√≥n acceso remoto La configuraci√≥n de oracle con respecto a la red se guarda en el directorio que hayamos definido como home de oracle $ORACLE_HOME/network/admin :\nlistener.ora: Este archivo sirve para configurar el servicio de escucha (listener) de Oracle. Contiene informaci√≥n sobre los puntos de conexi√≥n y los protocolos que el servidor de Oracle utilizar√° para aceptar conexiones de clientes. samples: Dentro de este directorio, hay ejemplos de archivos de configuraci√≥n para varios componentes de Oracle. Estos archivos de muestra son √∫tiles como referencia cuando necesitamos crear archivos de configuraci√≥n. shrept.lst: Este archivo forma parte del proceso de recuperaci√≥n de Oracle y se utiliza para rastrear la replicaci√≥n de registros de cambios en tiempo real. Es esencial cuando se trabaja con replicaci√≥n de datos. sqlnet.ora: Este archivo se configuran las opciones de red de Oracle. Aqu√≠ se define c√≥mo se resuelven los nombres de los servidores, configurar medidas de seguridad y ajustar la capa de seguridad . tnsnames.ora: Aqu√≠ se definen los alias que oracle va a utilizar . Comenzaremos configurando el listener.ora y indicaremos que equipos se pueden conectar a la base de datos en mi caso todos :\nUna vez hecho esto iniciaremos sesi√≥n con el usuario oracle y iniciaremos el servicio de escucha de oracle para poder conectarnos en red:\n*Ten en cuenta que tienes que a√±adir las variables de oracle en el .bashrc del usuario oracle para que puedas iniciar el servicio , si no lo has hecho no te encontrara el comando .\nEn el equipo cliente donde vayamos a realizar la conexi√≥n deberemos de editar el fichero tsnames.ora y a√±adir la direcci√≥n y el puerto donde esta alojado nuestro servidor :\nUna vez hecho esto el comando para conectarnos es el siguiente :\nLa sintaxis es usuario/contrase√±a@//IP:PUERTO/SID\nPodemos consultar tablas , he a√±adido el esquema del proyecto del a√±o anterior :\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_oracle/acceso_remoto_oracle.png","permalink":"https://www.javiercd.es/posts/base_de_datos/oracle_acceso_remoto/oracle_acceso_remoto/","summary":"\u003cp\u003ePara configurar el acceso remoto en Oracle, es fundamental ajustar correctamente los archivos de red ubicados en $ORACLE_HOME/network/admin. Estos archivos, como listener.ora y tnsnames.ora, permiten definir c√≥mo se conectar√°n los clientes a la base de datos y qu√© equipos tendr√°n acceso.\u003c/p\u003e\n\u003ch2 id=\"configuraci√≥n-acceso-remoto\"\u003eConfiguraci√≥n acceso remoto\u003c/h2\u003e\n\u003cp\u003eLa configuraci√≥n de oracle con respecto a la red se guarda en el directorio que hayamos definido como home de oracle  $ORACLE_HOME/network/admin :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/base_de_datos/oracle_acceso_remoto/img/Aspose.Words.55b57132-3c19-4447-864b-0b88f1173a10.029.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003elistener.ora\u003c/strong\u003e: Este archivo sirve para configurar el servicio de escucha (listener) de Oracle. Contiene informaci√≥n sobre los puntos de conexi√≥n y los protocolos que el servidor de Oracle utilizar√° para aceptar conexiones de clientes.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003esamples\u003c/strong\u003e: Dentro de este directorio, hay ejemplos de archivos de configuraci√≥n para varios componentes de Oracle. Estos archivos de muestra son √∫tiles como referencia cuando necesitamos crear archivos de configuraci√≥n.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eshrept.lst\u003c/strong\u003e: Este archivo forma parte del proceso de recuperaci√≥n de Oracle y se utiliza para rastrear la replicaci√≥n de registros de cambios en tiempo real. Es esencial cuando se trabaja con replicaci√≥n de datos.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003esqlnet.ora\u003c/strong\u003e: Este archivo se configuran las opciones de red de Oracle. Aqu√≠ se define c√≥mo se resuelven los nombres de los servidores, configurar medidas de seguridad y ajustar la capa de seguridad .\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003etnsnames.ora\u003c/strong\u003e: Aqu√≠ se definen los alias que oracle va a utilizar .\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eComenzaremos configurando el listener.ora y indicaremos que equipos se pueden conectar a la base de datos en mi caso todos :\u003c/p\u003e","tags":["Oracle","Debian"],"title":"Configuraci√≥n de acceso remoto en Oracle"},{"categories":null,"contents":"La instalaci√≥n de los controladores de NVIDIA en el universo de Linux ha sido tradicionalmente un desaf√≠o, especialmente en distribuciones como Debian, donde las pol√≠ticas del software libre a menudo complican el proceso.\nEn este post voy a explicarte una forma sencilla de instalar los drivers de NVIDIA usando los repositorios oficiales de Debian . Adem√°s, al final del art√≠culo, aprender√°s a instalar una herramienta clave llamada Nvidia Optimus, que te brindar√° la capacidad de seleccionar qu√© tarjeta gr√°fica utilizar√° tu equipo.\nEsta herramienta es especialmente √∫til en port√°tiles, ya que es com√∫n que estos dispositivos presenten problemas al emitir video a trav√©s de los puertos, una situaci√≥n que puede ser f√°cilmente con esta herramienta.\nIdentificaci√≥n de Nuestra GPU Antes de embarcarnos en la instalaci√≥n y configuraci√≥n, es fundamental conocer el hardware de nuestro equipo. Para averiguar qu√© tarjetas gr√°ficas est√°n disponibles en nuestro sistema, utilizaremos el siguiente comando:\njaviercruces@HPOMEN15:~$ lspci -nn | egrep -i \u0026#34;3d|display|vga\u0026#34; 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) 06:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Cezanne [Radeon Vega Series / Radeon Vega Mobile Series] [1002:1638] (rev c5) Como se puede apreciar en la salida del comando anterior, mi equipo port√°til cuenta con dos tarjetas gr√°ficas. Identificar el modelo es crucial, ya que si optamos por una instalaci√≥n manual del controlador, necesitaremos el espec√≠fico para nuestra GPU.\nNo obstante, en Debian contamos con una utilidad que simplifica este proceso, indic√°ndonos qu√© controlador debemos instalar. Sin embargo, para acceder a esta utilidad, es necesario modificar nuestros repositorios de Debian.\nPara llevar a cabo esta modificaci√≥n, a√±adiremos la secci√≥n \u0026ldquo;non-free\u0026rdquo; a nuestros repositorios utilizando un editor de texto de nuestra preferencia:\njaviercruces@HPOMEN15:~$ sudo nano /etc/apt/sources.list deb http://deb.debian.org/debian/ bookworm main contrib non-free non-free-firmware Recuerda que cada vez que modifiques este fichero tienes que hacer un update para que se actualice.\njaviercruces@HPOMEN15:~$ sudo apt update -y Con nuestros repositorios debidamente actualizados, procederemos a instalar el script de detecci√≥n de NVIDIA con el siguiente comando:\njaviercruces@HPOMEN15:~$ sudo apt install nvidia-detect Ahora ejecutaremos el script de NVIDIA; como podr√°s observar, nos proporcionar√° informaci√≥n detallada sobre nuestra tarjeta gr√°fica NVIDIA, as√≠ como los diversos controladores compatibles y el paquete de Debian recomendado para la instalaci√≥n:\njaviercruces@HPOMEN15:~$ nvidia-detect Detected NVIDIA GPUs: 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) Checking card: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] (rev a1) Your card is supported by all driver versions. Your card is also supported by the Tesla drivers series. Your card is also supported by the Tesla 470 drivers series. It is recommended to install the nvidia-driver package. Instalaci√≥n del driver recomendado Antes de instalar los controladores, debes obtener los encabezados del kernel adecuados para que el controlador de NVIDIA pueda compilar correctamente.\nEn un sistema t√≠pico de 64 bits que utiliza el kernel predeterminado, simplemente ejecutas:\njaviercruces@HPOMEN15:~$ sudo apt install linux-headers-amd64 Para sistemas de 32 bits con el kernel no-PAE, en su lugar, realizar√≠as la siguiente instalaci√≥n:\njaviercruces@HPOMEN15:~$ sudo apt install linux-headers-686 Una vez instalada las dependencias del driver , instalaremos el mismo :\njaviercruces@HPOMEN15:~$ sudo apt install nvidia-driver -y Durante la instalaci√≥n, es probable que encuentres una pantalla t√≠picamente azul que te informa sobre un conflicto con el controlador \u0026ldquo;nouveau\u0026rdquo;, el cual es el driver instalado autom√°ticamente por Debian debido a sus caracter√≠sticas de software libre. Simplemente haz clic en \u0026ldquo;OK\u0026rdquo; en esta pantalla y contin√∫a con el proceso de instalaci√≥n.\nAl concluir la instalaci√≥n, ser√° necesario reiniciar tu equipo para cargar el m√≥dulo de NVIDIA. Despu√©s de reiniciar, puedes verificar si se ha cargado correctamente utilizando el siguiente comando. Utilizando la barra inclinada (/), puedes filtrar la salida escribiendo la palabra \u0026ldquo;nvidia\u0026rdquo;, lo que te llevar√° directamente a la informaci√≥n relevante de tu tarjeta gr√°fica, permiti√©ndote confirmar que el m√≥dulo de NVIDIA est√° cargado.\nTienes que comprobar que en la linea \u0026ldquo;Kernel driver in use\u0026rdquo; , tenga el modulo nvidia .\njaviercruces@HPOMEN15:~$ lspci -knn | less 01:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA106M [GeForce RTX 3060 Mobile / Max-Q] [10de:2520] (rev a1) DeviceName: NVIDIA Graphics Device Subsystem: Hewlett-Packard Company GA106M [GeForce RTX 3060 Mobile / Max-Q] [103c:88d1] Kernel driver in use: nvidia Kernel modules: nouveau, nvidia_current_drm, nvidia_current Puede que no te hayas dado cuenta pero ahora en tu escritorio tendr√°s una app llamada nvidia-settings con la cual podr√°s configurar tu gr√°fica .\nAdemas si quieres ver desde la linea de comandos informaci√≥n de tu GPU NVIDIA tienes a tu disposici√≥n el siguiente comando :\njaviercruces@HPOMEN15:~$ nvidia-smi Fri Dec 29 02:04:58 2023 +-----------------------------------------------------------------------------+ | NVIDIA-SMI 525.125.06 Driver Version: 525.125.06 CUDA Version: 12.0 | |-------------------------------+----------------------+----------------------+ | GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC | | Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. | | | | MIG M. | |===============================+======================+======================| | 0 NVIDIA GeForce ... On | 00000000:01:00.0 Off | N/A | | N/A 42C P5 10W / 80W | 296MiB / 6144MiB | 12% Default | | | | N/A | +-------------------------------+----------------------+----------------------+ +-----------------------------------------------------------------------------+ | Processes: | | GPU GI CI PID Type Process name GPU Memory | | ID ID Usage | |=============================================================================| | 0 N/A N/A 3246 G /usr/lib/xorg/Xorg 117MiB | | 0 N/A N/A 3442 G /usr/bin/gnome-shell 32MiB | | 0 N/A N/A 4807 G ...on=20231218-080113.411000 104MiB | | 0 N/A N/A 5802 G ...RendererForSitePerProcess 38MiB | +-----------------------------------------------------------------------------+ javiercruces@HPOMEN15:~$ ¬°Felicidades, Maestro de los Drivers NVIDIA! Has desbloqueado un logro √©pico en el reino de la inform√°tica. No cualquiera es capaz de llegar hasta aqu√≠, no quiero desilusionarte pero ¬øhas verificado que funcionen los puertos HDMI y DisplayPort de tu equipo?\nEn este punto, se abren dos posibles caminos:\nEn el primer escenario, tus puertos funcionan a la perfecci√≥n sin requerir intervenci√≥n adicional. Si este es tu caso, felicidades se ve que Dios tiene favoritos .\nSi por el contrario al igual que yo no eres uno de ellos , como acabas de comprobar los puertos no emiten video , en tu monitor veras que no tienes se√±al a pesar de que en el debian veas que te detecta el monitor.\nSi te ocurre este problema puedes encontrar un post en esta misma pagina explicando una posible soluci√≥n , para ello haremos uso de la herramienta nvidia optimus . Te dejo el enlace a continuaci√≥n https://www.javiercd.es/posts/drivers/nvidia_optimus/nvidia_optimus/\n","date":"September 1, 2024","hero":"/images/drivers/instalar_drivers_nvidia_bookworm.png","permalink":"https://www.javiercd.es/posts/drivers/nvidia_driver/instalacion-controladores-nvidia-debian-12/","summary":"\u003cp\u003eLa instalaci√≥n de los controladores de NVIDIA en el universo de Linux ha sido tradicionalmente un desaf√≠o, especialmente en distribuciones como Debian, donde las pol√≠ticas del software libre a menudo complican el proceso.\u003c/p\u003e\n\u003cp\u003eEn este post voy a explicarte una forma sencilla de instalar los drivers de NVIDIA usando los repositorios oficiales de Debian . Adem√°s, al final del art√≠culo, aprender√°s a instalar una herramienta clave llamada Nvidia Optimus, que te brindar√° la capacidad de seleccionar qu√© tarjeta gr√°fica utilizar√° tu equipo.\u003c/p\u003e","tags":["Controladores NVIDIA","Linux"],"title":"Instalaci√≥n de Controladores NVIDIA en Debian 12"},{"categories":null,"contents":"Instalar Oracle 19c en Debian 12 puede parecer complicado, pero no te preocupes, estoy aqu√≠ para guiarte en cada paso. En este post, te explicar√© de manera sencilla c√≥mo preparar tu sistema y realizar la instalaci√≥n de Oracle 19c en Debian 12.\nActualizar los repositorios Lo primero es actualizar los repositorios de nuestra maquina virtual y en el caso de que no tengamos alg√∫n paquete lo actualizamos :\nInstalar dependencias Lo siguiente sera instalar las dependencias de Oracle en nuestro sistema :\nlibaio1 : Proporciona acceso as√≠ncrono a E/S. Unixodbc : Es un controlador ODBC para conectividad de bases de datos. Bc : Es una calculadora de precisi√≥n arbitraria. Ksh : Es el shell Korn para scripts. Gawk : Es una versi√≥n mejorada de Awk para procesamiento de texto y datos. A√±adir usuario oracle Crearemos el grupo dba y crearemos el usuario oracle :\nComprobamos que podemos acceder al usuario oracle :\nConfiguraci√≥n de red Tenemos que tener configurada una ip est√°tica :\nAdem√°s tenemos que tener una entrada en el fichero hosts de nuestra direcci√≥n privada :\nDescargar el archivo de instalaci√≥n del sitio web de Oracle Una vez comprobado que podemos instalarlo en nuestro sistema o maquina virtual vamos a descargarnos desde su pagina web oficial .\nR√°pidamente nos daremos cuenta de que Oracle no da soporte a Debian ya que encontraremos el paquete en formato .rpm esto quiere decir que este esta preparado para instalarse en distribuciones basadas en red hat .\nPara que nosotros podamos usar este paquete deberemos transformarlo a .deb para ello existe una herramienta llamada alien que nos convertir√° el paquete para que lo podamos usar .\nNos instalamos la herramienta :\nAhora usando wget nos descargaremos el metapaquete de Oracle :\nUna vez descargado usaremos la utilidad alien para que nos transforme , esto tardara un ratillo aproximadamente para aligerar el proceso lo he transformado en mi maquina f√≠sica :\nNos lo pasamos a nuestra maquina virtual usando scp .\nAhora ya que tenemos nuestro paquete transformado a .deb nos lo instalamos usando dpkg en nuestra maquina virtual\nComenzaremos la instalaci√≥n , tardara un buen rato as√≠ que hay que tener paciencia :\nUna vez finalice en el bashrc de nuestro usuario a√±adiremos las variables de entorno de oracle , ORACLE_SID nos la dir√° al final de la instalaci√≥n , las dem√°s depender√°n de los directorio que hayamos puesto en pasos anteriores :\nSoluci√≥n errores Error [FATAL] [DBT-50000] No se ha podido comprobar la memoria disponible Nos devuelve un error , este nos indica que no puede comprobar la memoria disponible , este error lo podemos solucionar desactivando la comprobaci√≥n de par√°metros de configuraci√≥n para ello en la linea 164 del fichero ‚Üí /etc/init.d/oracledb_ORCLCDB-19c\nLa cambiaremos por la siguiente (linea 164 completa) :\n$SU -s /bin/bash $ORACLE_OWNER -c \u0026ldquo;$DBCA -silent -createDatabase -gdbName $ORACLE_SID -templateName $TEMPLATE_NAME -characterSet $CHARSET - createAsContainerDatabase $CREATE_AS_CDB -numberOfPDBs $NUMBER_OF_PDBS - pdbName $PDB_NAME -createListener $LISTENER_NAME:$LISTENER_PORT - datafileDestination $ORACLE_DATA_LOCATION -sid $ORACLE_SID -autoGeneratePasswords -emConfiguration DBEXPRESS -emExpressPort $EM_EXPRESS_PORT -J- Doracle.assistants.dbca.validate.ConfigurationParams=false\u0026rdquo;\n*Subrayo el contenido que debes a√±adir , tambi√©n puedes sustituir la linea entera .\nOtro error que nos puede dar es que no encuentre netstat :\nSe soluciona f√°cilmente instalando net-tools.\nORA-65096: nombre de usuario o rol com√∫n no valido Si no nos deja crear un usuario :\nCon esta modificaci√≥n nos dejara crear usuarios\nPrimeros pasos con Oracle Nos conectaremos como administradores en la base de datos :\nLo primero que tenemos que hacer sera crear un usuario , darle permisos que necesitemos e comprobar que nos podemos conectar con el :\nY le damos los permisos que consideremos al mismo :\nDespu√©s probamos a conectarnos con el mismo :\nCon esto habremos finalizado la instalaci√≥n b√°sica de Oracle 19c sobre Debian 12 . Es recomendable que si vas a utilizar la base de datos te instales un cliente como SQLplus o SQLdeveloper .\nInstalaci√≥n SQLplus Nos descargamos el paquete b√°sico SQLplus para Linux , es un .zip :\nNos descargamos el segundo paquete de SQLplus :\nNos creamos el directorio /opt/oracle :\nDescomprimimos los ficheros zip en el directorio que acabamos de crear :\nNos metemos en el directorio y listamos el contenido :\nY a continuaci√≥n exportaremos la variable de las librer√≠a SQLplus y ejecutamos los cambios :\nSi queremos que se mantenga lo a√±adiremos al bashrc :\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_oracle/instalacion_oracle.png","permalink":"https://www.javiercd.es/posts/base_de_datos/instalacion_oracle_19c_debian12/instalacion_oracle/","summary":"\u003cp\u003eInstalar Oracle 19c en Debian 12 puede parecer complicado, pero no te preocupes, estoy aqu√≠ para guiarte en cada paso. En este post, te explicar√© de manera sencilla c√≥mo preparar tu sistema y realizar la instalaci√≥n de Oracle 19c en Debian 12.\u003c/p\u003e\n\u003ch2 id=\"actualizar-los-repositorios\"\u003eActualizar los repositorios\u003c/h2\u003e\n\u003cp\u003eLo primero es actualizar los repositorios de nuestra maquina virtual y en el caso de que no tengamos alg√∫n paquete lo actualizamos :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/base_de_datos/instalacion_oracle_19c_debian12/img/Aspose.Words.55b57132-3c19-4447-864b-0b88f1173a10.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"instalar-dependencias\"\u003eInstalar dependencias\u003c/h2\u003e\n\u003cp\u003eLo siguiente sera instalar las dependencias de Oracle en nuestro sistema :\u003c/p\u003e","tags":["Oracle","Debian"],"title":"Instalaci√≥n de Oracle 19c bajo Debian 12"},{"categories":null,"contents":"En este post, te guiar√© a trav√©s del proceso de instalaci√≥n de PostgreSQL en Debian 12, la creaci√≥n de un usuario con permisos b√°sicos, y c√≥mo crear y consultar una base de datos.\n1. Instalaci√≥n de PostgreSQL Para instalar PostgreSQL en Debian 12, sigue estos pasos:\nActualiza los repositorios e instala PostgreSQL:\nPrimero, aseg√∫rate de que tu sistema est√© actualizado e instala PostgreSQL:\nsudo apt update sudo apt install postgresql Verifica que el servicio est√© en funcionamiento:\nDespu√©s de la instalaci√≥n, aseg√∫rate de que el servicio de PostgreSQL est√© en funcionamiento:\nsudo systemctl status postgresql Deber√≠as ver un mensaje que indique que el servicio est√° activo (running).\n2. Creaci√≥n de un Usuario y Asignaci√≥n de Permisos Accede al usuario postgres:\nPostgreSQL crea un usuario llamado postgres durante la instalaci√≥n. Accede a este usuario para realizar las tareas de configuraci√≥n:\nsudo -u postgres psql Si quieres puedes cambiar la contrase√±a del usuario postgres de la base de datos con el siguiente comando:\nALTER USER postgres WITH PASSWORD \u0026#39;tu_nueva_contrase√±a\u0026#39;; Crea un nuevo usuario:\nDentro del prompt de postgres,para crear un nuevo usuario utiliza el siguiente comando.\nCREATE USER javiercruces WITH PASSWORD \u0026#39;tu_contrase√±a\u0026#39;; Crea una nueva base de datos:\nA continuaci√≥n, crea una base de datos que estar√° asociada a tu nuevo usuario.\nCREATE DATABASE mypgdatabase OWNER mypguser; Crear un usuario administrador\nSi quieres crear un usuario con todos los privilegios en una base de datos introduce el siguiente comando:\nGRANT ALL PRIVILEGES ON DATABASE nombre_base_de_datos TO nombre_usuario; Sal de la consola con \\q:\n\\q 3. Prueba de Conexi√≥n Con√©ctate a PostgreSQL con el nuevo usuario:\nDesde el usuario postgres, o directamente desde tu terminal, intenta conectarte a PostgreSQL utilizando el nuevo usuario:\npsql -U nombre_usuario -d nombre_base_de_datos Se te pedir√° la contrase√±a del usuario. Si puedes acceder a la base de datos, la configuraci√≥n fue exitosa.\n4. Creaci√≥n y Consulta de una Tabla Crea una nueva tabla:\nUna vez dentro de la consola de PostgreSQL con el nuevo usuario, crea una nueva tabla. Por ejemplo, para una tabla de equipos de f√∫tbol:\nCREATE TABLE equipos ( id SERIAL PRIMARY KEY, nombre VARCHAR(100) NOT NULL, titulos INT NOT NULL ); Inserta datos en la tabla:\nInserta algunos datos de prueba en la tabla creada:\nINSERT INTO equipos (nombre, titulos) VALUES (\u0026#39;Real Madrid\u0026#39;, 15), (\u0026#39;Barcelona\u0026#39;, 5); Consulta los datos de la tabla:\nRealiza una consulta para verificar que los datos se han insertado correctamente:\nSELECT * FROM equipos; La salida esperada deber√≠a ser:\nid | nombre | titulos ----+--------------+--------- 1 | Real Madrid | 15 2 | Barcelona | 5 Con estos pasos, has instalado PostgreSQL, creado un usuario y base de datos, y realizado pruebas b√°sicas para asegurar que todo funciona correctamente. ¬°Ahora tienes tu entorno de PostgreSQL listo para usar!\n","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_postgre/instalacion_postgree.png","permalink":"https://www.javiercd.es/posts/base_de_datos/instalar_postgresql/instalar_postgresql/","summary":"\u003cp\u003eEn este post, te guiar√© a trav√©s del proceso de instalaci√≥n de PostgreSQL en Debian 12, la creaci√≥n de un usuario con permisos b√°sicos, y c√≥mo crear y consultar una base de datos.\u003c/p\u003e\n\u003ch2 id=\"1-instalaci√≥n-de-postgresql\"\u003e1. Instalaci√≥n de PostgreSQL\u003c/h2\u003e\n\u003cp\u003ePara instalar PostgreSQL en Debian 12, sigue estos pasos:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eActualiza los repositorios e instala PostgreSQL\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003ePrimero, aseg√∫rate de que tu sistema est√© actualizado e instala PostgreSQL:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003esudo apt install postgresql \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eVerifica que el servicio est√© en funcionamiento\u003c/strong\u003e:\u003c/p\u003e","tags":["PostgreSQL","Debian"],"title":"Instalaci√≥n de PostgreSQL en Debian 12"},{"categories":null,"contents":"Instalaci√≥n y Configuraci√≥n de MariaDB en Debian 12 Para instalar MariaDB en Debian 12, sigue estos pasos:\nActualiza los repositorios e instala el paquete de MariaDB:\nPrimero, actualiza los repositorios de tu sistema e instala MariaDB:\njaviercruces@jcruces:~$ sudo apt update javiercruces@jcruces:~$ sudo apt install mariadb-server Habilita y arranca el servicio de MariaDB:\nUna vez instalada, configura MariaDB para que se inicie autom√°ticamente al arranque y luego arranca el servicio:\njaviercruces@jcruces:~$ sudo systemctl start mariadb javiercruces@jcruces:~$ sudo systemctl enable mariadb Configura MariaDB:\nEjecuta el script de seguridad para realizar configuraciones iniciales:\njaviercruces@jcruces:~$ sudo mysql_secure_installation A continuaci√≥n, responde a las siguientes preguntas del asistente:\n# Ingresa la contrase√±a actual para root (presiona Enter si no hay contrase√±a): Enter current password for root (enter for none): `Enter` # ¬øEstablecer una nueva contrase√±a para root? [S/n]: Set root password? [Y/n]: `Y` # ¬øEliminar usuarios an√≥nimos? [S/n]: Remove anonymous users? [Y/n]: `Y` # ¬øDeshabilitar el inicio de sesi√≥n remoto para root? [S/n]: Disallow root login remotely? [Y/n]: `Y` # ¬øEliminar la base de datos de prueba y el acceso a ella? [S/n]: Remove test database and access to it? [Y/n]: `Y` # ¬øRecargar las tablas de privilegios ahora? [S/n]: Reload privilege tables now? [Y/n]: `Y` Crea un nuevo usuario y asigna permisos:\nCon√©ctate a MariaDB como root:\njaviercruces@jcruces:~$ sudo mysql -u root Luego, crea un nuevo usuario y dale permisos completos sobre la base de datos:\nCREATE USER \u0026#39;javiercruces\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;tu_contrase√±a\u0026#39;; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;javiercruces\u0026#39;@\u0026#39;localhost\u0026#39; WITH GRANT OPTION; FLUSH PRIVILEGES; EXIT; Con√©ctate usando el nuevo usuario:\nAhora puedes conectarte a MariaDB con el usuario reci√©n creado:\njaviercruces@jcruces:~$ mysql -u javiercruces -p Crea una nueva base de datos, inserta datos y consulta la tabla:\nCrea una base de datos, una tabla y a√±ade algunos datos:\nCREATE DATABASE futbol; USE futbol; CREATE TABLE titulos_champions ( id INT AUTO_INCREMENT PRIMARY KEY, equipo VARCHAR(100) NOT NULL, campeonatos INT NOT NULL ); INSERT INTO titulos_champions (equipo, campeonatos) VALUES (\u0026#39;Real Madrid\u0026#39;, 15), (\u0026#39;Barcelona\u0026#39;, 5); Luego, realiza una consulta para verificar los datos:\nSELECT * FROM titulos_champions; La salida esperada deber√≠a ser:\n+----+--------------+--------------+ | id | equipo | campeonatos | +----+--------------+--------------+ | 1 | Real Madrid | 15 | | 2 | Barcelona | 5 | +----+--------------+--------------+ ","date":"September 1, 2024","hero":"/images/base_de_datos/instalar_mariadb/instalar_mariadb.png","permalink":"https://www.javiercd.es/posts/base_de_datos/instalar_mariadb/instalar_mariadb/","summary":"\u003ch2 id=\"instalaci√≥n-y-configuraci√≥n-de-mariadb-en-debian-12\"\u003eInstalaci√≥n y Configuraci√≥n de MariaDB en Debian 12\u003c/h2\u003e\n\u003cp\u003ePara instalar MariaDB en Debian 12, sigue estos pasos:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eActualiza los repositorios e instala el paquete de MariaDB\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003ePrimero, actualiza los repositorios de tu sistema e instala MariaDB:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@jcruces:~$ sudo apt update\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@jcruces:~$ sudo apt install mariadb-server\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003eHabilita y arranca el servicio de MariaDB\u003c/strong\u003e:\u003c/p\u003e\n\u003cp\u003eUna vez instalada, configura MariaDB para que se inicie autom√°ticamente al arranque y luego arranca el servicio:\u003c/p\u003e","tags":["MariaDB","Debian"],"title":"Instalaci√≥n y Configuraci√≥n de MariaDB en Debian 12"},{"categories":null,"contents":"Este post aborda c√≥mo configurar y gestionar conexiones entre diferentes bases de datos, tanto homog√©neas como heterog√©neas, para facilitar la interoperabilidad entre sistemas de bases de datos diversos. A lo largo del art√≠culo, se exploran distintos escenarios de conexi√≥n, comenzando con configuraciones entre bases de datos del mismo tipo, como Oracle a Oracle o PostgreSQL a PostgreSQL, y luego avanzando hacia conexiones heterog√©neas entre diferentes tecnolog√≠as, como Oracle a MySQL, PostgreSQL a Oracle, y viceversa. Tambi√©n se cubren los pasos necesarios para configurar enlaces, crear usuarios, y modificar archivos de configuraci√≥n clave, permitiendo as√≠ realizar consultas remotas\nConexiones homog√©neas Oracle a Oracle Vamos a interconectar dos bases de datos Oracle, a las cuales llamaremos oracle1 y oracle2 para diferenciarlas a lo largo de esta pr√°ctica.\nCreaci√≥n de usuarios en Oracle1 Primero, crearemos un usuario en Oracle1 que tenga permisos para conectarse a la base de datos y para crear enlaces de base de datos:\nPara verificar que el usuario se ha creado correctamente, descon√©ctate del usuario actual y vuelve a conectarte con el nuevo usuario:\nCreaci√≥n de usuarios en Oracle2 Repite los pasos realizados en Oracle1 para crear un usuario en Oracle2 con permisos adecuados para conectarse remotamente y crear enlaces de base de datos:\nVerifica la conexi√≥n con el nuevo usuario creado:\nConfiguraci√≥n de los ficheros listener.ora y tnsnames.ora en ORACLE1 Para garantizar la interconexi√≥n, debemos configurar los ficheros listener.ora y tnsnames.ora. Esto permitir√° que ORACLE1 escuche las conexiones y reconozca la ubicaci√≥n de ORACLE2.\nConfiguraci√≥n de listener.ora Edita el fichero listener.ora para que ORACLE1 pueda escuchar conexiones en la red:\nNota: Aunque se recomienda permitir conexiones solo desde direcciones espec√≠ficas, en este entorno de pruebas hemos habilitado acceso general. En este archivo tambi√©n se define el puerto utilizado por Oracle.\nConfiguraci√≥n de tnsnames.ora Ahora configuraremos el fichero tnsnames.ora para que ORACLE1 sepa d√≥nde est√° ORACLE2:\nEn este ejemplo, ORACLE2 est√° configurado bajo la IP 192.168.122.13 y escucha en el puerto 1521. Tambi√©n es importante conocer el nombre del servicio remoto. Si no lo sabes, puedes ejecutarlo en ORACLE2 utilizando:\nVerificaci√≥n de conectividad Para confirmar que ORACLE1 puede comunicarse con ORACLE2, utilizaremos la herramienta tnsping con el alias configurado:\n¬°Recuerda! Si no configuraste el listener.ora en el servidor remoto (ORACLE2), esta prueba fallar√°.\nConfiguraci√≥n de los ficheros listener.ora y tnsnames.ora en ORACLE2 Ahora repetiremos los mismos pasos en ORACLE2 para que pueda comunicarse con ORACLE1.\nConfiguraci√≥n de listener.ora Edita el fichero listener.ora para que ORACLE2 escuche conexiones entrantes:\nEn este caso, hemos configurado ORACLE2 para escuchar en cualquier direcci√≥n, utilizando el puerto 1521, al igual que en ORACLE1.\nConfiguraci√≥n de tnsnames.ora Edita el fichero tnsnames.ora para definir un alias que permita a ORACLE2 comunicarse con ORACLE1:\nVerificaci√≥n de conectividad Usa la herramienta tnsping en ORACLE2 con el alias configurado para ORACLE1:\nSi la salida es exitosa, significa que ORACLE2 puede comunicarse con ORACLE1.\n¬°Recuerda! Si no configuraste el listener.ora en el servidor remoto (ORACLE1), esta prueba fallar√°.\nCreaci√≥n del enlace de ORACLE1 a ORACLE2 En esta etapa, estableceremos un enlace desde ORACLE1 hacia ORACLE2. Utilizaremos un usuario con privilegios de creaci√≥n de enlaces, como javiercruces1, que fue creado anteriormente.\nEl enlace recibir√° un nombre, en este caso, ORACLE2_LINK. Especificaremos que utilizaremos las credenciales del usuario remoto javiercruces2 y la conexi√≥n definida en el fichero tnsnames.ora para ORACLE2.\nVerificaci√≥n del enlace Para verificar, crearemos la tabla dept en ORACLE2 y realizaremos una consulta desde ORACLE1:\nCreaci√≥n del enlace de ORACLE2 a ORACLE1 Ahora configuraremos el enlace en la direcci√≥n opuesta, de ORACLE2 a ORACLE1. Seguiremos el mismo procedimiento.\nCon el usuario javiercruces2, crearemos un enlace llamado ORACLE1_LINK. Este enlace usar√° las credenciales del usuario remoto javiercruces1 y la conexi√≥n definida en el fichero tnsnames.ora para ORACLE1:\nVerificaci√≥n del enlace Realizaremos una consulta sencilla utilizando el enlace reci√©n creado:\nConsultas simult√°neas entre ORACLE1 y ORACLE2 Ahora, comprobaremos que es posible realizar consultas utilizando ambas bases de datos simult√°neamente desde ORACLE1:\nEsta misma consulta puede realizarse desde ORACLE2 tambi√©n:\nPostgreSQL a PostgreSQL Para permitir la interconexi√≥n, es esencial configurar ambas m√°quinas para que escuchen peticiones. Esto se logra definiendo las IPs y puertos en el archivo de configuraci√≥n ubicado en /etc/postgresql/15/main/postgresql.conf:\nAdem√°s, es necesario configurar las redes desde las cuales se aceptar√°n conexiones. Esto se realiza en el archivo pg_hba.conf:\nDespu√©s de realizar estos cambios, reiniciaremos el servicio PostgreSQL para aplicarlos:\nAl igual que en el apartado anterior, usaremos el esquema de tablas Scott, colocando una tabla en cada base de datos para realizar consultas \u0026ldquo;remotas\u0026rdquo;.\nInterconectar PostgreSQL1 a PostgreSQL2 Para interconectar las bases de datos, utilizaremos dblink, un m√≥dulo que permite realizar consultas y operaciones distribuidas entre bases de datos PostgreSQL. Esto se logra estableciendo conexiones directas entre ellas.\nCreaci√≥n de usuarios y base de datos en PostgreSQL1 Primero, creamos los usuarios y la base de datos en PostgreSQL1:\nHabilitar extensi√≥n dblink Activaremos la extensi√≥n dblink en PostgreSQL1:\nCreaci√≥n de la conexi√≥n hacia PostgreSQL2 Usaremos el m√≥dulo dblink para establecer una conexi√≥n hacia PostgreSQL2:\nRealizar consultas utilizando dblink Una vez creada la conexi√≥n, podemos realizar consultas remotas desde PostgreSQL1:\nNota: Es un poco tedioso definir los campos para cada consulta remota, lo que puede dificultar su uso en consultas m√°s complejas.\nInterconectar PostgreSQL2 a PostgreSQL1 Creaci√≥n de usuarios y base de datos en PostgreSQL2 Crearemos los usuarios y la base de datos en PostgreSQL2 siguiendo un proceso similar al realizado en PostgreSQL1:\nHabilitar extensi√≥n dblink y crear conexi√≥n hacia PostgreSQL1 Activaremos la extensi√≥n dblink y configuraremos la conexi√≥n hacia PostgreSQL1:\nRealizar consultas hacia PostgreSQL1 Ahora, podemos realizar consultas desde PostgreSQL2 hacia PostgreSQL1:\nConsultas simult√°neas entre PostgreSQL1 y PostgreSQL2 Para simplificar consultas remotas entre ambas bases de datos, podemos crear vistas. Esto evita la necesidad de definir manualmente el tipo de cada campo en las consultas:\nLa misma consulta puede realizarse desde PostgreSQL1 hacia PostgreSQL2:\nConexi√≥n Heterog√©nea Oracle a MySQL Instalaci√≥n del driver ODBC para MySQL Primero, descargamos el driver ODBC para MySQL junto con las dependencias necesarias:\nAccedemos a la p√°gina oficial de MySQL para descargar los drivers y proceder a su instalaci√≥n:\nConfiguraci√≥n de Heterogeneous Services en Oracle Accedemos al directorio hs/admin dentro de nuestra instalaci√≥n de Oracle:\nEditamos el archivo initMYSQL.ora con el siguiente contenido para configurar Heterogeneous Services:\nConfiguraci√≥n de ODBC para MySQL Configuramos ODBC para MySQL, asegur√°ndonos de incluir las credenciales correctas para conectar con la base de datos MySQL:\nConfiguraci√≥n del listener en Oracle Actualizamos la configuraci√≥n del listener para incluir localhost y el puerto de escucha de Oracle:\nReiniciamos el servicio del listener de Oracle para aplicar los cambios:\nComprobaci√≥n del driver ODBC Verificamos que el driver ODBC est√° funcionando correctamente conect√°ndonos a la base de datos MySQL. Tambi√©n podemos utilizar el driver isql para comprobar la conexi√≥n:\nCreaci√≥n del enlace entre Oracle y MySQL Creamos el enlace en Oracle para conectarnos a la base de datos MySQL:\nRealizar consultas entre Oracle y MySQL Podemos realizar una consulta sencilla hacia la base de datos MySQL:\nTambi√©n es posible realizar consultas utilizando ambas bases de datos simult√°neamente. Es importante encerrar en comillas dobles los nombres de los campos y tablas de MySQL para que sean interpretados correctamente:\nMysql a Oracle Oracle a PostgreSQL Nota: Para este apartado se utiliz√≥ una m√°quina con Oracle Linux 8 y Oracle Database 23.\nConfiguraci√≥n previa en Oracle Como paso inicial, creamos nuevamente un usuario y base de datos en Oracle, asignando los permisos adecuados:\nInstalaci√≥n del driver para PostgreSQL Instalamos el driver de PostgreSQL usando dnf. Este comando tambi√©n instalar√° las librer√≠as necesarias como dependencias:\nConfiguraci√≥n del archivo odbcinst.ini El archivo /etc/odbcinst.ini se utiliza en sistemas Linux para configurar los controladores ODBC. Editamos este archivo para registrar el driver de PostgreSQL:\nConfiguraci√≥n del archivo odbc.ini El archivo /etc/odbc.ini contiene configuraciones espec√≠ficas para cada conexi√≥n a una base de datos. Aqu√≠ configuramos los detalles de la conexi√≥n a la base de datos PostgreSQL:\nConfiguraci√≥n en Oracle para usar el driver Configuramos Oracle para que pueda utilizar el driver ODBC. Esto incluye actualizar los archivos necesarios para establecer la conexi√≥n:\nConfiguraci√≥n del Listener en Oracle Configuramos el archivo del listener para habilitar la comunicaci√≥n con la base de datos PostgreSQL:\nConfiguraci√≥n del archivo tnsnames.ora A√±adimos una entrada al archivo tnsnames.ora para definir la conexi√≥n a PostgreSQL:\nReinicio del Listener Reiniciamos el servicio del listener para aplicar los cambios:\nPrueba de conexi√≥n Verificamos la conectividad utilizando tnsping:\nAdem√°s, probamos la conexi√≥n utilizando el driver ODBC desde la terminal:\nCreaci√≥n del enlace en Oracle Conectamos a Oracle y creamos el enlace a la base de datos PostgreSQL. En las consultas, los nombres de campos y tablas deben ir entre comillas dobles, y los valores entre comillas simples:\nConsultas simult√°neas entre Oracle y PostgreSQL Podemos realizar consultas combinadas entre ambas bases de datos:\nPostgreSQL a Oracle Descarga e instalaci√≥n de paquetes necesarios Desde la p√°gina oficial de Oracle descargaremos los siguientes paquetes requeridos:\nDado que el sistema utilizado es Debian, es necesario convertir los paquetes de formato RPM a DEB utilizando alien. El proceso tardar√° aproximadamente 5 minutos, y los paquetes se instalar√°n autom√°ticamente al utilizar el par√°metro -i:\nPrueba de conexi√≥n a Oracle Una vez instalados los paquetes, verificamos que es posible conectarse remotamente a la base de datos Oracle para garantizar que la configuraci√≥n es correcta:\nDescarga y compilaci√≥n de oracle_fdw El siguiente paso es instalar oracle_fdw, una extensi√≥n para PostgreSQL que permite conectarse a Oracle. Descargamos la versi√≥n m√°s reciente desde el repositorio oficial:\nRepositorio: oracle_fdw en GitHub Clonamos el repositorio y compilamos el c√≥digo fuente:\nDentro del directorio descargado, ejecutamos make para compilar:\nFinalmente, instalamos la extensi√≥n con el comando make install:\nConfiguraci√≥n de PostgreSQL Creaci√≥n de la extensi√≥n: Nos conectamos a la base de datos PostgreSQL donde queremos crear el enlace y configuramos la extensi√≥n oracle_fdw:\nCreaci√≥n del esquema y servidor for√°neo: Creamos un esquema llamado oracle y configuramos un servidor for√°neo apuntando a la base de datos Oracle:\nMapeo de usuarios: Creamos un mapeo entre el usuario local de PostgreSQL (javiercruces1) y el usuario remoto de Oracle (javiercruces3). Tambi√©n otorgamos los permisos necesarios sobre el esquema y el servidor for√°neo:\nImportaci√≥n del esquema: Con el usuario local de PostgreSQL, importamos el esquema de tablas del usuario de Oracle hacia el servidor for√°neo local:\nConsultas combinadas Finalmente, podemos realizar consultas que involucren datos de ambas bases de datos (PostgreSQL y Oracle). Esto permite trabajar con informaci√≥n distribuida de manera integrada:\n","date":"September 1, 2024","hero":"/images/base_de_datos/interconexion_de_servidores/interconexion_de_servidores.png","permalink":"https://www.javiercd.es/posts/base_de_datos/interconexion_de_servidores/interconexion_servidores/","summary":"\u003cp\u003eEste post aborda c√≥mo configurar y gestionar conexiones entre diferentes bases de datos, tanto homog√©neas como heterog√©neas, para facilitar la interoperabilidad entre sistemas de bases de datos diversos. A lo largo del art√≠culo, se exploran distintos escenarios de conexi√≥n, comenzando con configuraciones entre bases de datos del mismo tipo, como Oracle a Oracle o PostgreSQL a PostgreSQL, y luego avanzando hacia conexiones heterog√©neas entre diferentes tecnolog√≠as, como Oracle a MySQL, PostgreSQL a Oracle, y viceversa. Tambi√©n se cubren los pasos necesarios para configurar enlaces, crear usuarios, y modificar archivos de configuraci√≥n clave, permitiendo as√≠ realizar consultas remotas\u003c/p\u003e","tags":["Oracle","Mysql","PostgreSQL","Debian"],"title":"Interconexi√≥n de servidores de bases de datos"},{"categories":null,"contents":"\nEl objetivo de este post es comparar los distintos software de VPNs mas utilizados viendo cual es mas r√°pido , para ello nos apoyaremos en test de velocidad utilizando iperf3 .\n[!NOTE]\nLa comparativa parte de los post de esta secci√≥n en los que montamos cada tipo de VPN .\nVelocidad sin VPN Voy a comenzar comparando las velocidades de estos 2 sistemas , utilizando iperf3 . Para ello he quitado el router cisco ya que lo tenia configurado con interfaces FastEthernet y lo he cambiado por un router Linux con interfaces GigabitEthernet .\nVoy a lanzar un iperf3 utilizando las direcciones publicas para que el trafico no utilice ninguna VPN :\njaviercruces@servidor2:~$ iperf3 -c 90.0.0.2 -i 1 -t 30 Connecting to host 90.0.0.2, port 5201 [ 5] local 100.0.0.2 port 32858 connected to 90.0.0.2 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 110 MBytes 919 Mbits/sec 897 188 KBytes [ 5] 1.00-2.00 sec 102 MBytes 859 Mbits/sec 712 120 KBytes [ 5] 2.00-3.00 sec 111 MBytes 931 Mbits/sec 735 83.4 KBytes [ 5] 3.00-4.00 sec 112 MBytes 944 Mbits/sec 600 173 KBytes [ 5] 4.00-5.00 sec 109 MBytes 913 Mbits/sec 1018 126 KBytes [ 5] 5.00-6.00 sec 115 MBytes 961 Mbits/sec 889 113 KBytes [ 5] 6.00-7.00 sec 113 MBytes 947 Mbits/sec 549 90.5 KBytes [ 5] 7.00-8.00 sec 116 MBytes 976 Mbits/sec 964 198 KBytes [ 5] 8.00-9.00 sec 114 MBytes 956 Mbits/sec 591 76.4 KBytes [ 5] 9.00-10.00 sec 108 MBytes 908 Mbits/sec 736 120 KBytes [ 5] 10.00-11.00 sec 105 MBytes 881 Mbits/sec 689 126 KBytes [ 5] 11.00-12.00 sec 106 MBytes 893 Mbits/sec 745 124 KBytes [ 5] 12.00-13.00 sec 118 MBytes 990 Mbits/sec 847 93.3 KBytes [ 5] 13.00-14.00 sec 122 MBytes 1.03 Gbits/sec 899 94.7 KBytes [ 5] 14.00-15.00 sec 125 MBytes 1.05 Gbits/sec 1014 73.5 KBytes [ 5] 15.00-16.00 sec 125 MBytes 1.05 Gbits/sec 973 113 KBytes [ 5] 16.00-17.00 sec 109 MBytes 915 Mbits/sec 934 86.3 KBytes [ 5] 17.00-18.00 sec 101 MBytes 844 Mbits/sec 629 115 KBytes [ 5] 18.00-19.00 sec 105 MBytes 881 Mbits/sec 652 122 KBytes [ 5] 19.00-20.00 sec 116 MBytes 971 Mbits/sec 826 96.2 KBytes [ 5] 20.00-21.00 sec 115 MBytes 962 Mbits/sec 820 99.0 KBytes [ 5] 21.00-22.00 sec 128 MBytes 1.08 Gbits/sec 1193 99.0 KBytes [ 5] 22.00-23.00 sec 130 MBytes 1.09 Gbits/sec 1027 110 KBytes [ 5] 23.00-24.00 sec 123 MBytes 1.03 Gbits/sec 855 116 KBytes [ 5] 24.00-25.00 sec 122 MBytes 1.03 Gbits/sec 714 126 KBytes [ 5] 25.00-26.00 sec 120 MBytes 1.01 Gbits/sec 861 119 KBytes [ 5] 26.00-27.00 sec 129 MBytes 1.08 Gbits/sec 768 112 KBytes [ 5] 27.00-28.00 sec 125 MBytes 1.05 Gbits/sec 976 140 KBytes [ 5] 28.00-29.00 sec 116 MBytes 972 Mbits/sec 943 140 KBytes [ 5] 29.00-30.00 sec 119 MBytes 996 Mbits/sec 755 116 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-30.00 sec 3.39 GBytes 970 Mbits/sec 24811 sender [ 5] 0.00-30.00 sec 3.39 GBytes 970 Mbits/sec receiver La velocidad media de la red ha sido de 970 Mbits/sec , sin usar ninguna VPN .\nVelocidad de Wireguard Vemos a medir la velocidad de Wireguard :\njaviercruces@cliente3:~$ iperf3 -c 192.168.0.2 -i 1 -t 30 Connecting to host 192.168.0.2, port 5201 [ 5] local 192.168.1.2 port 39096 connected to 192.168.0.2 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 57.5 MBytes 483 Mbits/sec 63 196 KBytes [ 5] 1.00-2.00 sec 56.4 MBytes 473 Mbits/sec 37 190 KBytes [ 5] 2.00-3.00 sec 58.2 MBytes 488 Mbits/sec 85 188 KBytes [ 5] 3.00-4.00 sec 57.1 MBytes 479 Mbits/sec 65 140 KBytes [ 5] 4.00-5.00 sec 57.8 MBytes 485 Mbits/sec 6 199 KBytes [ 5] 5.00-6.00 sec 59.7 MBytes 500 Mbits/sec 62 200 KBytes [ 5] 6.00-7.00 sec 59.0 MBytes 495 Mbits/sec 26 234 KBytes [ 5] 7.00-8.00 sec 57.8 MBytes 485 Mbits/sec 13 216 KBytes [ 5] 8.00-9.00 sec 58.6 MBytes 492 Mbits/sec 88 151 KBytes [ 5] 9.00-10.00 sec 58.1 MBytes 487 Mbits/sec 13 174 KBytes [ 5] 10.00-11.00 sec 57.9 MBytes 486 Mbits/sec 22 135 KBytes [ 5] 11.00-12.00 sec 57.1 MBytes 479 Mbits/sec 30 188 KBytes [ 5] 12.00-13.00 sec 57.3 MBytes 481 Mbits/sec 19 178 KBytes [ 5] 13.00-14.00 sec 57.1 MBytes 479 Mbits/sec 15 230 KBytes [ 5] 14.00-15.00 sec 56.5 MBytes 474 Mbits/sec 20 218 KBytes [ 5] 15.00-16.00 sec 57.4 MBytes 481 Mbits/sec 38 172 KBytes [ 5] 16.00-17.00 sec 55.9 MBytes 469 Mbits/sec 137 143 KBytes [ 5] 17.00-18.00 sec 57.0 MBytes 478 Mbits/sec 26 246 KBytes [ 5] 18.00-19.00 sec 56.6 MBytes 475 Mbits/sec 42 183 KBytes [ 5] 19.00-20.00 sec 56.2 MBytes 471 Mbits/sec 43 222 KBytes [ 5] 20.00-21.00 sec 56.5 MBytes 474 Mbits/sec 11 203 KBytes [ 5] 21.00-22.00 sec 56.4 MBytes 473 Mbits/sec 69 147 KBytes [ 5] 22.00-23.00 sec 54.1 MBytes 454 Mbits/sec 25 163 KBytes [ 5] 23.00-24.00 sec 55.9 MBytes 469 Mbits/sec 54 207 KBytes [ 5] 24.00-25.00 sec 57.5 MBytes 482 Mbits/sec 99 164 KBytes [ 5] 25.00-26.00 sec 56.5 MBytes 474 Mbits/sec 39 182 KBytes [ 5] 26.00-27.00 sec 56.7 MBytes 476 Mbits/sec 24 150 KBytes [ 5] 27.00-28.00 sec 56.3 MBytes 472 Mbits/sec 6 219 KBytes [ 5] 28.00-29.00 sec 57.0 MBytes 478 Mbits/sec 15 146 KBytes [ 5] 29.00-30.00 sec 56.0 MBytes 470 Mbits/sec 48 151 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-30.00 sec 1.67 GBytes 479 Mbits/sec 1240 sender [ 5] 0.00-30.00 sec 1.67 GBytes 479 Mbits/sec receiver La velocidad media de wireguard ha sido de 479 Mbits/sec .\nVelocidad de OpenVPN Vamos a medir la velocidad de OpenVPN\njaviercruces@cliente3:~$ iperf3 -c 192.168.0.2 -i 1 -t 30 Connecting to host 192.168.0.2, port 5201 [ 5] local 192.168.1.2 port 43522 connected to 192.168.0.2 port 5201 [ ID] Interval Transfer Bitrate Retr Cwnd [ 5] 0.00-1.00 sec 25.1 MBytes 211 Mbits/sec 24 139 KBytes [ 5] 1.00-2.00 sec 24.8 MBytes 208 Mbits/sec 15 163 KBytes [ 5] 2.00-3.00 sec 23.7 MBytes 199 Mbits/sec 40 103 KBytes [ 5] 3.00-4.00 sec 24.6 MBytes 207 Mbits/sec 19 114 KBytes [ 5] 4.00-5.00 sec 24.2 MBytes 203 Mbits/sec 8 119 KBytes [ 5] 5.00-6.00 sec 24.3 MBytes 204 Mbits/sec 14 155 KBytes [ 5] 6.00-7.00 sec 24.2 MBytes 203 Mbits/sec 13 139 KBytes [ 5] 7.00-8.00 sec 24.5 MBytes 206 Mbits/sec 18 115 KBytes [ 5] 8.00-9.00 sec 24.0 MBytes 201 Mbits/sec 34 132 KBytes [ 5] 9.00-10.00 sec 24.3 MBytes 204 Mbits/sec 32 120 KBytes [ 5] 10.00-11.00 sec 24.5 MBytes 206 Mbits/sec 12 100 KBytes [ 5] 11.00-12.00 sec 24.4 MBytes 205 Mbits/sec 8 139 KBytes [ 5] 12.00-13.00 sec 23.9 MBytes 201 Mbits/sec 6 171 KBytes [ 5] 13.00-14.00 sec 24.1 MBytes 202 Mbits/sec 20 156 KBytes [ 5] 14.00-15.00 sec 24.0 MBytes 202 Mbits/sec 8 135 KBytes [ 5] 15.00-16.00 sec 23.5 MBytes 197 Mbits/sec 21 143 KBytes [ 5] 16.00-17.00 sec 24.0 MBytes 202 Mbits/sec 8 168 KBytes [ 5] 17.00-18.00 sec 24.6 MBytes 206 Mbits/sec 24 154 KBytes [ 5] 18.00-19.00 sec 23.8 MBytes 200 Mbits/sec 21 132 KBytes [ 5] 19.00-20.00 sec 24.3 MBytes 204 Mbits/sec 20 139 KBytes [ 5] 20.00-21.00 sec 24.6 MBytes 206 Mbits/sec 11 142 KBytes [ 5] 21.00-22.00 sec 23.0 MBytes 193 Mbits/sec 26 115 KBytes [ 5] 22.00-23.00 sec 24.6 MBytes 207 Mbits/sec 3 128 KBytes [ 5] 23.00-24.00 sec 24.0 MBytes 202 Mbits/sec 26 104 KBytes [ 5] 24.00-25.00 sec 24.3 MBytes 204 Mbits/sec 21 106 KBytes [ 5] 25.00-26.00 sec 24.3 MBytes 204 Mbits/sec 15 108 KBytes [ 5] 26.00-27.00 sec 23.8 MBytes 200 Mbits/sec 36 132 KBytes [ 5] 27.00-28.00 sec 22.9 MBytes 192 Mbits/sec 13 118 KBytes [ 5] 28.00-29.00 sec 23.7 MBytes 199 Mbits/sec 19 163 KBytes [ 5] 29.00-30.00 sec 24.2 MBytes 203 Mbits/sec 11 126 KBytes - - - - - - - - - - - - - - - - - - - - - - - - - [ ID] Interval Transfer Bitrate Retr [ 5] 0.00-30.00 sec 725 MBytes 203 Mbits/sec 546 sender [ 5] 0.00-30.00 sec 724 MBytes 202 Mbits/sec receiver La velocidad media ha sido 203 Mbits/sec .\nConclusiones Si comparamos los resultados, queda claro que en t√©rminos de velocidad, WireGuard ha demostrado ser la opci√≥n m√°s eficiente, superando significativamente a OpenVPN , dobl√°ndolo en velocidad .\nWireGuard est√° dise√±ado para una velocidad r√°pida. Establece una conexi√≥n en 100 milisegundos, mientras que OpenVPN tarda 8 milisegundos. En algunas pruebas, WireGuard demostr√≥ ser un 58% m√°s r√°pido que OpenVPN. En circunstancias ideales, su velocidad super√≥ los 500 mbps.\nWireGuard es el protocolo m√°s r√°pido debido a muchos factores. Estos incluyen:\nSu c√≥digo ligero lo convierte intr√≠nsecamente en el protocolo m√°s r√°pido. WireGuard tambi√©n admite el multithreading -procesar datos utilizando muchos n√∫cleos de la CPU simult√°neamente- y utiliza un m√©todo de cifrado m√°s r√°pido. Adem√°s, WireGuard es bueno en el uso del ancho de banda disponible y opera completamente en el espacio del kernel. Para evitar la censura, OpenVPN es mejor que WireGuard. ¬øPor qu√©? Porque el protocolo OpenVPN puede funcionar sobre las capas del Protocolo UPD y TCP.\nUDP es m√°s r√°pido, mientras que TCP es fiable.TCP puede evitar la censura utilizando el puerto 443, el mismo puerto que utiliza HTTPS. Gracias a TCP, OpenVPN evita la censura de pa√≠ses estrictos como China y Rusia. En algunos casos, una inspecci√≥n profunda avanzada puede detectar OpenVPN. Pero para estos casos, los expertos en seguridad recomiendan utilizar el Scramble dentro de la configuraci√≥n avanzada del protocolo para a√±adir otra capa de protecci√≥n al tr√°fico VPN.\nPor otro lado, WireGuard s√≥lo utiliza la capa UDP para transportar datos. Y el prop√≥sito principal de UDP es transportar datos a gran velocidad, no eludir la censura. Esto hace que sea f√°cil de detectar. Adem√°s, es susceptible de inspecci√≥n profunda de paquetes.\nOpenVPN es seguro si se configura adecuadamente. Este protocolo no tiene vulnerabilidades de seguridad conocidas, y su c√≥digo ha sido auditado muchas veces. Adem√°s, tiene muchos cifrados y algoritmos de autenticaci√≥n. Cuando se produce alguna vulnerabilidad de seguridad en el algoritmo, entonces OpenVPN puede configurar inmediatamente otra cosa.\nEn t√©rminos de casos de seguridad, WireGuard tambi√©n se ha ganado una buena reputaci√≥n. Es seguro y utiliza la √∫ltima criptograf√≠a. Su c√≥digo es corto y f√°cil de auditar. Adem√°s, WireGuard tiene un conjunto fijo de algoritmos y cifrados. Cuando se encuentra alguna vulnerabilidad, todos los puntos finales se actualizan a una nueva versi√≥n, lo que garantiza que nadie vuelva a utilizar c√≥digo inseguro.\n","date":"March 28, 2024","hero":"/images/vpn/wire_ovpn.png","permalink":"https://www.javiercd.es/posts/vpn/comparativa_ovpn_wire/comparativa_ovpn_wire/","summary":"\u003cp\u003e\u003cimg src=\"/vpn/comparativa_ovpn_wire/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEl objetivo de este post es comparar los distintos software de VPNs mas utilizados viendo cual es mas r√°pido , para ello nos apoyaremos en test de velocidad utilizando iperf3 .\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nLa comparativa parte de los post de esta secci√≥n en los que montamos cada tipo de VPN .\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"velocidad-sin-vpn\"\u003eVelocidad sin VPN\u003c/h2\u003e\n\u003cp\u003eVoy a comenzar comparando las velocidades de estos 2 sistemas , utilizando iperf3 . Para ello he quitado el router cisco ya que lo tenia configurado con interfaces FastEthernet y lo he cambiado por un router Linux con interfaces GigabitEthernet .\u003c/p\u003e","tags":["VPN","LINUX","DEBIAN","WIREGUARD","OPENVPN"],"title":"Comparativa entre OpenVPN y Wireguard"},{"categories":null,"contents":"En un primer momento un alumno crear√° una Autoridad Certficadora y firmar√° un certificado para la p√°gina del otro alumno. Posteriormente lo pondremos a prueba en los servidores web Apache y Nginx\nCrear la Autoridad Certificadora Paso 1: Creaci√≥n de directorios y archivos El primer paso ser√° generar un directorio en el que ubicar√°s tu entidad certificadora, con la finalidad de mantener en todo momento una organizaci√≥n. El nombre del directorio ser√° CA/. A su vez, hay que generar varios subdirectorios dentro del mismo:\ncertsdb: En dicho directorio se almacenar√°n los certificados firmados. certreqs: En dicho directorio se almacenar√°n los ficheros de solicitud de firma de certificados (CSR). crl: En dicho directorio se almacenar√° la lista de certificados que han sido revocados (CRL). private: En dicho directorio se almacenar√° la clave privada de la autoridad certificadora. debian@javiercrucesCA:~$ sudo mkdir /CA debian@javiercrucesCA:~$ cd !$ debian@javiercrucesCA:/CA$ sudo mkdir certsdb certreqs crl private debian@javiercrucesCA:/CA$ sudo chmod 700 private/ debian@javiercrucesCA:/CA$ sudo touch index.txt Una vez generados los directorios, mu√©vete dentro del directorio padre CA/. Cuando te encuentres dentro del mismo, lista el contenido de forma gr√°fica para as√≠ poder apreciar que todo se ha generado correctamente, haciendo para ello uso de tree. Ver√°s que los 4 directorios han sido correctamente generados. Antes de continuar es recomendable cambiar los permisos a 700 al directorio private/, ya que contendr√° la clave privada de la CA y nos interesa que √∫nicamente el propietario tenga acceso a la misma. Adem√°s, necesitaremos en el directorio actual un fichero que actuar√° como base de datos para los certificados existentes de nombre index.txt\ndebian@javiercrucesCA:/CA$ sudo tree -p [drwxr-xr-x] . ‚îú‚îÄ‚îÄ [drwxr-xr-x] certreqs ‚îú‚îÄ‚îÄ [drwxr-xr-x] certsdb ‚îú‚îÄ‚îÄ [drwxr-xr-x] crl ‚îú‚îÄ‚îÄ [-rw-r--r--] index.txt ‚îî‚îÄ‚îÄ [drwx------] private 5 directories, 1 file debian@javiercrucesCA:/CA$ Paso 2: Fichero de configuraci√≥n de openssl Lo m√°s probable es que quieras usar un fichero de configuraci√≥n de openssl que no sea el de nuestra m√°quina, para as√≠ tratar de que la autoridad certificadora est√© en todo momento lo m√°s aislada posible de la misma, as√≠ que haz una copia de tu fichero de configuraci√≥n nativo y ad√°ptalo a tus necesidades. Dicho fichero se encuentra normalmente en /usr/lib/ssl/openssl.cnf, aunque tambi√©n podr√≠a estar en /etc/openssl.cnf o en /usr/share/ssl/openssl.cnf, tendr√°s que copiarlo al directorio actual y modificarlo con un editor de textos.\ndebian@javiercrucesCA:/CA$ sudo cp /usr/lib/ssl/openssl.cnf ./ debian@javiercrucesCA:/CA$ ls -l total 32 drwxr-xr-x 2 root root 4096 Jan 8 19:22 certreqs drwxr-xr-x 2 root root 4096 Jan 8 19:22 certsdb drwxr-xr-x 2 root root 4096 Jan 8 19:22 crl -rw-r--r-- 1 root root 0 Jan 8 19:23 index.txt -rw-r--r-- 1 root root 12332 Jan 8 19:26 openssl.cnf drwx------ 2 root root 4096 Jan 8 19:22 private Dentro del mismo, hay que realizar las oportunas adaptaciones para que haga uso de los directorios anteriormente generados, as√≠ como indicar determinada informaci√≥n b√°sica sobre la autoridad certificadora, que vuestro compa√±ero debe conocer, pues le ser√° solicitada a la hora de la generaci√≥n del fichero de solicitud de firma de certificado. Las modificaciones a realizar son las siguientes:\ndir = /root/CA certs = $dir/certsdb new_certs_dir = $certs\n[ CA_default ] dir = /CA # Where everything is kept certs = $dir/certsdb # Where the issued certs are kept crl_dir = $dir/crl # Where the issued crl are kept database = $dir/index.txt # database index file. #unique_subject = no # Set to \u0026#39;no\u0026#39; to allow creation of # several certs with same subject. new_certs_dir = $certs # default place for new certs. countryName_default = ES stateOrProvinceName_default = Sevilla localityName_default = Dos Hermanas 0.organizationName_default = IES Gonzalo Nazareno organizationalUnitName_default = Informatica\n[ req_distinguished_name ] countryName = Country Name (2 letter code) countryName_default = ES countryName_min = 2 countryName_max = 2 stateOrProvinceName = State or Province Name (full name) stateOrProvinceName_default = Sevilla localityName = Dos Hermanas 0.organizationName = Organization Name (eg, company) 0.organizationName_default = IES Gonzalo Nazareno # we can do this but it is not needed normally :-) #1.organizationName = Second Organization Name (eg, company) #1.organizationName_default = World Wide Web Pty Ltd organizationalUnitName = Organizational Unit Name (eg, section) organizationalUnitName_default = Informatica #challengePassword = A challenge password #challengePassword_min = 4 #challengePassword_max = 20 #unstructuredName = An optional company name\n[ req_attributes ] challengePassword = A challenge password challengePassword_min = 4 challengePassword_max = 20 unstructuredName = An optional company name Paso 3: Creaci√≥n y firmado de nuestra propio certificado Tras ello, ya tendr√°s todo listo para generar tu par de claves y un fichero de solicitud de firma de certificado que posteriormente te autofirmar√°s, ejecutando para ello el comando:\ndebian@javiercrucesCA:/CA$ sudo openssl req -new -newkey rsa:4096 -keyout private/cakey.pem -out careq.pem -config ./openssl.cnf Enter PEM pass phrase: Verifying - Enter PEM pass phrase: ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Country Name (2 letter code) [ES]:ES State or Province Name (full name) [Sevilla]:Sevilla Dos Hermanas []: Organization Name (eg, company) [IES Gonzalo Nazareno]: Organizational Unit Name (eg, section) [Informatica]: Common Name (e.g. server FQDN or YOUR name) []:javiercruces.iesgn.org Email Address []:javierasping@gmail.com Como puedes ver, se solicita una frase de paso para proteger la clave privada que vamos a generar, as√≠ como determinada informaci√≥n b√°sica para el fichero de solicitud de firma de certificado, que debe coincidir con la que anteriormente hemos introducido en el fichero de configuraci√≥n de openssl. Los dos √∫ltimos campos no son gen√©ricos, por lo que debemos rellenarlos seg√∫n el caso. Tras ello, ya podremos proceder a autofirmarnos el certificado, que es el que posteriormente tendremos que facilitar a los clientes para que incluyan en su lista de certificados de CA, para que as√≠ no se les muestre la advertencia al utilizar HTTPS. Como he mencionado anteriormente, en una situaci√≥n real, este proceso lo suelen llevar a cabo empresas con determinada reputaci√≥n cuyo certificado se encuentra importado por defecto en los navegadores. Para ello, ejecuta el comando:\ndebian@javiercrucesCA:/CA$ sudo openssl ca -create_serial -out cacert.pem -days 365 -keyfile private/cakey.pem -selfsign -extensions v3_ca -config ./openssl.cnf -infiles careq.pem Using configuration from ./openssl.cnf Enter pass phrase for private/cakey.pem: Check that the request matches the signature Signature ok Certificate Details: Serial Number: 74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f2 Validity Not Before: Jan 8 19:57:17 2024 GMT Not After : Jan 7 19:57:17 2025 GMT Subject: countryName = ES stateOrProvinceName = Sevilla organizationName = IES Gonzalo Nazareno organizationalUnitName = Informatica commonName = javiercruces.iesgn.org emailAddress = javierasping@gmail.com X509v3 extensions: X509v3 Subject Key Identifier: E3:9C:A3:CF:0E:33:EB:83:45:40:00:9B:04:4A:A9:9B:C8:8C:A9:62 X509v3 Authority Key Identifier: E3:9C:A3:CF:0E:33:EB:83:45:40:00:9B:04:4A:A9:9B:C8:8C:A9:62 X509v3 Basic Constraints: critical CA:TRUE Certificate is to be certified until Jan 7 19:57:17 2025 GMT (365 days) Sign the certificate? [y/n]:y 1 out of 1 certificate requests certified, commit? [y/n]y Write out database with 1 new entries Data Base Updated debian@javiercrucesCA:/CA$ Donde:\ncreate_serial: Indicamos que genere un serial de 128 bits para comenzar. Gracias a dicha aleatoriedad, si tuvi√©semos que volver a empezar, no sobreescribir√≠amos los ya existentes. Es muy importante. out: Especificamos d√≥nde se va a almacenar el certificado firmado. En este caso, en el directorio actual, con nombre cacert.pem. days: Especificamos la validez en d√≠as del certificado firmado. En este caso, 365 d√≠as. keyfile: Indicamos la clave privada a usar para firmar dicho certificado. En este caso, la generada en el paso anterior, private/cakey.pem. selfsign: Indicamos a openssl que vamos a autofirmarnos el certificado. extensions: Indicamos a openssl la secci√≥n del fichero de configuraci√≥n en el que se encuentran las extensiones a usar. En este caso, v3_ca. config: Especificamos a openssl que utilice el fichero de configuraci√≥n modificado, no el nativo, con nombre openssl.cnf. infiles: Indicamos qu√© queremos firmar, en este caso, el CSR para nuestra nueva autoridad certificadora creado en el paso anterior, con nombre careq.pem. Como se puede apreciar en la salida del comando, se nos ha pedido la frase de paso previamente configurada, para as√≠ asegurarnos que aunque la clave privada llegase a malas manos, no puedan realizar firmas fraudulentas. Adem√°s, antes de firmar el certificado, se nos ha mostrado toda la informaci√≥n referente al mismo, y se nos ha pedido confirmaci√≥n. Para verificar que el certificado de la autoridad certificadora se encuentra contenido en el directorio actual, lista el contenido del mismo y comprueba que, efectivamente, existe un fichero cacert.pem que es resultado de firmar el fichero de solicitud de firma de certificado careq.pem.\ndebian@javiercrucesCA:/CA$ sudo tree . ‚îú‚îÄ‚îÄ cacert.pem ‚îú‚îÄ‚îÄ careq.pem ‚îú‚îÄ‚îÄ certreqs ‚îú‚îÄ‚îÄ certsdb ‚îÇ¬†‚îî‚îÄ‚îÄ 741E8AF82445149E28F183047C7D6C0F5F3BACF2.pem ‚îú‚îÄ‚îÄ crl ‚îú‚îÄ‚îÄ index.txt ‚îú‚îÄ‚îÄ index.txt.attr ‚îú‚îÄ‚îÄ index.txt.old ‚îú‚îÄ‚îÄ openssl.cnf ‚îú‚îÄ‚îÄ private ‚îÇ¬†‚îî‚îÄ‚îÄ cakey.pem ‚îî‚îÄ‚îÄ serial 5 directories, 9 files debian@javiercrucesCA:/CA$ Paso 4: Firma de solicitudes de certificado Ya est√° todo listo para proceder a firmar el certificado para el servidor de tu compa√±ero, as√≠ que debes situar su fichero de solicitud de firma de certificado dentro de certreqs/, que es donde deben ubicarse.\ndebian@javiercrucesCA:~$ sudo ls -l /CA/certreqs/ total 4 -rw-r--r-- 1 root root 1785 Jan 11 10:00 peperc.csr Puedes proceder a firmarlo, haciendo uso del comando:\ndebian@javiercrucesCA:/CA$ sudo openssl ca -config openssl.cnf -extensions v3_req -days 3650 -notext -md sha256 -in certreqs/peperc.csr -out certsdb/pepe.csr.pem Using configuration from openssl.cnf Enter pass phrase for /CA/private/cakey.pem: Check that the request matches the signature Signature ok Certificate Details: Serial Number: 74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f3 Validity Not Before: Jan 11 10:01:58 2024 GMT Not After : Jan 8 10:01:58 2034 GMT Subject: countryName = ES stateOrProvinceName = Sevilla organizationName = IES Gonzalo Nazareno commonName = pfoter15 emailAddress = pepepfoter15@gmail.com X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Key Usage: Digital Signature, Non Repudiation, Key Encipherment Certificate is to be certified until Jan 8 10:01:58 2034 GMT (3650 days) Sign the certificate? [y/n]:y 1 out of 1 certificate requests certified, commit? [y/n]y Write out database with 1 new entries Database updated Donde:\nconfig: Especificamos a openssl que utilice el fichero de configuraci√≥n modificado, no el nativo, con nombre openssl.cnf. out: Especificamos d√≥nde se va a almacenar el certificado firmado. En este caso, dentro del directorio certsdb/, con nombre nombre.crt. infiles: Indicamos qu√© queremos firmar, en este caso, el CSR de nuestro compa√±ero, situado en certreqs/ con nombre nombre.csr. En un principio, el certificado ya se encuentra firmado dentro de certsdb/, as√≠ que para verificarlo, vas a listar el contenido de dicho directorio.\nDeben existir un total de 3 ficheros dentro del mismo: uno correspondiente al propio certificado de la autoridad certificadora, y dos correspondientes a tu compa√±ero, que son exactamente lo mismo pero con diferentes nombres, uno de ellos con un identificador y el otro, con un nombre com√∫n que nosotros hemos establecido para as√≠ identificarlo con una mayor facilidad.\ndebian@javiercrucesCA:~$ sudo ls -l /CA/certsdb/ total 16 -rw-r--r-- 1 root root 7429 Jan 8 19:57 741E8AF82445149E28F183047C7D6C0F5F3BACF2.pem -rw-r--r-- 1 root root 2139 Jan 11 10:02 741E8AF82445149E28F183047C7D6C0F5F3BACF3.pem -rw-r--r-- 1 root root 2139 Jan 11 10:02 pepe.csr.pem Paso 5: Env√≠o de certificados al servidor web. Hasta aqu√≠ ha llegado tu parte, ya que √∫nicamente quedar√≠a hacerle llegar a tu compa√±ero el fichero certsdb/nombre.crt, que es su certificado firmado, junto al propio certificado de la autoridad certificadora, el cu√°l contiene la clave p√∫blica, para as√≠ poder verificar dicha firma sobre su certificado, de nombre cacert.pem. Por √∫ltimo, vas a mostrar el contenido del fichero index.txt, que es una especie de base de datos en texto plano con informaci√≥n sobre los certificados firmados por la autoridad certificadora. Dentro del mismo, encontramos informaci√≥n b√°sica correspondiente a los dos certificados firmados: el de la propia autoridad certificadora y el de nuestro compa√±ero, adem√°s de su estado de validez actual.\nVoy a enviar y a traerme de la instancia de pepe las diferentes ficheros , el ha configurado mi clave publica para que pueda conectarme :\ndebian@javiercrucesCA:~$ scp javiercd.csr 172.22.200.113:/home/debian/ javiercd.csr 100% 1886 839.4KB/s 00:00 debian@javiercrucesCA:~$ scp 172.22.200.113:/home/debian/peperc.csr ./ peperc.csr 100% 1785 432.6KB/s 00:00 -- Le envio su certificado firmado debian@javiercrucesCA:~$ scp 172.22.200.113:/CA/certsdb/pepe.csr.pem pepe.csr.pem 100% 1785 432.6KB/s 00:00 debian@javiercrucesCA:~$ scp /CA/cacert.pem 172.22.200.113:/home/debian/pub_javi.pem cacert.pem 100% 7429 582.6KB/s 00:00 debian@javiercrucesCA:~$ scp 172.22.200.113:/CA/cacert.pem ./pub_pepe.pem cacert.pem 100% 7389 1.2MB/s 00:00 Tarea 2: Configurar HTTPS Paso 1: Creaci√≥n de clave y solicitud de certificado. Lo primero que tendr√°s que hacer es crear una solicitud de firma de certificado (CSR o Certificate Signing Request) y hac√©rselo llegar a tu compa√±ero. En este caso, vamos a hacerlo con openssl, pero se podr√≠a hacer con otras m√∫ltiples opciones de software.\nPara crear una solicitud de firma de certificado, primero debemos tener una clave privada que se asociar√° al mismo, as√≠ que generaremos una clave privada RSA de 4096 bits, que ser√° almacenada en /etc/ssl/private/, ejecutando para ello el comando:\ndebian@javiercrucesCA:~$ sudo openssl genrsa 4096 \u0026gt; javiercd.key debian@javiercrucesCA:~$ sudo mv javiercd.key /etc/ssl/private/ Una vez generada, cambiaremos los permisos de la misma a 400, de manera que √∫nicamente el propietario pueda leer el contenido, pues se trata de una clave privada. Este paso no es obligatorio pero s√≠ recomendable por seguridad. Escribe el comando necesario para ello.\ndebian@javiercrucesCA:~$ sudo chmod 400 /etc/ssl/private/javiercd.key Tras ello, crearemos un fichero .csr de solicitud de firma de certificado para que sea firmado por la autoridad certificadora (CA) creada por nuestro compa√±ero. Dicho fichero no contiene informaci√≥n confidencial, as√≠ que no importar√° la ruta donde lo almacenemos ni los permisos asignados. En mi caso, lo almacenar√© en el directorio actual, ejecutando para ello el comando openssl req, con las opciones:\nnew: Indicamos que la creaci√≥n de la solicitud de firma de certificado sea interactiva, pues nos pedir√° determinados par√°metros. key: Indicamos la clave privada a asociar a dicha solicitud de firma de certificado. En este caso, la generada en el paso anterior, /etc/ssl/private/tunombre.key. out: Especificamos d√≥nde se va a almacenar la solicitud de firma de certificado. En este caso, en el directorio actual, con nombre tunombre.csr. Durante la ejecuci√≥n, nos pedir√° una serie de valores para identificar al certificado, que tendremos que rellenar conforme a la configuracion que hemos realizado en la unidad certificadora .\nDicha informaci√≥n nos la tendr√° que dar la autoridad certificadora, excepto los dos √∫ltimos valores, que en el caso del Common Name, pondr√°s el FQDN de la web en la que queremos configurar HTTPS. Adem√°s, tendr√°s que introducir tu correo electr√≥nico en el apartado Email Address.\ndebian@javiercrucesCA:/CA$ sudo openssl ca -config openssl.cnf -extensions v3_req -days 3650 -notext -md sha256 -in certreqs/peperc.csr -out certsdb/pepe.csr.pem Using configuration from openssl.cnf Enter pass phrase for /CA/private/cakey.pem: Check that the request matches the signature Signature ok Certificate Details: Serial Number: 74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f3 Validity Not Before: Jan 11 10:01:58 2024 GMT Not After : Jan 8 10:01:58 2034 GMT Subject: countryName = ES stateOrProvinceName = Sevilla organizationName = IES Gonzalo Nazareno commonName = pfoter15 emailAddress = pepepfoter15@gmail.com X509v3 extensions: X509v3 Basic Constraints: CA:FALSE X509v3 Key Usage: Digital Signature, Non Repudiation, Key Encipherment Certificate is to be certified until Jan 8 10:01:58 2034 GMT (3650 days) Sign the certificate? [y/n]:y 1 out of 1 certificate requests certified, commit? [y/n]y Write out database with 1 new entries Database updated Para verificar que el fichero de solicitud de firma ha sido correctamente generado, lista el contenido del directorio actual. Debe existir un fichero de nombre tunombre.csr que debes enviar a tu compa√±ero, para que as√≠ sea firmado por la correspondiente autoridad certificadora que ha creado.\ndebian@javiercrucesCA:~$ ls -l total 16 -rw-r--r-- 1 root root 1886 Jan 11 09:40 javiercd.csr En mi caso se lo har√© llegar usando SCP :\ndebian@javiercrucesCA:~$ scp javiercd.csr 172.22.200.113:/home/debian/ javiercd.csr 100% 1886 839.4KB/s 00:00 Una vez firmado me lo traer√© de su servidor\nPaso 2: Almacenamiento de certificados en el servidor Adem√°s de dicho certificado firmado, nos debe enviar la clave p√∫blica de la entidad certificadora, es decir, el certificado de la misma, para as√≠ poder verificar su firma sobre nuestro certificado. Almacena ambos ficheros en /etc/ssl/certs/ y lista el contenido de dicho directorio.\ndebian@javiercrucesCA:~$ sudo mv javiercd.csr.pem /etc/ssl/certs/ debian@javiercrucesCA:~$ sudo mv pub_pepe.pem /etc/ssl/certs Debe existir un fichero de nombre tunombre.crt que es el resultado de la firma de la solicitud de firma de certificado que previamente le hemos enviado, y otro de nombre cacert.pem, que es el certificado de la entidad certificadora, con el que posteriormente se comprobar√° la firma de la autoridad certificadora sobre dicho certificado del servidor.\ndebian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/certs | grep javi -rw-r--r-- 1 debian debian 2175 Jan 11 10:05 javiercd.csr.pem debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/certs | grep pepe -rw-r--r-- 1 root root 7389 Jan 11 11:24 pub_pepe.pem debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/private/ total 8 -r-------- 1 debian debian 3272 Jan 11 09:37 javiercd.key Paso 3: Configuraci√≥n de Apache Al igual que apache2 inclu√≠a un VirtualHost por defecto para las peticiones entrantes por el puerto 80 (HTTP), contiene otro por defecto para las peticiones entrantes por el puerto 443 (HTTPS), de nombre default-ssl, que por defecto viene deshabilitado, as√≠ que procederemos a modificarlo teniendo en cuenta las siguientes directivas:\nServerName: Al igual que en el VirtualHost anterior, tendremos que indicar el nombre de dominio a trav√©s del cu√°l accederemos al servidor. SSLEngine: Activa el motor SSL, necesario para hacer uso de HTTPS, por lo que su valor debe ser on. SSLCertificateFile: Indicamos la ruta del certificado del servidor firmado por la CA. En este caso, /etc/ssl/certs/tunombre.crt. SSLCertificateKeyFile: Indicamos la ruta de la clave privada asociada al certificado del servidor. En este caso, /etc/ssl/private/tunombre.key. SSLCACertificateFile: Indicamos la ruta del certificado de la CA con el que comprobaremos la firma de nuestro certificado. En este caso, /etc/ssl/certs/cacert.pem. debian@javiercrucesCA:/CA$ sudo a2enmod ssl debian@javiercrucesCA:/CA$ sudo a2ensite default-ssl.conf debian@javiercrucesCA:~$ sudo cat /etc/apache2/sites-available/default-ssl.conf \u0026lt;VirtualHost *:80\u0026gt; ServerName javiercruces.iesgn.org Redirect permanent / https://javiercruces.iesgn.org/ \u0026lt;/VirtualHost\u0026gt; \u0026lt;VirtualHost *:443\u0026gt; ServerAdmin webmaster@localhost ServerName javiercruces.iesgn.org DocumentRoot /var/www/html ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined SSLEngine on SSLCertificateFile /etc/ssl/certs/javiercd.csr.pem SSLCertificateKeyFile /etc/ssl/private/javiercd.key \u0026lt;/VirtualHost\u0026gt; debian@javiercrucesCA:~$ sudo systemctl reload apache2.service Demostraci√≥n :\nPaso 4: Configuraci√≥n de Nginx Vamos a forzar la configuraci√≥n de https en Nginx\nAqu√≠ te dejo la configuraci√≥n del virtualhost :\ndebian@javiercrucesCA:/var/www/sad$ sudo cat /etc/nginx/sites-available/default server { listen 80; listen [::]:80; server_name javiercruces.iesgn.org; # Redirecci√≥n a HTTPS return 301 https://$host$request_uri; } server { listen 443 ssl; listen [::]:443 ssl; root /var/www/sad; index index.php index.html index.htm; server_name moodle.javiercd.es; ssl_certificate /etc/ssl/certs/javiercd.csr.pem; ssl_certificate_key /etc/ssl/private/javiercd.key; } ","date":"March 28, 2024","hero":"/images/seguridad/certificados_ssl.png","permalink":"https://www.javiercd.es/posts/seguridad/https_autofirmado/https_autofirmado/","summary":"\u003cp\u003eEn un primer momento un alumno crear√° una Autoridad Certficadora y firmar√° un certificado para la p√°gina del otro alumno. Posteriormente lo pondremos a prueba en los servidores web Apache y Nginx\u003c/p\u003e\n\u003ch2 id=\"crear-la-autoridad-certificadora\"\u003eCrear la Autoridad Certificadora\u003c/h2\u003e\n\u003ch3 id=\"paso-1-creaci√≥n-de-directorios-y-archivos\"\u003ePaso 1: Creaci√≥n de directorios y archivos\u003c/h3\u003e\n\u003cp\u003eEl primer paso ser√° generar un directorio en el que ubicar√°s tu entidad certificadora, con la finalidad de mantener en todo momento una organizaci√≥n. El nombre del directorio ser√° CA/. A su vez, hay que generar varios subdirectorios dentro del mismo:\u003c/p\u003e","tags":["LINUX","DEBIAN","HTTPS"],"title":"Crear autoridad certificadora (CA) y certificados autofirmados en Linux"},{"categories":null,"contents":"Equivalencia de GUI a CLI Inicialmente, empec√© la pr√°ctica utilizando la l√≠nea de comandos (CLI) sin embargo, encontr√© que resulta m√°s c√≥modo realizarla desde la interfaz gr√°fica. Por eso, decid√≠ establecer una equivalencia entre las diferentes acciones que he llevado a cabo durante la pr√°ctica y compararlas con su contraparte en la terminal.\n[!NOTE]\nEn este post hago un peque√±o resumen de las equivalencias entre la GUI y la CLI de Fortinet que he utilizado en los 2 post de cortafuegos Fortinet.\nConfigurar una interfaz Como ya tenemos el cortafuegos configurado tenemos 2 opciones a la hora de ver la configuraci√≥n de una determinada interfaz .\nVer la configuraci√≥n de todas las interfaces :\nshow system interface O especificar una en concreto :\nshow system interface port1 Si observamos la configuraci√≥n de las tres interfaces que he establecido durante la pr√°ctica, podemos notar que la sintaxis es muy sencilla. Pr√°cticamente, incluso sin tener conocimientos previos sobre el tema, es f√°cil de comprender.\nFTG # show system interface config system interface edit \u0026#34;port1\u0026#34; set vdom \u0026#34;root\u0026#34; set ip 192.168.122.77 255.255.255.0 set allowaccess https http fgfm set type physical set alias \u0026#34;WAN\u0026#34; set lldp-reception enable set role wan set snmp-index 1 next edit \u0026#34;port2\u0026#34; set vdom \u0026#34;root\u0026#34; set ip 192.168.100.1 255.255.255.0 set allowaccess ping https ssh http fgfm set type physical set alias \u0026#34;LAN\u0026#34; set device-identification enable set lldp-transmission enable set monitor-bandwidth enable set role lan set snmp-index 2 next edit \u0026#34;port3\u0026#34; set vdom \u0026#34;root\u0026#34; set ip 192.168.200.1 255.255.255.0 set type physical set alias \u0026#34;DMZ\u0026#34; set device-identification enable set lldp-transmission enable set role lan set snmp-index 3 next Como puedes ver en la interfaz puerto 1 que es la que corresponde a la WAN , anteriormente desactive el acceso para configurarlo desde esta interfaz , pero por comodidad lo he dejado activado para usar el navegador de mi port√°til .\nUna configuraci√≥n que nos puede interesar es configurar una interfaz por DHCP , en mi caso lo har√© en el puerto 4 :\n# Accedemos al modo de configuraci√≥n FTG # config system interface # Seleccionamos la interfaz 4 FTG (interface) # edit \u0026#34;port4\u0026#34; # La ponemos en modo DHCP FTG (port4) # set mode dhcp # Salimos del modo de configuraci√≥n FTG (port4) # end Ahora si listamos la configurar de la interfaz se habr√° aplicado el cambio :\nFTG # show system interface port4 config system interface edit \u0026#34;port4\u0026#34; set vdom \u0026#34;root\u0026#34; set mode dhcp set type physical set snmp-index 4 next end En este punto, observamos que los comandos que hemos utilizado coinciden con los que el sistema muestra al listar la configuraci√≥n.\nAhora, lo que nos interesa es conocer la direcci√≥n IP de nuestra interfaz. Si deseamos listar todas las direcciones IP asignadas, simplemente no especificamos el nombre de la interfaz. En mi caso, me interesa saber la direcci√≥n IP de la interfaz del puerto 4:\nFTG # get system interface physical port4 == [onboard] ==[port4] mode: dhcp ip: 192.168.122.121 255.255.255.0 ipv6: ::/0 status: up speed: 1000Mbps (Duplex: full) FEC: none FEC_cap: none Esto es lo b√°sico que necesitamos para comenzar a configurar las interfaces . Te dejo un enlace a la documentaci√≥n oficial donde explica todos los detalles .\nPol√≠ticas Lo siguiente que hemos realizado en la practica es crear reglas desde la CLI , as√≠ que comenzare listando las reglas existentes , recuerda que en la versi√≥n de prueba tenemos un limite de 10 reglas simultaneas as√≠ que he eliminado algunas reglas durante la realizaci√≥n de la misma .\nPara hacer la salida mas legible vamos a ver una regla \u0026ldquo;normal\u0026rdquo; y otra de DNAT para compararlas :\nFTG # show firewall policy config firewall policy edit 1 set name \u0026#34;LAN_WAN_SSH\u0026#34; set uuid 57bba290-e881-51ee-3bbe-3ba5903773ed set srcintf \u0026#34;port2\u0026#34; set dstintf \u0026#34;port1\u0026#34; set action accept set srcaddr \u0026#34;all\u0026#34; set dstaddr \u0026#34;all\u0026#34; set schedule \u0026#34;always\u0026#34; set service \u0026#34;SSH\u0026#34; set nat enable next edit 5 set name \u0026#34;WAN_LAN_DNAT_SSH\u0026#34; set uuid bdd84292-e884-51ee-a5d3-20eabb2fd433 set srcintf \u0026#34;port1\u0026#34; set dstintf \u0026#34;port2\u0026#34; set action accept set srcaddr \u0026#34;all\u0026#34; set dstaddr \u0026#34;DNAT_SSH\u0026#34; set schedule \u0026#34;always\u0026#34; set service \u0026#34;SSH\u0026#34; set utm-status enable set ssl-ssh-profile \u0026#34;certificate-inspection\u0026#34; set ips-sensor \u0026#34;block_xmas\u0026#34; set nat enable next Vemos que la salida es bastante clara , si nos paramos a ver los par√°metros comunes :\nname: Nombre que le queremos dar a la regla . UUID: Un identificador √∫nico que le asigna autom√°ticamente el FW a cada regla . srcintf: Interfaz de origen (Por donde entra el trafico) dstintf: Interfaz de origen (Por donde entra el trafico) action: Que acci√≥n queremos que haga la regla accept | deny . srcaddr: Direcci√≥n de origen dstaddr: Direcci√≥n de destino schedule: Programaci√≥n de la regla , por si es una regla temporal esta solo estar√° activa durante cierto tiempo . service: Nombre del servicio (Va asignado a un numero de puerto) nat: Si queremos que la regla haga SNAT . Esto seria la sintaxis b√°sica de cada regla como ves entre una regla \u0026ldquo;normal\u0026rdquo; y una de DNAT lo √∫nico que cambia es la direcci√≥n del trafico y la IP de destino que en este dispositivo es una IP virtual .\nSi queremos borrar una regla , haremos lo siguiente :\n# Accedemos al modo de configuracion de las politicas de seguridad FTG # config firewall policy # Borraremos la regla segun el id de la misma FTG (policy) # delete 2 # Salimos de la configuracion FTG (policy) # end Para a√±adir una nueva regla, la sintaxis es similar a cuando listamos las reglas, pero necesitamos especificar un n√∫mero de identificaci√≥n (ID) al crearla. Es recomendable que sepas el n√∫mero de la √∫ltima regla que a√±adiste. Si no indicas un n√∫mero, no se crear√° una nueva regla.\nFTG#config firewall policy FTG (policy) # edit 12 new entry \u0026#39;12\u0026#39; added FTG (12) # set name \u0026#34;LAN_WAN_DNS\u0026#34; FTG (12) # set srcintf \u0026#34;port2\u0026#34; FTG (12) # set dstintf \u0026#34;port1\u0026#34; FTG (12) # set action accept FTG (12) # set srcaddr \u0026#34;all\u0026#34; FTG (12) # set dstaddr \u0026#34;Google_DNS\u0026#34; FTG (12) # set schedule \u0026#34;always\u0026#34; FTG (12) # set service \u0026#34;DNS\u0026#34; FTG (12) # set nat enable FTG (12) # next FTG (policy) # end Hay much√≠simas mas opciones que ignoro que no ha sido necesarias utilizarlas en la practica , te dejo un enlace a la documentaci√≥n oficial donde detalla todas las distintas opciones .\nServicios Los servicios son unos objetos los cuales almacenan un numero o conjunto de puertos los cuales posteriormente utilizaras al crear reglas .Aunque estos dispositivos vienen con los servicios mas comunes de fabrica , muchas veces es necesario que creemos uno nuevo acorde a nuestras necesidades .\nAl igual que con los comandos anteriores de listar , podemos listar todos los servicios o uno en concreto :\nFTG # show firewall service custom config firewall service custom edit \u0026#34;DNS\u0026#34; set category \u0026#34;Network Services\u0026#34; set tcp-portrange 53 set udp-portrange 53 next edit \u0026#34;HTTP\u0026#34; set category \u0026#34;Web Access\u0026#34; set tcp-portrange 80 next edit \u0026#34;HTTPS\u0026#34; set category \u0026#34;Web Access\u0026#34; set tcp-portrange 443 next FTG # show firewall service custom SSH_2222 config firewall service custom edit \u0026#34;SSH_2222\u0026#34; set category \u0026#34;Remote Access\u0026#34; set tcp-portrange 2222 next end Para borrar un servicio , seguiremos los siguientes pasos :\n# Accedemos a la configuraci√≥n de los servicios FTG # config firewall service custom # Borramos el servicio indicando el nombre FTG (custom) # delete SSH_2222 # Salimos del modo de configuraci√≥n FTG (custom) # end Si queremos crearlo seguiremos los siguientes pasos :\n# Accedemos a la configuraci√≥n de los servicios FTG # config firewall service custom # Le asignamos un nombre FTG (custom) # edit SSH_2222 # Opcionalmente lo a√±adimos a una categoria FTG (SSH_2222) # set category \u0026#34;Remote Access\u0026#34; # Indicamos los puertos que hace referencia al mismo FTG (SSH_2222) # set tcp-portrange 2222 # Guardamos y salimos del modo de confuguraci√≥n FTG (SSH_2222) # next FTG (custom) # end Te dejo un enlace a la documentaci√≥n oficial referente a los servicios donde explica con detalle todas las opciones de los mismos .\nIPs Virtuales Las IP Virtuales Est√°ticas (VIP) se utilizan para mapear direcciones IP externas a direcciones IP internas. Esto tambi√©n se llama DNAT, donde el destino de un paquete se est√° enviando a una direcci√≥n diferente.\nLas VIP est√°ticas se utilizan com√∫nmente para mapear direcciones IP p√∫blicas a recursos detr√°s del FortiGate que utilizan direcciones IP privadas. Una VIP est√°tica uno a uno es cuando se mapea todo el rango de puertos. Una VIP de reenv√≠o de puertos es cuando el mapeo se configura en un puerto espec√≠fico o rango de puertos.\nSi queremos listar las diferentes IPs virtuales que tenemos usaremos el siguiente comando , si solo queremos listar una en concreta indicaremos su nombre :\nFTG # show firewall vip config firewall vip edit \u0026#34;DNAT_POSTFIX\u0026#34; set uuid a343ec4a-e881-51ee-0ec1-ad73db3ff299 set service \u0026#34;SMTP\u0026#34; set extip 192.168.100.1 set mappedip \u0026#34;192.168.200.2\u0026#34; set extintf \u0026#34;port2\u0026#34; next edit \u0026#34;DNAT_SSH\u0026#34; set uuid a2b62344-e884-51ee-1a11-8946fda2bd91 set service \u0026#34;SSH_2222\u0026#34; set extip 192.168.122.77 set mappedip \u0026#34;192.168.100.2\u0026#34; set extintf \u0026#34;port1\u0026#34; set portforward enable set mappedport 22 next FTG # show firewall vip DNAT_HELA_WEB config firewall vip edit \u0026#34;DNAT_HELA_WEB\u0026#34; set uuid a417a8f8-edf6-51ee-f601-43829c174966 set service \u0026#34;HTTP\u0026#34; set extip 192.168.122.77 set mappedip \u0026#34;192.168.200.2\u0026#34; set extintf \u0026#34;port1\u0026#34; next end En el caso de que queramos eliminar una de estas IPs virtuales , seguiremos los siguientes pasos :\n# Accedemos al modo de configuraci√≥n FTG # config firewall vip # Borramos la IP virtual indicando su nombre FTG (vip) # delete DNAT_HELA_WEB # Salimos del modo de configuraci√≥n FTG (vip) # end Por otro lado para crear una de estas , como hemos realizado desde la GUI seguiremos los siguientes pasos :\n# Accedemos al modo de configuraci√≥n FTG # config firewall vip # Le asignamos el nombre que deseemos FTG (vip) # edit DNAT_HELA_WEB # Indicamos opcionalmente sobre el servicio que sera usado esta IP virtual FTG (DNAT_HELA_WEB) # set service \u0026#34;HTTP\u0026#34; # Indicamos la Ip externa FTG (DNAT_HELA_WEB) # set extip 192.168.122.77 # Indicamos la Ip interna FTG (DNAT_HELA_WEB) # set mappedip \u0026#34;192.168.200.2\u0026#34; # Indicamos la interfaz externa FTG (DNAT_HELA_WEB) # set extintf \u0026#34;port1\u0026#34; # Guardamos y salimos FTG (DNAT_HELA_WEB) # next FTG (vip) # end Las IP virtuales tienen mas par√°metros de configuraci√≥n que no he utilizado en la practica , te dejo un enlace a la documentaci√≥n oficial donde detalla toda la configuraci√≥n que podemos acceder con las mismas .\nRutas est√°ticas Nuestro dispositivo necesita conocer hacia donde enviar el trafico , para esto existen las rutas est√°ticas .\nPara listar las rutas que tiene configurado nuestro cortafuegos , usaremos el siguiente comando :\nFTG # show router static config router static edit 1 set gateway 192.168.122.1 set device \u0026#34;port1\u0026#34; next end Al igual que hemos hecho anteriormente , si queremos eliminar esta ruta por defecto seguiremos los siguientes pasos :\nFTG # config router static FTG (static) # delete 1 FTG (static) # end Si queremos a√±adir una ruta , puedes utilizar este ejemplo :\nFTG # config router static FTG (static) # edit 1 # El siguiete salto o puerta de enlace FTG (1) # set gateway 192.168.122.1 # La interfaz por donde saldra el trafico FTG (1) # set device \u0026#34;port1\u0026#34; FTG (1) # next FTG (static) # end ","date":"March 28, 2024","hero":"/images/cortafuegos/fortinet_cli.png","permalink":"https://www.javiercd.es/posts/cortafuegos/fortinet_cli/fortinet_cli/","summary":"\u003ch2 id=\"equivalencia-de-gui-a-cli\"\u003eEquivalencia de GUI a CLI\u003c/h2\u003e\n\u003cp\u003eInicialmente, empec√© la pr√°ctica utilizando la l√≠nea de comandos (CLI) sin embargo, encontr√© que resulta m√°s c√≥modo realizarla desde la interfaz gr√°fica. Por eso, decid√≠ establecer una equivalencia entre las diferentes acciones que he llevado a cabo durante la pr√°ctica y compararlas con su contraparte en la terminal.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nEn este post hago un peque√±o resumen de las equivalencias entre la GUI y la CLI de Fortinet que he utilizado en los 2 post de cortafuegos Fortinet.\u003c/p\u003e","tags":["FIREWALL","FORTINET"],"title":"Fortinet CLI"},{"categories":null,"contents":"Antes de comenzar la practica , el escenario que ves en la practica es lo mas parecido que puedo montar a la practica original . He utilizado la versi√≥n 7.0.9-1 de FortiGate , ya que las versiones superiores traen algunas restricciones . Puedes descargarte la imagen desde este link .\nPuesta en marcha del cortafuegos Los dispositivos FortiGate vienen configurados de fabrica con la IP 192.168.1.99/24 , como estoy desde GNS3 no es necesario que me conecte a esta interfaz con un dispositivo y cambie la configuraci√≥n . Ya que puedo hacerlo desde la consola .\nPor defecto a trav√©s de ese puerto esta habilitada la administraci√≥n por http , https , ssh y telnet .\nEn mi caso me conectare desde la consola , le cambiare el hostname y configurare el puerto 1 para que coja IP por DHCP .\nEl usuario por defecto es admin y la contrase√±a en blanco . Cuando iniciemos sesi√≥n por primera vez nos obligara a cambiarla :\nFortiGate-VM64-KVM login: admin Password: You are forced to change your password. Please input a new password. New Password: Confirm Password: Welcome! Lo primero que har√© sera cambiarle el hostname , como ves es similar a cisco ya que tenemos un modo de configuraci√≥n :\nFortiGate-VM64-KVM # conf sys global FortiGate-VM64-KVM (global) # set hostname FGT FortiGate-VM64-KVM (global) # end Ahora vamos a configurar el puerto 1 por DHCP para que as√≠ desde el cliente 2 lo pueda configurar sin tener que manualmente cambiar la IP del mismo . Ademas voy a configurar el acceso por http y https para poder configurarlo desde un navegador :\nFGT # show system interface port1 config system interface edit \u0026#34;port1\u0026#34; set vdom \u0026#34;root\u0026#34; set mode dhcp set allowaccess ping https ssh http fgfm set type physical set snmp-index 1 next end Ahora vamos a ver la IP que el DHCP le ha asignado con el siguiente comando :\nFGT # get system interface == [ port1 ] name: port1 mode: dhcp ip: 192.168.122.77 255.255.255.0 status: up netbios-forward: disable type: physical ring-rx: 0 ring-tx: 0 netflow-sampler: disable sflow-sampler: disable src-check: enable explicit-web-proxy: disable explicit-ftp-proxy: disable proxy-captive-portal: disable mtu-override: disable wccp: disable drop-overlapped-fragment: disable drop-fragment: disable Ahora desde cualquier maquina que tenga acceso a la red \u0026rsquo;externa\u0026rsquo; podremos conectarnos al FW :\nCuando te inicies sesi√≥n veras un panel con informaci√≥n general sobre el estado dispositivo :\nConfiguraci√≥n de la red LAN Como has visto en la imagen de la topolog√≠a, la red LAN est√° conectada al puerto 2. Por lo tanto, procederemos a configurarlo.\nVamos a dirigirnos a Network \u0026gt; Interfaces , selecciona el puerto 2 y pulsa en editar en la barra superior :\nUna vez dentro de la pantalla de configuraci√≥n de la interfaz, puedes personalizar el puerto asign√°ndole un alias. Adem√°s, para facilitar la gesti√≥n futura, le he asignado el rol LAN al puerto2, indicando que ser√° utilizado para una red local. Posteriormente, he configurado la direcci√≥n IP del mismo, asign√°ndole la 192.168.100.1/24. Adem√°s, he creado un objeto con esa IP, lo que facilitar√° la referencia a esta direcci√≥n IP en futuras configuraciones, eliminando la necesidad de recordar la IP .\nSigamos con la configuraci√≥n de la interfaz. Desde la red LAN, donde estaremos la mayor parte del tiempo, permitir√© el acceso v√≠a HTTPS y SSH para configurar el FortiGate. Tambi√©n dejar√© que respondan a los pings para asegurarme la conectividad con el mismo. Adem√°s, cada interfaz puede ser un servidor DHCP, as√≠ que le configurare uno para la LAN. Por √∫ltimo, activar√© la opci√≥n para detectar dispositivos, as√≠ tendr√© control sobre qui√©n se conecta a la red.\nUna vez configurado el acceso administrativo desde la LAN , voy a quitar el acceso administrativo desde la interfaz puerto 1 ya que esta seria Internet (WAN).\nAs√≠ que le cambiare el ROL a WAN y le quitare el acceso administrativo :\nSi recuerdas anteriormente marcamos en la interfaz LAN la casilla Device connection , si queremos ver los dispositivos conectados a esta red accedemos a Security Fabric \u0026gt; Asset Identify Center :\nPara apartados posteriores , como voy a realizar la practica de cortafuegos de nodo , es interesante crear un objeto con ese host . As√≠ no sera necesario que recuerde su IP :\nAunque no he mencionado nada anteriormente , la pol√≠tica por defecto de estos dispositivos es DROP en todas las direcciones :\nAhora vamos a crear una nueva pol√≠tica que permita el tr√°fico desde la LAN hacia Internet (WAN) en cualquier direcci√≥n. Esta pol√≠tica ser√≠a similar a las que tenemos en casa, donde podemos acceder a cualquier sitio web. Adem√°s, desde aqu√≠ podemos decir que haga SNAT, lo que nos permitir√° navegar acceder a Internet. Tambi√©n podremos configurar hacia qu√© interfaz se realizar√° este SNAT.\nPara acabar con la configuraci√≥n inicial , crearemos la ruta por defecto para salir a Internet . Para ello nos iremos a Network \u0026gt; Static Routes :\nUna vez aplicada esta pol√≠tica ya podremos comenzar a realizar la practica , ademas podemos acceder a Internet desde el cliente 1 :\nReglas del cortafuegos Para comenzar desactivare la pol√≠tica anterior , la editare y al final de esta le quitare el tic que la activa :\nQuedando as√≠ inactiva :\nLos equipos de la red local deben poder tener conexi√≥n al exterior. Para configurar el SNAT en dispositivos FortiGate , es un poco distinto ya que en cada regla que vayamos a permitir tendremos que marcar la casilla si queremos hacer NAT .\nAdemas podemos especificar todas las opciones posibles que se nos ocurra , en mi caso dejare este apartado sin activar y lo ir√© haciendo en las reglas siguientes . La imagen que ves a continuaci√≥n es para indicarte donde se activar√≠a . Ademas podemos indicar porque interfaz queremos que salga el trafico . Esto es √∫til si tenemos dos o mas salidas de Internet para hacer un balanceador de carga .\nUna vez aqu√≠ dentro de la configuraci√≥n de la interfaz le decimos que la interfaz es de tipo NAT , ademas podemos indicarle que no haga PAT .\nPermitimos hacer ping desde la LAN a la m√°quina cortafuegos. En estos dispositivos no seria una regla como tal , si no que esta opci√≥n en concreto se indica desde la opci√≥n de acceso administrativo de la interfaz :\nUna vez aplicado , si nos vamos al cliente 1 podremos hacerle ping al cortafuegos :\nPermite realizar conexiones ssh desde los equipos de la LAN Crearemos la regla que permite el trafico SSH , aqui en el origen podemos poner o el cliente1 (creamos el objeto en la preparaci√≥n del escenario) o directamente poner all en el origen :\nAunque actualmente en mi esquema solo tenga un cliente , ce√±iendome al enunciado si quiero que TODOS los cliente de la red LAN puedan hacer ssh en origen tengo que permitir todos :\nComo te explique en el apartado a de la practica , en este tipos de dispositivo tenemos que indicarle si queremos que la regla sea de tipo NAT para que haga SNAT o no .\nUna vez aplicada la regla podremos conectarnos por ssh desde el cliente1:\nVamos a asegurarnos de que la regla tiene hits :\nPermite la navegaci√≥n en la red LAN Para ello vamos a crear 2 reglas para la red LAN . Una que permita hacer consultas DNS y otra para permitir el trafico HTTPS y HTTP , ademas en ambas reglas sera necesario indicar que se haga NAT .\nComo te has fijado no he indicado el numero de puerto , si no que estos dispositivos tienen unos objetos llamados servicios en los cuales se almacenan los n√∫meros de puerto de los mismos . Podemos crear los objetos que queramos y personalizar los existentes seg√∫n nuestras necesidades .\nVamos a comprobar que podemos navegar en el cliente 1 :\nNi que decir tiene que por supuesto que podemos hacer un dig , con la regla actual lo podemos hacer a cualquier servidor DNS :\nVamos a comprobar que tenemos hits en las reglas :\nInstala un servidor de correos en la m√°quina de la LAN. Permite el acceso desde el exterior y desde el cortafuegos al servidor de correos. Para probarlo puedes ejecutar un telnet al puerto 25 tcp. Como actualmente tenemos permitido la navegaci√≥n solo por https es fundamental que los repositorios de la maquina est√©n configurados podremos instalar paquetes en nuestro cliente , asi que vamos a instalar postfix :\nsudo apt update \u0026amp;\u0026amp; sudo apt install postfix -y Ahora vamos a configurar la primera regla de DNAT que vamos a tener en el escenario . Para ello tendremos que crear una IP virtual y decirle cual es la IP externa (WAN) y la IP donde vamos a hacer el DNAT (LAN) .\nAhora vamos a a√±adir la regla en nuestra pol√≠tica , en el destino de la regla indicaremos la IP virtual que acabamos de crear y indicamos el servicio SMTP que tiene configurado el puerto 25 TCP :\nY vamos a comprobar que desde un cliente externo , como es Cliente 2 podemos acceder a Cliente 1 :\nVamos a comprobar que la regla que acabamos de crear tiene hits :\nPermite hacer conexiones ssh desde exterior a la LAN Para realizar esto volveremos a hacer un DNAT , tendremos que volver a crear una nueva IP virtual ya que anteriormente especifique que esa IP solo se utilizaba para el protocolo SMTP . As√≠ que voy a crear una nueva :\nUna vez creada la nueva IP virtual para el ssh , crearemos la regla de DNAT :\nVamos a probar nuestra nueva regla desde el cliente 2 :\nVamos a comprobar los hits de nuestra nueva regla :\nModifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22. Para realizar esto tendremos que generar un nuevo servicio que este en el puerto 2222 :\nAhora vamos a modificar nuestra IP virtual modificando el servicio por el nuevo que hemos creado con el puerto 2222 y haremos un port forwarding al puerto 22 :\nUna vez hecho esto podremos acceder por ssh utilizando el puerto 2222 y que nos redirija al 22 . No es necesario que modifiquemos las reglas , solo con esto ya podremos acceder :\nVamos a comprobar los hits de las reglas , ademas en el apartado de Virtual IP tambi√©n tenemos un contador de hits :\nPermite hacer consultas DNS desde la LAN s√≥lo al servidor 8.8.8.8. Comprueba que no puedes hacer un dig @1.1.1.1. Para esto vamos a modificar la regla que permite las consultas DNS y vamos a indicar que el destino solo sea 8.8.8.8 .\nPrimero necesitaremos crear un nuevo objeto con la IP del servidor DNS de Google :\nAhora modificamos la regla y pondremos este objeto como destino :\nVamos a comprobar la modificaci√≥n de la regla , para que solo podamos hacer consultas dns a 8.8.8.8 :\nPodemos comprobar que los hits han subido :\nPermite que los equipos de la LAN puedan navegar por internet, excepto a la p√°gina www.realbetisbalompie.es Estos cortafuegos de nueva generaci√≥n traen una serie de servicios que nos filtran en el nivel de aplicaci√≥n que nos permite detectar palabras clave para filtrar el contenido (drogas , pornograf√≠a , armas \u0026hellip; ) , en este cortafuegos el filtrar por palabras clave es un servicio de pago , hay que pagar una licencia . Ademas nos permite crear filtros para bloquear ciertas paginas web , que en este caso es gratuito.\nLo primero sera crear nuestra pol√≠tica de filtro_web :\nY a√±adimos en la misma un nuevo filtro por URL :\nAhora nos dirigimos a la regla que nos permite el trafico https y en seguridad le a√±adimos el filtro web que acabamos de crear :\nA la izquierda acceder√© desde el navegador de mi maquina f√≠sica y puedo acceder a la pagina del maligno , sin embargo si accedo desde el cliente 1 el firewall no nos deja acceder :\nSi accedemos a FortiView Destinations podremos ver las paginas que ha bloqueado nuestro filtro :\n","date":"March 28, 2024","hero":"/images/cortafuegos/fortinet1.png","permalink":"https://www.javiercd.es/posts/cortafuegos/fortinet_uno/fortinet_uno/","summary":"\u003cp\u003eAntes de comenzar la practica , el escenario que ves en la practica es lo mas parecido que puedo montar a la practica original . He utilizado la versi√≥n 7.0.9-1 de FortiGate , ya que las versiones superiores traen algunas restricciones .  Puedes descargarte la imagen desde este \u003ca href=\"https://drive.google.com/drive/folders/1VGmeLN5inkWoNNUsIvq9ewGUzJLTLkiM\" target=\"_blank\" rel=\"noopener\"\u003elink\u003c/a\u003e .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/cortafuegos/fortinet_uno/img/Pastedimage20240320223139.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"puesta-en-marcha-del-cortafuegos\"\u003ePuesta en marcha del cortafuegos\u003c/h2\u003e\n\u003cp\u003eLos dispositivos FortiGate vienen configurados de fabrica con la IP 192.168.1.99/24 , como estoy desde GNS3 no es necesario que me conecte a esta interfaz con un dispositivo y cambie la configuraci√≥n . Ya que puedo hacerlo desde la consola .\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","FORTINET"],"title":"Implementaci√≥n de un cortafuegos perimetral con Fortinet I"},{"categories":null,"contents":"Ahora vamos a emular la pr√°ctica de cortafuegos II, pero en GNS3. Para ello, he transformado al cliente 1 en Odin, adem√°s he a√±adido a Thor y Loki como m√°quinas virtuales en lugar de contenedores en la red LAN. Tambi√©n he creado una nueva red llamada DMZ, en la cual estar√° la m√°quina Hela.\nDado que he transformado el escenario anterior en este nuevo, contamos con algunas reglas creadas anteriormente. Por lo tanto, eliminar√© del enunciado aquellas que ya est√©n creadas, como la de hacer SSH a Odin desde el puerto 2222, pero con el servicio escuchando en el 22.\nAdem√°s, ahora vamos a hacer unas reservas DHCP para tener controladas las IP de las nuevas m√°quinas.\nAdemas como no cuento con los servicios montados en el antiguo escenario en Opsentack y para las reglas del enunciado montare lo m√≠nimo para hacer que funcionen las reglas .\nA lo largo de esta practica te explicare que por como esta montado la topologia de la red , todos de la red LAN pueden comunicarse entre sin necesidad de pasar por el cortafuegos . As√≠ que en algunos ejercicios omitir√© la parte de hacer que Loki y Thor se comuniquen con Odin. Ademas no voy a montar el servidor DNS ni LDAP ya que las reglas de DNAT son bastante sencillas y a lo largo de la practica aparecen varios ejercicios de hacer DNAT entre las distintas redes . En lugar de esto voy a a√±adir VPN al final de la misma ya que lo veo mas interesante que repetir las mismas reglas cambiando el servicio .\nPreparaci√≥n del escenario Lo primero que har√© sera crear una nueva red en el puerto 3 , que corresponde a la red DMZ .\nComo veras en la imagen a continuaci√≥n he seleccionado que el rol sea LAN , para que me permita tener un servidor DHCP en esa red . Como es una red en la que albergara los servicios no quiero que desde esta se pueda acceder a configurar el cortafuegos as√≠ que dejare la administraci√≥n desactivada .\nAhora ir√© accediendo a los nuevos clientes y les cambiare el nombre de maquina y configur√°ndolas por DHCP .\nMaquina Odin , esta era anteriormente la maquina cliente 1 , solo hay que cambiarle el FQDN y el hostname :\nosboxes@odin:~$ hostname -f odin.javiercd.gonzalonazareno.org osboxes@odin:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.100.2/24 brd 192.168.100.255 scope global dynamic noprefixroute ens3 valid_lft 604790sec preferred_lft 604790sec Maquina Thor :\ndebian@thor:~$ hostname -f thor.javiercd.gonzalonazareno.org debian@thor:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.100.4/24 brd 192.168.100.255 scope global dynamic ens3 valid_lft 604791sec preferred_lft 604791sec debian@thor:~$ Maquina Loki :\ndebian@loki:~$ hostname -f loki.javiercd.gonzalonazareno.org debian@loki:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.100.3/24 brd 192.168.100.255 scope global dynamic ens3 valid_lft 604724sec preferred_lft 604724sec Maquina Hela :\ndebian@hela:~$ hostname -f hela.javiercd.gonzalonazareno.org debian@hela:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.200.2/24 brd 192.168.200.255 scope global dynamic ens3 valid_lft 604795sec preferred_lft 604795sec Ahora vamos a hacer unas reservas en el servidor DHCP , accederemos a Dashborad \u0026gt; Networks \u0026gt; DHCP , una vez aqu√≠ le daremos clic derecho sobre cada cliente de los 4 que tenemos en el escenario y le crearemos una reserva :\nNos saldr√° un men√∫ similar a este para enlazar la direcci√≥n MAC a la IP :\nUna vez hagamos esto con nuestro clientes nos indicara que tenemos la reserva hecha :\nReglas del cortafuegos Vamos a comenzar a crear las reglas , como dije anteriormente partimos del escenario anterior , as√≠ que algunas reglas para el funcionamiento m√≠nimo de la red est√°n creadas .\nTe dejo una captura de como se quedaron las reglas , para que veas del estado en el que partimos :\nAlgunas de las siguiente reglas ya esta configurada del ejercicio anterior , como la siguiente regla \u0026ndash;\u0026gt; La m√°quina Odin tiene un servidor ssh escuchando por el puerto 22, pero al acceder desde el exterior habr√° que conectar al puerto 2222\njaviercruces@HPOMEN15:~$ ssh osboxes@192.168.122.77 -p 2222 osboxes@192.168.122.77\u0026#39;s password: Welcome to Ubuntu 22.04 LTS (GNU/Linux 5.15.0-25-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 560 updates can be applied immediately. 339 of these updates are standard security updates. To see these additional updates run: apt list --upgradable Last login: Fri Mar 29 11:23:44 2024 from 192.168.100.1 osboxes@odin:~$ hostname -f odin.javiercd.gonzalonazareno.org A continuaci√≥n veras que hay algunas reglas que he eliminado o modificado , ya que en el escenario actual no se pueden hacer , bien o por la topolog√≠a o porque anteriormente la maquina Odin era el cortafuegos . En cualquier caso alguna he mantenido y he explicado algunas cosas adicionales .\nDesde Thor y Hela se debe permitir la conexi√≥n ssh por el puerto 22 a la m√°quina Odin. Esta regla no la podemos realizar ya que al tener un switch de por medio interconectando los dispositivos , el trafico no pasara por el cortafuegos por lo que no podremos aplicar reglas en el cortafuego para impedir el trafico local .\nVeras que aunque cree la regla , en el cortafuegos esta no se inmutara :\nVes que por ejemplo si me conecto desde loki o desde thor puedo llegar a odin :\ndebian@loki:~$ ssh osboxes@192.168.100.2 osboxes@192.168.100.2\u0026#39;s password: Welcome to Ubuntu 22.04 LTS (GNU/Linux 5.15.0-25-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage 560 updates can be applied immediately. 339 of these updates are standard security updates. To see these additional updates run: apt list --upgradable Last login: Fri Mar 29 11:42:43 2024 from 192.168.100.3 osboxes@odin:~$ Pero no llego por la regla que he creado si no por la propia topologia de la red , la regla no tiene hits :\nTodo el trafico se encarga de redirigirlo el swicht .\nA la m√°quina Odin se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexi√≥n (REJECT) y desde el exterior se rechazar√° de manera silenciosa. Para permitir que desde la red DMZ podamos hacer ping hacia Odin crearemos la siguiente regla :\nVamos a comprobar que desde la DMZ podemos hacer el ping a Odin :\ndebian@hela:~$ ping 192.168.100.2 -c 1 PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data. 64 bytes from 192.168.100.2: icmp_seq=1 ttl=63 time=2.38 ms --- 192.168.100.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 2.379/2.379/2.379/0.000 ms Como vemos la regla esta funcionando , as√≠ que vamos a comprobar los hits :\nPor el mismo motivo que en el ejercicio anterior , desde la red LAN no podemos limitar el ping hacia Odin ya que no pasa por el cortafuegos si no por el switch .\nAlgo parecido nos pasara desde la WAN , al ser un ping dirigido a la IP de la interfaz este se desactiva desde la configuraci√≥n de la misma , siempre se rechaza de manera silenciosa pero no da opci√≥n a elegirlo :\nUna vez eliminado\njaviercruces@HPOMEN15:~$ ping 192.168.122.77 -c 1 PING 192.168.122.77 (192.168.122.77) 56(84) bytes of data. --- 192.168.122.77 ping statistics --- 1 packets transmitted, 0 received, 100% packet loss, time 0ms La m√°quina Odin puede hacer ping a la LAN, la DMZ y al exterior. La maquina Odin por la propia topologia puede hacerle ping a todas las maquinas de la LAN ya que el trafico hacia esta red pasa por el swicht .\nPara que pueda hacer ping hacia la DMZ y a la WAN vamos a crear dos reglas :\nLa regla para la WAN :\nLa regla para la DMZ :\n# LAN --\u0026gt; WAN osboxes@odin:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=114 time=10.1 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 10.088/10.088/10.088/0.000 ms # LAN --\u0026gt; DMZ osboxes@odin:~$ ping 192.168.200.2 -c 1 PING 192.168.200.2 (192.168.200.2) 56(84) bytes of data. 64 bytes from 192.168.200.2: icmp_seq=1 ttl=63 time=0.804 ms --- 192.168.200.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.804/0.804/0.804/0.000 ms # LAN --\u0026gt; LAN (No interviene el cortafuegos) osboxes@odin:~$ ping 192.168.100.3 -c 1 PING 192.168.100.3 (192.168.100.3) 56(84) bytes of data. 64 bytes from 192.168.100.3: icmp_seq=1 ttl=64 time=0.503 ms --- 192.168.100.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.503/0.503/0.503/0.000 ms Vamos a comprobar los hits de las dos reglas que acabamos de crear :\nDesde la m√°quina Hela se puede hacer ping y conexi√≥n ssh a las m√°quinas de la LAN. Para lograr esto creare la siguiente regla . Podr√≠amos separarla en 2 reglas independientes para tener los contadores por separado , pero en este caso no es importante distinguir el trafico .\nVamos a comprobar la regla , haciendo un ping a las distintas maquinas de la red LAN , ya que anteriormente hab√≠a una regla para permitir todos los pings hacia Odin :\n# HELA --\u0026gt; ODIN debian@hela:~$ ping 192.168.100.2 -c 1 PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data. 64 bytes from 192.168.100.2: icmp_seq=1 ttl=63 time=1.10 ms --- 192.168.100.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.101/1.101/1.101/0.000 ms # HELA --\u0026gt; LOKI debian@hela:~$ ping 192.168.100.3 -c 1 PING 192.168.100.3 (192.168.100.3) 56(84) bytes of data. 64 bytes from 192.168.100.3: icmp_seq=1 ttl=63 time=1.73 ms --- 192.168.100.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.730/1.730/1.730/0.000 ms # HELA --\u0026gt; THOR debian@hela:~$ ping 192.168.100.4 -c 1 PING 192.168.100.4 (192.168.100.4) 56(84) bytes of data. 64 bytes from 192.168.100.4: icmp_seq=1 ttl=63 time=0.998 ms --- 192.168.100.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.998/0.998/0.998/0.000 ms Ahora vamos a comprobar que podemos conectarnos por ssh desde Hela a la LAN :\ndebian@hela:~$ ssh osboxes@192.168.100.2 \u0026#39;hostname -f\u0026#39; osboxes@192.168.100.2\u0026#39;s password: odin.javiercd.gonzalonazareno.org debian@hela:~$ ssh 192.168.100.3 \u0026#39;hostname -f\u0026#39; debian@192.168.100.3\u0026#39;s password: loki.javiercd.gonzalonazareno.org debian@hela:~$ ssh 192.168.100.4 \u0026#39;hostname -f\u0026#39; debian@192.168.100.4\u0026#39;s password: thor.javiercd.gonzalonazareno.org La regla funciona correctamente , vamos a comprobar que ha subido los hits :\nDesde cualquier m√°quina de la LAN se puede conectar por ssh a la m√°quina Hela. Para ello vamos a crear la siguiente regla :\nAhora vamos a comprobar la regla que acabamos de crear :\nosboxes@odin:~$ ssh debian@192.168.200.2 \u0026#39;hostname -f\u0026#39; debian@192.168.200.2\u0026#39;s password: hela.javiercd.gonzalonazareno.org debian@loki:~$ ssh 192.168.200.2 \u0026#39;hostname -f\u0026#39; debian@192.168.200.2\u0026#39;s password: hela.javiercd.gonzalonazareno.org debian@thor:~$ ssh 192.168.200.2 \u0026#39;hostname -f\u0026#39; debian@192.168.200.2\u0026#39;s password: hela.javiercd.gonzalonazareno.org Vamos a comprobar que los hits de la regla han subido :\nConfigura la m√°quina Odin para que las m√°quinas de LAN y DMZ puedan acceder al exterior. El SNAT en este dispositivo podemos elegir activarlo por cada regla y no en general . Si te has fijado a lo largo de la practica en todas las reglas que implica dar un salto de interfaz he marcado la casilla NAT :\nPor lo que este apartado se va a ir realizando a lo largo de la practica conforme creemos las reglas .\nLas m√°quinas de la LAN pueden hacer ping al exterior y navegar. Vamos a tener que crear 3 reglas :\nPermitir el trafico HTTP/HTTPS Permitir las consultas DNS Permitir hacer ping De estas tres reglas las dos primeras est√°n creadas con anterioridad :\nPor lo que solo nos queda a√±adir la regla del ping , que seria la siguiente :\nComo tengo una versi√≥n de prueba puedo tener como m√°ximo 10 entradas , as√≠ que voy a eliminar la que solo deja hacer ping al exterior a Odin .\nVamos a comprobar las reglas , desde un cliente de la red LAN:\nosboxes@odin:~$ dig @8.8.8.8 www.javiercd.es ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.1-1ubuntu1-Ubuntu \u0026lt;\u0026lt;\u0026gt;\u0026gt; @8.8.8.8 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 25764 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.javiercd.es.\tIN\tA ;; ANSWER SECTION: www.javiercd.es.\t3600\tIN\tCNAME\tjavierasping.github.io. javierasping.github.io.\t3600\tIN\tA\t185.199.108.153 javierasping.github.io.\t3600\tIN\tA\t185.199.109.153 javierasping.github.io.\t3600\tIN\tA\t185.199.110.153 javierasping.github.io.\t3600\tIN\tA\t185.199.111.153 ;; Query time: 60 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP) ;; WHEN: Fri Mar 29 13:44:50 EDT 2024 ;; MSG SIZE rcvd: 144 osboxes@odin:~$ ping -c 1 www.javiercd.es PING javierasping.github.io (185.199.108.153) 56(84) bytes of data. 64 bytes from cdn-185-199-108-153.github.com (185.199.108.153): icmp_seq=1 ttl=55 time=11.1 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 11.111/11.111/11.111/0.000 ms osboxes@odin:~$ curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Mon, 11 Mar 2024 23:21:37 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65ef9201-6878\u0026#34; expires: Fri, 29 Mar 2024 17:56:01 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: AE88:3308D5:438AA74:448F970:6606FE58 accept-ranges: bytes date: Fri, 29 Mar 2024 17:46:01 GMT via: 1.1 varnish age: 0 x-served-by: cache-mad2200143-MAD x-cache: MISS x-cache-hits: 0 x-timer: S1711734362.862201,VS0,VE134 vary: Accept-Encoding x-fastly-request-id: 16b6048f2b032ef4b4293c52f0ae36d19b0e0da0 content-length: 26744 As√≠ quedar√≠an nuestras tres reglas , veremos que tenemos hits en las mismas :\nLa m√°quina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes a√∫n. Para realizar esto es necesario tener permitido el DNS y la navegaci√≥n . Para ello he creado la siguiente regla :\nLa he creado en una sola regla para ahorrar en el numero de las mismas , he borrado las que permit√≠a el ping desde DMZ a LAN de ejercicios anteriores .\ndebian@hela:~$ sudo apt install proftpd postfix apache2 -y Configura la m√°quina Odin para que los servicios web y ftp sean accesibles desde el exterior. Para hacer el DNAT deberemos de crear 2 IPs virtuales , como hicimos en cortafuegos I .\nUna para cada servicio que queramos hacer un DNAT . Para el servidor web :\nY para el servidor FTP :\nAhora vamos a crear la propia regla de DNAT para el servidor web , en la cual como destino indicamos la IP virtual que acabamos de crear :\nVeremos que si accedemos a la IP del cortafuegos de la WAN accederemos al apache de Hela :\nTambi√©n crearemos la regla DNAT para el servidor FTP :\nVamos a comprobar el acceso al servidor ftp :\njaviercruces@HPOMEN15:~$ ftp debian@192.168.122.77 Connected to 192.168.122.77. 220 ProFTPD Server (Debian) [::ffff:192.168.200.2] 331 Password required for debian Password: 230 User debian logged in Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; Si comprobamos los hits de las reglas veremos que en ambas ha subido :\nEl servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior. Para realizar este ejercicio deberemos de volver a generar las 2 IPs virtuales pero ahora indicaremos la IP de la tarjeta LAN del firewall .\nPara el DNAT del servidor web :\nRepetiremos lo mismo para el servicio FTP , cambiando el servicio :\nAhora crearemos las 2 reglas de DNAT para permitir el acceso desde la LAN .\nPara el servidor web :\nPara el servidor FTP:\nVamos a comprobar que podemos acceder a ambos servicios :\nosboxes@odin:~$ curl -I http://192.168.100.1 HTTP/1.1 200 OK Date: Fri, 29 Mar 2024 18:31:59 GMT Server: Apache/2.4.57 (Debian) Last-Modified: Fri, 29 Mar 2024 17:53:38 GMT ETag: \u0026#34;29cd-614d051d4d640\u0026#34; Accept-Ranges: bytes Content-Length: 10701 Vary: Accept-Encoding Content-Type: text/html osboxes@odin:~$ ftp debian@192.168.100.1 Connected to 192.168.100.1. 220 ProFTPD Server (Debian) [::ffff:192.168.200.2] 331 Password required for debian Password: 230 User debian logged in Remote system type is UNIX. Using binary mode to transfer files. Vamos a comprobar que han subido los hits en las reglas :\nEl servidor de correos s√≥lo debe ser accesible desde la LAN. Volvemos a repetir los mismos pasos , le crearemos una IP virtual para poder hacer la regla de DNAT :\nAhora vamos a crear la regla de DNAT :\nY comprobaremos que desde un PC de la LAN haciendo un telnet llegamos al servidor de correos :\nosboxes@odin:~$ telnet 192.168.100.1 25 Trying 192.168.100.1... Connected to 192.168.100.1. Escape character is \u0026#39;^]\u0026#39;. 220 hela.javiercd.gonzalonazareno.org ESMTP Postfix (Debian/GNU) quit 221 2.0.0 Bye Connection closed by foreign host. Veremos que el hit de la regla ha subido :\nEn la m√°quina Loki instala un servidor Postgres si no lo tiene a√∫n. A este servidor se puede acceder desde la DMZ, pero no desde el exterior. Volveremos a repetir el proceso de crear una nueva IP virtual para este servicio . Ademas en este caso he tenido que crear el servicio ya que no exist√≠a .\nVamos a crear la regla de DNAT :\nVamos a comprobar que tenemos acceso al servidor pgsql desde la red DMZ :\ndebian@hela:~$ psql -h 192.168.200.1 -U postgres -W Password: psql (15.6 (Debian 15.6-0+deb12u1)) SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off) Type \u0026#34;help\u0026#34; for help. postgres=# \\q Comprobaremos que la regla tiene hits :\nEvita ataques DoS por ICMP Flood, limitando a 4 el n√∫mero de peticiones por segundo desde una misma IP. Dentro del apartado de pol√≠ticas y objetos , encontramos un apartado para crear pol√≠ticas para DoS . En mi caso he creado una con los valores recomendados que da el fabricante . Y he cambiado el limite de ICMP Flood a 4 paquetes por segundo .\nVamos a comprobar que nos bloquea el trafico si excedemos ese limite . Con este comando estamos enviando 3 paquetes por segundo que es inferior al limite establecido asi que no cortara ning√∫n paquete :\ndebian@loki:~$ sudo hping3 --icmp -i u333333 -V 192.168.100.1 --- 192.168.100.1 hping statistic --- 124 packets transmitted, 124 packets received, 0% packet loss round-trip min/avg/max = 0.7/5.3/9.9 ms Si aumentamos los de paquetes por segundos , bloqueara todos los paquetes que superen a 4 por segundo , por eso deja pasar los 4 primeros de cada segundo :\ndebian@loki:~$ sudo hping3 --icmp -i u200000 -V 192.168.100.1 --- 192.168.100.1 hping statistic --- 44 packets transmitted, 10 packets received, 78% packet loss round-trip min/avg/max = 4.6/5.5/6.5 ms El cortafuegos ha registrado como una anomal√≠a el trafico que ha tirado :\nEvita ataques DoS por SYN Flood. Con el filtro que hemos activado en el ejercicio anterior tenemos limitada las peticiones TCP a 2000 por minuto desde la misma IP para evitar este tipo de ataque . Vemos que el filtro elimina las peticiones maliciosas y no deja que el ataque tenga efecto :\ndebian@loki:~$ sudo hping3 --flood --rand-source -V 192.168.100.1 using ens3, addr: 192.168.100.3, MTU: 1500 HPING 192.168.100.1 (ens3 192.168.100.1): NO FLAGS are set, 40 headers + 0 data bytes hping in flood mode, no replies will be shown ^C --- 192.168.100.1 hping statistic --- 930716 packets transmitted, 0 packets received, 100% packet loss round-trip min/avg/max = 0.0/0.0/0.0 ms Evita que realicen escaneos de puertos a Odin. En lugar de hacerlo a Odin por la propia topologia vamos a hacerlo para evitar escaneos desde la WAN .\nPara ello nos abrimos una terminal y lo que vamos a hacer es crear una firma de IPS para evitar los paquetes con una determinada bandera que usa un escaneo determinado . En este caso vamos a evitar el escaneo de NMAP XMAS .\nFTG # config ips custom FTG (custom) # edit \u0026#34;Block_xmas\u0026#34; new entry \u0026#39;Block_xmas\u0026#39; added FTG (Block_xmas) # set signature \u0026#34;F-SBID(--name \u0026#39;Block_xmas\u0026#39;; --protocol tcp; --flow from_client; --tcp_flags *FUP; )\u0026#34; FTG (Block_xmas) # set action block FTG (Block_xmas) # end Una vez configurado nos aparecera la regla que hemos creado en IPs signatures :\nAhora vamos a crear una regla IPS para asociarla con esta politica de firmas :\nA√±adiremos en IPS signatures and filters , el nuevo filtro que hemos creado anteriormente :\nA continuaci√≥n en las reglas de DNAT donde queramos controlar que no sepan que puertos tenemos abiertos , asignaremos la nueva pol√≠tica IPS :\nEn mi caso vamos a probarlo para la regla DNAT de ssh :\nSi lanzo el NMAP desde mi host que esta en la red WAN , vemos que el puerto 2222 que es el que esta regla tiene abierto no lo detecta :\njaviercruces@HPOMEN15:~$ sudo nmap -sX 192.168.122.77 Starting Nmap 7.93 ( https://nmap.org ) at 2024-03-30 19:05 CET Nmap scan report for 192.168.122.77 Host is up (0.00059s latency). All 1000 scanned ports on 192.168.122.77 are in ignored states. Not shown: 1000 open|filtered tcp ports (no-response) MAC Address: 0C:18:45:93:00:00 (Unknown) Nmap done: 1 IP address (1 host up) scanned in 21.28 seconds Y el propio cortafuegos nos avisara de que ha habido un escaneo de puertos que ha bloqueado , para ver esto dir√≠gete a Log \u0026amp; Report \u0026gt; Intrusion prevention :\nPodemos seleccionarlo para ver mas detalles del mismo :\n","date":"March 28, 2024","hero":"/images/cortafuegos/fortinet2.png","permalink":"https://www.javiercd.es/posts/cortafuegos/fortinet_dos/fortinet_dos/","summary":"\u003cp\u003eAhora vamos a emular la pr√°ctica de cortafuegos II, pero en GNS3. Para ello, he transformado al cliente 1 en Odin, adem√°s he a√±adido a Thor y Loki como m√°quinas virtuales en lugar de contenedores en la red LAN. Tambi√©n he creado una nueva red llamada DMZ, en la cual estar√° la m√°quina Hela.\u003c/p\u003e\n\u003cp\u003eDado que he transformado el escenario anterior en este nuevo, contamos con algunas reglas creadas anteriormente. Por lo tanto, eliminar√© del enunciado aquellas que ya est√©n creadas, como la de hacer SSH a Odin desde el puerto 2222, pero con el servicio escuchando en el 22.\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","FORTINET"],"title":"Implementaci√≥n de un cortafuegos perimetral con Fortinet II"},{"categories":null,"contents":"En este post sobre un escenario con maquinas Debian , aplicaremos reglas con Nftables para conrtrolar el trafico que entra y sale en nuestra red , intentando imitar un escenario.\n[!NOTE]\nPara desplegar el escenario para realizar estos ejercicios necesitaras desplegar el fichero .yaml que encontraras en el enlace del p√°rrafo siguiente . Este se encargara de desplegar 2 maquinas una que har√° de cortafuegos y otra que simulara un cliente que estar√° conectado a la primera maquina para simular una red local .\nRealiza con NFTABLES el ejercicio de la p√°gina https://fp.josedomingo.org/seguridadgs/u03/perimetral_iptables.html documentando las pruebas de funcionamiento realizadas.\nPreparaci√≥n del escenario Lo primero que haremos es activar el bit de forwarding. Para ello, editaremos el archivo /etc/sysctl.conf utilizando el siguiente comando :\njaviercruces@router-fw:~$ sudo nano /etc/sysctl.conf # Descomentamos la linea net.ipv4.ip_forward=1 A continuaci√≥n, aplicaremos los cambios utilizando el siguiente comando:\njaviercruces@router-fw:~$ sudo sysctl -p net.ipv4.ip_forward = 1 Ahora a√±adiremos la tabla filter :\njaviercruces@router-fw:~$ sudo nft add table inet filter Podemos ver las tablas creadas :\njaviercruces@router-fw:~$ sudo nft list tables table inet filter Crear las cadenas para la entrada y salida :\n# Cadena de \u0026#34;entrada\u0026#34; javiercruces@router-fw:~$ sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; } # Cadena de \u0026#34;salida\u0026#34; javiercruces@router-fw:~$ sudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; } # Cadena forward , peticiones que atraviesen : javiercruces@router-fw:~$ sudo nft add chain inet filter forward { type filter hook forward priority 0 \\; counter \\; policy drop \\; } Ahora comprobaremos que se han creado estas tres cadenas :\njaviercruces@router-fw:~$ sudo nft list chains table inet filter { chain input { type filter hook input priority filter; policy accept; } chain output { type filter hook output priority filter; policy accept; } chain forward { type filter hook forward priority filter; policy accept; } } Reglas del cortafuegos Permitir ssh hacia el cortafuegos Ahora vamos a permitir el ssh hacia la maquina router-fw :\njaviercruces@router-fw:~$ sudo nft add rule inet filter input iif ens3 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter output oif ens3 tcp sport 22 ct state established counter accept Pol√≠tica por defecto DROP Ahora vamos a poner la pol√≠tica por defecto DROP:\njaviercruces@router-fw:~$ sudo nft chain inet filter input { policy drop \\; } javiercruces@router-fw:~$ sudo nft chain inet filter output { policy drop \\; } javiercruces@router-fw:~$ sudo nft chain inet filter forward { policy drop \\; } Comprobaremos que con la nueva pol√≠tica podemos conectarnos por ssh y no hemos perdido la conexi√≥n , viendo que tenemos hits en las reglas .\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 174 bytes 11824 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 129 bytes 8252 accept } chain output { type filter hook output priority filter; policy drop; counter packets 169 bytes 31232 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 85 bytes 22632 accept } } SNAT Hacemos SNAT para que los equipos de la LAN puedan acceder al exterior.\nPara ello sera necesario que creemos la tabla NAT y sus cadenas . Como podemos observar hemos indicado menos prioridad en la cadena postrouting (mientras menor sea el n√∫mero, mayor es su prioridad) para que las reglas de dicha cadena se ejecuten despu√©s de las reglas de prerouting.\n# Creamos la tabla NAT javiercruces@router-fw:~$ sudo nft add table nat # Cadena para el DNAT javiercruces@router-fw:~$ sudo nft add chain nat prerouting { type nat hook prerouting priority 0 \\; } # Cadena para el SNAT javiercruces@router-fw:~$ sudo nft add chain nat postrouting { type nat hook postrouting priority 100 \\; } Ahora vamos a permitir hacer SNAT a la red LAN :\njaviercruces@router-fw:~$ sudo nft add rule ip nat postrouting oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter masquerade Permitimos el ssh desde el cortafuego a la LAN javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept Ahora que podemos conectarnos por ssh a nuestra maquina LAN , vamos a comprobar las 2 reglas anteriores . Conectarnos por ssh y el SNAT :\njaviercruces@router-fw:~$ ssh debian@192.168.100.10 Linux lan 6.1.0-12-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Feb 27 18:31:10 2024 from 192.168.100.2 debian@lan:~$ ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. ^C --- 1.1.1.1 ping statistics --- 2 packets transmitted, 0 received, 100% packet loss, time 1002ms Veremos que podemos conectarnos por ssh , sin embargo el ping no esta permitido pero lo he realizado para que la regla de SNAT tenga hits.\nVamos a ver que las reglas tienen hits :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 621 bytes 63636 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 493 bytes 41948 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 81 bytes 17628 accept } chain output { type filter hook output priority filter; policy drop; counter packets 1231 bytes 141120 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 349 bytes 68222 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 103 bytes 17420 accept } chain forward { type filter hook forward priority filter; policy drop; counter packets 4 bytes 336 } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 1 bytes 84 masquerade } } Como podemos ver el SNAT tiene hits , as√≠ que la regla esta funcionando , pero como no dejamos que atraviese el firewall estas no saldr√°n .\nPermitimos tr√°fico para la interfaz loopback A√±adimos las reglas , para permitir el trafico hacia la interfaz loopback :\njaviercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;lo\u0026#34; counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;lo\u0026#34; counter accept Comprobamos que tenemos conectividad :\njaviercruces@router-fw:~$ ping 127.0.0.1 PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.205 ms Vamos a ver los hits de la regla :\njaviercruces@router-fw:~$ sudo nft list ruleset | grep lo iifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept oifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept Peticiones y respuestas protocolo ICMP Vamos a permitir a la maquina router-fw aceptar peticiones ICMP y que envi√© la respuesta :\njaviercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter accept Le hago ping desde mi maquina :\njaviercruces@HPOMEN15:~/Documentos/2¬∫ASIR/SAD/cortafuegos1$ ping 172.22.201.120 -c 1 PING 172.22.201.120 (172.22.201.120) 56(84) bytes of data. 64 bytes from 172.22.201.120: icmp_seq=1 ttl=61 time=85.4 ms --- 172.22.201.120 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 85.403/85.403/85.403/0.000 ms Permitir hacer ping desde la LAN Vamos a permitir que se pueda hacer ping desde la LAN :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter accept Vamos a comprobarlo :\ndebian@lan:~$ ping 1.1.1.1 PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data. 64 bytes from 1.1.1.1: icmp_seq=1 ttl=50 time=40.8 ms 64 bytes from 1.1.1.1: icmp_seq=2 ttl=50 time=40.8 ms ^C --- 1.1.1.1 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 40.821/40.834/40.848/0.013 ms Vamos a ver los hits de la regla , ademas con esta podemos comprobar la regla del SNAT :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 2637 bytes 213636 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 2346 bytes 172928 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 225 bytes 32812 accept iifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept } chain output { type filter hook output priority filter; policy drop; counter packets 4656 bytes 697080 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 1618 bytes 477018 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 291 bytes 30252 accept oifname \u0026#34;lo\u0026#34; counter packets 2 bytes 168 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept } chain forward { type filter hook forward priority filter; policy drop; counter packets 31 bytes 2604 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter packets 12 bytes 1008 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter packets 2 bytes 168 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 4 bytes 336 masquerade } } Consultas y respuestas DNS desde la LAN javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter accept Vamos a hacer una consulta utilizando el comando host , ya que no dispongo otra herramienta instalada para hacer consultas dns :\ndebian@lan:~$ host www.javiercd.es www.javiercd.es is an alias for javierasping.github.io. javierasping.github.io has address 185.199.111.153 javierasping.github.io has address 185.199.108.153 javierasping.github.io has address 185.199.109.153 javierasping.github.io has address 185.199.110.153 javierasping.github.io has IPv6 address 2606:50c0:8000::153 javierasping.github.io has IPv6 address 2606:50c0:8001::153 javierasping.github.io has IPv6 address 2606:50c0:8003::153 javierasping.github.io has IPv6 address 2606:50c0:8002::153 Vamos a consultar los hits de las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 10 bytes 643 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 10 bytes 2644 accept Permitimos la navegaci√≥n web desde la LAN javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80,443} ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80,443} ct state established counter accept Para verificar este punto, necesitaremos modificar el archivo /etc/nsswitch.conf, el cual determina la prioridad de la resoluci√≥n DNS. Realizaremos esta modificaci√≥n para priorizar la consulta DNS al servicio de DNS de systemd, el cual est√° incluido en Debian y Ubuntu. Esto permitir√° que las consultas se realicen primero en la propia m√°quina y, en caso necesario, ser√°n enviadas al servidor DNS configurado ya que en este escenario las aplicaciones no nos resuelven si no realizamos esta modificaci√≥n .\ndebian@lan:~$ sudo nano /etc/nsswitch.conf hosts: files dns resolve [!UNAVAIL=return] Ademas cambiaremos el servidor dns de la maquina y en lugar de ser nosotros , pondremos el del instituto :\ndebian@lan:~$ sudo cat /etc/resolv.conf nameserver 172.22.0.1 Una vez aplicados los cambios vamos a pedir una web por el nombre de dominio , as√≠ comprobaremos el funcionamiento de los dos puntos anteriores . Pedir√© solo las cabeceras para que la salida sea mas legible , un c√≥digo 200 seria correcto . En la parte de http nos da una redirecci√≥n ya que el servidor te redirige a https :\ndebian@lan:~$ curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sun, 25 Feb 2024 23:03:49 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65dbc755-675b\u0026#34; expires: Wed, 28 Feb 2024 10:10:17 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: 5CD4:0E10:CBDBE5:CFBAEA:65DF0430 accept-ranges: bytes date: Wed, 28 Feb 2024 10:00:17 GMT via: 1.1 varnish age: 0 x-served-by: cache-mad2200123-MAD x-cache: MISS x-cache-hits: 0 x-timer: S1709114417.014922,VS0,VE167 vary: Accept-Encoding x-fastly-request-id: e15d291bbff90bf9de58991f0f6477e4398c415d content-length: 26459 debian@lan:~$ curl -I http://www.javiercd.es/ HTTP/1.1 301 Moved Permanently Content-Length: 162 Server: GitHub.com Content-Type: text/html Location: https://www.javiercd.es/ X-GitHub-Request-Id: 9870:0E7F:37400AD:3848DF5:65DF0425 Accept-Ranges: bytes Date: Wed, 28 Feb 2024 10:00:27 GMT Age: 21 X-Served-By: cache-mad2200100-MAD X-Cache: HIT X-Cache-Hits: 1 X-Timer: S1709114427.468002,VS0,VE1 Vary: Accept-Encoding X-Fastly-Request-ID: e321e34041a049f6f7c99e0693be994990da6da3 X-Cache: MISS from f0 X-Cache-Lookup: HIT from f0:3128 Via: 1.1 varnish, 1.1 f0 (squid/4.6) Connection: close Permitimos el acceso a nuestro servidor web de la LAN desde el exterior Como ya tenemos resoluci√≥n dns y navegaci√≥n web , podremos actualizar nuestros repositorios y instalar paquetes :\ndebian@lan:~$ sudo apt update -y \u0026amp;\u0026amp; sudo apt install apache2 -y Una vez instalado apache vamos a realizar la regla de DNAT :\njaviercruces@router-fw:~$ sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 80 counter dnat to 192.168.100.10 Ahora tenemos que permitir en la cadena forward el trafico para permitir el DNAT . Las peticiones al servidor web y las respuestas\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 80 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter accept Ahora vamos a comprobar que podemos acceder al servidor web :\njaviercruces@HPOMEN15:~/Documentos/2¬∫ASIR/SAD/cortafuegos1$ curl -I 172.22.201.120 HTTP/1.1 200 OK Date: Wed, 28 Feb 2024 10:24:26 GMT Server: Apache/2.4.57 (Debian) Last-Modified: Wed, 28 Feb 2024 10:17:20 GMT ETag: \u0026#34;29cd-6126e72b03120\u0026#34; Accept-Ranges: bytes Content-Length: 10701 Vary: Accept-Encoding Content-Type: text/html Desde un navegador :\nPor ultimo vamos a comprobar que las reglas involucradas tienen hits y te dejo el listado completo para que veas las reglas hasta este punto :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 20313 bytes 2212299 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 11896 bytes 827728 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 8093 bytes 1321072 accept iifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept } chain output { type filter hook output priority filter; policy drop; counter packets 69191 bytes 6011531 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 8461 bytes 1953220 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 9482 bytes 623484 accept oifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept } chain forward { type filter hook forward priority filter; policy drop; counter packets 42155 bytes 145465374 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter packets 32 bytes 2688 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter packets 18 bytes 1512 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 273 bytes 17860 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 273 bytes 52163 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80, 443 } ct state established,new counter packets 33973 bytes 1794576 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80, 443 } ct state established counter packets 7119 bytes 143533481 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 80 ct state established,new counter packets 47 bytes 3905 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter packets 32 bytes 24161 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; iifname \u0026#34;ens3\u0026#34; tcp dport 80 counter packets 4 bytes 240 dnat to 192.168.100.10 } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 547 bytes 38852 masquerade } } Ejercicios adicionales Debes a√±adir despu√©s las reglas necesarias para que se permitan las siguientes operaciones:\nPermite poder hacer conexiones ssh al exterior desde la m√°quina cortafuegos. javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter accept Vamos a conectarnos por ssh desde la maquina cortafuegos a otra para comprobar esto :\njaviercruces@router-fw:~$ ssh 172.22.200.47 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Feb 28 10:35:56 2024 from 172.22.201.120 javiercruces@odin:~$ Vamos a comprobar los hits en las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 66 bytes 18624 accept oifname \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 89 bytes 16572 accept Permite hacer consultas DNS desde la m√°quina cortafuegos s√≥lo al servidor 8.8.8.8. Comprueba que no puedes hacer un dig @1.1.1.1. Vamos a a√±adir esta regla :\njaviercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 8.8.8.8 udp dport 53 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 8.8.8.8 udp sport 53 ct state established counter accept Ahora vamos a comprobar que a traves de la 1.1.1.1 no podemos resolver nombres pero con la 8.8.8.8 si :\njaviercruces@router-fw:~$ dig @1.1.1.1 www.javiercd.es ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @1.1.1.1 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; no servers could be reached javiercruces@router-fw:~$ dig @8.8.8.8 www.javiercd.es ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @8.8.8.8 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 4046 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.javiercd.es.\tIN\tA ;; ANSWER SECTION: www.javiercd.es.\t3600\tIN\tCNAME\tjavierasping.github.io. javierasping.github.io.\t3600\tIN\tA\t185.199.108.153 javierasping.github.io.\t3600\tIN\tA\t185.199.109.153 javierasping.github.io.\t3600\tIN\tA\t185.199.110.153 javierasping.github.io.\t3600\tIN\tA\t185.199.111.153 ;; Query time: 68 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP) ;; WHEN: Wed Feb 28 11:09:05 UTC 2024 ;; MSG SIZE rcvd: 144 Vamos a ver los hits de las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens3\u0026#34; ip saddr 8.8.8.8 udp sport 53 ct state established counter packets 314 bytes 36448 accept oifname \u0026#34;ens3\u0026#34; ip daddr 8.8.8.8 udp dport 53 ct state established,new counter packets 314 bytes 21912 accept Permite que la m√°quina cortafuegos pueda navegar por https. Vamos a a√±adir la regla :\njaviercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp dport 443 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp sport 443 ct state established counter accept Vamos a comprobar que pidiendo las cabeceras , que es similar a navegar podemos ver un c√≥digo 200 en https :\njaviercruces@router-fw:~$ curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sun, 25 Feb 2024 23:03:49 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65dbc755-675b\u0026#34; expires: Wed, 28 Feb 2024 10:10:17 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: 5CD4:0E10:CBDBE5:CFBAEA:65DF0430 accept-ranges: bytes date: Wed, 28 Feb 2024 11:10:32 GMT via: 1.1 varnish age: 0 x-served-by: cache-mad22033-MAD x-cache: HIT x-cache-hits: 1 x-timer: S1709118632.338441,VS0,VE131 vary: Accept-Encoding x-fastly-request-id: 01056938385ca0e465882fa75fd0b19d0973df62 content-length: 26459 Los equipos de la red local deben poder tener conexi√≥n al exterior. SNAT realizado anteriormente\nPermitimos el ssh desde el cortafuegos a la LAN Permitido por regla anterior\nPermitimos hacer ping desde la LAN a la m√°quina cortafuegos. javiercruces@router-fw:~$ sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; icmp type echo-request counter accept Realizamos el ping desde LAN al cortafuegos\ndebian@lan:~$ ping 192.168.100.2 PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data. 64 bytes from 192.168.100.2: icmp_seq=1 ttl=64 time=1.09 ms 64 bytes from 192.168.100.2: icmp_seq=2 ttl=64 time=1.75 ms ^C --- 192.168.100.2 ping statistics --- 2 packets transmitted, 2 received, 0% packet loss, time 1002ms rtt min/avg/max/mdev = 1.091/1.419/1.748/0.328 ms Veremos los hits para esta regla en concreto :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens4\u0026#34; icmp type echo-request counter packets 2 bytes 168 accept oifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter packets 2 bytes 168 accept Permite realizar conexiones ssh desde los equipos de la LAN Vamos a hacer las reglas :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter accept Vamos a conectarnos por ssh a una maquina fuera de la lan :\ndebian@lan:~$ ssh javiercruces@172.22.200.47 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Feb 28 10:36:26 2024 from 172.22.201.120 javiercruces@odin:~$ Vamos a ver los hits de estas reglas :\njaviercruces@router-fw:~$ sudo nft -a list table inet filter iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 10 bytes 3312 accept # handle 44 iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 7 bytes 3088 accept # handle 45 Instala un servidor de correos en la m√°quina de la LAN. Permite el acceso desde el exterior y desde el cortafuegos al servidor de correos. Para probarlo puedes ejecutar un telnet al puerto 25 tcp. Con estas reglas permitimos conectarnos desde fuera de la red al servidor de correos :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 25 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 25 ct state established counter accept # Regla DNAT puerto 25 javiercruces@router-fw:~$ sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 25 counter dnat to 192.168.100.10 Vamos a comprobarlo :\njaviercruces@HPOMEN15:~/Documentos/2¬∫ASIR/SAD/cortafuegos1$ telnet 172.22.201.120 25 Trying 172.22.201.120... Connected to 172.22.201.120. Escape character is \u0026#39;^]\u0026#39;. 220 lan.openstacklocal ESMTP Postfix (Debian/GNU) Connection closed by foreign host. Vamos a ver los hits en las reglas :\njaviercruces@router-fw:~$ sudo nft list ruleset # Reglas para permitir el trafico iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 25 ct state established,new counter packets 10 bytes 544 accept # handle 46 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 25 ct state established counter packets 9 bytes 613 accept # Regla DNAT iifname \u0026#34;ens3\u0026#34; tcp dport 25 counter packets 1 bytes 60 dnat to 192.168.100.10 Permite hacer conexiones ssh desde exterior a la LAN Para ello voy a hacer un DNAT al puerto 2222 y a permitir ese trafico\n# Reglas para permitir el trafico del DNAT javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 2222 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 2222 ct state established counter accept # Regla DNAT puerto 2222 para ssh sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter dnat to 192.168.100.10 He cambiado el puerto del servicio ssh de lan al 2222 , voy a conectarme desde fuera a la LAN por ssh :\njaviercruces@HPOMEN15:~/Documentos/2¬∫ASIR/SAD/cortafuegos1$ ssh -p 2222 debian@172.22.201.120 Linux lan 6.1.0-12-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.52-1 (2023-09-07) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Wed Feb 28 14:12:18 2024 from 192.168.100.2 debian@lan:~$ Vamos a comprobar los hits de las reglas :\n# Reglas para permitir el ssh 2222 desde fuera hacia la LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 2222 ct state established,new counter packets 54 bytes 9784 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 2222 ct state established counter packets 44 bytes 10494 accept # Regla DNAT iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter packets 5 bytes 300 dnat to 192.168.100.10 Modifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22. Para esto vamos a eliminar las 3 reglas anteriores y a√±adiremos las siguientes :\n# Permitimos el trafico que ahora \u0026#34;cambiamos\u0026#34; el puerto con la regla DNAT de 2222 a 22 javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept javiercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept # Regla DNAT javiercruces@router-fw:~$ sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter dnat to 192.168.100.10 Ahora vamos a comprobar que podemos conectarnos desde el exterior a la LAN aunque ahora hemos cambiado el servidor ssh de LAN para que escuche en el puerto 22 :\njaviercruces@router-fw:~$ sudo nft list ruleset iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 34 bytes 7868 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 32 bytes 9066 accept iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter packets 7 bytes 420 dnat to 192.168.100.10:22 Permite hacer consultas DNS desde la LAN s√≥lo al servidor 8.8.8.8. Comprueba que no puedes hacer un dig @1.1.1.1. Vamos a borrar la regla anterior que permite las consultas DNS :\njaviercruces@router-fw:~$ sudo nft -a list table inet filter iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 285 bytes 17036 accept # handle 35 javiercruces@router-fw:~$ sudo nft delete rule inet filter forward handle 35 A√±adimos la regla nueva para permitir solo consultas al 8.8.8.8 :\njaviercruces@router-fw:~$ sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ip daddr 8.8.8.8 counter accept Vamos a comprobarlo :\ndebian@lan:~$ dig @1.1.1.1 www.javiercd.es ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ;; communications error to 1.1.1.1#53: timed out ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @1.1.1.1 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; no servers could be reached debian@lan:~$ dig @8.8.8.8 www.javiercd.es ; \u0026lt;\u0026lt;\u0026gt;\u0026gt; DiG 9.18.24-1-Debian \u0026lt;\u0026lt;\u0026gt;\u0026gt; @8.8.8.8 www.javiercd.es ; (1 server found) ;; global options: +cmd ;; Got answer: ;; -\u0026gt;\u0026gt;HEADER\u0026lt;\u0026lt;- opcode: QUERY, status: NOERROR, id: 59302 ;; flags: qr rd ra; QUERY: 1, ANSWER: 5, AUTHORITY: 0, ADDITIONAL: 1 ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 512 ;; QUESTION SECTION: ;www.javiercd.es.\tIN\tA ;; ANSWER SECTION: www.javiercd.es.\t3600\tIN\tCNAME\tjavierasping.github.io. javierasping.github.io.\t3600\tIN\tA\t185.199.108.153 javierasping.github.io.\t3600\tIN\tA\t185.199.109.153 javierasping.github.io.\t3600\tIN\tA\t185.199.110.153 javierasping.github.io.\t3600\tIN\tA\t185.199.111.153 ;; Query time: 72 msec ;; SERVER: 8.8.8.8#53(8.8.8.8) (UDP) ;; WHEN: Wed Feb 28 14:44:29 UTC 2024 ;; MSG SIZE rcvd: 144 Vamos a ver los hits de las reglas :\njaviercruces@router-fw:~$ sudo nft -a list table inet filter iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ip daddr 8.8.8.8 counter packets 3 bytes 218 accept # handle 53 Permite que los equipos de la LAN puedan navegar por internet, excepto a la p√°gina www.realbetisbalompie.es Tenemos un problema y es que nftables solo filtra hasta el nivel de transporte , es decir por puerto . As√≠ que no podemos leer el dominio ya que este viaja en una cabecera del nivel de aplicaci√≥n .\nPara prohibirlo , tendremos que bloquear esa IP en su totalidad para un determinado puerto , en mi caso van a ser el 80 y 443.\nVamos a averiguar las IPS del dominio que queremos bloquear :\njaviercruces@router-fw:~$ dig +short www.realbetisbalompie.es realbetisbalompie.es. 51.255.76.196 La a√±adiremos al principio de la cadena en lugar de add a√±adimos la palabra insert :\njaviercruces@router-fw:~$ sudo nft insert rule inet filter forward ip daddr 51.255.76.196 tcp dport {80, 443} iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; counter drop Y ahora no podremos navegar en la pagina del maligno :\ndebian@lan:~$ curl -I https://www.realbetisbalompie.es/ curl: (28) Failed to connect to www.realbetisbalompie.es port 443 after 129885 ms: Couldn\u0026#39;t connect to server Vamos a ver los hits de la regla que nos protege del mal :\njaviercruces@router-fw:~$ sudo nft list ruleset ip daddr 51.255.76.196 tcp dport { 80, 443 } iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; counter packets 7 bytes 420 drop Hacer las reglas persistentes Vamos a guardar las reglas con :\nrott@router-fw:/home/javiercruces# nft list ruleset \u0026gt; /etc/nftables.conf Si las queremos restaurar :\njaviercruces@router-fw:~$ sudo nft -f /etc/nftables.conf Para hacer que al reiniciar las reglas se restauren solas :\n# Creamos la unidad de systemd javiercruces@router-fw:~$ sudo cat /etc/systemd/system/nftables-persistent.service [Unit] Description=Cargar reglas de nftables al iniciar el sistema [Service] Type=oneshot ExecStart=/usr/sbin/nft -f /etc/nftables/nftables.rules [Install] WantedBy=multi-user.target # Activa el servicio para que al reiniciar se apliquen los cambios javiercruces@router-fw:~$ sudo systemctl enable nftables-persistent.service Reglas al final del ejercicio Te dejo la lista de las reglas en el estado del ultimo ejercicio :\njaviercruces@router-fw:~$ sudo nft list ruleset table inet filter { chain input { type filter hook input priority filter; policy drop; counter packets 34414 bytes 6500685 iif \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 21235 bytes 1526616 accept iifname \u0026#34;ens4\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 11648 bytes 1793088 accept iifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept iifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept iifname \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 66 bytes 18624 accept iifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp sport 443 ct state established counter packets 519 bytes 3016033 accept iifname \u0026#34;ens3\u0026#34; ip saddr 8.8.8.8 udp sport 53 ct state established counter packets 557 bytes 68077 accept iifname \u0026#34;ens4\u0026#34; icmp type echo-request counter packets 2 bytes 168 accept } chain output { type filter hook output priority filter; policy drop; counter packets 86303 bytes 8331992 oif \u0026#34;ens3\u0026#34; tcp sport 22 ct state established counter packets 15004 bytes 3534878 accept oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 14125 bytes 950568 accept oifname \u0026#34;lo\u0026#34; counter packets 92 bytes 17660 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept oifname \u0026#34;ens3\u0026#34; tcp dport 22 ct state established,new counter packets 89 bytes 16572 accept oifname \u0026#34;ens3\u0026#34; ip daddr 8.8.8.8 udp dport 53 ct state established,new counter packets 557 bytes 36254 accept oifname \u0026#34;ens3\u0026#34; ip protocol tcp tcp dport 443 ct state established,new counter packets 367 bytes 25011 accept oifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter packets 2 bytes 168 accept } chain forward { type filter hook forward priority filter; policy drop; ip daddr 51.255.76.196 tcp dport { 80, 443 } iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; counter packets 7 bytes 420 drop counter packets 45573 bytes 149083811 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 icmp type echo-request counter packets 32 bytes 2688 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 icmp type echo-reply counter packets 18 bytes 1512 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 664 bytes 101857 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80, 443 } ct state established,new counter packets 34813 bytes 1843071 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80, 443 } ct state established counter packets 7583 bytes 146852066 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 80 ct state established,new counter packets 47 bytes 3905 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter packets 32 bytes 24161 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip protocol tcp ip saddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 72 bytes 18540 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol tcp ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 56 bytes 17296 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 25 ct state established,new counter packets 10 bytes 544 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 25 ct state established counter packets 9 bytes 613 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip daddr 192.168.100.0/24 tcp dport 22 ct state established,new counter packets 90 bytes 17200 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter packets 77 bytes 19296 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 udp dport 53 ip daddr 8.8.8.8 counter packets 81 bytes 5250 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; iifname \u0026#34;ens3\u0026#34; tcp dport 80 counter packets 4 bytes 240 dnat to 192.168.100.10 iifname \u0026#34;ens3\u0026#34; tcp dport 25 counter packets 1 bytes 60 dnat to 192.168.100.10 iifname \u0026#34;ens3\u0026#34; tcp dport 2222 counter packets 8 bytes 480 dnat to 192.168.100.10:22 } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.100.0/24 counter packets 916 bytes 61536 masquerade } } ","date":"March 28, 2024","hero":"/images/cortafuegos/nftables1.png","permalink":"https://www.javiercd.es/posts/cortafuegos/nftables_uno/cortafuegos_uno/","summary":"\u003cp\u003eEn este post sobre un escenario con maquinas Debian , aplicaremos reglas con Nftables para conrtrolar el trafico que entra y sale en nuestra red , intentando imitar un escenario.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nPara desplegar el escenario para realizar estos ejercicios necesitaras desplegar el fichero .yaml que encontraras en el enlace del p√°rrafo siguiente . Este se encargara de desplegar 2 maquinas una que har√° de cortafuegos y otra que simulara un cliente que estar√° conectado a la primera maquina para simular una red local .\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","NFTABLES"],"title":"Implementaci√≥n de un cortafuegos perimetral con Nftables I"},{"categories":null,"contents":"Sobre el escenario creado en el m√≥dulo de servicios con las m√°quinas Odin (Router), Hela (DMZ), Loki y Thor (LAN) y empleando nftables, configura un cortafuegos perimetral en la m√°quina Odin de forma que el escenario siga funcionando completamente teniendo en cuenta los siguientes puntos:\n‚Ä¢ Se valorar√° la creaci√≥n de cadenas diferentes para cada flujo de tr√°fico (de LAN al exterior, de LAN a DMZ, etc‚Ä¶). ‚Ä¢ Pol√≠tica por defecto DROP para todas las cadenas. ‚Ä¢ Se pueden usar las extensiones que creamos adecuadas, pero al menos debe implementarse seguimiento de la conexi√≥n cuando sea necesario. ‚Ä¢ Debemos implementar que el cortafuegos funcione despu√©s de un reinicio de la m√°quina. ‚Ä¢ Debes mostrar pruebas de funcionamiento de todas las reglas. Para no hacer demasiado larga la practica , voy a mostrarte los hits de las reglas al final , as√≠ como el script completo de las reglas . Ya que solo te pondr√© en cada ejercicio las reglas que intervienen y una comprobaci√≥n del mismo .\nMontar el escenario con Nftables Voy a eliminar iptables y vamos a pasar a Nftables para que no perdamos ninguna funcionalidad del escenario .\nLo primero sera crear las tablas y cadenas :\njaviercruces@odin:~$ sudo nft add table inet filter javiercruces@odin:~$ sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; } javiercruces@odin:~$ sudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; } javiercruces@odin:~$ sudo nft add chain inet filter WAN_LAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter WAN_DMZ { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter LAN_WAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter LAN_DMZ { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter DMZ_LAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} javiercruces@odin:~$ sudo nft add chain inet filter DMZ_WAN { type filter hook forward priority 0\\; counter \\; policy accept \\;} As√≠ quedar√≠an nuestras cadenas creadas :\njaviercruces@odin:~$ sudo nft list chains table inet filter { chain input { type filter hook input priority filter; policy accept; } chain output { type filter hook output priority filter; policy accept; } chain WAN_LAN { type filter hook forward priority filter; policy accept; } chain WAN_DMZ { type filter hook forward priority filter; policy accept; } chain LAN_WAN { type filter hook forward priority filter; policy accept; } chain DMZ_LAN { type filter hook forward priority filter; policy accept; } chain LAN_DMZ { type filter hook forward priority filter; policy accept; } chain DMZ_WAN { type filter hook forward priority filter; policy accept; } } La red LAN corresponde a la red de los contenedores 192.168.0.0/24 . La red DMZ corresponde a la red de hela 172.16.0.0/16 .\nContinuamos creando la tabla de NAT para poder configurar el SNAT y el DNAT , estas ya que suelen ser un numero reducido de reglas no voy a crear distintas cadenas :\n# Creamos la tabla NAT javiercruces@odin:~$ sudo nft add table nat # Cadena para el DNAT javiercruces@odin:~$ sudo nft add chain nat prerouting { type nat hook prerouting priority 0 \\; } # Cadena para el SNAT javiercruces@odin:~$ sudo nft add chain nat postrouting { type nat hook postrouting priority 100 \\; } Reglas SNAT Una vez hecho esto voy a crear las reglas de SNAT para que nuestros clientes puedan salir a Internet en la red LAN y DMZ :\nMi tarjeta de red que esta de cara al exterior es la ens4 .\n# Regla SNAT para LAN sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter masquerade # Regla SNAT para DMZ sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; iffname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 counter masquerade sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter snat to 172.22.200.47 sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter snat to 172.22.200.47 Vamos a comprobar que en los clientes ya pueden acceder a Internet , actualmente la pol√≠tica por defecto es ACCEPT.\nComprobaci√≥n de SNAT en Hela :\n[javiercruces@hela ~]$ ping www.javiercd.es -c 1 PING javierasping.github.io (185.199.109.153) 56(84) bytes of data. 64 bytes from cdn-185-199-109-153.github.com (185.199.109.153): icmp_seq=1 ttl=51 time=39.4 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 39.439/39.439/39.439/0.000 ms Comprobaci√≥n de SNAT en Thor :\njaviercruces@thor:~$ ping www.javiercd.es -c 1 PING javierasping.github.io (185.199.108.153) 56(84) bytes of data. 64 bytes from cdn-185-199-108-153.github.com (185.199.108.153): icmp_seq=1 ttl=51 time=38.1 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 38.138/38.138/38.138/0.000 ms Comprobaci√≥n de SNAT en Loki :\njaviercruces@loki:~$ ping www.javiercd.es -c 1 PING javierasping.github.io (185.199.111.153) 56(84) bytes of data. 64 bytes from cdn-185-199-111-153.github.com (185.199.111.153): icmp_seq=1 ttl=51 time=37.7 ms --- javierasping.github.io ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.667/37.667/37.667/0.000 ms Por ultimo nos aseguraremos de que la regla recibe hits :\njaviercruces@odin:~$ sudo nft list ruleset # Salida del comando recortada chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter packets 11 bytes 868 masquerade oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter packets 122 bytes 10594 masquerade } } Reglas de DNAT Las reglas anteriores que ten√≠amos eran las siguientes :\njaviercruces@odin:~$ sudo iptables -L -t nat Chain PREROUTING (policy ACCEPT) target prot opt source destination DNAT tcp -- anywhere anywhere tcp dpt:http to:172.16.0.200 DNAT udp -- anywhere anywhere udp dpt:domain to:192.168.0.2 DNAT tcp -- anywhere anywhere tcp dpt:smtp to:192.168.0.3 DNAT tcp -- anywhere anywhere tcp dpt:mysql to:192.168.0.3 As√≠ que vamos a pasarlas a nftables :\n# Para un wordpress que hay en hela sudo nft add rule ip nat prerouting tcp dport 80 counter dnat to 172.16.0.200 # Para hacer consultas DNS a thor sudo nft add rule ip nat prerouting udp dport 53 counter dnat to 192.168.0.2 # Para poder recibir correos en loki sudo nft add rule ip nat prerouting tcp dport 25 counter dnat to 192.168.0.3 # Para acceder desde fuera a un mysql que hay en loki sudo nft add rule ip nat prerouting tcp dport 3306 counter dnat to 192.168.0.3 Ahora vamos a a√±adir una series de reglas para permitir el trafico anterior y el resto de la preparacion del escenario :\n# PERMITIR USO DE ODIN ## Permitir consultas DNS de odin a thor (DNSSERVER) sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir tr√°fico HTTP y HTTPS en odin sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp sport { 80,443 } ct state established counter accept # Permitir conexiones SSH por el puerto 2222 sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Permitir conexiones SSH de odin a hela sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter accept # Permitir conexiones ssh de odin a thor y loki sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter accept # Reglas perimetrales ## Permitir consultas DNS desde br-intra hacia ens4 , necesario para el forward del dns (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir consultas dns desde LAN a DMZ (hela --\u0026gt; thor) (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept ## Reglas para permitir trafico a wordpress en hela sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept # Regla para hacer consultas DNS a thor (Permitir DNAT) sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 udp dport 53 ct state new,established counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.2 udp sport 53 ct state established,related counter accept # Regla para recibir e enviar correos en loki sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state new,established counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept # Permitir a hela usar el servidor LDAP sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp dport 389 counter accept sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport 389 counter accept Ejercicios El cortafuegos debe cumplir al menos estas reglas:\nLa m√°quina Odin tiene un servidor ssh escuchando por el puerto 22, pero al acceder desde el exterior habr√° que conectar al puerto 2222. Para realizar este ejercicio voy a hacer un DNAT a la interfaz de DMZ de odin que es la 192.168.0.1 , asi me conectare a esa interfaz por ssh . Posteriomente hay que permitir este trafico que va desde la ens4 a la ens3 .\n# Permitimos el trafico que ahora \u0026#34;cambiamos\u0026#34; el puerto con la regla DNAT de 2222 a 22 hacia odin sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Regla DNAT sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 Pondr√© la pol√≠tica por defecto DROP una vez llegado a este punto :\nsudo nft chain inet filter input { policy drop \\; } sudo nft chain inet filter output { policy drop \\; } sudo nft chain inet filter WAN_LAN { policy drop \\; } sudo nft chain inet filter WAN_DMZ { policy drop \\; } sudo nft chain inet filter LAN_WAN { policy drop \\; } sudo nft chain inet filter DMZ_LAN { policy drop \\; } sudo nft chain inet filter LAN_DMZ { policy drop \\; } sudo nft chain inet filter DMZ_WAN { policy drop \\; } Y vamos a comprobar que la conexi√≥n funciona por el puerto 2222 :\njaviercruces@HPOMEN15:~$ ssh 172.22.200.47 -p 2222 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Mar 9 13:49:09 2024 from 172.29.0.58 javiercruces@odin:~$ Comprobamos los hits en las reglas :\njaviercruces@odin:~$ sudo nft list ruleset # IMPUT iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state established,new counter packets 241918 bytes 13788652 accept #OUTPUT oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter packets 355383 bytes 210012030 accept #DNAT iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter packets 5 bytes 300 dnat to 192.168.0.1:22 Desde Thor y Hela se debe permitir la conexi√≥n ssh por el puerto 22 a la m√°quina Odin. Para poder comprobar estas reglas voy a permitir las conexiones ssh desde Odin a ambas redes DMZ y LAN\n# Permitir conexiones ssh de odin a hela sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter accept # Permitir conexiones ssh de odin a thor y loki sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter accept # Permitir conexion ssh desde hela a odin sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.200 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 ct state established counter accept # Permitir conexion ssh desde thor a odin sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.2 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 tcp sport 22 ct state established counter accept Vamos a comprobar las 2 reglas anteriores conect√°ndonos a Odin por ssh desde estos dos clientes :\n#Hela --\u0026gt; Odin javiercruces@odin:~$ ssh 172.16.0.200 -A Last login: Sat Mar 9 19:02:49 2024 from 172.16.0.1 [javiercruces@hela ~]$ ssh 172.16.0.1 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Mar 9 19:49:28 2024 from 192.168.0.2 javiercruces@odin:~$ # Thor --\u0026gt; Odin javiercruces@thor:~$ ssh 192.168.0.1 Linux odin.javiercd.gonzalonazareno.org 6.1.0-18-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.76-1 (2024-02-01) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sat Mar 9 19:46:12 2024 from 192.168.0.2 javiercruces@odin:~$ Te dejare los hits de las reglas al final de la practica .\nLa m√°quina Odin debe tener permitido el tr√°fico para la interfaz loopback. sudo nft add rule inet filter input iifname \u0026#34;lo\u0026#34; counter accept sudo nft add rule inet filter output oifname \u0026#34;lo\u0026#34; counter accept Comprobaci√≥n :\njaviercruces@odin:~$ ping 127.0.0.1 -c 1 PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data. 64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.100 ms --- 127.0.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.100/0.100/0.100/0.000 ms A la m√°quina Odin se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexi√≥n (REJECT) y desde el exterior se rechazar√° de manera silenciosa. # DMZ sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-reply counter accept # Las siguientes 2 reglas , no funcionaran como esperamos ya que hacen lo mismo que la politica por defecto , ademas no se permite este trafico . # LAN sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip protocol icmp counter reject # Exterior sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol icmp counter drop Vamos a comprobar estas reglas :\n# LAN Thor a odin javiercruces@thor:~$ ping 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. From 192.168.0.1 icmp_seq=1 Destination Port Unreachable # DMZ , Hela --\u0026gt; Odin [javiercruces@hela ~]$ ping 172.16.0.1 -c 1 PING 172.16.0.1 (172.16.0.1) 56(84) bytes of data. 64 bytes from 172.16.0.1: icmp_seq=1 ttl=64 time=0.471 ms --- 172.16.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.471/0.471/0.471/0.000 ms # Exterior a odin javiercruces@HPOMEN15:~$ ping 172.22.200.47 PING 172.22.200.47 (172.22.200.47) 56(84) bytes of data. ^C --- 172.22.200.47 ping statistics --- 419 packets transmitted, 0 received, 100% packet loss, time 428036ms Al final de la practica te dejare todos los hits de las reglas .\nLa m√°quina Odin puede hacer ping a la LAN, la DMZ y al exterior. # PERMITIR PING A DMZ sudo nft insert rule inet filter output oifname \u0026#34;ens3\u0026#34; icmp type echo-request counter accept sudo nft insert rule inet filter input iifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter accept # PERMITIR PING A EXTERIOR sudo nft insert rule inet filter output oifname \u0026#34;ens4\u0026#34; icmp type echo-request counter accept sudo nft insert rule inet filter input iifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter accept # PERMITIR PING A LAN sudo nft insert rule inet filter output oifname \u0026#34;br-intra2\u0026#34; icmp type echo-request counter accept sudo nft insert rule inet filter input iifname \u0026#34;br-intra2\u0026#34; icmp type echo-reply counter accept Comprobaci√≥n :\njaviercruces@odin:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=116 time=8.70 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 8.701/8.701/8.701/0.000 ms javiercruces@odin:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=64 time=6.030 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.030/0.030/0.030/0.000 ms javiercruces@odin:~$ ping 172.16.0.200 -c 1 PING 172.16.0.200 (172.16.0.200) 56(84) bytes of data. 64 bytes from 172.16.0.200: icmp_seq=1 ttl=63 time=59.1 ms --- 172.16.0.200 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 59.052/59.052/59.052/0.000 ms Desde la m√°quina Hela se puede hacer ping y conexi√≥n ssh a las m√°quinas de la LAN. ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept Comprobaci√≥n :\n[javiercruces@hela ~]$ ping 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=0.596 ms ^C --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.596/0.596/0.596/0.000 ms [javiercruces@hela ~]$ ssh 192.168.0.2 Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 6.1.0-18-amd64 x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage Last login: Sun Mar 10 14:52:57 2024 from 192.168.0.1 javiercruces@thor:~$ Desde cualquier m√°quina de la LAN se puede conectar por ssh a la m√°quina Hela. ## Si no esta en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept Comprobaci√≥n :\njaviercruces@thor:~$ ssh 172.16.0.200 Last login: Sun Mar 10 14:53:12 2024 from 192.168.0.2 [javiercruces@hela ~]$ Configura la m√°quina Odin para que las m√°quinas de LAN y DMZ puedan acceder al exterior. Estas reglas ya estaban indicadas previamente .\nsudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter masquerade sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter masquerade Las m√°quinas de la LAN pueden hacer ping al exterior y navegar. # Las m√°quinas de la LAN pueden hacer ping al exterior y navegar. ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter WAN_LAN iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept Comprobaci√≥n :\njaviercruces@thor:~$ curl -I https://www.javiercd.es HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sat, 02 Mar 2024 10:17:01 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65e2fc9d-675b\u0026#34; expires: Sun, 10 Mar 2024 15:35:43 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: E24C:3800B1:1881E48:18E9A93:65EDD0F7 accept-ranges: bytes date: Sun, 10 Mar 2024 19:14:10 GMT via: 1.1 varnish age: 60 x-served-by: cache-mad22083-MAD x-cache: HIT x-cache-hits: 1 x-timer: S1710098050.166466,VS0,VE2 vary: Accept-Encoding x-fastly-request-id: 0c6c80bbef19370976aadfc6988441c5a36beccc content-length: 26459 javiercruces@thor:~$ ping 8.8.8.8 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=110 time=38.5 ms ^C --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 38.451/38.451/38.451/0.000 ms La m√°quina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes a√∫n. # La m√°quina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes a√∫n. # Hela ya tiene permitido hacer consultas dns a thor sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport {80, 443} counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport {80, 443} counter accept Compruebo que puedo navegar :\n[root@hela javiercruces]# curl -I https://www.javiercd.es/ HTTP/2 200 server: GitHub.com content-type: text/html; charset=utf-8 last-modified: Sat, 02 Mar 2024 10:17:01 GMT access-control-allow-origin: * strict-transport-security: max-age=31556952 etag: \u0026#34;65e2fc9d-675b\u0026#34; expires: Sun, 10 Mar 2024 15:35:43 GMT cache-control: max-age=600 x-proxy-cache: MISS x-github-request-id: E24C:3800B1:1881E48:18E9A93:65EDD0F7 accept-ranges: bytes date: Sun, 10 Mar 2024 19:13:17 GMT via: 1.1 varnish age: 7 x-served-by: cache-mad22067-MAD x-cache: HIT x-cache-hits: 1 x-timer: S1710097997.474757,VS0,VE2 vary: Accept-Encoding x-fastly-request-id: 2d2811893898abf05bebd96c6bd5a09ed7abfe5b content-length: 26459 Entiendo que quieres que instale estos 3 servicios en hela . En nuestro escenario son las otras maquinas quien alberga estos servicios .\nConfigura la m√°quina Odin para que los servicios web y ftp sean accesibles desde el exterior. El servidor web ya esta configurado previamente en la migraci√≥n del escenario .\nsudo nft add rule ip nat prerouting tcp dport 21 counter dnat to 172.16.0.200 # No funcionan en cadenas separadas #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept El servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior. El servidor FTP esta en la LAN as√≠ que ya es accesible , voy a hacer que sea accesible desde la DMZ . Desde el exterior ambos , ya son accesibles.\n## No funcionan las reglass en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept Acceso desde la DMZ a LAN :\njaviercruces@thor:~$ curl 172.16.0.200 \u0026lt;!DOCTYPE html\u0026gt; javiercruces@thor:~$ ftp 172.16.0.200 Connected to 172.16.0.200. 220 (vsFTPd 3.0.5) El servidor de correos s√≥lo debe ser accesible desde la LAN. Comentamos las lineas de la preparaci√≥n del escenario que permito el acceso a este y a√±adimos :\n# No funciona en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept Accedemos a el :\n[root@hela javiercruces]# telnet 192.168.0.3 25 Trying 192.168.0.3... Connected to 192.168.0.3. Escape character is \u0026#39;^]\u0026#39;. 220 loki.javiercd.gonzalonazareno.org ESMTP Postfix (Ubuntu) En la m√°quina Loki instala un servidor Postgres si no lo tiene a√∫n. A este servidor se puede acceder desde la DMZ, pero no desde el exterior. # no funciona en cadenas distintas #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept Accedemos al servidor postgree desde hela :\n[root@hela javiercruces]# psql -h 192.168.0.3 -U postgres Password for user postgres: psql (13.14, server 14.11 (Ubuntu 14.11-0ubuntu0.22.04.1)) WARNING: psql major version 13, server major version 14. Some psql features might not work. SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off) Type \u0026#34;help\u0026#34; for help. postgres=# Evita ataques DoS por ICMP Flood, limitando a 4 el n√∫mero de peticiones por segundo desde una misma IP. sudo nft insert rule inet filter input icmp type echo-request limit rate 1/second burst 4 packets counter drop Si le hacemos un ataque de flood , este cortara el trafico :\n[root@hela javiercruces]# hping3 --icmp --flood --rand-source 172.16.0.1 HPING 172.16.0.1 (eth0 172.16.0.1): icmp mode set, 28 headers + 0 data bytes hping in flood mode, no replies will be shown icmp type echo-request limit rate 1/second burst 4 packets counter packets 46 bytes 2128 drop Evita ataques DoS por SYN Flood. # Evita ataques DoS por SYN Flood. sudo nft add rule inet filter input tcp flags \\\u0026amp; \u0026#39;(fin|syn|rst|ack) == syn\u0026#39; counter limit rate over 25/second drop Si probamos el ataque :\n[root@hela javiercruces]# hping3 --flood --rand-source 172.16.0.1 HPING 172.16.0.1 (eth0 172.16.0.1): NO FLAGS are set, 40 headers + 0 data bytes hping in flood mode, no replies will be shown ^C --- 172.16.0.1 hping statistic --- 1267916 packets transmitted, 0 packets received, 100% packet loss round-trip min/avg/max = 0.0/0.0/0.0 ms icmp type echo-request limit rate 1/second burst 4 packets counter packets 31 bytes 2492 drop Script con todas las reglas Te dejo aqu√≠ el script que he utilizado durante la practica .\n# Crear estructura de tablas sudo nft delete table inet filter sudo nft delete table ip nat ## A√±adir tabla filter y sus cadenas sudo nft add table inet filter sudo nft add chain inet filter forward { type filter hook forward priority 10\\; counter \\; policy drop\\; } sudo nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy drop \\; } sudo nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy drop \\; } sudo nft add chain inet filter WAN_LAN { type filter hook forward priority 1\\; counter \\; policy accept \\;} sudo nft add chain inet filter WAN_DMZ { type filter hook forward priority 2\\; counter \\; policy accept \\;} sudo nft add chain inet filter LAN_WAN { type filter hook forward priority 3\\; counter \\; policy accept \\;} sudo nft add chain inet filter LAN_DMZ { type filter hook forward priority 4\\; counter \\; policy accept \\;} sudo nft add chain inet filter DMZ_LAN { type filter hook forward priority 5\\; counter \\; policy accept \\;} sudo nft add chain inet filter DMZ_WAN { type filter hook forward priority 6\\; counter \\; policy accept \\;} ## A√±adir Tabla NAT y sus cadenas : sudo nft add table ip nat sudo nft add chain ip nat prerouting { type nat hook prerouting priority 0 \\; } sudo nft add chain ip nat postrouting { type nat hook postrouting priority 100 \\; } # Reglas para mantener el escenario de clase anterior con IPTABLES ## Reglas SNAT ### Regla SNAT para LAN sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter masquerade ### Regla SNAT para DMZ sudo nft add rule ip nat postrouting oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter masquerade ## Reglas DNAT # Para un wordpress que hay en hela sudo nft add rule ip nat prerouting tcp dport 80 counter dnat to 172.16.0.200 # Para hacer consultas DNS a thor #sudo nft add rule ip nat prerouting udp dport 53 counter dnat to 192.168.0.2 sudo nft add rule ip nat prerouting iifname \u0026#34;ens3\u0026#34; ip saddr { 172.22.0.0/16, 172.19.0.0/16 } udp dport 53 counter dnat to 192.168.0.2 # Para poder recibir correos en loki sudo nft add rule ip nat prerouting tcp dport 25 counter dnat to 192.168.0.3 # Para acceder desde fuera a un mysql que hay en loki sudo nft add rule ip nat prerouting tcp dport 3306 counter dnat to 192.168.0.3 # PERMITIR USO DE ODIN ## Permitir consultas DNS de odin a thor (DNSSERVER) sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir tr√°fico HTTP y HTTPS en odin sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp sport { 80,443 } ct state established counter accept # Permitir conexiones SSH por el puerto 2222 sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Permitir conexiones SSH de odin a hela sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter accept # Permitir conexiones ssh de odin a thor y loki sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter accept # Reglas perimetrales ## Permitir consultas DNS desde br-intra hacia ens4 , necesario para el forward del dns (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter accept ## Permitir consultas dns desde LAN a DMZ (hela --\u0026gt; thor) (ESTA REGLA SOLO ME FUNCIONA SI ESTA EN LA MISMA CADENA) sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter accept ## Reglas para permitir trafico a wordpress en hela sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept # Regla para hacer consultas DNS a thor (Permitir DNAT) sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 udp dport 53 ct state new,established counter accept sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.2 udp sport 53 ct state established,related counter accept # Regla para recibir e enviar correos en loki # No funcionan en cadenas separadas #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state new,established counter accept #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state new,established counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept # Permitir a hela usar el servidor LDAP sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp dport 389 counter accept sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport 389 counter accept # Ejercicios practica ## Permitir conexiones SSH por el puerto 2222 #sudo nft add rule ip nat prerouting iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter dnat to 192.168.0.1:22 #sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter accept #sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state new,established counter accept # Desde Thor y Hela se debe permitir la conexi√≥n ssh por el puerto 22 a la m√°quina Odin. ## Permitir conexion ssh desde hela a odin sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.200 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 ct state established counter accept ## Permitir conexion ssh desde thor a odin sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.2 tcp dport 22 ct state new,established counter accept sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 tcp sport 22 ct state established counter accept #La m√°quina Odin debe tener permitido el tr√°fico para la interfaz loopback. sudo nft add rule inet filter input iifname \u0026#34;lo\u0026#34; counter accept sudo nft add rule inet filter output oifname \u0026#34;lo\u0026#34; counter accept # A la m√°quina Odin se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexi√≥n (REJECT) y desde el exterior se rechazar√° de manera silenciosa. sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-reply counter accept ## Denegar la conexion desde LAN REJECT sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; ip protocol icmp counter reject ## Denegar de manera silenciosa desde EXTERIOR sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; ip protocol icmp counter drop # La m√°quina Odin puede hacer ping a la LAN, la DMZ y al exterior. ## LAN sudo nft add rule inet filter output oifname \u0026#34;ens3\u0026#34; icmp type echo-request counter accept sudo nft add rule inet filter input iifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter accept ## EXTERIOR sudo nft add rule inet filter output oifname \u0026#34;ens4\u0026#34; icmp type echo-request counter accept sudo nft add rule inet filter input iifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter accept ## DMZ sudo nft add rule inet filter output oifname \u0026#34;br-intra2\u0026#34; icmp type echo-request counter accept sudo nft add rule inet filter input iifname \u0026#34;br-intra2\u0026#34; icmp type echo-reply counter accept #### Desde la m√°quina Hela se puede hacer ping y conexi√≥n ssh a las m√°quinas de la LAN. sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter accept # Desde cualquier m√°quina de la LAN se puede conectar por ssh a la m√°quina Hela. sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept ## Si no esta en la cadena forward no funciona #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter accept # Configura la m√°quina Odin para que las m√°quinas de LAN y DMZ puedan acceder al exterior. ## SNAT hecho anteriormente # Las m√°quinas de la LAN pueden hacer ping al exterior y navegar. ## Si no estan en la cadena forward no funciona #sudo nft add rule inet filter LAN_WAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept #sudo nft add rule inet filter WAN_LAN iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport {80, 443} counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp sport {80, 443} counter accept # La m√°quina Hela puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes a√∫n. # Hela ya tiene permitido hacer consultas dns a thor sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport {80, 443} counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport {80, 443} counter accept # ### Configura la m√°quina Odin para que los servicios web y ftp sean accesibles desde el exterior. sudo nft add rule ip nat prerouting tcp dport 21 counter dnat to 172.16.0.200 # No funcionan en cadenas separadas #sudo nft add rule inet filter WAN_DMZ iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_WAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept # ### El servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior. ## No funcionan las reglass en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter accept # ### El servidor de correos s√≥lo debe ser accesible desde la LAN. # no funciona en cadenas separadas #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter accept # ### En la m√°quina Loki instala un servidor Postgres si no lo tiene a√∫n. A este servidor se puede acceder desde la DMZ, pero no desde el exterior. # no funciona en cadenas distintas #sudo nft add rule inet filter LAN_DMZ iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept #sudo nft add rule inet filter DMZ_LAN iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept sudo nft add rule inet filter forward iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { new, established } counter accept sudo nft add rule inet filter forward iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter accept # ### Evita ataques DoS por ICMP Flood, limitando a 4 el n√∫mero de peticiones por segundo desde una misma IP. sudo nft insert rule inet filter input icmp type echo-request limit rate 1/second burst 4 packets counter drop # ### Evita ataques DoS por SYN Flood. #sudo nft insert rule inet filter input tcp flags \\\u0026amp; \u0026#39;(fin|syn|rst|ack) == syn\u0026#39; counter limit rate over 25/second drop #### Evita que realicen escaneos de puertos a Odin. #sudo nft insert rule inet filter input tcp flags \u0026amp; (fin|syn|rst|ack) == (syn) counter drop #sudo nft add rule inet filter output udp dport 53 counter accept #sudo nft add rule inet filter input udp sport 53 counter accept Hits de las reglas Cada vez que he ejecutado el script las reglas pierden los contadores pero as√≠ seria el esquema con todas las reglas al finalizar la practica :\njaviercruces@odin:~$ sudo nft list ruleset table inet filter { chain forward { type filter hook forward priority filter + 10; policy drop; counter packets 711 bytes 171730 iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter packets 107 bytes 8505 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter packets 107 bytes 93423 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter packets 11 bytes 758 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter packets 11 bytes 1818 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state established,new counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 ip protocol icmp icmp type echo-request counter packets 2 bytes 168 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 ip protocol icmp icmp type echo-reply counter packets 2 bytes 168 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp dport 22 counter packets 160 bytes 16502 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 counter packets 100 bytes 15086 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 22 counter packets 30 bytes 6041 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 22 counter packets 23 bytes 5213 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip protocol icmp icmp type echo-request counter packets 1 bytes 84 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip protocol icmp icmp type echo-reply counter packets 1 bytes 84 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport { 80, 443 } counter packets 16 bytes 1666 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp sport { 80, 443 } counter packets 17 bytes 4947 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; tcp dport { 80, 443 } counter packets 32 bytes 3332 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport { 80, 443 } counter packets 34 bytes 9903 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 21 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 21 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { established, new } counter packets 18 bytes 1064 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter packets 14 bytes 1348 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 25 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 25 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.3 tcp dport 5432 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; ip saddr 192.168.0.3 tcp sport 5432 ct state established,related counter packets 0 bytes 0 accept } chain input { type filter hook input priority filter; policy drop; icmp type echo-request limit rate 1/second burst 4 packets counter packets 13 bytes 1092 drop counter packets 1490 bytes 141906 iifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter packets 18 bytes 2352 accept iifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp sport { 80, 443 } ct state established counter packets 17 bytes 13286 accept iifname \u0026#34;ens4\u0026#34; tcp dport 22 ct state established,new counter packets 965 bytes 70084 accept iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.0/16 tcp sport 22 ct state established,related counter packets 356 bytes 39980 accept iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.0/24 tcp sport 22 ct state established,related counter packets 131 bytes 15952 accept iifname \u0026#34;ens3\u0026#34; ip saddr 172.16.0.200 tcp dport 22 ct state established,new counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; ip saddr 192.168.0.2 tcp dport 22 ct state established,new counter packets 0 bytes 0 accept iifname \u0026#34;lo\u0026#34; counter packets 0 bytes 0 accept iifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-request counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; ip protocol icmp counter packets 1 bytes 84 reject with icmp port-unreachable iifname \u0026#34;ens3\u0026#34; ip protocol icmp counter packets 1 bytes 84 drop iifname \u0026#34;ens3\u0026#34; icmp type echo-reply counter packets 0 bytes 0 accept iifname \u0026#34;ens4\u0026#34; icmp type echo-reply counter packets 1 bytes 84 accept iifname \u0026#34;br-intra2\u0026#34; icmp type echo-reply counter packets 0 bytes 0 accept iifname \u0026#34;lo\u0026#34; counter packets 0 bytes 0 accept } chain output { type filter hook output priority filter; policy drop; counter packets 1404 bytes 207511 oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter packets 18 bytes 1304 accept oifname \u0026#34;ens4\u0026#34; ip protocol tcp tcp dport { 80, 443 } ct state established,new counter packets 19 bytes 7331 accept oifname \u0026#34;ens4\u0026#34; tcp sport 22 ct state established counter packets 577 bytes 142596 accept oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.0/16 tcp dport 22 counter packets 547 bytes 38208 accept oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.0/24 tcp dport 22 counter packets 194 bytes 14400 accept oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp sport 22 ct state established counter packets 0 bytes 0 accept oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 tcp sport 22 ct state established counter packets 0 bytes 0 accept oifname \u0026#34;lo\u0026#34; counter packets 12 bytes 1008 accept oifname \u0026#34;ens3\u0026#34; ip protocol icmp icmp type echo-reply counter packets 0 bytes 0 accept oifname \u0026#34;ens3\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept oifname \u0026#34;ens4\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept oifname \u0026#34;br-intra2\u0026#34; icmp type echo-request counter packets 1 bytes 84 accept oifname \u0026#34;lo\u0026#34; counter packets 0 bytes 0 accept } chain WAN_LAN { type filter hook forward priority filter + 1; policy accept; counter packets 711 bytes 171730 } chain WAN_DMZ { type filter hook forward priority filter + 2; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp sport 53 counter packets 107 bytes 93423 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;ens3\u0026#34; ip daddr 172.16.0.200 tcp dport 80 ct state { established, new } counter packets 0 bytes 0 accept iifname \u0026#34;ens4\u0026#34; oifname \u0026#34;br-intra2\u0026#34; ip daddr 192.168.0.2 udp dport 53 ct state established,new counter packets 0 bytes 0 accept } chain LAN_WAN { type filter hook forward priority filter + 3; policy accept; counter packets 711 bytes 171730 } chain LAN_DMZ { type filter hook forward priority filter + 4; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; udp dport 53 counter packets 11 bytes 758 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;br-intra2\u0026#34; tcp dport 389 counter packets 0 bytes 0 accept } chain DMZ_LAN { type filter hook forward priority filter + 5; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; udp sport 53 counter packets 11 bytes 1818 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens3\u0026#34; tcp sport 389 counter packets 0 bytes 0 accept } chain DMZ_WAN { type filter hook forward priority filter + 6; policy accept; counter packets 711 bytes 171730 iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; udp dport 53 counter packets 107 bytes 8505 accept iifname \u0026#34;ens3\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.200 tcp sport 80 ct state established,related counter packets 0 bytes 0 accept iifname \u0026#34;br-intra2\u0026#34; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.2 udp sport 53 ct state established,related counter packets 0 bytes 0 accept } } table ip nat { chain prerouting { type nat hook prerouting priority filter; policy accept; tcp dport 80 counter packets 8 bytes 480 dnat to 172.16.0.200 iifname \u0026#34;ens3\u0026#34; ip saddr { 172.19.0.0/16, 172.22.0.0/16 } udp dport 53 counter packets 0 bytes 0 dnat to 192.168.0.2 tcp dport 25 counter packets 0 bytes 0 dnat to 192.168.0.3 tcp dport 3306 counter packets 12 bytes 720 dnat to 192.168.0.3 iifname \u0026#34;ens4\u0026#34; tcp dport 2222 counter packets 0 bytes 0 dnat to 192.168.0.1:22 tcp dport 21 counter packets 0 bytes 0 dnat to 172.16.0.200 } chain postrouting { type nat hook postrouting priority srcnat; policy accept; oifname \u0026#34;ens4\u0026#34; ip saddr 192.168.0.0/24 counter packets 109 bytes 8649 masquerade oifname \u0026#34;ens4\u0026#34; ip saddr 172.16.0.0/16 counter packets 2 bytes 120 masquerade } } Hacer las reglas persistentes Vamos a guardar las reglas con :\nroot@odin:/home/javiercruces# nft list ruleset \u0026gt; /etc/nftables.conf Si las queremos restaurar :\njaviercruces@odin:~$ sudo nft -f /etc/nftables.conf Para hacer que al reiniciar las reglas se restauren solas :\n# Creamos la unidad de systemd javiercruces@odin:~$ sudo cat /etc/systemd/system/nftables-persistent.service [Unit] Description=Cargar reglas de nftables al iniciar el sistema [Service] Type=oneshot ExecStart=/usr/sbin/nft -f /etc/nftables/nftables.rules [Install] WantedBy=multi-user.target # Activa el servicio para que al reiniciar se apliquen los cambios javiercruces@odin:~$ sudo systemctl enable nftables-persistent.service ","date":"March 28, 2024","hero":"/images/cortafuegos/nftables2.png","permalink":"https://www.javiercd.es/posts/cortafuegos/nftables_dos/cortafuegos_dos/","summary":"\u003cp\u003eSobre el escenario creado en el m√≥dulo de servicios con las m√°quinas Odin (Router), Hela (DMZ), Loki y Thor (LAN) y empleando nftables, configura un cortafuegos perimetral en la m√°quina Odin de forma que el escenario siga funcionando completamente teniendo en cuenta los siguientes puntos:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e‚Ä¢ Se valorar√° la creaci√≥n de cadenas diferentes para cada flujo de tr√°fico (de LAN al exterior, de LAN a DMZ, etc‚Ä¶).\n‚Ä¢ Pol√≠tica por defecto DROP para todas las cadenas.\n‚Ä¢ Se pueden usar las extensiones que creamos adecuadas, pero al menos debe implementarse seguimiento de la conexi√≥n cuando sea necesario.\n‚Ä¢ Debemos implementar que el cortafuegos funcione despu√©s de un reinicio de la m√°quina.\n‚Ä¢ Debes mostrar pruebas de funcionamiento de todas las reglas.\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ePara no hacer demasiado larga la practica , voy a mostrarte los hits de las reglas al final , as√≠ como el script completo de las reglas . Ya que solo te pondr√© en cada ejercicio las reglas que intervienen y una comprobaci√≥n del mismo .\u003c/p\u003e","tags":["FIREWALL","LINUX","DEBIAN","NFTABLES"],"title":"Implementaci√≥n de un cortafuegos perimetral con Nftables II"},{"categories":null,"contents":"La inform√°tica forense es el conjunto de t√©cnicas que nos permite obtener la m√°xima informaci√≥n posible tras un incidente o delito inform√°tico. En esta pr√°ctica, realizar√°s la fase de toma de evidencias y an√°lisis de las mismas sobre una m√°quina Linux y otra Windows. Supondremos que pillamos al delincuente \u0026lsquo;in fraganti\u0026rsquo; y las m√°quinas se encontraban encendidas. Opcionalmente, pod√©is realizar el an√°lisis de un dispositivo Android. Sobre cada una de las m√°quinas debes realizar un volcado de memoria y otro de disco duro, tomando las medidas necesarias para certificar posteriormente la cadena de custodia.\nVolcado de las im√°genes y memoria Windows Me voy a preparar el disco en el cual contiene las herramientas :\njaviercruces@HPOMEN15:~$ sudo guestmount -a /var/lib/libvirt/images/win_foresense-1.qcow2 -m /dev/sda1 /mnt/vdb/ javiercruces@HPOMEN15:~/Descargas$ sudo cp AccessData_FTK_Imager_4.7.1.exe /mnt/vdb Este lo pinchare en la maquina ya que le he instalado el FTK :\nVolcado de la memoria As√≠ que vamos a proceder a sacar una imagen de la memoria :\nSeleccionamos donde la vamos a guardar :\nVolcado del registro Vamos a sacar el registro , para ello seleccionamos la opci√≥n de obtener ficheros protegidos :\nSeleccionare los ficheros de contrase√±as y todos los registros , ademas lo guardare en el disco externo :\nVolcado de disco Para realizar el volcado de disco , seleccionaremos crear imagen de disco :\nNuestro disco de origen es un dispositivo f√≠sico , as√≠ que seleccionare esa opci√≥n :\nElegimos donde vamos a guardar la imagen , en mi caso en el disco externo :\nUna vez hecho , verificara la imagen creada :\nAqu√≠ tenemos los hash de la imagen del disco :\nTambi√©n le haremos el volcado al disco de datos que esta cifrado :\nLos hashes del segundo disco :\nAhora voy a hacer llegar estos ficheros a mi maquina host , para ello montare el volumen de la mv en la cual he hecho los volcados de datos :\njaviercruces@HPOMEN15:~$ sudo guestmount -a /var/lib/libvirt/images/win10-2.qcow2 -m /dev/sda2 /mnt/vdb/ Para asegurarme de que las imagen de los discos no son manipuladas voy a sacarles a todas los hashes :\njaviercruces@HPOMEN15:~$ sudo find /mnt/vdb -type f -exec sha256sum {} + e1b9ce9b57957b1a0607a72a057d6b7a9b34ea60f3f8aa8f38a3af979bd23066 /mnt/vdb/$RECYCLE.BIN/S-1-5-21-1723251262-3026432737-944335575-1001/desktop.ini 57020f3e585d0f2a7ee783054c50886db4c65af1bbbe5e12e114dbf674326184 /mnt/vdb/AccessData_FTK_Imager_4.7.1.exe 91cbca5b445780e72522d872e0d229000849d6deb464ac707ee378c0c0e1794c /mnt/vdb/discodatos/discodatos.001 44ca1fe875ba863adbb5b2675acb3345122f8dee0ba3ce8e2c4cfb9c523d38b0 /mnt/vdb/discodatos/discodatos.001.txt 5a45f6418924d3eab3ea820b4bdb4a609e7f95a6f4665f043217593eeab5056e /mnt/vdb/discowin/discowin.001 aeb282e38ebe64be765b43e20a6a419ac1aa1ae4d6edd08cae3d8973bc0ac5a9 /mnt/vdb/discowin/discowin.001.txt 372a1157215515100f42e5a73adecc2407a1d8b586fa2c4770d2619d8094baf1 /mnt/vdb/discowin/discowin.002 e06c8472a09f209f23e49fb63195d8c471c86aea67e9587002b884ade22c8b97 /mnt/vdb/discowin/discowin.003 947ce5b6c2d7c8139de359723fecef351b1c6877b09647fb1d3015a4588f95df /mnt/vdb/discowin/discowin.004 7bc813aee24fd973f2c3563c66e92c3becbbe2a40e341e693b5c4c38df3c8eb8 /mnt/vdb/discowin/discowin.005 e7d920807e329ba1f9dfd3b6987a6c12efd7a3b9a0563302509db73d88862909 /mnt/vdb/discowin/discowin.006 94c1cd9d910a39a1df7852c69032d68cdaf8ba59b4849f84963f3728880e53c0 /mnt/vdb/discowin/discowin.007 fa01765ac897aa4c8a1c2e9569cf9b0c50c5aea2c947ae9bf932f0eec89986e3 /mnt/vdb/discowin/discowin.008 095a0b5d4e88826a88427f5a2e64d621f81315bd1307db21b34aa76fad65af84 /mnt/vdb/discowin/discowin.009 a70aa8c7c1c723d97d4845a87a33d47697d48edcacc7b9bc83f2510baee4237e /mnt/vdb/discowin/discowin.010 3e6b92b9764b3786091e5bb67e8ffb8c3271be4c977101da9fa14afa12fea171 /mnt/vdb/discowin/discowin.011 3e6b92b9764b3786091e5bb67e8ffb8c3271be4c977101da9fa14afa12fea171 /mnt/vdb/discowin/discowin.012 3e6b92b9764b3786091e5bb67e8ffb8c3271be4c977101da9fa14afa12fea171 /mnt/vdb/discowin/discowin.013 83954736003d261f58a1ce24f73cba37953df229fdfebd15d00245ba5a700197 /mnt/vdb/discowin/discowin.014 5353e34d4487ae5450be372e5ec37a0ca5dd746b206823abf561cd2af5d0d371 /mnt/vdb/memoria/memdump.mem e8380620a1d5a99c0a39da8a2c5a59af17dd4bff7a4d48d8652ecca9683ef099 /mnt/vdb/memoria/pagefile.sys 9cce8fc11ca271c3e528a48257bb5472c2f4cbdbb809c19895c36b1be51c3d0b /mnt/vdb/registro/default 816ab103521bcb7adcd11b5ac9359fc8f0de945fe10507411d0127bdcc24ff70 /mnt/vdb/registro/SAM cbac2073fe665e11e5d043c5ab054ae58c70687b0b59197559c4077e4fdaa696 /mnt/vdb/registro/SECURITY 7cd909de86fc9e9ecb73e3d432d68aa892053be3848b6c32d3aefffc347140f6 /mnt/vdb/registro/software 4cf3a831081ab8e890b5c297ed5238cecebdfecdb1805a3b2e391489cd48fe5b /mnt/vdb/registro/system 0e2961777eb214825652cc4b35b3b85dcfbdba2a58f5d2c1f586d8800abe9f83 /mnt/vdb/registro/Users/Default/NTUSER.DAT 59ffce3dd25b5f242f425a6dfdc642813f429bc0c19694aad1dcd5d2a9871c1f /mnt/vdb/registro/Users/javiercruces/Crypto/Keys/de7cf8a7901d2ad13e5c67c29e5d1662_42c962d9-bf79-4299-be81-eebad4e81473 ea127864137edff0844c2e5731c51d1d2ef22cb3a8030d413166df1114eae5a5 /mnt/vdb/registro/Users/javiercruces/NTUSER.DAT a564c8fa96557437d4b69e870ff8797a8beee20892a632735ac0a1f838ed453b /mnt/vdb/registro/Users/javiercruces/Protect/CREDHIST fb321d3671cf9f911f933e29fc9a099cd6834838c40d01fe6404b6975990c041 /mnt/vdb/registro/Users/javiercruces/Protect/S-1-5-21-1723251262-3026432737-944335575-1001/e8d02ff1-98d6-4ba4-99a4-1db28276ecda 13150cc91caed3c1d4321e8815afd5fc21eb4831eb1a93b40b4c9c48a4109fa1 /mnt/vdb/registro/Users/javiercruces/Protect/S-1-5-21-1723251262-3026432737-944335575-1001/Preferred 78596ecc21720053b44f78689bb06870bbe4f47029dc3d7e781cfe4d2d7a940f /mnt/vdb/registro/Users/javiercruces/UsrClass.dat Linux Volcado de disco javiercruces@debian:~/LiME/src$ lsblk -f NAME FSTYPE FSVER LABEL UUID FSAVAIL FSUSE% MOUNTPOINTS sda ‚îî‚îÄsda1 crypto 2 9fc1bfa7-9224-4e8e-896a-09516d4fd613 sr0 iso966 Jolie Debian 12.1.0 amd64 n 2023-07-22-10-52-30-00 vda ‚îú‚îÄvda1 ‚îÇ vfat FAT32 DB79-1C75 597,9M 37% /boot ‚îú‚îÄvda2 ‚îÇ ext4 1.0 6666d9d8-9a41-46e5-a370-0730f713d3a7 7,6G 52% / ‚îî‚îÄvda3 swap 1 e24babe0-340c-4b09-836e-dd5f447bcecc [SWAP] vdb ‚îî‚îÄvdb1 ext4 1.0 f79f0d79-209b-42b9-9087-5c72ee1595ee 54G 3% /mnt javiercruces@debian:~/LiME/src$ sudo dd if=/dev/vda2 of=/mnt/discoLinux.raw bs=64K 296784+0 records in 296784+0 records out 19450036224 bytes (19 GB, 18 GiB) copied, 27,2778 s, 713 MB/s javiercruces@debian:~/LiME/src$ Volcado de memoria javiercruces@debian:~$ git clone https://github.com/504ensicsLabs/LiME.git javiercruces@debian:~$ cd LiME/src/ javiercruces@debian:~/LiME/src$ make javiercruces@debian:~/LiME/src$ sudo insmod ./lime-6.1.0-18-amd64.ko \u0026#34;path=/mnt/vdb format=lime\u0026#34; javiercruces@HPOMEN15:~$ sudo guestmount -a /var/lib/libvirt/images/ASO-systemd-boot-1.qcow2 -m /dev/vda1 /mnt/vdb/ javiercruces@HPOMEN15:~$ sudo ls -l /mnt/vdb total 25023392 -rw-r--r-- 1 root root 19450036224 feb 18 12:07 discoLinux.raw drwx------ 2 root root 16384 feb 18 11:25 lost+found -rw-r--r-- 1 root root 1900818432 feb 18 11:47 memdebian.mem -r--r--r-- 1 root root 4273066304 feb 18 12:10 vdb Voy a guardarme los hashes de las im√°genes :\njaviercruces@HPOMEN15:~$ sudo find /mnt/vdb -type f -exec sha256sum {} + 5f136603c0e34a74a58bc59f1934f5f2850ca8bec9c356a283ee7161a8f39a76 /mnt/vdb/memdebian.mem b63693142f2823a95a11d9f1fcbd845c118b2fc5d0b2508586d0fc6c8fe482af /mnt/vdb/discoLinux.raw b419ec819114f21a10bc5146a0b28183165c8b2cf77b2fe160e3044b1b5e04a0 /mnt/vdb/vdb An√°lisis de la maquina Windows Lo primero que har√© sera crear un caso en autopsy (Esta documentaci√≥n esta hecha en debian , los ejercicios los he respondido en Windows ).\nLe a√±adimos metainformaci√≥n al caso , si lo consideramos necesario :\nEsperamos a que autopsy procese la imagen de disco :\nInstalaci√≥n volatility javiercruces@HPOMEN15:~$ git clone https://github.com/volatilityfoundation/volatility3.git Clonando en \u0026#39;volatility3\u0026#39;... remote: Enumerating objects: 32373, done. remote: Counting objects: 100% (3665/3665), done. remote: Compressing objects: 100% (771/771), done. remote: Total 32373 (delta 3350), reused 2971 (delta 2894), pack-reused 28708 Recibiendo objetos: 100% (32373/32373), 6.32 MiB | 14.10 MiB/s, listo. Resolviendo deltas: 100% (24696/24696), listo. javiercruces@HPOMEN15:~$ cd volatility3/ javiercruces@HPOMEN15:~/volatility3$ python3 -m venv volatility javiercruces@HPOMEN15:~/volatility3$ source volatility/bin/activate (volatility) javiercruces@HPOMEN15:~/volatility3$ pip3 install -r requirements.txt M√°quina Windows 1. Procesos en ejecuci√≥n (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.pslist.PsList PID\tPPID\tImageFileName\tOffset(V)\tThreads\tHandles\tSessionId\tWow64\tCreateTime\tExitTime\tFile output 4\t0\tSystem\t0xb088ea4af080\t158\t-\tN/A\tFalse\t2024-02-05 19:30:59.000000 N/A\tDisabled 92\t4\tRegistry\t0xb088ea5b8040\t4\t-\tN/A\tFalse\t2024-02-05 19:30:56.000000 N/A\tDisabled 344\t4\tsmss.exe\t0xb0891a80e040\t2\t-\tN/A\tFalse\t2024-02-05 19:30:59.000000 N/A\tDisabled 448\t440\tcsrss.exe\t0xb088f6093140\t10\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 516\t440\twininit.exe\t0xb088ebd2e080\t1\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 528\t508\tcsrss.exe\t0xb088ebd34080\t11\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 612\t508\twinlogon.exe\t0xb08929ff6080\t3\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 648\t516\tservices.exe\t0xb088eb1b40c0\t10\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 668\t516\tlsass.exe\t0xb088eb1b9080\t10\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 768\t516\tfontdrvhost.ex\t0xb088eb1bd080\t5\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 776\t612\tfontdrvhost.ex\t0xb088f59eb140\t5\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 788\t648\tsvchost.exe\t0xb088f59ee240\t25\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 880\t648\tsvchost.exe\t0xb08919be72c0\t19\t-\t0\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 988\t612\tdwm.exe\t0xb088f5d7e080\t14\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 996\t612\tLogonUI.exe\t0xb088f5d81080\t13\t-\t1\tFalse\t2024-02-05 19:31:15.000000 N/A\tDisabled 400\t648\tsvchost.exe\t0xb088f654c2c0\t42\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 444\t648\tsvchost.exe\t0xb088f654e240\t73\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 584\t648\tsvchost.exe\t0xb088f82052c0\t16\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1032\t648\tsvchost.exe\t0xb088f8ea62c0\t15\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1040\t648\tsvchost.exe\t0xb088f8ea8280\t20\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1244\t648\tsvchost.exe\t0xb088f8e0a2c0\t22\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1460\t648\tsvchost.exe\t0xb088fa6e62c0\t19\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1520\t648\tsvchost.exe\t0xb088f9fc4080\t14\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1572\t648\tsvchost.exe\t0xb088fa6e8300\t3\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1768\t4\tMemCompression\t0xb088f9fc8040\t42\t-\tN/A\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1924\t648\tsvchost.exe\t0xb088fbbd42c0\t8\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1956\t648\tsvchost.exe\t0xb088fc1292c0\t9\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1052\t648\tsvchost.exe\t0xb088fe704240\t11\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1068\t648\tsvchost.exe\t0xb088fe7062c0\t5\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1232\t648\tsvchost.exe\t0xb088fe708080\t4\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 1568\t648\tspoolsv.exe\t0xb088fdbde200\t8\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 2052\t648\tsvchost.exe\t0xb088f67072c0\t14\t-\t0\tFalse\t2024-02-05 19:31:16.000000 N/A\tDisabled 2300\t648\tsvchost.exe\t0xb088f834a240\t12\t-\t0\tFalse\t2024-02-05 19:31:17.000000 N/A\tDisabled 2412\t648\tMsMpEng.exe\t0xb088f5b06280\t28\t-\t0\tFalse\t2024-02-05 19:31:17.000000 N/A\tDisabled 2868\t648\tsvchost.exe\t0xb08919b82240\t27\t-\t0\tFalse\t2024-02-05 19:31:18.000000 N/A\tDisabled 3044\t1040\tdasHost.exe\t0xb088f5c08280\t3\t-\t0\tFalse\t2024-02-05 19:31:18.000000 N/A\tDisabled 664\t648\tsvchost.exe\t0xb088faadd300\t5\t-\t0\tFalse\t2024-02-05 19:31:19.000000 N/A\tDisabled 3792\t3784\tcsrss.exe\t0xb088faaf5080\t11\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3840\t3784\twinlogon.exe\t0xb08901ded080\t6\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3868\t648\tWUDFHost.exe\t0xb088f55e5080\t10\t-\t0\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3960\t3840\tfontdrvhost.ex\t0xb088f0fbb0c0\t5\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 4020\t3840\tdwm.exe\t0xb088f7551340\t16\t-\t2\tFalse\t2024-02-05 19:31:38.000000 N/A\tDisabled 3456\t400\trdpclip.exe\t0xb088eb1ed2c0\t8\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3616\t444\tsihost.exe\t0xb088eaec5300\t16\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3400\t648\tsvchost.exe\t0xb088fafee340\t20\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3188\t444\ttaskhostw.exe\t0xb088f6af1380\t12\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3068\t648\tNisSrv.exe\t0xb088eadcc300\t7\t-\t0\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 3344\t1040\tctfmon.exe\t0xb088f632d080\t11\t-\t2\tFalse\t2024-02-05 19:31:39.000000 N/A\tDisabled 4208\t3840\tuserinit.exe\t0xb088fc324080\t0\t-\t2\tFalse\t2024-02-05 19:31:40.000000 2024-02-05 19:32:04.000000 Disabled 4236\t4208\texplorer.exe\t0xb088fc332080\t76\t-\t2\tFalse\t2024-02-05 19:31:40.000000 N/A\tDisabled 4388\t648\tsvchost.exe\t0xb088f5430080\t14\t-\t2\tFalse\t2024-02-05 19:31:40.000000 N/A\tDisabled 4452\t648\tSearchIndexer.\t0xb0891ee2a240\t21\t-\t0\tFalse\t2024-02-05 19:31:40.000000 N/A\tDisabled 4876\t788\tStartMenuExper\t0xb088f90130c0\t14\t-\t2\tFalse\t2024-02-05 19:31:41.000000 N/A\tDisabled 5096\t788\tRuntimeBroker.\t0xb088f94ec340\t4\t-\t2\tFalse\t2024-02-05 19:31:42.000000 N/A\tDisabled 4732\t788\tSearchApp.exe\t0xb088f65130c0\t57\t-\t2\tFalse\t2024-02-05 19:31:42.000000 N/A\tDisabled 5184\t788\tRuntimeBroker.\t0xb088fb73e340\t17\t-\t2\tFalse\t2024-02-05 19:31:42.000000 N/A\tDisabled 5828\t788\tWmiPrvSE.exe\t0xb088ead52300\t8\t-\t0\tFalse\t2024-02-05 19:31:44.000000 N/A\tDisabled 6028\t3104\tGoogleCrashHan\t0xb088f871c340\t5\t-\t0\tTrue\t2024-02-05 19:31:45.000000 N/A\tDisabled 6092\t3104\tGoogleCrashHan\t0xb088f870f080\t4\t-\t0\tFalse\t2024-02-05 19:31:45.000000 N/A\tDisabled 3740\t788\tRuntimeBroker.\t0xb0891ee2f080\t9\t-\t2\tFalse\t2024-02-05 19:31:52.000000 N/A\tDisabled 1912\t788\tsmartscreen.ex\t0xb088f901d080\t7\t-\t2\tFalse\t2024-02-05 19:31:54.000000 N/A\tDisabled 3524\t4236\tSecurityHealth\t0xb088f87020c0\t6\t-\t2\tFalse\t2024-02-05 19:31:54.000000 N/A\tDisabled 3236\t648\tSecurityHealth\t0xb088f9c4e340\t15\t-\t0\tFalse\t2024-02-05 19:31:54.000000 N/A\tDisabled 820\t4236\tOneDrive.exe\t0xb088f8ec7080\t23\t-\t2\tTrue\t2024-02-05 19:31:55.000000 N/A\tDisabled 6128\t4236\tchrome.exe\t0xb088f8e61080\t40\t-\t2\tFalse\t2024-02-05 19:31:56.000000 N/A\tDisabled 2040\t6128\tchrome.exe\t0xb088f8732080\t8\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5404\t6128\tchrome.exe\t0xb088f3cb2080\t14\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5392\t6128\tchrome.exe\t0xb088f60e8080\t15\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5348\t6128\tchrome.exe\t0xb088f8fa3080\t8\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 5496\t6128\tchrome.exe\t0xb088f3cc1080\t15\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6184\t6128\tchrome.exe\t0xb088f44e5080\t14\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6200\t6128\tchrome.exe\t0xb088f3cf3080\t14\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6380\t788\tTextInputHost.\t0xb088f8a0e080\t9\t-\t2\tFalse\t2024-02-05 19:31:57.000000 N/A\tDisabled 6556\t788\tdllhost.exe\t0xb0891a1ec080\t11\t-\t2\tFalse\t2024-02-05 19:31:58.000000 N/A\tDisabled 6156\t6128\tchrome.exe\t0xb088f44cc080\t14\t-\t2\tFalse\t2024-02-05 19:33:00.000000 N/A\tDisabled 5284\t6128\tchrome.exe\t0xb088f872c080\t14\t-\t2\tFalse\t2024-02-05 19:33:00.000000 N/A\tDisabled 4036\t6128\tchrome.exe\t0xb088f44e4080\t14\t-\t2\tFalse\t2024-02-05 19:33:05.000000 N/A\tDisabled 6916\t4236\tFTK Imager.exe\t0xb0891a1d9080\t22\t-\t2\tFalse\t2024-02-05 19:33:11.000000 N/A\tDisabled 6044\t788\tApplicationFra\t0xb0890d7dc080\t13\t-\t2\tFalse\t2024-02-05 19:33:14.000000 N/A\tDisabled 6104\t788\tCalculator.exe\t0xb088f9bf1340\t17\t-\t2\tFalse\t2024-02-05 19:33:14.000000 N/A\tDisabled 5864\t788\tRuntimeBroker.\t0xb0890d7d9080\t6\t-\t2\tFalse\t2024-02-05 19:33:14.000000 N/A\tDisabled 7020\t648\tsvchost.exe\t0xb088f8720300\t7\t-\t0\tFalse\t2024-02-05 19:33:17.000000 N/A\tDisabled 4788\t648\tSgrmBroker.exe\t0xb088fbe4c080\t7\t-\t0\tFalse\t2024-02-05 19:33:18.000000 N/A\tDisabled 760\t648\tsvchost.exe\t0xb088fac482c0\t13\t-\t0\tFalse\t2024-02-05 19:33:18.000000 N/A\tDisabled 7348\t788\tHxCalendarAppI\t0xb088f5f5a080\t29\t-\t2\tFalse\t2024-02-05 19:33:20.000000 N/A\tDisabled 7412\t788\tRuntimeBroker.\t0xb088faf61080\t6\t-\t2\tFalse\t2024-02-05 19:33:20.000000 N/A\tDisabled 7476\t788\tHxTsr.exe\t0xb088fc642080\t13\t-\t2\tFalse\t2024-02-05 19:33:20.000000 N/A\tDisabled 7816\t4236\tTaskmgr.exe\t0xb088facb8340\t16\t-\t2\tFalse\t2024-02-05 19:33:22.000000 N/A\tDisabled 8072\t788\texplorer.exe\t0xb088ead54080\t11\t-\t2\tFalse\t2024-02-05 19:33:34.000000 N/A\tDisabled 7256\t3616\tPaintStudio.Vi\t0xb088facbe340\t45\t-\t2\tFalse\t2024-02-05 19:33:39.000000 N/A\tDisabled 7796\t788\tRuntimeBroker.\t0xb088f8e64300\t8\t-\t2\tFalse\t2024-02-05 19:33:40.000000 N/A\tDisabled 900\t788\tTime.exe\t0xb088f9c15080\t16\t-\t2\tFalse\t2024-02-05 19:33:42.000000 N/A\tDisabled 2132\t788\tRuntimeBroker.\t0xb088ead3d080\t7\t-\t2\tFalse\t2024-02-05 19:33:43.000000 N/A\tDisabled 2. Servicios en ejecuci√≥n (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.getservicesids.GetServiceSIDs Volatility 3 Framework 2.5.2 Progress: 100.00\tPDB scanning finished SID\tService S-1-5-80-4151353957-356578678-4163131872-800126167-2037860865\t.NET CLR Networking 4.0.0.0 S-1-5-80-1135273183-3738781202-689480478-891280274-255333391\t.NET Memory Cache 4.0 S-1-5-80-3459415445-2224257447-3423677131-2829651752-4257665947\t3ware S-1-5-80-2917441881-3404282297-3983348447-1829381237-2935805708\tAarSvc S-1-5-80-2345285467-3342891147-82292311-2275197348-1578354944\tAarSvc_50fad S-1-5-80-1975967573-2913356537-819030703-3730719923-1995772179\tAcpiDev S-1-5-80-2670625634-2386107419-4204951937-4094372046-2600379021\tacpiex S-1-5-80-3267050047-1503497915-401953950-2662906978-1179039408\tacpipagr S-1-5-80-772678238-4220935223-620583658-4118486195-1180343772\tacpitime S-1-5-80-1863632671-1375125309-1493738800-1551534981-2387622636\tAcx01000 S-1-5-80-3261807240-4279319092-2126406095-947934052-2578847935\tADOVMPPackage S-1-5-80-2046354688-3987051615-3879164971-215375460-2633017214\tADP80XX S-1-5-80-1535954936-2128305610-2033289386-4003803006-3961564848\tad_driver S-1-5-80-521319896-1227547225-1440366370-1094984824-1952325498\tafunix S-1-5-80-3882103802-2937937445-2149894622-934926057-1088273958\tahcache S-1-5-80-3532809085-2652327567-2620918877-1058261733-582902671\tAJRouter S-1-5-80-3520885947-347258037-358237196-958877718-2177097675\tamdgpio2 S-1-5-80-3034931084-4111837248-3722498124-953434196-229084002\tamdi2c S-1-5-80-940484976-4139584748-3980625906-2403118188-3770008912\tapplockerfltr S-1-5-80-2020831507-1298702824-3288167190-116113825-4190209\tAppReadiness S-1-5-80-3690054487-1922792274-847725564-1425669114-2396631621\tAppVClient S-1-5-80-1981223234-350633043-1452159618-1133528455-2295233572\tAppvStrm S-1-5-80-1995813674-3661462697-784932380-3834207926-917317866\tAppvVemgr S-1-5-80-1543189782-2596160705-3795570588-3168413527-2925017820\tAppvVfs S-1-5-80-1949724575-2387902436-65106593-1201171665-3967308604\tAppXSvc S-1-5-80-689100834-1985168674-2379302174-2224748125-4125308070\tAssignedAccessManagerSvc S-1-5-80-3169285310-278349998-1452333686-3865143136-4212226833\tautotimesvc S-1-5-80-286416697-2074333985-3953926783-2730543180-4207904231\tbam S-1-5-80-2025233850-3714960172-3834018148-2523054830-2209135241\tBasicDisplay S-1-5-80-4178409850-1580268469-397489987-3195816699-129657517\tBasicRender S-1-5-80-3969992995-4113734098-2838120167-1440264772-583281004\tBcastDVRUserService S-1-5-80-1091833278-2140613478-3064603973-1607650773-3857006778\tBcastDVRUserService_50fad S-1-5-80-856979437-3912875207-2720685236-703935298-3759072829\tbcmfn2 S-1-5-80-3451400966-3703281935-2685268016-3285412533-1470843506\tbindflt S-1-5-80-2033999825-3741098712-1851668902-216055579-943193379\tBluetoothUserService S-1-5-80-2602215105-3353301314-225129424-3242260137-2199118732\tBluetoothUserService_50fad S-1-5-80-1988685059-1921232356-378231328-2704142597-890457928\tBrokerInfrastructure S-1-5-80-3316959809-2577409367-488518535-1805171532-1438653141\tBTAGService S-1-5-80-3397485379-1673558126-3852117732-4170930301-4011713027\tBthA2dp S-1-5-80-1264790548-4164306546-4160824920-750804445-3452039388\tBthAvctpSvc S-1-5-80-3742302039-178175996-3312716580-300089339-184318439\tBthEnum S-1-5-80-4190030514-1955060627-1650410980-2059579884-2945205035\tBthHFEnum S-1-5-80-2319449347-3660344761-1621844049-61588942-3837794983\tBthLEEnum S-1-5-80-411364929-2494992265-235336807-3339216277-1376253409\tBthMini S-1-5-80-3533787624-3536623824-1878644040-3113243162-1610647180\tBTHUSB S-1-5-80-1102738-1048517740-3681369803-3100335448-3129350187\tbttflt S-1-5-80-4235005237-3293881321-902755294-2421876860-1688724929\tbuttonconverter S-1-5-80-3988044632-483646655-3689529973-3635425272-2751329168\tCAD S-1-5-80-3369530244-1263555520-1552818992-544823788-1590281562\tcamsvc S-1-5-80-2195691530-3564058219-2185687823-1858318469-3207429352\tCaptureService S-1-5-80-2061916618-2473786339-1209003124-203996862-3865510505\tCaptureService_50fad S-1-5-80-546976454-1426073922-427304975-3694345144-4147405473\tcbdhsvc S-1-5-80-2514868401-1614040450-3339499687-2942524132-3960226468\tcbdhsvc_50fad S-1-5-80-3433512109-503559027-1389316256-1766580070-2256751264\tCDPSvc S-1-5-80-1260278928-804197538-2066346633-4268302704-2216462912\tCDPUserSvc S-1-5-80-1518900912-1420122119-1615577584-34666731-2598493892\tCDPUserSvc_50fad S-1-5-80-1055174906-2416269421-2304048803-1043379310-100576628\tcht4iscsi S-1-5-80-867907225-1838866732-3207111219-3362010221-3938223369\tcht4vbd S-1-5-80-1592074278-3653508928-2768813056-1918619345-1433065180\tCimFS S-1-5-80-1404165011-2000956283-1442398411-3799073753-1383434776\tCldFlt S-1-5-80-65843127-2189646064-2697706863-2125155322-3141006483\tClipSVC S-1-5-80-2119957892-4152124429-3625998117-4006912763-1737903618\tcloudidsvc S-1-5-80-2611951811-1959136347-1062071333-3982815153-2811717512\tclr_optimization_v4.0.30319_32 S-1-5-80-2839768381-3691089589-2614646340-3191585287-3380622033\tclr_optimization_v4.0.30319_64 S-1-5-80-4162882437-1505926369-3203888135-2472178355-2995762856\tcnghwassist S-1-5-80-1796617447-2916456010-10894564-1845345233-3515002435\tcondrv S-1-5-80-3749766068-1582991359-4182444126-1144602875-625653745\tConsentUxUserSvc S-1-5-80-1689245047-2517065848-119126955-928953782-3881496094\tConsentUxUserSvc_50fad S-1-5-80-1021139062-1866602279-1255292388-1008060685-2498416891\tCoreMessagingRegistrar S-1-5-80-109488485-4147369969-3056774085-3969564951-1913080067\tCoreUI S-1-5-80-2720979471-2110640377-1938553337-2954392914-939353058\tCredentialEnrollmentManagerUserSvc S-1-5-80-2870883986-4281173727-708603794-2134363143-2686522016\tCredentialEnrollmentManagerUserSvc_50fad S-1-5-80-3427364867-2348656012-3079877547-1505400018-1601214341\tdam S-1-5-80-2667170245-2239725068-1742831399-533342241-2651120191\tdcsvc S-1-5-80-1692619910-1358769708-3047346990-2477994898-1876611151\tDeviceAssociationBrokerSvc S-1-5-80-933457078-909669165-2371787725-499192611-2576228100\tDeviceAssociationBrokerSvc_50fad S-1-5-80-2536636004-4072673470-1048721469-2703517266-1433793019\tDeviceAssociationService S-1-5-80-2659457741-469498900-3203170401-3149177360-3048467625\tDeviceInstall S-1-5-80-3981010603-2563310902-4138807455-2513867770-1689624316\tDevicePickerUserSvc S-1-5-80-1542622939-2432071804-441627781-2155588311-412164416\tDevicePickerUserSvc_50fad S-1-5-80-1731526583-713188386-1588570932-65458670-665563417\tDevicesFlowUserSvc S-1-5-80-2139216848-1834768328-3639298086-1478984899-2276215200\tDevicesFlowUserSvc_50fad S-1-5-80-1646229720-1474186231-1049421145-3719583575-3014288788\tDevQueryBroker S-1-5-80-3837255464-839197112-3211601036-3795322556-2690640524\tDfsc S-1-5-80-3427281794-3208260282-895156161-4152208786-3156774898\tdiagnosticshub.standardcollector.service S-1-5-80-2291377395-3838044599-2142290114-2473825573-3813973113\tdiagsvc S-1-5-80-2620808479-2171380039-3191355562-2070425692-3097948119\tDiagTrack S-1-5-80-2947989659-52033649-2604989816-125447294-1386081903\tDialogBlockingService S-1-5-80-1827140278-1118305254-4004251663-1512899043-4081885502\tdisk S-1-5-80-4171086659-1617898341-2870161492-1466607281-2109097600\tDispBrokerDesktopSvc S-1-5-80-3914275374-678031271-1603343729-3906112567-2888048264\tDisplayEnhancementService S-1-5-80-538170410-2190149038-799223143-2506663053-4165713448\tDmEnrollmentSvc S-1-5-80-2597136289-665204401-1725106016-1253143166-1853691573\tdmvsc S-1-5-80-3841379657-834162867-3056945855-2577476187-70241904\tdmwappushservice S-1-5-80-3055155277-3816794035-3994065555-2874236192-2193176987\tDoSvc S-1-5-80-286057374-2594772386-1471686342-3682429118-820474675\tDsmSvc S-1-5-80-1551822644-3134808374-1042292604-2865742758-3851661496\tDsSvc S-1-5-80-4071458001-3563271761-1846288968-3700919931-3809667977\tDusmSvc S-1-5-80-1830903284-3590783070-1256105943-1989567323-3273248812\te1i65x64 S-1-5-80-3578261754-285310837-913589462-2834155770-667502746\tEaphost S-1-5-80-263376457-2115425240-177348680-1339839713-3837480443\tedgeupdate S-1-5-80-605514040-344704999-4120406818-2499438505-150840210\tedgeupdatem S-1-5-80-2169634130-1039499152-2857656644-2663134321-2733247747\tEhStorClass S-1-5-80-286318078-2644501994-4034150745-2802514947-3987682007\tEhStorTcgDrv S-1-5-80-197064213-1107091946-1970926662-1288706631-716503202\tembeddedmode S-1-5-80-2744483880-3889877944-846434063-3461941807-3140553215\tEntAppSvc S-1-5-80-880578595-1860270145-482643319-2788375705-1540778122\tEventLog S-1-5-80-2617507558-3328795327-711547822-311560295-1636921165\tfhsvc S-1-5-80-1314638815-3435960472-2727226528-1675998635-1902597435\tFileCrypt S-1-5-80-3915894004-2104103821-3047269622-1811662266-774708259\tFrameServer S-1-5-80-3181391832-1165339916-824804796-1846270512-1987055954\tgencounter S-1-5-80-4137420670-1714900858-4048147207-1486404520-2727663781\tgenericusbfn S-1-5-80-75387917-508843547-2432396020-3132913102-4137377952\tGoogleChromeElevationService S-1-5-80-3892015463-3880225558-716464106-2623782912-3537878324\tGPIOClx0101 S-1-5-80-45206258-3912194098-2707507260-3008220167-2543420661\tGpuEnergyDrv S-1-5-80-1517824832-3405227061-4234718464-3265367437-2784406453\tGraphicsPerfSvc S-1-5-80-1628851891-332911214-942992855-2381080451-357317118\tgupdate S-1-5-80-1391398224-2746689181-3888380295-1755171859-6364376\tgupdatem S-1-5-80-1708301557-710215499-1045718168-382692165-3542596111\tHdAudAddService S-1-5-80-1632474125-2303985310-1465129739-461431387-3339616311\thidi2c S-1-5-80-595487790-2902857704-1637225563-1046489922-3656573765\thidinterrupt S-1-5-80-3338532743-2167017084-2688270890-3351665506-1257551220\thidspi S-1-5-80-2718569444-1738374061-3304332439-3451140840-1824115491\thvcrash S-1-5-80-44780642-2200031541-2427509763-915290973-996987375\tHvHost S-1-5-80-2939390288-356272421-3595829934-3436785230-198171780\thvservice S-1-5-80-2274115272-1034313707-3787864051-261592831-2149061657\tHwNClx0101 S-1-5-80-1636647319-4072889561-245816251-3892323420-125393640\thyperkbd S-1-5-80-1568740187-908130129-1280451789-1901112753-2221687382\tHyperVideo S-1-5-80-2670277838-3947594761-3239889572-3393358898-1622853222\tiagpio S-1-5-80-2158641323-386083531-4194214369-34619318-3813434458\tiai2c S-1-5-80-1751987400-2816258287-31600907-3962047115-1737274117\tiaLPSS2i_GPIO2 S-1-5-80-1111475540-466917029-2679550370-2578483454-692614412\tiaLPSS2i_GPIO2_BXT_P S-1-5-80-1739240851-3621344408-1713079411-1646377490-2636667785\tiaLPSS2i_GPIO2_CNL S-1-5-80-2673509282-3250608688-4161211656-2193043397-2070765280\tiaLPSS2i_GPIO2_GLK S-1-5-80-2560230824-2699639875-2946887507-2809778676-469529665\tiaLPSS2i_I2C S-1-5-80-12980661-1673373748-4127468638-2895847452-4070398594\tiaLPSS2i_I2C_BXT_P S-1-5-80-2145177943-2751001835-2841195933-1950876073-3621000904\tiaLPSS2i_I2C_CNL S-1-5-80-780176066-3721089017-3511631931-2580781662-523231243\tiaLPSS2i_I2C_GLK S-1-5-80-1532184652-4035834151-1950529856-1922329247-3348818483\tiaLPSSi_GPIO S-1-5-80-730113209-3859422966-2743155648-3421359225-3886647409\tiaLPSSi_I2C S-1-5-80-3323158773-131258738-3057376072-3701579410-1953672022\tiaStorAV S-1-5-80-2020084033-1359107645-3278428846-795142582-1815602196\tiaStorAVC S-1-5-80-3391758085-3386442682-1652486205-1841141806-1992729197\tibbus S-1-5-80-3935728946-315639613-922904133-3250794525-491832002\ticssvc S-1-5-80-2392126525-1736915593-2210125632-2563158532-2616938475\tIndirectKmd S-1-5-80-2284069148-621670086-2606570695-3321162879-2563206788\tInstallService S-1-5-80-3327892994-1960904528-3982671949-1654996949-2464229733\tintelpep S-1-5-80-1900340034-3449890540-182776197-3466871519-875942235\tintelpmax S-1-5-80-3964494243-732302783-2234246214-3803256551-723791621\tiorate S-1-5-80-1954766798-2967939946-3605743322-553214224-2296400261\tIPT S-1-5-80-2355113075-3359631449-3346493237-3667020425-1655874352\tIpxlatCfgSvc S-1-5-80-3226934113-1398865432-993897477-3177498405-3382167683\tItSas35i S-1-5-80-2148130874-1768494572-716210-54149643-3932447678\tkbldfltr S-1-5-80-2271880911-1251856977-1706928486-259807789-537220688\tkdnic S-1-5-80-2876499719-392125430-158013367-819050375-2387260967\tksthunk S-1-5-80-3704025948-1094794811-1175534343-2088422159-783153058\tlfsvc S-1-5-80-2168654060-3115992504-1782388893-2584760693-2634250426\tLicenseManager S-1-5-80-828721388-3792639465-1596558500-741975338-1843353865\tLSI_SAS2i S-1-5-80-1292554068-3641467945-3524739894-1349342977-636852090\tLSI_SAS3i S-1-5-80-4045025553-2976580352-2420774707-2188590102-3192113229\tLSI_SSS S-1-5-80-1230977110-1477712667-2747199032-477530733-939374687\tLSM S-1-5-80-1594061079-2000966165-462148798-751814865-2644087104\tLxpSvc S-1-5-80-3028837079-3186095147-955107200-3701964851-1150726376\tMapsBroker S-1-5-80-3114654814-2921064011-1905572160-152804539-1417807178\tmausbhost S-1-5-80-1689786627-2800348145-589537150-160302296-3926153891\tmausbip S-1-5-80-482631164-113973055-3624764966-2186786627-2645029274\tMbbCx S-1-5-80-1346060813-323363712-587550660-3142329655-742851739\tMcpManagementService S-1-5-80-1684110676-2342826027-2954792854-2461032557-4007556361\tmegasas2i S-1-5-80-2869657570-1778740833-83850822-3186679656-2472655231\tmegasas35i S-1-5-80-4024713676-1017792628-381990976-3540878265-1306153904\tmegasr S-1-5-80-3999755614-3418583833-1896887384-2999918798-210212794\tMessagingService S-1-5-80-202946138-985291779-3159394747-43634094-4075641753\tMessagingService_50fad S-1-5-80-450487634-32044177-1119026171-1009345945-1629791242\tMicrosoftEdgeElevationService S-1-5-80-1290887583-3890804311-3227577290-3287571674-2651233138\tMicrosoft_Bluetooth_AvrcpTransport S-1-5-80-1543190384-3367925291-586273452-2558737455-3425399499\tMixedRealityOpenXRSvc S-1-5-80-3755756047-2886117673-2566125725-1838300879-2590056170\tmlx4_bus S-1-5-80-3088073201-1464728630-1879813800-1107566885-823218052\tmpssvc S-1-5-80-766433145-569980108-2081788762-104033110-3841863914\tMsBridge S-1-5-80-61387632-1770052757-913906803-2764154990-1232092381\tMSDTC Bridge 4.0.0.0 S-1-5-80-1709243854-2721926396-509980330-3397245316-2789600492\tmsgpiowin32 S-1-5-80-2335093085-4288963418-862046716-1348633750-1984735259\tmshidumdf S-1-5-80-3719317199-3405270365-2794832041-2304024896-2914089004\tMsKeyboardFilter S-1-5-80-2542081156-3563385132-3937647205-2588572414-2394664210\tMsLldp S-1-5-80-2804434951-625509142-572389148-2638030035-2993097285\tMsQuic S-1-5-80-3977605483-200570079-739940831-2932290302-2649018641\tMsSecCore S-1-5-80-1868534811-1113969215-1254686383-3122237719-2449736172\tMsSecFlt S-1-5-80-3642563950-456203802-1490755371-2601848954-63880797\tMsSecWfp S-1-5-80-4018724706-2388594414-778837249-3759549757-2342992247\tmvumis S-1-5-80-1693791390-661026542-4284378996-1616250691-2477593537\tNaturalAuthentication S-1-5-80-154974075-1852685594-3179713959-2755908004-3936262621\tNcaSvc S-1-5-80-3169048008-2586333165-76651690-3609634147-4147641610\tNcbService S-1-5-80-639065985-1709096039-2702309040-2770678766-2981280942\tNcdAutoSetup S-1-5-80-1929895091-2833432830-2697471735-1135988795-2264472352\tndfltr S-1-5-80-375564701-3513094222-427343084-2529536460-2480510224\tNdisImPlatform S-1-5-80-1856495872-3151408123-1737732000-490184210-1622466692\tNdisVirtualBus S-1-5-80-3687920589-2211470767-2846922358-2300776228-356028302\tndiswanlegacy S-1-5-80-1488665879-159185889-877450046-2151251822-3875779066\tNDKPing S-1-5-80-3999445478-1493703614-491198216-2250085872-3662815299\tndproxy S-1-5-80-1235769596-2241049241-3512080025-3142132805-3400791542\tNdu S-1-5-80-2475926400-260174619-1668875208-528473860-3272058262\tNetAdapterCx S-1-5-80-2038182892-1846284197-1242326240-2615352543-44767121\tNetbiosSmb S-1-5-80-3290392786-819420393-1694314755-3737624005-3552167228\tNetSetupSvc S-1-5-80-3551186791-2451211144-2320551185-397537932-3221552100\tnetvsc S-1-5-80-2381253463-2694003897-3435975801-3559003598-683041300\tNgcCtnrSvc S-1-5-80-1999281942-4196217620-51267815-1628483199-606183737\tNgcSvc S-1-5-80-389868755-419489745-3026704534-2242740522-2006634936\tnpsvctrig S-1-5-80-3903180505-3896017075-4285990333-2375284902-1925993444\tnvdimm S-1-5-80-3753458296-2578515382-296172075-2568624853-485985677\tOneSyncSvc S-1-5-80-3515428-2931623117-804653153-3478930650-257201455\tOneSyncSvc_50fad S-1-5-80-3145084533-2700894668-2078824647-1465192519-3266618331\tpdc S-1-5-80-4215928932-1248355774-1205732377-1093571376-2379325634\tperceptionsimulation S-1-5-80-1046995410-3007147168-922272172-967041193-3794187727\tpercsas2i S-1-5-80-42157666-624349265-169177574-52107575-3728749841\tpercsas3i S-1-5-80-3596911058-2952229928-1888671852-1743692427-614402820\tPerfHost S-1-5-80-2636612206-2079418197-1004231589-1812192203-4197254245\tPhoneSvc S-1-5-80-2428418161-1754247685-758903264-2475084861-4167363882\tPimIndexMaintenanceSvc S-1-5-80-3410280176-3299602888-1332419371-1911054326-2542463980\tPimIndexMaintenanceSvc_50fad S-1-5-80-2785576034-242416339-385417889-2054053173-3638954698\tPktMon S-1-5-80-3355885494-318102177-1313724702-1621550881-803011355\tpmem S-1-5-80-3239442711-4074742016-684152919-2253013163-2274039561\tPNPMEM S-1-5-80-3082810783-1413926421-1831856127-837733229-953361461\tportcfg S-1-5-80-1250897762-2760119941-576021590-2872322938-624617480\tPrintNotify S-1-5-80-3011530997-228986608-3623458339-2361303491-1043592577\tPrintWorkflowUserSvc S-1-5-80-1552224136-2279772909-4069248841-1973210782-3001653797\tPrintWorkflowUserSvc_50fad S-1-5-80-2949785411-1458004381-4011503523-1439849274-3428788682\tPushToInstall S-1-5-80-1681795462-3431334705-92433549-1962541325-160118133\tRamdisk S-1-5-80-2223301817-4248418169-3249847036-321434835-1272792247\tRDMANDK S-1-5-80-1934309797-2043993622-339923705-3871978825-766431271\tRDPUDD S-1-5-80-3072462152-34466603-861212222-1753422877-4071721522\tRdpVideoMiniport S-1-5-80-1596569074-2677311441-962104887-2749517281-2857086053\tReFS S-1-5-80-2316697869-4025289487-468236631-2575080373-2608813053\tReFSv1 S-1-5-80-457603595-166122335-4119162879-888033224-3685571132\tRetailDemo S-1-5-80-2932307366-730193993-4255125875-3321969383-2534286350\tRFCOMM S-1-5-80-3216188369-3897538938-543323431-4144952942-4182718943\trhproxy S-1-5-80-3765985997-1043742756-2756022526-3497566756-2081646175\tRmSvc S-1-5-80-3993802144-2555107232-3516638766-2735499450-3275915967\tScDeviceEnum S-1-5-80-739156932-4202345562-1098723576-2529635932-2179704457\tscmbus S-1-5-80-3730768523-2660761635-2080149804-588026050-2891317352\tsdbus S-1-5-80-2993119251-3416827737-2039089254-2988278179-172925588\tSDFRd S-1-5-80-106427005-851153787-2361826242-1841078065-3276170637\tsdstor S-1-5-80-259296475-4084429506-1152984619-38739575-565535606\tSecurityHealthService S-1-5-80-2226967063-754826275-1661302337-2802353169-2369347280\tSEMgrSvc S-1-5-80-1523878533-411328482-2798077809-3098663872-2604013308\tSense S-1-5-80-3835358604-2805616403-1686431098-2148037164-3679743528\tSensorDataService S-1-5-80-869152694-422618349-3448047118-1397179936-2828741493\tSensorService S-1-5-80-3391662211-1836087953-1525834830-1506885508-682969218\tSerCx S-1-5-80-3290564682-3359114709-1529561987-4148060287-271116923\tSerCx2 S-1-5-80-1582054788-470990004-40152839-730814383-1124151202\tSgrmAgent S-1-5-80-3706850399-3459138796-2835936764-562029542-397710147\tSgrmBroker S-1-5-80-3246321066-2451215914-3422911474-2201726393-166328789\tSharedRealitySvc S-1-5-80-4106268995-3617844033-680706512-3896918354-2380077472\tshpamsvc S-1-5-80-3842628764-1253170212-1172882037-4289227758-4267631040\tSmartSAMD S-1-5-80-1821507682-1115666477-1591553307-1734210999-3312719974\tsmbdirect S-1-5-80-230328282-2568015442-686465752-3474446193-2137307224\tsmphost S-1-5-80-2950457502-2299174248-3328245479-1326271200-3113355612\tSmsRouter S-1-5-80-217413056-3833387362-178569430-1954288181-1272411947\tSMSvcHost 4.0.0.0 S-1-5-80-2030916845-920430783-420616369-4268599728-1745276005\tspaceparser S-1-5-80-3804375463-2979979117-3280645550-3527107762-3022760719\tspaceport S-1-5-80-664203522-3160570195-1635065499-2708521076-3299712393\tSpatialGraphFilter S-1-5-80-3979690135-2752926531-2282419748-2415739691-1066856619\tSpbCx S-1-5-80-2731152606-4244467407-1946816704-3721569673-479255522\tspectrum S-1-5-80-2277354432-2697620045-1656008878-1855416240-261295475\tssh-agent S-1-5-80-4118144674-975173503-976751360-2062754009-4288402176\tStateRepository S-1-5-80-3182985763-1431228038-2757062859-428472846-3914011746\tstisvc S-1-5-80-341174513-3036333638-3617001766-2776055326-2809179524\tstorahci S-1-5-80-4243609067-2923323804-3669886039-3498181113-4202203050\tstornvme S-1-5-80-2198686546-2221861197-1858316108-2015056224-400908585\tstorqosflt S-1-5-80-2019411066-3003329723-2609168412-3625837524-2221108837\tstorufs S-1-5-80-2483706823-3321877870-553300257-593996131-450212729\tsvsvc S-1-5-80-927584136-3246479672-3996289350-2713334021-2098405977\tSynth3dVsc S-1-5-80-1662832393-3268938575-4001313665-1200257238-783911988\tSystemEventsBroker S-1-5-80-842221325-3630721446-2015653073-424833842-1069621030\tTcpip6 S-1-5-80-1003279123-1651757316-1243245493-3539186934-1753552613\tTelemetry S-1-5-80-3141112300-3466319987-880208219-2791244925-2953947883\tterminpt S-1-5-80-427241336-4111990062-2791250970-2845566439-1217505164\tTieringEngineService S-1-5-80-410965207-2550896871-1717734767-2321332215-3755966139\tTimeBrokerSvc S-1-5-80-4077216321-3151206942-641340059-4241647091-1300899357\tTokenBroker S-1-5-80-325036955-4200148024-1479951852-2634116931-2865895459\tTPM S-1-5-80-1139522462-2689595747-457373284-4037083511-4201549542\tTroubleshootingSvc S-1-5-80-3547539953-1452514991-991928397-2821742631-2888215071\tTsUsbFlt S-1-5-80-651631395-3385332028-373277408-2457879084-1955742111\tTsUsbGD S-1-5-80-2292203918-1506848946-3955473809-4024494573-4108135173\ttsusbhub S-1-5-80-3641914668-2724251012-1186334157-2460844255-322272688\ttzautoupdate S-1-5-80-3033002672-3264167506-3374793840-2611327823-1324250788\tUASPStor S-1-5-80-3559279508-480464440-2060053639-2450836018-584673110\tUcmCx0101 S-1-5-80-986347966-4291837576-3105858776-4112886612-1615276934\tUcmTcpciCx0101 S-1-5-80-2946873420-2809826944-3342656785-1798640712-1793966795\tUcmUcsiAcpiClient S-1-5-80-3947455493-1779752151-1865639843-1092346862-2012747891\tUcmUcsiCx0101 S-1-5-80-3476958810-2644384738-2655413726-1639285643-1444265662\tUcx01000 S-1-5-80-227846823-3077342265-3698762170-815164292-2633305508\tUdeCx S-1-5-80-2008930627-2960539461-4086452603-1305618659-1299222103\tUdkUserSvc S-1-5-80-2960622349-2603655608-463014845-353330955-2631882611\tUdkUserSvc_50fad S-1-5-80-259741192-1658403178-390766877-3226735796-603445823\tUEFI S-1-5-80-3429946394-717031342-3915206314-2329540128-2872892288\tUevAgentDriver S-1-5-80-1639943639-1314739636-372181295-777240325-3530900257\tUevAgentService S-1-5-80-1983721769-1446015346-1638820087-833790554-4117195697\tUfx01000 S-1-5-80-2486803200-2786917169-1479676890-818817034-2254858114\tUfxChipidea S-1-5-80-3461039289-3711732118-2967254728-2566641523-4135479736\tufxsynopsys S-1-5-80-951045732-3304998411-4140413591-2375454759-2566081399\tUnistoreSvc S-1-5-80-1232783531-1412289346-3408063018-2430219916-590553325\tUnistoreSvc_50fad S-1-5-80-948646300-214352964-3153699637-3534669071-395810831\tUrsChipidea S-1-5-80-311046983-1549683341-1485789459-3189993376-3259784172\tUrsCx01000 S-1-5-80-3858170093-3095794678-3940928812-3402197675-2417274444\tUrsSynopsys S-1-5-80-1038357558-2508750332-1127516358-2098882773-1571978916\tusbaudio S-1-5-80-3715696977-77976676-2422196092-1701963391-244329408\tusbaudio2 S-1-5-80-2532058633-1854360046-4195713749-973563373-2229526857\tUSBHUB3 S-1-5-80-322830934-407560818-413383929-2953137197-2859522744\tusbser S-1-5-80-811199202-3756583514-1800339595-8156802-767824446\tUSBXHCI S-1-5-80-2995899262-2131376444-1860748247-2210972999-1941275431\tUserDataSvc S-1-5-80-339627148-1085118590-1191147914-145126631-47496027\tUserDataSvc_50fad S-1-5-80-2008603874-3981339663-2468433650-2111681540-3858834245\tUserManager S-1-5-80-223807737-1693445485-119162242-1977420160-1403034029\tUsoSvc S-1-5-80-1989757894-211065159-731672622-1783776043-3948168785\tVacSvc S-1-5-80-2231687835-1975921998-2379643093-1123054981-1892632637\tVerifierExt S-1-5-80-2337629457-4082528419-1990172282-783805348-776062068\tvhf S-1-5-80-4056652736-3832535469-1849010726-800110142-2900318757\tVid S-1-5-80-4005553843-2860153778-2672767370-1614289598-2532660634\tVirtualRender S-1-5-80-3419770058-1088902930-2242902800-2505332296-3985202246\tvmgid S-1-5-80-3074984378-4122987768-2130325677-2031866499-3405430279\tvmicguestinterface S-1-5-80-534935901-3437432317-481271085-1710633381-983106267\tvmicheartbeat S-1-5-80-1877308096-3090306141-3032871208-3115266146-1400827410\tvmickvpexchange S-1-5-80-3076811988-2254870394-2658297454-3934945422-2393138642\tvmicrdv S-1-5-80-3110303136-3426481729-3186938678-1087894076-2178433439\tvmicshutdown S-1-5-80-3098585136-2538892366-1097114017-2832417424-2016953023\tvmictimesync S-1-5-80-235582178-102246843-358262472-4132936818-1867412993\tvmicvmsession S-1-5-80-1752088424-1054500994-3489791022-3310831482-3926524968\tvmicvss S-1-5-80-2476029939-3227366791-4018265514-4032530291-4172793725\tvolume S-1-5-80-1770745653-882454895-2389083440-3735684190-802018898\tvpci S-1-5-80-1072045427-3277916734-2175442256-760694638-1728218837\tVSTXRAID S-1-5-80-3303534547-3920260423-752829696-1552054067-268166277\tvwififlt S-1-5-80-2169053098-454685327-3448947123-3791923320-414336915\tWaaSMedicSvc S-1-5-80-1874328037-1620432936-4113708365-722077214-3851787529\tWalletService S-1-5-80-145391760-3682396335-1395736941-2543690743-1822485816\twanarp S-1-5-80-3957613141-1606606214-622769385-3049525404-2510868034\twanarpv6 S-1-5-80-2145785123-2886438689-3072542501-3020378507-1504386134\tWarpJITSvc S-1-5-80-1468946484-2183346801-2582215073-2203958287-114577455\twcifs S-1-5-80-4155767994-3874329934-3800885181-2130851812-726865888\tWcmsvc S-1-5-80-486657452-3436462838-2743705563-1382716400-3286987141\twcnfs S-1-5-80-3188579509-896559776-1549670742-2760322350-3311614235\tWdBoot S-1-5-80-2003142183-3009844670-3971145999-3073937758-3917121208\tWdFilter S-1-5-80-499275411-3916059529-905482537-4117857359-1999665194\twdiwifi S-1-5-80-2105769960-3462231971-121635667-3410645665-2561607156\tWdmCompanionFilter S-1-5-80-2946744033-2833218566-1164540619-314168540-3391284662\tWdNisDrv S-1-5-80-3668810961-2468724468-4084584310-3029221373-430494444\tWdNisSvc S-1-5-80-1282825935-788281630-359899028-1878232204-2860951615\tWEPHOSTSVC S-1-5-80-1495648203-2503502111-1597754693-3445174711-1316708627\tWFDSConMgrSvc S-1-5-80-2768376765-85268660-951480638-2317617532-3422828864\tWFPLWFS S-1-5-80-533360197-2630880149-807505739-2151714924-2570839994\tWiaRpc S-1-5-80-3488966095-3237316714-2152248236-3202922946-3275547626\tWindows Workflow Foundation 4.0.0.0 S-1-5-80-1314485122-3970895080-1653179290-3214604197-56682579\tWindowsTrustedRT S-1-5-80-2899914805-2506168806-919368875-2051509565-976885860\tWindowsTrustedRTProxy S-1-5-80-350045039-4213533676-3741949053-609707664-895491048\tWinMad S-1-5-80-4015764710-1917268369-2628323210-1820452808-4095801055\tWinNat S-1-5-80-2971715461-3208067863-1422018366-770925591-1162363329\tWINUSB S-1-5-80-1409370327-2262994431-3181734005-3492817815-127119016\tWinVerbs S-1-5-80-2429767553-128593128-2427591838-1778256749-2155598187\twisvc S-1-5-80-1428027539-3309602793-2678353003-1498846795-3763184142\tWlanSvc S-1-5-80-2952724807-2252311773-3412998076-2712868122-780978283\twlidsvc S-1-5-80-3916113136-2435487254-2535488001-4050622930-2364918814\twlpasvc S-1-5-80-3577588319-513283748-931039988-2701962192-2148388740\tWManSvc S-1-5-80-1635442456-4231674260-3066288937-1147435026-1365933032\tWof S-1-5-80-3413159032-3694667005-1396569551-1250786377-1429361823\tworkerdd S-1-5-80-3006764832-2469330069-4024865495-2754276538-3243839463\tworkfolderssvc S-1-5-80-2657955583-569354589-921901904-1883788092-850583853\tWpcMonSvc S-1-5-80-358856340-4190185137-1150018170-4132368399-2594611401\tWpdUpFltr S-1-5-80-1938892561-4120931771-3580170924-3403102300-2651602529\tWpnService S-1-5-80-951620777-1059631183-2804607755-3010024351-809615488\tWpnUserService S-1-5-80-1069300804-2231982870-930986846-425802403-2676852813\tWpnUserService_50fad S-1-5-80-1803441692-2341117941-3526855333-3767870088-2684717574\tWUDFWpdFs S-1-5-80-472864980-3821642676-709327584-2321888604-4243627364\tXblAuthManager S-1-5-80-2649222292-2060825207-2866066902-505902355-282187514\tXblGameSave S-1-5-80-794853676-1269112726-2386671565-1760138502-3367587780\txboxgip S-1-5-80-3605394182-687838168-1441221562-1662690741-4241567093\tXboxGipSvc S-1-5-80-1352715831-1104254428-97934242-2131353953-1898040052\tXboxNetApiSvc S-1-5-80-1281037624-1782002805-990284447-3522102690-2853398433\txinputhid 3. Puertos abiertos Volatility parece ser que no tiene soporte para esta funcionalidad para Windows 10/11 , as√≠ que lo har√© desde la propia powershell de la maquina :\n(volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.netstat Volatility 3 Framework 2.5.2 PS C:\\Windows\\system32\u0026gt; Get-NetTCPConnection | Where-Object {$_.State -eq \u0026#39;Listen\u0026#39;} | Select-Object LocalAddress, LocalPort LocalAddress LocalPort ------------ --------- :: 49670 :: 49669 :: 49668 :: 49667 :: 49666 :: 49665 :: 49664 :: 7680 :: 5357 :: 3389 :: 445 :: 135 0.0.0.0 49670 0.0.0.0 49669 0.0.0.0 49668 0.0.0.0 49667 0.0.0.0 49666 0.0.0.0 49665 0.0.0.0 49664 0.0.0.0 5040 0.0.0.0 3389 192.168.122.203 139 0.0.0.0 135 4. Conexiones establecidas por la m√°quina Al igual que el punto anterior , parece que volatility no tiene soporte para las versiones actuales de windows :\n(volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.netscan.NetScan PS C:\\Windows\\system32\u0026gt; Get-NetTCPConnection | Where-Object {$_.State -eq \u0026#39;Established\u0026#39; -and $_.LocalAddress -ne \u0026#39;127.0.0.1\u0026#39;} | Select-Object LocalAddress, LocalPort, RemoteAddress, RemotePort, State LocalAddress : 192.168.122.203 LocalPort : 49855 RemoteAddress : 142.250.200.138 RemotePort : 443 State : Established LocalAddress : 192.168.122.203 LocalPort : 49853 RemoteAddress : 184.28.177.55 RemotePort : 80 State : Established LocalAddress : 192.168.122.203 LocalPort : 49846 RemoteAddress : 2.20.253.149 RemotePort : 443 State : Established LocalAddress : 192.168.122.203 LocalPort : 49845 RemoteAddress : 184.28.177.9 RemotePort : 443 State : Established 5. Sesiones de usuario establecidas remotamente (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.sessions.Sessions Volatility 3 Framework 2.5.2 Progress: 100.00\tPDB scanning finished Session ID\tSession Type\tProcess ID\tProcess\tUser Name\tCreate Time N/A\t-\t4\tSystem\t-\t2024-02-05 19:30:59.000000 N/A\t-\t92\tRegistry\t-\t2024-02-05 19:30:56.000000 N/A\t-\t344\tsmss.exe\t-\t2024-02-05 19:30:59.000000 0\t-\t448\tcsrss.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t516\twininit.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t648\tservices.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t668\tlsass.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 0\t-\t768\tfontdrvhost.ex\tFont Driver Host/UMFD-0\t2024-02-05 19:31:15.000000 0\t-\t788\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:15.000000 0\t-\t880\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:15.000000 0\t-\t400\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t444\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t584\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1032\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1040\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1244\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1460\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1520\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1572\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1924\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1956\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1052\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t1068\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1232\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t1568\tspoolsv.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:16.000000 0\t-\t2052\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:16.000000 0\t-\t2300\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:17.000000 0\t-\t2412\tMsMpEng.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:17.000000 0\t-\t2868\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:18.000000 0\t-\t3044\tdasHost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:18.000000 0\t-\t664\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:19.000000 0\t-\t3868\tWUDFHost.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 0\t-\t3068\tNisSrv.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:31:39.000000 0\t-\t4452\tSearchIndexer.\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:40.000000 0\t-\t5828\tWmiPrvSE.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:44.000000 0\t-\t6028\tGoogleCrashHan\t-\t2024-02-05 19:31:45.000000 0\t-\t6092\tGoogleCrashHan\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:45.000000 0\t-\t3236\tSecurityHealth\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:31:54.000000 0\t-\t7020\tsvchost.exe\tWORKGROUP/DESKTOP-KG80ESU$\t2024-02-05 19:33:17.000000 0\t-\t4788\tSgrmBroker.exe\t-\t2024-02-05 19:33:18.000000 0\t-\t760\tsvchost.exe\tNT AUTHORITY/SERVICIO LOCAL\t2024-02-05 19:33:18.000000 1\t-\t528\tcsrss.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 1\t-\t612\twinlogon.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 1\t-\t776\tfontdrvhost.ex\tFont Driver Host/UMFD-1\t2024-02-05 19:31:15.000000 1\t-\t988\tdwm.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 1\t-\t996\tLogonUI.exe\t/SYSTEM\t2024-02-05 19:31:15.000000 N/A\t-\t1768\tMemCompression\t-\t2024-02-05 19:31:16.000000 2\t-\t3792\tcsrss.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 2\t-\t3840\twinlogon.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 2\t-\t3960\tfontdrvhost.ex\tFont Driver Host/UMFD-2\t2024-02-05 19:31:38.000000 2\t-\t4020\tdwm.exe\t/SYSTEM\t2024-02-05 19:31:38.000000 2\t-\t3456\trdpclip.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3616\tsihost.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3400\tsvchost.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3188\ttaskhostw.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t3344\tctfmon.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:39.000000 2\t-\t4208\tuserinit.exe\t-\t2024-02-05 19:31:40.000000 2\tRDP-Tcp#1\t4236\texplorer.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:40.000000 2\t-\t4388\tsvchost.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:40.000000 2\t-\t4876\tStartMenuExper\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:41.000000 2\t-\t5096\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:42.000000 2\t-\t4732\tSearchApp.exe\t-\t2024-02-05 19:31:42.000000 2\t-\t5184\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:42.000000 2\t-\t3740\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:52.000000 2\t-\t1912\tsmartscreen.ex\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:54.000000 2\tRDP-Tcp#1\t3524\tSecurityHealth\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:54.000000 2\tRDP-Tcp#1\t820\tOneDrive.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:55.000000 2\tRDP-Tcp#1\t6128\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:56.000000 2\t-\t2040\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\tRDP-Tcp#1\t5404\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\tRDP-Tcp#1\t5392\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\tRDP-Tcp#1\t5348\tchrome.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\t-\t5496\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\t-\t6184\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\t-\t6200\tchrome.exe\t-\t2024-02-05 19:31:57.000000 2\t-\t6380\tTextInputHost.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:31:57.000000 2\t-\t6556\tdllhost.exe\t-\t2024-02-05 19:31:58.000000 2\t-\t6156\tchrome.exe\t-\t2024-02-05 19:33:00.000000 2\t-\t5284\tchrome.exe\t-\t2024-02-05 19:33:00.000000 2\t-\t4036\tchrome.exe\t-\t2024-02-05 19:33:05.000000 2\t-\t6916\tFTK Imager.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:11.000000 2\t-\t6044\tApplicationFra\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:14.000000 2\t-\t6104\tCalculator.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:14.000000 2\t-\t5864\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:14.000000 2\t-\t7348\tHxCalendarAppI\t-\t2024-02-05 19:33:20.000000 2\t-\t7412\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:20.000000 2\t-\t7476\tHxTsr.exe\t-\t2024-02-05 19:33:20.000000 2\t-\t7816\tTaskmgr.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:22.000000 2\t-\t8072\texplorer.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:34.000000 2\t-\t7256\tPaintStudio.Vi\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:39.000000 2\t-\t7796\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:40.000000 2\t-\t900\tTime.exe\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:42.000000 2\t-\t2132\tRuntimeBroker.\tDESKTOP-KG80ESU/javiercruces\t2024-02-05 19:33:43.000000 6. Ficheros transferidos recientemente por NetBios Volatility no tiene soporte para esta funci√≥n :\nAl estar en una red aislada sin ning√∫n otro Windows , no se han transferido ficheros usando este protocolo\nPS C:\\Windows\\system32\u0026gt; Get-WinEvent -LogName Security | Where-Object {$_.Message -match \u0026#34;EventID: 5140\u0026#34;} | Select-Object TimeCreated, @{Name=\u0026#34;File\u0026#34;;Expression={$_.Properties[8].Value}} PS C:\\Users\\javiercruces\u0026gt; NBTSTAT -n Ethernet: Direcci√≥n IP del nodo: [192.168.122.203] Id. de √°mbito : [] Tabla de nombres locales NetBIOS Nombre Tipo Estado --------------------------------------------- DESKTOP-KG80ESU\u0026lt;20\u0026gt; √önico Registrado DESKTOP-KG80ESU\u0026lt;00\u0026gt; √önico Registrado WORKGROUP \u0026lt;00\u0026gt; Grupo Registrado 7. Contenido de la cach√© DNS Volatility no tiene soporte para esta funci√≥n :\nPS C:\\Windows\\system32\u0026gt; ipconfig /displaydns Configuraci√≥n IP de Windows edgedl.me.gvt1.com ---------------------------------------- Nombre de registro . : edgedl.me.gvt1.com Tipo de registro . . : 1 Per√≠odo de vida . . . : 897 Longitud de datos . . : 4 Secci√≥n . . . . . . . : respuesta Un registro (host). . : 34.104.35.123 msedge.b.tlu.dl.delivery.mp.microsoft.com ---------------------------------------- Nombre de registro . : msedge.b.tlu.dl.delivery.mp.microsoft.com Tipo de registro . . : 5 Per√≠odo de vida . . . : 44 Longitud de datos . . : 8 Secci√≥n . . . . . . . : respuesta Registro CNAME. . . . : cdp-tlu-shim.trafficmanager.net 8. Variables de entorno (volatility) javiercruces@HPOMEN15:~/volatility3$ sudo python3 vol.py -f \u0026#34;/mnt/vdb/memoria/memdump.mem\u0026#34; windows.envars 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERDOMAIN\tDESKTOP-KG80ESU 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERDOMAIN_ROAMINGPROFILE\tDESKTOP-KG80ESU 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERNAME\tjaviercruces 2132\tRuntimeBroker.\t0x1ae8f803400\tUSERPROFILE\tC:\\Users\\javiercruces 2132\tRuntimeBroker.\t0x1ae8f803400\twindir\tC:\\Windows Analizando el Registro de Windows Para esto nos descargamos el Registry Viewer 2.0.0 https://www.exterro.com/ftk-product-downloads/registry-viewer-2-0-0\nAbrimos el fichero system que es el registro de Windows :\n9. Dispositivos USB conectados Autopsy: 10. Redes wifi utilizadas recientemente. Lo podemos encontrar en \u0026ndash;\u0026gt; system/ControlSet001/Control/Network/Connections\n11. Configuraci√≥n del firewall de nodo. system\\ControlSet001\\Services\\SharedAccess\\Parameters\\FirewallPolicy\n12. Programas que se ejecutan en el Inicio. software\\Microsoft\\Windows\\CurrentVersion\\Run\n13. Asociaci√≥n de extensiones de ficheros y aplicaciones. Esta debajo de este directorio \u0026ndash;\u0026gt; software\\Classes\n14. Aplicaciones usadas recientemente. 15. Ficheros abiertos recientemente. 16. Software Instalado. 17. Contrase√±as guardadas. 18. Cuentas de Usuario Podemos ver las respuestas a las preguntas de seguridad :\nCon Aplicaciones de terceros: 19. Historial de navegaci√≥n y descargas. Cookies. Historial : Descargas :\nCookies :\n20. Vol√∫menes cifrados Te muestra los FICHEROS cifrados :\nSobre la imagen del disco: 21. Archivos con extensi√≥n cambiada Nos fijaremos en que el tipo MIME coincida con la extensi√≥n : Tambi√©n hay un artefacto que nos permite ver los ficheros que est√°n con otra extensi√≥n :\n22. Archivos eliminados Tienes un apartado en especifico que te dice los ficheros borrados : Pero si navegas por los directorios , te informara si hay alg√∫n fichero borrado en el mismo :\n23. Archivos Ocultos 24. Archivos que contienen una cadena determinada 25. B√∫squeda de im√°genes por ubicaci√≥n. La ubicaci√≥n de autopsy no me localiza la imagen , as√≠ que usare una herramienta externa .\n26. B√∫squeda de archivos por autor. Apartado B M√°quina Linux. Intenta realizar las mismas operaciones en una m√°quina Linux para aquellos apartados que tengan sentido y no se realicen de manera id√©ntica a Windows.\nAl utilizar volatility para esta parte , no me reconoce los plugins para la versi√≥n especifica de Debian , los he generado siguiendo este tutorial : https://markuta.com/live-memory-acquisition-on-linux-systems/\nSin embargo no me los reconoce y he utilizado tanto volatility 2 como la versi√≥n 3 . Me conectare a la maquina y te indicare con comandos como mostrar cada ejercicio , no me queda otra . Lo que har√© sera redirigir la salida de los comandos a un fichero en el dispositivo en el que he almacenado los volcados .\n1. Procesos en ejecuci√≥n root@debian:~# ps aux \u0026gt; /mnt/procesos root@debian:~# cat /mnt/procesos USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND root 1 0.3 0.6 102660 12616 ? Ss 16:44 0:00 /sbin/init root 2 0.0 0.0 0 0 ? S 16:44 0:00 [kthreadd] root 3 0.0 0.0 0 0 ? I\u0026lt; 16:44 0:00 [rcu_gp] 2. Servicios en ejecuci√≥n root@debian:~# systemctl list-units --type=service --state=running \u0026gt; /mnt/servicios_corriendo root@debian:~# systemctl list-units --type=service --state=running UNIT LOAD ACTIVE SUB DESCRIPTION accounts-daemon.service loaded active running Accounts Service avahi-daemon.service loaded active running Avahi mDNS/DNS-SD Stack colord.service loaded active running Manage, Install and Generate Color Profiles 3. Puertos abiertos root@debian:~# ss -tuln \u0026gt; /mnt/puertos_abiertos root@debian:~# ss -tuln Netid State Recv-Q Send-Q Local Address:Port Peer Address:Port Process udp UNCONN 0 0 0.0.0.0:631 0.0.0.0:* udp UNCONN 0 0 0.0.0.0:42925 0.0.0.0:* 4. Conexiones establecidas por la m√°quina root@debian:~# ss -an \u0026gt; /mnt/conexiones_establecidas root@debian:~# ss -an u_dgr ESTAB 0 0 * 19629 * 19630 u_str ESTAB 0 0 /run/user/112/pipewire-0 19262 * 19261 u_str ESTAB 0 0 * 18971 * 18972 u_str ESTAB 0 0 * 18439 * 18440 5. Sesiones de usuario establecidas remotamente root@debian:~# who javiercruces pts/0 2024-02-18 16:44 (192.168.122.1) javiercruces pts/1 2024-02-18 16:46 (192.168.122.1) root@debian:~# who \u0026gt; /mnt/conexiones_remtoas 7. Contenido de la cach√© DNS root@debian:~# sudo journalctl -u systemd-resolved \u0026gt; /mnt/cachedns 8. Variables de entorno root@debian:~# env \u0026gt; /mnt/variables_entorno 9. Dispositivos USB conectados root@debian:~# lsusb Bus 002 Device 002: ID 46f4:0001 QEMU QEMU USB HARDDRIVE Bus 002 Device 001: ID 1d6b:0003 Linux Foundation 3.0 root hub Bus 001 Device 002: ID 0627:0001 Adomax Technology Co., Ltd QEMU Tablet Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub root@debian:~# lsusb \u0026gt; /mnt/usb_conectados 10. Redes wifi utilizadas recientemente Al ser un MV no tenemos historial de redes wifi 11. Configuraci√≥n del firewall de nodo root@debian:~# sudo iptables -L Chain INPUT (policy ACCEPT) target prot opt source destination Chain FORWARD (policy ACCEPT) target prot opt source destination Chain OUTPUT (policy ACCEPT) target prot opt source destination DROP tcp -- anywhere anywhere tcp dpt:9999 root@debian:~# sudo iptables -L \u0026gt; /mnt/firewall_nodo 12. Programas que se ejecutan en el Inicio root@debian:~# systemctl list-unit-files --type=service \u0026gt; /mnt/servicios_incio netfilter-persistent.service enabled enabled networking.service enabled enabled 13. Asociaci√≥n de extensiones de ficheros y aplicaciones root@debian:~# cat /usr/share/applications/mimeinfo.cache \u0026gt; /mnt/asosiacion_ficheros_ext 14. Aplicaciones usadas recientemente Lo mas parecido a esto , en Linux es ver que han hecho cada usuario , as√≠ que me traer√© todos los historiales :\nroot@debian:~# sudo cat /home/*/.bash_history \u0026gt; /mnt/historial_usuarios root@debian:~# sudo cat /root/.bash_history \u0026gt; /mnt/historial_root 15. Ficheros abiertos recientemente *Depender√° de la ruta de los ficheros , pondr√© un ejemplo para el home\nroot@debian:~# ls -lu /home/*/ \u0026gt; /mnt/ficheros_recientes 16. Software Instalado root@debian:~# dpkg --get-selections \u0026gt; /mnt/paquetes_instalados 17. Contrase√±as guardadas Algunas contrase√±as de configuraci√≥n se guardan dentro del directorio home de nuestro usuario , si queremos ver las del navegador , la encontraremos en el mismo lugar que autopsy .\n18. Cuentas de Usuario root@debian:~# cat /etc/passwd | cut -d \u0026#34;:\u0026#34; -f 1 \u0026gt; /mnt/lista_usuarios sshd debian user1 19. Historial de navegaci√≥n , descargas y Cookies Historial :\nCookies :\nDescargas :\nroot@debian:~# ls -l /home/*/Descargas \u0026gt; /mnt/descargas_usuarios 20. Vol√∫menes cifrados root@debian:~# lsblk -f | grep crypt ‚îî‚îÄsda1 crypto_LUKS 2 9fc1bfa7-9224-4e8e-896a-09516d4fd613 21. Archivos con extensi√≥n cambiada *No me carga el artefacto de Mismatch Detector , pero podemos verlo fijandonos en los metadatos :\n22. Archivos eliminados 23. Archivos Ocultos En Linux , todos los que empiezan por .\nroot@debian:~# find / -type f -name \u0026#34;.*\u0026#34; \u0026gt; /mnt/ficheros_ocultos 24. Archivos que contienen una cadena determinada root@debian:~# grep -rnw / -e \u0026#39;File\u0026#39; \u0026gt; /mnt/FicherosContienenFile 26. B√∫squeda de archivos por autor He intentado ya que no he podido utilizar volatility para estos ejercicios , usar comandos para poder realizar lass comprobaciones manualmente . Para darle mas seriedad a los ejercicios voy a sacar los hashes de las salidas de los diferentes comandos para asegurarnos de que no se modifiquen :\nroot@debian:~# find /mnt/* -type f -exec sha256sum {} + 5b46470021e68c2f5b517fa0bf3daeea665e525d3fa427326c53f93f09968d32 /mnt/asosiacion_ficheros_ext d9ed5ccc5da76e64a158605065f9bdccbb42dfa889d1b66d8c1660a4511065b4 /mnt/conexiones_establecidas 8c65702fe0e26bf57cb2138a618a3cd023be45a23c46e50c77fc191b36c842ca /mnt/conexiones_remtoas bf22d9341614e23448d92045f9ada00f2d62b00491261ec5843adca20e5a4b3a /mnt/descargas_usuarios b63693142f2823a95a11d9f1fcbd845c118b2fc5d0b2508586d0fc6c8fe482af /mnt/discoLinux.raw f5f82603dc58e22f0e38c70321ca1b28524b565b4a85264b07e06a5f9c967024 /mnt/FicherosContienenFile faf7aa5603cb456e86c320549a4b34c12f3167260cb0e8cbfc94ec3ebd42f1ab /mnt/ficheros_ocultos f767cd7a3d0802ebaebb3f18be2d188eb4c16f6a53444e9669f153a304cdb027 /mnt/ficheros_recientes cb910e861a19148c6249fa53cc5b957fb0ae2e0f37ef4081c77aa90e7dde7eb0 /mnt/firewall_nodo 61f44639402d823b9452ad6eaf66eff0ed078fe1cf512c0fdebc9bba9fb58fb1 /mnt/historial_root fed8854df34d3687edcd85697fda768ba58b88fa1b8d788bdd0d033b29209f85 /mnt/historial_usuarios 0a2c590ff6773acf9f601586cb4b013fb65bc32070019acb7368ae4212c07f8d /mnt/lista_usuarios 5f136603c0e34a74a58bc59f1934f5f2850ca8bec9c356a283ee7161a8f39a76 /mnt/memdebian.mem 1b503447d038a0ace6b81aaaf1390ac82ce6e08838a32e0b18b7656048794ebb /mnt/paquetes_instalados 8e29c5c098b2a664c23deb84abe943b666ca0dc05ce8020d0bb110b17e12d60a /mnt/procesos 9b889a5d5a59e615dc8fbbc4de9c5dbeaac1ae97990bab3dda39c3ef18c5dd72 /mnt/puertos_abiertos cf7776ea7ca74f27b5a650ad14b074d3ac400df1b2729bca2e6a9f74696e94c3 /mnt/servicios_corriendo b83d26c9829478eac7c19ff60eecc83b3d139fda26b5e057e882aefdaaeda7da /mnt/servicios_incio 17a519d6c20c48bd9cb39c4fd39dd107ee23c909712fada41cb75ba0d5cb703d /mnt/usb_conectados 575f849aed774bef68eb9cb85823030432afc6bfa3242ef4e1efe5cf14a98a0c /mnt/variables_entorno b419ec819114f21a10bc5146a0b28183165c8b2cf77b2fe160e3044b1b5e04a0 /mnt/vdb Bibliograf√≠a https://cibersec.iescampanillas.com/archivos/3046 https://markuta.com/live-memory-acquisition-on-linux-systems/ https://cpuu.hashnode.dev/how-to-perform-memory-forensic-analysis-in-linux-using-volatility-3 https://isf-server.techanarchy.net/ https://github.com/volatilityfoundation/volatility3?tab=readme-ov-file https://github.com/volatilityfoundation/dwarf2json\n","date":"March 28, 2024","hero":"/images/seguridad/informatica_forense.png","permalink":"https://www.javiercd.es/posts/seguridad/forense/forense/","summary":"\u003cp\u003eLa inform√°tica forense es el conjunto de t√©cnicas que nos permite obtener la m√°xima informaci√≥n posible tras un incidente o delito inform√°tico.\nEn esta pr√°ctica, realizar√°s la fase de toma de evidencias y an√°lisis de las mismas sobre una m√°quina Linux y otra Windows. Supondremos que pillamos al delincuente \u0026lsquo;in fraganti\u0026rsquo; y las m√°quinas se encontraban encendidas. Opcionalmente, pod√©is realizar el an√°lisis de un dispositivo Android.\nSobre cada una de las m√°quinas debes realizar un volcado de memoria y otro de disco duro, tomando las medidas necesarias para certificar posteriormente la cadena de custodia.\u003c/p\u003e","tags":["LINUX","DEBIAN","WINDOWS","FORENSE"],"title":"Inform√°tica Forense"},{"categories":null,"contents":"Para descargarnos la imagen de android puedes hacerlo desde esta pagina \u0026ndash;\u0026gt; https://www.fosshub.com/Android-x86.html :\nwget https://www.fosshub.com/Android-x86.html?dwl=android-x86_64-9.0-r2.iso Crea una maquina en KVM como si fuese un Debian , yo le he dado 2GB de RAM y 2 cores :\nEn nuestro caso podemos lanzar una instalaci√≥n autom√°tica :\nCuando tengas la maquina instalada , apaga la maquina y vamos a importarla en gns3 . Para ello vamos a llevarnos el disco de KVM y vamos a importarlo en el directorio donde hayamos instalado las im√°genes de GNS3 , luego haz propiedad del disco copiado a tu usuario .\ncp /var/lib/libvirt/images/android-wireguard.qcow2 /home/javiercruces/GNS3/images/QEMU/ javiercruces@HPOMEN15:~$ sudo chown javiercruces:javiercruces /home/javiercruces/GNS3/images/QEMU/android-wireguard.qcow2 Ahora accede a tu GNS3 y en preferencias vamos a a√±adir una nueva QEMU VMs :\nSelecciona el binario de emulaci√≥n x86_64 y asignale la memoria que consideres oportuna , a mi con 2GB me funciona correctamente :\nComo la imagen utiliza entorno gr√°fico vamos a seleccionar VNC :\nY selecciona el disco que hemos copiado a la carpeta images anteriormente :\n","date":"March 28, 2024","hero":"/images/redes/android_gns3/android.png","permalink":"https://www.javiercd.es/posts/redes/android_gns3/android/","summary":"\u003cp\u003ePara descargarnos la imagen de android puedes hacerlo desde esta pagina \u0026ndash;\u0026gt;  \u003ca href=\"https://www.fosshub.com/Android-x86.html\" target=\"_blank\" rel=\"noopener\"\u003ehttps://www.fosshub.com/Android-x86.html\u003c/a\u003e :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ewget https://www.fosshub.com/Android-x86.html?dwl\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eandroid-x86_64-9.0-r2.iso\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eCrea una maquina en KVM como si fuese un Debian , yo le he dado 2GB de RAM y 2 cores :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/redes/android_gns3/Pastedimage20240117194542.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEn nuestro caso podemos lanzar una instalaci√≥n autom√°tica :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/redes/android_gns3/Pastedimage20240117194647.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCuando tengas la maquina instalada , apaga la maquina y vamos a importarla en gns3 . Para ello vamos a llevarnos el disco de KVM y vamos a importarlo en el directorio donde hayamos instalado las im√°genes de GNS3 , luego haz propiedad del disco copiado a tu usuario .\u003c/p\u003e","tags":["GNS3","ANDORID","LINUX","DEBIAN","KVM"],"title":"Instalaci√≥n de android en GNS3 con KVM"},{"categories":null,"contents":"\nEn primer lugar configurare la maquina servidor1 como servidor VPN de acceso remoto y servidor2 como cliente VPN . Posteriormente configurare un cliente Windows y Android .\nLo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\nroot@servidor1:~# sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard debian@servidor2:~$ sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard Vamos a generar los pares de claves que se utilizar√°n para cifrar la conexi√≥n. Necesitaremos una clave para el servidor y un par de claves adicionales por cada cliente.\nComenzaremos con el par de claves del servidor1:\ndebian@servidor1:~$ wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= # Puedes visualizar la clave privada posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_private.key 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= # Puedes visualizar la clave publica posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= Nos desplazamos al servidor2 y les generamos las suyas :\n# Generamos el par de claves para el cliente de acceso remoto servidor2 debian@servidor2:~$ wg genkey | sudo tee /etc/wireguard/client_private.key | wg pubkey | sudo tee /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= # Puedes visualizar la clave privada posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_private.key 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= # Puedes visualizar la clave publica posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= Una vez generado las claves , vamos a proceder a configurar el servidor de acceso remoto Wireguard , en mi caso voy a llamar al fichero de configuraci√≥n wg0.conf . Voy a a√±adirte en cada par√°metro de la configuraci√≥n un comentario para que sepas que tienes que poner en cada campo :\ndebian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf [Interface] # IP que tendr√° el t√∫nel VPN , en concreto la interfaz wg0 que es como has llamado el fichero de conf Address = 10.99.99.1 #Clave privada del servidor PrivateKey = 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= #Puerto de escucha , 51820 es el puerto por defecto de Wireguard ListenPort = 51820 # Si no tienes activado el bit de forwarding por defecto puedes hacerlo asi : PreUp = sysctl -w net.ipv4.ip_forward=1 # Este apartado hace referencia a la configuraci√≥n de los clientes : [Peer] #Clave p√∫blica del cliente Publickey = gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= #IP del t√∫nel VPN del cliente AllowedIPs = 10.99.99.2/32 #Tiempo de espera que tendr√° activo el t√∫nel si no hay trafico PersistentKeepAlive = 25 Ahora configuraremos un cliente debian , le he dado el mismo nombre al fichero de configuraci√≥n por lo que la interfaz tambi√©n se llamara wg0 :\ndebian@servidor2:~$ sudo cat /etc/wireguard/wg0.conf [Interface] Address = 10.99.99.2/24 #Clave privada del cliente PrivateKey = 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= #Puerto de escucha del servidor ListenPort = 51820 [Peer] #Clave p√∫blica del servidor PublicKey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 0.0.0.0/0 #Punto de acceso del servidor Endpoint = 90.0.0.2:51820 #Tiempo de espera de la conexi√≥n PersistentKeepalive = 25 Una vez tenemos configurados ambos ficheros levantaremos el t√∫nel , para ello tenemos varias formas de hacerlo , personalmente la mas c√≥moda que veo es usando el comando wg-quick .\nLevantamos el t√∫nel en el servidor :\ndebian@servidor1:~$ sudo wg-quick up wg0 [#] sysctl -w net.ipv4.ip_forward=1 net.ipv4.ip_forward = 1 [#] ip link add wg0 type wireguard [#] wg setconf wg0 /dev/fd/63 [#] ip -4 address add 10.99.99.1 dev wg0 [#] ip link set mtu 1420 up dev wg0 [#] ip -4 route add 10.99.99.2/32 dev wg0 Levantamos el otro extremo , en este caso nuestro cliente es servidor2 :\ndebian@servidor2:~$ sudo wg-quick up wg0 [#] ip link add wg0 type wireguard [#] wg setconf wg0 /dev/fd/63 [#] ip -4 address add 10.99.99.2/24 dev wg0 [#] ip link set mtu 1420 up dev wg0 [#] wg set wg0 fwmark 51820 [#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820 [#] ip -4 rule add not fwmark 51820 table 51820 [#] ip -4 rule add table main suppress_prefixlength 0 [#] sysctl -q net.ipv4.conf.all.src_valid_mark=1 [#] iptables-restore -n Una vez hecho esto comprobaremos que en ambos extremos se nos ha creado una nueva interfaz , que se llama igual que nuestro fichero de configuraci√≥n sin la extensi√≥n .conf .\nComprobamos que se haya creado en servidor1 :\ndebian@servidor1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3 valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4 valid_lft forever preferred_lft forever 6: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000 inet 10.99.99.1/32 scope global wg0 valid_lft forever preferred_lft forever Comprobamos que se haya creado en servidor2 :\ndebian@servidor2:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 100.0.0.2/24 brd 100.0.0.255 scope global ens3 valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4 valid_lft forever preferred_lft forever 6: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN group default qlen 1000 inet 10.99.99.2/24 scope global wg0 valid_lft forever preferred_lft forever Tambi√©n comprobaremos las rutas que se nos ha creado en el servidor y en el cliente :\ndebian@servidor1:~$ ip r default via 90.0.0.1 dev ens3 onlink 10.99.99.2 dev wg0 scope link 10.99.99.4 dev wg0 scope link 90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 debian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.0/24 dev wg0 proto kernel scope link src 10.99.99.2 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Vamos a comprobar que desde nuestro cliente (servidor2) tenemos acceso a las distintas maquinas de nuestra red :\n## Ping con el t√∫nel del extremo servidor1 debian@servidor2:~$ ping 10.99.99.1 -c 1 PING 10.99.99.1 (10.99.99.1) 56(84) bytes of data. 64 bytes from 10.99.99.1: icmp_seq=1 ttl=64 time=14.9 ms --- 10.99.99.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 14.862/14.862/14.862/0.000 ms ## Pings con cliente1 : debian@servidor2:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=17.5 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.503/17.503/17.503/0.000 ms # Ping con cliente2 debian@servidor2:~$ ping 192.168.0.3 -c 1 PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data. 64 bytes from 192.168.0.3: icmp_seq=1 ttl=63 time=16.5 ms --- 192.168.0.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 16.522/16.522/16.522/0.000 ms ## Ping con la ip privada del servidor1 debian@servidor2:~$ ping 192.168.0.1 -c 1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=20.3 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 20.272/20.272/20.272/0.000 ms Aunque como esta montado mi escenario , las direcciones IP privadas no est√°n erutadas vamos a comprobar que el trafico va por el t√∫nel , haciendo uso de traceroute :\ndebian@servidor2:~$ traceroute 192.168.0.2 traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets 1 10.99.99.1 (10.99.99.1) 18.692 ms 28.987 ms 28.951 ms 2 192.168.0.2 (192.168.0.2) 28.912 ms 28.877 ms 28.859 ms Configuraci√≥n cliente android La maquina virtual de android es bastante incomoda de controlar , as√≠ que voy a generarle las claves y su fichero de configuraci√≥n en el servidor1 . Posteriormente se lo haremos llegar descargandonoslo de este con apache .\nNos generamos las claves para android :\ndebian@servidor1:~$ wg genkey | tee androidprivate | wg pubkey \u0026gt; androidpublic debian@servidor1:~$ cat androidprivate CBY5o2iko7xXQrNAFcFDIKohOngawB1uvws7aDDgl0g= debian@servidor1:~$ cat androidpublic cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g= El fichero de configuraci√≥n seria el siguiente :\ndebian@servidor1:~$ sudo cat android.conf [Interface] Address = 10.99.99.4 PrivateKey = CBY5o2iko7xXQrNAFcFDIKohOngawB1uvws7aDDgl0g= ListenPort = 51820 [Peer] Publickey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 0.0.0.0/0 Endpoint = 90.0.0.2:51820 Me he instalado apache y copiare este archivo al document root para hacerlo llegar a la maquina android . Uso este medio ya que es un escenario ficticio .\ndebian@servidor1:~$ sudo cp android.conf /var/www/html/ Desde una terminal , ya que el navegador no funciona demasiado bien nos descargamos el fichero : Ahora vamos a a√±adir en el fichero de configuraci√≥n del servidor este nuevo cliente :\ndebian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf #Al final del todo :) [Peer] Publickey = cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g= AllowedIPs = 10.99.99.4/32 PersistentKeepAlive = 25 No olvides reiniciar el t√∫nel :\ndebian@servidor1:~$ sudo wg-quick down wg0 debian@servidor1:~$ sudo wg-quick up wg0 Ahora abre la aplicaci√≥n de wireguard y dale a importar desde archivo y activa la conexi√≥n . Activa el t√∫nel y aseg√∫rate de que se produce el handshake :\nSi abrimos una terminal podremos hacerle pings a los clientes :\nConfiguraci√≥n del cliente Windows Vamos a repetir el proceso pero ahora con nuestro cliente Windows .\nPara poder copiar y pegar voy a realizar la generaci√≥n de claves de este cliente en la maquina servidor1 .\nComenzaremos generando el par de claves\ndebian@servidor1:~$ wg genkey | tee winprivate | wg pubkey \u0026gt; winpublic debian@servidor1:~$ cat winprivate QKGQEdrB9FBYRZsLNgc3qr9m8/lx+uc9n5vvj67I9m8= debian@servidor1:~$ cat winpublic E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo= Nos creamos el fichero de configuraci√≥n para este cliente :\ndebian@servidor1:~$ cat win.conf [Interface] Address = 10.99.99.5 PrivateKey = QKGQEdrB9FBYRZsLNgc3qr9m8/lx+uc9n5vvj67I9m8= ListenPort = 51820 [Peer] Publickey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 0.0.0.0/0 Endpoint = 90.0.0.2:51820 Lo mover√© al document root para poder descargarlo en mi Windows , no hagas esto en un entorno real .\ndebian@servidor1:~$ sudo cp win.conf /var/www/html/ Recuerda configurar en la maquina servidor1 este nuevo cliente :\ndebian@servidor1:~$ sudo nano /etc/wireguard/wg0.conf [Peer] Publickey = E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo= AllowedIPs = 10.99.99.5/32 PersistentKeepAlive = 25 Para que se apliquen los cambios reinicia el t√∫nel :\ndebian@servidor1:~$ sudo wg-quick down wg0 debian@servidor1:~$ sudo wg-quick up wg0 Una vez tenemos todo configurado , accede a la maquina Windows y descargate el fichero de configuraci√≥n :\nAbre la aplicaci√≥n de wireguard y selecciona importar desde archivo :\nUna vez a√±adido activa el t√∫nel y comprueba que se ha producido el handshake :\nSi volvemos a nuestro Windows , se nos habr√° creado una nueva interfaz :\nY tendremos conectividad con las maquinas de la red 192.168.0.0/24 :\nA modo de curiosidad podemos ver en el servidor que clientes est√°n conectados :\ndebian@servidor1:~$ sudo wg show interface: wg0 public key: 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= private key: (hidden) listening port: 51820 peer: cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g= endpoint: 100.0.0.2:51820 allowed ips: 10.99.99.4/32 latest handshake: 1 minute, 14 seconds ago transfer: 6.43 KiB received, 788 B sent persistent keepalive: every 25 seconds peer: E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo= endpoint: 100.0.0.2:49981 allowed ips: 10.99.99.5/32 latest handshake: 1 minute, 32 seconds ago transfer: 46.23 KiB received, 1.64 KiB sent persistent keepalive: every 25 seconds peer: gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= allowed ips: 10.99.99.2/32 persistent keepalive: every 25 seconds ","date":"March 28, 2024","hero":"/images/vpn/wireguard_acceso_remoto.png","permalink":"https://www.javiercd.es/posts/vpn/acceso_remoto_wireguard/acceso_remoto_wireguard/","summary":"\u003cp\u003e\u003cimg src=\"/vpn/acceso_remoto_wireguard/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEn primer lugar configurare la maquina servidor1  como servidor VPN de acceso remoto y servidor2 como cliente VPN . Posteriormente configurare un cliente Windows y Android .\u003c/p\u003e\n\u003cp\u003eLo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@servidor1:~# sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edebian@servidor2:~$ sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVamos a generar los pares de claves que se utilizar√°n para cifrar la conexi√≥n. Necesitaremos una clave para el servidor y un par de  claves adicionales por cada cliente.\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","WIREGUARD"],"title":"VPN acceso remoto Wireguard"},{"categories":null,"contents":"StrongSwan es una implementaci√≥n de VPN (Red Privada Virtual) basada en IPsec, de c√≥digo abierto, multiplataforma, completa y ampliamente utilizada. Funciona en sistemas operativos como Linux, FreeBSD, OS X, Windows, Android e iOS. Principalmente, es un demonio de intercambio de claves que admite los protocolos de Intercambio de Claves de Internet (IKEv1 e IKEv2) para establecer asociaciones de seguridad (SA) entre dos pares.\n[!NOTE]\nVoy a partir del post de VPN acceso remoto con OpenVPN , asi que es posible que haga referencia a este durante este articulo . Si quieres tener el mismo escenario ve primero a este .\nRecuerda que para la configuraci√≥n que vamos a hacer tienes que activar el bit de forwarding en las maquinas Servidor1 y Servidor2 .\nInstalaci√≥n de StrongSwan Comenzaremos instalando el paquete StrongSwan en ambas maquinas :\ndebian@servidor1:~$ sudo apt install strongswan -y debian@servidor2:~$ sudo apt install strongswan -y Configuraci√≥n de StrongSwan Servidor 1 A continuaci√≥n configuraremos el servidor 1 , voy a ponerte un comentario para que sepas que significada cada opci√≥n :\ndebian@servidor1:~$ sudo cat /etc/ipsec.conf # Configuraci√≥n global de strongSwan config setup charondebug=\u0026#34;ike 2, knl 2, cfg 2, net 2, esp 2, dmn 2, mgr 2\u0026#34; # Configuraci√≥n por defecto para conexiones VPN conn %default ikelifetime=1h # Tiempo de vida de la negociaci√≥n de intercambio de claves y SA. keylife=1h # Tiempo de vida de la llave del cifrado. rekeymargin=5m # Margen de tiempo antes de la expiraci√≥n para la renovaci√≥n. keyingtries=3 # N√∫mero m√°ximo de intentos de renegociaci√≥n. keyexchange=ikev2 # Versi√≥n del protocolo IKE. authby=secret # Uso de autenticaci√≥n con clave precompartida (PSK). ike=aes256-sha1-modp1024 # Configuraci√≥n de algoritmos para la fase IKE. esp=aes256-sha1 # Configuraci√≥n de algoritmos para la fase ESP. conn servidor2a1 left=90.0.0.2 # Direcci√≥n IP publica de la maquina (servidor1). leftsubnet=192.168.0.0/24 # Subred privada de la maquina servidor 1. right=100.0.0.2 # Direcci√≥n IP publica del otro extremo (servidor2). rightsubnet=192.168.1.0/24 # Subred privada del otro extremo (servidor 2). auto=start # Iniciar la conexi√≥n autom√°ticamente al arrancar strongSwan. Servidor 2 A continuaci√≥n configuraremos el servidor 2 , voy a ponerte un comentario para que sepas que significada cada opci√≥n :\ndebian@servidor2:~$ sudo cat /etc/ipsec.conf # Configuraci√≥n global de strongSwan config setup charondebug=\u0026#34;ike 2, knl 2, cfg 2, net 2, esp 2, dmn 2, mgr 2\u0026#34; # Configuraci√≥n por defecto para conexiones VPN conn %default ikelifetime=1h # Tiempo de vida de la negociaci√≥n de intercambio de claves y SA. keylife=1h # Tiempo de vida de la llave del cifrado. rekeymargin=5m # Margen de tiempo antes de la expiraci√≥n para la renovaci√≥n. keyingtries=3 # N√∫mero m√°ximo de intentos de renegociaci√≥n. keyexchange=ikev2 # Versi√≥n del protocolo IKE. authby=secret # Uso de autenticaci√≥n con clave precompartida (PSK). ike=aes256-sha1-modp1024 # Configuraci√≥n de algoritmos para la fase IKE. esp=aes256-sha1 # Configuraci√≥n de algoritmos para la fase ESP. conn servidor2a1 left=100.0.0.2 # Direcci√≥n IP publica de la maquina. leftsubnet=192.168.1.0/24 # Subred privada de la maquina. right=90.0.0.2 # Direcci√≥n IP publica del servidor1. rightsubnet=192.168.0.0/24 # Subred privada del servidor 1. auto=start # Iniciar la conexi√≥n autom√°ticamente al arrancar strongSwan. Generaci√≥n de la clave compartida Una vez que hayas configurado ambas m√°quinas, es necesario acordar el uso de una clave compartida denominada PSK (Pre-Shared Key). Puedes generar una PSK de manera aleatoria para mejorar la seguridad de la conexi√≥n. A continuaci√≥n, te proporciono un ejemplo de c√≥mo generar una clave aleatoria :\ndebian@servidor1:~$ head -c 24 /dev/urandom | base64 cXPeOAcKIVszFHp68CcGX6dLXcWcbrIl Ahora en el fichero /etc/ipsec.secrets configuraremos la clave PSK , que en ambos extremos tiene que ser la misma :\ndebian@servidor1:~$ sudo cat /etc/ipsec.secrets # Ip publica de la maquina servidor 1 90.0.0.2 : PSK \u0026#34;cXPeOAcKIVszFHp68CcGX6dLXcWcbrIl\u0026#34; debian@servidor2:~$ sudo cat /etc/ipsec.secrets # Ip publica de la maquina servidor 2 100.0.0.2 : PSK \u0026#34;cXPeOAcKIVszFHp68CcGX6dLXcWcbrIl\u0026#34; Una vez configurado , reiniciaremos el servicio en ambos extremos :\ndebian@servidor1:~$ sudo ipsec restart debian@servidor2:~$ sudo ipsec restart Comprobaci√≥n de funcionamiento Ahora comprobaremos que se ha levantado el t√∫nel en ambos extremos :\ndebian@servidor1:~$ sudo ipsec status Security Associations (1 up, 0 connecting): servidor1a2[1]: ESTABLISHED 62 seconds ago, 90.0.0.2[90.0.0.2]...100.0.0.2[100.0.0.2] servidor1a2{1}: INSTALLED, TUNNEL, reqid 1, ESP SPIs: ccb4e51d_i c186cf93_o servidor1a2{1}: 192.168.0.0/24 === 192.168.1.0/24 debian@servidor2:~$ sudo ipsec status Security Associations (1 up, 0 connecting): servidor2a1[2]: ESTABLISHED 45 seconds ago, 100.0.0.2[100.0.0.2]...90.0.0.2[90.0.0.2] servidor2a1{2}: INSTALLED, TUNNEL, reqid 1, ESP SPIs: c186cf93_i ccb4e51d_o servidor2a1{2}: 192.168.1.0/24 === 192.168.0.0/24 Es cierto que, a diferencia de OpenVPN y WireGuard, StrongSwan no crea autom√°ticamente una interfaz virtual para la conexi√≥n VPN. En lugar de ello, utiliza las rutas del sistema operativo para dirigir el tr√°fico a trav√©s del t√∫nel IPSec.\nTablas de enrutamiento Podemos ver estas rutas de la siguiente manera , estas est√°n guardadas en la tabla 220:\ndebian@servidor1:~$ ip r show table 220 192.168.1.0/24 via 90.0.0.1 dev ens3 proto static src 192.168.0.1 debian@servidor2:~$ ip route list table 220 192.168.0.0/24 via 100.0.0.1 dev ens3 proto static src 192.168.1.1 Comprobaci√≥n de conectividad Una vez hecho esto vamos a comprobar que la maquina servidor2 puede llegar a las maquinas de la red 192.168.0.0/24 :\ndebian@servidor2:~$ ping -c 1 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=12.7 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 12.721/12.721/12.721/0.000 ms debian@servidor2:~$ ping -c 1 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=11.5 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 11.485/11.485/11.485/0.000 ms Estad√≠sticas de los t√∫neles Si quieres ver si el trafico ha pasado por el \u0026ldquo;t√∫nel\u0026rdquo; , puedes hacer un statusall y ver las estad√≠sticas :\ndebian@servidor1:~$ sudo ipsec statusall Status of IKE charon daemon (strongSwan 5.9.8, Linux 6.1.0-17-cloud-amd64, x86_64): uptime: 9 minutes, since Jan 28 10:44:01 2024 malloc: sbrk 2166784, mmap 0, used 1242160, free 924624 worker threads: 11 of 16 idle, 5/0/0/0 working, job queue: 0/0/0/0, scheduled: 2 loaded plugins: charon test-vectors ldap pkcs11 aes rc2 sha2 sha1 md5 mgf1 random nonce x509 revocation constraints pubkey pkcs1 pkcs7 pkcs12 pgp dnskey sshkey pem openssl gcrypt pkcs8 af-alg fips-prf gmp curve25519 agent chapoly xcbc cmac hmac kdf ctr ccm gcm drbg curl attr kernel-netlink resolve socket-default connmark forecast farp stroke updown eap-identity eap-aka eap-md5 eap-gtc eap-mschapv2 eap-radius eap-tls eap-ttls eap-tnc xauth-generic xauth-eap xauth-pam tnc-tnccs dhcp lookip error-notify certexpire led addrblock unity counters Listening IP addresses: 90.0.0.2 192.168.0.1 Connections: servidor1a2: 90.0.0.2...100.0.0.2 IKEv2 servidor1a2: local: [90.0.0.2] uses pre-shared key authentication servidor1a2: remote: [100.0.0.2] uses pre-shared key authentication servidor1a2: child: 192.168.0.0/24 === 192.168.1.0/24 TUNNEL Security Associations (1 up, 0 connecting): servidor1a2[1]: ESTABLISHED 9 minutes ago, 90.0.0.2[90.0.0.2]...100.0.0.2[100.0.0.2] servidor1a2[1]: IKEv2 SPIs: 80b3e1894dc769f5_i* 92c50ec8c2dedde7_r, pre-shared key reauthentication in 43 minutes servidor1a2[1]: IKE proposal: AES_CBC_256/HMAC_SHA1_96/PRF_HMAC_SHA1/MODP_1024 servidor1a2{1}: INSTALLED, TUNNEL, reqid 1, ESP SPIs: ccb4e51d_i c186cf93_o servidor1a2{1}: AES_CBC_256/HMAC_SHA1_96, 252 bytes_i (3 pkts, 358s ago), 280 bytes_o (3 pkts, 355s ag o), rekeying in 41 minutes servidor1a2{1}: 192.168.0.0/24 === 192.168.1.0/24 Captura con Wireshark Ademas puedes hacer una captura del trafico y asegurarte de que los mensajes van cifrados :\nComprobaci√≥n con traceroute Ademas es curioso porque si haces un traceroute el primer salto que da es a la interfaz 192.168.0.1 del servidor1 :\ndebian@servidor2:~$ traceroute 192.168.0.2 traceroute to 192.168.0.2 (192.168.0.2), 30 hops max, 60 byte packets 1 192.168.0.1 (192.168.0.1) 13.695 ms 13.658 ms 13.712 ms 2 192.168.0.2 (192.168.0.2) 13.704 ms 13.695 ms 13.678 ms ","date":"March 28, 2024","hero":"/images/vpn/strongswan.png","permalink":"https://www.javiercd.es/posts/vpn/acceso_remoto_strongswang/strongswang/","summary":"\u003cp\u003eStrongSwan es una implementaci√≥n de VPN (Red Privada Virtual) basada en IPsec, de c√≥digo abierto, multiplataforma, completa y ampliamente utilizada. Funciona en sistemas operativos como Linux, FreeBSD, OS X, Windows, Android e iOS. Principalmente, es un demonio de intercambio de claves que admite los protocolos de Intercambio de Claves de Internet (IKEv1 e IKEv2) para establecer asociaciones de seguridad (SA) entre dos pares.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nVoy a partir del post de VPN acceso remoto con OpenVPN , asi que es posible que haga referencia a este durante este articulo . Si quieres tener el mismo escenario ve primero a este .\u003c/p\u003e","tags":["VPN","LINUX","DEBIAN","STRONGSWAN"],"title":"VPN de acceso remoto con Ipsec StrongSwan"},{"categories":null,"contents":" Uno de los dos equipos (el que actuar√° como servidor) estar√° conectado a dos redes Para la autenticaci√≥n de los extremos se usar√°n obligatoriamente certificados digitales, que se generar√°n utilizando openssl y se almacenar√°n en el directorio /etc/openvpn, junto con los par√°metros Diffie-Helman y el certificado de la propia Autoridad de Certificaci√≥n. Se utilizar√°n direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La direcci√≥n 10.99.99.1 se asignar√° al servidor VPN. Los ficheros de configuraci√≥n del servidor y del cliente se crear√°n en el directorio /etc/openvpn de cada m√°quina, y se llamar√°n servidor.conf y cliente.conf respectivamente. Tras el establecimiento de la VPN, la m√°quina cliente debe ser capaz de acceder a una m√°quina que est√© en la otra red a la que est√° conectado el servidor. Montando el escenario Para realizar este ejercicio he montado el siguiente escenario en GNS3 :\nConfiguraci√≥n del router cisco Vamos a darle a cada interfaz la configuraci√≥n de red correspondiente :\n# Interfaz que nos dar√° internet R1#configure terminal R1(config)#interface fastEthernet 0/0 R1(config-if)#ip add dhcp R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 1 R1(config)#interface fastEthernet 1/0 R1(config-if)#ip add 90.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 2 R1(config)#interface fastEthernet 1/1 R1(config-if)#ip add 100.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Ruta por defecto para internet R1(config)#ip route 0.0.0.0 0.0.0.0 192.168.122.1 # Guarda la configuraci√≥n R1#write # Configuraci√≥n de SNAT R1#conf term R1(config)#access-list 1 permit 90.0.0.0 0.0.0.255 R1(config)#access-list 1 permit 100.0.0.0 0.0.0.255 R1(config)# ip nat pool NAT-Pool 192.168.122.127 192.168.122.127 prefix-length 24 R1(config)#ip nat inside source list 1 pool NAT-Pool overload R1(config)#interface FastEthernet0/0 R1(config-if)#ip nat outside R1(config)#interface FastEthernet1/0 R1(config-if)#ip nat inside R1(config)#interface FastEthernet1/1 R1(config-if)#ip nat inside Configuraci√≥n del Servidor 1 Configuraci√≥n de red servidor 1 :\ndebian@servidor1:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 90.0.0.2 netmask 255.255.255.0 gateway 90.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.0.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor1:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor1:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.0.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor1:~$ sudo apt install iptables-persistent Configuraci√≥n del Servidor 2 Configuraci√≥n de red servidor 2 :\ndebian@servidor2:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 100.0.0.2 netmask 255.255.255.0 gateway 100.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.1.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor2:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor2:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.1.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor2:~$ sudo apt install iptables-persistent Comprobaci√≥n enroutamiento Vamos a comprobar que hemos enroutado bien nuestro escenario , para ello desde los servidores haremos un ping al contrario y ha Internet .\nDesde servidor 1 :\ndebian@servidor1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=37.4 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.374/37.374/37.374/0.000 ms debian@servidor1:~$ debian@servidor1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=63 time=18.6 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.567/18.567/18.567/0.000 ms debian@servidor1:~$ Desde el servidor 2 :\ndebian@servidor2:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=63 time=19.1 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 19.099/19.099/19.099/0.000 ms debian@servidor2:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=160 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 160.147/160.147/160.147/0.000 ms debian@servidor2:~$ Tambi√©n comprobaremos desde los clientes ya que hay configurado un snat .\nDesde el cliente 1 :\ndebian@cliente1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=62 time=19.0 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.968/18.968/18.968/0.000 ms debian@cliente1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=61.6 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 61.598/61.598/61.598/0.000 ms Desde el cliente 3 :\ndebian@cliente3:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=62 time=15.7 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 15.656/15.656/15.656/0.000 ms debian@cliente3:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=45.8 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 45.760/45.760/45.760/0.000 ms Instalaci√≥n de OpenVPN Instalaremos en ambos servidores el paquete openvpn\n# Servidor 1 debian@servidor1:~$ sudo apt install -y openvpn # Servidor 2 debian@servidor2:~$ sudo apt install -y openvpn Generaci√≥n de claves y certificados Podemos generar los certificados manualmente, pero existe una herramienta llamada Easy RSA que automatiza este proceso. Adem√°s, Easy RSA facilita la generaci√≥n de los m√≥dulos Diffie-Hellman, que son esenciales para el funcionamiento del servidor OpenVPN.\nNo es necesario que nos la descarguemos ya que esta viene con el paquete openvpn .\nPara OpenVPN necesitamos crear:\nUna clave privada y un certificado x509 para la autoridad certificante que firma (CA) Una clave privada y un certificado x509 firmado para el servidor. Una clave privada y un certificado x509 firmado para cada cliente. Un grupo Diffie-Hellman para el servidor. En el servidor 1, copiaremos el archivo de ejemplo de variables para evitar la solicitud repetitiva de informaci√≥n como organizaci√≥n, pa√≠s, provincia, etc., por parte de EasyRSA.\ndebian@servidor1:/usr/share/easy-rsa$ sudo cp vars.example vars Editaremos el mismo y cambiaremos los siguientes valores :\ndebian@servidor1:/usr/share/easy-rsa$ sudo nano vars set_var EASYRSA_REQ_COUNTRY \u0026#34;ES\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;Sevilla\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;Dos Hermanas\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;iesgn\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;contacto@javiercd.es\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Informatica\u0026#34; Una vez cambiado los valores por defecto por los nuestros , vamos a iniciar la infraestructura de clave p√∫blica (PKI) utilizando el script EasyRSA. Al ejecutar este comando, se crea un nuevo directorio PKI con la estructura necesaria para gestionar las claves y certificados.\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa init-pki * Notice: init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: * /usr/share/easy-rsa/pki Generaci√≥n de los par√°metros Diffie-Hellman La clave de intercambio de Diffie-Hellman, es un m√©todo criptogr√°fico que permite a dos partes acordar de forma segura una clave de sesi√≥n compartida sobre un canal no seguro. As√≠ que vamos a generarla haciedo uso del siguiente comando :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-dh * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Generating DH parameters, 2048 bit long safe prime ......... * Notice: DH parameters of size 2048 created at /usr/share/easy-rsa/pki/dh.pem Se nos habr√° generado la clave en /usr/share/easy-rsa/pki/dh.pem , tal y como indica la salida del comando .\nGeneraci√≥n del certificado de la CA Vamos a proceder a generar el certificado de nuestra CA :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Using configuration from /usr/share/easy-rsa/pki/52a64968/temp.25a8f31d You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:ca.javiercd.es * Notice: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /usr/share/easy-rsa/pki/ca.crt Se nos habr√° generado en /usr/share/easy-rsa/pki/ca.crt\nGeneraci√≥n del certificado del servidor 1 Con el siguiente comando generaremos los certificados para el servidor 1 . Se generaran varios archivos :\nservidor1.req : Este archivo contiene la solicitud de certificado generada para el servidor servidor1.key : Este archivo contiene la clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor1 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) ....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+........+...+.+......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+............+...+....+...+.....+...+...+......+....+.....+......+...+.+..+...+....+..+...............+......+.........+......+.......+.....+......+.+........+.+.....+......+...............+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ....+............+..+.+...+...........+....+...........+......+...+.+...+..+.+........+....+...+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+............+...+.....+....+..+...+.+...............+.....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......+........+..........+...+.................+.+..+....+.....+..........+...+......+.........+.....+.+............+..+..................+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor1]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor1.req key: /usr/share/easy-rsa/pki/private/servidor1.key Ahora vamos a firmar el certificado del servidor1 con la clave privada de la CA .\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server servidor1 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 825 days: subject= commonName = servidor1 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/e66a9d70/temp.40a6d9dd Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor1\u0026#39; Certificate is to be certified until Apr 18 16:15:16 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor1.crt Como puedes ver tendremos los 3 ficheros referentes a nuestro servidor 1 generados :\n# Certificado firmado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/issued | grep servidor1 -rw------- 1 root root 4637 Jan 14 16:15 servidor1.crt # Clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/private | grep servidor1 -rw------- 1 root root 1704 Jan 14 16:09 servidor1.key # Solicitud de firma del certificado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/reqs | grep servidor1 -rw------- 1 root root 891 Jan 14 16:09 servidor1.req Generaci√≥n del certificado del servidor 2 Repetiremos el mismo proceso que hemos realizado para el servidor 1 , pero ahora para nuestro servidor 2 .\nGeneraremos la clave y el certificado :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor2 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) .+.+.................+...+...+.......+..+.+...........+.+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+....+..+..........+....................+.......+.....+.......+...+..+................+..+.......+.........+...........+....+..+...+.+......+..+...+....+.....+.........+....+......+......+.........+..+...+............+...+.+...+..+....+............+...............+..+...+.............+............+.....+.......+.....+.+......+........+.....................+.+......+..+.+......+.....+.........+......+.........+.......+...+...............+.....+...............+.+....................+......+...+................+...+...+............+.....+...............+.......+......+........+......+....+......+........+.+.....+....+..+.+........+.+.....+.+.....+...........................+......+.+...+.....+......+....+..+....+......+........+.............+..+...+.........+....+..+...+....+...+...+...........+......+...................+.....+................+...+..+....+...+..+......+...+..........+..+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ..........+............+...+....+...+.....+...+......+.+.....+.......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+.+......+..+.+..+...+.........+............+..................+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+...........+.+...+..+....+..............+......+...............+.+......+..............+....+......+..................+...+............+..+....+.....+.......+...+.........+..+......+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor2]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor2.req key: /usr/share/easy-rsa/pki/private/servidor2.key F√≠jate que ahora a este certificado a la hora de firmarlo diremos que es de tipo cliente . Ya que el servidor 2 \u0026ldquo;actuara como un cliente\u0026rdquo;:\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req client servidor2 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 825 days: subject= commonName = servidor2 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/8e1b2785/temp.504078d9 Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor2\u0026#39; Certificate is to be certified until Apr 18 16:57:49 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor2.crt Generaci√≥n de la clave TLS Este paso es opcional , pero es recomendable generar una clave compartida (tambi√©n conocida como clave de par√°metro adicional o clave ta.key) en el contexto de OpenVPN.)\nEn el contexto de OpenVPN, esta clave compartida (ta.key) se utiliza para firmar y verificar todos los paquetes de datos transmitidos a trav√©s de la conexi√≥n VPN. Su prop√≥sito principal es proporcionar una capa adicional de seguridad y autenticaci√≥n, ayudando a prevenir ataques como el de replay.\ndebian@servidor1:/usr/share/easy-rsa$ sudo openvpn --genkey --secret ta.key Distribuir las claves Ahora tenemos que hacer llegar cada clave a su lugar correspondiente .\nEn el servidor 1 crearemos el directorio /etc/openvpn/keys y guardaremos los siguientes ficheros :\n# Creamos el directorio donde guardaremos las claves debian@servidor1:/usr/share/easy-rsa$ sudo mkdir /etc/openvpn/keys # Nos la copiamos al directorio creado debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/dh.pem /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/ca.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/private/servidor1.key /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/issued/servidor1.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/ta.key /etc/openvpn/keys # Comprobamos que tenemos todoos los ficheros necesarios debian@servidor1:~$ sudo ls -l /etc/openvpn/keys total 24 -rw------- 1 root root 1216 Jan 14 17:08 ca.crt -rw------- 1 root root 424 Jan 14 17:08 dh.pem -rw------- 1 root root 4637 Jan 14 17:08 servidor1.crt -rw------- 1 root root 1704 Jan 14 17:08 servidor1.key -rw------- 1 root root 636 Jan 14 17:08 ta.key Ahora haremos lo mismo para el servidor2 , pero tendremos que llevarnos las claves haciendo uso de SCP\n# Creamos el directorio donde guardaremos las claves debian@servidor2:~$ sudo mkdir /etc/openvpn/keys # Desde servidor1 pasare a servidor2 las claves debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/ca.crt debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/ta.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/private/servidor2.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/issued/servidor2.crt debian@100.0.0.2:/home/debian # Las movemos a /etc/openvpn/keys debian@servidor2:~$ sudo mv * /etc/openvpn/keys # Nos aseguramos de tener los 4 ficheros que hemos enviado : debian@servidor2:~$ sudo ls -l /etc/openvpn/keys total 20 -rw------- 1 debian debian 1216 Jan 14 17:12 ca.crt -rw------- 1 debian debian 4515 Jan 14 17:14 servidor2.crt -rw------- 1 debian debian 1704 Jan 14 17:13 servidor2.key -rw------- 1 debian debian 636 Jan 14 17:13 ta.key Configuraci√≥n de OpenVPN Configuraci√≥n de OpenVPN en el servidor 1 Aseg√∫rate de tener activado el bit de forwarding en tu servidor :\ndebian@servidor1:~$ sudo sysctl net.ipv4.ip_forward net.ipv4.ip_forward = 1 Vamos a editar el fichero /etc/default/openvpn y descomentaremos la siguiente linea para indicar que se inicien automaticamente todos los t√∫neles vpn :\nAUTOSTART=\u0026#34;all\u0026#34; Crearemos un fichero de configuraci√≥n para nuestro servidor , en mi caso mi configuraci√≥n es la siguiente :\ndebian@servidor1:~$ sudo nano /etc/openvpn/servidor1.conf # Use a dynamic TUN device dev tun # Use tcp for communicating with the client proto tcp # Virtual IP range for the VPN clients server 10.99.99.0 255.255.255.0 # Push the route for the local subnet to the clients push \u0026#34;route 192.168.0.0 255.255.255.0\u0026#34; # Enable TLS and assume the server role tls-server # Diffie-Hellman parameters dh /etc/openvpn/keys/dh.pem # Certificate Authority\u0026#39;s certificate ca /etc/openvpn/keys/ca.crt # Server\u0026#39;s certificate cert /etc/openvpn/keys/servidor1.crt # Server\u0026#39;s private key key /etc/openvpn/keys/servidor1.key # Use fast LZO compression comp-lzo # Ping the remote every 10 seconds and restart after 60 seconds keepalive 10 60 # Set output verbosity to normal usage range verb 3 Ahora reinicia el servicio para que se apliquen los cambios y se levante la interfaz . Es posible que necesites reiniciar la maquina :\ndebian@servidor1:~$ sudo systemctl restart openvpn.service Y veremos que se ha levantado la interfaz tun0 :\ndebian@servidor1:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:21:18:28:00:00 brd ff:ff:ff:ff:ff:ff altname enp0s3 inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3 valid_lft forever preferred_lft forever inet6 fe80::e21:18ff:fe28:0/64 scope link valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:21:18:28:00:01 brd ff:ff:ff:ff:ff:ff altname enp0s4 inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4 valid_lft forever preferred_lft forever inet6 fe80::e21:18ff:fe28:1/64 scope link valid_lft forever preferred_lft forever 4: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::8491:9eb9:104e:6bf7/64 scope link stable-privacy valid_lft forever preferred_lft forever Configuraci√≥n de OpenVPN en el servidor 2 Aseg√∫rate de tener activado el bit de forwarding en tu servidor :\ndebian@servidor2:~$ sudo sysctl net.ipv4.ip_forward net.ipv4.ip_forward = 1 Vamos a editar el fichero /etc/default/openvpn y descomentaremos la siguiente linea para indicar que se inicien automaticamente todos los t√∫neles vpn :\nAUTOSTART=\u0026#34;all\u0026#34; Crearemos un fichero de configuraci√≥n para nuestro servidor , en mi caso mi configuraci√≥n es la siguiente :\ndebian@servidor2:~$ sudo nano /etc/openvpn/servidor2.conf # Use a dynamic TUN device dev tun # Connect to server remote 90.0.0.2 # Set virtual point-to-point IP addresses ifconfig 10.99.99.0 255.255.255.0 pull # Use TCP for communicating with server proto tcp-client # Enable TLS and assume client role during TLS handshake tls-client # Certificado de la CA ca /etc/openvpn/keys/ca.crt # Certificado del cliente cert /etc/openvpn/keys/servidor2.crt # Clave privada del cliente key /etc/openvpn/keys/servidor2.key # Use fast LZO compression comp-lzo # Ping remote every 10sg and restart after 60sg passed without sign of life from remote keepalive 10 60 # Set output verbosity to normal usage range verb 3 # Output logging messages to openvpn.log file log /var/log/openvpn.log Ahora reinicia el servicio para que se apliquen los cambios y se levante la interfaz . Es posible que necesites reiniciar la maquina :\ndebian@servidor2:~$ sudo systemctl restart openvpn.service Y veremos que se ha levantado la interfaz tun0 :\ndebian@servidor2:~$ ip a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host noprefixroute valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:82:67:88:00:00 brd ff:ff:ff:ff:ff:ff altname enp0s3 inet 100.0.0.2/24 brd 100.0.0.255 scope global ens3 valid_lft forever preferred_lft forever inet6 fe80::e82:67ff:fe88:0/64 scope link valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 link/ether 0c:82:67:88:00:01 brd ff:ff:ff:ff:ff:ff altname enp0s4 inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4 valid_lft forever preferred_lft forever inet6 fe80::e82:67ff:fe88:1/64 scope link valid_lft forever preferred_lft forever 4: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.6 peer 10.99.99.5/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::67f5:fd86:d948:132a/64 scope link stable-privacy valid_lft forever preferred_lft forever Comprobaci√≥n de funcionamiento Ahora vamos a comprobar que desde servidor2 podemos acceder a las maquinas clientes de la red 192.168.0.0/24 .\ndebian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.1 via 10.99.99.5 dev tun0 10.99.99.5 dev tun0 proto kernel scope link src 10.99.99.6 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.0.0/24 via 10.99.99.5 dev tun0 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Como puedes ver tendremos conectividad desde el servidor hacia los equipos de la otra red.\ndebian@servidor2:~$ ping 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=16.4 ms 64 bytes from 192.168.0.2: icmp_seq=2 ttl=63 time=14.3 ms 64 bytes from 192.168.0.2: icmp_seq=3 ttl=63 time=19.1 ms ^C --- 192.168.0.2 ping statistics --- 3 packets transmitted, 3 received, 0% packet loss, time 2004ms rtt min/avg/max/mdev = 14.308/16.582/19.060/1.945 ms Tambi√©n podremos conectarnos por ssh , me conectare hacia el cliente 1 :\ndebian@servidor2:~$ ssh debian@192.168.0.2 The authenticity of host \u0026#39;192.168.0.2 (192.168.0.2)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:zn2i5rAyilMi1i+Kqb6ys8GhldKuHKYZCDKbD1aXqjQ. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;192.168.0.2\u0026#39; (ED25519) to the list of known hosts. debian@192.168.0.2\u0026#39;s password: Linux cliente1 6.1.0-15-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.66-1 (2023-12-09) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Sun Jan 14 15:29:30 2024 debian@cliente1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 192.168.0.2/24 brd 192.168.0.255 scope global ens3 valid_lft forever preferred_lft forever ","date":"March 28, 2024","hero":"/images/vpn/remoteaccess.png","permalink":"https://www.javiercd.es/posts/vpn/acceso_remoto_openvpn/accesoremoto_openvpn/","summary":"\u003cul\u003e\n\u003cli\u003eUno de los dos equipos (el que actuar√° como servidor) estar√° conectado a dos redes\n\u003cul\u003e\n\u003cli\u003ePara la autenticaci√≥n de los extremos se usar√°n obligatoriamente certificados digitales, que se generar√°n utilizando openssl y se almacenar√°n en el directorio /etc/openvpn, junto con  los par√°metros Diffie-Helman y el certificado de la propia Autoridad de Certificaci√≥n.\u003c/li\u003e\n\u003cli\u003eSe utilizar√°n direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La direcci√≥n 10.99.99.1 se asignar√° al servidor VPN.\u003c/li\u003e\n\u003cli\u003eLos ficheros de configuraci√≥n del servidor y del cliente se crear√°n en el directorio /etc/openvpn de cada m√°quina, y se llamar√°n servidor.conf y cliente.conf respectivamente.\u003c/li\u003e\n\u003cli\u003eTras el establecimiento de la VPN, la m√°quina cliente debe ser capaz de acceder a una m√°quina que est√© en la otra red a la que est√° conectado el servidor.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"montando-el-escenario\"\u003eMontando el escenario\u003c/h2\u003e\n\u003cp\u003ePara realizar este ejercicio he montado el siguiente escenario en GNS3 :\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","OPENVPN"],"title":"VPN de acceso remoto con OpenVPN y certificados x509"},{"categories":null,"contents":"Montando el escenario Para realizar este ejercicio he montado el siguiente escenario en GNS3 :\nConfiguraci√≥n del router cisco Vamos a darle a cada interfaz la configuraci√≥n de red correspondiente :\n# Interfaz que nos dar√° internet R1#configure terminal R1(config)#interface fastEthernet 0/0 R1(config-if)#ip add dhcp R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 1 R1(config)#interface fastEthernet 1/0 R1(config-if)#ip add 90.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Interfaz red Servidor 2 R1(config)#interface fastEthernet 1/1 R1(config-if)#ip add 100.0.0.1 255.255.255.0 R1(config-if)#no shut R1(config-if)#exit # Ruta por defecto para internet R1(config)#ip route 0.0.0.0 0.0.0.0 192.168.122.1 # Guarda la configuraci√≥n R1#write # Configuraci√≥n de SNAT R1#conf term R1(config)#access-list 1 permit 90.0.0.0 0.0.0.255 R1(config)#access-list 1 permit 100.0.0.0 0.0.0.255 R1(config)# ip nat pool NAT-Pool 192.168.122.127 192.168.122.127 prefix-length 24 R1(config)#ip nat inside source list 1 pool NAT-Pool overload R1(config)#interface FastEthernet0/0 R1(config-if)#ip nat outside R1(config)#interface FastEthernet1/0 R1(config-if)#ip nat inside R1(config)#interface FastEthernet1/1 R1(config-if)#ip nat inside Configuraci√≥n del Servidor 1 Configuraci√≥n de red servidor 1 :\ndebian@servidor1:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 90.0.0.2 netmask 255.255.255.0 gateway 90.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.0.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor1:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor1:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.0.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor1:~$ sudo apt install iptables-persistent Configuraci√≥n del Servidor 2 Configuraci√≥n de red servidor 2 :\ndebian@servidor2:~$ cat /etc/network/interfaces auto lo iface lo inet loopback auto ens3 iface ens3 inet static address 100.0.0.2 netmask 255.255.255.0 gateway 100.0.0.1 dns-nameservers 8.8.8.8 auto ens4 iface ens4 inet static address 192.168.1.1 netmask 255.255.255.0 Ademas configuraremos el SNAT :\n#Activa el bit de forwarding debian@servidor2:~$ sudo nano /etc/sysctl.conf net.ipv4.ip_forward=1 # Regla SNAT debian@servidor2:~$ sudo iptables -t nat -A POSTROUTING -o ens3 -s 192.168.1.0/24 -j MASQUERADE # Te recomiendo que lo hagas permanente , configura iptables-persistent debian@servidor2:~$ sudo apt install iptables-persistent Comprobaci√≥n enroutamiento Vamos a comprobar que hemos enroutado bien nuestro escenario , para ello desde los servidores haremos un ping al contrario y ha Internet .\nDesde servidor 1 :\ndebian@servidor1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=37.4 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 37.374/37.374/37.374/0.000 ms debian@servidor1:~$ debian@servidor1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=63 time=18.6 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.567/18.567/18.567/0.000 ms debian@servidor1:~$ Desde el servidor 2 :\ndebian@servidor2:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=63 time=19.1 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 19.099/19.099/19.099/0.000 ms debian@servidor2:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=160 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 160.147/160.147/160.147/0.000 ms debian@servidor2:~$ Tambi√©n comprobaremos desde los clientes ya que hay configurado un snat .\nDesde el cliente 1 :\ndebian@cliente1:~$ ping 100.0.0.2 -c 1 PING 100.0.0.2 (100.0.0.2) 56(84) bytes of data. 64 bytes from 100.0.0.2: icmp_seq=1 ttl=62 time=19.0 ms --- 100.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 18.968/18.968/18.968/0.000 ms debian@cliente1:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=61.6 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 61.598/61.598/61.598/0.000 ms Desde el cliente 3 :\ndebian@cliente3:~$ ping 90.0.0.2 -c 1 PING 90.0.0.2 (90.0.0.2) 56(84) bytes of data. 64 bytes from 90.0.0.2: icmp_seq=1 ttl=62 time=15.7 ms --- 90.0.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 15.656/15.656/15.656/0.000 ms debian@cliente3:~$ ping 8.8.8.8 -c 1 PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data. 64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=45.8 ms --- 8.8.8.8 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 45.760/45.760/45.760/0.000 ms Instalaci√≥n de OpenVPN Instalaremos en ambos servidores el paquete openvpn\n# Servidor 1 debian@servidor1:~$ sudo apt install -y openvpn # Servidor 2 debian@servidor2:~$ sudo apt install -y openvpn Generaci√≥n de claves y certificados Podemos generar los certificados manualmente, pero existe una herramienta llamada Easy RSA que automatiza este proceso. Adem√°s, Easy RSA facilita la generaci√≥n de los m√≥dulos Diffie-Hellman, que son esenciales para el funcionamiento del servidor OpenVPN.\nNo es necesario que nos la descarguemos ya que esta viene con el paquete openvpn .\nPara OpenVPN necesitamos crear:\nUna clave privada y un certificado x509 para la autoridad certificante que firma (CA) Una clave privada y un certificado x509 firmado para el servidor. Una clave privada y un certificado x509 firmado para cada cliente. Un grupo Diffie-Hellman para el servidor. En el servidor 1, copiaremos el archivo de ejemplo de variables para evitar la solicitud repetitiva de informaci√≥n como organizaci√≥n, pa√≠s, provincia, etc., por parte de EasyRSA.\ndebian@servidor1:/usr/share/easy-rsa$ sudo cp vars.example vars Editaremos el mismo y cambiaremos los siguientes valores :\ndebian@servidor1:/usr/share/easy-rsa$ sudo nano vars set_var EASYRSA_REQ_COUNTRY \u0026#34;ES\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;Sevilla\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;Dos Hermanas\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;iesgn\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;contacto@javiercd.es\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Informatica\u0026#34; Una vez cambiado los valores por defecto por los nuestros , vamos a iniciar la infraestructura de clave p√∫blica (PKI) utilizando el script EasyRSA. Al ejecutar este comando, se crea un nuevo directorio PKI con la estructura necesaria para gestionar las claves y certificados.\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa init-pki * Notice: init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: * /usr/share/easy-rsa/pki Generaci√≥n de los par√°metros Diffie-Hellman La clave de intercambio de Diffie-Hellman, es un m√©todo criptogr√°fico que permite a dos partes acordar de forma segura una clave de sesi√≥n compartida sobre un canal no seguro. As√≠ que vamos a generarla haciedo uso del siguiente comando :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-dh * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Generating DH parameters, 2048 bit long safe prime ......... * Notice: DH parameters of size 2048 created at /usr/share/easy-rsa/pki/dh.pem Se nos habr√° generado la clave en /usr/share/easy-rsa/pki/dh.pem , tal y como indica la salida del comando .\nGeneraci√≥n del certificado de la CA Vamos a proceder a generar el certificado de nuestra CA :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) Using configuration from /usr/share/easy-rsa/pki/52a64968/temp.25a8f31d You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:ca.javiercd.es * Notice: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /usr/share/easy-rsa/pki/ca.crt Se nos habr√° generado en /usr/share/easy-rsa/pki/ca.crt\nGeneraci√≥n del certificado del servidor 1 Con el siguiente comando generaremos los certificados para el servidor 1 . Se generaran varios archivos :\nservidor1.req : Este archivo contiene la solicitud de certificado generada para el servidor servidor1.key : Este archivo contiene la clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor1 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) ....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*..+........+...+.+......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+............+...+....+...+.....+...+...+......+....+.....+......+...+.+..+...+....+..+...............+......+.........+......+.......+.....+......+.+........+.+.....+......+...............+.+.....+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ....+............+..+.+...+...........+....+...........+......+...+.+...+..+.+........+....+...+.....+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+............+...+.....+....+..+...+.+...............+.....+......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*......+........+..........+...+.................+.+..+....+.....+..........+...+......+.........+.....+.+............+..+..................+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor1]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor1.req key: /usr/share/easy-rsa/pki/private/servidor1.key Ahora vamos a firmar el certificado del servidor1 con la clave privada de la CA .\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server servidor1 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 825 days: subject= commonName = servidor1 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/e66a9d70/temp.40a6d9dd Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor1\u0026#39; Certificate is to be certified until Apr 18 16:15:16 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor1.crt Como puedes ver tendremos los 3 ficheros referentes a nuestro servidor 1 generados :\n# Certificado firmado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/issued | grep servidor1 -rw------- 1 root root 4637 Jan 14 16:15 servidor1.crt # Clave privada debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/private | grep servidor1 -rw------- 1 root root 1704 Jan 14 16:09 servidor1.key # Solicitud de firma del certificado debian@servidor1:/usr/share/easy-rsa$ sudo ls -la pki/reqs | grep servidor1 -rw------- 1 root root 891 Jan 14 16:09 servidor1.req Generaci√≥n del certificado del servidor 2 Repetiremos el mismo proceso que hemos realizado para el servidor 1 , pero ahora para nuestro servidor 2 .\nGeneraremos la clave y el certificado :\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa gen-req servidor2 nopass * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) .+.+.................+...+...+.......+..+.+...........+.+..+.+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*........+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+....+..+..........+....................+.......+.....+.......+...+..+................+..+.......+.........+...........+....+..+...+.+......+..+...+....+.....+.........+....+......+......+.........+..+...+............+...+.+...+..+....+............+...............+..+...+.............+............+.....+.......+.....+.+......+........+.....................+.+......+..+.+......+.....+.........+......+.........+.......+...+...............+.....+...............+.+....................+......+...+................+...+...+............+.....+...............+.......+......+........+......+....+......+........+.+.....+....+..+.+........+.+.....+.+.....+...........................+......+.+...+.....+......+....+..+....+......+........+.............+..+...+.........+....+..+...+....+...+...+...........+......+...................+.....+................+...+..+....+...+..+......+...+..........+..+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ..........+............+...+....+...+.....+...+......+.+.....+.......+..+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.........+.+......+..+.+..+...+.........+............+..................+.......+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++*.+...+...........+.+...+..+....+..............+......+...............+.+......+..............+....+......+..................+...+............+..+....+.....+.......+...+.........+..+......+...+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ ----- You are about to be asked to enter information that will be incorporated into your certificate request. What you are about to enter is what is called a Distinguished Name or a DN. There are quite a few fields but you can leave some blank For some fields there will be a default value, If you enter \u0026#39;.\u0026#39;, the field will be left blank. ----- Common Name (eg: your user, host, or server name) [servidor2]: * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/servidor2.req key: /usr/share/easy-rsa/pki/private/servidor2.key F√≠jate que ahora a este certificado a la hora de firmarlo diremos que es de tipo cliente . Ya que el servidor 2 \u0026ldquo;actuara como un cliente\u0026rdquo;:\ndebian@servidor1:/usr/share/easy-rsa$ sudo ./easyrsa sign-req client servidor2 * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a client certificate for 825 days: subject= commonName = servidor2 Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/8e1b2785/temp.504078d9 Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;servidor2\u0026#39; Certificate is to be certified until Apr 18 16:57:49 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/servidor2.crt Generaci√≥n de la clave TLS Este paso es opcional , pero es recomendable generar una clave compartida (tambi√©n conocida como clave de par√°metro adicional o clave ta.key) en el contexto de OpenVPN.)\nEn el contexto de OpenVPN, esta clave compartida (ta.key) se utiliza para firmar y verificar todos los paquetes de datos transmitidos a trav√©s de la conexi√≥n VPN. Su prop√≥sito principal es proporcionar una capa adicional de seguridad y autenticaci√≥n, ayudando a prevenir ataques como el de replay.\ndebian@servidor1:/usr/share/easy-rsa$ sudo openvpn --genkey --secret ta.key Distribuir las claves Ahora tenemos que hacer llegar cada clave a su lugar correspondiente .\nEn el servidor 1 crearemos el directorio /etc/openvpn/keys y guardaremos los siguientes ficheros :\n# Creamos el directorio donde guardaremos las claves debian@servidor1:/usr/share/easy-rsa$ sudo mkdir /etc/openvpn/keys # Nos la copiamos al directorio creado debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/dh.pem /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/ca.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/private/servidor1.key /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/pki/issued/servidor1.crt /etc/openvpn/keys debian@servidor1:~$ sudo cp /usr/share/easy-rsa/ta.key /etc/openvpn/keys # Comprobamos que tenemos todoos los ficheros necesarios debian@servidor1:~$ sudo ls -l /etc/openvpn/keys total 24 -rw------- 1 root root 1216 Jan 14 17:08 ca.crt -rw------- 1 root root 424 Jan 14 17:08 dh.pem -rw------- 1 root root 4637 Jan 14 17:08 servidor1.crt -rw------- 1 root root 1704 Jan 14 17:08 servidor1.key -rw------- 1 root root 636 Jan 14 17:08 ta.key Ahora haremos lo mismo para el servidor2 , pero tendremos que llevarnos las claves haciendo uso de SCP\n# Creamos el directorio donde guardaremos las claves debian@servidor2:~$ sudo mkdir /etc/openvpn/keys # Desde servidor1 pasare a servidor2 las claves debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/ca.crt debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/ta.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/private/servidor2.key debian@100.0.0.2:/home/debian debian@servidor1:~$ sudo scp /usr/share/easy-rsa/pki/issued/servidor2.crt debian@100.0.0.2:/home/debian # Las movemos a /etc/openvpn/keys debian@servidor2:~$ sudo mv * /etc/openvpn/keys # Nos aseguramos de tener los 4 ficheros que hemos enviado : debian@servidor2:~$ sudo ls -l /etc/openvpn/keys total 20 -rw------- 1 debian debian 1216 Jan 14 17:12 ca.crt -rw------- 1 debian debian 4515 Jan 14 17:14 servidor2.crt -rw------- 1 debian debian 1704 Jan 14 17:13 servidor2.key -rw------- 1 debian debian 636 Jan 14 17:13 ta.key Configuraci√≥n de OpenVPN Configuraci√≥n del servidor 1 [!NOTE] Este apartado lo esta comparando con el post de VPN de acceso remoto.\nComo ves los √∫nicos par√°metros que hemos cambiado en la configuraci√≥n es la IP virtual y el par√°metro route para generar la ruta hacia la red privada del otro extremo:\ndebian@servidor1:~$ sudo nano /etc/openvpn/servidor1.conf # Utilizar un dispositivo TUN din√°mico dev tun # IP virtual ifconfig 10.99.99.1 10.99.99.2 # Ruta para llegar a la red del otro extremo route 192.168.1.0 255.255.255.0 # Habilitar TLS y asumir el rol de servidor tls-server # Par√°metros de Diffie-Hellman dh /etc/openvpn/keys/dh.pem # Certificado de la Autoridad Certificadora ca /etc/openvpn/keys/ca.crt # Certificado del servidor cert /etc/openvpn/keys/servidor1.crt # Clave privada del servidor key /etc/openvpn/keys/servidor1.key # Utilizar compresi√≥n LZO r√°pida comp-lzo # Ping al remoto cada 10 segundos y reiniciar despu√©s de 60 segundos keepalive 10 60 # Establecer la verbosidad de salida en un rango de uso normal verb 3 Reinicia el servicio OpenVPN del servidor 1 :\ndebian@servidor1:~$ sudo systemctl restart openvpn Comprueba que se te ha generado la interfaz tun0 :\ndebian@servidor1:~$ ip a show tun0 9: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::a6be:e8ba:17e5:35e3/64 scope link stable-privacy valid_lft forever preferred_lft forever Y por ultimo comprueba que la ruta para llegar a la red del otro extremo es correcta , es decir que va a trav√©s de la interfaz tun0 :\ndebian@servidor1:~$ ip r default via 90.0.0.1 dev ens3 onlink 10.99.99.2 dev tun0 proto kernel scope link src 10.99.99.1 90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 192.168.1.0/24 via 10.99.99.2 dev tun0 Configuraci√≥n del servidor 2 debian@servidor2:~$ sudo nano /etc/openvpn/servidor2.conf # Utilizar un dispositivo TUN din√°mico dev tun # Conectar al servidor remote 90.0.0.2 # Establecer direcciones IP virtuales punto a punto ifconfig 10.99.99.2 10.99.99.1 # Ruta para llegar a la red remota (local del servidor 1) route 192.168.0.0 255.255.255.0 # Habilitar TLS y asumir el rol de cliente durante el handshake de TLS tls-client # Certificado de la Autoridad Certificadora ca /etc/openvpn/keys/ca.crt # Certificado del cliente cert /etc/openvpn/keys/servidor2.crt # Clave privada del cliente key /etc/openvpn/keys/servidor2.key # Utilizar compresi√≥n LZO r√°pida comp-lzo # Hacer ping al remoto cada 10 segundos y reiniciar despu√©s de 60 segundos si no hay se√±al de vida del \u0026gt; keepalive 10 60 # Establecer la verbosidad de salida en un rango de uso normal verb 3 # Registrar mensajes en el archivo openvpn.log log /var/log/openvpn.log Reinicia el servicio OpenVPN en el servidor 2 para que se aplique la nueva configuraci√≥n :\ndebian@servidor2:~$ sudo systemctl restart openvpn Comprueba que se te ha generado la interfaz tun0 :\ndebian@servidor2:~$ ip a show tun0 10: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 10.99.99.2 peer 10.99.99.1/32 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::ded7:8620:c295:146a/64 scope link stable-privacy valid_lft forever preferred_lft forever Y por ultimo comprueba que la ruta para llegar a la red del otro extremo es correcta , es decir que va a trav√©s de la interfaz tun0 :\ndebian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.1 dev tun0 proto kernel scope link src 10.99.99.2 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.0.0/24 via 10.99.99.1 dev tun0 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Comprobaci√≥n de funcionamiento Ahora, ambas redes privadas, tanto la 192.168.0.0/24 como la 192.168.1.0/24, contar√°n con conectividad gracias a los servidores VPN .\nPing desde cliente 1 hacia cliente 2 :\ndebian@cliente1:~$ ping 192.168.1.2 -c 1 PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data. 64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=15.6 ms --- 192.168.1.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 15.645/15.645/15.645/0.000 ms Ping desde cliente 2 hacia cliente 1 :\ndebian@cliente3:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=17.3 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.345/17.345/17.345/0.000 ms Ping desde servidor 1 hacia servidor 2 :\ndebian@servidor1:~$ ping 192.168.1.1 -c 1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=64 time=18.0 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.988/17.988/17.988/0.000 ms Ping desde servidor 1 hacia servidor 2 :\ndebian@servidor2:~$ ping 192.168.0.1 -c 1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=64 time=12.6 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 12.558/12.558/12.558/0.000 ms Por supuesto tambi√©n podremos acceder a cualquier servicio en la otra red o conectarnos por SSH desde un extremo del t√∫nel a otro :\ndebian@cliente3:~$ ssh 192.168.0.1 debian@192.168.0.1\u0026#39;s password: Linux servidor1 6.1.0-15-cloud-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.66-1 (2023-12-09) x86_64 The programs included with the Debian GNU/Linux system are free software; the exact distribution terms for each program are described in the individual files in /usr/share/doc/*/copyright. Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent permitted by applicable law. Last login: Tue Jan 16 18:51:53 2024 from 192.168.1.2 debian@servidor1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens3: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s3 inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3 valid_lft forever preferred_lft forever 3: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4 valid_lft forever preferred_lft forever 9: tun0: \u0026lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 inet 10.99.99.1 peer 10.99.99.2/32 scope global tun0 valid_lft forever preferred_lft forever Cliente Android [!TIP] En los post de redes encontraras una guia para instalar una maquina virtual de android en KVM y GNS3\nLa configuraci√≥n de red del mismo se realiza desde el wifi :\nComprueba que desde la red local del mismo tienes conectividad con la ip asignada :\ndebian@cliente3:~$ ping 192.168.1.4 PING 192.168.1.4 (192.168.1.4) 56(84) bytes of data. 64 bytes from 192.168.1.4: icmp_seq=1 ttl=64 time=0.534 ms ^C --- 192.168.1.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 0.534/0.534/0.534/0.000 ms Ademas este cuenta en las aplicaciones con un emulador de terminal que nos servir√° para comprobar que tiene conectividad :\n","date":"March 28, 2024","hero":"/images/vpn/sitetosite.png","permalink":"https://www.javiercd.es/posts/vpn/site_to_site_openvpn/site_to_site_openvpn/","summary":"\u003ch2 id=\"montando-el-escenario\"\u003eMontando el escenario\u003c/h2\u003e\n\u003cp\u003ePara realizar este ejercicio he montado el siguiente escenario en GNS3 :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/vpn/site_to_site_wireguard/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"configuraci√≥n-del-router-cisco\"\u003eConfiguraci√≥n del router cisco\u003c/h3\u003e\n\u003cp\u003eVamos a darle a cada interfaz la configuraci√≥n de red correspondiente :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Interfaz que nos dar√° internet \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1#configure terminal \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface fastEthernet 0/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip add dhcp\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#no shut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Interfaz red Servidor 1 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface fastEthernet 1/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip add 90.0.0.1 255.255.255.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#no shut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Interfaz red Servidor 2 \u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface fastEthernet 1/1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip add 100.0.0.1 255.255.255.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#no shut\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#exit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Ruta por defecto para internet\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip route 0.0.0.0 0.0.0.0 192.168.122.1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Guarda la configuraci√≥n\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1#write\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Configuraci√≥n de SNAT\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1#conf term\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#access-list 1 permit 90.0.0.0 0.0.0.255\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#access-list 1 permit 100.0.0.0 0.0.0.255\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e# ip nat pool NAT-Pool 192.168.122.127 192.168.122.127 prefix-length 24\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat inside source list 1 pool NAT-Pool overload\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface FastEthernet0/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat outside\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface FastEthernet1/0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat inside\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#interface FastEthernet1/1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eR1\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003econfig-if\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#75715e\"\u003e#ip nat inside\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch4 id=\"configuraci√≥n-del-servidor-1\"\u003eConfiguraci√≥n del Servidor 1\u003c/h4\u003e\n\u003cp\u003eConfiguraci√≥n de red servidor 1 :\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","OPENVPN"],"title":"VPN site to site con OpenVPN y certificados x509"},{"categories":null,"contents":"\n[!NOTE]\nVoy a partir del post de VPN acceso remoto con Wireguard , asi que es posible que haga referencia a este durante este articulo .\nGeneraci√≥n de claves Lo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\nroot@servidor1:~# sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard debian@servidor2:~$ sudo apt update \u0026amp;\u0026amp; sudo apt install wireguard Vamos a generar los pares de claves que se utilizar√°n para cifrar la conexi√≥n. Necesitaremos una clave para el servidor y un par de claves adicionales por cada cliente.\nComenzaremos con el par de claves del servidor1:\ndebian@servidor1:~$ wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= # Puedes visualizar la clave privada posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_private.key 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= # Puedes visualizar la clave publica posteriormente : debian@servidor1:~$ sudo cat /etc/wireguard/server_public.key 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= Nos desplazamos al servidor2 y les generamos las suyas :\n# Generamos el par de claves para el cliente de acceso remoto servidor2 debian@servidor2:~$ wg genkey | sudo tee /etc/wireguard/client_private.key | wg pubkey | sudo tee /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= # Puedes visualizar la clave privada posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_private.key 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= # Puedes visualizar la clave publica posteriormente : debian@servidor2:~$ sudo cat /etc/wireguard/client_public.key gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= Configuraci√≥n de Wireguard Vamos a modificar el archivo de configuraci√≥n en la m√°quina servidor1. La √∫nica modificaci√≥n necesaria ser√° en el par√°metro \u0026ldquo;AllowedIPs\u0026rdquo;, donde debemos agregar la direcci√≥n de red a la que nos conectaremos. Adem√°s, incluiremos en el campo \u0026ldquo;Peer Endpoint\u0026rdquo; la direcci√≥n IP de la otra m√°quina, ya que ambas actuar√°n como servidores en esta configuraci√≥n.\ndebian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf [Interface] Address = 10.99.99.1 PrivateKey = 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA= ListenPort = 51820 [Peer] Publickey = gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g= AllowedIPs = 10.99.99.2/32,192.168.1.0/24 PersistentKeepAlive = 25 Endpoint = 100.0.0.2:51820 Lo mismo para la maquina servidor2 , la configuraci√≥n quedar√≠a as√≠:\ndebian@servidor2:~$ sudo cat /etc/wireguard/wg0.conf [Interface] Address = 10.99.99.2/24 PrivateKey = 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k= ListenPort = 51820 [Peer] PublicKey = 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ= AllowedIPs = 10.99.99.1/32,192.168.0.0/24 Endpoint = 90.0.0.2:51820 PersistentKeepalive = 25 Como yo tengo levantado los t√∫neles del ejercicio anterior los bajaremos y los subiremos para que se aplique la nueva configuraci√≥n :\ndebian@servidor1:~$ sudo wg-quick down wg0 debian@servidor2:~$ sudo wg-quick down wg0 debian@servidor1:~$ sudo wg-quick up wg0 debian@servidor1:~$ sudo wg-quick up wg0 Comprobaremos que en ambos servidores se ha creado la interfaz wg0 , que es la que nos corresponde por el nombre del fichero de configuraci√≥n :\ndebian@servidor1:~$ sudo ip link show wg0 11: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/none debian@servidor2:~$ sudo ip link show wg0 11: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1420 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000 link/none A continuaci√≥n voy a mostrarte las tablas de enroutamiento de los 2 servidores para que veas que se han creado rutas para llegar a ambas redes privadas por la interfaz wg0:\ndebian@servidor1:~$ ip r default via 90.0.0.1 dev ens3 onlink 10.99.99.2 dev wg0 scope link 90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 192.168.1.0/24 dev wg0 scope link debian@servidor2:~$ ip r default via 100.0.0.1 dev ens3 onlink 10.99.99.0/24 dev wg0 proto kernel scope link src 10.99.99.2 100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 192.168.0.0/24 dev wg0 scope link 192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 Comprobaci√≥n de funcionamiento Ahora, ambas redes privadas est√°n completamente conectadas, lo que nos permite acceder desde cualquiera de las dos a la otra. Vamos a llevar a cabo algunas pruebas desde los clientes para asegurarnos de que la conexi√≥n est√© funcionando correctamente.\nVoy a hacer un ping desde la red 192.168.0.0 a la 192.168.1.0 con cliente1 :\n# cliente1 --\u0026gt; servidor2 debian@cliente1:~$ ping 192.168.1.1 -c 1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=17.6 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.554/17.554/17.554/0.000 ms # Cliente1 --\u0026gt; Cliente 3 debian@cliente1:~$ ping 192.168.1.2 -c 1 PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data. 64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=12.9 ms debian@cliente1:~$ ping 192.168.1.1 -c 1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=17.8 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 17.803/17.803/17.803/0.000 ms # Cliente1 --\u0026gt; Windows debian@cliente1:~$ ping 192.168.1.5 -c 1 PING 192.168.1.5 (192.168.1.5) 56(84) bytes of data. 64 bytes from 192.168.1.5: icmp_seq=1 ttl=126 time=19.9 ms --- 192.168.1.5 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 19.906/19.906/19.906/0.000 ms # Cliente1 --\u0026gt; Android debian@cliente1:~$ ping 192.168.1.4 -c 1 PING 192.168.1.4 (192.168.1.4) 56(84) bytes of data. 64 bytes from 192.168.1.4: icmp_seq=1 ttl=62 time=20.8 ms --- 192.168.1.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 20.834/20.834/20.834/0.000 ms Como ves tengo conectividad desde cualquier cliente de la red 192.168.0.0 con la 192.168.1.0 .\nVamos a comprobarlo en la direcci√≥n contraria , es decir desde la red 192.168.1.0 hacia la 192.168.0.0 :\n# Cliente3 --\u0026gt; Servidor1 debian@cliente3:~$ ping 192.168.0.1 -c 1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=63 time=16.6 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 16.581/16.581/16.581/0.000 ms # Cliente3 --\u0026gt; Cliente1 debian@cliente3:~$ ping 192.168.0.2 -c 1 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=21.0 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 21.031/21.031/21.031/0.000 ms # Cliente3 --\u0026gt; Cliente2 debian@cliente3:~$ ping 192.168.0.3 -c 1 PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data. 64 bytes from 192.168.0.3: icmp_seq=1 ttl=62 time=16.1 ms --- 192.168.0.3 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 16.115/16.115/16.115/0.000 ms Para cerciorarnos de que el trafico esta pasando por el t√∫nel en los 2 extremos vamos a hacer un traceroute desde las 2 redes :\nDesde la red 192.168.0.0 a la 192.168.1.0 :\ndebian@cliente1:~$ traceroute 192.168.1.2 traceroute to 192.168.1.2 (192.168.1.2), 30 hops max, 60 byte packets 1 192.168.0.1 (192.168.0.1) 0.629 ms 0.601 ms 0.595 ms 2 10.99.99.2 (10.99.99.2) 13.677 ms 13.667 ms 13.657 ms 3 192.168.1.2 (192.168.1.2) 13.649 ms 13.636 ms 13.626 ms Desde la red 192.168.1.0 a la 192.168.0.0 :\ndebian@cliente3:~$ traceroute 192.168.0.3 traceroute to 192.168.0.3 (192.168.0.3), 30 hops max, 60 byte packets 1 192.168.1.1 (192.168.1.1) 0.430 ms 0.399 ms 0.393 ms 2 10.99.99.1 (10.99.99.1) 19.343 ms 19.337 ms 19.329 ms 3 192.168.0.3 (192.168.0.3) 19.324 ms 19.320 ms 19.313 ms ","date":"March 28, 2024","hero":"/images/vpn/wireguard_site_to_site.png","permalink":"https://www.javiercd.es/posts/vpn/site_to_site_wireguard/site_to_site_wireguard/","summary":"\u003cp\u003e\u003cimg src=\"/vpn/site_to_site_wireguard/img/Pastedimage20240114150833.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nVoy a partir del post de VPN acceso remoto con Wireguard , asi que es posible que haga referencia a este durante este articulo .\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch2 id=\"generaci√≥n-de-claves\"\u003eGeneraci√≥n de claves\u003c/h2\u003e\n\u003cp\u003eLo primero que haremos sera instalarnos tanto en ambas maquinas el paquete Wireguard :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eroot@servidor1:~# sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003edebian@servidor2:~$ sudo apt update \u003cspan style=\"color:#f92672\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e sudo apt install wireguard\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVamos a generar los pares de claves que se utilizar√°n para cifrar la conexi√≥n. Necesitaremos una clave para el servidor y un par de  claves adicionales por cada cliente.\u003c/p\u003e","tags":["VPN","CISCO","LINUX","DEBIAN","WIREGUARD"],"title":"VPN site to site Wireguard"},{"categories":null,"contents":"En este post voy a montar una VPN IPSEC usando routers cisco .\n[!NOTE]\nEn este post se detalla la configuraci√≥n de los routers R2 y R3 , sin embargo R1 esta explicado en el post de \u0026ldquo;VPN acceso remoto OpenVPN\u0026rdquo; . Si quieres ver la configuraci√≥n de este ultimo m√≠rate el apartado preparando el escenario .\nConfiguraci√≥n del escenario Como he cambiado de escenario , hay que configurar los 2 nuevos routers en la red R2 y R3 .\nComenzare por R2 :\nR2(config)#interface FastEthernet0/0 R2(config-if)# ip address 192.168.0.1 255.255.255.0 R2(config-if)#no shut R2(config)#interface FastEthernet1/0 R2(config-if)# ip address 90.0.0.2 255.255.255.0 R2(config-if)# no shutdown R2(config)#ip route 0.0.0.0 0.0.0.0 90.0.0.1 #SNAT R2(config)#$ ip nat pool NAT-Pool 90.0.0.2 90.0.0.2 prefix-length 24 R2(config)#ip nat inside source list 1 pool NAT-Pool overload R2(config)#interface FastEthernet0/0 R2(config-if)#ip nat inside R2(config-if)#interface FastEthernet1/0 R2(config-if)#ip nat outside Lo mismo pero con R3 :\nR3(config)#Interface FastEthernet0/0 R3(config-if)#ip address 192.168.1.1 255.255.255.0 R3(config-if)#no shut R3(config-if)#exit R3(config)#Interface FastEthernet1/0 R3(config-if)#ip address 100.0.0.2 255.255.255.0 R3(config-if)#no shut R3(config-if)#exit R3(config)#ip route 0.0.0.0 0.0.0.0 100.0.0.1 R3(config)#ip nat pool NAT-Pool 100.0.0.2 100.0.0.2 prefix-length 24 R3(config)#ip nat inside source list 1 pool NAT-Pool overload R3(config)#interface FastEthernet0/0 R3(config-if)#ip nat inside R3(config-if)#interface FastEthernet1/0 R3(config-if)#ip nat outside Configuraci√≥n VPN IPSEC Cisco Una vez tenemos configurado el escenario como en los ejercicios anteriores pero ahora todos los routers del escenario son cisco vamos a proceder con la configuraci√≥n de la VPN IPSEC . Lo ideal es que compruebes que el escenario esta bien enrutado , para no hacer mas largo este documento voy a omitirlo .\nRouter 2 A continuaci√≥n te describo paso a paso la configuraci√≥n que hay que realizar en R2 , haciendo uso de comentarios te indicare que estamos haciendo en cada momento :\n# Entramos en el modo de configuraci√≥n R2#conf term # Creamos una pol√≠tica ISAKMP , en mi caso con un n√∫mero de secuencia de 10. R2(config)#crypto isakmp policy 10 # Establecemos el algoritmo de cifrado AES para la pol√≠tica ISAKMP. R2(config-isakmp)# encryption aes # Configuramos el algoritmo de hash SHA para la pol√≠tica ISAKMP. R2(config-isakmp)# hash sha # Configuramos la autenticaci√≥n precompartida (pre-shared key) para la pol√≠tica ISAKMP. R2(config-isakmp)# authentication pre-share # Establecemos el grupo de difie-hellman con 2048 bits para la pol√≠tica ISAKMP. R2(config-isakmp)# group 14 # Configuramos la clave precompartida para autenticaci√≥n con el par remoto 100.0.0.2. R2(config-isakmp)#crypto isakmp key TuClavePrecompartida address 100.0.0.2 # Creamos un conjunto de transformaci√≥n para la fase 2 (IPsec) con cifrado AES y hash SHA. R2(config)#crypto ipsec transform-set myset esp-aes esp-sha-hmac # Creamos una lista de acceso (ACL) para especificar el tr√°fico a proteger con IPsec. R2(cfg-crypto-trans)# access-list 100 permit ip 192.168.1.0 0.0.0.255 192.168.0.0 0.0.0.255 # Creamos un mapa criptogr√°fico asociado a ISAKMP e IPsec con n√∫mero de secuencia 10. R2(config)#crypto map mymap 10 ipsec-isakmp # Especificamos la direcci√≥n IP del peer remoto. R2(config-crypto-map)# set peer 100.0.0.2 # Asociamos el conjunto de transformaci√≥n al mapa criptogr√°fico. R2(config-crypto-map)# set transform-set myset # Asociamos la lista de acceso al mapa criptogr√°fico para identificar el tr√°fico a proteger. R2(config-crypto-map)# match address 100 # Entramos a la interfaz FastEthernet1/0 (PUBLICA) y le asignamos el mapa criptografico para que envie por esta el trafico de la VPN . R2(config-crypto-map)#interface FastEthernet1/0 R2(config-if)# crypto map mymap Router 3 A continuaci√≥n te describo paso a paso la configuraci√≥n que hay que realizar en R3 , haciendo uso de comentarios te indicare que estamos haciendo en cada momento :\n# Entramos en el modo de configuraci√≥n R3#conf term # Creamos una pol√≠tica ISAKMP , en mi caso con un n√∫mero de secuencia de 10. R3(config)#crypto isakmp policy 10 # Establecemos el algoritmo de cifrado AES para la pol√≠tica ISAKMP. R3(config-isakmp)# encryption aes # Configuramos el algoritmo de hash SHA para la pol√≠tica ISAKMP. R3(config-isakmp)# hash sha # Configuramos la autenticaci√≥n precompartida (pre-shared key) para la pol√≠tica ISAKMP. R3(config-isakmp)# authentication pre-share # Establecemos el grupo de difie-hellman con 2048 bits para la pol√≠tica ISAKMP. R3(config-isakmp)# group 14 # Configuramos la clave precompartida para autenticaci√≥n con el par remoto 100.0.0.2. R3(config-isakmp)#crypto isakmp key TuClavePrecompartida address 90.0.0.2 # Creamos un conjunto de transformaci√≥n para la fase 2 (IPsec) con cifrado AES y hash SHA. R3(config)#crypto ipsec transform-set myset esp-aes esp-sha-hmac # Creamos una lista de acceso (ACL) para especificar el tr√°fico a proteger con IPsec. R3(cfg-crypto-trans)#access-list 100 permit ip 192.168.1.0 0.0.0.255 192.168.0.0 0.0.0.255 # Creamos un mapa criptogr√°fico asociado a ISAKMP e IPsec con n√∫mero de secuencia 10. R3(config)#crypto map mymap 10 ipsec-isakmp # Especificamos la direcci√≥n IP del peer remoto. R3(config-crypto-map)# set peer 90.0.0.2 # Asociamos el conjunto de transformaci√≥n al mapa criptogr√°fico. R3(config-crypto-map)# set transform-set myset # Asociamos la lista de acceso al mapa criptogr√°fico para identificar el tr√°fico a proteger. R3(config-crypto-map)# match address 100 # Entramos a la interfaz FastEthernet1/0 (PUBLICA) y le asignamos el mapa criptografico para que envie por esta el trafico de la VPN . R3(config-crypto-map)#interface FastEthernet1/0 R3(config-if)# crypto map mymap Comprobaciones Una vez aplicada la configuraci√≥n vamos a ver que en ambos extremos la configuraci√≥n sea correcta , viendo que los t√∫neles est√©n levantados :\nR3#show crypto session Crypto session current status Interface: FastEthernet1/0 Session status: UP-ACTIVE Peer: 90.0.0.2 port 500 IKE SA: local 100.0.0.2/500 remote 90.0.0.2/500 Active IPSEC FLOW: permit ip 192.168.1.0/255.255.255.0 192.168.0.0/255.255.255.0 Active SAs: 2, origin: crypto map R2#show crypto session Crypto session current status Interface: FastEthernet1/0 Session status: UP-ACTIVE Peer: 100.0.0.2 port 500 IKE SA: local 90.0.0.2/500 remote 100.0.0.2/500 Active IPSEC FLOW: permit ip 192.168.0.0/255.255.255.0 192.168.1.0/255.255.255.0 Active SAs: 2, origin: crypto map Ya viendo esto podemos cerciorarnos de que la VPN esta levantada pero existen mas comandos que nos brindan diferente informaci√≥n :\n**show crypto isakmp sa : ** Para comprobar las asociaciones ISAKMP **show crypto ipsec sa : ** **Para comprobar las asociaciones IPsec Prueba de conectividad Vamos a comprobar que los distintos clientes de la red 192.168.0.0 pueden comunicarse con los otros de la red 192.168.1.0 :\n# Cliente 1 --\u0026gt; R3 debian@cliente1:~$ ping -c 1 192.168.1.1 PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data. 64 bytes from 192.168.1.1: icmp_seq=1 ttl=254 time=89.2 ms --- 192.168.1.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 89.167/89.167/89.167/0.000 ms # Cliente1 --\u0026gt; Cliente 3 debian@cliente1:~$ ping -c 1 192.168.1.2 PING 192.168.1.2 (192.168.1.2) 56(84) bytes of data. 64 bytes from 192.168.1.2: icmp_seq=1 ttl=62 time=46.4 ms --- 192.168.1.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 46.412/46.412/46.412/0.000 ms Vamos a comprobar que los distintos clientes de la red 192.168.1.0 pueden comunicarse con los otros de la red 192.168.0.0 :\n# Cliente 3 --\u0026gt; R2 debian@cliente3:~$ ping -c 1 192.168.0.1 PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data. 64 bytes from 192.168.0.1: icmp_seq=1 ttl=254 time=54.4 ms --- 192.168.0.1 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 54.440/54.440/54.440/0.000 ms # Cliente 3 --\u0026gt; Cliente 1 debian@cliente3:~$ ping -c 1 192.168.0.2 PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data. 64 bytes from 192.168.0.2: icmp_seq=1 ttl=62 time=33.5 ms --- 192.168.0.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 33.498/33.498/33.498/0.000 ms ","date":"March 28, 2024","hero":"/images/vpn/ipsec_cisco.png","permalink":"https://www.javiercd.es/posts/vpn/ipsec_cisco/ipsec_cisco/","summary":"\u003cp\u003eEn este post voy a montar una VPN IPSEC usando routers cisco .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/vpn/ipsec_cisco/img/Pastedimage20240128120659.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e[!NOTE]\u003cbr\u003e\nEn este post se detalla la configuraci√≥n de los routers R2 y R3 , sin embargo R1 esta explicado en el post de \u0026ldquo;VPN acceso remoto OpenVPN\u0026rdquo; . Si quieres ver la configuraci√≥n de este ultimo m√≠rate el apartado preparando el escenario .\u003c/p\u003e\u003c/blockquote\u003e\n\u003ch3 id=\"configuraci√≥n-del-escenario\"\u003eConfiguraci√≥n del escenario\u003c/h3\u003e\n\u003cp\u003eComo he cambiado de escenario , hay que configurar los 2 nuevos routers en la red R2 y R3 .\u003c/p\u003e","tags":["VPN","LINUX","CISCO"],"title":"VPN sitio a sitio con IPsec Cisco"},{"categories":null,"contents":"En este post voy a montar una VPN IPSEC usando cortafuegos Fortinet , para ello los visualizar√© en GNS3 .\nPreparaci√≥n del escenario Para crear la VPN a√±adir√© al escenario un nuevo Fortigate .\nAs√≠ que vamos a proceder a configurarlo , lo primero sera conocer la IP que le ha dado el DHCP :\nFortiGate-VM64-KVM login: admin Password: You are forced to change your password. Please input a new password. New Password: Confirm Password: Welcome! FortiGate-VM64-KVM # get system interface physical port1 == [onboard] ==[port1] mode: dhcp ip: 192.168.122.22 255.255.255.0 ipv6: ::/0 status: up speed: 1000Mbps (Duplex: full) FEC: none FEC_cap: none Esta IP que me ha dado por DHCP se la configurare como est√°tica .\nEn cuanto a la red local del nuevo FortiNet , va a tener la red 192.168.30.0 :\nPor ultimo configurare en este la ruta por defecto hacia la direcci√≥n IP de de la nube NAT la 192.168.122.1/24 :\nUna vez hecho esto vamos a ver que tenemos conectividad entre ambos cortafuegos , desde FGT \u0026ndash;\u0026gt; FTG2 :\nY al rev√©s desde FTG2 \u0026ndash;\u0026gt; FTG :\nVPN site to site Nos dirigimos primero al FortiGate FTG que es el que contiene los clientes de Odin,Loki,Thor y Hela . Y iremos a IPsec Wizard , le pondr√© un nombre significativo con el nombre de los hosts :\nEn el siguiente paso vamos a indicar la IP del FortiGate FTG2 , la interfaz por donde saldr√° el trafico y por ultimo una \u0026ldquo;llave\u0026rdquo; compartida entre los dos extremos , esta ultima parte puede sustituirse por certificados :\nA continuaci√≥n indicaremos las redes locales de ambos extremos donde queremos tener conectividad :\nNos saldr√° un panel con los distintos objetos que se van a crear y le daremos a crear :\nRepetiremos el mismo proceso en el otro Fortigate , crearemos un t√∫nel site to site :\nLe diremos la IP publica del otro extremo y pondremos la misma clave compartida :\nAhora le diremos cual es nuestra red local y la red remota :\nPor ultimo nos dir√° los objetos que se van a crear y le damos a crear :\nAhora si accedemos a los paneles de IPsec Tunnels veremos que en unos segundos ambos t√∫neles se levantaran :\nComprobaci√≥n de funcionamiento Una vez llegado a este punto veremos que la VPN esta funcionando . Podemos hacer un ping en ambas direcciones :\ndebian@cliente1:~$ ping 192.168.100.4 -c 1 PING 192.168.100.4 (192.168.100.4) 56(84) bytes of data. 64 bytes from 192.168.100.4: icmp_seq=1 ttl=62 time=1.22 ms --- 192.168.100.4 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.220/1.220/1.220/0.000 ms debian@thor:~$ ping 192.168.30.2 -c 1 PING 192.168.30.2 (192.168.30.2) 56(84) bytes of data. 64 bytes from 192.168.30.2: icmp_seq=1 ttl=62 time=1.52 ms --- 192.168.30.2 ping statistics --- 1 packets transmitted, 1 received, 0% packet loss, time 0ms rtt min/avg/max/mdev = 1.516/1.516/1.516/0.000 ms Como vemos tenemos conectividad entre las 2 redes privadas a trav√©s de la VPN .\nSi nos paramos a ver los objetos que nos ha creado cada t√∫nel , este nos ha creado un total de 4 , los cuales tendremos que borrar si deseamos eliminar el t√∫nel :\nPor defecto la pol√≠tica que nos ha creado permite TODO el trafico en ambas direcciones , estas 2 pol√≠ticas la tenemos creada en cada cortafuegos y modificando estas o a√±adiendo nuevas podemos limitar el trafico que pasa por la VPN en funci√≥n de nuestras necesidades .\nAdemas nos habr√° creado una ruta para encaminar el trafico hacia la red privada del otro extremo :\n","date":"March 28, 2024","hero":"/images/vpn/fortinet_site_to_site.png","permalink":"https://www.javiercd.es/posts/vpn/site_to_site_fortinet/site_to_site_fortinet/","summary":"\u003cp\u003eEn este post voy a montar una VPN IPSEC usando cortafuegos Fortinet  , para ello los visualizar√© en GNS3 .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/vpn/site_to_site_fortinet/img/Pastedimage20240330235321.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"preparaci√≥n-del-escenario\"\u003ePreparaci√≥n del escenario\u003c/h2\u003e\n\u003cp\u003ePara crear la VPN a√±adir√© al escenario un nuevo Fortigate .\u003c/p\u003e\n\u003cp\u003eAs√≠ que vamos a proceder a configurarlo , lo primero sera conocer la IP que le ha dado el DHCP :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eFortiGate-VM64-KVM login: admin\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePassword: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eYou are forced to change your password. Please input a new password.\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNew Password: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eConfirm Password: \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eWelcome!\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eFortiGate-VM64-KVM \u003cspan style=\"color:#75715e\"\u003e# get system interface physical port1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e==\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003eonboard\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#f92672\"\u003e==[\u003c/span\u003eport1\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tmode: dhcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tip: 192.168.122.22 255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tipv6: ::/0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tstatus: up\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tspeed: 1000Mbps \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003eDuplex: full\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tFEC: none\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\tFEC_cap: none\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eEsta IP que me ha dado por DHCP se la configurare como est√°tica .\u003c/p\u003e","tags":["VPN","LINUX","FORTINET"],"title":"VPN sitio a sitio con IPsec Fortinet"},{"categories":null,"contents":"El objetivo de esta pr√°ctica es el desarrollo gradual de un Pipeline que vaya realizando tareas sobre el repositorio de una aplicaci√≥n.\nLa aplicaci√≥n con la que vamos a trabajar ser√° tu fork de la aplicaci√≥n django Polls. Como hemos visto esta aplicaci√≥n que implementa el tutorial de Django tiene implementado un m√≥dulo de pruebas.\nVamos a construir el Pipeline en varias fases:\nEjercicio 1: Construcci√≥n de una imagen docker Partimos del pipeline que hemos desarrollado en el¬†Taller 3: Integraci√≥n continua de aplicaci√≥n django (Test), donde hemos automatizado el test de la aplicaci√≥n.\nModifica el pipeline para que despu√©s de hacer el test sobre la aplicaci√≥n, genere una imagen docker. tienes que tener en cuenta que los pasos para generar la imagen lo tienes que realizar en la m√°quina donde est√° instalado Jenkins. Tendr√°s que a√±adir las siguientes acciones:\nConstruir la imagen con el¬†Dockerfile¬†que tengas en el repositorio. Subir la imagen a tu cuenta de Docker Hub. Borrar la imagen que se ha creado. Por lo tanto tienes que estudiar el apartado¬†Ejecuci√≥n de un pipeline en varios runner¬†para ejecutar el pipeline en dos runner:\nEn el contenedor docker a partir de la imagen¬†python:3¬†los pasos del taller 3. En la m√°quina de Jenkins los pasos de este ejercicio. Otras consideraciones:\nCuando termine de ejecutar el pipeline te mandar√° un correo de notificaci√≥n. El pipeline se guardar√° en un fichero¬†Jenkinsfile¬†en tu repositorio, y la configuraci√≥n del pipeline har√° referencia a √©l. Entrega Una captura de pantalla donde se vea la salida de un build que se ha ejecutado de manera correcta. Una captura de pantalla de tu cuenta de Docker Hub donde se vea la imagen subida de √∫ltimo build. Introduce un fallo en el¬†Dockerfile¬†y muestra la salida del build donde se produce el error. Entrega la URL del repositorio para ver el¬†Jenkinsfile. https://github.com/javierasping/django_tutorial_docker.git Pantallazo con el correo que has recibido de la ejecuci√≥n del pipeline. Ejercicio 2: Despliegue de la aplicaci√≥n Ampl√≠a el pipeline anterior para que tenga una √∫ltima etapa donde se haga el despliegue de la imagen que se ha subido a Docker Hub en tu entorno de producci√≥n (VPS). Algunas pistas:\nBusca informaci√≥n de c√≥mo hacer el despliegue a un servidor remoto (ssh, buscando alg√∫n plugin con esa funcionalidad,‚Ä¶) Si vas a hacer conexiones por ssh, tendr√°s que guardar una credencial en tu Jenkins con el nombre de usuario y contrase√±a. Para el despliegue deber√° usar el fichero¬†docker-compose.yaml¬†que has generado en otras pr√°cticas. Se deber√° borrar el contenedor con la versi√≥n anterior, descargar la nueva imagen y crear un nuevo contenedor. Otras consideraciones:\nCambia el disparador del pipeline. Config√∫ralo con un webhook de github, para que cada vez que se produce un push se ejecute el pipeline. Para que el webhook pueda acceder a tu Jenkins puedes usar¬†ngrok. Entrega El contenido del fichero¬†Jenkinsfile. Las credenciales que has guardado en Jenkins. Demuestra al profesor como se realiza la IC/DC completo. Ejecuci√≥n normal del pipeline :\nLa configuraci√≥n de nginx y los contenedores ejecutandose\njaviercruces@atlas:~$ sudo cat /etc/nginx/sites-available/django_docker server { listen 80; server_name djangodocker.javiercd.es; return 301 https://$host$request_uri; } server { listen 443 ssl; server_name djangodocker.javiercd.es; ssl_certificate /etc/letsencrypt/live/javiercd.es/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/javiercd.es/privkey.pem; location / { proxy_pass http://localhost:8082; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } } javiercruces@atlas:~$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 4d7947fc359f javierasping/django_tutorial_ic \u0026#34;/bin/sh -c \u0026#39;python3‚Ä¶\u0026#34; 33 minutes ago Up 33 minutes 0.0.0.0:8082-\u0026gt;3000/tcp, :::8082-\u0026gt;3000/tcp django_tutorial_web bdf947a4bccc mariadb \u0026#34;docker-entrypoint.s‚Ä¶\u0026#34; 33 minutes ago Up 33 minutes 3306/tcp mariadb-django La aplicaci√≥n funcionando en el VPS :\nLa configuraci√≥n de Ngrok y el Webhook\ncurl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc \\ | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc \u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;deb https://ngrok-agent.s3.amazonaws.com buster main\u0026#34; \\ | sudo tee /etc/apt/sources.list.d/ngrok.list \u0026amp;\u0026amp; sudo apt update \u0026amp;\u0026amp; sudo apt install ngrok javiercruces@atlas:~$ ngrok config add-authtoken 2d2CfE debian@jenkins:~$ ngrok http http://localhost:8082 Si provocamos el fallo :\n","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/practica.png","permalink":"https://www.javiercd.es/posts/ci_cd/practica_jenkins/practica_jenkins/","summary":"\u003cp\u003eEl objetivo de esta pr√°ctica es el desarrollo gradual de un Pipeline que vaya realizando tareas sobre el repositorio de una aplicaci√≥n.\u003c/p\u003e\n\u003cp\u003eLa aplicaci√≥n con la que vamos a trabajar ser√° tu fork de la aplicaci√≥n django Polls. Como hemos visto esta aplicaci√≥n que implementa el tutorial de Django tiene implementado un m√≥dulo de pruebas.\u003c/p\u003e\n\u003cp\u003eVamos a construir el Pipeline en varias fases:\u003c/p\u003e\n\u003ch2 id=\"ejercicio-1-construcci√≥n-de-una-imagen-docker\"\u003e\u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/practica.html#ejercicio-1-construcci%C3%B3n-de-una-imagen-docker\" target=\"_blank\" rel=\"noopener\"\u003eEjercicio 1: Construcci√≥n de una imagen docker\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ePartimos del pipeline que hemos desarrollado en el¬†\u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/taller3.html\" target=\"_blank\" rel=\"noopener\"\u003eTaller 3: Integraci√≥n continua de aplicaci√≥n django (Test)\u003c/a\u003e, donde hemos automatizado el test de la aplicaci√≥n.\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Pr√°ctica CI/CD con Jenkins"},{"categories":null,"contents":"Taller 1: Almacenamiento y redes en Docker Almacenamiento Vamos a trabajar con vol√∫menes docker:\nCrea un volumen docker que se llame¬†miweb. javiercruces@docker:~$ docker volume create miweb miweb Crea un contenedor desde la imagen¬†php:7.4-apache¬†donde montes en el directorio¬†/var/www/html¬†(que sabemos que es el¬†DocumentRoot¬†del servidor que nos ofrece esa imagen) el volumen docker que has creado. javiercruces@docker:~$ docker run -d --name my-apache-app -v miweb:/var/www/html -p 8080:80 php:7.4-apache Utiliza el comando¬†docker cp¬†para copiar un fichero¬†index.html¬†(donde aparece tu nombre) en el directorio¬†/var/www/html. javiercruces@docker:~$ echo \u0026#34;\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\u0026#34; \u0026gt; index.html javiercruces@docker:~$ docker cp index.html my-apache-app:/var/www/html/ Successfully copied 2.05kB to my-apache-app:/var/www/html/ Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero¬†index.html. javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt; Borra el contenedor javiercruces@docker:~$ docker rm -f my-apache-app my-apache-app Crea un nuevo contenedor y monta el mismo volumen como en el ejercicio anterior. javiercruces@docker:~$ docker run -d --name Taller1 -v miweb:/var/www/html -p 8080:80 php:7.4-apache 9edd4b2dd2499f923090ce6a246e44db136f162528a51f84ddb33659503bafd7 Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero¬†index.html. ¬øSegu√≠a existiendo ese fichero? javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt; Vamos a trabajar con bind mount:\nCrea un directorio en tu host y dentro crea un fichero¬†index.html¬†(donde aparece tu nombre). javiercruces@docker:~$ mkdir taller1 javiercruces@docker:~$ cp index.html taller1/ Crea un contenedor desde la imagen¬†php:7.4-apache¬†donde montes en el directorio¬†/var/www/html¬†el directorio que has creado por medio de¬†bind mount. javiercruces@docker:~$ docker run -d --name Taller1 -v /home/javiercruces/taller1/:/var/www/html -p 8080:80 php:7.4-apache Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero¬†index.html. javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt; Modifica el contenido del fichero¬†index.html¬†en tu host y comprueba que al refrescar la p√°gina ofrecida por el contenedor, el contenido ha cambiado. javiercruces@docker:~$ echo \u0026#34;\u0026lt;h1\u0026gt;Javier Cruces Doval\u0026lt;/h1\u0026gt;\u0026#34; \u0026gt; taller1/index.html javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces Doval\u0026lt;/h1\u0026gt; Borra el contenedor javiercruces@docker:~$ docker rm -f Taller1 Taller1 Crea un nuevo contenedor y monta el mismo directorio como en el ejercicio anterior. javiercruces@docker:~$ docker run -d --name Taller1 -v /home/javiercruces/taller1/:/var/www/html -p 8080:80 php:7.4-apache Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero¬†index.html. ¬øSe sigue viendo el mismo contenido? javiercruces@docker:~$ curl http://localhost:8080 \u0026lt;h1\u0026gt;Javier Cruces Doval\u0026lt;/h1\u0026gt; Redes Despliegue de Nextcloud + mariadb Vamos a desplegar la aplicaci√≥n Nextcloud con una base de datos (NOTA: Para que no te de errores utiliza la imagen¬†mariadb:10.5). Te puede servir el ejercicio que hemos realizado para desplegar¬†Wordpress. Para ello sigue los siguientes pasos:\nCrea una red de tipo bridge. javiercruces@docker:~$ docker network create taller1 a1f8faf5a100ad01013bc147e7c2a9577a5a4376d7e33c7d961c5aaca93000b0 Crea el contenedor de la base de datos conectado a la red que has creado. La base de datos se debe configurar para crear una base de datos y un usuario. Adem√°s el contenedor debe utilizar almacenamiento (vol√∫menes o bind mount) para guardar la informaci√≥n. Puedes seguir la documentaci√≥n de¬†mariadb¬†o la de¬†PostgreSQL. javiercruces@docker:~$ docker run -d --name wp_db \\ --network taller1 \\ -v db_vol:/var/lib/mysql \\ -e MYSQL_ROOT_PASSWORD=wordpress \\ -e MYSQL_DATABASE=wordpress \\ -e MYSQL_USER=wordpress \\ -e MYSQL_PASSWORD=wordpress \\ mariadb:10.5 A continuaci√≥n, siguiendo la documentaci√≥n de la imagen¬†Nextcloud, crea un contenedor conectado a la misma red, e indica las variables adecuadas para que se configure de forma adecuada y realice la conexi√≥n a la base de datos. El contenedor tambi√©n debe ser persistente usando almacenamiento. javiercruces@docker:~$ docker run -d --name nextcloud \\ --network taller1 \\ -e MYSQL_DATABASE=wordpress \\ -e MYSQL_USER=wordpress \\ -e MYSQL_PASSWORD=wordpress \\ -e MYSQL_HOST=wp_db \\ -p 8080:80 \\ nextcloud:latest Accede a la aplicaci√≥n usando un navegador web. ","date":"March 14, 2024","hero":"/images/docker/taller1.png","permalink":"https://www.javiercd.es/posts/docker/taller1/taller1_docker/","summary":"\u003ch2 id=\"taller-1-almacenamiento-y-redes-en-docker\"\u003eTaller 1: Almacenamiento y redes en Docker\u003c/h2\u003e\n\u003ch3 id=\"almacenamiento\"\u003eAlmacenamiento\u003c/h3\u003e\n\u003cp\u003eVamos a trabajar con vol√∫menes docker:\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCrea un volumen docker que se llame¬†\u003ccode\u003emiweb\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker volume create miweb\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emiweb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eCrea un contenedor desde la imagen¬†\u003ccode\u003ephp:7.4-apache\u003c/code\u003e¬†donde montes en el directorio¬†\u003ccode\u003e/var/www/html\u003c/code\u003e¬†(que sabemos que es el¬†\u003cem\u003eDocumentRoot\u003c/em\u003e¬†del servidor que nos ofrece esa imagen) el volumen docker que has creado.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker run -d --name my-apache-app -v miweb:/var/www/html -p 8080:80 php:7.4-apache\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eUtiliza el comando¬†\u003ccode\u003edocker cp\u003c/code\u003e¬†para copiar un fichero¬†\u003ccode\u003eindex.html\u003c/code\u003e¬†(donde aparece tu nombre) en el directorio¬†\u003ccode\u003e/var/www/html\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ echo \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\u0026#34;\u003c/span\u003e \u0026gt; index.html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker cp index.html my-apache-app:/var/www/html/\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSuccessfully copied 2.05kB to my-apache-app:/var/www/html/\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"4\"\u003e\n\u003cli\u003eAccede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero¬†\u003ccode\u003eindex.html\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ curl http://localhost:8080\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"5\"\u003e\n\u003cli\u003eBorra el contenedor\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker rm -f my-apache-app\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003emy-apache-app\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"6\"\u003e\n\u003cli\u003eCrea un nuevo contenedor y monta el mismo volumen como en el ejercicio anterior.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ docker run -d --name Taller1 -v miweb:/var/www/html -p 8080:80 php:7.4-apache\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e9edd4b2dd2499f923090ce6a246e44db136f162528a51f84ddb33659503bafd7\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"7\"\u003e\n\u003cli\u003eAccede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero¬†\u003ccode\u003eindex.html\u003c/code\u003e. ¬øSegu√≠a existiendo ese fichero?\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~$ curl http://localhost:8080\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;h1\u0026gt;Javier Cruces\u0026lt;/h1\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eVamos a trabajar con bind mount:\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Taller 1: Almacenamiento y redes en Docker"},{"categories":null,"contents":"Taller 1: Corrector ortogr√°fico de documentos markdown (test) ¬øQu√© tienes que entregar? La URL del tu repositorio GitHub. https://github.com/javierasping/taller1_jenkins_ic-diccionario El contenido de la tu fichero¬†Jenkinfile. pipeline { agent { docker { image \u0026#39;debian\u0026#39; args \u0026#39;-u root:root\u0026#39; } } stages { stage(\u0026#39;Clone\u0026#39;) { steps { git branch:\u0026#39;master\u0026#39;, url:\u0026#39;https://github.com/javierasping/taller1_jenkins_ic-diccionario.git\u0026#39; } } stage(\u0026#39;Install\u0026#39;) { steps { sh \u0026#39;apt-get update \u0026amp;\u0026amp; apt-get install -y aspell-es \u0026#39; } } stage(\u0026#39;Test\u0026#39;) { steps { sh \u0026#39;\u0026#39;\u0026#39; export LC_ALL=C.UTF-8 OUTPUT=`cat doc/*.md | aspell list -d es -p ./.aspell.es.pws` if [ -n \u0026#34;$OUTPUT\u0026#34; ]; then echo $OUTPUT exit 1 fi \u0026#39;\u0026#39;\u0026#39; } } } post { always { mail to: \u0026#39;javierasping@gmail.com\u0026#39;, subject: \u0026#34;Status of pipeline: ${currentBuild.fullDisplayName}\u0026#34;, body: \u0026#34;${env.BUILD_URL} has result ${currentBuild.result}\u0026#34; } } } Una captura de pantalla donde se vea la configuraci√≥n del disparador del pipeline. Una captura de un correo electr√≥nico recibido sin ning√∫n error, y otro con alg√∫n error en al ejecuci√≥n del pipeline. ","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/taller1.png","permalink":"https://www.javiercd.es/posts/ci_cd/taller1_jenkins/taller1/","summary":"\u003ch1 id=\"taller-1-corrector-ortogr√°fico-de-documentos-markdown-test\"\u003eTaller 1: Corrector ortogr√°fico de documentos markdown (test)\u003c/h1\u003e\n\u003ch2 id=\"qu√©-tienes-que-entregar\"\u003e\u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/taller1.html#qu%C3%A9-tienes-que-entregar\" target=\"_blank\" rel=\"noopener\"\u003e¬øQu√© tienes que entregar?\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eLa URL del tu repositorio GitHub.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ehttps://github.com/javierasping/taller1_jenkins_ic-diccionario\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eEl contenido de la tu fichero¬†\u003ccode\u003eJenkinfile\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epipeline \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    agent \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        docker \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            image \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;debian\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            args \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;-u root:root\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    stages \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        stage\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Clone\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            steps \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                git branch:\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;master\u0026#39;\u003c/span\u003e, url:\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://github.com/javierasping/taller1_jenkins_ic-diccionario.git\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        stage\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Install\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            steps \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                sh \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;apt-get update \u0026amp;\u0026amp; apt-get install -y aspell-es \u0026#39;\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        stage\u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;Test\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            steps \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e                sh \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                export LC_ALL=C.UTF-8\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                OUTPUT=`cat doc/*.md | aspell list -d es -p ./.aspell.es.pws`\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                if [ -n \u0026#34;$OUTPUT\u0026#34; ]; then\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                    echo $OUTPUT\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                    exit 1\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                fi\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e                \u0026#39;\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    post \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        always \u003cspan style=\"color:#f92672\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            mail to: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;javierasping@gmail.com\u0026#39;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            subject: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Status of pipeline: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003ecurrentBuild.fullDisplayName\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e,\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e            body: \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003eenv.BUILD_URL\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e has result \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003ecurrentBuild.result\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eUna captura de pantalla donde se vea la configuraci√≥n del disparador del pipeline.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e\u003cimg src=\"/ci_cd/taller1_jenkins/img/Pasted_image_20240229084423.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Taller 1: Corrector ortogr√°fico de documentos markdown (test)"},{"categories":null,"contents":"En este ejercicio queremos desplegar una p√°gina HTML5 en el servicio¬†surge.sh, adem√°s queremos comprobar si el c√≥digo HTML5 es v√°lido. Estas dos operaciones: comprobar si el HTML5 es v√°lido (test) y el despliegue en surge.sh (deploy) lo vamos a hacer con Jenkins de forma autom√°tica (IC y DC). Recuerda que el repositorio es¬†https://github.com/josedom24/ic-html5.\nComo vimos en el ejemplo 2, para hacer el despliegue necesitamos guardar el token que hemos obtenido de surge para que nos autentifiquemos. veamos como trabajar con credenciales en Jenkins.\nCrear credenciales Podemos crear varios tipos de credenciales: usuario y contrase√±a, credenciales ssh,‚Ä¶ Nosotros vamos a crear un¬†Secret text¬†para guardar el token de surge.\ndebian@jenkins:~$ sudo apt install npm debian@jenkins:~$ sudo npm install -g surge debian@jenkins:~$ surge token Login (or create surge account) by entering email \u0026amp; password. email: javierasping@gmail.com password: pipeline { environment { TOKEN = credentials(\u0026#39;SURGE_TOKEN\u0026#39;) } agent { docker { image \u0026#39;josedom24/debian-npm\u0026#39; args \u0026#39;-u root:root\u0026#39; } } stages { stage(\u0026#39;Clone\u0026#39;) { steps { git branch:\u0026#39;master\u0026#39;,url:\u0026#39;https://github.com/javierasping/taller2_ic-html5.git\u0026#39; } } stage(\u0026#39;Install surge\u0026#39;) { steps { sh \u0026#39;npm install -g surge\u0026#39; } } stage(\u0026#39;Deploy\u0026#39;) { steps{ sh \u0026#39;surge ./_build/ josedom24.surge.sh --token $TOKEN\u0026#39; } } } } Instalamos y configuraramos Ngrok con nuestro token\ndebian@jenkins:~$ curl -s https://ngrok-agent.s3.amazonaws.com/ngrok.asc \\ | sudo tee /etc/apt/trusted.gpg.d/ngrok.asc \u0026gt;/dev/null \u0026amp;\u0026amp; echo \u0026#34;deb https://ngrok-agent.s3.amazonaws.com buster main\u0026#34; \\ | sudo tee /etc/apt/sources.list.d/ngrok.list \u0026amp;\u0026amp; sudo apt update \u0026amp;\u0026amp; sudo apt install ngrok debian@jenkins:~$ ngrok config add-authtoken 2d2CfEVHT Authtoken saved to configuration file: /home/debian/.config/ngrok/ngrok.yml Indicamos en jenkins que vamos a utilizar un WebHook :\nLanzo un ejemplo de HTML correcto y otro con errores :\nComprobamos que los cambios en el repositorio son recibidos en el WebHook :\nEn GitHub comprobamos que le esta mandando la petici√≥n al WebHook :\n","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/taller2.png","permalink":"https://www.javiercd.es/posts/ci_cd/taller2_jenkins/taller2/","summary":"\u003cp\u003eEn este ejercicio queremos desplegar una p√°gina HTML5 en el servicio¬†\u003cem\u003esurge.sh\u003c/em\u003e, adem√°s queremos comprobar si el c√≥digo HTML5 es v√°lido. Estas dos operaciones: comprobar si el HTML5 es v√°lido (test) y el despliegue en surge.sh (deploy) lo vamos a hacer con Jenkins de forma autom√°tica (IC y DC). Recuerda que el repositorio es¬†\u003ca href=\"https://github.com/josedom24/ic-html5\" target=\"_blank\" rel=\"noopener\"\u003ehttps://github.com/josedom24/ic-html5\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003eComo vimos en el ejemplo 2, para hacer el despliegue necesitamos guardar el token que hemos obtenido de surge para que nos autentifiquemos. veamos como trabajar con credenciales en Jenkins.\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Taller 2 Comprobaci√≥n de HTML5 v√°lido y despliegue en surge.sh (test y deploy)"},{"categories":null,"contents":"Taller 2: Escenarios multicontenedor en Docker Despliegue de Nextcloud Vamos a desplegar la aplicaci√≥n nextcloud con una base de datos (puedes elegir mariadb o PostgreSQL) utilizando la aplicaci√≥n docker-compose. Puedes coger c√≥mo modelo el fichero¬†docker-compose.yml¬†el que hemos estudiado para desplegar WordPress.\nInstala docker-compose en tu ordenador. Dentro de un directorio crea un fichero¬†docker-compose.yml¬†para realizar el despliegue de nextcloud con una base de datos. Recuerda las variables de entorno y la persistencia de informaci√≥n. javiercruces@docker:~/taller2$ cat docker-compose.yaml version: \u0026#39;2\u0026#39; volumes: nextcloud: db: services: db: image: mariadb:10.6 restart: always command: --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW volumes: - db:/var/lib/mysql environment: - MYSQL_ROOT_PASSWORD=root - MYSQL_PASSWORD=javiercruces - MYSQL_DATABASE=nextcloud - MYSQL_USER=nextcloud app: image: nextcloud restart: always ports: - 8081:80 links: - db volumes: - nextcloud:/var/www/html environment: - MYSQL_PASSWORD=javiercruces - MYSQL_DATABASE=nextcloud - MYSQL_USER=nextcloud - MYSQL_HOST=db Levanta el escenario con¬†docker-compose. javiercruces@docker:~/taller2$ docker compose up -d [+] Running 2/2 ‚úî Container taller2-db-1 Started 0.0s ‚úî Container taller2-app-1 Started 0.0s Muestra los contenedores con¬†docker-compose. javiercruces@docker:~/taller2$ docker compose ps NAME IMAGE COMMAND SERVICE CREATED STATUS PORTS taller2-app-1 nextcloud \u0026#34;/entrypoint.sh apache2-foreground\u0026#34; app 7 minutes ago Up 5 minutes 0.0.0.0:8081-\u0026gt;80/tcp, :::8081-\u0026gt;80/tcp taller2-db-1 mariadb:10.6 \u0026#34;docker-entrypoint.sh --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW\u0026#34; db 7 minutes ago Up 5 minutes 3306/tcp Accede a la aplicaci√≥n y comprueba que funciona. Comprueba el almacenamiento que has definido y que se ha creado una nueva red de tipo bridge. javiercruces@docker:~/taller2$ docker network ls NETWORK ID NAME DRIVER SCOPE 5dd43eadf03b bridge bridge local 40fad2a3552b host host local 9f5f2450d012 none null local a1f8faf5a100 taller1 bridge local fcf9b3b0fed4 taller2_default bridge local javiercruces@docker:~/taller2$ docker volume ls DRIVER VOLUME NAME local 0dd5f1f824800210c4ce522371cb31ef1075c779566ed986b8718a88eb4b50a9 local 5d742d485cd427d22f688488a3d28f562e6e8037ecf2e56f7fb81dc6db71e26b local 9eeb57dc83abfd57998498152b2a03527b8743ccf1eee5cba2e7ef891030e496 local 87622e5677a467c635c75f868ae123679269507fbe7f6a47b0804999a0845f01 local d9cb1b25e8892ef2f8b51b1352a00d44451616eb0f52db43cb8d42d391b9ab1b local db_vol local miweb local taller2_db local taller2_nextcloud Borra el escenario con¬†docker-compose. javiercruces@docker:~/taller2$ docker compose rm -sf [+] Stopping 2/2 ‚úî Container taller2-app-1 Stopped 3.6s ‚úî Container taller2-db-1 Stopped 6.1s Going to remove taller2-app-1, taller2-db-1 [+] Removing 2/0 ‚úî Container taller2-db-1 Removed 0.1s ‚úî Container taller2-app-1 Removed ","date":"March 14, 2024","hero":"/images/docker/taller2.png","permalink":"https://www.javiercd.es/posts/docker/taller2/taller2_docker/","summary":"\u003ch2 id=\"taller-2-escenarios-multicontenedor-en-docker\"\u003eTaller 2: Escenarios multicontenedor en Docker\u003c/h2\u003e\n\u003ch3 id=\"despliegue-de-nextcloud\"\u003eDespliegue de Nextcloud\u003c/h3\u003e\n\u003cp\u003eVamos a desplegar la aplicaci√≥n nextcloud con una base de datos (puedes elegir mariadb o PostgreSQL) utilizando la aplicaci√≥n docker-compose. Puedes coger c√≥mo modelo el fichero¬†\u003ccode\u003edocker-compose.yml\u003c/code\u003e¬†el que hemos estudiado para desplegar WordPress.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eInstala docker-compose en tu ordenador.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"2\"\u003e\n\u003cli\u003eDentro de un directorio crea un fichero¬†\u003ccode\u003edocker-compose.yml\u003c/code\u003e¬†para realizar el despliegue de nextcloud con una base de datos. Recuerda las variables de entorno y la persistencia de informaci√≥n.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~/taller2$ cat docker-compose.yaml \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eversion: \u003cspan style=\"color:#e6db74\"\u003e\u0026#39;2\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003evolumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  nextcloud:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  db:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eservices:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  db:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    image: mariadb:10.6\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    restart: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    command: --transaction-isolation\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eREAD-COMMITTED --log-bin\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ebinlog --binlog-format\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eROW\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - db:/var/lib/mysql\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_ROOT_PASSWORD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003eroot\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_PASSWORD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejaviercruces\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_DATABASE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_USER\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e  app:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    image: nextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    restart: always\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    ports:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - 8081:80\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    links:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - db\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    volumes:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - nextcloud:/var/www/html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    environment:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_PASSWORD\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003ejaviercruces\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_DATABASE\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_USER\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003enextcloud\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e      - MYSQL_HOST\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edb\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"3\"\u003e\n\u003cli\u003eLevanta el escenario con¬†\u003ccode\u003edocker-compose\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~/taller2$ docker compose up -d \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003e+\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e Running 2/2\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e ‚úî Container taller2-db-1   Started                                                                0.0s \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e ‚úî Container taller2-app-1  Started                                                                0.0s\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"4\"\u003e\n\u003cli\u003eMuestra los contenedores con¬†\u003ccode\u003edocker-compose\u003c/code\u003e.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ejaviercruces@docker:~/taller2$ docker compose ps\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eNAME            IMAGE          COMMAND                                                                                              SERVICE   CREATED         STATUS         PORTS\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etaller2-app-1   nextcloud      \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;/entrypoint.sh apache2-foreground\u0026#34;\u003c/span\u003e                                                                  app       \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e minutes ago   Up \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e minutes   0.0.0.0:8081-\u0026gt;80/tcp, :::8081-\u0026gt;80/tcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003etaller2-db-1    mariadb:10.6   \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;docker-entrypoint.sh --transaction-isolation=READ-COMMITTED --log-bin=binlog --binlog-format=ROW\u0026#34;\u003c/span\u003e   db        \u003cspan style=\"color:#ae81ff\"\u003e7\u003c/span\u003e minutes ago   Up \u003cspan style=\"color:#ae81ff\"\u003e5\u003c/span\u003e minutes   3306/tcp\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003col start=\"5\"\u003e\n\u003cli\u003eAccede a la aplicaci√≥n y comprueba que funciona.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/docker/taller2/img/Pasted_image_20240202091554.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Taller 2: Escenarios multicontenedor en Docker"},{"categories":null,"contents":"Taller 3: Creaci√≥n de im√°genes Docker Creaci√≥n de una imagen a partir de un Dockerfile\n1.Crea una p√°gina web est√°tica (por ejemplo busca una plantilla HTML5). O simplemente crea un index.html.\n2.Crea un fichero Dockerfile que permita crear una imagen con un servidor web sirviendo la p√°gina. Puedes usar una imagen base debian o ubuntu, o una imagen que tenga ya un servicio web, como hemos visto en el apartado Ejemplo 1: Construcci√≥n de im√°genes con una p√°gina est√°tica.\njaviercruces@docker:~/taller3$ cat Dockerfile # syntax=docker/dockerfile:1 FROM httpd:2.4 COPY ./public_html/ /usr/local/apache2/htdocs/ EXPOSE 80 3.Ejecuta el comando docker que crea la nueva imagen. La imagen se debe llamar /mi_servidor_web:v1.\njaviercruces@docker:~/taller3$ docker build -t javiersaping/mi_servidor_web:v1 . Sending build context to Docker daemon 3.584kB Step 1/3 : FROM httpd:2.4 ---\u0026gt; 92fa43a2ff60 Step 2/3 : COPY ./public_html/ /usr/local/apache2/htdocs/ ---\u0026gt; b03556dd59b6 Step 3/3 : EXPOSE 80 ---\u0026gt; Running in 1cc04e1deee4 Removing intermediate container 1cc04e1deee4 ---\u0026gt; 3078183767ef Successfully built 3078183767ef Successfully tagged javiersaping/mi_servidor_web:v1 javiercruces@docker:~/taller3$ docker run -d -p 8081:80 javiersaping/mi_servidor_web:v1 2a753adcd098c49b7b215b7c97267a09e09194303bee131150765222a4295dea 4.Con√©ctate a Docker Hub y sube la imagen que acabas de crear.\njaviercruces@docker:~/taller3$ docker login javiercruces@docker:~/taller3$ docker push javiersaping/mi_servidor_web:v1 The push refers to repository [docker.io/javiersaping/mi_servidor_web] c2a1a8df6153: Pushed daede99f9966: Mounted from library/httpd a7eff924c5ac: Mounted from library/httpd 24282ddb8cca: Mounted from library/httpd 5f70bf18a086: Mounted from library/httpd 8ba5f6d45106: Mounted from library/httpd 571ade696b26: Mounted from library/nextcloud v1: digest: sha256:85a8e341e3fd89b313a263a45c91ad846d673f198301e482c4f07352aef8bd42 size: 1779 5.Descarga la imagen en otro ordenador donde tengas docker instalado, y crea un contenedor a partir de ella. (Si no tienes otro ordenador con docker instalado, borra la imagen en tu ordenador y b√°jala de Docker Hub).\njaviercruces@docker:~/taller3$ docker image ls REPOSITORY TAG IMAGE ID CREATED SIZE javiersaping/mi_servidor_web v1 3078183767ef 7 minutes ago 167MB nextcloud latest 142b11cc42d8 3 weeks ago 1.21GB wordpress latest fe93c4b645b9 8 weeks ago 739MB mariadb latest 2b54778e06a3 2 months ago 404MB mariadb 10.6 10fbb70b8165 2 months ago 396MB mariadb 10.5 72610f6b03ac 2 months ago 393MB httpd 2.4 92fa43a2ff60 3 months ago 167MB php 7.4-apache 20a3732f422b 14 months ago 453MB javiercruces@docker:~/taller3$ docker image rm 3078183767ef Untagged: javiersaping/mi_servidor_web:v1 Untagged: javiersaping/mi_servidor_web@sha256:85a8e341e3fd89b313a263a45c91ad846d673f198301e482c4f07352aef8bd42 Deleted: sha256:3078183767efd71fffccce7fb4e6806afa46a4cff42c37ad505d376e0b842108 Deleted: sha256:b03556dd59b6f2ab935450b4d5eb09dedfc4ee86f4c11a9140d8e17f89d89a73 Deleted: sha256:5f245addf2a19a8f2d9314dc1283ab53d0f85ae6a6a73aa5d264f070f0d71e01 javiercruces@docker:~/taller3$ docker pull javiersaping/mi_servidor_web:v1 v1: Pulling from javiersaping/mi_servidor_web 2f44b7a888fa: Already exists 5abb3599da34: Already exists 4f4fb700ef54: Already exists fa608a886227: Already exists afe6bbf00437: Already exists fd0ef2a49677: Already exists 6d9a1035e41b: Pull complete Digest: sha256:85a8e341e3fd89b313a263a45c91ad846d673f198301e482c4f07352aef8bd42 Status: Downloaded newer image for javiersaping/mi_servidor_web:v1 docker.io/javiersaping/mi_servidor_web:v1 6.Vamos a hacer una modificaci√≥n de la p√°gina web: haz una modificaci√≥n al fichero index.html.\njaviercruces@docker:~/taller3/public_html$ echo \u0026#34;\u0026lt;h1\u0026gt;Taller3 FJCD V2\u0026lt;/h1\u0026gt;\u0026#34; \u0026gt; index.html 7.Vuelve a crear una nueva imagen, en esta caso pon ta etiqueta v2. S√∫bela a Docker Hub.\njaviercruces@docker:~/taller3$ docker build -t javiersaping/mi_servidor_web:v2 . Sending build context to Docker daemon 3.584kB Step 1/3 : FROM httpd:2.4 ---\u0026gt; 92fa43a2ff60 Step 2/3 : COPY ./public_html/ /usr/local/apache2/htdocs/ ---\u0026gt; 94e5c065b88a Step 3/3 : EXPOSE 80 ---\u0026gt; Running in 5849a7ba6b3b Removing intermediate container 5849a7ba6b3b ---\u0026gt; 2e68e7708285 Successfully built 2e68e7708285 Successfully tagged javiersaping/mi_servidor_web:v2 javiercruces@docker:~/taller3$ docker push javiersaping/mi_servidor_web:v2 The push refers to repository [docker.io/javiersaping/mi_servidor_web] 1f5b52d08ce0: Pushed daede99f9966: Layer already exists a7eff924c5ac: Layer already exists 24282ddb8cca: Layer already exists 5f70bf18a086: Layer already exists 8ba5f6d45106: Layer already exists 571ade696b26: Layer already exists v2: digest: sha256:a2af8396c3dfaa8d0312868161bff238c17b742cd46d57296ed304a9495b2a7a size: 1779 8.Por √∫ltimo, baja la nueva imagen en el ordenador donde est√° corriendo el contenedor. Para hacer la implantaci√≥n de la nueva versi√≥n debes borrar el contenedor y crear uno nuevo desde la nueva versi√≥n de la imagen.\njaviercruces@docker:~/taller3$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 2a753adcd098 javiersaping/mi_servidor_web:v1 \u0026#34;httpd-foreground\u0026#34; 3 minutes ago Up 3 minutes 0.0.0.0:8081-\u0026gt;80/tcp, :::8081-\u0026gt;80/tcp nervous_lewin 5a362b768a25 nextcloud:latest \u0026#34;/entrypoint.sh apac‚Ä¶\u0026#34; 2 weeks ago Up 2 weeks 0.0.0.0:8080-\u0026gt;80/tcp, :::8080-\u0026gt;80/tcp nextcloud dcc9f10a6cad mariadb:10.5 \u0026#34;docker-entrypoint.s‚Ä¶\u0026#34; 2 weeks ago Up 2 weeks 3306/tcp wp_db javiercruces@docker:~/taller3$ docker rm -f 2a753adcd098 2a753adcd098 javiercruces@docker:~/taller3$ docker run -d -p 8081:80 javiersaping/mi_servidor_web:v2 e632b46bb8cf8aac8019effdf5ac69cc20d8b9e76b17342638bc4858c63aef32 ","date":"March 14, 2024","hero":"/images/docker/taller3.png","permalink":"https://www.javiercd.es/posts/docker/taller3/taller3_docker/","summary":"\u003ch2 id=\"taller-3-creaci√≥n-de-im√°genes-docker\"\u003eTaller 3: Creaci√≥n de im√°genes Docker\u003c/h2\u003e\n\u003cp\u003eCreaci√≥n de una imagen a partir de un Dockerfile\u003c/p\u003e\n\u003cp\u003e1.Crea una p√°gina web est√°tica (por ejemplo busca una plantilla HTML5). O simplemente crea un index.html.\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e2.Crea un fichero Dockerfile que permita crear una imagen con un servidor web sirviendo la p√°gina. Puedes usar una imagen base debian o ubuntu, o una imagen que tenga ya un servicio web, como hemos visto en el apartado Ejemplo 1: Construcci√≥n de im√°genes con una p√°gina est√°tica.\u003c/p\u003e","tags":["Docker","Kubernetes","Contenedores"],"title":"Taller 3: Creaci√≥n de im√°genes Docker"},{"categories":null,"contents":"Vamos a trabajar con el repositorio de la aplicaci√≥n¬†django_tutorial. Esta aplicaci√≥n tiene definidas una serie de test, que podemos estudiar en el fichero¬†tests.py¬†del directorio¬†polls.\nCada test viene definido por una funci√≥n. En el fichero puedes leer los comentarios para saber que es lo que prueba cada test, o puedes ver el documento¬†Tests en la aplicaci√≥n tutorial Django.\nPara ejecutar los test ejecutamos:\npython3 manage.py test En ese momento se crea una base de datos temporal, donde se van a ir realizando las pruebas que est√°n definidas:\npython3 manage.py test Creating test database for alias \u0026#39;default\u0026#39;... System check identified no issues (0 silenced). .......... ---------------------------------------------------------------------- Ran 10 tests in 0.024s OK Destroying test database for alias \u0026#39;default\u0026#39;... Por ejemplo, hay dos tests definidos en la funci√≥n¬†test_no_questions¬†y en la funci√≥n¬†test_future_question¬†que comprueban que si no hay preguntas en la base de datos debe aparecer el mensaje¬†‚ÄúNo polls are available‚Äù. Si un programador modifica la aplicaci√≥n y en el fichero¬†polls/templates/polls/index.html¬†y cambia el mensaje:\n... \u0026lt;p\u0026gt;No hay encuestas disponibles.\u0026lt;/p\u0026gt; ... Al pasar los test, tendremos dos errores en los dos tests:\npython3 manage.py test Creating test database for alias \u0026#39;default\u0026#39;... System check identified no issues (0 silenced). ..F.F..... ====================================================================== FAIL: test_future_question (polls.tests.QuestionIndexViewTests) Questions with a pub_date in the future aren\u0026#39;t displayed on ---------------------------------------------------------------------- Traceback (most recent call last): File \u0026#34;/home/jose/github/django_tutorial/polls/tests.py\u0026#34;, line 143, in test_future_question self.assertContains(response, \u0026#34;No polls are available.\u0026#34;) File \u0026#34;/home/jose/virtualenv/django_tutorial/lib/python3.9/site-packages/django/test/testcases.py\u0026#34;, line 471, in assertContains self.assertTrue(real_count != 0, msg_prefix + \u0026#34;Couldn\u0026#39;t find %s in response\u0026#34; % text_repr) AssertionError: False is not true : Couldn\u0026#39;t find \u0026#39;No polls are available.\u0026#39; in response ====================================================================== FAIL: test_no_questions (polls.tests.QuestionIndexViewTests) If no questions exist, an appropriate message is displayed. ---------------------------------------------------------------------- Traceback (most recent call last): File \u0026#34;/home/jose/github/django_tutorial/polls/tests.py\u0026#34;, line 115, in test_no_questions self.assertContains(response, \u0026#34;No polls are available.\u0026#34;) File \u0026#34;/home/jose/virtualenv/django_tutorial/lib/python3.9/site-packages/django/test/testcases.py\u0026#34;, line 471, in assertContains self.assertTrue(real_count != 0, msg_prefix + \u0026#34;Couldn\u0026#39;t find %s in response\u0026#34; % text_repr) AssertionError: False is not true : Couldn\u0026#39;t find \u0026#39;No polls are available.\u0026#39; in response ---------------------------------------------------------------------- Ran 10 tests in 0.022s FAILED (failures=2) Recuerda que para hacer fallar un test, no hay que tocar el fichero¬†test.py. Los test no se pasan porque al modificar el c√≥digo de la aplicaci√≥n se dejan de cumplir las condiciones indicadas en los test.\nPipeline para realizar un test autom√°ticoPermalink Sabiendo como se ejecutan los test, es f√°cil hacer un pipeline que lo haga por nosotros de forma autom√°tica:\npipeline { agent { docker { image \u0026#39;python:3\u0026#39; args \u0026#39;-u root:root\u0026#39; } } stages { stage(\u0026#39;Clone\u0026#39;) { steps { git branch:\u0026#39;master\u0026#39;,url:\u0026#39;https://github.com/josedom24/django_tutorial.git\u0026#39; } } stage(\u0026#39;Install\u0026#39;) { steps { sh \u0026#39;pip install -r requirements.txt\u0026#39; } } stage(\u0026#39;Test\u0026#39;) { steps { sh \u0026#39;python3 manage.py test\u0026#39; } } } } Para poder instalar los paquetes con pip necesitamos ejecutar las instrucciones en el contenedor como root (args '-u root:root'). Clonamos el repositorio. Instalamos los requerimientos. Realizamos los test. Prueba a cambiar el c√≥digo para que un test falle y comprueba como el pipeline falla.\nUna captura de pantalla donde se vea la salida de un build que se ha ejecutado de manera correcta. Modifica el c√≥digo de la aplicaci√≥n para que se produzca un fallo en el c√≥digo.¬†Recuerda que para hacer fallar un test, no hay que tocar el fichero¬†test.py. Los test no se pasan porque al modificar el c√≥digo de la aplicaci√≥n se dejan de cumplir las condiciones indicadas en los test. Recuerda no elegir en el que hemos visto en este taller:mensaje ‚ÄúNo polls are available‚Äù. def was_published_recently(self): now = timezone.now() return now - datetime.timedelta(days=1) \u0026gt;= self.pub_date \u0026lt;= now was_published_recently.admin_order_field = \u0026#39;pub_date\u0026#39; was_published_recently.boolean = True was_published_recently.short_description = \u0026#39;Published recently?\u0026#39; Una captura de pantalla donde se vea la salida de un build que se ha ejecutado con errores de testeo. ","date":"March 14, 2024","hero":"/images/ci_cd/jenkins/taller3.png","permalink":"https://www.javiercd.es/posts/ci_cd/taller3_jenkins/taller3/","summary":"\u003cp\u003eVamos a trabajar con el repositorio de la aplicaci√≥n¬†\u003ca href=\"https://github.com/josedom24/django_tutorial\" target=\"_blank\" rel=\"noopener\"\u003edjango_tutorial\u003c/a\u003e. Esta aplicaci√≥n tiene definidas una serie de test, que podemos estudiar en el fichero¬†\u003ccode\u003etests.py\u003c/code\u003e¬†del directorio¬†\u003ccode\u003epolls\u003c/code\u003e.\u003c/p\u003e\n\u003cp\u003eCada test viene definido por una funci√≥n. En el fichero puedes leer los comentarios para saber que es lo que prueba cada test, o puedes ver el documento¬†\u003ca href=\"https://fp.josedomingo.org/iaw/5_ic/test_tutorial_django.html\" target=\"_blank\" rel=\"noopener\"\u003eTests en la aplicaci√≥n tutorial Django\u003c/a\u003e.\u003c/p\u003e\n\u003cp\u003ePara ejecutar los test ejecutamos:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003epython3 manage.py test\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eEn ese momento se crea una base de datos temporal, donde se van a ir realizando las pruebas que est√°n definidas:\u003c/p\u003e","tags":["Jenkis","CI/CD"],"title":"Taller 3: Integraci√≥n continua de aplicaci√≥n django (Test)"},{"categories":null,"contents":"Introducci√≥n Para la realizaci√≥n de la practica voy a elegir el kernel 6.4.4 que me he descargado desde el repositorio backports :\nPara descargarnos el c√≥digo fuente usaremos apt source :\nNos creara un directorio con el c√≥digo fuente\nSi listamos el contenido del directorio con el c√≥digo fuente veremos que la estructura es la misma que para compilar un paquete en C .\nPrimera compilaci√≥n Lo primero que vamos a hacer es usar el fichero .config que tiene cargado nuestro kernel , actualmente el mio tiene 10640 lineas.\nA continuaci√≥n vamos a lanzar la orden make oldconfig para que utilice el fichero actual del kernel que estemos usando .\nSi vemos tenemos configurados 2413 m√≥dulos de forma est√°tica y 3855 de forma din√°mica:\nVamos a pasarle el par√°metro localmodconfig , dejare el enter pulsado para que seleccione las distintos par√°metros por defecto .\nVemos que con este par√°metro hemos bajado significativamente el numero de m√≥dulos , ya que con el m√©todo usado en el paso anterior solo se utilizan los que tenemos actualmente cargados en el kernel :\nCompilaremos el kernel y lo probaremos , en mi caso arranca :\nSegunda compilaci√≥n Voy a quitar algunos componentes manualmente usando la herramienta make xconfig :\nDespu√©s de eliminar varios puntos del .config se me ha quedado con :\nAhora vamos a usar un m√©todo para compilar el cual nos har√° paquetes .deb y utilizaremos 15 n√∫cleos para ello :\nNos generara 4 paquetes .deb en el directorio superior :\nVamos a instal√°rnoslos , para ello haremos uso de un comod√≠n para instalar todos los .deb :\nPor ultimo vamos a asegurarnos de que el kernel se ha instalado :\nFirmar un kernel Como tengo el arranque seguro activado en el port√°til sera necesario que firme el kernel para poder arrancarlo .\nAs√≠ que para ello vamos a seguir los pasos que nos indica debian para realizarlo .\nSi deseas saber qu√© claves est√°n en uso en tu sistema, varias otras llamadas de mokutil te ayudar√°n, por ejemplo, sudo mokutil \u0026ndash;list-enrolled para mostrar la lista actual de claves MOK\nPara generarnos unas nuevas keys para firmar el kernel nos crearemos el siguiente directorio :\nVamos a generarnos la clave privada y certificado en formato DER\nAhora vamos a convertir el certificado DER a formato PEM:\nAhora para inscribir una nueva clave MOK, primero emito la solicitud utilizando el comando mokutil. Ejecuto el siguiente comando:\nDurante este proceso, se me solicitar√° ingresar un \u0026ldquo;one-time password\u0026rdquo; (contrase√±a de un solo uso) para confirmar la inscripci√≥n. Esta contrase√±a es crucial para validar y autorizar la operaci√≥n.\nLuego de emitir la solicitud y proporcionar la contrase√±a, la inscripci√≥n de la clave no se completa de inmediato. En lugar de eso, necesito reiniciar el sistema.\nCuando reiniciemos nos aparecer√° una pantalla azul , nos dirigiremos a la segunda opci√≥n enroll MOK:\nNos dir√° si queremos a√±adir las llaves :\nY nos pedir√° que pongamos la contrase√±a que hemos indicado de un solo uso :\nUna vez hecho esto reiniciamos el equipo :\nUna vez a√±adida la llave podemos comprobarlo con el siguiente comando :\nPara que DKMS (Dynamic Kernel Module Support) firme autom√°ticamente los m√≥dulos del kernel, es necesario indicarle con qu√© clave debe firmar el m√≥dulo. Esto se realiza a√±adiendo dos valores de configuraci√≥n al archivo \u0026ldquo;/etc/dkms/framework.conf\u0026rdquo;, ajustando las rutas seg√∫n sea necesario.\nAdem√°s a√±adiremos el siguiente script :\nEl script tendr√° el siguiente contenido :\nAhora vamos a definir las variables necesarios para proceder a firmar el kernel , la de versi√≥n la hace con uname -r en la documentaci√≥n de debian pero mis m√≥dulos tienen el prefijo 6.4.4 . Puedes comprobarlo en la ruta ls /lib/modules/ .\nAhora vamos a firmar el kernel :\nUna vez firmado el kernel podemos reiniciarlo y comprobar que arranca . A mi me ha tardado mas de lo normal al arrancarme pero en 2 min aproximadamente finalmente arranca .\n","date":"November 29, 2023","hero":"/images/sistemas/compilacion_de_un_kernel/compilacion_de_un_kernel.jpg","permalink":"https://www.javiercd.es/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/compilacion_de_un_kernel/","summary":"\u003ch2 id=\"introducci√≥n\"\u003eIntroducci√≥n\u003c/h2\u003e\n\u003cp\u003ePara la realizaci√≥n de la practica voy a elegir el kernel 6.4.4 que me he descargado desde el repositorio backports :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePara descargarnos el c√≥digo fuente usaremos apt source :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eNos creara un directorio con el c√≥digo fuente\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eSi listamos el contenido del directorio con el c√≥digo fuente veremos que la estructura es la misma que para compilar un paquete en C .\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/compilaciones_linux/compilacion_de_un_kernel/img/Aspose.Words.4794869c-382a-4c20-b046-83b787e9bd0a.004.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"primera-compilaci√≥n\"\u003ePrimera compilaci√≥n\u003c/h2\u003e\n\u003cp\u003eLo primero que vamos a hacer es usar el fichero .config que tiene cargado nuestro kernel , actualmente el mio tiene 10640 lineas.\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Compilaci√≥n de un kernel"},{"categories":null,"contents":"Introducci√≥n La compilaci√≥n de programas en el lenguaje de programaci√≥n C es un proceso fundamental en el desarrollo de software. Permite traducir el c√≥digo fuente escrito por los programadores en instrucciones comprensibles por la computadora. Uno de los desaf√≠os asociados con la compilaci√≥n es la gesti√≥n eficiente de los archivos y dependencias del proyecto, lo cual se vuelve a√∫n m√°s crucial cuando se trabaja en proyectos grandes y complejos.\nEste trabajo tiene como objetivo explorar uno de los mecanismos m√°s utilizados para compilar proyectos en C: el uso de un archivo Makefile. Un Makefile es un archivo de configuraci√≥n que describe c√≥mo se deben compilar los archivos fuente de un proyecto y c√≥mo se deben gestionar las dependencias entre ellos. Adem√°s, permite automatizar el proceso de compilaci√≥n y facilita la tarea de mantener y actualizar el c√≥digo.\nA lo largo de este trabajo, examinaremos en detalle el proceso de compilaci√≥n de un programa en C utilizando un Makefile. Comenzaremos por entender la estructura de un Makefile y c√≥mo se define el flujo de compilaci√≥n. Luego, exploraremos las ventajas de su uso, como la detecci√≥n autom√°tica de cambios en los archivos fuente y la recopilaci√≥n selectiva. Tambi√©n abordaremos las pr√°cticas recomendadas para crear Makefiles efectivos y f√°ciles de mantener.\nAdem√°s, analizaremos un ejemplo pr√°ctico de compilaci√≥n de un programa C, detallando los pasos necesarios para crear un Makefile y compilar el proyecto. Asimismo, discutiremos la instalaci√≥n del programa resultante en un directorio personal, evitando interferencias con el sistema de paquetes.\nEn √∫ltima instancia, aprenderemos c√≥mo desinstalar limpiamente el programa y comprenderemos la importancia de una gesti√≥n adecuada del software en sistemas Unix/Linux.\nA medida que avanzamos en este trabajo, ganaremos una comprensi√≥n m√°s profunda de la compilaci√≥n en C y la utilidad de un Makefile como una herramienta esencial en el desarrollo de software.\nCompilaci√≥n de un programa en C utilizando un Makefile Lo primero que vamos a instalar son fundamentales para la compilaci√≥n de paquetes en C en Debian.\nEl paquete build-essential proporciona las herramientas de compilaci√≥n necesarias, y dpkg-dev facilita la gesti√≥n de paquetes y la obtenci√≥n del c√≥digo fuente. Puedes instalar otros paquetes de desarrollo espec√≠ficos seg√∫n tus necesidades, pero estos dos son los m√°s esenciales para comenzar a compilar software en C en Debian.\nAhora vamos a descargar los ficheros fuente del paquete que queramos compilar en mi caso lo har√© de samba :\nUna vez hecho esto veremos en nuestro directorio que se han creado una serie de ficheros y directorios :\nsamba-4.17.12+dfsg: Este es el directorio que contiene el c√≥digo fuente de Samba, que se descarg√≥ desde los repositorios de Debian. Es la fuente que se utilizar√° para compilar e instalar Samba en tu sistema.\nsamba_4.17.12+dfsg-0+deb12u1.debian.tar.xz: Este archivo comprimido contiene las modificaciones espec√≠ficas de Debian para el paquete Samba. Puede incluir parches, scripts de construcci√≥n y otros archivos relacionados con la construcci√≥n del paquete.\nsamba_4.17.12+dfsg-0+deb12u1.dsc: Este archivo es el fichero de control de las fuentes Debian (Debian Source Control). Contiene informaci√≥n sobre la fuente y las versiones del paquete, as√≠ como enlaces a otros archivos relacionados con la fuente.\nsamba_4.17.12+dfsg.orig.tar.xz: Este archivo comprimido es la fuente original de Samba tal como se public√≥ en el sitio web oficial de Samba. Se utiliza como base para construir el paquete Debian.\nVamos a meternos en el directorio principal y podemos ver el c√≥digo fuente del paquete :\nLo primero que haremos sera instalar las dependencias del paquete que queremos compilar en mi caso samba :\nAhora vamos a lanzar el script configure . Este script se utiliza para configurar la compilaci√≥n de samba en funci√≥n de tus necesidades y las caracter√≠sticas del sistema :\nAhora vamos a compilar el c√≥digo fuente utilizando el comando make . Este se encargara de compilar el c√≥digo y creara las ejecutables y bibliotecas que a creado el script configure :\nEste tardara en funci√≥n del tama√±o del paquete en mi caso me ha tardado 8 min :\nUna vez compilado el c√≥digo para instalarlo vamos a usar make install :\nUna vez hecho esto tendremos nuestro paquete instalado en la ruta /usr/local :\nAhora para iniciar el servicio de samba ejecutaremos el fichero nmbd y nos aseguraremos de que este esta funcionando :\nVemos que la versi√≥n instalada es la que hemos compilado :\nDesinstalar el paquete compilado Para eliminar el paquete que hemos compilado :\nVemos que solo nos deja los ficheros de configuraci√≥n del servicio :\nEs posible que queden en nuestro sistema rastros de samba ya que el fichero makefile no esta configurado en este caso para eliminarlo completamente , ejecutamos whereis y eliminamos el contenido de las rutas :\nUna vez hecho esto habremos eliminado el rastro de samba :\n","date":"November 29, 2023","hero":"/images/sistemas/compilacion_de_un_programa_en_c/compilacion_de_un_programa_en_c.jpg","permalink":"https://www.javiercd.es/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/compilacion_de_un_programa_en_c_utilizando_un_makefile/","summary":"\u003ch2 id=\"introducci√≥n\"\u003eIntroducci√≥n\u003c/h2\u003e\n\u003cp\u003eLa compilaci√≥n de programas en el lenguaje de programaci√≥n C es un proceso fundamental en el desarrollo de software. Permite traducir el c√≥digo fuente escrito por los programadores en instrucciones comprensibles por la computadora. Uno de los desaf√≠os asociados con la compilaci√≥n es la gesti√≥n eficiente de los archivos y dependencias del proyecto, lo cual se vuelve a√∫n m√°s crucial cuando se trabaja en proyectos grandes y complejos.\u003c/p\u003e\n\u003cp\u003eEste trabajo tiene como objetivo explorar uno de los mecanismos m√°s utilizados para compilar proyectos en C: el uso de un archivo Makefile. Un Makefile es un archivo de configuraci√≥n que describe c√≥mo se deben compilar los archivos fuente de un proyecto y c√≥mo se deben gestionar las dependencias entre ellos. Adem√°s, permite automatizar el proceso de compilaci√≥n y facilita la tarea de mantener y actualizar el c√≥digo.\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Compilaci√≥n de un programa en C utilizando un Makefile"},{"categories":null,"contents":"Instalaci√≥n autom√°tica de una iso En la pagina oficial de debian nos descargaremos una imagen de debian , en mi caso he seleccionado una netinstall :\nUna vez descargada la imagen de debian, vamos a copiar su contenido en una carpeta para despu√©s hacer unas modificaciones. Para ello montaremos la iso como dispositivo loop :\nUna vez montada podremos ver su contenido :\nVamos a hacernos una copia de los ficheros que vamos a utilizar a un directorio nuestro para poder realizar cambios en los mismos , una vez hagamos esto podemos desmontar la imagen :\nUna vez copiados los ficheros vamos a movernos al directorio para crear el archivo preseed :\nDentro del mismo copiaremos el fichero de plantilla de bookworm que nos proporciona debian , lo puedes encontrar en su pagina oficial ‚Üí https://www.debian.org/releases/bookworm/example-preseed.txt . Yo metere este fichero dentro de la carpeta fjcd_auto .\nProcederemos a editar la plantilla y seleccionaremos las distintas opciones :\nUna vez configurado el fichero preseed.cfg , le damos permisos al directorio install.amd y descomprimimos el initrd.gz :\nA√±adimos las lineas de nuestro fichero preseed al initrd :\nVolvemos a comprimir el fichero initrd y le quitamos los permisos dados anteriormente al directorio padre :\nAhora a√±adiremos una entrada a este fichero para que al arrancar la iso tendr√≠amos una entrada que realizara autom√°ticamente la instalaci√≥n con nuestro fichero preseed.cfg:\nPor ultimo queda sacar los hash de los distintos archivos de la iso y a√±adirlos al fichero md5sum.txt:\nCon esto ya solo nos queda generar la iso :\nSi arrancamos con la iso veremos la entrada que hemos creado :\nResultado :\nServidor PXE Ahora vamos a preparar el servidor PXE para que hagamos una instalaci√≥n en red , para ello configurare SNAT en el mismo para que los clientes tengan internet :\nPara que el cambio sea permanente tengo instalado y configurado iptables-persistent , adem√°s recuerda activar el bit del forwarding\nAhora instalamos vamos a instalar dnsmasq :\nY configuraremos el servicio:\nReiniciamos el servicio para que se aplique la configuraci√≥n :\nAhora en el directorio root de nuestro tftp vamos a descargarnos el netboot de nuestra version de debian :\nAhora vamos a descomprimir el siguiente contenido :\nUna vez descomprimido el fichero crearemos enlaces simb√≥licos a los siguientes ficheros :\nAhora nos queda configurar el servidor web para pasar el fichero preseed.cfg , yo lo he puesto en el document root del virtual host por defecto :\nPor ultimo nos queda configurar la entrada del men√∫ de la iso que hemos descargado , indicamos que el archivo preseed.cfg esta en la siguiente url :\nAhora podemos arrancar la maquina por pxe:\nY si pulsamos sobre la entrada personalizada que acabamos de crear se instalara autom√°ticamente a partir del fichero preseed.cfg:\nResultado :\n","date":"November 29, 2023","hero":"/images/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/creacion_de_un_sistema_automatizado_de_instalacion.jpg","permalink":"https://www.javiercd.es/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/creacion_de_un_sistema_automatizado_de_instalacion/","summary":"\u003ch2 id=\"instalaci√≥n-autom√°tica-de-una-iso\"\u003eInstalaci√≥n autom√°tica de una iso\u003c/h2\u003e\n\u003cp\u003eEn la pagina oficial de debian nos descargaremos una imagen de debian , en mi caso he seleccionado una netinstall :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/img/Aspose.Words.87912b93-5caf-4cac-995f-066fba11b8b6.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eUna vez descargada la imagen de debian, vamos a copiar su contenido en una carpeta para despu√©s hacer unas modificaciones. Para ello montaremos la iso como dispositivo loop :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/img/Aspose.Words.87912b93-5caf-4cac-995f-066fba11b8b6.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eUna vez montada podremos ver su contenido :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/img/Aspose.Words.87912b93-5caf-4cac-995f-066fba11b8b6.003.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eVamos a hacernos una copia de los ficheros que vamos a utilizar  a un directorio nuestro para poder realizar cambios en los mismos , una vez hagamos esto podemos desmontar la imagen :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Creaci√≥n de un sistema automatizado de instalaci√≥n"},{"categories":null,"contents":"1.Comprueba los m√≥dulos cargados en tu equipo. 2.Cuenta el n√∫mero de m√≥dulos disponibles en el n√∫cleo que est√°s usando. 3.Conecta un l√°piz USB y observa la salida de la instrucci√≥n sudo dmesg. Vemos como el kernel detecta el dispositivo usb y se cargan los m√≥dulos necesarios para el mismo :\nVemos como el numero de m√≥dulos cargados han aumentado :\n4.Elimina el m√≥dulo correspondiente a alg√∫n dispotivo no esencial y comprueba qu√© ocurre. Vuelve a cargarlo. Si lo descargamos no podremos hacer uso de sistemas de ficheros exfat :\nPara volver a cargarlo :\n5.Selecciona un m√≥dulo que est√© en uso en tu equipo y configura el arranque para que no se cargue autom√°ticamente. Para ello lo a√±adimos a la ‚Äúlista negra ‚Äù , luego actualizamos el initframes :\nCuando reiniciemos este no estar√° cargado :\n6.Carga el m√≥dulo loop, obt√©n informaci√≥n de qu√© es y para qu√© sirve. Lista el contenido de /sys/modules/loop/parameters y configura el equipo para que se puedan cargar como m√°ximo 12 dispositivos loop la pr√≥xima vez que se arranque. Lo cargamos y comprobamos que este este cargado :\nVemos la informaci√≥n del mismo :\nListo el contenido del directorio /sys/module/loop/parameters . Esto mostrar√° los par√°metros disponibles para el m√≥dulo loop\nSi queremos limitar que haya 12 dispositivos loop , creamos el siguiente fichero y a√±adimos la siguiente configuraci√≥n :\nTendremos que actualizar el initframes sudo update-initramfs -u , para que se apliquen los cambios , adem√°s tendremos que reiniciar .\nUna vez reiniciamos , si vemos el contenido del par√°metro max_loops . Veremos que este se ha aplicado :\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos/","summary":"\u003ch2 id=\"1comprueba-los-m√≥dulos-cargados-en-tu-equipo\"\u003e1.Comprueba los m√≥dulos cargados en tu equipo.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2cuenta-el-n√∫mero-de-m√≥dulos-disponibles-en-el-n√∫cleo-que-est√°s-usando\"\u003e2.Cuenta el n√∫mero de m√≥dulos disponibles en el n√∫cleo que est√°s usando.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"3conecta-un-l√°piz-usb-y-observa-la-salida-de-la-instrucci√≥n-sudo-dmesg\"\u003e3.Conecta un l√°piz USB y observa la salida de la instrucci√≥n sudo dmesg.\u003c/h2\u003e\n\u003cp\u003eVemos como el kernel detecta el dispositivo usb y se cargan los m√≥dulos necesarios para el mismo :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.003.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eVemos como el numero de m√≥dulos cargados han aumentado :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/img/Aspose.Words.46ea1f3d-268a-4705-a64e-142fcc81092a.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4elimina-el-m√≥dulo-correspondiente-a-alg√∫n-dispotivo-no-esencial-y-comprueba-qu√©-ocurre-vuelve-a-cargarlo\"\u003e4.Elimina el m√≥dulo correspondiente a alg√∫n dispotivo no esencial y comprueba qu√© ocurre. Vuelve a cargarlo.\u003c/h2\u003e\n\u003cp\u003eSi lo descargamos no podremos hacer uso de sistemas de ficheros exfat :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Ejercicios de manejo de m√≥dulos"},{"categories":null,"contents":"1.Deshabilita apparmor en el arranque. 2.Deshabilita si es posible el Kernel Mode Setting (KSM) de la tarjeta gr√°fica. A√±adimos la siguiente linea en la configuraron del grub : Actualizamos el grub para que se apliquen los cambios :\n3.Cambia provisionalmente la swappiness para que la swap de tu equipo se active cuando se use m√°s de un 90% de la RAM. 4.Haz que el cambio de la swappiness sea permanente. Tienes que ejecutar sudo sysctl -p para que se aplique . 5.Muestra el valor del bit de forward para IPv6.\n6.Deshabilita completamente las Magic Sysrq en el arranque y vuelve a habilitarlas despu√©s de reiniciar. Para deshabilitaras :\nPara volver a habilitarlas cambia el valor de 0 a 1 y reinicia el equipo o ejecuta sudo sysctl -p:\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_modificacion_de_parametros_del_kernel/ejercicios_de_modificacion_de_parametros_del_kernel.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ejercicios_de_modificacion_de_parametros_del_kernel/","summary":"\u003ch2 id=\"1deshabilita-apparmor-en-el-arranque\"\u003e1.Deshabilita apparmor en el arranque.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2deshabilita-si-es-posible-el-kernel-mode-setting-ksm-de-la-tarjeta-gr√°fica-a√±adimos-la-siguiente-linea-en-la-configuraron-del-grub-\"\u003e2.Deshabilita si es posible el Kernel Mode Setting (KSM) de la tarjeta gr√°fica. A√±adimos la siguiente linea en la configuraron del grub :\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eActualizamos el grub para que se apliquen los cambios :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"3cambia-provisionalmente-la-swappiness-para-que-la-swap-de-tu-equipo-se-active-cuando-se-use-m√°s-de-un-90-de-la-ram\"\u003e3.Cambia provisionalmente la swappiness para que la swap de tu equipo se active cuando se use m√°s de un 90% de la RAM.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"4haz-que-el-cambio-de-la-swappiness-sea-permanente\"\u003e4.Haz que el cambio de la swappiness sea permanente.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/img/Aspose.Words.901d0dd4-f71a-4e77-902f-980456adb847.005.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Ejercicios de modificaci√≥n de par√°metros del kernel"},{"categories":null,"contents":"Trabajo con apt, aptitude, dpkg Ejercicio 1 Que acciones consigo al realizar apt update y apt upgrade. Explica detalladamente. El comando apt update es el primer paso fundamental en la actualizaci√≥n de paquetes. Realiza las siguientes acciones:\nRecupera Metadatos Remotos: apt update se comunica con los repositorios de software en l√≠nea y recupera los metadatos relacionados con los paquetes disponibles. Estos metadatos incluyen informaci√≥n sobre las √∫ltimas versiones de los paquetes, sus dependencias y otra informaci√≥n esencial. Actualiza la Copia Local de Metadatos: Luego, apt reconstruye y actualiza la copia local de estos metadatos. Esto permite que el sistema acceda r√°pidamente a informaci√≥n sobre los paquetes sin necesidad de descargarla repetidamente. Una vez que apt update ha actualizado la informaci√≥n sobre los paquetes disponibles, el siguiente paso es utilizar el comando apt upgrade. Este comando realiza una serie de pasos importantes:\nSelecci√≥n de Versiones Candidatas: apt selecciona las versiones candidatas de los paquetes disponibles. Estas versiones suelen ser las m√°s recientes, aunque hay excepciones. Resoluci√≥n de Dependencias: apt verifica y resuelve las dependencias entre los paquetes para garantizar que la actualizaci√≥n se realice de manera coherente y que todas las dependencias est√©n satisfechas. Descarga de Paquetes: Si se encuentran nuevas versiones de paquetes, apt descarga estas versiones desde los repositorios en l√≠nea a la cach√© local del sistema. Desempaquetado de Paquetes: apt desempaqueta los paquetes binarios recuperados. Ejecuci√≥n de √ìrdenes Preinst: Durante la actualizaci√≥n, se ejecutan los archivos de √≥rdenes preinstalaci√≥n, que pueden contener configuraciones y ajustes necesarios antes de la instalaci√≥n. Instalaci√≥n de Archivos Binarios: Los archivos binarios de las nuevas versiones de los paquetes se instalan en el sistema. Ejecuci√≥n de √ìrdenes Postinst: Finalmente, se ejecutan los archivos de √≥rdenes postinstalaci√≥n, que pueden realizar configuraciones adicionales despu√©s de la instalaci√≥n. Ejercicio 2 Lista la relaci√≥n de paquetes que pueden ser actualizados. ¬øQu√© informaci√≥n puedes sacar a tenor de lo mostrado en el listado? Puedes verificar la lista de paquetes que pueden ser actualizados utilizando el siguiente comando apt list \u0026ndash;upgradable. Este comando mostrar√° una lista de paquetes disponibles para la actualizaci√≥n y proporcionar√° informaci√≥n sobre cada uno de ellos. Aqu√≠ hay una breve descripci√≥n de la informaci√≥n que puedes obtener a partir de este listado:\nNombre del Paquete: El nombre del paquete es la primera columna de la lista. Te muestra el nombre del paquete que se puede actualizar, por ejemplo, nombre-del-paquete. Versi√≥n Actual: La versi√≥n actualmente instalada del paquete se encuentra a la derecha del nombre del paquete, en la segunda columna. Por ejemplo, 1.2.3. Versi√≥n Disponible: La tercera columna muestra la versi√≥n disponible m√°s reciente del paquete en los repositorios. Por ejemplo, 1.2.4. Estado de la Actualizaci√≥n: En la √∫ltima columna, se indica el estado de la actualizaci√≥n. Si hay un asterisco (*) junto al nombre del paquete, significa que ese paquete est√° marcado para ser actualizado. Descripci√≥n del Paquete: Adem√°s de esta informaci√≥n b√°sica, el listado tambi√©n proporciona una breve descripci√≥n del paquete, que te brinda una idea general de la funci√≥n del paquete y su prop√≥sito. Ejercicio 3 Indica la versi√≥n instalada, candidata as√≠ como la prioridad del paquete openssh-client Ejercicio 4 ¬øC√≥mo puedes sacar informaci√≥n de un paquete oficial instalado o que no este instalado?** Podemos usar el comando apt show para paquetes instalados como para no instalados . Tambi√©n podemos hacerlo con dpkg pero el paquete tiene que estar instalado ‚Üí dpkg -s :\nEjercicio 5 Saca toda la informaci√≥n que puedas del paquete openssh-client que tienes actualmente instalado en tu m√°quina Ejercicio 6 Saca toda la informaci√≥n que puedas del paquete openssh-client candidato a actualizar en tu m√°quina Ejercicio 7 Lista todo el contenido referente al paquete openssh-client actual de tu m√°quina. Utiliza para ello tanto dpkg como apt. Usando dpkg :\nUsando apt :\nEjercicio 8 Listar el contenido de un paquete sin la necesidad de instalarlo o descargarlo. Podemos usar apt file :\napt-file list [paquete] Ejercicio 9 Simula la instalaci√≥n del paquete openssh-client Ejercicio 10 ¬øQu√© comando te informa de los posible bugs que presente un determinado paquete? Ejercicio 11 Despu√©s de realizar un apt update \u0026amp;\u0026amp; apt upgrade. Si quisieras actualizar √∫nicamente los paquetes que tienen de cadena openssh. ¬øQu√© procedimiento seguir√≠as?. Realiza esta acci√≥n, con las estructuras repetitivas que te ofrece bash, as√≠ como con el comando xargs. Usando la estructura repetitiva de bash , usando un one line :\nUsando xargs :\nEjercicio 12 ¬øC√≥mo encontrar√≠as qu√© paquetes dependen de un paquete espec√≠fico? Con este vemos las dependencias del paquete directas :\nMientras que con este las dependencias indirectas :\nEjercicio 13 ¬øC√≥mo proceder√≠as para encontrar el paquete al que pertenece un determinado fichero? Podemos usar dpkg :\nPodemos usar apt-file :\nEjercicio 14 ¬øQue procedimientos emplear√≠as para liberar la cach√© en cuanto a descargas de paqueter√≠a? Para limpiar la cach√© de descargas :\nPara eliminarlos paquetes descargados que ya no est√°n en uso:\nO podemos hacer las dos cosas a la vez con apt clean :\nEjercicio 15 Realiza la instalaci√≥n del paquete keyboard-configuration pasando previamente los valores de los par√°metros de configuraci√≥n como variables de entorno. Nos aseguramos de que tenemos instalado el paquete :\nPara ello nos instalamos debconfs-utils:\nEn un fichero declaramos las variables que queramos configurar en el teclado :\nY se las proporcionamos al debconf:\nY comprobaremos que se han aplicado los cambios :\nEjercicio 16 Reconfigura el paquete locales de tu equipo, a√±adiendo una localizaci√≥n que no exista previamente. Comprueba a modificar las variables de entorno correspondientes para que la sesi√≥n del usuario utilice otra localizaci√≥n. Si queremos almacenar nuestra configuraci√≥n para cada usuario exportaremos nuestras variables y las pondremos en el bashrc :\nA continuaci√≥n ejecutaremos dpkg-reconfigure y observaremos que tendremos seleccionado el valor de la variable :\nEjercicio 17 Interrumpe la configuraci√≥n de un paquete y explica los pasos a dar para continuar la instalaci√≥n Una vez irrumpamos la instalaci√≥n de un paquete , para continuar la instalaci√≥n del mismo podemos usar el comando dpkg:\nPodemos usar el par√°metro -a para todos los paquetes o especificar el nombre para continuar su instalaci√≥n :\nEjercicio 18 Explica la instrucci√≥n que utilizar√≠as para hacer una actualizaci√≥n completa de todos los paquetes de tu sistema de manera completamente no interactiva Ejercicio 19 Bloquea la actualizaci√≥n de determinados paquetes Lo marcamos para evitar las actualizaciones y listamos los marcados para comprobar que no se actualizara :\nTrabajo con ficheros .deb Ejercicio 1 Descarga un paquete sin instalarlo, es decir, descarga el fichero .deb correspondiente. Indica diferentes formas de hacerlo. Podemos usar el comando apt :\nPodemos usar wget y descargarlo desde los repositorios de deb√≠an :\nEjercicio 2 ¬øC√≥mo puedes ver el contenido, que no extraerlo, de lo que se instalar√° en el sistema de un paquete deb? Ejercicio 3 Sobre el fichero .deb descargado, utiliza el comando ar. ar permite extraer el contenido de una paquete deb. Indica el procedimiento para visualizar con ar el contenido del paquete deb. Con el paquete que has descargado y utilizando el comando ar, descomprime el paquete. ¬øQu√© informaci√≥n dispones despu√©s de la extracci√≥n?. Indica la finalidad de lo extra√≠do. Para visualizar el contenido :\nPara descomprimir el directorio :\nHemos extra√≠do 3 archivos del paquete :\ncontrol.tar.xz : Contiene scripts que dpkg utiliza para instalar el paquete data.tar.xz : contiene los archivos del paquete debian-binary : indica la version del paquete Indica el procedimiento para descomprimir lo extra√≠do por ar del punto anterior. ¬øQu√© informaci√≥n contiene?\nPara descomprimir ficheros usaremos tar -xJf :\nNos encontraremos los siguientes directorios y ficheros :\ncontrol: Este archivo contiene metadatos sobre el paquete, como su nombre, versi√≥n, descripci√≥n, dependencias y otros detalles importantes. conffiles: Este archivo enumera los archivos de configuraci√≥n que son parte del paquete y que deben ser tratados de manera especial durante las actualizaciones para preservar las configuraciones personalizadas del usuario. preinst: Este es un script de preinstalaci√≥n que se ejecuta antes de que el paquete sea instalado en el sistema. Puede contener acciones de preconfiguraci√≥n necesarias. postinst: Este es un script de postinstalaci√≥n que se ejecuta despu√©s de que el paquete ha sido instalado en el sistema. Puede contener acciones de postconfiguraci√≥n necesarias. prerm: Este es un script de preremoci√≥n que se ejecuta antes de que el paquete sea desinstalado del sistema. Puede contener acciones de preeliminaci√≥n necesarias. postrm: Este es un script de postremoci√≥n que se ejecuta despu√©s de que el paquete ha sido desinstalado del sistema. Puede contener acciones de posteliminaci√≥n necesarias. md5sums: Este archivo contiene las sumas de control MD5 de los archivos que se instalan con el paquete. Se utiliza para verificar la integridad de los archivos durante la instalaci√≥n. El archivo data.tar.xz contiene los archivos y directorios que se instalar√°n en el sistema cuando se instale el paquete.\nTrabajo con repositorios Ejercicio 1 A√±ade a tu fichero sources.list los repositorios de bullseye-backports y sid. Ejercicio 2 Configura el sistema APT para que los paquetes de debian bullseye tengan mayor prioridad y por tanto sean los que se instalen por defecto. Ejercicio 3 Configura el sistema APT para que los paquetes de bullseye-backports tengan mayor prioridad que los de unstable. Ejercicio 4 ¬øC√≥mo a√±ades la posibilidad de descargar paqueter√≠a de la arquitectura i386 en tu sistema. ¬øQue comando has empleado?. Lista arquitecturas no nativas. ¬øC√≥mo proceder√≠as para desechar la posibilidad de descargar paqueter√≠a de la arquitectura i386? Para a√±adirla :\nPara eliminarla :\nEjercicio 5 Si quisieras descargar un paquete, ¬øc√≥mo puedes saber todas las versiones disponible de dicho paquete? Ejercicio 6 Indica el procedimiento para descargar un paquete del repositorio stable. Tal y como lo tenemos configurado los paquetes por prioridad se descargaran del repositorio estable . Pero podemos indic√°rselo :\nEjercicio 7 Indica el procedimiento para descargar un paquete del repositorio de buster-backports Tienes que tener el repositorio indicado en el sources.list luego puedes indicarlo con el par√°metro -t.\nEjercicio 8 Indica el procedimiento para descargar un paquete del repositorio de sid Igual que el ejercicio anterior solo que aqu√≠ indicamos sid ya que tenemos indicado el repositorio en el sources.list:\nEjercicio 9 Indica el procedimiento para descargar un paquete de arquitectura i386.** Indicamos el nombre del paquete seguido de :i386 Trabajo con directorios Que cometidos tienen\n/var/lib/apt/lists/: Este directorio contiene listas de paquetes disponibles en los repositorios configurados en mi sistema. Estas listas son archivos con extensi√≥n .list que contienen informaci√≥n sobre los paquetes disponibles, sus versiones y las fuentes de donde se pueden descargar. Cuando ejecuto apt update, actualizo estas listas .\n/var/lib/dpkg/available: Este archivo contiene informaci√≥n sobre los paquetes instalados y sus versiones. Es utilizado por mi sistema de gesti√≥n de paquetes dpkg para mantener un registro de los paquetes que tengo instalados y sus estados. Proporciona informaci√≥n sobre los paquetes disponibles y sus dependencias.\n/var/lib/dpkg/status: Este archivo tambi√©n contiene informaci√≥n sobre los paquetes instalados en mi sistema, pero proporciona una vista m√°s detallada que /var/lib/dpkg/available. Contiene informaci√≥n sobre el estado de los paquetes, como si est√°n instalados, desinstalados o si hay problemas con su configuraci√≥n.\n/var/cache/apt/archives/: Este directorio almacena los archivos de paquetes que descargo antes de que sean instalados en mi sistema. Cuando ejecuto comandos como apt-get install o apt-get upgrade, los paquetes se descargan primero en este directorio y luego se instalan. Mantener una copia de los paquetes descargados en este directorio puede ser √∫til si deseo reinstalar o desinstalar un paquete sin volver a descargarlo desde los repositorios, lo que ayuda a ahorrar tiempo y ancho de banda.\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ejercicios_gestion_de_paqueteria/","summary":"\u003ch2 id=\"trabajo-con-apt-aptitude-dpkg\"\u003eTrabajo con apt, aptitude, dpkg\u003c/h2\u003e\n\u003ch3 id=\"ejercicio-1-que-acciones-consigo-al-realizar-apt-update-y-apt-upgrade-explica-detalladamente\"\u003eEjercicio 1 Que acciones consigo al realizar apt update y apt upgrade. Explica detalladamente.\u003c/h3\u003e\n\u003cp\u003eEl comando apt update es el primer paso fundamental en la actualizaci√≥n de paquetes. Realiza las siguientes acciones:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eRecupera Metadatos Remotos:\u003c/strong\u003e apt update se comunica con los repositorios de software en l√≠nea y recupera los metadatos relacionados con los paquetes disponibles. Estos metadatos incluyen informaci√≥n sobre las √∫ltimas versiones de los paquetes, sus dependencias y otra informaci√≥n esencial.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eActualiza la Copia Local de Metadatos:\u003c/strong\u003e Luego, apt reconstruye y actualiza la copia local de estos metadatos. Esto permite que el sistema acceda r√°pidamente a informaci√≥n sobre los paquetes sin necesidad de descargarla repetidamente.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eUna vez que apt update ha actualizado la informaci√≥n sobre los paquetes disponibles, el siguiente paso es utilizar el comando apt upgrade. Este comando realiza una serie de pasos importantes:\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Ejercicios gesti√≥n de paqueter√≠a"},{"categories":null,"contents":"Indica los pasos a seguir para modificar la configuraci√≥n de red de DHCP a est√°tica Para configurar la interfaz ens1 con una direcci√≥n IP est√°tica (por ejemplo, 192.168.122.10), debes modificar el archivo /etc/sysconfig/network-scripts/ifcfg-ens1 :\nPara aplicar la configuraci√≥n reiniciamos el Network Manager :\nActualiza el sistema a las versiones m√°s recientes de los paquetes instalados Instala el repositorio adicional EPEL. Instala el paquete bash-completion. Instala el paquete que proporciona el programa dig, explicando los pasos que has dado para encontrarlo\nInstalamos el paquete :\nExplica qu√© comando utilizar√≠as para ver la informaci√≥n del paquete kernel instalado Instala el repositorio adicional \u0026ldquo;elrepo\u0026rdquo;. Importamos la clave publica del repositorio : Instalamos el repositorio :\nBusca las versiones disponibles para instalar del n√∫cleo Linux e instala la m√°s nueva Listamos los kernel mas recientes : Lo instalamos:\nMuestra el contenido del paquete del √∫ltimo n√∫cleo instalado ","date":"November 29, 2023","hero":"/images/sistemas/gestion_de_paquetes/gestion_de_paquetes.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/gestion_de_paquetes/gestion_de_paquetes/","summary":"\u003ch2 id=\"indica-los-pasos-a-seguir-para-modificar-la-configuraci√≥n-de-red-de-dhcp-a-est√°tica\"\u003eIndica los pasos a seguir para modificar la configuraci√≥n de red de DHCP a est√°tica\u003c/h2\u003e\n\u003cp\u003ePara configurar la interfaz ens1 con una direcci√≥n IP est√°tica (por ejemplo, 192.168.122.10), debes modificar el archivo /etc/sysconfig/network-scripts/ifcfg-ens1 :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePara aplicar la configuraci√≥n reiniciamos el Network Manager :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.002.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"actualiza-el-sistema-a-las-versiones-m√°s-recientes-de-los-paquetes-instalados\"\u003eActualiza el sistema a las versiones m√°s recientes de los paquetes instalados\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"instala-el-repositorio-adicional-epel\"\u003eInstala el repositorio adicional EPEL.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.004.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"instala-el-paquete-bash-completion\"\u003eInstala el paquete bash-completion.\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/comandos_linux/gestion_de_paquetes/img/Aspose.Words.0f9af8ba-710a-47db-ba6b-edb2ea8012f0.005.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eInstala el paquete que proporciona el programa dig, explicando los pasos que has dado para encontrarlo\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Gestion de paquetes"},{"categories":null,"contents":"Actualizar los paquetes Antes de migrar, aseg√∫rate de que tu sistema CentOS Stream 8 tenga todos los paquetes y actualizaciones m√°s recientes.\nElimina los paquetes innecesarios que nos aparezcan al utilizar el siguiente comando ya que son paquetes hu√©rfanos\nActualizaci√≥n a CentOS9 Instala los repositorios de CentOS 9 :\nAhora vamos a actualizar los paquetes a CentOS 9:\nCuando finalice la instalaci√≥n nos lo indicara , es posible que se eliminen algunos paquetes :\nActualizamos la base de datos de los paquetes locales :\nEliminamos los paquetes de la cache dnf :\nActualizamos los paquetes instalados :\nInstalamos los paquetes para la instalaci√≥n m√≠nima de un server core (sin entorno gr√°fico):\nAhora reiniciaremos el sistema y arrancamos con CentOS 9 :\nAl iniciar podemos comprobar que ya oficialmente tenemos CentOS 9 :\nLimpieza adicional Si quieres puedes eliminar el kernel antiguo :\nAdem√°s si no tienes subscripci√≥n puedes eliminar el m√°nager de suscripciones :\nGenerar entrada de rescate en el grub Moveremos los kerneles antiguos de rescate a una carpeta temporal como copia de seguridad :\nAhora vamos a regenerar las entradas del kernel , el comando no nos devolver√° nada as√≠ que podemos comprobarlo mirando en la partici√≥n boot :\nUna vez hecho podremos reiniciar y comprobar que tenemos la entrada de recuperaci√≥n de CentOS 9:\nBibliograf√≠a Gu√≠a para migrar de CentOS 8 stream a CenOS 9 stream\n","date":"November 29, 2023","hero":"/images/sistemas/paso_de_centos_stream_8_a_centos_stream_9/paso_de_centos_stream_8_a_centos_stream_9.png","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/paso_de_centos_stream_8_a_centos_stream_9/","summary":"\u003ch2 id=\"actualizar-los-paquetes\"\u003eActualizar los paquetes\u003c/h2\u003e\n\u003cp\u003eAntes de migrar, aseg√∫rate de que tu sistema CentOS Stream 8 tenga todos los paquetes y actualizaciones m√°s recientes.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eElimina los paquetes innecesarios que nos aparezcan al utilizar el siguiente comando ya que son paquetes hu√©rfanos\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"actualizaci√≥n-a-centos9\"\u003eActualizaci√≥n a CentOS9\u003c/h2\u003e\n\u003cp\u003eInstala los repositorios de CentOS 9 :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.003.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora vamos a actualizar los paquetes a CentOS 9:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/img/Aspose.Words.64b29d49-eb3e-49be-9751-9727b0deafb9.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCuando finalice la instalaci√≥n nos lo indicara , es posible que se eliminen algunos paquetes  :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Paso de CentOS stream 8 a CentOS stream 9"},{"categories":null,"contents":"Creaci√≥n del esquema LVM Nos instalamos el paquete LVM2\nAhora crearemos las particiones en el segundo disco :\nCreamos el grupo de vol√∫menes :\nCreamos los vol√∫menes ra√≠z y home :\nLa particiones tienes que tener el siguiente formato :\n-vdb2 etx4\n-FJCD-vg-home ext4\n-FJCD-vg-raiz ext4\nNos quedara darle formato a la efi :\nAs√≠ quedar√≠a nuestro esquema de particiones :\nCopiar el contenido de las particiones Ahora vamos a montar las particiones :\nAhora vamos a copiar las particiones , comenzamos con la boot :\nContinuamos con la efi :\nSeguimos con la raiz :\nFinalizamos con la home :\nInstalar el grub en el segundo disco Podemos aprovechar para cambiar el fichero /etc/fstab del segundo disco :\nTe dejo grabado en v√≠deo la prueba en directo de que el sistema arranca quit√°ndole el primer disco. https://youtu.be/zAlMqKIaLCQ\n","date":"November 29, 2023","hero":"/images/sistemas/ejercicios_de_manejo_de_modulos/ejercicios_de_manejo_de_modulos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/transformacion_instancia_cloud/transformacion_instancia_cloud/","summary":"\u003ch2 id=\"creaci√≥n-del-esquema-lvm\"\u003eCreaci√≥n del esquema LVM\u003c/h2\u003e\n\u003cp\u003eNos instalamos el paquete LVM2\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora crearemos las particiones en el segundo disco :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCreamos el grupo de vol√∫menes :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCreamos los vol√∫menes ra√≠z y home :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eLa particiones tienes que tener el siguiente formato :\u003c/p\u003e\n\u003cp\u003e-vdb2 etx4\u003c/p\u003e\n\u003cp\u003e-FJCD-vg-home ext4\u003c/p\u003e\n\u003cp\u003e-FJCD-vg-raiz ext4\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.005.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eNos quedara darle formato a la efi :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.006.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAs√≠ quedar√≠a nuestro esquema de particiones :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/migraciones/transformacion_instancia_cloud/img/Aspose.Words.1d1b77d6-c571-465c-8927-e55061548549.007.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"copiar-el-contenido-de-las-particiones\"\u003eCopiar el contenido de las particiones\u003c/h2\u003e\n\u003cp\u003eAhora vamos a montar las particiones :\u003c/p\u003e","tags":["Sistemas","ISO","ASO","Linux"],"title":"Transformaci√≥n instancia cloud"},{"categories":null,"contents":"Instalaci√≥n pila LAMP en Debian 12 Si est√°s utilizando Debian 12, sigue los pasos a continuaci√≥n para instalar un servidor web LAMP completo en Debian GNU/Linux 12 \u0026ldquo;Bookworm\u0026rdquo; (Stable). Ten en cuenta que Debian 12 incluye PHP 8.2 en sus repositorios, lo que puede ser diferente de versiones anteriores de Debian.\nInstalaci√≥n del servidor web Lo primero en un servidor LAMP es la \u0026ldquo;A\u0026rdquo; de Apache. Para instalar Apache, ejecuta los siguientes comandos:\njaviercruces@IWEB:~$ sudo apt install apache2 javiercruces@IWEB:~$ sudo systemctl enable apache2 \u0026amp;\u0026amp; sudo systemctl start apache2 Con estos comandos, habr√°s instalado y activado el servidor web Apache. Puedes verificarlo escribiendo la IP del servidor en tu navegador favorito y deber√≠a mostrarte la p√°gina de inicio de Apache por defecto.\nInstalaci√≥n de PHP Por lo general, necesitar√°s instalar algunos paquetes espec√≠ficos para PHP, llamados m√≥dulos en funci√≥n de la base de datos que utilices. Puedes instalarlos con el siguiente comando:\njaviercruces@IWEB:~$ sudo apt install php8.2 libapache2-mod-php8.2 php8.2-mysql Si instalas CMS como WordPress, Moodle o Prestashop en tu servidor, es posible que te pidan paquetes adicionales para su correcto funcionamiento. Estas aplicaciones suelen indicar claramente qu√© paquetes necesitas instalar.\nPara que Apache aplique los cambios y active PHP, reinicia el servicio con el siguiente comando:\njaviercruces@IWEB:~$ sudo systemctl restart apache2 Instalaci√≥n y configuraci√≥n de MariaDB Puedes usar indistintamente MariaDB o Mysql , en mi caso usare MariaDB :\njaviercruces@IWEB:~$ sudo apt install mariadb-server javiercruces@IWEB:~$ sudo systemctl enable mysql \u0026amp;\u0026amp; sudo systemctl start mysql Durante la instalaci√≥n, se te pedir√° establecer una contrase√±a para el usuario root de MySQL. Una vez que haya finalizado la instalaci√≥n, ejecuta el siguiente comando para asegurar tu instalaci√≥n de MariaDB:\njaviercruces@IWEB:~$ sudo mysql_secure_installation Sigue las instrucciones para asegurar tu instalaci√≥n de MariaDB, como configurar la contrase√±a del usuario root y eliminar usuarios an√≥nimos y bases de datos de prueba.\nDespu√©s de completar estos pasos, habr√°s configurado MariaDB y podr√°s conectarte a trav√©s de la terminal:\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 32 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [(none)]\u0026gt; Con esto ya tendr√≠as instalada la pila LAMP en debian 12\n","date":"October 28, 2023","hero":"/images/iweb/lamp/portada_lamp.png","permalink":"https://www.javiercd.es/posts/iaw/lamp/lamp/","summary":"\u003ch1 id=\"instalaci√≥n-pila-lamp-en-debian-12\"\u003eInstalaci√≥n pila LAMP en Debian 12\u003c/h1\u003e\n\u003cp\u003eSi est√°s utilizando Debian 12, sigue los pasos a continuaci√≥n para instalar un servidor web LAMP completo en Debian GNU/Linux 12 \u0026ldquo;Bookworm\u0026rdquo; (Stable). Ten en cuenta que Debian 12 incluye PHP 8.2 en sus repositorios, lo que puede ser diferente de versiones anteriores de Debian.\u003c/p\u003e\n\u003ch2 id=\"instalaci√≥n-del-servidor-web\"\u003eInstalaci√≥n del servidor web\u003c/h2\u003e\n\u003cp\u003eLo primero en un servidor LAMP es la \u0026ldquo;A\u0026rdquo; de Apache. Para instalar Apache, ejecuta los siguientes comandos:\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian","LAMP"],"title":"Instalaci√≥n pila LAMP en debian 12"},{"categories":null,"contents":"Instalaci√≥n pila LEMP en debian 12 con PHP-8 En esta gu√≠a, te explicare los pasos necesarios para instalar una pila LEMP (Linux, Nginx, MariaDB y PHP) en un servidor con Debian 12. La configuraci√≥n incluir√° PHP 8.2 como versi√≥n principal. La pila LEMP es esencial para alojar sitios web y aplicaciones web basadas en PHP, como WordPress u otras aplicaciones din√°micas. Sigue los pasos detallados a continuaci√≥n para configurar tu servidor LEMP con PHP 8.2.\nRequisitos previos Antes de comenzar, aseg√∫rate de que cumples con los siguientes requisitos:\nUn servidor Linux. Un usuario no root con privilegios sudo. Un nombre de dominio completo que apunte al servidor. Primero, actualiza y actualiza los paquetes del sistema:\njaviercruces@IWEB:~$ sudo apt update \u0026amp;\u0026amp; sudo apt upgrade Adem√°s, aseg√∫rate de que los siguientes paquetes est√©n instalados en tu sistema , ya que los utilizaremos mas adelante :\njaviercruces@IWEB:~$ sudo apt install wget nano unzip tar -y Instalaci√≥n PHP Debian 12 incluye PHP 8.2 por defecto. Puedes instalarlo ejecutando el siguiente comando:\njaviercruces@IWEB:~$ sudo apt install php-fpm php-cli php-mysql php-mbstring php-xml php-gd Hemos instalado las extensiones MySQL, CLI, GD, Mbstring y XML de PHP. Puedes instalar cualquier extensi√≥n adicional seg√∫n tus necesidades. Para verificar la instalaci√≥n de PHP, puedes ejecutar:\njaviercruces@IWEB:~$ php --version PHP 8.2.7 (cli) (built: Jun 9 2023 19:37:27) (NTS) Copyright (c) The PHP Group Zend Engine v4.2.7, Copyright (c) Zend Technologies with Zend OPcache v8.2.7, Copyright (c), by Zend Technologies javiercruces@IWEB:~$ Instalaci√≥n MariaDB Puedes usar indistintamente MariaDB o Mysql , en mi caso usare MariaDB :\njaviercruces@IWEB:~$ sudo apt install mariadb-server javiercruces@IWEB:~$ sudo systemctl enable mysql \u0026amp;\u0026amp; sudo systemctl start mysql Durante la instalaci√≥n, se te pedir√° establecer una contrase√±a para el usuario root de MySQL. Una vez que haya finalizado la instalaci√≥n, ejecuta el siguiente comando para asegurar tu instalaci√≥n de MariaDB:\njaviercruces@IWEB:~$ sudo mysql_secure_installation Sigue las instrucciones para asegurar tu instalaci√≥n de MariaDB, como configurar la contrase√±a del usuario root y eliminar usuarios an√≥nimos y bases de datos de prueba.\nDespu√©s de completar estos pasos, habr√°s configurado MariaDB y podr√°s conectarte a trav√©s de la terminal .\nSi te has saltado lanzar el script de la instalaci√≥n segura , el usuario root de la base de datos no tiene contrase√±a asi que pulsa espacio para iniciar sesi√≥n una vez lanzado el comando .\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 32 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. MariaDB [(none)]\u0026gt; Instalar Nginx Primero, asegur√©monos de que Nginx est√© instalado en tu servidor:\njaviercruces@IWEB:~$ sudo apt install nginx Una vez que Nginx est√© instalado, procederemos a configurar un socket TCP para trabajar con PHP-FPM.\nAbre el archivo de configuraci√≥n de PHP-FPM para realizar la configuraci√≥n necesaria:\njaviercruces@IWEB:~$ sudo nano /etc/php/8.2/fpm/pool.d/www.conf Dentro del archivo, busca la secci√≥n que define la direcci√≥n en la que PHP-FPM acepta solicitudes FastCGI.\nComenta la l√≠nea que comienza con listen y reempl√°zala por la siguiente l√≠nea para configurar un socket TCP en la direcci√≥n 127.0.0.1 y el puerto 9000:\n; The address on which to accept FastCGI requests. ; Valid syntaxes are: ; \u0026#39;ip.add.re.ss:port\u0026#39; - to listen on a TCP socket to a specific IPv4 address on ; a specific port; ; \u0026#39;[ip:6:addr:ess]:port\u0026#39; - to listen on a TCP socket to a specific IPv6 address on ; a specific port; ; \u0026#39;port\u0026#39; - to listen on a TCP socket to all addresses ; (IPv6 and IPv4-mapped) on a specific port; ; \u0026#39;/path/to/unix/socket\u0026#39; - to listen on a Unix socket. ; Note: This value is mandatory. ;listen = /run/php/php8.2-fpm.sock --\u0026gt; Comenta esta linea listen = 127.0.0.1:9000 Guarda los cambios y cierra el archivo.\nAhora vamos a editar la configuraci√≥n del sitio virtual por defecto para hacerlo funcionar con fpm .\nPara lograrlo, vamos a modificar el contenido dentro de la secci√≥n location en la configuraci√≥n del servidor. Aqu√≠ te proporciono un ejemplo de archivo de configuraci√≥n que puedes utilizar:\nserver { listen 80 default_server; listen [::]:80 default_server; root /var/www/html; index index.html index.php index.htm index.nginx-debian.html ; server_name _; location / { try_files $uri $uri/ =404; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; #fastcgi_pass unix:/var/run/php/php8.2-fpm.sock; # fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } Ahora vamos a reiniciar los servicios tanto de php como de Nginx para asegurar de que sea aplicado la configuraci√≥n , pero primero vamos a comprobar si tienes errores de sintaxis en ambos ficheros .\nPara comprobar errores de sintaxis en Nginx :\njaviercruces@IWEB:~$ sudo nginx -t nginx: the configuration file /etc/nginx/nginx.conf syntax is ok nginx: configuration file /etc/nginx/nginx.conf test is successful Si la salida es correcta continua comprobando si has cometido errores de sintaxis en la configuraci√≥n de PHP-FPM :\njaviercruces@IWEB:~$ sudo php-fpm8.2 -t [02-Nov-2023 17:33:02] NOTICE: configuration file /etc/php/8.2/fpm/php-fpm.conf test is successful Una vez las dos salidas de estos comandos no contienen errores , vamos a reiniciar ambos servicios para que se aplique la configuraci√≥n :\njaviercruces@IWEB:/etc/nginx$ sudo systemctl restart php8.2-fpm nginx.service Comprobaci√≥n de funcionamiento Para asegurarnos de que el servidor est√° funcionando correctamente con PHP-FPM, vamos a crear un archivo llamado info.php que mostrar√° informaci√≥n sobre la configuraci√≥n de PHP en el servidor. A continuaci√≥n, te mostrar√© c√≥mo crear el archivo:\njaviercruces@IWEB:~$ sudo nano /var/www/html/info.php Dentro del archivo info.php, agrega el siguiente contenido:\n\u0026lt;?php phpinfo(); ?\u0026gt; Guarda y cierra el archivo\nEste archivo PHP mostrar√° informaci√≥n detallada sobre la configuraci√≥n de PHP en tu servidor. Puedes acceder a √©l en tu navegador visitando http://tudominio.com/info.php (reemplaza tudominio.com con tu nombre de dominio real) o tambi√©n puedes acceder al mismo poniendo en el navegador la IP de tu maquina.\nUna vez hecho esto , ya tienes instalado la pila LEMP para que la utilices en tus CMS.\n","date":"October 28, 2023","hero":"/images/iweb/lamp/portada_lemp.png","permalink":"https://www.javiercd.es/posts/iaw/lemp/lemp/","summary":"\u003ch1 id=\"instalaci√≥n-pila-lemp-en-debian-12-con-php-8\"\u003eInstalaci√≥n pila LEMP en debian 12 con PHP-8\u003c/h1\u003e\n\u003cp\u003eEn esta gu√≠a, te explicare los pasos necesarios para instalar una pila LEMP (Linux, Nginx, MariaDB y PHP) en un servidor con Debian 12. La configuraci√≥n incluir√° PHP 8.2 como versi√≥n principal. La pila LEMP es esencial para alojar sitios web y aplicaciones web basadas en PHP, como WordPress u otras aplicaciones din√°micas. Sigue los pasos detallados a continuaci√≥n para configurar tu servidor LEMP con PHP 8.2.\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian","LEMP"],"title":"Instalaci√≥n pila LEMP en debian 12 con PHP-8"},{"categories":null,"contents":"Instalaci√≥n WordPress en Debian 12 con pila LAMP PHP-8 WordPress es un sistema de gesti√≥n de contenidos (CMS, por sus siglas en ingl√©s) de c√≥digo abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y dise√±adores.\nPreparaci√≥n Antes de empezar con la instalaci√≥n de WordPress vamos a dejar claro en una lista cual es el ecosistema de nuestro servidor para que todo funcione correctamente:\nServidor LAMP completo: Apache + MySQL -o MariaDB- y PHP 8.x. Configurado un VirtualHost para nuestro dominio. Creaci√≥n de base de datos con usuario. Si no tienes instalado la pila LAMP sigue puedes hacerlo en este enlace.\nCreaci√≥n del VirtualHost Copiamos el archivo de configuraci√≥n predeterminado de Apache y lo renombramos a wordpress.conf\njaviercruces@IWEB:/etc/apache2/sites-available$ sudo cp 000-default.conf wordpress.conf Configuramos el sitio virtual , recuerda cambiar el ServerName y DocumentRoot\n\u0026lt;VirtualHost *:80\u0026gt; # The ServerName directive sets the request scheme, hostname and port that # the server uses to identify itself. This is used when creating # redirection URLs. In the context of virtual hosts, the ServerName # specifies what hostname must appear in the request\u0026#39;s Host: header to # match this virtual host. For the default virtual host (this file) this # value is not decisive as it is used as a last resort host regardless. # However, you must set it for any further virtual host explicitly. ServerName wordpress.fjcd.es ServerAdmin webmaster@localhost DocumentRoot /var/www/wordpress # Available loglevels: trace8, ..., trace1, debug, info, notice, warn, # error, crit, alert, emerg. # It is also possible to configure the loglevel for particular # modules, e.g. #LogLevel info ssl:warn ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined # For most configuration files from conf-available/, which are # enabled or disabled at a global level, it is possible to # include a line for only one particular virtual host. For example the # following line enables the CGI configuration for this host only # after it has been globally disabled with \u0026#34;a2disconf\u0026#34;. #Include conf-available/serve-cgi-bin.conf \u0026lt;/VirtualHost\u0026gt; Habilitamos el sitio virtual wordpress.conf\njaviercruces@IWEB:/etc/apache2/sites-available$ sudo a2ensite wordpress.conf Enabling site wordpress. To activate the new configuration, you need to run: systemctl reload apache2 Recargamos Apache para aplicar la nueva configuraci√≥n\njaviercruces@IWEB:/etc/apache2/sites-available$ sudo systemctl reload apache2 Para acceder a este VirtualHost , en la maquina donde vayas a acceder al wordpress , al no tener servidor dns recuerda poner en el fichero host la ip de tu servidor con el ServerName :\njaviercruces@HPOMEN15:~$ cat /etc/hosts #A√±ade la IP de tu servidor y el ServerName correspondiente (wordpress.fjcd.es) #Ponlo al final del fichero y no modifiques las lineas existentes en tu fichero 192.168.125.27 wordpress.fjcd.es Creaci√≥n de la base de datos con un usuario. Te recomiendo que apuntes los datos introducidos a continuaci√≥n ya que los necesitaras mas adelante . Nos conectamos a la base de datos :\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 31 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. #Creamos una base de datos : MariaDB [(none)]\u0026gt; CREATE DATABASE fjcd_wordpress; Query OK, 1 row affected (0,001 sec) #Nos creamos el usuario para nuestra base de datos MariaDB [(none)]\u0026gt; CREATE USER \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;tu_contrase√±a\u0026#39;; Query OK, 0 rows affected (0,013 sec) #Le damos permisos sobre la base de datos que hemos creado: MariaDB [(none)]\u0026gt; GRANT ALL PRIVILEGES ON fjcd_wordpress.* TO \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39;; Query OK, 0 rows affected (0,010 sec) #Actualizamos los permisos: MariaDB [(none)]\u0026gt; FLUSH PRIVILEGES; Query OK, 0 rows affected (0,000 sec) #Nos salimos de la CLI de mysql MariaDB [(none)]\u0026gt; EXIT; Bye Instalaci√≥n de WordPress Lo primero que haremos ser√°¬†descargarnos WordPress, podemos hacerlo usando wget o si lo tenemos descargado en nuestro anfitri√≥n pasarlo haciendo uso de SCP o FTP .\njaviercruces@IWEB:~$ wget https://wordpress.org/latest.tar.gz --2023-10-27 12:33:17-- https://wordpress.org/latest.tar.gz Resolviendo wordpress.org (wordpress.org)... 198.143.164.252 Conectando con wordpress.org (wordpress.org)[198.143.164.252]:443... conectado. Petici√≥n HTTP enviada, esperando respuesta... 200 OK Longitud: 23465047 (22M) [application/octet-stream] Grabando a: ¬´latest.tar.gz¬ª latest.tar.gz 100%[=====================================\u0026gt;] 22,38M 14,8MB/s en 1,5s 2023-10-27 12:33:19 (14,8 MB/s) - ¬´latest.tar.gz¬ª guardado [23465047/23465047] Y¬†descomprimiremos el fichero¬†y copiaremos los ficheros dentro del¬†DocumentRoot¬†de nuestro¬†VirtualHost:\njaviercruces@IWEB:~$ sudo mkdir /var/www/wordpress/ javiercruces@IWEB:~$ sudo tar -zxf latest.tar.gz -C /var/www/ Entramos a la ruta del¬†WordPress¬†para realizar poner correctamente el esquema de permisos :\njaviercruces@IWEB:~$ cd /var/www/ Cambiamos usuario y grupos:\njaviercruces@IWEB:/var/www$ sudo chown -R www-data:www-data wordpress/ Y ponemos los permisos¬†correctos a WordPress:\nfind . -type d -exec chmod 755 {} \\; find . -type f -exec chmod 644 {} \\; Una vez hemos configurado todo esto, ahora ya podemos acceder con nuestro navegador a nuestro dominio para iniciar la instalaci√≥n de¬†WordPress.\nInstalaci√≥n Web Accedemos a la url que hemos puesto en el ServerName de nuestro sitio virtual y posteriormente hemos configurado en el fichero hosts .\nLo primero sera seleccionar el idioma :\nA continuaci√≥n nos dar√° una breve explicaci√≥n de que es el CMS WordPress :\nAhora deber√°s de introducir los datos referente a los usuarios y el nombre de la base de datos que has creado con anterioridad\nUna vez introducidos los datos correctos continuaremos con la instalaci√≥n :\nAhora deber√°s de introducir los datos para tu wordpress , como el nombre del sitio asi como la creaci√≥n de un usuario administrador para que posteriormente puedas acceder a wp-admin:\nListo !! Ya has instalado wordpress\nAhora para acceder al panel de administraci√≥n de wordpress deber√°s de introducir la siguiente url en tu navegador e inicia sesi√≥n con el usuario que has creado:\nListo !! Asi se ve el panel de administraci√≥n de wordpress:\n","date":"October 28, 2023","hero":"/images/iweb/wordpress/wordpress_lamp.png","permalink":"https://www.javiercd.es/posts/iaw/wordpress/instalacion_wordpress/","summary":"\u003ch1 id=\"instalaci√≥n-wordpress-en-debian-12-con-pila-lamp-php-8\"\u003eInstalaci√≥n WordPress en Debian 12 con pila LAMP PHP-8\u003c/h1\u003e\n\u003cp\u003eWordPress es un sistema de gesti√≥n de contenidos (CMS, por sus siglas en ingl√©s) de c√≥digo abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y dise√±adores.\u003c/p\u003e\n\u003ch2 id=\"preparaci√≥n\"\u003ePreparaci√≥n\u003c/h2\u003e\n\u003cp\u003eAntes de empezar con la instalaci√≥n de WordPress vamos a dejar claro en una lista cual es el ecosistema de nuestro servidor para que todo funcione correctamente:\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian"],"title":"Instalaci√≥n WordPress en Debian 12 con pila LAMP PHP-8"},{"categories":null,"contents":"Instalaci√≥n WordPress en Debian 12 con pila LEMP PHP-8 WordPress es un sistema de gesti√≥n de contenidos (CMS, por sus siglas en ingl√©s) de c√≥digo abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y dise√±adores.\nRequisitos previos Servidor con Linux: Debes disponer de un servidor que ejecute Linux , la gu√≠a esta pensada para Debian 12 . Usuario con permisos de superusuario: Debes tener acceso a un usuario con privilegios sudo en el servidor para poder llevar a cabo las tareas de instalaci√≥n y configuraci√≥n. Nombre de Dominio Completo (FQDN): Si deseas acceder a tu sitio WordPress a trav√©s de un dominio personalizado, aseg√∫rate de tener configurado y apuntando un nombre de dominio completo (FQDN) al servidor. Acceso a Internet: Necesitas acceso a Internet para descargar paquetes y realizar actualizaciones durante el proceso de instalaci√≥n. Aseg√∫rate de cumplir con todos estos requisitos antes de comenzar con la instalaci√≥n de WordPress en tu servidor .\nSi no tienes instalado la pila LEMP sigue puedes hacerlo en este enlace.\nCreaci√≥n de un VirtualHost en Nginx La creaci√≥n de un VirtualHost en Nginx te permite configurar m√∫ltiples sitios web en un √∫nico servidor. Sigue estos pasos para crear un VirtualHost en Nginx.\nCopia el archivo de configuraci√≥n por defecto de Nginx para usarlo como ejemplo y n√≥mbralo como quieras. En este ejemplo, lo nombraremos \u0026ldquo;wordpress\u0026rdquo; , ya que vamos a instalarlo sin embargo el nombre es meramente informativo.\njaviercruces@IWEB:~$ sudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/wordpress Vamos a editar el contenido del mismo , para ello :\njaviercruces@IWEB:~$ sudo nano /etc/nginx/sites-available/wordpress Aqu√≠ te dejo el ejemplo del fichero de configuraci√≥n de mi sitio , aseg√∫rate de definir el nombre del servidor (tu dominio) y el directorio ra√≠z del sitio.\nserver { listen 80; root /var/www/wordpress; # Cambia esta linea por la ubicaci√≥n del directorio root de tu wordpress index index.php index.html index.htm; server_name wordpress.fjcd.es; # Cambia esta linea y pon el FQDN , a traves de este acceder√°s a tu wordpress client_max_body_size 500M; location / { try_files $uri $uri/ /index.php?$args; } location = /favicon.ico { log_not_found off; access_log off; } location ~* \\.(js|css|png|jpg|jpeg|gif|ico)$ { expires max; log_not_found off; } location = /robots.txt { allow all; log_not_found off; access_log off; } location ~ \\.php$ { include snippets/fastcgi-php.conf; fastcgi_pass 127.0.0.1:9000; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; include fastcgi_params; } } Para hacer esta configuraci√≥n activa vamos a crear un enlace simb√≥lico\njaviercruces@IWEB:~$ sudo ln -s /etc/nginx/sites-available/wordpress /etc/nginx/sites-enabled/ Ahora vamos a reiniciar nginx , para que se apliquen los cambios :\njaviercruces@IWEB:~$ sudo systemctl reload nginx Para acceder a este VirtualHost , en la maquina donde vayas a acceder al wordpress , al no tener servidor dns recuerda poner en el fichero host la ip de tu servidor con el ServerName :\njaviercruces@HPOMEN15:~$ cat /etc/hosts #A√±ade la IP de tu servidor y el ServerName correspondiente (wordpress.fjcd.es) #Ponlo al final del fichero y no modifiques las lineas existentes en tu fichero 192.168.125.27 wordpress.fjcd.es Creaci√≥n de la base de datos con un usuario. Te recomiendo que apuntes los datos introducidos a continuaci√≥n ya que los necesitaras mas adelante . Nos conectamos a la base de datos :\njaviercruces@IWEB:~$ sudo mysql -u root -p Enter password: Welcome to the MariaDB monitor. Commands end with ; or \\g. Your MariaDB connection id is 31 Server version: 10.11.4-MariaDB-1~deb12u1 Debian 12 Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others. Type \u0026#39;help;\u0026#39; or \u0026#39;\\h\u0026#39; for help. Type \u0026#39;\\c\u0026#39; to clear the current input statement. #Creamos una base de datos : MariaDB [(none)]\u0026gt; CREATE DATABASE fjcd_wordpress; Query OK, 1 row affected (0,001 sec) #Nos creamos el usuario para nuestra base de datos MariaDB [(none)]\u0026gt; CREATE USER \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39; IDENTIFIED BY \u0026#39;tu_contrase√±a\u0026#39;; Query OK, 0 rows affected (0,013 sec) #Le damos permisos sobre la base de datos que hemos creado: MariaDB [(none)]\u0026gt; GRANT ALL PRIVILEGES ON fjcd_wordpress.* TO \u0026#39;fjcd-wordpress\u0026#39;@\u0026#39;localhost\u0026#39;; Query OK, 0 rows affected (0,010 sec) #Actualizamos los permisos: MariaDB [(none)]\u0026gt; FLUSH PRIVILEGES; Query OK, 0 rows affected (0,000 sec) #Nos salimos de la CLI de mysql MariaDB [(none)]\u0026gt; EXIT; Bye Instalaci√≥n de WordPress Lo primero que haremos ser√°¬†descargarnos WordPress, podemos hacerlo usando wget o si lo tenemos descargado en nuestro anfitri√≥n pasarlo haciendo uso de SCP o FTP .\njaviercruces@IWEB:~$ wget https://wordpress.org/latest.tar.gz --2023-10-27 12:33:17-- https://wordpress.org/latest.tar.gz Resolviendo wordpress.org (wordpress.org)... 198.143.164.252 Conectando con wordpress.org (wordpress.org)[198.143.164.252]:443... conectado. Petici√≥n HTTP enviada, esperando respuesta... 200 OK Longitud: 23465047 (22M) [application/octet-stream] Grabando a: ¬´latest.tar.gz¬ª latest.tar.gz 100%[=====================================\u0026gt;] 22,38M 14,8MB/s en 1,5s 2023-10-27 12:33:19 (14,8 MB/s) - ¬´latest.tar.gz¬ª guardado [23465047/23465047] Y¬†descomprimiremos el fichero¬†y copiaremos los ficheros dentro del¬†DocumentRoot¬†de nuestro¬†VirtualHost:\njaviercruces@IWEB:~$ sudo mkdir /var/www/wordpress/ javiercruces@IWEB:~$ sudo tar -zxf latest.tar.gz -C /var/www/ Entramos a la ruta del¬†WordPress¬†para realizar poner correctamente el esquema de permisos :\njaviercruces@IWEB:~$ cd /var/www/ Cambiamos usuario y grupos:\njaviercruces@IWEB:/var/www$ sudo chown -R www-data:www-data wordpress/ Una vez hemos configurado todo esto, ahora ya podemos acceder con nuestro navegador a nuestro dominio para iniciar la instalaci√≥n de¬†WordPress.\nInstalaci√≥n Web Accedemos a la url que hemos puesto en el ServerName de nuestro sitio virtual y posteriormente hemos configurado en el fichero hosts .\nLo primero sera seleccionar el idioma :\nA continuaci√≥n nos dar√° una breve explicaci√≥n de que es el CMS WordPress :\nAhora deber√°s de introducir los datos referente a los usuarios y el nombre de la base de datos que has creado con anterioridad\nUna vez introducidos los datos correctos continuaremos con la instalaci√≥n :\nAhora deber√°s de introducir los datos para tu wordpress , como el nombre del sitio asi como la creaci√≥n de un usuario administrador para que posteriormente puedas acceder a wp-admin:\nListo !! Ya has instalado wordpress\nAhora para acceder al panel de administraci√≥n de wordpress deber√°s de introducir la siguiente url en tu navegador e inicia sesi√≥n con el usuario que has creado:\nListo !! Asi se ve el panel de administraci√≥n de wordpress:\n","date":"October 28, 2023","hero":"/images/iweb/wordpress/wordpress_lemp.png","permalink":"https://www.javiercd.es/posts/iaw/wordpress_lemp/instalacion_wordpress_lemp/","summary":"\u003ch1 id=\"instalaci√≥n-wordpress-en-debian-12-con-pila-lemp-php-8\"\u003eInstalaci√≥n WordPress en Debian 12 con pila LEMP PHP-8\u003c/h1\u003e\n\u003cp\u003eWordPress es un sistema de gesti√≥n de contenidos (CMS, por sus siglas en ingl√©s) de c√≥digo abierto muy popular que se utiliza para crear y administrar sitios web y blogs. Fue lanzado por primera vez en 2003 y desde entonces ha ganado una amplia base de usuarios y una comunidad activa de desarrolladores y dise√±adores.\u003c/p\u003e\n\u003ch2 id=\"requisitos-previos\"\u003eRequisitos previos\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003cstrong\u003eServidor con Linux:\u003c/strong\u003e Debes disponer de un servidor que ejecute Linux , la gu√≠a esta pensada para Debian 12 .\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eUsuario con permisos de superusuario:\u003c/strong\u003e Debes tener acceso a un usuario con privilegios sudo en el servidor para poder llevar a cabo las tareas de instalaci√≥n y configuraci√≥n.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eNombre de Dominio Completo (FQDN):\u003c/strong\u003e Si deseas acceder a tu sitio WordPress a trav√©s de un dominio personalizado, aseg√∫rate de tener configurado y apuntando un nombre de dominio completo (FQDN) al servidor.\u003c/li\u003e\n\u003cli\u003e\u003cstrong\u003eAcceso a Internet:\u003c/strong\u003e Necesitas acceso a Internet para descargar paquetes y realizar actualizaciones durante el proceso de instalaci√≥n.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eAseg√∫rate de cumplir con todos estos requisitos antes de comenzar con la instalaci√≥n de WordPress en tu servidor .\u003c/p\u003e","tags":["WordPress","CMS","IWEB","AW","debian"],"title":"Instalaci√≥n WordPress en Debian 12 con pila LEMP PHP-8"},{"categories":null,"contents":"A lo largo de esta gu√≠a, exploraremos la configuraci√≥n de un escenario b√°sico utilizando redes IPv6 tanto en sistemas Linux como en dispositivos Cisco. Adem√°s, abordaremos la configuraci√≥n de un servidor Apache aprovechando las capacidades de IPv6.\nLinux Autoconfiguraci√≥n IPV6 Conecta dos m√°quinas Linux al mismo switch y comprueba que tienen conectividad con IPv6 usando la direcci√≥n de enlace local.\nComprobaremos las IPV6 que tienen los distintos pcs . El PC1 tiene ‚Äì\u0026gt; fe80::ef7:42ff:fe92:0/64\nMientras que el PC2 tiene ‚Äì\u0026gt; fe80::e5f:61ff:feee:0/64\nEstas dos direcciones se denominan de enlace local y se asignan autom√°ticamente a cada interfaz de red . Este tipo solo nos permitir√° comunicarnos con los dispositivos de nuestra red local y tienen el prefijo ‚Äì\u0026gt; FE80::/10\nSi hacemos un ping desde uno de estos a otros con la direcci√≥n de enlace local podremos comunicarnos :\nSLAAC A√±ade a la misma red una tercera m√°quina Linux y config√∫rala como router de forma que d√© direcciones IPv6 globales a las otras dos usando SLAAC. No olvides instalar RADVD. Comprueba que tienen conectividad.\nLo primero que haremos sera configurar la interfaz de red por ipv6 de nuestro router en este caso le asignare el prefijo 3333:db7::\nCalculamos la parte fija de nuestra direcci√≥n :\nR1 ‚Äì\u0026gt; 0c:01:30:a0:00:00 ‚Äì\u0026gt; 0c:01:30:ff:fe:a0:00:00 ‚Äì\u0026gt; 0E:01:30:FF:FE:A0:00:00\nEditamos el interfaces y aplicamos la configuraci√≥n de nuestra tarjeta de red :\nReiniciamos al servicio y tendr√≠amos una direccion global :\nSLAAC(Stateless Address Autoconfiuration) es un mecanismo de configuraci√≥n √∫nico para IPV6 no existe un equivalente en IPV4. El cual nos permite que los nodos de nuestra red se configuren autom√°ticamente .\nA partir de la direcci√≥n de enlace local que tienen todos los host , mediante el protocolo neighbour discovery solicita si hay alg√∫n router dentro de la red local le facilite los par√°metros de configuraci√≥n de la red\nLo primero que haremos para configurar SLAAC sera instalar el paquete radvd :\nSi miramos el estado del demonio este nos dir√° que no encuentra su fichero de configuraci√≥n :\nAs√≠ que le generaremos uno indic√°ndole la interfaz que va a repartir direcciones y adem√°s le diremos el comportamiento que tendr√° en nuestra red :\nMinRtrAdvInterval : Indica el tiempo m√≠nimo en segundos por el cual el router mandara un mensaje en segundos .\nMaxRtrAdvInterval: Indica el tiempo m√°ximo en segundo por el cual el router mandara un mensaje .\nAdvSendAdvert: Indica si por la interfaz se mandaran avisos o no .\nAdvManagedFlag: Indica si queremos que el servicio utilice DHCPv6(on) o no (off) .\nPrefix: Indica el prefijo de red que usara SLAAC para asignar direcciones .\nAdvValidLifetime: Indica el tiempo en segundos que una direcci√≥n IPV6 sera valida.\nAdvPreferredLifetime: Indica el tiempo en segundos que una direcci√≥n generada a partir del prefijo sera preferida en lugar de otras direcciones .\nUna vez hecho esto reiniciamos el servicio y el demonio comenzara a configurar a nuestros clientes :\nAdem√°s deberemos de configurar el bit de forwarding para ipv6 en nuestro router , al igual que con ipv4 editamos el archivo /etc/sysctl.conf :\nMensajes de SLAAC Podemos ver como se ha configurado el PC1 usando SLAAC :\nTambi√©n el PC2 se ha configurado :\nVamos a estudiar los mensajes que han intervenido en esta configuraci√≥n de SLAAC , si los numeramos como en esta captura de Wireshark :\nRouter solicitation (RS) (No aparece en la captura) : El PC le env√≠a un mensaje de RS a todos los routers para indicar que necesita un RA , este mensaje se env√≠a si no recibe ning√∫n RA pasado un tiempo. Router Advertisement (RA): Una vez el router recibe el RS o peri√≥dicamente env√≠a un RA en el cual se incluye el prefijo de la red y su longitud . El mensaje RA se env√≠a a la direcci√≥n IPv6 de multidifusi√≥n de todos los nodos, FF02::1, con la direcci√≥n link-local del router como la direcci√≥n IPv6 de origen. (N0 6 y 12). Multicast Listener Report Message v2:Indica que el dispositivo x ha iniciado una sesi√≥n de escucha para trafico multicast (No 7 y 9). Neighbor Solicitation (NS): Se utiliza para conocer la direcci√≥n MAC de un dispositivo de tu red , es similar al protocolo ARP .(No 10,11,613). Neighbor Advertisement (NA) : Es el mensaje de respuesta de un NS (No 614). Una vez que el cliente a recibido un RA , este procede a configurar su direcci√≥n IPV6 , con un prefijo de red de 64 bits pero necesita una IID(Interface Identifier) .\nHay dos maneras en las que los clientes pueden crear su propia IID √∫nica:\nEUI-64: mediante el proceso EUI-64, la PC1 crea una IID utilizando su direcci√≥n MAC de 48 bits. De generaci√≥n aleatoria: la IID de 64 bits puede ser un n√∫mero aleatorio generado por el sistema operativo cliente. Dado que SLAAC es un proceso sin estado, para que los clientes pueda utilizar esta direcci√≥n IPv6 creada recientemente, debe verificar que sea √∫nica. El cliente enviara un NS con su propia direcci√≥n como la direcci√≥n IPv6 de destino. Si ning√∫n otro dispositivo responde con un mensaje de anuncio de vecino, la direcci√≥n es √∫nica y puede ser utilizada por el cliente. Si este recibe un NA, la direcci√≥n no es √∫nica, y el sistema operativo debe determinar una nueva ID de interfaz para utilizar.\nEste proceso forma parte de la detecci√≥n de vecinos ICMPv6 y se conoce como ‚Äúdetecci√≥n de direcciones duplicadas (DAD)‚Äù.\nEsta imagen explica la configuraci√≥n de una interfaz por SLAAC. Ahora vamos a comprobar que los distintos clientes tienen conectividad entre si :\nPC1 ‚Äì\u0026gt; 3333:db7::ef7:42ff:fe92:0 PC2 ‚Äì\u0026gt; 3333:db7::e5f:61ff:feee:0\nR1 ‚Äì\u0026gt; 3333:db7::e01:30ff:fea0:0\nRouter 1 :\nPC2:\nTenemos que tener en cuenta que estas ‚Äúconcesiones‚Äù de direcciones no se almacenan en ning√∫n sitio , es decir en el servidor no almacenamos las configuraciones que ha realizado el servicio .\nDHCPv6 con SLAAC Cambia la configuraci√≥n para que utilice DHCPv6 en vez de SLAAC enviando tambi√©n los servidores DNS. Comprueba que las m√°quinas tienen conectividad.\nPara ello nos instalamos el servidor DHCPv6 , el paquete es el mismo para ipv4 :\nEditamos el fichero de configuraci√≥n para IPV6 ‚Äì\u0026gt; sudo nano /etc/dhcp/dhcpd6.conf:\nEn el fichero /etc/default/isc-dhcp-server indicaremos no solo la interfaz que queremos repartir direcciones si no tambi√©n especificaremos que el servidor funcionara por IPV6 :\nReiniciamos el servicio y comprobamos que esta funcionando con los par√°metros que le hemos asignado en la configuraron :\nVamos a comprobar que los clientes se configuraran usando ipv6 , para ello la configuraci√≥n en el network interfaces es bastante similar a IPV4 :\nReiniciamos el servicio networking.service y obtendremos la configuraci√≥n por DHCP en la tarjeta :\nAdem√°s tambi√©n podemos ver las concesiones el fichero de concesiones , en el servidor en la siguiente ruta /var/lib/dhcp/dhcpd6.leases :\nNo lo he mencionado anteriormente pero para que al producirse la configuraci√≥n el cliente obtenga los par√°metros que hemos configurado por DHCPv6 tendremos que poner este par√°metro a ON en el fichero de configuraci√≥n de SLAAC :\nComo podemos ver el √∫nico par√°metro que hemos especificado en el servidor DHCP a sido el DNS de google ha sido correctamente configurado en nuestro cliente :\nMensajes DHCPv6 con SLAAC Acabamos de configurar SLAAC y DHCPv6 sin estado , esto significa que :\nUsa SLAAC para obtener una direcci√≥n IPV6 de tipo global unicast , adem√°s de la puerta de enlace . Usa el servidor DHCPv6 sin estado, para el resto de par√°metros de configuraci√≥n de nuestra red . Es decir hemos configurado la segunda opci√≥n de la siguiente imagen :\nLas capturas que ver√°s a continuaci√≥n NO est√°n recortadas debido a que se ven pixeladas. Los mensajes de la comunicaci√≥n est√°n en orden. Si observamos la captura de Wireshark y la comparamos con la configuraci√≥n √∫nica de SLAAC :\nOperaciones de SLAAC:\nPodemos ver que el PC1 a solicitado un RS , a todos los routers de la red (Multicast) R1 le responde a PC1 con un RA(Indica si necesitara comunicarse con un DHCPv6 con estado o sin estado) NS , para comprobar que la direcci√≥n asignada no esta duplicada Operaciones de DHCPv6:\nSolicit a todos los servidores DHCPv6 de la red (Multicast a ff02::1:2) incluye un identificador de cliente CID. Advertise : Es la respuesta del servidor DHCPv6 a un solicit , este incluye las opciones de configuraci√≥n oportunos , incluido una IPv6 . Tambi√©n incluye un CID y un XID(Id transacci√≥n). Request: El cliente env√≠a este mensaje a todos los servidores DHCPv6 para indicar que desea los par√°metros ofertados en el Adverstise . Tambi√©n incluyen CID y XID. Reply: El servidor DHCPv6 responde y confirma que la direcci√≥n ha sido asignada as√≠ como todos los par√°metros adicionales de configuraci√≥n .Tambi√©n incluyen CID y XID. Aqu√≠ te dejo una imagen en la que se observa el orden de los mensajes que hemos recibido y una breve descripci√≥n del mismo , adem√°s nos indica si los mensajes son unicast o multicast :\nApache en IPV6 Para las versiones de Apache superiores a 2.X tienen soporte para IPV6 habilitado por defecto as√≠ que al instalar el servicio ya estaremos escuchando por este protocolo sin necesidad de realizar ninguna configuraci√≥n adicional en el servicio .\nPodemos comprobar si al instalarlo nuestro servidor esta escuchando por ese puerto :\nEn el caso de que creemos un virtualhost podemos especificar como queremos que trabajen si usando ambos protocolos IPV6 y IPV4 o solo uno de ellos . Vemos que ssh tambi√©n utiliza ipv6 por defecto .\nAcceso al servidor web desde dentro de la red Vamos a acceder desde las maquinas de nuestra red en mi caso lo he montado en el router ya que es el √∫nico que tiene acceso a internet en este escenario .\nMe conectare a el utilizando la direccion global pero podr√≠amos usar la local sin problema ya que pertenecemos a la misma red local .\nAcceso desde PC2:\nAcceso al servidor web desde fuera de la red Para esto deberemos de configurar R1 y ‚ÄòPC3‚Äô en la misma red usando IPV6 :\nPC3:\nR1:\nLe haremos la petici√≥n a PC1 desde PC3 que esta fuera de esa red local , como vemos no es necesario hacer NAT .\nIncluso puedo hacerle ping a un host desde otra red :\nSi analizamos estas peticiones con Wireshark podemos ver que en ning√∫n momento se produce NAT:\nFuera de la red :\nDentro de la red:\nPor supuesto un host de nuestra red local puede acceder al servidor web :\nCISCO Configuraci√≥n de un router cisco en IPV6 Lo primero que haremos sera calcular la direccion IPV6 que le corresponden a las MACS :\nF 0/0 ‚Äì\u0026gt; CA:01:6C:FA:00:00 ‚Äì\u0026gt; CA:01:6C:FF:FE:FA:00:00 ‚Äì\u0026gt; C801:6CFF:FEFA:0\nF 1/0 ‚Äì\u0026gt; CA:01:6C:FA:00:1C-‚Üí CA:01:6C:FF:FE:FA:00:1C ‚Äì\u0026gt; C801:6CFF:FEFA:001C\nPara que nuestro router se configure usando SLACC y no tengamos que hacer esto manualmente introduciremos los siguientes comandos para cada una de las interfaces que queramos que se configuren por SLAAC :\nTambi√©n deberemos de indicarle no shut para que se levante la interfaz .\nCon el siguiente comando comprobaremos que nuestro router se ha configurado correctamente autom√°ticamente usando SLAAC :\nYa con las direcciones de enlace local tendremos conectividad con el router :\nSLAAC Ahora vamos a hacer que el router configure a los clientes usando SLAAC .\nVamos a configurar una direcci√≥n global a nuestro router en la interfaz que da a la red que queremos darle este servicio , con el prefijo de red : 3333:db7::\nVamos a utilizar EUI-64 para configurar nuestras interfaces :\nFastEthernet 0/0 ‚Äì\u0026gt; 3333::C801:6CFF:FEFA:0/64\nFastEthernet 1/0 ‚Äì\u0026gt; 2222::C801:6CFF:FEFA:1C/64\nComprobamos las direcciones IPV6 se han ‚Äúgenerado‚Äù correctamente :\nPara que el router nos configure a los clientes deberemos de introducir el siguiente comando este , har√° que nuestro router mande RA y conteste a las peticiones de RS:\nUna vez hecho esto nuestros clientes se habr√°n configurado correctamente :\nPC1:\nPC2:\nLos mensajes que se han producido al configurar los clientes :\nRouter solicitation (RS): El PC le env√≠a un mensaje de RS a todos los routers para indicar que necesita un RA , este mensaje se env√≠a si no recibe ning√∫n RA pasado un tiempo.\nRouter Advertisement (RA): Una vez el router recibe el RS o peri√≥dicamente env√≠a un RA en el cual se incluye el prefijo de la red y su longitud . En el caso de que el router responda a un RS este le env√≠a un RA especifico al host que lo ha solicitado . En el caso de que sea un mensaje RA peri√≥dico se env√≠a a la direcci√≥n IPv6 de multidifusi√≥n de todos los nodos, FF02::1, con la direcci√≥n link-local del router como la direcci√≥n IPv6 de origen.\nNeighbor Solicitation (NS): Se utiliza para conocer la direccion MAC de un dispositivo de tu red , es similar al protocolo ARP .\nNeighbor Advertisement (NA) : Es el mensaje de respuesta de un NS .\nDHCPv6 con SLAAC Configurar un servidor de DHCPv6 con estado es similar a configurar un servidor sin estado. La diferencia m√°s importante es que un servidor con estado tambi√©n incluye informaci√≥n de direccionamiento IPv6 de manera similar a un servidor DHCPv4.\nLo primero que tendremos que hacer sera para habilitar el routing IPv6. Este comando no es necesario para que el router sea un servidor de DHCPv6 con estado, pero se requiere para que el router origine los mensajes RA ICMPv6.\n‚Äì\u0026gt; ipv6 unicast-routing\nLo tenemos configurado en el apartado anterior as√≠ que no lo volveremos a hacer . Configuraremos un pool DHCPV6 :\nCon DHCPv6 con estado, todos los par√°metros de direccionamiento y otros par√°metros de configuraci√≥n deben ser asignados por el servidor de DHCPv6. El comando address prefix se utiliza para indicar el conjunto de direcciones que debe asignar el servidor. La opci√≥n lifetime indica el tiempo de arrendamiento v√°lido y preferido en segundos. Al igual que con DHCPv6 sin estado, el cliente utiliza la direcci√≥n IPv6 de origen del paquete que conten√≠a el mensaje RA.\nLe indicamos el prefijo de red y el tiempo de vida de cada direcci√≥n :\nAhora le indicamos los servidores DNS :\nAun podemos configurar mas par√°metros como el nombre del dominio pero en mi caso solo me interesa esto , as√≠ que procederemos a indicarle en que interfaz tiene que funcionar el servicio :\nAhora comprobaremos que el servidor DHCP , esta funcionado en nuestra interfaz :\nVeremos como en el cliente se ha asignado el servido DNS:\nY la concesi√≥n en el servidor DHCP :\nOperaciones de SLAAC:\nPodemos ver que el PC2 a solicitado un RS , a todos los routers de la red (Multicast) R1 le responde a PC1 con un RA(Indica si necesitara comunicarse con un DHCPv6 con estado o sin estado) Operaciones de DHCPv6:\nSolicit a todos los servidores DHCPv6 de la red (Multicast a ff02::1:2) incluye un identificador de cliente CID. Advertise : Es la respuesta del servidor DHCPv6 a un solicit , este incluye las opciones de configuraci√≥n oportunos , incluido una IPv6 . Tambi√©n incluye un CID y un XID(Id transacci√≥n). Request: El cliente env√≠a este mensaje a todos los servidores DHCPv6 para indicar que desea los par√°metros ofertados en el Adverstise . Tambi√©n incluyen CID y XID. Reply: El servidor DHCPv6 responde y confirma que la direcci√≥n ha sido asignada as√≠ como todos los par√°metros adicionales de configuraci√≥n .Tambi√©n incluyen CID y XID. Acceso al servidor web desde dentro de la red Desde nuestra red local podremos hacer la petici√≥n al servidor web usando tanto la direcci√≥n local de enlace como la direcci√≥n global :\nAcceso al servidor web desde fuera de la red SWEB ‚Äì\u0026gt; 3333:db7::ef7:42ff:fe92:0\nVemos que con la configuraci√≥n anterior que ten√≠amos en apache podemos acceder sin problema al servidor web desde una maquina de fuera de nuestra red :\nConfiguraci√≥n b√°sica de apache para IPV6 Como comentaba antes no es necesario a partir de la version 2.X en adelante de configurar nada adicionalmente en apache para que nuestro servidor funcione usando el protocolo IPV6 ya por defecto este escucha en IPV4 y IPV6 .\nSin embargo podemos configurar para que este solo escuche por IPV6 , para ello deberemos de realizar una simple configuraci√≥n en el servicio . Accederemos al fichero ‚Äì\u0026gt; /etc/apache2/ports.conf\nComentaremos la linea Listen 80 ya que hace referencia a IPV4 y le a√±adiremos la referente a ipv6.\nCon esta configuraci√≥n escucharemos todas las peticiones de cualquier direcci√≥n IPV6 , en los corchetes podemos especificar una direcci√≥n para responderle peticiones solo a esta .\nAhora accederemos a nuestro host virtual y cambiaremos la declaraci√≥n de este , al igual que hemos hecho arriba modificando la etiqueta que hace referencia a todas las direcciones IPV4 y la cambiaremos por esta para hacer referencia a todas las direcciones IPV6 por el puerto 80 :\nAhora reiniciaremos el servicio apache y comprobaremos que el estado del mismo es exitoso :\nCon esto ya nuestro servidor apache funcionaria solo en IPV6 :\nBibliograf√≠a ¬øQue es SLAAC?-Alberto Molina Mensajes de SLAAC Montar un servidor DHCPv6 Debian Mensajes DHCPv6 con SLAAC Apache IPV6 ","date":"October 8, 2023","hero":"/images/redes/escenario_ipv6_basico/portada.png","permalink":"https://www.javiercd.es/posts/redes/escenario_ipv6_basico/escenario_ipv6_basico/","summary":"\u003cp\u003eA lo largo de esta gu√≠a, exploraremos la configuraci√≥n de un escenario b√°sico utilizando redes IPv6 tanto en sistemas Linux como en dispositivos Cisco. Adem√°s, abordaremos la configuraci√≥n de un servidor Apache aprovechando las capacidades de IPv6.\u003c/p\u003e\n\u003ch2 id=\"linux-autoconfiguraci√≥n-ipv6\"\u003eLinux Autoconfiguraci√≥n IPV6\u003c/h2\u003e\n\u003cp\u003eConecta dos m√°quinas Linux al mismo switch y comprueba que tienen conectividad con IPv6 usando la direcci√≥n de enlace local.\u003c/p\u003e\n\u003cp\u003eComprobaremos las IPV6 que tienen los distintos pcs . El PC1 tiene ‚Äì\u0026gt; fe80::ef7:42ff:fe92:0/64\u003c/p\u003e","tags":["Redes","Enrutamiento","IPV6"],"title":"Escenario IPv6 B√°sico"},{"categories":null,"contents":"En este post, exploraremos c√≥mo configurar un entorno de Active Directory en un servidor Ubuntu utilizando herramientas como Kerberos y Samba. Active Directory es una soluci√≥n integral de Microsoft para la gesti√≥n de identidades y el control de acceso en redes empresariales. A trav√©s de esta gu√≠a, aprenderemos paso a paso c√≥mo implementar un servidor Ubuntu como controlador de dominio, establecer la autenticaci√≥n basada en Kerberos y configurar servicios de directorio mediante Samba.\nIntroducci√≥n Se quiere configurar un servidor Linux (Ubuntu Server 20.04 LTS) para dar servicio a un conjunto de equipos clientes (Windows y Linux).\nAprovechar√© que el escenario lo tenemos montado de las anteriores actividades de clase y restaurar√© las instant√°neas para disponer de las m√°quinas limpias .\nPreparaci√≥n del entorno 1. El servidor Linux no tendr√° entorno gr√°fico. Tendr√° al menos las particiones: raiz, home y de intercambio. Aqu√≠ podemos ver que no tengo instalado entorno gr√°fico , podemos ver que el servicio est√° activo, sin embargo, no se lanza ning√∫n entorno . Adem√°s, si buscamos alg√∫n proceso con los nombres de escritorio m√°s conocidos no nos lanza ning√∫n resultado .\nAqu√≠ te muestro las particiones que tiene mi servidor Ubuntu (ra√≠z , boot , home y swap):\n2.El servidor debe estar preparado para que pueda administrarse de forma remota (a partir de este momento toda la gesti√≥n se har√° remotamente desde otro equipo de la red). Para administrarlo de forma remota utilizar√© ssh, para ello lo instalamos en el servidor :\nUna vez que se instale lo tendremos funcionando , no es necesario realizar ninguna configuraci√≥n .\nSi consultamos el estado del servicio podemos ver que ha tomado la configuraci√≥n por defecto :\nPara conectarnos remotamente necesitaremos saber la IP del equipo o el nombre :\nEn mi caso me conectar√© desde la red externa a nuestro servidor (enp0s3) , previamente hemos configurado la red con netplan :\nY hemos aplicado los cambios :\nUna vez conociendo estos datos nos conectaremos por ssh desde una m√°quina de nuestra red para seguir con los dem√°s apartados, en mi caso utilizar√© mi m√°quina host, para ello me he instalado el paquete openssh-client previamente:\n3. Crea los usuarios y grupos siguientes Grupos: profesores, alumnos, smr, asir. Creo los grupos : Usuario a crear : profedesiree, profejose , proferaul , erik, manu, oliver, sandra, fabio y domi Creo los usuarios :\nLos he creado con directorio home y les he asignado la contrase√±a 1234:\nUsuarios del grupo profesores: profedesiree, profejose y proferaul. Los a√±adimos : Podemos comprobar que se han a√±adido con el siguiente comando :\nUsuarios del grupo alumnos: erik, manu, oliver, sandra, fabio y domi. Los a√±adimos :\nComprobamos que se han a√±adido :\nUsuarios del grupo smr: profedesiree, profejose, proferaul, erik, manu y oliver. Los a√±adimos:\nComprobamos que se han a√±adido :\nUsuarios del grupo asir: sandra, fabio y domi. Comprobamos que se han a√±adido :\n4. Todos los usuarios ser√°n usuarios Samba. Para ello deberemos tener instalado samba : Para a√±adir un usuario samba debemos de introducir el siguiente comando y asignarle una contrase√±a :\nEsto lo haremos con los 9 usuarios , una vez a√±adidos podemos utilizar este comando para listar los usuarios samba que tenemos :\nControlador de dominio samba 5. Crea y configura un controlador de dominio Samba en el Servidor. Antes de comenzar con la instalaci√≥n debemos de tener en cuenta una serie de datos :\nNombre del controlador de dominio de Active Directory: FJCD\nNombre DNS del dominio de Active Directory: javiercruces.local Nombre del Reino Kerberos: javiercruces.local Nombre NetBIOS del dominio: javiercruces Direcci√≥n IP fija del servidor: 192.168.0.1 Rol del servidor: Domain Controller (DC) Reenviador DNS:192.168.0.1 Una vez con estos datos claros comenzaremos con la instalaci√≥n , lo primero ser√° actualizar el sistema :\nA continuaci√≥n deberemos de cambiar el nombre de nuestro servidor para estar acorde con los datos que hemos seleccionado anteriormente, para ello yo he seleccionado mis iniciales , para ello editamos el fichero /etc/hostname :\nAhora ser√° necesario que reiniciemos el equipo para que se apliquen los cambios , perderemos la conexi√≥n por ssh :\nRetomamos el control remoto por ssh en unos minutos cuando haya reiniciado :\nComo puedes observar nos hemos conectado usando el antiguo nombre que tenia nuestro servidor , esto es porque el archivo /etc/hosts, contiene una relaci√≥n de direcciones IP con sus correspondientes nombres l√≥gicos. Este archivo conten√≠a una referencia al nombre antiguo del propio servidor, que cambiaremos para que haga referencia al nuevo nombre :\nUna vez hemos aplicado estos dos cambios , antes de continuar solo nos quedara asegurarnos de que nuestro servidor tiene correctamente configurada la red . En nuestro escenario disponemos de dos tarjetas de red en nuestro servidor :\nenp0s3 (Tarjeta externa , nos da acceso a internet) enp0s8 (Tarjeta interna , es la que se comunica con nuestra red local) Debido a esto la primera est√° configurada por DHCP, ya que no nos importa la configuraci√≥n que se le asigne , sin embargo, la segunda est√° configurada est√°ticamente, ya que debemos de controlar la configuraci√≥n de la misma para que tengamos control sobre la misma y posteriormente unir los equipos al dominio .\nUna vez aclarado esto , al principio del documento indico como se configuraran las interfaces , aqu√≠ dejo un pantallazo para recordar las direcciones :\nAhora necesitaremos disponer de unos paquetes que deber√°n de estar instalados antes de comenzar ,estos son :\nsamba: servidor de archivos, impresi√≥n y autenticaci√≥n para SMB/CIFS. smbclient: clientes de l√≠nea de comandos para SMB/CIFS. krb5-config: Archivos de configuraci√≥n para Kerberos Version 5. winbind: Servicio para resolver informaci√≥n sobre usuarios y grupos de servidores Windows NT. Podremos hacer la instalaci√≥n de estos cuatro paquetes con un simple comando :\nKerberos, nos preguntar√° por el reino (nombre de dominio ) durante la instalaci√≥n de los paquetes, en nuestro caso ser√° javiercruces.local :\nAqu√≠ introduciremos el nombre de nuestro equipo servidor :\nAqu√≠ volveremos a introducir el nombre de nuestro servidor :\nDespu√©s de esto, la instalaci√≥n continuar√° un poco m√°s, pero sin necesitar que aportemos m√°s informaci√≥n:\nAhora configuraremos samba , pero antes de hacerlo le cambiaremos el nombre al archivo de configuraci√≥n smb.conf para que no lo use mientras que lo configuramos y as√≠ adem√°s tendremos una copia del archivo original :\nUsaremos el comando samba-tool domain provision, para que sea el propio comando sea el que nos solicite los valores que necesite y, cuando sea posible, nos sugiera sus valores predeterminados. As√≠, si estos coinciden con los que nosotros esperamos, ser√° muy probable que los pasos anteriores hayan sido los correctos:\nComo puedes observar es muy intuitivo hacerlo, ya que salvo la IP de forwarder y la contrase√±a de administrador hemos elegido las respuestas que el mismo comando nos ofrece . Esta debe cumplir unos requisitos de complejidad m√≠nimos :\n8 caracteres como m√≠nimo 1 may√∫scula 1 numero o s√≠mbolo Con esto, adem√°s de configurarse Samba , se ha generado un archivo de configuraci√≥n para Kerberos en la ruta /var/lib/samba/private/krb5.conf. Asi que lo copiaremos a /etc :\nLo siguiente ser√° configurar la resoluci√≥n de nombres, para ello comenzaremos deteniendo los servicios implicados :\nTambi√©n quitaremos que se inicien autom√°ticamente al reiniciar el equipo :\nA continuaci√≥n, nos aseguraremos de que el servicio samba-ad-dc se podr√° iniciar sin dificultades, evitando cualquier enmascaramiento que pueda existir:\nDespu√©s, eliminamos el archivo resolv.conf que, en realidad, ser√° un enlace a stub-resolv.conf. As√≠ que lo eliminamos y creamos uno nuevo para sustiruirlo:\nAhora introducimos los valores adecuados en funci√≥n de nuestro dominio , para mi caso :\nGuardamos los cambios y salimos del fichero.\nIniciaremos el servicio de samba-ad-dc y lo habilitaremos para que se inicie al reiniciar el equipo :\nComprobar la instalaci√≥n Si hemos conseguido llegar hasta aqu√≠ , tenemos todas las papeletas para que nuestra instalaci√≥n haya sido correcta . Pero nunca est√° de m√°s hacer unas comprobaciones\nConsultar el nivel del dominio y crear un nuevo usuario Para saber nuestro nivel de dominio simplemente introducimos este comando :\nAl hacerlo, comprobamos que el nivel del dominio, y del bosque donde se encuentra, equivale a una instalaci√≥n Windows Server 2008 R2\nProbaremos a crear una nueva cuenta de usuario en el dominio con el comando(deberemos de tener en cuenta la pol√≠tica de contrase√±as):\nConfirmar que el servidor DNS funciona de forma adecuada Lo primero ser√° comprobar el servicio LDAP sobre el protocolo TCP, para lo que escribiremos la siguiente orden:\nSi tenemos una respuesta parecida a esa, todo funciona como debe.\nA continuaci√≥n, comprobaremos el registro SRV para el protocolo Kerberos sobre UDP, para lo que usamos la siguiente orden:\nLa respuesta debe ser parecida a la anterior, si es as√≠ registro SRV es correcto.\nPor √∫ltimo, comprobamos la resoluci√≥n del nombre de nuestro servidor:\nComprobar el funcionamiento de Kerberos Para comprobar el funcionamiento podemos, por ejemplo, usar el comando smbclient para comprobar los servicios que puede obtener un determinado usuario. Para ello utilizaremos el siguiente comando :\nSi la autenticaci√≥n es correcta , ya sabremos que Kerberos est√° haciendo su trabajo . Si queremos, incluso podemos iniciar sesi√≥n en el servidor empleando la cuenta de administrador. Para lograrlo, usaremos una sintaxis como esta:\nYa hemos verificado todo as√≠ que podemos empezar a unir clientes a nuestro dominio .\nUnir clientes al dominio 6. Integra al menos un cliente con Windows en el dominio Samba. Cliente Windows Lo primero que haremos ser√° configurar la red de nuestro cliente :\nIP : 192.168.0.10 Mascar√° de subred : /24 Puerta de enlace 192.168.0.1 DNS 192.168.0.1 Ambas tarjetas (Interna del servidor y la de Windows cliente ) deber√°n de estar en red interna para que se comuniquen .\nUna vez configurada la tarjeta le haremos un ping al servidor para comprobar la conectividad:\nAhora accedemos a panel de control ‚Üí sistema y seguridad ‚Üí sistema ‚Üí configuraci√≥n avanzada del sistema ‚Üí nombre de equipo ‚Üí id de red . Seleccionamos la primera opci√≥n para unirnos al dominio\nSeleccionaremos la primera opci√≥n, ya que nuestra red tiene un dominio :\nAhora deberemos de introducir los datos del usuario administrador y el nombre de nuestro dominio :\nEl usuario administrador que se crea por defecto en samba se llama administrator\nUna vez introducido los datos nos preguntar√° si queremos crear una cuenta de dominio en este equipo , yo seleccionare que no :\nY para que se apliquen los cambios deberemos de reiniciar :\nUna vez reiniciado podremos iniciar sesi√≥n con los diferentes usuarios de nuestro dominio :\nPodemos ver que podemos iniciar sesi√≥n en el equipo con las cuentas de nuestro dominio:\nCliente Linux Lo primero ser√° configurar la red, para ello le he asignado la direcci√≥n IP 192.168.0.2\nAhora deberemos a√±adir a nuestro servidor en el fichero hosts, una l√≠nea en la que ira la direcci√≥n IP de nuestro servidor seguido del nombre de este y el nombre completo del dominio de nuestro servidor :\nPara comprobar este cambio que hemos realizado le haremos un ping al servidor usando su nombre :\nAhora actualizaremos el equipo para poder descargar las versiones m√°s recientes desde los repositorios :\nPara tener internet en el cliente he configurado previamente NAT en el servidor .\nUna vez actualizado el sistema instalaremos los siguientes paquetes :\nsssd (System Security Services Daemon): Administra los mecanismos de autenticaci√≥n y el acceso a directorios remotos. Sustituye al cl√°sico Winbind aportando m√°s velocidad y estabilidad. heimdal-clients: Se trata de una implementaci√≥n libre de Kerberos 5 creada con la intenci√≥n de ser compatible con el protocolo Kerberos implementado por el MIT. msktutil: La utilidad que obtiene y administra los keytabs de Kerberos en un entorno de Microsoft Active Directory. Podemos hacerlo con 1 comando :\nMientras instalamos nos solicitara el nombre de nuestro servidor de active directory asi que lo introducimos :\nAhora nos preguntar√° el nombre del equipo que act√∫a como servidor en nuestro caso es :\nPor √∫ltimo nos preguntar√° por el servidor administrativo que en nuestro caso es el mismo:\nUna vez hecho esto, la instalaci√≥n continuar√° sin que tengamos que introducir m√°s datos.\nAhora vamos a a√±adir en Kerberos unos datos adicionales para asegurarnos que se comporte correctamente. Comenzaremos por cambiar el nombre del archivo de configuraci√≥n, para poder volver a los par√°metros originales si fuese preciso:\nAhora utilizaremos nano para editar la configuraci√≥n del archivo , este estar√° vac√≠o as√≠ que a√±adiremos lo siguiente :\nUna vez rellenado con los datos de nuestro dominio, guardamos el archivos y comprobaremos si podemos iniciarnos sesi√≥n en el dominio :\nSi la salida no nos ofrece ning√∫n tipo de error, es porque el proceso de autenticaci√≥n ha funcionado correctamente.\nProcederemos a unirnos al dominio, para ello utilizaremos el siguiente comando :\nEste comando deberemos de rellenarlo conforme a los datos de nuestro dominio , en el caso de que no nos salga ninguna salida , nos habremos unido al dominio .\nPara completar la tarea, eliminaremos los tickets de autorizaci√≥n de kerberos que activamos al ejecutar kinit. Para lograrlo, basta con utilizar el comando kdestroy.\nCompartir carpetas 7. Se necesitan carpetas personales en el servidor para cada usuario. Tambi√©n habr√° una carpeta para cada grupo, a la que solo podr√°n acceder y escribir los miembros de cada grupo. Vamos a crear los directorios en la partici√≥n ra√≠z para cada usuario y uno para cada grupo. Estos los crear√© con el nombre del grupo o usuario:\nTenemos que tener en cuenta que los usuarios samba que hemos generado al principio del documento se han eliminado al instalar el dominio y deberemos de producirlos nuevamente.\nVamos a compartir estas carpetas a trav√©s de samba, para ello editamos el fichero /etc/samba/smb.conf :\nPara indicar que pueda acceder un grupo deberemos de poner una @ delante dele nombre del grupo :\nSolo nos quedar√≠a asignar correctamente los permisos locales adecuados para nuestros recursos y cambiar los propietarios de las carpetas para que los usuarios puedan escribir en ellas :\nEsto ser√≠a lo correcto, pero si le asignamos los permisos 775 no podremos escribir en la carpeta, as√≠ que le asignaremos todos los permisos :\nAhora repetiremos esto con todos los directorios , primero le dar√© los permisos:\nY por √∫ltimo cambiaremos los propietarios de las carpetas y haremos a cada usuario o grupo sus respectivos due√±os :\nVamos a asegurarnos de que hemos aplicado correctamente estos cambios :\nVamos a comprobar que podemos acceder a los recursos compartidos desde el usuario oliver , accederemos a la carpeta Oliver y a crear un directorio dentro :\n8. Desde Windows acceder a estas carpetas a trav√©s de unidades de red. Desde el explorador de archivos podremos ver todos los recursos compartidos en la red .Ahora vamos a crear unidades de red, as√≠ que por ejemplo vamos a a√±adir la carpeta Oliver al usuario Oliver como unidad de red, para esto , hacemos clic derecho en la carpeta \u0026gt; conectar a unidad de red :\nY seleccionaremos una letra para asignarle a la unidad de red :\nAhora esta unidad nos aparecer√° en este equipo :\nPerfiles m√≥viles 9. Definir perfiles m√≥viles en el servidor Linux mediante Samba, de forma que los usuarios se puedan autentificar en diferentes m√°quinas Windows, manteniendo su configuraci√≥n. Para realizar esto vamos a instalarlos RSAT (Remote Server Administration Tools) que nos permitir√° administrar nuestro controlador de dominio samba de forma id√©ntica a windows server . Para a√±adirlas buscaremos en la b√∫squeda de Windows *A√±adir caracter√≠sticas opcionales una vez aqu√≠ le daremos a a√±adir caracter√≠stica :\nUna vez aqu√≠ buscaremos las siguientes caracter√≠sticas con RSAT y las instalaremos :\nUna vez instaladas se nos crear√° una aplicaci√≥n similar a la de un Windows server llamada herramientas administrativas :\nSe nos abrir√° una carpeta con las herramientas de administraci√≥n :\nY buscaremos administraci√≥n de usuarios y equipos de active directory o escribimos en ejecutar dsa.msc , esto lo haremos con el usuario administrador de nuestro dominio para poder acceder a esta:\nAntes de crear nuestro usuario m√≥vil crearemos un recurso de red al igual que hemos hecho anteriormente llamado perfiles y le daremos permisos al grupo m√≥viles para que estos puedan escribir en ellos :\nPara que nuestro usuario pueda escribir en este directorio lo a√±adiremos al grupo :\nAhora nos vamos a la configuraci√≥n de nuestro usuario y le cambiamos la ruta del perfil . Pondremos la ruta de nuestra carpeta compartida perfiles seguida de %username% :\nGuardamos y ya tendr√≠amos hecho nuestro perfil m√≥vil creado .\nVamos a demostrar el funcionamiento del perfil m√≥vil , para ello le he cambiado el fondo y he creado dos carpetas :\nAhora vamos a cerrar sesi√≥n e iniciarla en el Windows de la derecha :\nVemos que se ha realizado correctamente el perfil m√≥vil .\nNFS 10. Mediante NFS, se compartir√°n en el servidor las carpetas: proyectos, documentaci√≥n, programas_y_drivers. De la primera solo se podr√° leer; en las dos √∫ltimas tambi√©n se podr√° escribir. Los equipos Linux montar√°n las carpetas autom√°ticamente en el arranque. Lo primero que haremos ser√° instalarnos los siguientes paquetes :\nAhora crearemos en la ra√≠z los directorios que vamos a compartir :\nY le cambiaremos el propietario y los permisos a estos directorios :\nDespu√©s de esto, debemos editar el archivo /etc/exports. Este es el archivo donde se indican a NFS las carpetas que vamos a compartir . La primera ser√° solo de lectura y las dos √∫ltimas se podr√°n escribir :\nPara poder acceder a estos recursos en el servidor vamos a instalarlos los siguientes paquetes :\nAhora vamos a crear los directorios donde montaremos nuestras carpetas :\nPara montarlas manualmente en Linux haremos el siguiente comando :\nVamos a comprobar que en proyectos no podremos escribir :\nMientras que en las otras dos si podremos escribir :\nSi queremos acceder a estos recursos en Windows \u0026ndash;\u0026gt; \\192.168.0.1\\documentacion\n\\192.168.0.1\\proyectos (directorio de solo lectura)\n\\192.168.0.1\\programas_y_drivers\nPara poder visualizarlos ser√° necesario tener instalados las siguientes caracter√≠sticas en Windows (Podemos acceder a este programa a trav√©s del buscador de Windows escribiendo caracter√≠sticas de Windows)\nPara finalizar con este punto vamos a configurar que los equipos Linux monten autom√°ticamente al arrancar los directorios . Editaremos el fichero /etc/fstab a√±adiendo las siguientes l√≠neas :\nUna vez hecho esto reiniciamos y veremos que se nos habr√°n montado autom√°ticamente:\nCuotas 11. La carpeta /home del servidor tendr√° un sistema de cuotas para evitar la saturaci√≥n con archivos de los usuarios (100 MB por usuario). Lo primero que haremos ser√° instalar los paquetes para implementar cuotas :\nAhora permitiremos las cuotas en la partici√≥n /home a√±adiendo esto al fstab de nuestro servidor :\nRemontamos la partici√≥n home para que se apliquen estos cambios :\nY aplicamos cuotas en la partici√≥n /home\nComprobaremos que en la ra√≠z de la partici√≥n se nos ha creado dos archivos (aquota.group y aquota.user):\nAhora le aplicaremos la cuota de 100Mb a oliver usando edquota :\nAhora usaremos una herramienta la cual es gawk, el cual nos permitir√° concaten√°ndolo con este comando, aplicarle la cuota que le acabamos de crear a Oliver a todos nuestros usuarios :\nLa orden que acabamos de lanzar ha extra√≠do una lista de todos los usuarios y ha aplicado la cuota de Oliver a todos usuarios con un UID mayor a 499 .\nAhora revisaremos las cuotas para ver como han quedado :\nPara comprobar que funciona vamos a agotar la cuota del usuario proferaul , para ello crearemos un archivo de 30 MB :\nAhora lo moveremos al directorio home de √©l y le haremos propietario del archivo :\nVemos que se actualiza el espacio usado en el directorio del usuario :\nWebmin 12. Instala Webmin en el servidor para tener la posibilidad de gestionarlo gr√°ficamente desde un cliente. Demuestra alguna de sus funcionalidades. Webmin es un panel de control web moderno que le permite administrar su servidor Linux a trav√©s de una interfaz basada en navegador.\nNecesitaremos instalar apache para poder instalar webmin en nuestro servidor :\nAhora deberemos de a√±adir el repositorio de webmin , as√≠ que editaremos el sources.list y lo a√±adiremos :\nGuardamos el archivo y haremos un apt update para actualizar los repositorios , nos saldr√° un error advirti√©ndonos de que el repositorio no es fiable .\nAs√≠ que ahora descargaremos la clave PGP de Webmin y la a√±adiremos a nuestro sistema :\nVolvemos a hacer un apt update y veremos que ahora el repositorio es fiable\nA continuaci√≥n descargaremos el paquete webmin :\nLas √∫ltimas l√≠neas de la instalaci√≥n nos dar√° los datos para acceder v√≠a web a este servicio :\nAs√≠ que en un cliente vamos al navegador y accedemos a esta url :\nNos dir√° que la conexi√≥n no es privada , para saltarnos esta advertencia Configuraci√≥n avanzada \u0026gt; acceder\nTendremos un portal donde deberemos entrar con un usuario administrador de nuestro servidor :\nLo primero que veremos en la interfaz web ser√° un monitor de recursos, as√≠ como datos de nuestro equipo :\nPodremos ver un hist√≥rico del monitor de recursos, el cual nos mostrara las horas y el porcentaje de uso de nuestro hardware, as√≠ como informaci√≥n del sistema :\nTenemos m√°s apartados como el de logins recientes o interfaces de red , el cual nos dar√° informaci√≥n de quien se ha conectado y las configuraciones de las mismas respectivamente :\nPara finalizar con el panel tendremos una √∫ltima ventana la cual nos dir√° el uso del disco y particiones :\nUna vez que hemos echado un vistazo a la p√°gina principal vamos a aprovechar una funcionalidad que tiene que nos permite ver los directorios compartidos por nfs , para acceder aqu√≠ vamos a networking \u0026gt; NFS exports :\nVamos, que adem√°s nos permite editar los directorios compartidos actuales, as√≠ como a√±adir o eliminar estos .\nAdem√°s, esta herramienta nos permite configurar un Firewall con iptables , lo cual hoy d√≠a es de vital importancia disponer de seguridad en nuestra red :\nIncluso dispone de una terminal web para que podamos administrar el servidor desde un cliente , para acceder a esta desplegamos el men√∫ y pulsamos sobre el s√≠mbolo de terminal o pulsamos Alt + K :\nVemos que usara ssh con el usuario conectado en la aplicaci√≥n , en mi caso javiercruces :\nWebmin incluye muchas m√°s funciones de administraci√≥n que nos ayuda a trabajar con el servidor de forma gr√°fica para hacer m√°s ameno la administraci√≥n del mismo ,desde actualizar paquetes hasta configurar un Firewall . Adem√°s, usa https, por lo que nuestro tr√°fico viajara cifrado , lo que nos permitir√≠a configurar nat para poder acceder desde un dispositivo que este fuera de nuestra red , sin que un snifer pueda descifrar nuestro trafico f√°cilmente. Es aconsejable que cambiemos el certificado auto-firmado que usa webmin por uno propio que podemos generar con Let`s encrypt, por ejemplo .\nCUPS 13. Habr√° un servidor de impresi√≥n CUPS, que se administrar√° desde un cliente Ubuntu. Lo primero que deberemos de hacer es instalar en el servidor cups : Una vez hecho esto vamos a configurar el servicio para permitir ser administrado desde nuestro cliente Ubuntu , para ello editamos el siguiente fichero :\nAhora a√±adiremos los siguientes par√°metros :\nListen 192.168.0.1:631 allow 192.168.0.0/24 Para permitir que nuestro cliente Ubuntu sea capaz de administrar el servicio\nAhora solo nos quedar√≠a reiniciar el servicio :\nNos desplazaremos al cliente y en el navegador introduciremos la ip de nuestro servidor seguido de dos puntos y 631 :\nCon esto hemos comprobado que el cliente puede administrar cups .\n14. Configura una impresora en red para todos los usuarios, con l√≠mites de p√°ginas diarias para todos los usuarios. Para compartir nuestra impresora en red , accedemos al panel web y en el apartado de administraci√≥n marcamos compartir impresoras conectadas a este sistema :\nAntes de establecer los l√≠mites vamos a habilitar que el servicio registre el nombre de los usuarios al mandar archivos , para ello en el fichero cupsd.conf cambiamos este valor de default a none :\nAhora reiniciaremos el servicio :\nPara establecer un l√≠mite diario para cada usuarios de 20 p√°ginas por ejemplo , aplicar√≠amos el siguiente comando para nuestra impresora .\nUna vez aplicado este comando los usuarios solo podr√°n imprimir el n√∫mero indicado de p√°ginas ,cuando supere el l√≠mite los trabajos se mandaran a cups , pero este los desechara de la cola y no los imprimir√° :\nEs decir, el trabajo 21 en este ejemplo no se crear√° hasta qu√© pasen 24 horas .\nBibliograf√≠a Como saber que escritorio tengo Montar controlador de dominio samba Configurar la red con netplan Unir cliente linux a dominio parte 1 Unir cliente linux a dominio parte 2 Administrar dominio con RSAT Acceder carpetas compartidas w10 Cuotas Instalaci√≥n y uso de webmin Comandos CUPS ","date":"September 20, 2023","hero":"/images/sistemas/ad_ubuntu/portada.jpeg","permalink":"https://www.javiercd.es/posts/sistemas/ad_ubuntu/ad_ubuntu/","summary":"\u003cp\u003eEn este post, exploraremos c√≥mo configurar un entorno de Active Directory en un servidor Ubuntu utilizando herramientas como Kerberos y Samba. Active Directory es una soluci√≥n integral de Microsoft para la gesti√≥n de identidades y el control de acceso en redes empresariales. A trav√©s de esta gu√≠a, aprenderemos paso a paso c√≥mo implementar un servidor Ubuntu como controlador de dominio, establecer la autenticaci√≥n basada en Kerberos y configurar servicios de directorio mediante Samba.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Active Directory en Ubuntu"},{"categories":null,"contents":"La gesti√≥n eficiente de tareas programadas es esencial para los administradores de sistemas, ya que facilita la ejecuci√≥n autom√°tica de procesos rutinarios. En este contexto, contar con un conjunto s√≥lido de comandos en Linux para programar y controlar tareas se convierte en una herramienta fundamental.\nCommand sleep El comando sleep pausa la ejecuci√≥n en la terminal durante un intervalo de tiempo especificado antes de regresar a la l√≠nea de comandos. Puedes indicar el tiempo en segundos, minutos, horas o d√≠as. Este comando se encuentra en el paquete coreutils.\ns : segundos m : minutos h : horas d : d√≠as Ej: sleep 10m ‚Äì\u0026gt; esperar 10 min\nPor si solo no tiene ninguna utilidad , sin embargo es muy √∫til en Scripts . Aqu√≠ un peque√±o ejemplo :\ndate +\u0026quot;%H:%M:%S\u0026quot;;sleep 5;date +\u0026quot;%H:%M:%S\u0026quot;\nCommand watch La utilidad watch es parte del paquete procps (o procps-ng) que est√° preinstalado en casi todas las distribuciones Gnu/Linux.\nCuando se usa sin argumentos, esta utilidad ejecutar√° el comando especificado cada dos segundos:\nPodemos especificar el tiempo de repetici√≥n utilizando el par√°metro -n , especificando el par√°metro en segundos :\nwatch -n 5 date ‚Äì\u0026gt; Cada 5 segundos\nSi queremos eliminar el encabezado , es decir que nos muestre cada cuanto tiempo se repite , utilizamos el par√°metro -t :\nSi queremos poner un mensaje de error en caso de que el comando no pueda ejecutarse utilizamos el par√°metro -e seguido del mensaje de error :\nwatch -e ‚Äòerror‚Äô\nLa opci√≥n -b de watch emite un pitido cada vez que el comando sale con un c√≥digo de estado distinto de cero.\nwatch -b\nCon el par√°metro -d nos se√±ala los cambios que han ocurrido en la ejecuci√≥n del comando : watch -d\nCommand at Este comando se usa para ejecutar comandos a una determinada hora , principalmente se usa para programar tareas peri√≥dicas como puedes ser , copias de seguridad .\nLos principales par√°metros son :\nV :imprime el n√∫mero de versi√≥n en el error est√°ndar y sale con √©xito.\nm :Enviar correo al usuario cuando el trabajo haya finalizado aunque no haya habido salida. -M: Nunca env√≠a correo al usuario.\nf :archivo Lee el trabajo desde un archivo en lugar de la entrada est√°ndar.\nt :time Ejecuta el trabajo a la hora, dada en el formato [[CC]YY]MMDDhhmm[.ss]\nl :Es un alias para atq.\nr :Es un alias para atrm.\nd: Es un alias para atrm.\nb: Es un alias para batch.\nv: Muestra el tiempo que se ejecutar√° el trabajo antes de leerlo.\nLos tiempos mostrados estar√°n en el formato \u0026ldquo;Thu Feb 20 14:50:00 1997\u0026rdquo;.\nc recoge los trabajos listados en la l√≠nea de comandos en la salida est√°ndar.\nPodemos programar tareas desde la linea de comandos , con echo :\necho \u0026ldquo;sh copia-seguridad.sh\u0026rdquo; | at 10:00 PM\nHa esta tarea se le asignara un numero autom√°ticamente , para listar las tareas que tenemos invocamos el comando at sin ning√∫n par√°metro\nSi queremos borrar una tarea programada , utilizamos el par√°metro -c seguido con el numero de la tarea a eliminar .\nAlgunos ejemplos para programar tareas son :\nDentro de 30 min : at now + 30 minutes 11AM del pr√≥ximo 14 abril : at 11:00 AM April 14 Command crontab El comando crontab se utiliza en sistemas UNIX para programar la ejecuci√≥n de otros comandos, es decir, para automatizar tareas. Podemos ver los crontabs que se est√°n programados y tambi√©n editarlos, l√≥gicamente.\nPara verlos, utilizamos este comando: sudo crontab -l Para editarlos: sudo crontab -e\nLas tareas cron siguen una determinada sintaxis. Tienen 5 asteriscos seguidos del comando a ejecutar. Ahora explicar√© para qu√© sirve cada cosa.\n* * * * * /bin/ejecutar/script.sh\nLos 5 asteriscos , de izquierda a derecha, los asteriscos representan:\nMinutos: de 0 a 59. Horas: de 0 a 23. D√≠a del mes: de 1 a 31. Mes: de 1 a 12. D√≠a de la semana: de 0 a 6, siendo 0 el domingo. Si se deja un asterisco, quiere decir \u0026ldquo;cada\u0026rdquo; minuto, hora, d√≠a de mes, mes o d√≠a de la semana.\nSi queremos que un archivo se ejecute a las 5 de la ma√±ana todos los d√≠as : 0 5 * * * ruta_absoluta_del_script\nPara que se ejecute dos veces al d√≠a a las 6 AM Y a las 6 PM: 0 6,18 * * * ruta_absoluta_del_script\nMuchas veces tenemos palabras reservadas para facilitar el uso de programas o lenguajes de programaci√≥n. Cron no pod√≠a ser menos, as√≠ que tenemos algunas que suelen ser las m√°s comunes. Ya cada uno que lo configure conforme a sus necesidades. Aqu√≠ van:\n@reboot: se ejecuta una √∫nica vez al inicio. @yearly/@annually: ejecutar cada a√±o. @monthly: ejecutar una vez al mes. @weekly: una vez a la semana. @daily/@midnight: una vez al d√≠a. @hourly: cada hora. Tambi√©n debemos conocer los usos de los par√°metros :\ncrontab archivo.cron (establecer√° el archivo.cron como el crontab del usuario)\ncrontab -e (abrir√° el editor preestablecido donde se podr√° crear o editar el archivo crontab) crontab -l (lista el crontab actual del usuario, sus tareas de cron)\ncrontab -r (elimina el crontab actual del usuario)\nCuando hagamos alg√∫n cambio deberemos de reiniciar el servicio para asegurarnos de que nuestros cambios surtan efecto :\nservice crond restart\nEstos comandos nos dar√° la posibilidad de automatizar procesos , haciendo mas c√≥moda y amena la administraci√≥n de nuestros sistemas .\nBibliograf√≠a Command watch Command crontab ","date":"September 20, 2023","hero":"/images/sistemas/programacion_tareas/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/programacion_tareas/programacion_tareas/","summary":"\u003cp\u003eLa gesti√≥n eficiente de tareas programadas es esencial para los administradores de sistemas, ya que facilita la ejecuci√≥n autom√°tica de procesos rutinarios. En este contexto, contar con un conjunto s√≥lido de comandos en Linux para programar y controlar tareas se convierte en una herramienta fundamental.\u003c/p\u003e\n\u003ch2 id=\"command-sleep\"\u003eCommand sleep\u003c/h2\u003e\n\u003cp\u003eEl comando sleep pausa la ejecuci√≥n en la terminal durante un intervalo de tiempo especificado antes de regresar a la l√≠nea de comandos. Puedes indicar el tiempo en segundos, minutos, horas o d√≠as. Este comando se encuentra en el paquete coreutils.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Commands programaci√≥n de tareas en Linux"},{"categories":null,"contents":"Habilita SELinux en un servidor basado en Rocky y aseg√∫rate que los servicios samba y nfs funcionan correctamente con una configuraci√≥n estricta y segura de SELinux. Realiza las pruebas de acceso correspondientes.\nEl escenario consta de dos m√°quinas , nuestro servidor esta basado en Rocky 9 y nuestro cliente es un Debian 12 .\nEn nuestro servidor tendremos activado SELinux en modo enforcing .\n[rocky@rocky-javiercruces ~]$ sestatus SELinux status: enabled SELinuxfs mount: /sys/fs/selinux SELinux root directory: /etc/selinux Loaded policy name: targeted Current mode: enforcing Mode from config file: enforcing Policy MLS status: enabled Policy deny_unknown status: allowed Memory protection checking: actual (secure) Max kernel policy version: 33 Comenzaremos actualizando los paquetes necesarios para configurar samba y nfs :\n[rocky@rocky-javiercruces ~]$ sudo dnf update -y [rocky@rocky-javiercruces ~]$ sudo dnf install samba samba-common samba-client nfs-utils -y Samba Un recurso compartido de samba es esencialmente un directorio que se compartir√° entre los sistemas cliente de la red. Por lo tanto, crearemos un directorio como se muestra. Yo lo hare en el directorio home de mi usuario :\n[rocky@rocky-javiercruces ~]$ mkdir sambashare Le daremos los permisos y la propiedad correspondientes al directorio que acabamos de crear para que sea accesible a trav√©s del servicio :\n[rocky@rocky-javiercruces ~]$ sudo chmod -R 755 /home/rocky/sambashare [rocky@rocky-javiercruces ~]$ sudo chown -R nobody:nobody /home/rocky/sambashare [rocky@rocky-javiercruces ~]$ sudo chcon -t samba_share_t /home/rocky/sambashare Ahora vamos a crear un recurso compartido dentro de la configuraci√≥n de samba , lo a√±adir√© al final del fichero :\n[rocky@rocky-javiercruces ~]$ sudo vim /etc/samba/smb.conf [sambashare] path = /home/rocky/sambashare browsable =yes writable = yes guest ok = yes read only = no Para verificar el archivo de configuraci√≥n, ejecuta el siguiente comando :\n[rocky@rocky-javiercruces ~]$ sudo testparm Con la configuraci√≥n actual podremos acceder al recurso de forma an√≥nima , aunque podemos configurar usuarios samba :\n[rocky@rocky-javiercruces ~]$ sudo smbpasswd -a rocky Luego a√±ade al fichero de configuraci√≥n la linea \u0026ldquo;valid users = usuario\u0026rdquo; al final de cada declaraci√≥n de recurso , te dejo un ejemplo :\n[sambashare] path = /home/rocky/sambashare guest only = no writable = yes force create mode = 0666 force directory mode = 0777 browseable = yes valid users = rocky Ahora vamos a arrancar el servicio :\n[rocky@rocky-javiercruces ~]$ sudo systemctl start smb [rocky@rocky-javiercruces ~]$ sudo systemctl enable smb [rocky@rocky-javiercruces ~]$ sudo systemctl start nmb [rocky@rocky-javiercruces ~]$ sudo systemctl enable nmb Vamos a confirmas que ambos servicios est√°n funcionando :\n[rocky@rocky-javiercruces ~]$ sudo systemctl status smb ‚óè smb.service - Samba SMB Daemon Loaded: loaded (/usr/lib/systemd/system/smb.service; enabled; preset: disabled) Active: active (running) since Mon 2024-02-05 11:21:45 UTC; 1min 50s ago Docs: man:smbd(8) man:samba(7) man:smb.conf(5) Main PID: 49025 (smbd) Status: \u0026#34;smbd: ready to serve connections...\u0026#34; Tasks: 3 (limit: 4340) Memory: 8.6M CPU: 70ms CGroup: /system.slice/smb.service ‚îú‚îÄ49025 /usr/sbin/smbd --foreground --no-process-group ‚îú‚îÄ49027 /usr/sbin/smbd --foreground --no-process-group ‚îî‚îÄ49028 /usr/sbin/smbd --foreground --no-process-group Feb 05 11:21:45 rocky-javiercruces.novalocal systemd[1]: Starting Samba SMB Daemon... Feb 05 11:21:45 rocky-javiercruces.novalocal smbd[49025]: [2024/02/05 11:21:45.649440, 0] ../../source3/smbd/server.c:1746(main) Feb 05 11:21:45 rocky-javiercruces.novalocal smbd[49025]: smbd version 4.18.6 started. Feb 05 11:21:45 rocky-javiercruces.novalocal smbd[49025]: Copyright Andrew Tridgell and the Samba Team 1992-2023 Feb 05 11:21:45 rocky-javiercruces.novalocal systemd[1]: Started Samba SMB Daemon. [rocky@rocky-javiercruces ~]$ sudo systemctl status nmb ‚óè nmb.service - Samba NMB Daemon Loaded: loaded (/usr/lib/systemd/system/nmb.service; enabled; preset: disabled) Active: active (running) since Mon 2024-02-05 11:22:49 UTC; 1min 7s ago Docs: man:nmbd(8) man:samba(7) man:smb.conf(5) Main PID: 49065 (nmbd) Status: \u0026#34;nmbd: ready to serve connections...\u0026#34; Tasks: 1 (limit: 4340) Memory: 2.8M CPU: 48ms CGroup: /system.slice/nmb.service ‚îî‚îÄ49065 /usr/sbin/nmbd --foreground --no-process-group Feb 05 11:22:49 rocky-javiercruces.novalocal nmbd[49065]: [2024/02/05 11:22:49.116367, 0] ../../source3/nmbd/nmbd.c:901(main) Feb 05 11:22:49 rocky-javiercruces.novalocal nmbd[49065]: nmbd version 4.18.6 started. Feb 05 11:22:49 rocky-javiercruces.novalocal nmbd[49065]: Copyright Andrew Tridgell and the Samba Team 1992-2023 Feb 05 11:22:49 rocky-javiercruces.novalocal systemd[1]: Started Samba NMB Daemon. Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: [2024/02/05 11:23:12.157234, 0] ../../source3/nmbd/nmbd_become_lmb.c:398(become_local_master_stage2) Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: ***** Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: Samba name server ROCKY-JAVIERCRUCES is now a local master browser for workgroup SAMBA on subnet 10.0.0.150 Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: Feb 05 11:23:12 rocky-javiercruces.novalocal nmbd[49065]: ***** Los resultados anteriores indican que los servicios se est√°n ejecutando. Ahora habilitemos el protocolo samba en el firewall para permitir que los clientes puedan conectarse :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=samba success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --reload success Ahora en nuestro cliente , nos instalamos el cliente y comprobamos a conectarnos remotamente :\njaviercruces@odin:~$ sudo apt install samba-client -y javiercruces@odin:~$ sudo smbclient //172.22.201.86/sambashare -U rocky Password for [WORKGROUP\\rocky]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Feb 12 09:42:09 2024 .. D 0 Mon Feb 5 11:50:24 2024 fichero_prueba N 0 Mon Feb 12 09:42:09 2024 9286656 blocks of size 1024. 7952516 blocks available smb: \\\u0026gt; Comprobaremos que en ambos extremos tenemos los mismos ficheros :\n[rocky@rocky-javiercruces ~]$ sudo ls -l /home/rocky/sambashare/ total 0 -rwxr-xr-x. 1 nobody nobody 0 Feb 12 09:42 fichero_prueba NFS Nos instalamos el servidor nfs en rocky :\n[rocky@rocky-javiercruces ~]$ sudo dnf install nfs-utils En el cliente debian , en este caso odin nos descargamos \u0026ldquo;el cliente\u0026rdquo;\njaviercruces@odin:~$ sudo apt install nfs-common Creamos el directorio que queremos compartir :\n[rocky@rocky-javiercruces ~]$ sudo mkdir /var/nfs/general -p Le damos los permisos adecuados para que nfs funcione correctamente.\n[rocky@rocky-javiercruces ~]$ sudo chown nobody /var/nfs/general Mostramos la configuraci√≥n actual de los servicios permitidos a trav√©s del firewall usando firewalld :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --list-all | grep services services: cockpit dhcpv6-client samba ssh Como no tenemos permitido nfs , lo permitiremos haciendo uso del servicio :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=nfs success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=mountd success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --add-service=rpc-bind success [rocky@rocky-javiercruces ~]$ sudo firewall-cmd --reload success Volvemos a listar los servicios permitidos y nos aseguramos que este nfs , mountd y rcp-bind :\n[rocky@rocky-javiercruces ~]$ sudo firewall-cmd --permanent --list-all | grep services services: cockpit dhcpv6-client mountd nfs rpc-bind samba ssh Ahora en el cliente elegiremos donde montaremos el directorio compartido , yo creare uno nuevo :\njaviercruces@odin:~$ sudo mkdir -p /nfs/general Y montaremos el nuevo directorio :\njaviercruces@odin:~$ sudo mount 172.22.201.86:/var/nfs/general /nfs/general Comprobamos que se ha montado :\njaviercruces@odin:~$ df -h Filesystem Size Used Avail Use% Mounted on udev 965M 0 965M 0% /dev tmpfs 197M 684K 197M 1% /run /dev/vda1 15G 7.0G 7.1G 50% / tmpfs 984M 0 984M 0% /dev/shm tmpfs 5.0M 0 5.0M 0% /run/lock /dev/vda15 124M 12M 113M 10% /boot/efi tmpfs 197M 0 197M 0% /run/user/1000 172.22.201.86:/var/nfs/general 8.9G 1.3G 7.6G 15% /nfs/general Y comprobamos que en ambos extremos tenemos los mismos ficheros :\n[rocky@rocky-javiercruces ~]$ sudo ls -l /var/nfs/general/ total 0 -rw-r--r--. 1 nobody nobody 0 Feb 12 09:38 fichero_prueba javiercruces@odin:~$ ls -l /nfs/general total 0 -rw-r--r-- 1 nobody nogroup 0 Feb 12 09:38 fichero_prueba ","date":"September 20, 2023","hero":"/images/sistemas/selinux/selinux.jpg","permalink":"https://www.javiercd.es/posts/sistemas/activacion_selinux/activacion_selinux/","summary":"\u003cp\u003eHabilita SELinux en un servidor basado en Rocky y aseg√∫rate que los servicios samba y nfs funcionan correctamente con una configuraci√≥n estricta y segura de SELinux. Realiza las pruebas de acceso correspondientes.\u003c/p\u003e\n\u003cp\u003eEl escenario consta de dos m√°quinas , nuestro servidor esta basado en Rocky 9 y nuestro cliente es un Debian 12 .\u003c/p\u003e\n\u003cp\u003eEn nuestro servidor tendremos activado SELinux en modo enforcing .\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003e[\u003c/span\u003erocky@rocky-javiercruces ~\u003cspan style=\"color:#f92672\"\u003e]\u003c/span\u003e$ sestatus\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELinux status:                 enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELinuxfs mount:                /sys/fs/selinux\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSELinux root directory:         /etc/selinux\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLoaded policy name:             targeted\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eCurrent mode:                   enforcing\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMode from config file:          enforcing\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePolicy MLS status:              enabled\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003ePolicy deny_unknown status:     allowed\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMemory protection checking:     actual \u003cspan style=\"color:#f92672\"\u003e(\u003c/span\u003esecure\u003cspan style=\"color:#f92672\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eMax kernel policy version:      \u003cspan style=\"color:#ae81ff\"\u003e33\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eComenzaremos actualizando los paquetes necesarios para configurar samba y nfs :\u003c/p\u003e","tags":["ASO","REDHAT","ROCKY","CENTOS"],"title":"Configuraci√≥n activaci√≥n de SELinux"},{"categories":null,"contents":"Systemd y System V (SysV) son dos sistemas de inicio utilizados en distribuciones de Linux para gestionar el arranque del sistema y los servicios. System V (SysV) es un sistema de inicio tradicional que utiliza scripts de shell almacenados en diferentes niveles de ejecuci√≥n (runlevels) para iniciar y detener servicios de manera secuencial. Fue ampliamente utilizado en muchas distribuciones de Unix y Linux durante d√©cadas. Por otro lado, systemd es un sistema de inicio m√°s moderno y avanzado que reemplaza a SysV. Introducido para mejorar la velocidad y eficiencia del arranque del sistema, systemd utiliza un enfoque basado en unidades y depende de la paralelizaci√≥n para iniciar servicios simult√°neamente. Adem√°s, incluye caracter√≠sticas adicionales como la gesti√≥n de servicios, sockets, temporizadores, y dependencias, lo que lo convierte en una opci√≥n m√°s robusta y flexible en comparaci√≥n con SysV.\nMigraci√≥n de systemd a systemV Modifica /etc/apt/sources.list para que apunte a los repositorios de Daedalus que es el equivalente de Debian 12 en Devuan.\nroot@ASOjaviercruces:~# nano /etc/apt/sources.list Modifica sources.list para que se parezca al proporcionado. Comenta todas las dem√°s l√≠neas.\nroot@ASOjaviercruces:~# cat /etc/apt/sources.list deb http://deb.devuan.org/merged daedalus main deb http://deb.devuan.org/merged daedalus-updates main deb http://deb.devuan.org/merged daedalus-security main deb http://deb.devuan.org/merged daedalus-backports main Actualiza las listas de paquetes desde los repositorios de Daedalus , permitiendo los or√≠genes inseguros ya que esta firmado los repositorios .\nroot@ASOjaviercruces:~# apt-get update --allow-insecure-repositories Instala el anillo de claves de Devuan para autenticar el repositorio y los paquetes.\nroot@ASOjaviercruces:~# apt-get install devuan-keyring --allow-unauthenticated Actualiza las listas de paquetes nuevamente para autenticar los repositorios y paquetes.\nroot@ASOjaviercruces:~# apt-get update Actualiza los paquetes instalados a las versiones m√°s recientes. Ten en cuenta que esto no completa la migraci√≥n a system-v.\nroot@ASOjaviercruces:~# apt-get upgrade (ten cuidado de NO usar dist-upgrade aqu√≠) Instalamos los paquetes eudev y sysvinit-core para gestionar eficientemente la detecci√≥n y configuraci√≥n de dispositivos a trav√©s de eudev, mientras que sysvinit-core se encarga del control del sistema de inicio y procesos .\nroot@ASOjaviercruces:~# apt-get install eudev sysvinit-core Es posible que el √∫ltimo comando cause roturas de paquetes, pero se resolver√°n como parte del proceso de migraci√≥n.\nroot@ASOjaviercruces:~# apt-get -f install Se requiere un reinicio para cambiar aplicar el cambio de systemd a systemV.\nroot@ASOjaviercruces:~# reboot Actualizaremos la distribuci√≥n para que los paquetes pasen de utilizar systemd a systemV.\nroot@ASOjaviercruces:~# apt-get dist-upgrade Una vez completada la migraci√≥n a Devuan, elimina los paquetes relacionados con systemd.\nroot@ASOjaviercruces:~# apt-get purge systemd libnss-systemd Elimina cualquier paquete hu√©rfano generado por el proceso de migraci√≥n y cualquier archivo de cach√© no utilizable.\nroot@ASOjaviercruces:~# apt-get autoremove --purge root@ASOjaviercruces:~# apt-get autoclean Comprobaci√≥n y uso de systemV Comprueba que el proceso 1 es init , esto significa que el sistema ha arrancado haciendo uso de systemV :\nroot@ASOjaviercruces:~# ps -s1 PID TTY TIME CMD 1 ? 00:00:00 init Me instalare un servicio que deber√≠a de depender de systemd pero como hemos cambiado a systemv , no lo usara ya que ahora usamos los repositorios de Devuan :\ndebian@ASOjaviercruces:~$ sudo apt install apache2 -y Entonces para manejar el servicio lo haremos a partir del directorio /etc/init.d/ y buscando el \u0026ldquo;servicio\u0026rdquo; de cada demonio :\n# Para iniciar el servicio debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 start Starting Apache httpd web server: apache2. # Para parar el servicio debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 stop Stopping Apache httpd web server: apache2. # Para reiniciar el servicio debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 restart Restarting Apache httpd web server: apache2AH00558: apache2: Could not reliably determine the server\u0026#39;s fully qualified domain name, using 192.168.122.208. Set the \u0026#39;ServerName\u0026#39; directive globally to suppress this message . # Para ver el estado debian@ASOjaviercruces:~$ sudo /etc/init.d/apache2 status apache2 is running. ","date":"September 20, 2023","hero":"/images/sistemas/eliminar_systemd/eliminar_systemd.jpg","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/eliminacion_systemd/eliminacion_systemd/","summary":"\u003cp\u003eSystemd y System V (SysV) son dos sistemas de inicio utilizados en distribuciones de Linux para gestionar el arranque del sistema y los servicios. System V (SysV) es un sistema de inicio tradicional que utiliza scripts de shell almacenados en diferentes niveles de ejecuci√≥n (runlevels) para iniciar y detener servicios de manera secuencial. Fue ampliamente utilizado en muchas distribuciones de Unix y Linux durante d√©cadas. Por otro lado, systemd es un sistema de inicio m√°s moderno y avanzado que reemplaza a SysV. Introducido para mejorar la velocidad y eficiencia del arranque del sistema, systemd utiliza un enfoque basado en unidades y depende de la paralelizaci√≥n para iniciar servicios simult√°neamente. Adem√°s, incluye caracter√≠sticas adicionales como la gesti√≥n de servicios, sockets, temporizadores, y dependencias, lo que lo convierte en una opci√≥n m√°s robusta y flexible en comparaci√≥n con SysV.\u003c/p\u003e","tags":["ASO","DEBIAN"],"title":"Eliminaci√≥n de systemd"},{"categories":null,"contents":"Samba es una implementaci√≥n libre y de c√≥digo abierto del protocolo Server Message Block (SMB), que se utiliza para compartir archivos e impresoras en redes de computadoras. El protocolo SMB es un protocolo de red que permite que los sistemas operativos Windows se comuniquen con otros dispositivos de red, como servidores de archivos, impresoras y otros recursos compartidos.\nSamba facilita la interoperabilidad entre sistemas Windows y sistemas operativos basados en Unix/Linux al permitir que los sistemas Unix compartan archivos y recursos con sistemas Windows utilizando el protocolo SMB/CIFS. Esto significa que un servidor Samba puede actuar como un servidor de archivos para clientes Windows, permiti√©ndoles acceder y compartir archivos como si estuvieran en un entorno Windows.\n1.Instalaci√≥n Lo primero sera instalarnos el servidor samba :\nEn el fichero /etc/samba/smb.conf realizaremos la configuraci√≥n de nuestra carpeta :\nNos crearemos un usuario de samba para poder acceder a los recursos :\nReiniciaremos el servicio para que se aplique la configuraci√≥n :\n2.Acceso desde Windows Ahora podemos acceder desde un cliente Windows con el usuario que acabamos de crear -‚Äì\u0026gt; \\IP\\DIRECTORIO\\COMPARTIDO\nNos pedir√° que nos autentiquemos :\nPodremos ver el contenido y crear :\n3.Acceso desde Linux Nos instalamos el paquete smbclient para poder conectarnos a unidades compartidas con samba:\nListar los directorios compartidos :\nNos conectamos al recurso compartido\nCreare un directorio y comprobare que existe :\nBibliograf√≠a -Habilitar el acceso de invitado\n","date":"September 20, 2023","hero":"/images/sistemas/samba_debian/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/samba_debian/samba_debian/","summary":"\u003cp\u003eSamba es una implementaci√≥n libre y de c√≥digo abierto del protocolo Server Message Block (SMB), que se utiliza para compartir archivos e impresoras en redes de computadoras. El protocolo SMB es un protocolo de red que permite que los sistemas operativos Windows se comuniquen con otros dispositivos de red, como servidores de archivos, impresoras y otros recursos compartidos.\u003c/p\u003e\n\u003cp\u003eSamba facilita la interoperabilidad entre sistemas Windows y sistemas operativos basados en Unix/Linux al permitir que los sistemas Unix compartan archivos y recursos con sistemas Windows utilizando el protocolo SMB/CIFS. Esto significa que un servidor Samba puede actuar como un servidor de archivos para clientes Windows, permiti√©ndoles acceder y compartir archivos como si estuvieran en un entorno Windows.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Instalar y configurar samba en Debian"},{"categories":null,"contents":"Paso 1 Instalar systemd-journal-remote En nuestro entorno, el primer paso consistir√° en instalar el paquete systemd-journal-remote, que nos permitir√° acceder a estas m√°quinas de forma remota. Para llevar a cabo la instalaci√≥n en las m√°quinas de nuestro escenario, utilizaremos el gestor de paquetes apt en Odin, que ejecuta Debian 12. Asimismo, instalaremos el mismo paquete en Thor y Loki, que son contenedores alojados dentro de Odin. En cuanto a Hela, un sistema operativo Rocky, requerir√° el uso de dnf para la instalaci√≥n.\njaviercruces@odin:~$ sudo apt install systemd-journal-remote -y javiercruces@thor:~$ sudo apt install systemd-journal-remote -y javiercruces@loki:~$ sudo apt install systemd-journal-remote -y [javiercruces@hela ~]$ sudo dnf install systemd-journal-remote -y En el servidor, habilita y activa los dos componentes de systemd necesarios para recibir mensajes de registro con el siguiente comando:\njaviercruces@odin:~$ sudo systemctl enable --now systemd-journal-remote.socket javiercruces@odin:~$ sudo systemctl enable systemd-journal-remote.service En el cliente, habilita el componente que systemd utiliza para enviar los mensajes de registro al servidor:\n[javiercruces@hela ~]$ sudo systemctl enable systemd-journal-upload.service A continuaci√≥n, en el servidor, abre los puertos 19532 y 80 en el firewall . Esto permitir√° al servidor recibir los mensajes de registro del cliente. El puerto 80 es el puerto que certbot utilizar√° para generar el certificado TLS. En nuestro caso no hay ningun cortafuegos asi que no sera necesario .\nPaso 2: Generaci√≥n de claves y certificados Dado que utilizaremos el servicio con cifrado para garantizar que nadie pueda acceder a nuestros registros, proceder√© a generar los certificados mediante OpenSSL.\nPodemos generar los certificados manualmente, pero existe una herramienta llamada Easy RSA que automatiza este proceso. Yo generare en Odin todos los certificados de las maquinas y posteriormente los llevare a las maquinas correspondientes .\njaviercruces@odin:~$ sudo apt install easy-rsa openssl -y Esta utilidad trae un fichero de ejemplo para que nos sea mas facil generar los certificados , dentro de este cambiaremos los siguientes valores :\njaviercruces@odin:/usr/share/easy-rsa$ sudo cp vars.example vars javiercruces@odin:/usr/share/easy-rsa$ sudo nano vars set_var EASYRSA_REQ_COUNTRY \u0026#34;ES\u0026#34; set_var EASYRSA_REQ_PROVINCE \u0026#34;Sevilla\u0026#34; set_var EASYRSA_REQ_CITY \u0026#34;Dos Hermanas\u0026#34; set_var EASYRSA_REQ_ORG \u0026#34;iesgn\u0026#34; set_var EASYRSA_REQ_EMAIL \u0026#34;contacto@javiercd.es\u0026#34; set_var EASYRSA_REQ_OU \u0026#34;Informatica\u0026#34; Vamos a crear la estructura de directorios y archivos necesarios para comenzar a trabajar con EasyRSA :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa init-pki * Notice: init-pki complete; you may now create a CA or requests. Your newly created PKI dir is: * /usr/share/easy-rsa/pki Vamos a construir nuestra CA :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa build-ca nopass ----- Common Name (eg: your user, host, or server name) [Easy-RSA CA]:odin.javiercd.gonzalonazareno.org * Notice: CA creation complete and you may now import and sign cert requests. Your new CA certificate file for publishing is at: /usr/share/easy-rsa/pki/ca.crt Vamos a generar la clave privada de thor y generaremos a la vez una solicitud de firma del certificado :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req thor nopass ----- Common Name (eg: your user, host, or server name) [thor]:thor.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/thor.req key: /usr/share/easy-rsa/pki/private/thor.key Vamos a generar la clave privada de loki y generaremos a la vez una solicitud de firma del certificado :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req loki nopass ----- Common Name (eg: your user, host, or server name) [loki]:loki.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/loki.req key: /usr/share/easy-rsa/pki/private/loki.key Haremos lo mismo con odin :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req odin nopass ---- Common Name (eg: your user, host, or server name) [odin]:odin.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/odin.req key: /usr/share/easy-rsa/pki/private/odin.key Haremos lo mismo con hela :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa gen-req hela nopass ---- Common Name (eg: your user, host, or server name) [odin]:hela.javiercd.gonzalonazareno.org * Notice: Keypair and certificate request completed. Your files are: req: /usr/share/easy-rsa/pki/reqs/hela.req key: /usr/share/easy-rsa/pki/private/hela.key Una vez generado las claves privadas y las peticiones de firma de los certificados toca firmarlos , para no hacerlo repetitivo mostrare la firma de odin , los dem√°s se hacen de la misma forma :\njaviercruces@odin:/usr/share/easy-rsa$ sudo ./easyrsa sign-req server odin * Notice: Using Easy-RSA configuration from: /usr/share/easy-rsa/vars * WARNING: Move your vars file to your PKI folder, where it is safe! * Notice: Using SSL: openssl OpenSSL 3.0.11 19 Sep 2023 (Library: OpenSSL 3.0.11 19 Sep 2023) You are about to sign the following certificate. Please check over the details shown below for accuracy. Note that this request has not been cryptographically verified. Please be sure it came from a trusted source or that you have verified the request checksum with the sender. Request subject, to be signed as a server certificate for 825 days: subject= commonName = odin.javiercd.gonzalonazareno.org Type the word \u0026#39;yes\u0026#39; to continue, or any other input to abort. Confirm request details: yes Using configuration from /usr/share/easy-rsa/pki/06312595/temp.f57dfbc5 Check that the request matches the signature Signature ok The Subject\u0026#39;s Distinguished Name is as follows commonName :ASN.1 12:\u0026#39;odin.javiercd.gonzalonazareno.org\u0026#39; Certificate is to be certified until May 5 18:34:45 2026 GMT (825 days) Write out database with 1 new entries Database updated * Notice: Certificate created at: /usr/share/easy-rsa/pki/issued/odin.crt Llevar los certificados a las maquinas correspondientes Ahora tendremos que hacerle llegar a las distintas maquinas haciendo uso de ssh . Para cada uno de ellos nos llevaremos el certificado firmado que los hemos generado en /usr/share/easy-rsa/pki/issued/ y su clave privada que esta en /usr/share/easy-rsa/pki/private/ .\nAdemas para los clientes tendremos que hacerle llegar el certificado de la CA , que esta en /usr/share/easy-rsa/pki/ca.crt\nUna vez que tengamos los ficheros en las maquinas correspondientes , lo tendremos que almacenar con los siguientes permisos :\n# Cliente hela [javiercruces@hela ~]$ sudo ls -l /etc/letsencrypt/live/hela.javiercd.es/ total 60 -rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1294 Jan 31 18:59 ca.crt -rw-r-----. 1 systemd-journal-upload systemd-journal-upload 4841 Jan 25 11:17 hela.crt -rw-r-----. 1 systemd-journal-upload systemd-journal-upload 1704 Jan 25 11:17 hela.key # Servidor Odin javiercruces@odin:~$ sudo ls -l /etc/letsencrypt/live/javiercd.es/ total 20 -rw-r--r-- 1 root systemd-journal-remote 7840 Jan 31 18:39 combined.pem -rw-r----- 1 root systemd-journal-remote 4841 Jan 31 18:35 odin.crt -rw-r----- 1 root systemd-journal-remote 1704 Jan 31 18:35 odin.key Como habr√°s notado en odin hay un fichero llamado combined.pem , para conseguir este tendr√°s que concatenar tu certificado con tu clave privada en un solo archivo\njaviercruces@odin:~$ sudo cat /etc/letsencrypt/live/javiercd.es/odin.crt /etc/letsencrypt/live/javiercd.es/odin.key \u0026gt; /etc/letsencrypt/live/javiercd.es/combined.pem *Aunque he utilizado el directorio donde se guardan los certificados de Let\u0026rsquo;s Encrypt , no he podido usarlo ya que no tenemos el control del dominio gonzalonazareno.org . Por eso los he generado manualmente anteriormente . Puntualizar que el directorio donde guardes estos no importa siempre y cuando tengan los permisos correctos .\nPaso 3 : Configurar el servidor Ya solo nos quedar√≠a indicar la configuraci√≥n del servicio , solo tendr√≠as que cambiar las rutas correspondientes a tus ficheros :\njaviercruces@odin:~$ sudo cat /etc/systemd/journal-remote.conf [Remote] Seal=false SplitMode=host ServerKeyFile=/etc/letsencrypt/live/javiercd.es/odin.key ServerCertificateFile=/etc/letsencrypt/live/javiercd.es/odin.crt TrustedCertificateFile=/etc/letsencrypt/live/javiercd.es/combined.pem Una vez configurado reiniciamos el servicio y comprobamos que este levantado :\njaviercruces@odin:~$ sudo systemctl restart systemd-journal-remote.service javiercruces@odin:~$ sudo systemctl status systemd-journal-remote.service ‚óè systemd-journal-remote.service - Journal Remote Sink Service Loaded: loaded (/lib/systemd/system/systemd-journal-remote.service; indirect; preset: disabled) Active: active (running) since Wed 2024-01-31 18:46:25 UTC; 49min ago TriggeredBy: ‚óè systemd-journal-remote.socket Docs: man:systemd-journal-remote(8) man:journal-remote.conf(5) Main PID: 4623 (systemd-journal) Status: \u0026#34;Processing requests...\u0026#34; Tasks: 1 (limit: 2313) Memory: 7.9M CPU: 238ms CGroup: /system.slice/systemd-journal-remote.service ‚îî‚îÄ4623 /lib/systemd/systemd-journal-remote --listen-https=-3 --output=/var/log/journal/remote/ Paso 4 : Configurar el cliente A√±adiremos los ficheros correspondientes a la configuraci√≥n , tu clave privada y tu certificado correspondiente as√≠ como el certificado de la CA con el que hayas generado estos :\n[javiercruces@hela ~]$ sudo cat /etc/systemd/journal-upload.conf [Upload] URL=https://odin.javiercd.gonzalonazareno.org/ ServerKeyFile=/etc/letsencrypt/live/hela.javiercd.es/odin.key ServerCertificateFile=/etc/letsencrypt/live/hela.javiercd.es/odin.crt TrustedCertificateFile=/etc/letsencrypt/live/hela.javiercd.es/ca.crt Reiniciamos el servicio y comprobamos el estado del mismo :\n[javiercruces@hela ~]$ sudo systemctl restart systemd-journal-upload.service [javiercruces@hela ~]$ sudo systemctl status systemd-journal-upload.service ‚óè systemd-journal-upload.service - Journal Remote Upload Service Loaded: loaded (/usr/lib/systemd/system/systemd-journal-upload.service; enabled; preset: disabled) Active: active (running) since Wed 2024-01-31 19:38:53 UTC; 2s ago Docs: man:systemd-journal-upload(8) Main PID: 4628 (systemd-journal) Status: \u0026#34;Processing input...\u0026#34; Tasks: 1 (limit: 10840) Memory: 4.1M CPU: 53ms CGroup: /system.slice/systemd-journal-upload.service ‚îî‚îÄ4628 /usr/lib/systemd/systemd-journal-upload --save-state Jan 31 19:38:53 hela.javiercd.gonzalonazareno.org systemd[1]: Started Journal Remote Upload Service. Paso 5 : Comprobaci√≥n de funcionamiento Una vez est√©n los dos servicios levantados , se nos guardaran en el servidor un fichero con los logs de nuestro cliente :\njaviercruces@odin:~$ sudo ls -la /var/log/journal/remote/ total 8204 drwxr-xr-x 2 systemd-journal-remote systemd-journal-remote 4096 Jan 31 18:59 . drwxr-sr-x+ 4 root systemd-journal 4096 Jan 24 13:01 .. -rw-r----- 1 systemd-journal-remote systemd-journal-remote 8388608 Jan 31 19:38 remote-172.16.0.200.journal Podemos ver los logs de los diferentes servicios , por ejemplo filtrare por httpd :\njaviercruces@odin:~$ sudo journalctl -u httpd --file=/var/log/journal/remote/remote-172.16.0.200.journal Jan 30 08:32:30 hela.javiercd.gonzalonazareno.org systemd[1]: Starting The Apache HTTP Server... Jan 30 08:32:31 hela.javiercd.gonzalonazareno.org httpd[775]: [Tue Jan 30 08:32:31.395719 2024] [so:warn] [pid 775:tid 775] AH01574: module rewrite_module is already loaded, skipping Jan 30 08:32:31 hela.javiercd.gonzalonazareno.org httpd[775]: Server configured, listening on: port 80 Jan 30 08:32:31 hela.javiercd.gonzalonazareno.org systemd[1]: Started The Apache HTTP Server. ","date":"September 20, 2023","hero":"/images/sistemas/recoleccion_logs_journald/journal.jpg","permalink":"https://www.javiercd.es/posts/sistemas/recoleccion_logs_journald/recoleccion_logs_journald/","summary":"\u003ch2 id=\"paso-1-instalar-systemd-journal-remote\"\u003ePaso 1 Instalar systemd-journal-remote\u003c/h2\u003e\n\u003cp\u003eEn nuestro entorno, el primer paso consistir√° en instalar el paquete systemd-journal-remote, que nos permitir√° acceder a estas m√°quinas de forma remota. Para llevar a cabo la instalaci√≥n en las m√°quinas de nuestro escenario, utilizaremos el gestor de paquetes apt en Odin, que ejecuta Debian 12. Asimismo, instalaremos el mismo paquete en Thor y Loki, que son contenedores alojados dentro de Odin. En cuanto a Hela, un sistema operativo Rocky, requerir√° el uso de dnf para la instalaci√≥n.\u003c/p\u003e","tags":["ASO","DEBIAN"],"title":"Recolecci√≥n centralizada de logs de sistema, mediante journald"},{"categories":null,"contents":"Documento en el cual se detallan los principales comandos a la hora de detectar incidencias en redes y lograr solucionarlos .\nComandos en Windows Explica el significado de los distintos par√°metros a configurar en las Propiedades de TCP/IP en Windows Tenemos que tener en cuenta que cada configuraci√≥n que hagamos es independiente para cada uno de nuestros adaptadores de red .\nPara acceder a configurar estos par√°metros seguiremos la siguiente ruta en nuestro sistema :\nPanel de control \u0026gt;Redes e Internet \u0026gt; Centro de redes y recursos compartidos \u0026gt; Cambiar configuraci√≥n del adaptador :\nUna vez aqu√≠ le daremos Clic derecho \u0026gt; Propiedades \u0026gt; Protocolo de version 4 (TCP/IP)\nUna vez aqu√≠ veremos dos pesta√±as a la cual podemos dirigirnos para configurar nuestra tarjeta , en la pesta√±a general podemos observar los siguiente apartados :\nEl primer apartado (General) relacionado con nuestra direcci√≥n ip :\nObtener una direcci√≥n ip autom√°ticamente : Marcaremos esta opci√≥n cuando queramos que se use el servicio DHCP para asignar mediante el servicio direcci√≥n IP , mascara de subred y la puerta de enlace predeterminada . Usar la siguiente direcci√≥n IP : Aqu√≠ introduciremos nosotros manualmente la configuraci√≥n de red deseada : Direcci√≥n IP: es una etiqueta num√©rica que identifica a nuestra maquina de manera √∫nica en nuestra red , no puede estar repetida . Mascara de subred : conjunto num√©rico cuya funci√≥n es indicar a los dispositivos qu√© parte de la direcci√≥n IP es el n√∫mero de la red incluyendo la subred, y qu√© parte es la correspondiente al host. Puerta de enlace predeterminada : Es la direcci√≥n ip predeterminada que se le asigna a un equipo para enviar los paquetes a otras redes . En el segundo apartado de esta pesta√±a realizaremos la configuraci√≥n referente a los servidores DNS los cuales permitir√°n traducirnos nombres a direcciones IP para poder navegar .\nObtener la direcci√≥n del servidor DNS autom√°ticamente : Esta opci√≥n har√° que la direcci√≥n se obtenga del servidor DHCP que tengamos configurado en nuestra red . Usar la siguientes direcciones del servidor DNS : Esta opci√≥n nos sirve para manualmente seleccionar la direcci√≥n ip de nuestros servidores DNS: Servidor DNS preferido : La direcci√≥n que pongamos aqu√≠ sera la primera en consultar en caso de que necesite hacer una resoluci√≥n Servidor DNS alternativo : Si el servidor primario fallase o estuviera ca√≠do en ese momento pasar√≠amos a utilizar el secundario . En la pesta√±a configuraci√≥n alternativa , esta pensado para equipos que necesiten usarse en mas de una red , suele verse en entornos profesionales :\nDirecci√≥n ip privada autom√°tica : Har√° uso del servidor DHCP para configurarse . Configurada por el usuario : Nos permitir√° introducirla manualmente la configuraci√≥n (omitir√© los campos explicados anteriormente ) : WINS preferido : es un servidor de nombres de Microsoft para NetBIOS, que mantiene una tabla con la correspondencia entre direcciones IP y nombres NetBIOS de ordenadores . WINS alternativo : Si el servidor primario fallase o estuviera ca√≠do en ese momento pasar√≠amos a utilizar el secundario . Utilidad del comando ping Ping es un comando o una herramienta de diagn√≥stico que permite hacer una verificaci√≥n del estado de una determinada conexi√≥n de un host local con al menos un equipo remoto contemplado en una red de tipo TCP/IP , es la herramienta de diagnostico de redes mas conocida .\nLos usos mas comunes de esta herramienta son :\nComprobar la conectividad de una red. Medir la latencia que tardan en comunicarse dos puntos . Conocer la direcci√≥n IP utilizada por un nombre de dominio. Scripts que permiten llevar un registro de la disponibilidad de un servidor remoto. Scripts que permiten conocer cuando existe conexi√≥n en un equipo. Para hacer uso de este abriremos una cmd , pulsaremos WIN + R y escribiremos cmd .\nUso general de Ping La sintaxis mas simple de ping es la siguiente : ping [Par√°metros] [IP/Nombre]\nSi nos fijamos en la salida del comando vemos que nos permite conoces :\nDirecci√≥n IP que corresponde al nombre de la m√°quina remota. El n√∫mero de secuencia ICMP (‚ÄúC√≥digo que nos devuelve , ej : 0=red inaccesible‚Äù). TTL: Tiempo de vida en segundos; como este valor se decrementa en cada m√°quina en la cual es procesado, debe ser al menos igual o mayor que el n√∫mero de saltos que dar√° .Si alguna vez este n√∫mero es cero, el router interpretar√° que el paquete est√° viajando en c√≠rculos, por lo tanto, finaliza el proceso. **Latencia :**corresponde al lapso de tiempo en milisegundos que se necesita para dar una vuelta entre las m√°quinas fuente y destino. Como regla general, la demora de un paquete no debe ser mayor a 200 ms. Estad√≠sticas del ping : Nos re√∫ne toda la informaci√≥n mostr√°ndonos los paquetes perdidos , enviados y recibidos . Adem√°s nos muestra el paquete con menor latencia y con mayor as√≠ como una media aritm√©tica . PING -T Este par√°metro nos permitir√° hacer un ping infinito es decir no finalizara hasta que matemos el proceso , si no lo pusi√©semos por defecto solo se enviaran 4 trazas . Para finalizar este la ejecuci√≥n de este comando pulsaremos CTRL + C .\nCuando detengamos la ejecuci√≥n nos mostrara las estad√≠sticas que ha recopilado , paquetes enviados, paquetes recibidos y paquetes perdidos as√≠ como los tiempos medios de ida y vuelta .\nPING -A Este par√°metro sirve para que nos resuelva una ip en un nombre de host ,imprimiendo una linea indicando el nombre de host al cual le estamos dirigiendo las trazas , lo que nos permite identificar mas f√°cilmente las maquinas :\nPING -N Este par√°metro sirve para especificar el numero de solicitudes echo que deseemos al enviar paquetes , este lo indicaremos con un numero comprendido entre 1 ‚Äì 4294967295 .\nPor ejemplo si queremos enviar 10 trazas el comando seria el siguiente :\nPodemos comprobar en la parte inferior que ha enviado en numero que le hemos indicado .\nPING -L Nos permite modificar el tama√±o en bytes de los paquetes enviados , deberemos especificar un numero entre 0 y 65000 .\nPING -F Este par√°metro sirve para evitar que los paquetes se fragmenten , el tama√±o m√°ximo de los paquetes sin fragmentar es de 1472 bytes .\nPodemos ver que si superamos este numero , nos dar√° un error inform√°ndonos que es necesario fragmentar el paquete :\nPING -I Este par√°metro nos permite especificar el numero m√°ximo que se pueden dar hasta alcanzar al destino , el valor m√°ximo que podemos introducir 255 .\nCuando especificamos un TTL esto fija el n√∫mero m√°ximo de saltos, al pasar por un nuevo dispositivo (un router) este descuenta 1 al TTL especificando hasta que llega a 0, en este caso el destino se mostrar√° como inalcanzable, de esta forma se evita que un paquete viaje por la red indefinidamente buscando un destino que puede que no exista.\nPING -4 -6 Ping -4 : Fuerza la respuesta del host especificado con una direcci√≥n IPv4. Es necesario que tanto el equipo que lanza el ping como el destino tengan una configuraci√≥n IPv4 correcta.\nPing -6 : Fuerza la respuesta del host especificado con una direcci√≥n IPv6. Es necesario que tanto el equipo que lanza el ping como el destino tengan una configuraci√≥n IPv6 correcta.\nComprobar conectividad en una red Vamos a efectuar una serie de pruebas para verificar el funcionamiento y encontrar errores . Lo primero sera hacernos ping a nosotros mismos para ello :\nSi la salida es correcta esto demuestra que nuestro adaptador de red funciona correctamente .\nVamos a hacerle ping a una maquina de nuestra red local , as√≠ demostraremos que las conexiones f√≠sicas son correctas :\nVamos a hacerle ping a la puerta de enlace , de tener √©xito demuestra que existe conexi√≥n con el equipo que suministra internet :\nHaremos ping a un sitio de internet usando ip , para comprobar que tenemos conexi√≥n a internet :\nPor ultimo hacer ping a un dominio en internet ,de tener √©xito demuestra que existe conexi√≥n a internet y los servidores DNS configurados en la conexi√≥n funcionan correctamente:\nUso general del comando ipconfig Este comando se usa para ver la configuraci√≥n actual de los adaptadores de red de nuestro equipo , un ejemplo de uso general del comando es el siguiente :\nEste nos muestra la siguiente informaci√≥n :\nDescripci√≥n del adaptador : Nombre del adaptador o tarjeta de red utilizado en la conexi√≥n. Direcci√≥n IPV4: Es la direcci√≥n IP asignada al equipo en la red local. Puerta de enlace predeterminada: Es la direcci√≥n IP del equipo proporciona acceso a internet. Servidores DNS: Direcci√≥n ip del encargado de resolver nombre de dominio a direcci√≥n IP de las paginas solicitadas. Generalmente son dos, el principal y el secundario. Estado de DHCP: Configuraci√≥n din√°mica de host, en el caso del equipo mostrado se encuentra habilitada, eso significa que siempre se utilizar√° una direcci√≥n IP asignada por este servicio . A partir de estos par√°metros podemos consultar la informaci√≥n del adaptador o identificar una incoherencia en la configuraci√≥n del mismo .\nIPCONFIG /ALL Nos devolver√° toda la informaci√≥n disponible de los adaptadores de red , es una salida mas detallada que si omitimos este par√°metro , con este podemos consultar los servidores DNS y las direcciones MAC .\nIPCONFIG /RELEASE Se utiliza para liberar una direcci√≥n ip en el servicio DHCP , no se nos volver√° a asignar una hasta que ejecutemos ipconfig /renew\nPodemos especificar el adaptador del cual queremos que se libere la ip escribi√©ndolo a continuaci√≥n, si omitimos el nombre los aplicara a todos .\nEJ: ipconfig /release Ethernet0 ‚Äì\u0026gt; Solo liberara la ip del adaptador Ethernet0 *****Si queremos liberar una direcci√≥n ipv6 utilizaremos el par√°metro /release6\nIPCONFIG /RENEW Una vez ejecutado el comando anterior deberemos de ejecutar este para solicitar al servidor DHCP una nueva concesi√≥n de direcci√≥n IP .\nPodemos especificar el adaptador del cual queremos que se renueve la oferta DHCP escribi√©ndolo a continuaci√≥n.\nEJ: ipconfig /renew Ethernet0 ‚Äì\u0026gt; Solo renovara la concesi√≥n del adaptador Ethernet0 *****Si queremos renovar una direcci√≥n ipv6 utilizaremos el par√°metro /renew6\nIPCONFIG /FLUSHDNS Se utiliza para vaciar la cache de resoluci√≥n DNS de nuestro equipo local , suele utilizarse cuando queremos comprobar el correcto funcionamiento del servidor DNS .\nIPCONFIG /REGISTERDNS Actualiza todas las concesiones DHCP y vuelve a registrar los nombres DNS. Este comando esta orientado al trabajo en entornos de dominio y a la actualizaci√≥n de los registros din√°micos del servidor de DNS del sistema en el que se esta ejecutando, teniendo en cuenta que si esta bloqueada de alguna forma la actualizaci√≥n din√°mica no se efectuar√°.\nIPCONFIG /DISPLAYDNS Este comando simplemente nos muestra las consultas DNS que se est√°n almacenados en la cach√© de nuestro sistema de la forma que se muestran en la imagen, muestran datos de registros del protocolo IPv4 como de IPv6.\nIPCONFIG /SHOWCLASSID Este comando nos permite comprobar las clases de usuario configuradas en nuestro servidor DHCP y que estar√°n disponibles para los diferentes clientes.\n*Si queremos comprobarlo para IPV6 utilizaremos el par√°metro /showclassid6 .\nUso general ARP El comando arp muestra y modifica las tablas de conversi√≥n de direcciones IP en direcciones\nMAC que utiliza el protocolo de resoluci√≥n de direcciones (ARP).\nARP -A Pide los datos de protocolo actuales y muestra las entradas ARP actuales. Si se especifica inet_addr, solo se muestran las direcciones IP y f√≠sica del equipo especificado. Si existe m√°s de una interfaz de red que utilice ARP, se muestran las entradas de cada tabla ARP.\n* La opci√≥n -g hace la misma funci√≥n :\nComo se muestra en la captura de pantalla el comando arp ‚Äìa enumera todos los dispositivos que se encuentran actualmente en la cach√© ARP del host, lo cual incluye la direcci√≥n IPv4, la direcci√≥n f√≠sica y el tipo de direccionamiento (est√°tico/din√°mico) para cada dispositivo.\nSi queremos borrar la cache arp utilizaremos la opci√≥n -d seguida del comod√≠n * para borrar todas las entradas en esta tabla , si solo quisi√©ramos eliminar una consulta pondr√≠amos la direcci√≥n IP .\nPodemos solicitar la MAC de una direcci√≥n usando arp + IP del dispositivo y posteriormente verla en nuestra tabla con arp -a .\nUso general netstat El comando netstat genera visualizaciones que muestran el estado de la red y estad√≠sticas de protocolo. El estado de los protocolos TCP, SCTP y los puntos finales de UDP puede visualizarse en formato de tabla. Tambi√©n puede visualizarse informaci√≥n sobre la tabla de enrutamiento e informaci√≥n de interfaces.\nNETSTAT -A Muestra las todas conexiones y puertos de escucha de nuestro equipo , as√≠ como el estado del puerto y la direcci√≥n remota la cual esta usando el mismo :\nNETSTAT -B Muestra el archivo ejecutable implicado en la creaci√≥n de cada conexi√≥n o puerto de escucha.\nNETSTAT -E Nos muestra estad√≠sticas sobre las interfaces de red , sirve para ver la actividad que ha tenido esta:\nNETSTAT -R Nos muestra la tabla de enrutamiento , as√≠ podemos ver los sitios a los cual nuestro equipo es capaz de llegar a trav√©s de la red :\nNETSTAT -N Nos muestra las conexiones activas con un formato de tabla , similar al par√°metro -a solo que este nos indica el numero de puerto en lugar del nombre .\nNETSTAT -O Similar al par√°metro anterior pero este nos a√±ade el PID del proceso :\nNETSTAT -P Nos permite filtrar las conexiones seg√∫n el protocolo (TCP, UDP, tcpv6 o tcpv4‚Ä¶)\nNETSTAT -T Muestra el estado de descarga de la conexi√≥n actual :\nNetstat es muy interesante para ver datos estad√≠sticos de la conexi√≥n, pero tambi√©n va a ser muy √∫til para analizar los puertos abiertos en un momento determinado y as√≠ identificar problemas. Es esencial para determinadas aplicaciones y poder lograr un rendimiento √≥ptimo .\nUso general nslookup Es una aplicaci√≥n incluida en todos los sistemas Windows, para consultar, obtener informaci√≥n, probar y solucionar problemas con los servidores DNS .\nAl invocarlo sin especificar ning√∫n par√°metro, devolver√° el nombre del servidor DNS predeterminado y su direcci√≥n IP :\nEl comando dispone de dos modos de uso , el tradicional a trav√©s de linea de comandos y el interactivo . Podemos usarlo para resolver nombres de direcciones desde la terminal poniendo nslookup seguido del nombre que queramos resolver :\nTambi√©n podemos hacer consultas inversas , es decir que a trav√©s de la ip nos diga el nombre :\nPor ejemplo podemos seleccionar el tipo de registros DNS para hacer peticiones los cuales son :\nA: para buscar registros A que son los relacionados con la direcci√≥n IPv4.. AAAA: para buscar registros AAAA que son los relacionados con la direcci√≥n IPv6. Si una web utiliza direccionamiento IPv6 y nosotros tambi√©n, entonces tendremos que indicar este registro DNS. PTR: para buscar registros reversos. MX :para buscar los registros Mail Exchange del correo. TXT:, para buscar registros de texto como SPF o DKIM. CNAME: para buscar alias del dominio, esto tambi√©n se conoce como subdominios, por ejemplo, el ¬´www¬ª siempre es un subdominio del principal¬ª o el t√≠pico ¬´ftp.¬ª que es tambi√©n un subdominio. Para cambiar el tipo de registro utilizamos la orden set type=Nombre del registro , por ejemplo :\nTambi√©n podemos elegir el servidor desde el cual realizamos las consultas de la siguiente manera :\nUso general tracert Sirve para trazar la ruta que hace un paquete entrante que viene desde un host o punto de red hasta tu ordenador , as√≠ conocemos por donde viaja nuestro viaje .\nDiciendo uno a uno todos los nodos y routers por los que pasa el mensaje de prueba que has enviado, sus direcciones IP y la latencia de cada uno de ellos hasta llegar a su destino.\nHay algunos nodos que no son capaces de respondernos por eso las entradas de tiempo de espera agotado .\nTenemos algunos par√°metros interesantes como :\n-d : No convierte direcciones en nombres de host -h : Nos permite seleccionar el numero m√°ximos de saltos -4 o -6 : Fuerza usar IPV4 o IPV6 : -w : Nos permite especificar el tiempo de espera en milisegundos : Uso general route print El comando Route se utiliza para visualizar y modificar la tabla de enrutamiento. Route print muestra una lista con las rutas actuales conocidas por IP para el host. Route add se utiliza para a√±adir rutas a la tabla, y route delete se utiliza para borrar rutas de la tabla.\nAs√≠ podemos especificar el camino para llegar a una red o dispositivo .\nLa sintaxis es la siguiente : route [-f] [-p] [comando [destino]] [MASK m√°scara de red]\nComando route print sin par√°metros para mostrar todo el contenido de la tabla de enrutamiento :\nSi deseamos borrar la tabla de enrutamiento deberemos de utilizar el par√°metro -f :\nAdem√°s podemos a√±adir , rutas manuales de la siguiente manera :\n‚Üí route add IP_Destino Mascara_Destino Puerta_de_enlace m√©trica interfaz\nSi queremos cambiar una ruta , la sintaxis es la misma que el comando anterior cambiando la orden add por change :\nCuando solo queramos eliminar una ruta , utilizaremos la orden delete seguida del destino :\n¬øC√≥mo puedes averiguar la IP p√∫blica de tu router? Hay muchas forma de saber esto desde Windows , podemos utilizar el comando curl para pedir la siguiente web y que nos devuelva la ip :\nOtra forma desde la linea de comandos es hacer una consulta dns con nslookup al servicio opendns :\nSi tenemos un navegador podemos usar una de las muchas webs que nos dicen la direcci√≥n ip publica del router , yo uso la siguiente https://ipchicken.com/ :\nLinux Configurar una interfaz de red Para configurar una tarjeta de red en Linux podemos hacerlo desde la interfaz gr√°fica o desde linea de comandos .\nDesde interfaz gr√°fica nos dirigimos a Configuraci√≥n \u0026gt; Inal√°mbrica o Red . Una vez aqu√≠ encenderemos la tarjeta y le daremos al engranaje .\nUna vez aqu√≠ podemos configurar manualmente la configuraci√≥n de red de nuestra tarjeta .\nEsto mismo podremos hacerlo desde la linea de comandos editando el fichero /etc/network/interfaces con permisos de superusuario .\nDentro de este podemos indicar la configuraci√≥n de nuestros adaptadores de red , aqu√≠ te indico con lineas comentadas los par√°metros b√°sicos que podemos indicar en este archivo .\nUna vez hayamos configurado nuestras interfaces los cambios no se aplicaran autom√°ticamente , para hacer esto tenemos varias formas , la mas c√≥modas es reiniciar el servicio :\nOtra forma de cambiar los servidores DNS que se utilizan es a trav√©s del fichero /etc/resolf.conf\nAqu√≠ seguido de nameserver pondremos la direcci√≥n ip o nombre de nuestro servidor DNS\nUso general ifconfig Explica la utilidad del comando ifconfig a partir de una captura real. ¬øHay alguna informaci√≥n de las que se obtiene con ipconfig /all que no aparezca? Trata de conseguirla de otra forma.\nEs similar a ifconfig y esta enfocado a las mismas funciones , este comando tambi√©n se utiliza para ver, cambiar y administrar todas las configuraciones actuales de la red inform√°tica.\nEsta se instala con el paquete net-tools , para instalarlo:\nPara utilizar esta herramienta necesitaremos hacerlo como superusuario , con su uso mas simple nos mostrara la configuraci√≥n b√°sica TCP/IP de nuestra tarjeta de red as√≠ como unas estad√≠sticas de la misma :\nPor ejemplo con ipconfig /all podemos ver los servidores DNS configurados cosa que con ifconfig no podremos ver .\nAs√≠ que tendremos que ver el fichero /etc/resolf.conf\nUn uso com√∫n de este comando es configurar r√°pidamente una interfaz de red , por ejemplo :\nEsto podemos ponerlo en una sola linea\nAdem√°s tambi√©n podremos levantar y bajar la tarjeta de red\nUso general dhclient Este utiliza el protocolo de configuraci√≥n din√°mica de host para configurar din√°micamente los par√°metros de red de la interfaz de red.\nEl siguiente comando indicar√° a dhclient que libere la concesi√≥n actual que tiene del servidor DHCP ,es decir que queremos liberar la ip actual . Utilizaremos los par√°metros -r y -v\nSi queremos volver a pedir una configuraci√≥n de red al comando dhcp utilizaremos solamente el par√°metro -v .\nPrincipalmente este comando se usa para esto , para solucionar problemas con la configuraci√≥n del servicio DHCP .\nAlgunos par√°metros que no he mencionado y pueden resultar √∫til son :\n-6 : Sirve para indicar que quieres IPV6 -p: Sirve para indicar otro puerto para hacer la consulta -s : Sirve para indicar la direcci√≥n del servidor DHCP Diferencias de los comandos netstat y ping respecto a los empleados en Windows netstat muestra informaci√≥n sobre el subsistema de red en nuestro equipo al igual que Windows . Si nos fijamos en el manual nos indica que Esta aplicaci√≥n est√° parcialmente obsoleta. El reemplazo de netstat es ss, para netstat -r tiene ip route, para netstat -i puede usar ip -s link y para netstat -g dispone de ip maddr.\nSi lanzamos el par√°metro podemos ver a simple vista que nos muestra mas informaci√≥n sin indicar ning√∫n par√°metro , por lo dem√°s estos son los mismo que en Windows .\nMientras que el comando ping la diferencia es que es por defecto infinito , a diferencia de Windows este no acabara hasta que lo detengamos nosotros .\nEn este los par√°metros con respecto a Windows cambia su ‚Äúletra ‚Äù , aqu√≠ serian :\n-i : Indicar el intervalo para enviar el siguiente paquete en segundos (por defecto es 1 ) -s : Cambiar el tama√±o del paquete en bytes -f : inundaci√≥n , para probar el rendimiento de la red bajo una carga pesada (env√≠a una gran cantidad de paquetes lo m√°s r√°pido posible) -c : Indicar el numero de trazas enviadas -w: Dejara de imprimir los resultados despu√©s de los segundos indicados -q: Elimina la salida del comando , opci√≥n silenciosa -a : hace un sonido cuando hay una respuesta -V indica la version del comando La utilidad de este sigue siendo la misma , solucionar problemas de accesibilidad de hosts en una red. Esto nos ayuda a comprender por qu√© un sitio web no se carga.\nUso general comando dig Dig es un comando que permite realizar consultas a servidores DNS para obtener informaci√≥n relacionada con este servicio. Para instalarlo en nuestro sistema , haremos un apt install dnsutils .\nPodemos hacer una consulta dns , por ejemplo al instituto para comprobar si somos capaces de obtener su direcci√≥n ip :\nUtilizando la opci√≥n +trace realiza consultas iterativas para resolver la b√∫squeda de nombres. Consultar√° los nombres de servidores a partir de la ra√≠z y posteriormente atravesar√° el √°rbol del espacio de nombres mediante consultas iterativas siguiendo las referencias en el camino:\nTambi√©n podemos realizar consultas inversas con la opci√≥n -x :\nDiferencias del comando traceroute de Linux con el comando tracert de Windows La herramienta traceroute es exactamente la misma que el tracert, pero se denomina de otra forma, aunque internamente puede hacer uso de diferentes protocolos, ya que en algunos sistemas operativos se hace uso del protocolo ICMP Echo Request/reply, y en otros de hace uso de mensajes UDP directamente para comprobar cuantos saltos hay de un host a otro .\nEstas se usan para detectar donde esta el error a la hora de acceder a un determinado equipo y saber en que nodo se produce el ‚Äúerror‚Äù .\nAlgunos par√°metros que pueden interesarnos son :\n-f, :Establece la distancia entre el primer salto y el siguiente salto. -g,: nos permite indicar la puerta de enlace. -I : Usa ICMP ECHO -m, :Establece el n√∫mero de saltos; el valor predeterminado es 64. -M, :las rutas de seguimiento se realizan con ICMP o UDP; el m√©todo predeterminado es UDP. -p: Define el puerto de red; el valor predeterminado es 33434. -q: Define el numero de paquetes por salto. ‚Äìresolve-hostnames: puede usar esta sintaxis para corregir los nombres de host. -w, : Define el tiempo de espera en segundos. Uso general wget Wget es una herramienta inform√°tica creada por el Proyecto GNU. Puedes usarlo para recuperar contenido y archivos de varios servidores web. El nombre es una combinaci√≥n de World Wide Web y la palabra get. Admite descargas a trav√©s de FTP, SFTP, HTTP y HTTPS.\nPara instalarlo usamos el comando apt install wget .\nUn ejemplo es para descargar archivos , por ejemplo una iso . Pondr√≠amos el comando seguido de la url :\nEste nos descargara el archivo en el directorio actual de trabajo .\nPodemos utilizar el comando -o para indicar un nombre diferente al descargar el archivo :\nAlgunos par√°metros interesantes son :\n-P : Indicar el directorio donde queremos guardar el archivos \u0026ndash;limit-rate : sirve para limitar la velocidad de descarga -tries : nos permite indicar el numero de reintentos de la descarga -b : Realizara la descarga en segundo plano -c para indicar que se reanude una descarga Si quisi√©ramos descargar archivos desde un servidor ftp utilizar√≠amos la siguiente sintaxis : wget ‚Äìftp-user=usuario\u0026ndash;ftp-password=contrase√±a\nUso general de tcpdump Tcpdump es una herramienta para l√≠nea de comandos cuya utilidad principal es analizar el tr√°fico que circula por la red. Permite al usuario capturar y mostrar en tiempo real los paquetes transmitidos y recibidos por la red a la cual el ordenador est√° conectado\nLos par√°metros mas comunes son :\n-i Permite especificar la interfaz de red en la que vamos a atender el tr√°fico. -c Permite limitar la cantidad de paquetes capturados en un n√∫mero determinado. -n Evita la resoluci√≥n de puertos y direcciones ip a nombres. -e Muestra las cabeceras ethernet adem√°s del paquete ip. -t No imprime la estampa de tiempo de captura de cada paquete. -x Muestra el contenido hexadecimal de la trama capturada. -xx Idem a -x, pero adem√°s muestra el contenido de la cabecera Ethernet. -X Muestra el contenido hexadecimal y en ASCII de la trama capturada. -A Solo muesta el contenido ASCII del paquete capturado. -s Muestra solo los primeros bytes desde el principio del paquete. -vv Muestra informaci√≥n adicional, incluyendo par√°metros de las cabeceras de protocolo. -w file Permite guardar la salida en un archivo con formato pcap. -r file Permite leer los paquetes previamente capturados y almacenados en un archivo pcap. Por ejemplo podemos hacer una captura de nuestra red de un m√°ximo de 50 paquetes :\nComo ves la salida es indescifrable , para leerla usaremos el comando ngrep para buscar coincidencias sin tener en cuenta may√∫sculas y min√∫sculas .\nUso general del comando arp El comando arp nos permitir√° interactuar con la cache de resoluci√≥n arp , modific√°ndola por ejemplo .\nTambi√©n podemos averiguar la direcci√≥n MAC de un dispositivo , busc√°ndolo en la tabla :\nLos par√°metros son los mismo que podemos encontrar en Windows :\n-a : Encontrar una determinada direcci√≥n en la tabla -v : Muestra todas las entradas -n : Muestra todas las entradas de forma num√©rica -d : elimina una resoluci√≥n determinada Tambi√©n podemos hacer esto mismo con el comando ip :\nPara este la sintaxis b√°sica es de la siguiente forma :\nadd : A√±adir resoluci√≥n del : Eliminar resoluci√≥n change : Cambiar una resoluci√≥n replace : Remplazar una resoluci√≥n Por ejemplo para a√±adir una tabla :\nComando ip Podremos ver y configurar direcciones IP, ver y configurar tablas de enrutamiento, ver y configurar t√∫neles IP, y tambi√©n ver y configurar la interfaz f√≠sica .\nEste se le a√±ade un ‚Äúsegundo comando ‚Äù para indicar su funcion , son los siguientes :\nlink: nos sirve para configurar las interfaces de red f√≠sicas o l√≥gicas, por ejemplo, para ver el estado de todas las interfaces de red. address: permite ver y configurar las direcciones IPv4 y IPv6 asociadas a las diferentes interfaces de red. Cada interfaz debe tener al menos, una direcci√≥n IP configurada. addrlabel: permite a√±adir una etiqueta neighbour: permite ver los enlaces de vecindad, es decir, se puede ver la tabla ARP del sistema operativo. rule: permite ver y configurar pol√≠ticas de enrutado y cambiarlas, esto se utiliza sobre todo cuando vas a configurar varias tablas de enrutamiento. route: permite ver y configurar las tablas de enrutamiento, tanto de la tabla de enrutamiento principal, como de las ¬´secundarias¬ª que configures. tunnel: permite ver los t√∫neles IP y tambi√©n configurarlos. maddr: permite ver y configurar las direcciones multienlace. mroute: permite ver y configurar la tabla de enrutamiento multicast. mrule: permite ver y configurar pol√≠ticas de enrutamiento de direcciones multicast. monitor: permite monitorizar el estado de las tarjetas de red de manera continua, tambi√©n direcciones IP y rutas. ntable: gestiona el cach√© de neighbour (ARP) tuntap: gestiona las interfaces TUN/TAP, orientado a las VPN como OpenVPN o WireGuard. maddress: configuraci√≥n de las direcciones multicast xfrm: gestiona las pol√≠ticas IPsec. netns: administrar espacios de nombres de red l2tp: configuraci√≥n de L2TP tcp_metrics: gestiona m√©tricas TCP. token: gestiona los identificadores con token de las interfaces. Bibliograf√≠a Cambiar configuraci√≥n TCP/IP Informaci√≥n general sobre comandos Informaci√≥n protocolo ICMP\nComando PING\nComando NSLOOKUP\nDescripci√≥n par√°metros de los comandos Configuraci√≥n red debian Comando ifconfig\nComando ip\n","date":"September 8, 2023","hero":"/images/redes/comando_de_supervision_de_redes/comando_de_supervision_de_redes.png","permalink":"https://www.javiercd.es/posts/redes/comandos_de_supervision_de_redes/comandos_de_supervisi%C3%B3n_de_redes/","summary":"\u003cp\u003eDocumento en el cual se detallan los principales comandos a la hora de detectar incidencias en redes y lograr solucionarlos .\u003c/p\u003e\n\u003ch2 id=\"comandos-en-windows\"\u003eComandos en Windows\u003c/h2\u003e\n\u003ch3 id=\"explica-el-significado-de-los-distintos-par√°metros-a-configurar-en-las-propiedades-de-tcpip-en-windows\"\u003eExplica el significado de los distintos par√°metros a configurar en las Propiedades de TCP/IP en Windows\u003c/h3\u003e\n\u003cp\u003eTenemos que tener en cuenta que cada configuraci√≥n que hagamos es independiente para cada uno de nuestros adaptadores de red .\u003c/p\u003e\n\u003cp\u003ePara acceder a configurar estos par√°metros seguiremos la siguiente ruta en nuestro sistema  :\u003c/p\u003e","tags":["Redes","comandos"],"title":"Comandos de supervisi√≥n de redes"},{"categories":null,"contents":"La tecnolog√≠a NFS (Network File System) ha sido una pieza fundamental en la compartici√≥n de archivos en entornos de red. Desarrollada por Sun Microsystems, NFS permite a sistemas operativos Unix y Linux compartir recursos de archivos de manera transparente, brindando acceso a archivos y directorios remotos como si estuvieran almacenados localmente.\n1.Instalaci√≥n y configuraci√≥n NFS Instalamos el paquete nfs-kernel-server.\nCrearemos el directorio que vamos a compartir y le cambiamos los due√±os y los permisos del mismo :\nEn el fichero etc/exports indicaremos cual es nuestro directorio y sus respectivos permisos :\nro: permiso de solo lectura del directorio rw: permiso de lectura y escritura del directorio subtree_check: especifica la verificaci√≥n de subdirectorios no_subtree_check: previene verificaci√≥n de subdirectorios sync: Escribe todos los cambios en el disco antes de aplicarlo Async: ignora la verificaci√≥n de sincronizaci√≥n para mejorar la velocidad Aplicamos los cambios y reiniciamos el servicio :\n2.Visualizarlo en un cliente debian Nos instalaremos el siguiente paquete :\nLa montamos en nuestro cliente :\nTambi√©n podemos hacerlo de forma permanente en el fstab :\nPodemos visualizar el contenido :\nVamos a crear un archivo y a comprobar que se ha creado en el servidor :\n3.Visualizaci√≥n en Windows Nos descargamos la caracter√≠stica de cliente NFS:\nMapeamos la unidad de red :\nCreamos un fichero de forma remota y comprobamos que se ha creado .\nLo comprobamos tambi√©n en el servidor :\n","date":"September 8, 2023","hero":"/images/sistemas/nfs/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/nfs_debian/nfs/","summary":"\u003cp\u003eLa tecnolog√≠a NFS (Network File System) ha sido una pieza fundamental en la compartici√≥n de archivos en entornos de red. Desarrollada por Sun Microsystems, NFS permite a sistemas operativos Unix y Linux compartir recursos de archivos de manera transparente, brindando acceso a archivos y directorios remotos como si estuvieran almacenados localmente.\u003c/p\u003e\n\u003ch2 id=\"1instalaci√≥n--y-configuraci√≥n-nfs\"\u003e1.Instalaci√≥n  y configuraci√≥n NFS\u003c/h2\u003e\n\u003cp\u003eInstalamos el paquete nfs-kernel-server.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/nfs_debian/img/Aspose.Words.11ce2099-f519-43cd-a00b-9a47a367ade4.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCrearemos el directorio que vamos a compartir  y le cambiamos los due√±os y los permisos del mismo :\u003c/p\u003e","tags":["Linux","Sistemas","ISO","ASO"],"title":"Compartir directorios con NFS en debian"},{"categories":null,"contents":"En el entorno empresarial, la capacidad de compartir recursos en red es esencial para la colaboraci√≥n y la eficiencia operativa. En este art√≠culo, exploraremos c√≥mo compartir directorios en un entorno Windows Server, abordando los m√©todos tanto a trav√©s de la interfaz gr√°fica como mediante cmd y PowerShell.\nDesde la interfaz gr√°fica Podemos compartir un directorio de nuestro servidor , accediendo a las propiedades del mismo . Una vez aqu√≠ pulsamos sobre el men√∫ compartir :\nAhora le daremos permisos a los usuarios que deseemos que tengan acceso a este :\nUna vez compartido nos mostrara la ruta que tendremos que poner para acceder a este recurso , que podemos modificarla a nuestro gusto en uso compartido avanzado :\nDesde un cliente podemos ver los recursos que esta compartiendo nuestro servidor usando net view :\nPodemos mapear la unidad de red desde la linea de comandos usando net use :\nVamos a crear un directorio y comprobar que se ha creado :\nVemos que en el servidor se ha creado :\nTambi√©n podemos hacer esto desde la administraci√≥n de usuarios y grupos de active directory :\nCompartir recursos desde cmd Ahora vamos a usar net share para compartir un recurso en red a traves de la linea de comandos :\nSi desde otro cliente vemos los recursos que comparte el server core , lo veremos :\nSi queremos cambiar los permisos de un recurso compartido podemos usar los comandos cacls y icacls . Tambi√©n tenemos la posibilidad de hacerlo usando la interfaz gr√°fica con las RSAT.\nComandos powershell Crearemos el recurso compartido\nNew-SmbShare -Name JCD\\_comp -Path \u0026#34;C:\\compartir\\\u0026#34; -FullAccess \u0026#34;Administrador\u0026#34; Si queremos a√±adir permisos espec√≠ficos a un grupo a la hora de crear el recurso compartido seria :\nNew-SmbShare -Name \u0026lt;Nombre-de-la-carpeta\u0026gt; -Path \u0026lt;Ruta-de-la-carpeta\u0026gt; -ReadAccess \u0026#34;\u0026lt;Grupo-o-usuario-que-tiene-acceso-de-lectura\u0026gt;\u0026#34; -FullAccess \u0026#34;\u0026lt;Grupo-o-usuario-que-tiene- acceso-total\u0026gt;\u0026#34; Si despu√©s de esto queremos a√±adirle o quitarle permisos a alg√∫n usuario o grupo al directorio samba compartido :\nSet-SmbPathAcl -Path \u0026#34;C:\\compartir\u0026#34; -AceType Allow -AccessType Write -AccountName UsuariosCompartidos Si por el contrario queremos eliminar permisos al usuario o grupo :\nRemove-SmbPathAcl -Path \u0026#34;C:\\compartir\u0026#34; -AceType Allow -AccessType Write -AccountName UsuariosCompartidos Para montar este directorio compartido en otro host Windows :\nNew-PSDrive -Name J -PSProvider FileSystem -Root [\\\\172.22.9.143\\JCD_comp](file://172.22.9.143/JCD_comp) Adem√°s podemos listar para ver si se ha montado correctamente :\nListaremos el contenido del mismo para ver si tenemos acceso a el :\n","date":"September 8, 2023","hero":"/images/sistemas/compartir_directorios_win/portada.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comparticion_de_directorios_en_windows/comparticion_de_directorios_en_windows/","summary":"\u003cp\u003eEn el entorno empresarial, la capacidad de compartir recursos en red es esencial para la colaboraci√≥n y la eficiencia operativa. En este art√≠culo, exploraremos c√≥mo compartir directorios en un entorno Windows Server, abordando los m√©todos tanto a trav√©s de la interfaz gr√°fica como mediante cmd y PowerShell.\u003c/p\u003e\n\u003ch2 id=\"desde-la-interfaz-gr√°fica\"\u003eDesde la interfaz gr√°fica\u003c/h2\u003e\n\u003cp\u003ePodemos compartir un directorio de nuestro servidor , accediendo a las propiedades del mismo . Una vez aqu√≠ pulsamos sobre el men√∫ compartir :\u003c/p\u003e","tags":["Windows","Sistemas","ISO","ASO"],"title":"Compartir recursos en red en Windows Server"},{"categories":null,"contents":"Instalar un servidor web Apache para el uso en una Intranet Para instalar el servidor debemos ejecutar como root el siguiente comando:\nCrea dentro del directorio /var/www/html un fichero llamado entrada.html en el que pong√°is un mensaje de bienvenida\nAhora lo meter√© dentro de la ruta :\nA continuaci√≥n vamos a publicar una p√°gina m√°s completa en nuestro servidor, para ello\nutiliza tu sitio web de aplicaciones web.\nAdemas debemos de darle permisos de lectura a otros para que podamos visualizarla :\nAccede desde los clientes, poniendo en un navegador la siguiente URL:\nDesde debian cliente :\nA continuaci√≥n vamos a publicar una p√°gina m√°s completa en nuestro servidor, para ello utiliza tu sitio web de aplicaciones web:\nResoluci√≥n local de nombres : modifica los ficheros necesarios en el servicio BIND y accede usando el nombre que has indicado :\nComo ya tenia echo el dns anteriormente he utilizado este nombre :\nConfiguraci√≥n de sitios web virtuales usando Apache La primera web tendr√° el directorio base ser√° /var/www/iesgn y contendr√° una p√°gina llamada index.html, donde s√≥lo se ver√° una bienvenida a la p√°gina del instituto Gonzalo Nazareno .\nLa segunda web tendr√° el directorio base ser√° /var/www/departamentos. En este sitio s√≥lo tendremos una p√°gina inicial index.html, dando la bienvenida a la p√°gina de los departamentos del instituto.\nNecesitamos tener dos ficheros para realizar la configuraci√≥n de los dos sitios virtuales, para ello vamos a copiar el fichero 000-default.conf\nUna vez hayamos creado los ficheros a√±adiremos dentro de cada uno el siguiente contenido :\nAhora deberemos crear un enlace simb√≥lico en el directorio /etc/apache2/sites-enabled.\nPara que se apliquen estos cambios debemos reiniciar el servicio :\nAhora deberemos de actualizar el dns :\nUna vez reiniciado el dns podremos acceder a ambos sitios desde el navegador :\nAcceso autentificado al servidor web Apache Para activar la autentificaci√≥n b√°sica debemos de a√±adir las siguientes lineas a nuestro archivo de configuraci√≥n del sitio :\nAhora creamos el archivo de las contrase√±as , con el usuario previamente creado :\nReiniciamos el servicio y nos conectamos :\nAhora vamos ha hacer que a la pagina departamentos solo acceda el director y el profesor , ademas que a direcci√≥n solo acceda el director , para eso a√±adimos en departamentos:\nAhora vamos a a√±adir los usuarios de las zonas para eso , utilizamos este comando :\nUsuario profesor a departamentos : Usuario director a departamentos : Usuario director a zona direcci√≥n : Ahora reiniciaremos el servicio y comprobaremos que podemos acceder :\nAccederemos a departamentos :\nAhora a la zona equipo directivo :\n","date":"September 8, 2023","hero":"/images/servicios/apache/portada-apache.jpg","permalink":"https://www.javiercd.es/posts/servicios/apache/apache/","summary":"\u003ch2 id=\"instalar-un-servidor-web-apache-para-el-uso-en-una-intranet\"\u003eInstalar un servidor web Apache para el uso en una Intranet\u003c/h2\u003e\n\u003cp\u003ePara instalar el servidor debemos ejecutar como root el siguiente comando:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/apache/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.125.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eCrea dentro del directorio /var/www/html un fichero llamado entrada.html en el que pong√°is un mensaje de bienvenida\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/apache/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.126.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora  lo meter√© dentro de la ruta :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/apache/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.127.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eA continuaci√≥n vamos a publicar una p√°gina m√°s completa en nuestro servidor, para ello\u003c/p\u003e\n\u003cp\u003eutiliza tu sitio web de aplicaciones web.\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT","SSH","FORWARDING","APACHE"],"title":"Configuraci√≥n Apache bajo debian"},{"categories":null,"contents":"En este art√≠culo, exploraremos la configuraci√≥n de SNAT (Source Network Address Translation) y DNAT (Destination Network Address Translation) en escenarios con direcciones p√∫blicas, haciendo uso de routers en entornos Linux y dispositivos Cisco.\nEscenario con maquinas debian Preparaci√≥n del entorno Instalaci√≥n de paquetes Una vez colocadas las maquinas deberemos de descargarnos apache para los servidores web , para realizar esto conectaremos ambos servidores a un switch y este a la nube NAT para disponer de acceso a internet .\nAhora actualizaremos los repositorios haciendo un apt update :\nA continuaci√≥n ya podremos descargar los paquetes , para los servidores instalaremos apache :\nY para el router de casa descargaremos el servidor DHCP :\nAl acabar la instalaci√≥n saltara un c√≥digo de error similar a este , esto es debido a que no hay una configuraci√≥n valida en el servicio :\nPor ahora ignoraremos esto y posteriormente configuraremos el servidor DHCP .\nCon esto habr√≠amos instalado todos los paquetes necesarios para instalar la practica as√≠ que podemos montar el escenario .\nConfiguraci√≥n de las tarjetas de red Nos encontraremos con un peque√±o obst√°culo a la hora de hacer el escenario ya que necesitamos que algunos routers tengan mas de una tarjeta de red .\nPara a√±adir mas de una tarjeta con el dispositivo apagado y sin estar conectado a nadie , hacemos sobre el clic derecho y pulsamos sobre configure \u0026gt; network , y seleccionamos el numero de adaptadores que necesitamos tener en cada uno , por ejemplo para el router de casa necesito tener dos adaptadores :\nUna vez hecho esto con las maquinas que necesitan mas de una tarjeta , montaremos el escenario y procederemos a configurar sus tarjetas .\nPara modificar la configuraci√≥n de las tarjetas de red lo haremos editando el fichero /etc/network/interfaces .Para que se aplique la configuraci√≥n de las tarjetas de red que hemos realizado tenemos varias opciones .\nSubir y bajar la tarjeta que hemos modificado :\nTambi√©n podemos ahorrar tiempo y reiniciar el servicio de networking , esto funcionara para todas las tarjetas simult√°neamente as√≠ que nos ahorrara tiempo :\nRouter CASA:\nRouter R1:\nRouter ISP:\nRouter R2:\nAs√≠ seria la relaci√≥n de ips que tienen las tarjetas de red de los routers . Para aplicar esta configuraci√≥n a las tarjetas de red tendremos que reiniciar la misma como indico al principio de este apartado .\nPara que el escenario funcione debemos activar el bit de forwarding para estos 4 routers , en este caso lo har√© de forma permanente para ello editamos el fichero /etc/sysctl.conf y descomentamos esta linea :\nRutas necesarias Para mi esquema actual las rutas que necesitamos en los routers son :\nRouter R1:\nRouter ISP:\nRouter R2:\nRouter CASA:\nComprobaci√≥n de conectividad Vamos a hacer ping desde cada uno de los routers a su extremos ‚Äúmas lejanos‚Äù para asegurarnos de que hemos realizado correctamente el enrutamiento .\nRouter R1 ‚Äì\u0026gt; R2\nRouter R1 ‚Äì\u0026gt; CASA\nRouter R2 ‚Äì\u0026gt; R1\nRouter R2 ‚Äì\u0026gt; CASA\nRouter CASA ‚Äì\u0026gt; R1\nRouter CASA ‚Äì\u0026gt; R2\nVemos que todos los dispositivos que tiene direcci√≥nes ips publicas tienen conectividad entre si pero que pasa con los que tienen direcci√≥namiento privado en nuestro escenario , estos no tendr√°n conectividad ya que no se enrutan direcci√≥nes privadas en los routers de internet .\nEs decir si lanzamos un ping hacia una direcci√≥n privada que sea de otra red , por ejemplo del servidor1 al servidor2 este no llegara , ya que en las tablas de enrutamiento del router del ISP no existen rutas para direcci√≥nes privadas .\nPor lo que sera imposible alcanzar una red privada diferente a la que pertenezcamos .\nPor ejemplo desde casa si le hacemos ping a google se lo hacemos a la direcci√≥n PUBLICA 8..8.8.8 no a la direcci√≥n privada que tiene el servidor , puede ser la 172.22.1.15\nConfiguraci√≥n del servicio DHCP en router CASA Retomando lo que hab√≠amos hecho anteriormente en el apartado de instalaci√≥n de paquetes ya hemos descargado el servidor DHCP para debian (isc-dhcp-server). As√≠ que ahora vamos a configurarlo .\nLo primero que necesitamos hacer es decirle a nuestro servidor a trav√©s de que tarjeta de red queremos que este reparta direcci√≥nes ip , en nuestro caso es la tarjeta ens5 .\nPara ello editaremos el fichero /etc/default/isc-dhcp-server y a√±adiremos el nombre de la tarjeta en la secci√≥n de IPV4 :\nAhora vamos a indicarle a nuestro servidor DHCP que configuraci√≥n queremos que le asigne a nuestros clientes para ello editamos el fichero /etc/dhcp/dhcpd.conf , podemos aprovechar uno de los ejemplos que vienen comentados y aplicar nuestra configuraci√≥n :\nEste es un ejemplo muy sencillo de un servidor dhcp pero con esto es suficiente para nuestro escenario .\nLos campos significan :\nsubnet : direcci√≥n de red de la cual queremos repartir direcci√≥nes ip con este servicio . netmask : Mascara de red de la red la cual queremos configurar los dispositivos. range: Rango de direcci√≥nes de la cual queremos repartir ips siendo la primera la inicial y la ultima la final . option routers: Seria la puerta de enlace de nuestra red option broadcast-address : direcci√≥n de broadcast de nuestra red . Una vez configurado con los par√°metros de nuestra red reiniciaremos el servicio :\nY comprobaremos que el servicio esta activo :\nAhora para que los clientes puedan recibir una direcci√≥n utilizando este servicio deberemos de configurar las tarjetas de red de PC1 y PC2 de la siguiente manera :\nReiniciamos el servicio para que esta se aplique y el servidor nos asigne autom√°ticamente la configuraci√≥n de red :\nComprobamos que efectivamente nos ha asignado la configuraci√≥n de la red :\nTambi√©n podemos hacer un seguimiento de a quien le hemos asignado la ip trav√©s del servidor viendo el siguiente archivo /var/lib/dhcp/dhcpd.leases el cual guarda las concesiones que hemos realizado .\nPodemos ver cuando empieza as√≠ como a quien se le ha asignado viendo su direcci√≥n MAC.\nConfiguraci√≥n de NAT Router CASA Vamos a configurar el SNAT en el router de casa viendo el esquema actual la regla para hacer esto es :\nSin embargo as√≠ se eliminar√≠a cuando reiniciase la maquina as√≠ que en este caso voy a a√±adirla al /etc/network/interfaces :\nAs√≠ podemos ver que se han aplicado despu√©s de reiniciar el servicio networking :\nVamos a comprobar que funciona la regla viendo si lanzo un ping a otra red (R1) si este cambia mi direcci√≥n IP :\nVemos que haciendo la captura este me ha cambiado la direcci√≥n privada de la maquina por la publica del router de casa por lo que la regla de SNAT estar√≠a funcionando correctamente .\nRouter R2 Vamos a configurar SNAT y DNAT para ello a√±adir√© las reglas al /etc/network/interfaces :\nReiniciamos el servicio networking y vemos si se ha aplicado :\nComprobaremos que funciona el SNAT haciendo ping del servidor hacia fuera a una direcci√≥n publica :\nVemos que esta funcionando correctamente la regla de SNAT :\nYa que nos ha cambiado la direcci√≥n ip privada por la publica correspondiente al router . En los apartados posteriores probare el DNAT .\nRouter R1 Para este router vamos a realizar la creaci√≥n de las reglas de una forma diferente , para ella crearemos un servicio que se encargue de levantar las reglas de DNAT y SNAT cuando la maquina se reinicie para evitar a√±adirlas al fichero interfaces .\nLas reglas de DNAT y SNAT para esta maquina son :\nLo primero que tendremos que hacer sera crear un script con nuestras reglas , as√≠ que las volcare con el comando iptables-save \u0026gt; /etc/iptables/rules.v4 para volcar las reglas existentes .\nAhora crearemos un script en en el cual restauraremos las reglas que hemos volcado y lo crearemos en la siguiente ruta /usr/local/bin/ :\nNos tendremos que asegurar que tiene permisos de ejecuci√≥n :\nCrearemos un archivo de servicio de Systemd , este archivo debe tener permisos de lectura y escritura solo para root, por lo que se debe ejecutar el siguiente comando como root:\nDentro de este a√±adiremos el siguiente contenido , solo tendr√≠as que a√±adir la ruta donde se encuentre tu script de iptables que restaura las reglas :\nLe diremos al servicio que se inicie autom√°ticamente al reiniciar la maquina :\nY lo iniciamos :\nSi queremos asegurarnos de que ha realizado su cometido correctamente miraremos el estado del servicio :\nVeremos que las reglas se han a√±adido autom√°ticamente :\nComprobaremos que nos ha realizado el SNAT correctamente lanzando un ping :\nVemos que nos ha cambiado la direcci√≥n ip privada por la publica .\nComprobaci√≥n de navegaci√≥n y DNAT Ahora vamos a comprobar que desde la red de casa podemos acceder a los servidores web .\nCliente Debian Desde el cliente debian podemos hacer un curl para comprobar el correcto funcionamiento del DNAT en el Router R1:\nDesde el cliente debian podemos hacer un curl para comprobar el correcto funcionamiento del DNAT en el Router R2:\nAhora vamos a comprobar que pasa si ponemos la direcci√≥n privada de los distintos servidores web :\nVemos que no podemos llegar a esa red ya que los routers de internet son incapaces de encaminarnos hacia esta red privada ya que puede haber miles de dispositivos con la misma ip :\nTampoco recibir√≠amos respuesta si hici√©semos una petici√≥n web .\nSi interceptamos una petici√≥n http vemos que el SNAT se realiza correctamente , cambiando la ip privada del solicitante por la publica de su router :\nAhora voy a interceptar una petici√≥n en la que se haga DNAT para comprobar que este se realiza correctamente :\nPodemos ver que el origen es una direcci√≥n ip publica mientras que el destino es una direcci√≥n ip privada podemos ver que el DNAT se ha realizado correctamente .\nAhora voy a pinchar un Firefox y volver√© a comprobar que podemos acceder a los servidores web solo usando su direcci√≥n ip publica :\nServer 1 :\nServer 2:\nVemos que usando direcci√≥n ip publica podemos conectarnos , sin embargo no podremos usando las direcci√≥nes ips privada de las maquinas :\nServer 1 :\nServer 2 :\nFunciona correctamente ya que hemos conseguido que nuestros routers Linux sean capaces de hacer SNAT y DNAT pudiendo hacer que estos ‚Äúutilicen‚Äù internet y puedan acceder a los recursos de otras redes . Ya que las direcci√≥nes privadas no se enrutan en los mismos as√≠ que si comprobamos usando estas no obtendremos ning√∫n resultado .\nDepuraci√≥n NAT Para ver cuantos hits ha tenido una regla o para ver cuanta informaci√≥n ha ‚Äúutilizado‚Äù cada regla utilizaremos el siguiente comando :\nPara borrar los contadores de todas las cadenas y reglas usaremos iptables -Z :\nSi nuestra cadena tiene hits la regla estar√° funcionando correctamente si por el contrario esta se mantiene en 0 , la regla no se esta aplicando as√≠ que tendremos que revisarla .\nEscenario con routers Cisco Volveremos a repetir el mismo escenario que con los routers Linux pero ahora usando routers cisco 7200.\nPreparaci√≥n del entorno Configuraci√≥n de las tarjetas de red Lo primeros que haremos sera a√±adirle los slots necesarios a nuestros routers ya que necesitamos 2 tarjetas de red en R1,R2 y CASA . Edemas de 3 para el router ISP .\nPara los primeros le a√±adiremos el slot PA-FE-TX , que nos a√±adir√° una interfaz FastEthernet:\nMientras que para el router del ISP le a√±adiremos PA-2FE-TX que nos a√±adir√° dos interfaces de red FastEthernet.\nAhora podemos arrancar los routers y comenzar con la configuraci√≥n de las tarjetas de red . Usare las mismas direcci√≥nes que en el escenario anterior .\nRouter CASA Configuramos las tarjetas de red :\nQuedando as√≠ nuestras interfaces :\nRouter R1 Configuramos las tarjetas de red :\nQuedando as√≠ nuestras interfaces :\nRouter R2 Configuramos las tarjetas de red :\nQuedando as√≠ nuestras interfaces :\nRouter ISP Configuramos las tarjetas de red :\nQuedando as√≠ nuestras interfaces :\nRutas necesarias Rutas ISP: Rutas CASA : Rutas R2: Rutas R1: Seria necesario √∫nicamente que a√±adamos las rutas por defecto en los Routers R1 , R2 y CASA .\nPrueba de conectividad R1 ‚Äì\u0026gt; R2\nR1 ‚Äì\u0026gt; CASA\nR2-‚Üí R1\nR2 ‚Äì\u0026gt; CASA\nCASA ‚Äì\u0026gt; R1\nCASA ‚Äì\u0026gt; R2\nVemos que todos los dispositivos que tiene direcci√≥nes ips publicas tienen conectividad entre si pero que pasa con los que tienen direcci√≥namiento privado en nuestro escenario , estos no tendr√°n conectividad ya que no se enrutan direcci√≥nes privadas en los routers de internet .\nConfiguraci√≥n del servicio DHCP en router CASA Lo primero que haremos sera establecer el rango de IP¬¥s excluidas del conjunto (pool) de direcci√≥nes que podr√° asignar el servicio indicando la ip inicial y final del rango, ambas incluidas:\nPonemos un nombre al rango del servicio DHCP:\nDefinimos la red a la que dar√° servicio de DHCP:\nIncluimos la puerta de enlace que ofrecer√° el servicio :\nCon esto ya estar√≠a configurado el servidor DHCP del router de CASA , nos salimos y guardamos los cambios . Ahora encenderemos nuestras maquinas y veremos que est√°n recibir√°n autom√°ticamente su configuraci√≥n por DHCP , con el siguiente comando podemos ver las estad√≠sticas del servicio :\nAdem√°s podemos ver las concesiones con el siguiente comando :\nEste nos sera √∫til para realizar un seguimiento de quien tiene asignada cada IP sin tener que ir individualmente a casa maquina .\nConfiguraci√≥n del NAT Router CASA Lo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nip nat pool ip_publica 102.168.0.2 102.168.0.2 netmask 255.255.255.0 Activamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nEl SNAT estar√≠a funcionando , as√≠ que vamos a comprobarlo :\nVemos que nos cambia correctamente la ip privada de nuestro host por la publica del router de casa .\nRouter R1 Lo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nip nat pool ip_publica 101.168.0.2 101.168.0.2 netmask 255.255.255.0 Activamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nY comprobaremos que se esta realizando correctamente :\nNos cambia la ip 172.22.1.1 por la 101.168.0.2 que es la publica del router al realizar un ping , por lo que esta funcionando correctamente el SNAT.\nAhora configuraremos la regla de DNAT , la sintaxis es la siguiente :\nip nat inside source static tcp ip_privada puerto ip_publica puerto *Posteriormente comprobaremos que el DNAT funciona correctamente .\nRouter R2 Lo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nip nat pool ip_publica 103.168.0.2 103.168.0.2 netmask 255.255.255.0 Activamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nY comprobaremos que se esta realizando correctamente :\n*Nos cambia la ip 10.0.0.1 por la 103.168.0.2 que es la publica del router al realizar un ping , por lo que esta funcionando correctamente el SNAT.\nAhora configuraremos la regla de DNAT , la sintaxis es la siguiente :\nip nat inside source static tcp ip_privada puerto ip_publica puerto *Posteriormente comprobaremos que el DNAT funciona correctamente .\nComprobaci√≥n de navegaci√≥n y DNAT Ahora vamos a comprobar que desde la red de casa podemos acceder a los servidores web .\nAcceder√© usando curl desde un host de la red de casa . Primero me conectare al servidor 1 :\nVemos que este nos responde correctamente y se aplica el DNAT , ya que ha cambiado la ip publica del router por la privada del servidor web :\nAhora comprobaremos el servidor 2 :\nVemos que este nos responde correctamente y se aplica el DNAT , ya que ha cambiado la ip publica del router por la privada del servidor web :\nAhora comprobaremos que puedo acceder desde un Tiny Core con Firefox a ambos servidores :\nAl servidor 1 :\nAl servidor 2 :\nVemos que tambi√©n podemos conectarnos ya que las reglas de NAT est√°n funcionando correctamente .\nVamos a comprobar que ocurre si solicitamos la web a trav√©s de sus direcci√≥nes ip privadas :\nPues que obviamente no recibimos respuesta ya que en nuestro escenario estamos simulando internet y en este no se pueden enrutar direcci√≥nes ips privadas ya que est√°n pueden estar repetidas en infinidad de redes .\nDepuraci√≥n de las reglas NAT Adem√°s para asegurarnos de que las reglas de NAT est√°n funcionando .\nEl primer comando nos permite ver la tabla de traducciones de direcci√≥nes DNAT :\nCon este comando podremos ver cuantos hits tienen nuestras reglas , si no tiene ninguno es que esta no esta funcionando salvo que nosotros hayamos inicializado este :\nSi queremos poner los contadores a cero usaremos el comando clear ip nat statistics .\nSi queremos ver en tiempo real los paquetes que muestra informaci√≥n sobre cada paquete que traduce el router :\nCuando decodifique el resultado de este comando, observe los significados de los siguientes s√≠mbolos y valores:\n* : el asterisco junto a NAT indica que la traducci√≥n se realiza en la ruta de switching r√°pido. Al primer paquete en una conversaci√≥n siempre se aplica el switching de procesos, que es m√°s lento. Si existe una entrada de cach√©, el resto de los paquetes atraviesan la ruta de switching r√°pido. S: Este s√≠mbolo hace referencia a la direcci√≥n IPv4 de origen. a.b.c.d‚Üí w.x.y.z: este valor indica que la direcci√≥n de origen a.b.c.d se traduce a w.x.y.z. d: = Este s√≠mbolo hace referencia a la direcci√≥n IPv4 de destino. [xxxx] = El valor entre corchetes es el n√∫mero de identificaci√≥n IPv4. Esta informaci√≥n puede ser √∫til para la depuraci√≥n, ya que habilita la correlaci√≥n con otros seguimientos de paquetes realizados por los analizadores de protocolos. Bibliograf√≠a Depuraci√≥n NAT ","date":"September 8, 2023","hero":"/images/redes/configuracion_nat/portada.png","permalink":"https://www.javiercd.es/posts/redes/configuracion_de_nat/configuracion_de_nat/","summary":"\u003cp\u003eEn este art√≠culo, exploraremos la configuraci√≥n de SNAT (Source Network Address Translation) y DNAT (Destination Network Address Translation) en escenarios con direcciones p√∫blicas, haciendo uso de routers en entornos Linux y dispositivos Cisco.\u003c/p\u003e\n\u003ch2 id=\"escenario-con-maquinas-debian\"\u003eEscenario con maquinas debian\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/redes/configuracion_de_nat/img/Aspose.Words.5d96acd8-9177-4bad-9621-78ead201ec37.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"preparaci√≥n-del-entorno\"\u003ePreparaci√≥n del entorno\u003c/h3\u003e\n\u003ch4 id=\"instalaci√≥n-de-paquetes\"\u003eInstalaci√≥n de paquetes\u003c/h4\u003e\n\u003cp\u003eUna vez colocadas las maquinas deberemos de descargarnos apache para los servidores web , para realizar esto conectaremos ambos servidores a un switch y este a la nube NAT para disponer de acceso a internet .\u003c/p\u003e","tags":["Redes","Enrutamiento","NAT","SNAT","DNAT","Cisco","Linux"],"title":"Configuraci√≥n de NAT Cisco y Linux"},{"categories":null,"contents":"Aprender√°s a configurar switches en GNS3, tanto dispositivos gen√©ricos como switches Cisco, utilizando el concepto de VLANs para segmentar la red y explorar las complejidades de la gesti√≥n de redes.\nPreparaci√≥n escenario Lo primero que har√© sera montar el escenario :\nConfiguraci√≥n de red de los clientes A continuaci√≥n configurare las tarjetas de red de los clientes , aprovechando que la nube NAT incluye un servidor DHCP.\nPara hacer esto escribimos en los VPCS el siguiente comando :\nEjercicio A 1 PC1 y PC3 pertenecen a la VLAN 10, PC2 y PC4 pertenecen a la VLAN 20. Demuestra el funcionamiento correcto de ambas VLAN y que no hay conectividad entre PC2 y PC3. ¬øPuedes hacerlo con los switches Ethernet que trae GNS3? ¬øEncuentras alguna limitaci√≥n? ¬øCu√°les son las distintos tipos (types) que puede tener un puerto y en qu√© se diferencian?\nPara configurar las VLANS en los switches , le damos clic derecho y a continuaci√≥n realizamos la siguiente configuraci√≥n :\nPara el switch 3 (PC1 y PC2)\nPara el switch 2 (PC3 y PC4)\nPara el switch (PC5 Y NAT1)\nPC1 , solo tendr√° conectividad con los PCs que pertenecen a su VLAN :\nPC2 , solo tendr√° conectividad con los PCs que pertenecen a su VLAN:\nCon sus respectivas parejas del otro switch obtendremos el mismo resultado. PC3 , solo tendr√° conectividad con los PCs que pertenecen a su VLAN:\nPC4 , solo tendr√° conectividad con los PCs que pertenecen a su VLAN:\nTenemos que tener en cuenta que los dispositivos que no pertenecen a la VLAN 10 deberemos de configurados manualmente ya que estos no tienen conectividad con el servidor DHCP.\nEl ejercicio A podemos hacerlo perfectamente con los switches que trae GNS3 , encontraremos una limitaci√≥n importante , ya que los switches solo permiten que las bocas pertenezcan a una VLAN .\nAl realizar el ejercicio debemos de tener en cuenta los types que puede tener un puerto , los que hemos utilizado son los dos primeros :\nAccess: Este es el destinado para un equipo final , es decir un cliente ya que se encarga de eliminar el etiquetado que va en el encabezado. Dot1q:Este es el encargado de interconectar dispositivos de red entre si , se encarga de a√±adir el etiquetado en el encabezado para mandar el paquete a otro dispositivo y que este sepa a que VLAN pertenece . QinQ : Es similar a dot1q pero este adem√°s se encarga de a√±adir en el etiquetado , el tipo de paquete para identificarlos . Teniendo esto en cuenta podemos hacer una analog√≠a con la practica de switches f√≠sicos : Los puertos untagged ‚Äì\u0026gt; Access\nLos puertos tagged ‚Äì\u0026gt; Dot1q\nAl utilizar estos switches el protocolo 802.1Q pero ‚Äúcon menos funciones‚Äù no podemos indicar que VLANS queremos que utilice los puertos configurados como Dot1q , sino que este a trav√©s de la VLAN por defecto pasara los paquetes etiquetados de todas las VLANS .\nEjercicio B 2 Todos los ordenadores deben poder acceder al servidor de datos, pero solo PC1 y PC3 deben acceder a Internet. Lo har√°n a trav√©s de vuestra m√°quina f√≠sica usando el elemento llamado NAT, que deber√©is comprender y configurar. ¬øPuedes hacerlo con los switches Ethernet que trae GNS3? ¬øQu√© limitaci√≥n te encuentras? Para superar dicha limitaci√≥n, descarga el CISCO 3725 como appliance y √∫salo en lugar de los switches Ethernet configur√°ndolos adecuadamente.\nSwitches Ethernet Aqu√≠ encontramos la primera limitaci√≥n de estos switches , ya que solo podemos tener 1 VLAN por puerto esto quiere decir que solo una VLAN tendr√° acceso a estos recursos .\nComo queremos que solo la VLAN 10 navegue por internet configuraremos la boca de nuestra nube a una boca con tipo Access y que pertenezca a esta VLAN :\nPor lo que para este punto no hay problema , nuestros PC1 y PC3 , ambos ser√°n capaces de navegar por internet :\nComo estos 2 PCS pertenecen a la misma VLAN que la nube NAT pueden comunicarse sin problema y utilizar el servidor DHCP que incluye la misma para configurarse . Mientras que los PC2 y PC4 no podr√°n ni navegar ni configurarse por DHCP al no pertenecer a la misma VLAN que la nube NAT :\nCon el servidor de datos nos toparemos con la limitaci√≥n ya que √∫nicamente un puerto puede pertenecer a una VLAN , solo una pareja de nuestros PCs podr√°n comunicarse . Esto podr√≠amos evitarlo configurando el servidor como una ‚Äúmaquina real‚Äù con 2 interfaces virtuales y dici√©ndole al switch que cada una pertenece a una VLAN distinta .\nCISCO 3725 Para comenzar a utilizar este dispositivo , tendremos que a√±adirle espacio al disco para que podamos iniciarlo , adem√°s podemos a√±adir el modulo de 16 bocas Ethernet de forma predeterminada as√≠ no tendremos que hacerlo a mano mas adelante .\nPara realizar esta configuraci√≥n deberemos de tener importado el router y acceder a Edit \u0026gt; preferences \u0026gt; IOS routers .\nUna vez modificada la plantilla colocaremos los 3725 en el escenario y montaremos el mismo escenario :\nDebemos de tener en cuenta que las interfaces FastEthernet0/0 y FastEthernet0/1 funcionan como routers , es decir no podemos utilizarlos como switch . Los puertos que se comportan como switch son todos los de FastEthernet1 as√≠ que sera los que utilicemos .\nA continuaci√≥n le diremos a estos puertos que tienen que funcionar como si fuesen un switch para ello introduciremos los siguientes comandos en cada uno de los 3725.\nAhora crearemos las vlans usando los siguientes comandos , para cada uno de los switches :\nPodemos listarlas con el siguiente comando :\nAhora le asignaremos a los puertos su VLAN correspondiente :\nA continuaci√≥n configuraremos el puerto que une a los dos 3725 , para esto lo ponemos en modo trunk y permitimos el trafico encapsulado de todas las VLANS por este puerto .\nPor ultimo guardaremos los cambios para que si se apaga el equipo mantenga las modificaciones que hemos realizado :\nCon esto habremos configurado el primer 3725 , su homologo a este , es decir el que conecta a PC3 y PC4 , tendr√≠amos que hacer lo mismo adaptado a los puertos en los que est√©n conectado los dispositivos .\nContinuaremos configurando el 3725 que une ambos ‚Äúswitches‚Äù y da salida al servidor de datos y a internet . Para ello crearemos las VLANS 10 y 20 :\nY le asignaremos al servidor de datos ambas VLANS mientras que a la salida a internet solo la VLAN 10:\nAhora configuraremos las interfaces que interconectan los switches :\nA continuaci√≥n crearemos las dos subintrantes para permitir el trafico entre ellas y le asignaremos direcciones ip .\nAhora el servidor de datos lo conectaremos al puerto Fe0/0 y en el crearemos dos subintrantes , yo utilizare una maquina debian . Esto lo haremos editando en network interfaces :\nComprobamos que las interfaces est√©n subidas :\nAhora crearemos las rutas de enroutamiento:\nUna vez hecho esto podremos hacerle ping al servidor de datos desde las dos interfaces :\nPodemos hacerle ping al servidor de datos y tendremos conectividad con el :\nVemos que el trafico es capaz de llegar al servidor de datos sin embargo este no es capaz de ‚Äúhacer el camino de vuelta ‚Äù.\nTambi√©n he configurado enroutamiento inter vlan , siguiendo los enlaces de la bibliograf√≠a sin embargo no me ha funcionado tampoco.\nEjercicio C Responde a las siguientes preguntas sobre los apartados anteriores:\nC.1 ¬øQu√© pasa con el direccionamiento cuando a√±ades la nube de NAT? ¬øCu√°l es el motivo de este cambio?\nCuando ponemos la nube NAT , esta incluye un servidor DHCP el cual tiene la direccion ip 192.168.122.1 y asignas direcciones de la red 192.168.122.1/24 . A trav√©s de la configuraci√≥n que nos proporciona este nos permitir√° navegar por internet .\nC.2¬øPor qu√© es necesario asignar un disco duro a cada uno de los dispositivos y qu√© tama√±o m√≠nimo debe tener para que el escenario funcione?\nPara los routers cisco 3725 , para que este inicie y supere el chequeo inicial este debe tener como m√≠nimo un espacio de 1MB , adem√°s si queremos guardar las configuraciones esto sera necesario .Por ejemplo para guardar la informaci√≥n de las vlans sera necesario.\nC.3¬øQu√© diferencia hay entre configurar un puerto del switch en modo access y en modo trunk y cu√°ndo hay que usar cada uno de ellos?\nEl modo access esta pensado para conectar un cliente final es decir , un pc . Es el equivalente a el ‚Äú puerto untagged ‚Äú , sin embargo este tiene una limitaci√≥n el cual es que solo puede pertenecer a una vlan , este puerto se encarga adem√°s de eliminar el encabezado que a√±aden los puertos trunk para que los dispositivos finales puedan entender los paquetes .\nPor otro lado el modo trunk permite interconectar un dispositivo de red con otro , por ejemplo un switch con otro switch , seria el equivalente a un ‚Äúpuerto tagged‚Äù , este adem√°s permite el trafico de varios vlans , etiquetando las tramas para que los dem√°s dispositivos puedan interpretar la VLAN a la que pertenece el paquete .\nEjercicio D Sustituye ahora PC1 y PC3 por dos m√°quinas Linux con Firefox instalado (puedes encontrar las im√°genes en el MarketPlace de GNS3) y comprueba que navegan correctamente.\nLo a√±adimos al escenario y los conectamos a las mismas bocas que ten√≠amos nuestros VPCS para que mantengan la configuraci√≥n anterior de las VLANS y tengamos acceso a la nube NAT .\nUna vez hecho esto accederemos a la interfaz de la maquina y configuraremos su tarjeta de red por DHCP , para ello accederemos al panel de control :\nEn el panel de control accedemos a network para configurar la red :\nEn el panel de network diremos que use DHCP y guardamos la configuraci√≥n :\nEn la terminal podemos cerciorarnos de que la configuraci√≥n de red se ha realizado correctamente .\nY podemos ver que haciendo este procedimiento ya podremos navegar con el tinycore con Firefox :\nAqu√≠ la prueba con el segundo tiny core :\nEjercicio E Monta un Port Bonding entre el switch de cabecera y los otros dos. Demuestra su correcto funcionamiento y explica detalladamente como lo has configurado. Explica los flags que puede tener un portchannel.\nA continuaci√≥n deberemos de configurar los puertos extra que hemos a√±adido al escenario para que est√©n en modo trunk y se respete nuestro escenario con las VLANS , es repetir lo que hemos hecho anteriormente.\nLo primero que deberemos de hacer sera crear las interfaces l√≥gicas ,sin embargo este paso lo podemos omitir ya que posteriormente si no existe la interfaz la creara autom√°ticamente .\nIndicaremos que interfaces queremos que pertenezcan al port-channel 1 para el enlace l√≥gico entre R1-R2 y que pertenezcan al port-channel 2 para el enlace l√≥gico entre R2-R3.\nPara R1-R2 :\nPara R2-R1 :\nPara R2-R3 :\nPara R3-R2 :\nTambi√©n podemos configurar el EtherChannel como un enlace trunk, y as√≠ conseguimos multiplexaci√≥n estad√≠stica del tr√°fico de las VLANs y que ante la ca√≠da de un enlace sigue funcionando el otro con ambas VLANs. Esto lo haremos con todos los enlaces l√≥gicos :\nUna vez hecho esto podemos comprobar si est√°n funcionando los etherchannels:\nLa configuraci√≥n de un EtherChannel se puede hacer utilizando uno de estos protocolos :Port Aggregation Protocol (PAgP) o Link Aggregation Control Protocol (LACP).Ambos extremos se deben de configurar en el mismo modo.\nEstos tienen unas serie de ‚Äúmodos ‚Äù en los cuales cambiara el comportamiento del puerto a la hora de crear enlaces :\non: En este modo, los enlaces miembros del grupo se agregar√°n manualmente y no se monitorizar√°n autom√°ticamente. Este modo se utiliza cuando se desea tener un mayor control sobre los enlaces miembros del grupo. desirable: En este modo, el switch intentar√° negociar con el dispositivo conectado en el otro extremo del enlace. Si el dispositivo del otro extremo tambi√©n est√° configurado en modo \u0026ldquo;desirable\u0026rdquo;, se agregar√° autom√°ticamente el enlace. auto: En este modo, el switch no intentar√° negociar sino que agregar√° autom√°ticamente el enlace si el dispositivo conectado en el otro extremo del enlace est√° configurado en modo \u0026ldquo;desirable\u0026rdquo;. active: En este modo, el switch enviar√° constantemente LACP PDUs para determinar si el dispositivo conectado en el otro extremo del enlace est√° disponible y tambi√©n est√° configurado para usar LACP. Si el dispositivo del otro extremo est√° disponible y tambi√©n est√° configurado para usar LACP, se agregar√° autom√°ticamente el enlace. Ejercicio F Port Mirroring: Conecta un PC5 al Switch1 y monitoriza el tr√°fico que sale de PC1. Realiza una captura con Wireshark en la boca correspondiente al PC5 y explica el tr√°fico capturado.\nLo primero que haremos sera configurar el port mirroring , en mi caso enviara el trafico de la boca 1/5 a la 1/4.\nHare en el pc5 un ping a google y monitorizare el cable que va desde el router a pc4 , para comprobar que este funcionando el port mirroring :\nVemos que hemos podido ‚Äúinterceptar ‚Äù un ping , proveniente de la direcci√≥n ip del PC6 .\nEsto har√° que el trafico entrante y saliente del puerto que hemos puesto como sniffer nos lo reenvi√© al puerto que escucha .\nPodemos comprobar el estado de la sesi√≥n del port mirroring con este comando :\nBibliograf√≠a Switching and GNS3 The NAT node Simulando switch cisco en GNS3 GNS3, a√±adiendo hosts a nuestras topolog√≠as Trabajando con switch en GNS3: VLAN y Trunk LACP y PAGP Routing interVLAN Enroutamiento VLAN Configurar PortBonding LinkAggregationControlProtocol(LACP)andPortAggregationProtocol(PAgP) Wikipedia Ether-channel Comunicaci√≥n Inter VLAN ","date":"September 8, 2023","hero":"/images/redes/switches_gns3/portada.png","permalink":"https://www.javiercd.es/posts/redes/switches_gns3/configuracion_de_switches_en_gns3/","summary":"\u003cp\u003eAprender√°s a configurar switches en GNS3, tanto dispositivos gen√©ricos como switches Cisco, utilizando el concepto de VLANs para segmentar la red y explorar las complejidades de la gesti√≥n de redes.\u003c/p\u003e\n\u003ch2 id=\"preparaci√≥n-escenario\"\u003ePreparaci√≥n escenario\u003c/h2\u003e\n\u003cp\u003eLo primero que har√© sera montar el escenario :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/redes/switches_gns3/img/Aspose.Words.1880b7c0-3050-4e53-a32a-505911fdf872.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"configuraci√≥n-de-red-de-los-clientes\"\u003eConfiguraci√≥n de red de los clientes\u003c/h3\u003e\n\u003cp\u003eA continuaci√≥n configurare las tarjetas de red de los clientes , aprovechando que la nube NAT incluye un servidor DHCP.\u003c/p\u003e\n\u003cp\u003ePara hacer esto escribimos en los VPCS el siguiente comando :\u003c/p\u003e","tags":["Redes","Wireshark","GNS3","Cisco","Switches"],"title":"Configuraci√≥n de switches en GNS3"},{"categories":null,"contents":"1.Instalaci√≥n de la caracter√≠stica Lo primero que comprobaremos es comprobar si el servidor ssh esta instalado en la maquina a la cual queremos conectarnos .\nGet-WindowsCapability -Online | Where-Object Name -like \u0026#39;OpenSSH\\*\u0026#39; En el caso de que tengamos la caracter√≠stica la instalaremos :\nAdd-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0 Por defecto el servicio estar√° parado as√≠ que lo arrancamos :\nPodemos configurarlo para que arranque autom√°ticamente al reiniciar el equipo :\n2.Conectarnos usando par de claves Lo primero que haremos sera generar un par de claves en el cliente , con ssh-keygen :\nUsando SCP podemos llevarnos nuestra clave publica o a√±adirla manualmente al fichero de authorized_keys :\nY probamos a conectarnos usando la clave :\nSi queremos que solo el servicio funcione con claves publicas y privadas , editamos el fichero C:\\ProgramData\\ssh\\sshd_config.\nSi queremos conectarnos con un cliente Linux , deberemos hacer el mismo proceso . Si el servidor fuese Linux podr√≠amos usar la utilidad ssh-copy-id sin embargo no es compatible con servidores Windows as√≠ que usaremos scp :\nUna vez a√±adida podremos conectarnos :\n","date":"September 8, 2023","hero":"/images/sistemas/ssh_win/windows-ssh.jpg","permalink":"https://www.javiercd.es/posts/sistemas/ssh_windows/ssh_windows/","summary":"\u003ch2 id=\"1instalaci√≥n-de-la-caracter√≠stica\"\u003e1.Instalaci√≥n de la caracter√≠stica\u003c/h2\u003e\n\u003cp\u003eLo primero que comprobaremos es comprobar si el servidor ssh esta instalado en la maquina a la cual queremos conectarnos .\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ps\" data-lang=\"ps\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eGet-WindowsCapability\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-Online\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e|\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eWhere-Object\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eName\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-like\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e\u0026#39;OpenSSH\\*\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.001.jpeg\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eEn el caso de que tengamos la caracter√≠stica la instalaremos :\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-ps\" data-lang=\"ps\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#a6e22e\"\u003eAdd-WindowsCapability\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-Online\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e-Name\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eOpenSSH.Server~~~~0.0.1.0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.002.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePor defecto el servicio estar√° parado as√≠ que lo arrancamos :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.003.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePodemos configurarlo para que arranque autom√°ticamente al reiniciar el equipo :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/sistemas/ssh_windows/img/Aspose.Words.abd631a7-a62e-4d27-bef0-1d38f74ce102.004.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch2 id=\"2conectarnos-usando-par-de-claves\"\u003e2.Conectarnos usando par de claves\u003c/h2\u003e\n\u003cp\u003eLo primero que haremos sera generar un par de claves en el cliente , con ssh-keygen :\u003c/p\u003e","tags":["Windows","Sistemas","ISO","ASO"],"title":"Configuraci√≥n servicio ssh en Windows"},{"categories":null,"contents":"Configuraci√≥n servidor DNS en Debian Dnsmasq El paquete dnsmasq permite poner en marcha un servidor DNS de una forma muy sencilla. Simplemente instalando y arrancando el servicio dnsmasq, sin realizar ning√∫n tipo de configuraci√≥n adicional, nuestro PC se convertir√° en un servidor cach√© DNS y adem√°s, resolver√° los nombres que tengamos configurados en el archivo /etc/hosts de nuestro servidor. La resoluci√≥n funcionar√° tanto en sentido directo como en sentido inverso, es decir, resolver√° la IP dado un nombre de PC y el nombre del PC dada la IP.\nInstalaci√≥n Para instalarlo solo sera necesario introducir el siguiente comando :\nConfiguraci√≥n A continuaci√≥n, editamos el fichero /etc/dnsmasq.conf y modificamos las siguientes l√≠neas:\n1.Descomentamos strict-order para que se realicen las peticiones DNS a los servidores que aparecen en el fichero /etc/resolv.conf en el orden en √©l aparecen.\n2.Incluimos las interfaces de red que deben aceptar peticiones DNS, descomentar la l√≠nea interface por ejemplo: interface=eth0\nAhora crearemos nuestro archivo de configuraci√≥n :\n3.Creamos el fichero de configuraci√≥n de nuestra zona :\n4.El dominio que hemos elegido es iesgn.org\n5.Suponemos que el nombre del servidor es miservidor.\n6.Vamos a suponer que tenemos un servidor ftp que se llame ftp.iesgn.org y que est√° en 192.168.1.201 (esto es ficticio) y que tenemos dos sitios webs: www.iesgn.org y departamentos.iesgn.org.\n7.Adem√°s queremos nombrar al cliente que ten√≠a asignada una reserva: lisa.\n8.Reiniciamos el servicio\nModificaci√≥n en el servidor DHCP Configura los clientes e indica que su DNS es nuestro servidor. Si tienes un servidor DHCP modificarlo para que env√≠e el nuevo DNS a los clientes.\nEditamos el fichero :\nY reiniciamos el servicio :\nAhora comprobaremos si el cliente nos ha cambiado el dns mirando el siguiente archivo :\nSe nos ha cambiado satisfactoriamente .\nComandos para comprobar funcionamiento dns Comprueba el funcionamiento usando el comando dig/nslookup desde los clientes preguntando por los distintos nombres. Comprueba que el servidor DNS hace de forwarder preguntando con dig/nslookup la direcci√≥n ip de www.josedomingo.org.\nPara la pagina de Jose domingo la respuesta es no autorizada porque nuestro servidor no tiene la resoluci√≥n en su fichero y tiene que utilizar un forwarder\nComo ves arriba yo he creado mi propia zona y a pesar de haber seguido los pasos de esta pagina de Jose domingo , no he conseguido que las respuestas est√©n autorizadas .\nHe creado el archivo dns.conf .\nY he creado mi zona :\nTambi√©n he probado mas cosas sin embargo la √∫nica forma que he conseguido que me de respuesta autorizada es teniendo solo las resoluciones en el fichero host del servidor , sin crear mi zona .\n","date":"September 8, 2023","hero":"/images/servicios/dns/dnsmasq.png","permalink":"https://www.javiercd.es/posts/servicios/dns/dnsmasq/instalacion_basica/dnsmasq/","summary":"\u003ch1 id=\"configuraci√≥n-servidor-dns-en-debian\"\u003eConfiguraci√≥n servidor DNS en Debian\u003c/h1\u003e\n\u003ch2 id=\"dnsmasq\"\u003eDnsmasq\u003c/h2\u003e\n\u003cp\u003eEl paquete dnsmasq permite poner en marcha un servidor DNS de una forma muy sencilla. Simplemente instalando y arrancando el servicio dnsmasq, sin realizar ning√∫n tipo de configuraci√≥n adicional, nuestro PC se convertir√° en un servidor cach√© DNS y adem√°s, resolver√° los nombres que tengamos configurados en el archivo /etc/hosts de nuestro servidor. La resoluci√≥n funcionar√° tanto en sentido directo como en sentido inverso, es decir, resolver√° la IP dado un nombre de PC y el nombre del PC dada la IP.\u003c/p\u003e","tags":["Servicios","NAT","SMR","DHCP","SNAT","DNS","DNSMASQ"],"title":"Configuraci√≥n servidor DNS en Debian"},{"categories":null,"contents":"Los empaquetadores y compresores son elementos fundamentales en la gesti√≥n de archivos y datos en el √°mbito inform√°tico. Los empaquetadores permiten agrupar varios archivos en un solo contenedor, facilitando su manipulaci√≥n y transporte. Por otro lado, los compresores aplican t√©cnicas para reducir el tama√±o de los archivos, contribuyendo al ahorro de espacio de almacenamiento y agilizando la transferencia de datos. Estas herramientas desempe√±an un papel crucial en la optimizaci√≥n de recursos y la eficiencia operativa al organizar, distribuir y respaldar informaci√≥n de manera m√°s eficaz.\nTAR Es un empaquetador de archivos que como su propio nombre indica utiliza el formato .tar, b√°sicamente se utiliza para almacenar ficheros y directorios en un mismo archivo.\nEl nombre del paquete es tar .\nCrear un archivo .tar Puedes crear compresiones .tar tanto para un archivo como para directorios. Un ejemplo de este tipo de archivo es:\ntar -cvf sampleArchive.tar /home/sampleArchive Aqu√≠ /home/sampleArchive es el directorio que necesita ser comprimido creandosampleArchive.tar. Este comando usa las opciones ‚Äìcvf que significan:\nc ‚Äì crear un nuevo archivo .tar v ‚Äì muestra una descripci√≥n detallada del progreso de la compresi√≥n f ‚Äì nombre del archivo Crear un archivo .tar.gz Si deseas una mejor compresi√≥n, tambi√©n puedes usar .tar.gz. Un ejemplo de esto es:\ntar -cvzf sampleArchive.tar.gz /home/sampleArchive La opci√≥n adicional z representa la compresi√≥n gzip. Alternativamente, puedes crear un archivo .tgz que sea similar a tar.gz. Te mostramos un ejemplo de esto √∫ltimo a continuaci√≥n:\ntar -cvzf sampleArchive.tgz /home/sampleArchive Crear un archivo .tar.bz2 El archivo .bz2 proporciona m√°s compresi√≥n en comparaci√≥n con gzip. Sin embargo, esta alternativa tomar√° mas tiempo para comprimir y descomprimir. Para usarla, debes usar la opci√≥n -j. Un ejemplo de c√≥mo se ver√≠a la operaci√≥n es el siguiente:\ntar -cvjf sampleArchive.tar.bz2 /home/sampleArchive Dicha operaci√≥n es similar a .tar.tbz o .tar.tb2. Te muestro un ejemplo a continuaci√≥n:\ntar -cvjf sampleArchive.tar.tbz /home/sampleArchive tar -cvjf sampleArchive.tar.tb2 /home/sampleArchive C√≥mo descomprimir archivos .tar El comando Tar de Linux tambi√©n se puede utilizar para extraer un archivo. El siguiente comando extraer√° los archivos en el directorio actual:\ntar -xvf sampleArchive.tar Si deseas extraer tus archivos a un directorio diferente, puedes usar la opci√≥n -C. Te mostramos un ejemplo de esto a continuaci√≥n:\ntar -xvf sampleArchive.tar -C /home/ExtractedFiles/ Puedes usar un comando similar para descomprimir archivos .tar.gz, tal como se muestra a continuaci√≥n:\ntar -xvf sampleArchive.tar.gz tar -xvf sampleArchive.tar.gz -C /home/ExtractedFiles/ Los archivos .tar.bz2 o .tar.tbz o .tar.tb2 pueden descomprimirse de manera similar. Para esto deber√°s teclear el siguiente comando en la l√≠nea de comando:\ntar -xvf sampleArchive.tar.bz2 C√≥mo listar el contenido de un archivo .tar Una vez que hayas creado el archivo, puedes listar el contenido mediante un comando similar al siguiente:\ntar -tvf sampleArchive.tar Esto mostrar√° la lista completa de archivos junto con las marcas de tiempo y los permisos. Del mismo modo, para .tar.gz, puedes usar un comando como:\ntar -tvf sampleArchive.tar.gz Esto tambi√©n funcionar√≠a para archivos .tar.bz2 como se muestra a continuaci√≥n: tar -tvf sampleArchive.tar.bz2\nC√≥mo descomprimir un √∫nico archivo .tar Una vez que creas un archivo comprimido, puedes extraer un √∫nico archivo de ese comprimido. Esto lo puedes lograr con el comando que te mostramos a continuaci√≥n:\ntar -xvf sampleArchive.tar example.sh Aqu√≠ example.sh es un archivo √∫nico que se extraer√° del comprimido sampleArchive.tar. Alternativamente, tambi√©n puedes usar el siguiente comando:\ntar --extract --file= sampleArchive.tar example.sh Para extraer un solo archivo de un comprimido .tar.gz puedes usar un comando similar al mostrado a continuaci√≥n:\ntar -zxvf sampleArchive.tar.gz example.sh O alternativamente:\ntar --extract --file= sampleArchive.tar.gz example.sh Para extraer un solo archivo de un comprimido .tar.bz2 puedes usar un comando como este:\ntar -jxvf sampleArchive.tar.bz2 example.sh O, alternativamente, uno como este:\ntar --extract --file= sampleArchive.tar.bz2 example.sh C√≥mo extraer m√∫ltiples archivos de los archivos .tar En caso de que desees extraer varios archivos, usa el siguiente formato del comando:\ntar -xvf sampleArchive.tar \u0026#34;file1\u0026#34; \u0026#34;file2\u0026#34; Para .tar.gz puedes usar:\ntar -zxvf sampleArchive.tar.gz \u0026#34;file1\u0026#34; \u0026#34;file2\u0026#34; Para .tar.bz2 puedes usar:\ntar -jxvf sampleArchive.tar.bz2 \u0026#34;file1\u0026#34; \u0026#34;file2\u0026#34; Extraer m√∫ltiples archivos con un patr√≥n Si deseas extraer del comprimido patrones espec√≠ficos de archivos como solo los .jpg, usa el comando wildcards. Una muestra de dicho comando se muestra a continuaci√≥n:\ntar -xvf sampleArchive.tar --wildcards \u0026#39;\\*.jpg\u0026#39; Para .tar.gz puedes usar:\ntar -zxvf sampleArchive.tar.gz --wildcards \u0026#39;\\*.jpg\u0026#39; Para .tar.bz2 puedes usar:\ntar -jxvf sampleArchive.tar.bz2 --wildcards \u0026#39;\\*.jpg\u0026#39; C√≥mo agregar archivos a un archivo .tar Si bien puedes extraer archivos espec√≠ficos, tambi√©n puedes agregar archivos nuevos a un archivo comprimido existente. Para hacerlo, debes usar la opci√≥n -r que significa agregar. El comando Tar puede agregar tanto archivos como directorios.\nA continuaci√≥n se muestra un ejemplo en el que estamos agregando example.jpg al sampleArchive.tar existente.\ntar -rvf sampleArchive.tar example.jpg Tambi√©n podemos agregar un directorio. En el ejemplo que te mostramos a continuaci√≥n, el directorio image_dir se agrega al archivo sampleArchive.tar\ntar -rvf sampleArchive.tar image\\_dir No puedes agregar archivos o carpetas a comprimidos .tar.gz o .tar.bz2.\nC√≥mo verificar un archivo .tar Usando Tar puedes verificar un archivo. Esta es una de las formas en que puedes hacerlo:\ntar -tvf sampleArchive.tar Esto no se puede aplicar en archivos .tar.gz o .tar.bz2.\nC√≥mo verificar el tama√±o del archivo .tar Una vez que crees un archivo, puedes verificar su tama√±o. Este se mostrar√° en KB (Kilobytes).\nA continuaci√≥n te mostramos varios ejemplos del comando a usar para verificar el tama√±o de diferentes tipos de archivos comprimidos:\ntar -czf - sampleArchive.tar | wc -c tar -czf - sampleArchive.tar.gz | wc -c tar -czf - sampleArchive.tar.bz2 | wc -c GZIP Puede comprimir un archivo usando gzip con el comando llamado gzip . El nombre de este paquete es gzip .\nEste es el uso m√°s simple: gzip filename\nEsto comprimir√° el archivo y agregar√° un .gz extensi√≥n a ella. Se elimina el archivo original. Para evitar esto, puede utilizar el- c y use la redirecci√≥n de salida para escribir la salida en elfilename.gzexpediente:\ngzip -c filename \u0026gt; filename.gz los -c La opci√≥n especifica que la salida ir√° al flujo de salida est√°ndar, dejando el archivo original intacto o puede usar el -k opci√≥n:\ngzip -k filename Hay varios niveles de compresi√≥n. Cuanto mayor sea la compresi√≥n, m√°s tiempo llevar√° comprimir (y descomprimir). Los niveles van de 1 (m√°s r√°pido, peor compresi√≥n) a 9 (m√°s lento, mejor compresi√≥n), y el valor predeterminado es 6.\nPuede elegir un nivel espec√≠fico con el - opci√≥n:\ngzip -1 filename Puede comprimir varios archivos enumer√°ndolos:\ngzip filename1 filename2 Puede comprimir todos los archivos de un directorio, de forma recursiva, utilizando el -r :\ngzip -r folder gziptambi√©n se puede utilizar para descomprimir un archivo, utilizando el -d opci√≥n:\ngzip -d filename.gz BZIP2 El bzip2 es muy similar al programa gzip. La principal diferencia es que utiliza un algoritmo de compresi√≥n diferente llamado algoritmo de compresi√≥n de texto de clasificaci√≥n de bloques Burrows-Wheeler y codificaci√≥n Huffman. Los archivos comprimidos con bzip2 finalizar√°n con la extensi√≥n .bz2.\nComo dije, el uso de bzip2 es casi lo mismo que gzip. Simplemente tendremos que reemplazar gzip en los ejemplos anteriores por bzip2, gunzip por bunzip2, zcat con bzcat y as√≠ sucesivamente.\nPara comprimir un archivo usando bzip2, reemplaz√°ndolo por una versi√≥n comprimida, ejecutaremos:\nbzip2 prueba.txt # Nos creara un archivo prueba.txt.bz2 Comprimir los archivos sin eliminar el archivo original\nSi no queremos reemplazar el archivo original, utilizaremos la opci√≥n -c y escribiremos el resultado en un nuevo archivo.\nBzip2 -c prueba.txt # prueba.txt.bz2 Descomprimir archivos\nPara descomprimir un archivo comprimido utilizaremos alguna de las dos siguientes posibilidades:\nbzip2 -d prueba.txt.bz2 bunzip2 prueba.txt.bz2 Ver el contenido de los archivos comprimidos sin descomprimirlos\nPara ver el contenido de un archivo comprimido sin descomprimirlo, no tendremos m√°s que utilizar cualquiera de las opciones:\nbunzip2 -c ubunlog.txt.bz2 bzcat ubunlog.txt.bz2 XZ El paquetes es xz-utils\nComprimir\nEl ejemplo m√°s simple de compresi√≥n de un archivo con xz es el siguiente. Compresi√≥n de archivos con XZ\nxz deb.iso Tambi√©n se puede utilizar la opci√≥n -z para realizar la compresi√≥n:\nxz -z deb.iso Estas √≥rdenes comprimir√°n el fichero, pero eliminar√° el archivo origen. Si no buscamos borrar los archivos de origen, usaremos la opci√≥n -k de la siguiente manera:\nxz -k deb.iso Descomprimir\nPara descomprimir un archivo, vamos a poder utilizar la opci√≥n -d:\nxz -d deb.iso unxz deb.iso Forzar compresi√≥n\nSi una operaci√≥n falla, por ejemplo, si existe un archivo comprimido con el mismo nombre, usaremos la opci√≥n -f para forzar el proceso:\nxz -kf deb.iso Establecer niveles de compresi√≥n\nEsta herramienta admite diferentes niveles preestablecidos de compresi√≥n (de 0 a 9. Con un valor predeterminado de 6). Tambi√©n vamos a poder utilizar alias como ‚Äìfast (ser√° r√°pido, pero con menos compresi√≥n) para establecer como valor 0 y ‚Äìbest para establecer como valor 9 (compresi√≥n lenta pero m√°s alta). Algunos ejemplos de c√≥mo establecer estos niveles, son los siguientes:\nxz -k -8 deb.iso xz -k --best deb.iso Limitar la memoria\nEn caso de tener una cantidad peque√±a de memoria del sistema y querer comprimir un archivo enorme, vamos a tener la posibilidad de utilizar la opci√≥n -memory = l√≠mite (el valor l√≠mite puede estar en MB o como porcentaje de RAM) para establecer un l√≠mite de uso de memoria para la compresi√≥n:\nxz -k --best --memlimit-compress=10% deb.iso Habilitar modo silencioso\nSi nos interesa ejecutar la compresi√≥n en modo silencioso solo habr√° que a√±adir la opci√≥n -q. Tambi√©n podremos habilitar el modo detallado con -v, como se muestra a continuaci√≥n:\nxz -k -q deb.iso xz -k -qv deb.iso Crear un archivo tar.xz\nEl siguiente es un ejemplo del uso para conseguir un archivo con la extensi√≥n tar.xz.\ntar -cf *.txt | xz -7 \u0026gt; deb.tar.xz Crear un archivo tar.xz opci√≥n 2\ntar -cJf deb.tar.xz *.txt Comprobar la integridad de los archivos comprimidos\nPodremos probar la integridad de los archivos comprimidos utilizando la opci√≥n -t. Utilizando -l podremos ver la informaci√≥n sobre un archivo comprimido.\nxz -t deb.tar.xz xz -l deb.tar.xz 7Z Este compresor cuenta con dos paquetes :\np7zip ofrece soporte para 7zr (una versi√≥n ligera de 7z y 7za). Permite comprimir y descomprimir paquetes en estos formatos mediante la herramienta gr√°fica de tu sistema (file-roller en Ubuntu y Debian) pero no dispone de la funcionalidad de cifrado. p7zip-full es, por decirlo de alg√∫n modo, la versi√≥n m√°s completa. Soporta los formatos 7z y 7za e incorpora la funcionalidad de cifrado, adem√°s de las herramientas para la compresi√≥n ZIP Comprimir Uno o Varios Archivos\nEl formato es siempre es la misma, consiste en colocar 7z, seguido de la opci√≥n a (para comprimir o empaquetar), seguido del nombre que quieres dar al paquete final (no hace falta colocar la extensi√≥n .7z) y acabando con el nombre del archivo a comprimir. Podr√°s observar que 7-Zip es capaz de aprovechar todos los n√∫cleos de tu procesador durante la operaci√≥n.\n7z a paquete-comprimido archivo-a-comprimir 7z a paquete-comprimido archivo-1 archivo-2 Si queremos ponerle contrase√±a utilizamos el par√°metro -p :\n7z a -p paquete-comprimido archivo-a-comprimir 7-Zip soporta varios formatos de compresi√≥n o empaquetado, aparte del suyo propio, con esta sentencia podr√°s optar por indicar expl√≠citamente que formato quieres utilizar (puedes escoger entre 7z, zip, gzip, bzip2 o tar).\n7z a -tgzip paquete-comprimido archivo-a-comprimir Listar Contenido de la Carpeta Comprimido\nOtra opci√≥n interesante puede ser listar el contenido dentro de un archivador y ver los detalles. Para ello tienes que situarte igualmente en el directorio en el que se encuentra el archivador o carpeta comprimida y teclear la siguiente sentencia.\n7z l paquete-comprimido.7z Descomprimir Paquete y Extraer Ficheros\nUna vez conocido el contenido dentro del archivador, para extraer de golpe todo el contenido dentro del directorio de trabajo actual, puedes valerte del siguiente comando:\n7z e paquete-comprimido.7z Comprobar Integridad de los Datos\nComo opci√≥n adicional, tambi√©n puedes comprobar la integridad de los diferentes archivos que se encuentran dentro del fichero comprimido. Para ello utiliza esto:\n7z t paquete-comprimida.7z RAR El paquete para instalarlo es rar .\nC√≥mo comprimir RAR en Linux\nPara comprimir un fichero o todos los de una carpeta:\nrar a nombre_fichero_comprimido.rar nombre_fichero_a_comprimir rar a nombre_fichero_comprimido.rar C√≥mo descomprimir RAR en Linux\nY para descomprimir en el mismo directorio o en otro diferente:\nunrar x nombre\\_del\\_rar.rar unrar x nombre\\_del\\_rar.rar /ruta/destino/descomprimido ZIP El nombre del paquete es zip.\nPara comprimir archivos :\nzip archivo.zip archivos Para descomprimir archivos :\nunzip archivo.zip Ver contenido :\nunzip -v archivo.zip Bibliograf√≠a Gu√≠a comando tar Gu√≠a comando gzip Gu√≠a comando bzip2 Gu√≠a xz Gu√≠a comando 7z Gu√≠a comando rar ","date":"September 8, 2023","hero":"/images/sistemas/empaquetadores/portada.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/empaquetadores_compresores/empaquetadores-compresores-descompresores/","summary":"\u003cp\u003eLos empaquetadores y compresores son elementos fundamentales en la gesti√≥n de archivos y datos en el √°mbito inform√°tico. Los empaquetadores permiten agrupar varios archivos en un solo contenedor, facilitando su manipulaci√≥n y transporte. Por otro lado, los compresores aplican t√©cnicas para reducir el tama√±o de los archivos, contribuyendo al ahorro de espacio de almacenamiento y agilizando la transferencia de datos. Estas herramientas desempe√±an un papel crucial en la optimizaci√≥n de recursos y la eficiencia operativa al organizar, distribuir y respaldar informaci√≥n de manera m√°s eficaz.\u003c/p\u003e","tags":["Linux","Sistemas","ISO","ASO"],"title":"Empaquetadores y compresores en Linux"},{"categories":null,"contents":"En esta pr√°ctica, exploraremos la creaci√≥n de un escenario mediante la orquestaci√≥n de OpenStack y, posteriormente, llevaremos a cabo el enrutamiento para asegurar la conectividad entre las distintas m√°quinas virtuales. Este ejercicio nos permitir√° comprender y aplicar el uso de OpenStack para gestionar entornos virtuales, adem√°s de configurar la red de manera eficiente para facilitar la comunicaci√≥n entre los diferentes dispositivos en el escenario.\nEscenario a montar en OpenStack Para poder montar nuestro escenario en OpenStack debido a la situaci√≥n actual de las im√°genes que hay disponibles , necesitaremos preparar una instancia la cual tenga habilitado el acceso por contrase√±a . Adem√°s si posteriormente a partir de una queremos configurar otra habilitar el acceso ssh por contrase√±a para este usuario .\nEsta tendremos que crearla con el mismo flavour con las que generaremos el escenario para evitar errores .\nCuanto tengamos a punto nuestra instancia comprobaremos que puedes iniciar sesi√≥n desde horizon :\nAhora crearemos una instant√°nea :\nCopiaremos el ID de las instant√°nea :\nY lo a√±adiremos al fichero :\nY lo desplegaremos :\nVemos que se ha creado correctamente :\nEsquema gr√°fico de la configuraci√≥n El esquema quedar√≠a de la siguiente manera :\nTeniendo la siguiente relaci√≥n de IPS :\nMAQUINA IP INTERFAZ PC1 10.0.100.144 ens3 R1-PC1 10.0.100.68 ens3 R1-R2 10.0.110.78 ens4 R2-R1 10.0.110.30 ens3 R2-PC2 10.0.120.191 ens4 PC2 10.0.120.203 ens3 R2-R3 10.0.130.146 ens5 R3-R2 10.0.130.36 ens3 R3-PC3 10.0.140.127 ens4 PC3 10.0.140.158 ens3 Tablas de enrutamiento\nR1 10.0.100.0/24 0.0.0.0 ens3 10.0.110.0/24 0.0.0.0 ens4 10.0.120.0/24 10.0.110.30 ens4 10.0.130.0/24 10.0.110.30 ens4 10.0.140.0/24 10.0.110.30 ens4 0.0.0.0/0 10.0.110.30 ens4 *Las redes en las que estamos directamente conectados se crearan autom√°ticamente las rutas.\nR2 10.0.100.0/24 10.0.110.178 ens3 10.0.110.0/24 0.0.0.0 ens3 10.0.120.0/24 0.0.0.0 ens4 10.0.130.0/24 0.0.0.0 ens5 10.0.140.0/24 10.0.130.36 ens5 0.0.0.0/0 10.0.130.36 ens5 *Las redes en las que estamos directamente conectados se crearan autom√°ticamente las rutas.\nR3 10.0.100.0/24 10.0.130.146 ens3 10.0.110.0/24 10.0.130.146 ens3 10.0.120.0/24 10.0.130.146 ens3 10.0.130.0/24 0.0.0.0 ens3 10.0.140.0/24 0.0.0.0 ens4 0.0.0.0/0 10.0.130.146 ens4 Comandos de configuraci√≥n de cada nodo Router 1 Como es un router deberemos de activar el bit de forwarding para ello introduciremos el siguiente comando :\necho 1 \u0026gt; /proc/sys/net/ipv4/ip\\_forward Crearemos la tabla de enrutamiento :\nLas rutas est√°ticas :\nip route add 10.0.100.0/24 via 0.0.0.0 dev ens3 La ruta por defecto:\nip route add default via 10.0.110.30 dev ens4 Nos quedar√≠a as√≠ la tabla de enrutamiento :\nPC1 Borraremos la ruta por defecto que exista en el dispositivo\nY a√±adiremos la nueva ruta\nRouter 2 Como es un router deberemos de activar el bit de forwarding para ello introduciremos el siguiente comando :\necho 1 \u0026gt; /proc/sys/net/ipv4/ip\\_forward Crearemos la tabla de enrutamiento :\nQuedar√≠a as√≠ :\nPC2 Al igual que hicimos anteriormente eliminaremos la ruta por defecto que trae y la a√±adiremos la nueva :\nActivaremos el bit de forwarding con el siguiente comando :\necho 1 \u0026gt; /proc/sys/net/ipv4/ip\\_forward Crearemos la tabla de enrutamiento para nuestro escenario :\nLa tabla de enrutamiento quedar√≠a as√≠ :\nPC3 Al igual que con los dem√°s deberemos de cambiar la ruta por defecto por la ip del router a la que estamos conectado :\nResumen de configuraci√≥n y aclaraciones Para los routers Activar el bit de forwarding Crear las tablas de enrutamiento Modificar la ruta por defecto Para los PCs Modificar la ruta por defecto Lo de modificar la ruta por defecto , es debido a que no puedo modificar la configuraci√≥n de las tarjetas de red por lo que no puedo modificar la puerta de enlace .\nPor defecto al utilizar el script esta viene con la puerta de enlace X.X.X.1 sin embargo esta no coincide con la puerta de enlace de los clientes .\nPara los routers debemos de modificarla tambi√©n para indicar por donde mandaremos el trafico ‚Äúpor defecto‚Äù.\nSi queremos hacer que el bit del forwarding se guarde permanentemente para que cuando reiniciemos el equipo este no vuelva a 0 :\n‚Äì\u0026gt; Escribimos directamente en el archivo /etc/sysctl.conf:\nSi queremos volcar en un archivo la configuraci√≥n de las tablas de enrutamiento para tener una copia de seguridad de las mismas usamos :\nSi queremos restaurar la copia :\nVerificaci√≥n de conectividad (ping) entre nodos PC1 PC1 ‚Äì PC2\nPC1-PC3\nPC2 PC2-PC1\nPC2-PC3\nPC3 PC3-PC1\nPC3-PC2\nCaptura de tr√°fico en el router r2 o r3 mostrando tr√°fico entre h1 y h3. Para hacer una captura de una determinada interfaz y guardarla en un archivo utilizaremos tcpdump:\ntcpdump -i NOMBRE\\_INTERFAZ -w NOMBRE\\_ARCHIVO Si queremos tener una salida al comando en lugar de guardar el archivo usaremos el par√°metro -n: Aqu√≠ vemos como llegan los ICMP REQUEST de PC3 a PC1 y los ICMP REPLY DE PC1 a PC3\nAdem√°s he capturado una petici√≥n y respuesta arp de PC3:\nBibliograf√≠a Como hacer tablas de enrutamiento ","date":"September 8, 2023","hero":"/images/redes/enrutamiento_os/portada.png","permalink":"https://www.javiercd.es/posts/redes/enroutamiento_openstack/enroutamiento_openstack/","summary":"\u003cp\u003eEn esta pr√°ctica, exploraremos la creaci√≥n de un escenario mediante la orquestaci√≥n de OpenStack y, posteriormente, llevaremos a cabo el enrutamiento para asegurar la conectividad entre las distintas m√°quinas virtuales. Este ejercicio nos permitir√° comprender y aplicar el uso de OpenStack para gestionar entornos virtuales, adem√°s de configurar la red de manera eficiente para facilitar la comunicaci√≥n entre los diferentes dispositivos en el escenario.\u003c/p\u003e\n\u003ch2 id=\"escenario-a-montar-en-openstack\"\u003eEscenario a montar en OpenStack\u003c/h2\u003e\n\u003cp\u003ePara poder montar nuestro escenario en OpenStack debido a la situaci√≥n actual de las im√°genes que hay disponibles , necesitaremos preparar una instancia la cual tenga habilitado el acceso por contrase√±a . Adem√°s si posteriormente a partir de una queremos configurar otra habilitar el acceso ssh por contrase√±a para este usuario .\u003c/p\u003e","tags":["Redes","Enrutamiento"],"title":"Enrutamiento en OpenStack"},{"categories":null,"contents":"Servidor FTP bajo debian Instalaci√≥n y configuraci√≥n del servidor proFTPd autentificado 1.Primero nos crearemos un grupo que se llame ftpgroup : 2.Crea dos usuarios locales que pertenezcan al grupo ftp que hemos creado: Jose y Maria\n3.Nos instalamos el servicio ftp :\n4.Configuraci√≥n b√°sica del fichero proftpd.conf:\nTodos los usuarios accedan solo a su directorio :\nAhora podemos acceder desde el navegador con los usuarios Jose y Maria :\nCada uno de estos he creado una carpeta con su nombre dentro de sus directorios personales para poder identificarlos .\nPara que cada usuario pueda conectarse realmente al servidor FTP en Debian y le sea posible subir y descargar los datos en su propio directorio, debes introducir su directorio de entrada en proftpd.conf :\nPodemos transferir archivos correctamente :\nConfiguraci√≥n de proFTPd para crear ftp an√≥nimo Lo primero que tenemos que hacer es crear el directorio y darle el propietario adecuado:\nAhora cambiaremos esta regla y permitiremos que todos puedan unirse :\nAdemas a√±adimos las siguientes lineas e indicaremos la ruta a la que acceder√°n los an√≥nimos :\nPor lo que cuando reiniciemos podr√°n conectarse los usuarios an√≥nimos :\nPero no con los usuarios que hemos creado anteriormente :\nPara permitir que nuestros usuarios se puedan conectar ademas de los an√≥nimos:\nAhora aplicamos estos cambios y probamos a conectarnos . Vemos que con an√≥nimos no podemos copiar nada al servidor pero si podemos descargar.\nAhora con un usuario del grupo , podremos copiar archivos :\n","date":"September 8, 2023","hero":"/images/servicios/ftp/portada-ftp.png","permalink":"https://www.javiercd.es/posts/servicios/ftp/ftp/","summary":"\u003ch1 id=\"servidor-ftp-bajo-debian\"\u003eServidor FTP bajo debian\u003c/h1\u003e\n\u003ch2 id=\"instalaci√≥n-y-configuraci√≥n-del-servidor-proftpd-autentificado\"\u003eInstalaci√≥n y configuraci√≥n del servidor proFTPd autentificado\u003c/h2\u003e\n\u003cp\u003e1.Primero nos crearemos un grupo que se llame ftpgroup :\n\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.160.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e2.Crea dos usuarios locales que pertenezcan al grupo ftp que hemos creado: Jose y Maria\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.161.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e3.Nos instalamos el servicio ftp :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.162.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003e4.Configuraci√≥n b√°sica del fichero proftpd.conf:\u003c/p\u003e\n\u003cp\u003eTodos los usuarios accedan  solo a su directorio :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.163.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eAhora podemos acceder desde el navegador con los usuarios Jose y Maria  :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ftp/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.164.png\" alt=\"\"\u003e\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT","SSH","FORWARDING","APACHE","FTP"],"title":"FTP bajo debian "},{"categories":null,"contents":"En el ecosistema de Linux, un proceso es la ejecuci√≥n de un programa espec√≠fico que realiza una tarea particular. Cada proceso tiene su propio identificador √∫nico (PID) y est√° compuesto por un conjunto de recursos, como memoria y CPU, que le permiten funcionar de manera independiente.\nEn el universo de Linux, la gesti√≥n efectiva de procesos es una habilidad crucial para optimizar el rendimiento y asegurar la estabilidad del sistema. Este post te sumergir√° en los fundamentos esenciales de la gesti√≥n de procesos\nPS Si no a√±adimos ning√∫n par√°metro, ps mostrar√° los procesos del usuario con el que estamos logueados. Por otra parte, los par√°metros m√°s b√°sicos a conocer son los siguientes:\naux : Lista los procesos de todos los usuarios con informaci√≥n a√±adida (destacamos m√°s abajo).\n-a Lista los procesos de todos los usuarios.\n-u Lista informaci√≥n del proceso como por ejemplo el usuario que lo est√° corriendo, la utilizaci√≥n de CPU y memoria, etc.\n-x Lista procesos de todas las terminales y usuarios\n-l Muestra informaci√≥n que incluye el UID y el valor ¬´nice¬´.\n‚Äì-forest Muestra el listado procesos en un formato tipo √°rbol que permite ver como los procesos interact√∫an entre si, podr√≠a ser algo similar al comando pstree.\nPSTREE El programa pstree facilita informaci√≥n sobre la finalizaci√≥n de una serie de procesos relacionados entre s√≠, esto es, todos los descendientes de un proceso particular. El programa deja claro desde un principio que proceso es el primario y cuales son los secundarios. Esto evita buscar las relaciones entre los diversos procesos de manera manual.\nPar√°metros com√∫nmente utilizados :\n-H: Si nos interesa podemos ver el √°rbol de un proceso espec√≠fico:\n-g: Nos agrupara los procesos por grupos :\n-n: Nos permite ordenar la salida por el numero de PID:\n-p: Muestra el numero de PID\n-s:Muestra los procesos padres\nSYSTEMCTL STATUS Este comando se utiliza para ver el estado en el que se encuentra un servicio , Espec√≠ficamente, muestra informaci√≥n sobre si el servicio o unidad est√° activo o inactivo, y si est√° en ejecuci√≥n o detenido. Tambi√©n muestra cualquier mensaje de error o advertencia relacionado con el servicio o unidad. Este comando es √∫til para verificar el estado de un servicio o unidad en el sistema y para resolver problemas relacionados con ellos.\nTOP Es un programa todo en uno: simult√°neamente cumple las funciones de ps y kill. Es un comando de modo consola, por lo que debe iniciarlo desde una terminal .\nDentro de este podemos controlarlo usando las siguientes teclas:\n-k: este comando se usa para enviar una se√±al a un proceso. Luego, top le preguntar√° por el PID del proceso, seguido del n√∫mero de la se√±al a enviar (predeterminadamente TERM ‚Äî o 15);\n-M: este comando se usa para ordenar el listado de los procesos de acuerdo a la memoria que usan (campo %MEM);\n-P: este comando se usa para\nordenar el listado de procesos de acuerdo al tiempo de CPU que consumen(campo %CPU; este es el m√©todo de ordenamiento predeterminado);\n-u: este comando se usa para mostrar los procesos de un usuario en particular, top le preguntar√° de cual. Debe ingresar el nombre del usuario.\n-i: este comando act√∫a como un interruptor; predeterminadamente se muestran todos los procesos, incluso los que est√°n dormidos; este comando asegura que se muestran s√≥lo los procesos que est√°n en curso de ejecuci√≥n :\nHTOP Htop es la version mejorada y actual de top la cual tiene una interfaz mas amigable y mas funcionalidades las cuales nos ayudaran a la supervisi√≥n de procesos . Este se divide en varias partes :\nEl encabezado divide la parte superior de la interfaz en secciones izquierda y derecha. Estos muestran el uso de la CPU/memoria, el espacio de intercambio, el tiempo de actividad de la m√°quina, las tareas y la carga promedio.\nLa secci√≥n superior izquierda muestra una l√≠nea para cada n√∫cleo de CPU. Por ejemplo, la captura de pantalla anterior muestra dos n√∫cleos de CPU, con el porcentaje que representa la carga en cada uno.\nTambi√©n puede ver el c√≥digo de colores proporcionado por htop para identificar qu√© tipo de procesos utilizan la CPU:\nRojo: porcentaje ocupado por procesos del sistema Azul: porcentaje ocupado por proceso de baja prioridad Verde: porcentaje ocupado por procesos de usuario Las l√≠neas de memoria tambi√©n usan c√≥digos de colores, esta vez para representar:\nAmarillo: porcentaje ocupado por cach√© contenido Verde: porcentaje ocupado por la memoria utilizada Azul: porcentaje ocupado por contenido buffer El panel central muestra todos los procesos en ejecuci√≥n con sus estad√≠sticas asociadas seg√∫n la utilizaci√≥n de la CPU. Muestra la siguiente informaci√≥n para cada proceso:\nID de proceso (PID) El propietario (Usuario) Consumo de memoria virtual porcentaje de procesador memoria f√≠sica Para finalizar este programa tambi√©n es interactivo , abajo tenemos un √≠ndice donde podemos comprobar las funciones que nos permite usar :\nAdem√°s disponemos de varios atajos de teclados :\nu Ordenar procesos por nombre de usuario p Alternar con la ruta del programa F2 o S Entrar en Configuraci√≥n F3 o / Proceso de b√∫squeda F5 o t Vista ordenada o de √°rbol F6 +/- Seleccione el proceso principal para expandir/contraer el √°rbol F7 o [ Aumentar la prioridad solo para root F8 o ] Prioridad baja (bueno +) F9 o k Matar proceso H Alterna con subprocesos de proceso de usuario K Alterna con subprocesos de proceso del kernel \u0026amp; El s√≠mbolo \u0026amp; es un operador de shell en Unix y Linux que permite ejecutar un proceso en segundo plano. Al colocar \u0026amp; al final de un comando, se ejecutar√° el proceso en segundo plano y se le asignar√° una tarea en segundo plano. Esto significa que el proceso se ejecutar√° en paralelo con otras tareas y no bloquear√° la terminal o la l√≠nea de comandos hasta que finalice.\nJOBS Este comando listara los procesos que se encuentran en segundo pano as√≠ como su estado , nos permite saber su PID:\nFG Complementando al comando anterior , este nos permite reanudar en primer plano el √∫ltimo trabajo que fue suspendido.:\nListando con jobs podemos mandar un proceso en especifico a primer plano :\nBG Cuando un comando se est√° ejecutando puedes suspenderlo usando ctrl-Z. El comando se detendr√° inmediatamente, y volver√°s al shell de la terminal.\nPuedes reanudar la ejecuci√≥n del comando en segundo plano, as√≠ que seguir√° ejecut√°ndose pero no te impedir√° hacer otro trabajo en la terminal.\nKILL Los procesos de Linux pueden recibir se√±ales y reaccionar a ellas. Esa es una forma en la que podemos interactuar con los programas en ejecuci√≥n. El programa kill puede enviar una variedad de se√±ales a un programa. No s√≥lo se usa para terminar un programa, como el nombre lo sugiere, sino que es su principal trabajo Por defecto, este manda una se√±al TERM al identificador de proceso indicado.\nPodemos listar las se√±ales con kill -l :\nMandamos una se√±al con el par√°metro -s seguida del numero de esta y el PID del proceso :\nXKILL Este es el m√©todo m√°s sencillo y el m√°s pr√°ctico. El cursor del mouse se transformar√° en una peque√±a calavera. Todo lo que resta es hacer clic en la ventana que quer√©s cerrar y voil√°. Chau proceso.\nKILLALL Similar al comando kill, killall enviar√° la se√±al a m√∫ltiples procesos a la vez en lugar de enviar una se√±al a un identificador de proceso espec√≠fico . Por ejemplo, puedes tener m√∫ltiples instancias del programa top en ejecuci√≥n, y killall top terminar√° con todos ellos.\nPuedes especificar la se√±al, como con kill :\nPor ejemplo podemos matar todos los tops :\nPIDOF Te permite encontrar el ID del proceso de un programa en ejecuci√≥n:\n-s: Petici√≥n √∫nica - ordena al programa devolver un √∫nico identificador de proceso\nPID BASH echo t$$ ‚Üí id bash\nEs una forma r√°pida de encontrar el identificador actual de la bash :\nNICE Ejecuta un comando con una prioridad determinada, o modifica la prioridad a de un proceso (programa en ejecuci√≥n). Utiliza una prioridad variable que parte de la prioridad del shell y suma o resta valores. Mientras menor es el valor de la prioridad mayor prioridad tiene el proceso.\nEl valor de la prioridad del proceso find aumenta en 5, disminuye su prioridad.\nRENICE Sirve para cambiar la prioridad de un proceso :\nPKILL Este comando nos permite matar un proceso del que conocemos su nombre completo o parte de √©l. Veamos un ejemplo:\nBibliograf√≠a Gu√≠a de uso pstree Gu√≠a de uso env√≠o de se√±ales Gu√≠a de uso htop Gu√≠a de uso nice , renice , kill \u0026hellip; ","date":"September 8, 2023","hero":"/images/sistemas/comandos_procesos/portata_procesos.jpg","permalink":"https://www.javiercd.es/posts/sistemas/comandos_linux/comandos_procesos/comandos_procesos/","summary":"\u003cp\u003eEn el ecosistema de Linux, un proceso es la ejecuci√≥n de un programa espec√≠fico que realiza una tarea particular. Cada proceso tiene su propio identificador √∫nico (PID) y est√° compuesto por un conjunto de recursos, como memoria y CPU, que le permiten funcionar de manera independiente.\u003c/p\u003e\n\u003cp\u003eEn el universo de Linux, la gesti√≥n efectiva de procesos es una habilidad crucial para optimizar el rendimiento y asegurar la estabilidad del sistema. Este post te sumergir√° en los fundamentos esenciales de la gesti√≥n de procesos\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Gesti√≥n de Procesos en Linux"},{"categories":null,"contents":" ‚ö†Ô∏è Advertencia: Este post fue desarrollado para Debian 11. Si tienes una versi√≥n m√°s reciente, puedes revisar el post para Debian 12 que encontrar√°s en el apartado de redes de esta misma p√°gina. La √∫nica parte que no deber√≠as seguir si cumples con esta condici√≥n es la instalaci√≥n de GNS3. Todo el resto del contenido sigue siendo valido .\n1. Introducci√≥n Wireshark es un analizador de protocolos utilizado para realizar an√°lisis y solucionar problemas en redes de comunicaciones, para an√°lisis de datos y protocolos, y como una herramienta did√°ctica.\nA√±ade una interfaz gr√°fica y muchas opciones de organizaci√≥n y filtrado de informaci√≥n. As√≠, permite ver todo el tr√°fico que pasa a trav√©s de una red estableciendo la configuraci√≥n en modo promiscuo de nuestra tarjeta de red . Tambi√©n incluye una versi√≥n basada en texto llamada tshark.\nPermite examinar datos o de un archivo de captura salvado en disco. Se puede analizar la informaci√≥n capturada, a trav√©s de los detalles y sumarios por cada paquete. Wireshark incluye un completo lenguaje para filtrar lo que queremos ver y la habilidad de mostrar el flujo reconstruido de una sesi√≥n de TCP.\nWireshark es software libre, y se ejecuta sobre la mayor√≠a de sistemas operativos Unix y compatibles.\nLos requisitos m√≠nimos para utilizar este software son :\nCualquier procesador moderno AMD64/x86-64 de 64 bits o x86 de 32 bits. 500 MB de RAM disponibles. Los archivos de captura m√°s grandes requieren m√°s RAM. 500 MB de espacio disponible en disco. Los archivos de captura requieren espacio en disco adicional. Cualquier pantalla moderna. Se recomienda una resoluci√≥n de 1280 √ó 1024 o superior. Wireshark utilizar√° resoluciones HiDPI o Retina si est√°n disponibles. Los usuarios avanzados encontrar√°n √∫tiles varios monitores. Una tarjeta de red compatible para capturar 1.1 Descarga del paquete en deb√≠an Para descargar el paquete en nuestro equipo deberemos de mirar en la pagina oficial de descargas si incluye soporte para nuestro sistema operativo .\nVemos que no aparece en la lista ning√∫n sistema operativo GNU/Linux , esto es porque Wireshark est√° disponible a trav√©s del sistema de empaquetado predeterminado en la mayor√≠a de estas plataformas . Es decir esta presente en los repositorios de nuestra distribuci√≥n , en el caso de que no estuviese tenemos el c√≥digo fuente al ser un software libre y podr√≠amos compilarlo .\nPodemos comprobar si esta disponible en nuestro sistema operativo visitando la pagina oficial :\nVemos que Debian aparece en la lista esto quiere decir que el paquete esta en los repositorios oficiales de deb√≠an.\nEn Debian contamos con el gestor de paquetes apt , as√≠ que podemos comprobar la versi√≥n del paquete disponible para la instalaci√≥n y comprobar desde que repositorios se nos descargara con el siguiente comando :\nPara realizar la instalaci√≥n de wireshark introduciremos el siguiente comando :\nA continuaci√≥n para hacer capturas de red en el equipo necesitaremos permisos para nuestro usuario para ello , utilizaremos el siguiente comando :\n1.2 Comprobaci√≥n de funcionamiento Ahora abriremos el programa para comprobar que todo funciona correctamente :\nAhora iniciaremos una captura de paquetes para ello si queremos hacerla sobre un interfaz en concreta pulsamos sobre ella , en mi caso usare la tarjeta de red inal√°mbrica wlo1 y har√© una petici√≥n web a la pagina jagger.es .\nAqu√≠ te muestro la petici√≥n DNS que ha viajado desde mi port√°til hasta el router .\n1.3 Componentes de wireshark generales Wireshark hace uso de unos determinados paquetes : Wireshark : el analizador de protocolos de red que todos conocemos . TShark : un analizador de protocolo de red de l√≠nea de comandos. Complementos y extensiones : extras para los motores de disecci√≥n Wireshark y TShark Complementos Dissector : complementos con algunas disecciones extendidas. Complementos de estad√≠sticas de √°rbol -:Estad√≠sticas extendidas. Mate: motor de seguimiento y meta an√°lisis : extensiones configurables por el usuario del motor de filtro de pantalla; consulte el Cap√≠tulo 12, MATE para obtener m√°s detalles. MIB de SNMP: MIB de SNMP para una disecci√≥n de SNMP m√°s detallada. Herramientas : herramientas de l√≠nea de comandos adicionales para trabajar con archivos de captura Editcap : lee un archivo de captura y escribe algunos o todos los paquetes en otro archivo de captura. Text2Pcap : lee un volcado hexadecimal ASCII y escribe los datos en un archivo de captura pcap. Reordercap : reordena un archivo de captura por marca de tiempo. Mergecap : combina varios archivos de captura guardados en un √∫nico archivo de salida. Capinfos : proporciona informaci√≥n sobre los archivos de captura. Rawshark : filtro de paquetes sin procesar. Gu√≠a del usuario : instalaci√≥n local de la Gu√≠a del usuario. Los botones de Ayuda en la mayor√≠a de los cuadros de di√°logo requerir√°n una conexi√≥n a Internet para mostrar las p√°ginas de ayuda si la Gu√≠a del usuario no est√° instalada localmente. 2 Instalaci√≥n de GNS3 en Debian 11 2.1 Introducci√≥n GNS3 es un simulador gr√°fico de red lanzado en 2008, que te permite dise√±ar topolog√≠as de red complejas y poner en marcha simulaciones sobre ellos,permitiendo la combinaci√≥n de dispositivos tanto reales como virtuales.\nPara permitir completar simulaciones, GNS3 est√° estrechamente vinculada con:\nDynamips: un emulador de IOS que permite a los usuarios ejecutar im√°genes de IOS . Dynagen: un front-end basado en texto para Dynamips . Qemu y VirtualBox: para permitir utilizar m√°quinas virtuales como un firewall PIX o estaciones de trabajo . VPCS: un emulador de PC con funciones b√°sicas de networking . IOU: (IOS en Unix), compilaciones especiales de IOS provistas por Cisco para correr directamente en sistemas UNIX y derivados . Los requisitos m√≠nimos para hacer uso de esta herramienta son :\nProcesador : 2 o m√°s n√∫cleos l√≥gicos Virtualizaci√≥n: Se requieren extensiones de virtualizaci√≥n. Es posible que deba habilitar esto a trav√©s del BIOS de su computadora. Memoria RAM: 4 GB de RAM Almacenamiento : 1 GB de espacio disponible (la instalaci√≥n de Windows es \u0026lt; 200 MB). Notas adicionales : Es posible que necesite almacenamiento adicional para su sistema operativo y las im√°genes del dispositivo. 2.2 Instalaci√≥n Lo primero que haremos antes de instalar sera comprobar que nuestro sistema este actualizado , para ello haremos un apt update y si tenemos paquetes desactualizados haremos un apt upgrade .\nA continuaci√≥n instalaremos todas las dependencias que necesita GNS3 :\nAhora te describir√© la funci√≥n de los paquetes que vamos a instalar :\nPaquete Descripci√≥n python3-pip El m√≥dulo pip es el instalador de paquetes de Python. python3-pyqt5 El m√≥dulo PyQt5 expone la API de Qt5 a Python 3 . python3-pyqt5.qtsvg El m√≥dulo SVG de PyQt5 proporciona clases para mostrar el contenido de los archivos SVG. python3-pyqt5.qtwebsockets El m√≥dulo WebSockets de PyQt5 proporciona enlaces de Python 3 para la especificaci√≥n WebSockets (tanto cliente como servidor). qemu Software de Virtualizaci√≥n , actualmente se encuentra dividido en varios paquetes . qemu-kvm Binarios de emulaci√≥n de sistema completo QEMU . qemu-utils Binario de utilidades de emulaci√≥n de QEMU . libvirt-clients Libvirt es un conjunto de herramientas en C para interactuar con las capacidades de virtualizaci√≥n de versiones recientes de Linux . libvirt-daemon-system Este paquete contiene los archivos de configuraci√≥n para ejecutar el demonio libvirt como un servicio del sistema. Virtinst Este paquete contiene algunas utilidades de l√≠nea de comandos para crear y editar m√°quinas virtuales . wireshark Es un analizador de red que captura paquetes para su posterior an√°lisis . xtightvncviewer Sistema de visualizaci√≥n remota que le permite ver un entorno de \u0026rsquo;escritorio\u0026rsquo; no solo en la m√°quina donde se est√° ejecutando, sino desde cualquier lugar en Internet . apt-transport-https Este es un paquete de transici√≥n ficticio: la compatibilidad con https . ca-certificates Contiene los certificados de las autoridades certificadoras que se incluyen en el navegador de Mozilla para permitir que las aplicaciones basadas en SSL . curl curl es una herramienta de l√≠nea de comandos para transferir datos con sintaxis URL . gnupg2 Se puede utilizar para cifrar datos y crear firmas digitales. Incluye una funci√≥n avanzada de administraci√≥n de claves y cumple con el est√°ndar de Internet OpenPGP propuesto. software-properties-common Le permite administrar f√°cilmente su distribuci√≥n y las fuentes de software de proveedores de software independientes. Una vez instalados estos paquetes , nos descargaremos GNS3 utilizando pip3 :\nAdem√°s nos fijaremos en la salida del comando para comprobar si hay alg√∫n error :\nLo siguiente sera instalar docker , el cual nos permitir√° crear contenedores . Para ello importaremos su clave GPG para que nuestro sistema confi√© en el :\nLo siguiente sera a√±adir el repositorio a nuestro sistema para ello utilizaremos el siguiente comando:\nActualizaremos los repositorios que utiliza apt haciendo un apt update :\nY finalmente podremos instalar docker :\nAgregue las siguientes l√≠neas a su /etc/apt/sources.list , para que podamos instalar dynamips y ubridge:\nPara poder instalar los paquetes necesarios de estos repositorios , a√±adiremos las claves gpg del mismo :\nActualizaremos los repositorios que utiliza apt haciendo un apt update :\nNos instalaremos los paquetes Dynamips y ubridge :\nSaldr√° un recuadro como este , para indicar si los usuarios que no son superusuarios pueden capturar paquetes , le diremos que si en nuestro caso :\nPara evitar la instalaci√≥n accidental de cualquier otra cosa de ese repositorio (por ahora), elimine o comente esas dos l√≠neas en su archivo /etc/apt/sources.list y haga un apt update:\nTambi√©n podemos eliminar la clave GPG de estos repositorios si lo deseamos :\nA√±adiremos a los usuarios que vayan a utilizar la herramienta a los siguientes grupos :\nReinicie su sesi√≥n de usuario cerrando sesi√≥n y volviendo a iniciarla, o reiniciando el sistema para que se apliquen estos cambios .\n2.3 Nuestra primera topolog√≠a en GNS3 Una vez reiniciado el sistema iniciaremos la aplicaci√≥n , y nos saldr√° un recuadro como este :\nAqu√≠ indicaremos que voy a correr las aplicaciones localmente en mi maquina .A continuaci√≥n seleccionaremos la ruta del servidor , el nombre de host y el puerto asociado :\nSi todo ha sido correcto , nos dir√° que se ha realizado correctamente :\nCuando abramos el programa , nos dar√° opci√≥n a crear un proyecto o podemos crear uno nuevo , en mi caso creare uno :\nSi nos fijamos en la parte izquierda del programa veremos los siguientes s√≠mbolos que sirven para lo siguiente :\nA√±adiremos arrastrando 2 VPCS :\nLe a√±adiremos un Ethernet swicht :\nHaremos clic en el bot√≥n Agregar un enlace para dejar de agregar enlaces , nos quedar√≠a as√≠ el escenario :\nPodemos hacer visible la interfaz a la cual los hemos conectado pulsando en el siguiente bot√≥n :\nEl bot√≥n verde \u0026ldquo;Reproducir\u0026rdquo; en la barra de herramientas GNS3 encender√° todos los dispositivos en la topolog√≠a, mientras que el bot√≥n amarillo \u0026ldquo;Pausa\u0026rdquo; los suspender√° y el bot√≥n rojo \u0026ldquo;Detener\u0026rdquo; apagar√° todo en la topolog√≠a:\nNos saldr√° una advertencia , para que confirmemos si queremos a√±adir todos los dispositivos , le daremos a si :\nVeremos que tanto a la izquierda en el resumen de dispositivos como en las conexiones salientes de los dispositivos su ‚Äúluz‚Äù de estado a cambiado de rojo a verde , puestos que estos ahora est√°n encendidos :\nAhora abriremos una terminal en todos nuestros VPCS , con el siguiente bot√≥n :\nA trav√©s de estas terminales le asignaremos direcciones ips a nuestros dispositivos con el siguiente comando :\nUna vez configurada las tarjetas de red , comprobaremos si hay conectividad entre ellos haciendo un ping :\nA√±adiremos un tercer VPCS a nuestro esquema :\nLo encenderemos y abriremos una terminal para configurarlo al igual que hemos hecho con los anteriores :\nY comprobare que esta nueva maquina tiene conectividad con las anteriores :\nSi queremos que se guarden las configuraciones de nuestros equipos introduciremos el comando save :\n2.4 Acceso a internet a trav√©s de NAT en GNS3 La manera mas f√°cil de conseguir acceso a internet es a trav√©s de la nube NAT .\nEsta cuenta con acceso a internet , as√≠ como un servicio DHCP corriendo con IPV4 .Para hacer uso de ella , la pondremos en nuestro escenario y la conectaremos en un swicht .\nA continuaci√≥n si queremos salir a internet , tendremos que configurar nuestros clientes para que estos obtengan la configuraci√≥n de red adecuada . Aprovecharemos que tenemos un servidor DHCP .\nPara que los clientes se configuren a trav√©s de este servicio introduciremos el comando dhcp :\nProbaremos a hacer un ping a google.es para comprobar la conectividad :\n3 Problemas comunes en la instalaci√≥n 3.1 Error VPCS executable version must be \u0026gt;=0.6.1 but not 0.8 Este error viene al hacer la instalaci√≥n de los VPCS , se descarga de los repositorios una versi√≥n que no admite actualmente el programa .\nPor suerte es muy f√°cil de solucionar , accederemos al repositorio del desarrollador en github y nos descargaremos el siguiente paquete :\nUna vez descargado lo descomprimiremos usando el siguiente comando :\nDonde hagamos este comando nos creara un directorio en el cual accederemos para compilar el programa :\nEjecutaremos el siguiente script :\nNos creara en esta ruta el directorio vpcs , este tendremos que a√±adirlo en gns3 :\nAccederemos a gns3 , pulsaremos CTRL + SHIFT + P para acceder al panel de preferencias . Una vez aqu√≠ nos desplazamos al apartado de las vpcs y seleccionamos la ruta del directorio que acabamos de generar :\nAplicamos los cambios y ya podr√≠amos utilizar las vpcs .\n3.2 Xterm no instalado Este error aparece cuando queremos acceder a una consola de un dispositivo de nuestra tipolog√≠a de red .Para solucionar este problema lo primero es cerrar GNS3 y a continuaci√≥n dirigirnos a una terminal para descargarlo, utilizaremos el siguiente comando :\nVolveremos a abrir el programa y podremos acceder a las consolas de nuestras maquinas .\n4 Instalar im√°genes IOS Si queremos a√±adir a nuestro sistema hardware real como puede ser un router cisco por ejemplo deberemos de acceder a la pagina oficial de GNS3 y descargar concretamente el que deseemos a√±adir en mi caso a√±adir√© un cisco 3725 .\nSi pulsamos sobre el bot√≥n de descarga nos descargara un archivo con extensi√≥n , el cual es una plantilla .\nSi nos fijamos en este caso no tenemos la posibilidad de descargar la imagen desde este repositorio , nos dice que no hay link disponible . Para estos casos existe un repositorio de cisco el cual tiene todas las im√°genes de sus productos ‚Äì\u0026gt; tfr.org/cisco-ios\nPara saber cual nos tenemos que traer de aqu√≠ , abriremos gns3 y a trav√©s del men√∫ superior izquierdo pulsaremos sobre el apartado file \u0026gt; import appilance , seleccionaremos la plantilla que vamos a importar . Le daremos a instalar en nuestro ordenador local :\nUna vez aqu√≠ nos , veremos el nombre del archivo y lo buscaremos en el repositorio externo , ya que podemos observar que no se encuentra el archivo\nEn este caso descargare , esta version que coincide con la plantilla que he descargado :\nCuando hayamos hecho esto tendremos el siguiente problema , las firmas de las im√°genes no coincidir√°n para paliar ese paso marcaremos la opci√≥n allow custom files en la parte inferior y importaremos el binario que acabamos de descargar :\nNos informara que para la plantilla seleccionada , el archivo que hemos descargado del repositorio no coinciden los hashes . En nuestro caso es normal ya que la imagen no es la misma que tendr√≠a que venir con la plantilla , as√≠ que aceptaremos los riesgos .\nVeremos que cambiara el estado a listo para instalar , as√≠ que le daremos a siguiente en la parte inferior .\nNos pedir√° confirmaci√≥n para a√±adir nuestro dispositivo , confirmaremos la acci√≥n :\nNos informara de que nuestro dispositivo se ha a√±adido en las plantillas de los router , para este caso .\nAdem√°s nos informara del nombre que se le ha asignado .\nComo nos indico , lo encontraremos en la secci√≥n de routers :\nAhora haremos una peque√±a prueba de funcionamiento , lo a√±adiremos a nuestro escenario y comprobaremos que podemos arrancarlo y conectarnos a la consola :\nVeremos la conexi√≥n a la consola es correcta :\n5 Instalaci√≥n en Windows de GNS3 5.1 Paquetes necesarios para Windows Aunque tengamos instalado el software de GNS3 este har√° uso de paquetes adicionales para realizar algunas funciones o incluso a√±adir nuevas funcionalidades como emular enrutadores de determinados fabricantes .\nArt√≠culo Requerido Descripci√≥n WinPCAP Requerido Requerido para conectar GNS3 a su red inform√°tica. Utilizado por los nodos Cloud y NAT para permitir que sus proyectos se comuniquen con el mundo exterior. Npcap Opcional El reemplazo moderno de WinPCAP sabe solucionar problemas pero est√° menos probado que WinPCAP.Instale Npcap con la opci√≥n \u0026ldquo;Modo compatible con la API de WinPcap\u0026rdquo; seleccionada, si se usa sin WinPcap.Npcap puede coexistir con WinPcap, si esa opci√≥n no est√° seleccionada. Wireshark Recomendado Le permite capturar y ver el tr√°fico de red enviado entre nodos. Dynamips Requerido Requerido para ejecutar una instalaci√≥n local de GNS3 con enrutadores Cisco. QEMU 3.1.0 y 0.11.0 Opcional Un software de virtualizaci√≥n .La versi√≥n anterior de Qemu 0.11.0 est√° instalada para admitir dispositivos ASA antiguos. Se recomienda utilizar la vm GNS3 en su lugar.\nVPCS Recomendado Un emulador de PC muy ligero que admite comandos b√°sicos como ping y traceroute Cpulimit Opcional Se usa para evitar que QEMU use el 100% de su CPU (cuando se est√° ejecutando) en algunos casos, como con los dispositivos ASA antiguos GNS3 Requerido El software principal de GNS3.Esto siempre es obligatorio. Visor TightVNC Recomendado Un cliente VNC utilizado para conectarse a las interfaces gr√°ficas de usuario del dispositivo. Solar-Putty Recomendado La nueva aplicaci√≥n de consola predeterminada. Virt-viewer Recomendado Visualizador alternativo de m√°quinas virtuales de escritorio Qemu que tienen qemu-spice preinstalado. Intel Hardware Acceleration Manager (HAXM) Opcional Solo disponible en sistemas con CPU Intel (y VT-X habilitado), que no usan Hyper-V. Se utiliza para la aceleraci√≥n de hardware de la emulaci√≥n de Android, as√≠ como para QEMU. 5.2. Requisitos m√≠nimos Para entornos peque√±os en Windows los desarrolladores exigen tener como m√≠nimo las siguientes caracter√≠sticas :\nCaracter√≠sticas Requisitos Sistema operativo Windows 7 (64 bits) o posterior Procesador 2 o m√°s n√∫cleos l√≥gicos Virtualizaci√≥n Se requieren extensiones de virtualizaci√≥n. Es posible que deba habilitar esto a trav√©s del BIOS de su ordenador . Memoria 4 GB de RAM Almacenamiento 1 GB de espacio disponible (la instalaci√≥n de Windows es \u0026lt; 200 MB). 5.3 Instalaci√≥n GNS3 Lo primero que tendremos que sera descargarnos el ejecutable oficial de su pagina web , para ello tendremos que estar registrados previamente .\nLanzaremos el ejecutable y nos pedir√° permisos de administrados , se los concedemos :\nSaldr√° una pantalla inform√°ndonos sobre el producto , le damos a next .\nA continuaci√≥n deberemos de aceptar los t√©rminos y licencias de uso :\nNos preguntara donde queremos crear los atajos del programa , lo dejare por defecto ya que asi los a√±adir√° al escritorio :\nA continuaci√≥n debemos de prestar atenci√≥n ya que debemos de seleccionar instalaci√≥n local y todos los paquetes que vayamos a hacer uso , si hubi√©semos instalado antes alguno de ellos los desmarcamos (Los mencionados en el punto 5.1) :\nSeleccionaremos la ruta donde se instalara el programa , yo dejare la predeterminada . Tambi√©n nos informa el espacio que necesitara la instalaci√≥n :\nEsperaremos a que se realice la instalaci√≥n :\nInstalaci√≥n WinCap\nRequerido para conectar GNS3 a su red inform√°tica. Utilizado por los nodos Cloud y NAT para permitir que sus proyectos se comuniquen con el mundo exterior.\nMientras se realiza la instalaci√≥n de GNS3 comenzara la instalaci√≥n de todos los programas que hemos marcado anteriormente .\nNos mostrara informaci√≥n sobre el programa esta primera ventana as√≠ que le damos a siguiente :\nAceptamos la licencia de t√©rminos y uso :\nMarcamos la opci√≥n para que arranque autom√°ticamente el driver y le damos a instalar\nNos informa de que la instalaci√≥n a sido correcta y cerramos la ventana :\nInstalaci√≥n Ncap\nEl reemplazo moderno de WinPCAP sabe solucionar problemas pero est√° menos probado que WinPCAP.Instale Npcap con la opci√≥n \u0026ldquo;Modo compatible con la API de WinPcap\u0026rdquo; seleccionada, si se usa sin WinPcap.Npcap puede coexistir con WinPcap, si esa opci√≥n no est√° seleccionada.\nOtra vez el mismo proceso , aceptamos los t√©rminos y licencias de uso .\nDejamos la opci√≥n marcada por defecto y le damos a install\nCuando finalice la instalaci√≥n le damos a siguiente :\nY cerramos el instalador :\nVolvemos a GNS3 ya que el proceso de instalaci√≥n ha quedado detenido mientras hemos instalado los componentes que va a hacer uso , esta se reanuda autom√°ticamente :\nUna vez finalice la instalaci√≥n , le damos a siguiente\nGNS3 nos ofrece una licencia gratuita de Solarwinds , le daremos a si :\nHabremos finalizado correctamente la instalaci√≥n de GNS3\nAbriremos el programa y seleccionaremos correr los dispositivos en nuestra maquina local :\nAqu√≠ configuraremos nuestro servidor local de GNS3\nAnteriormente lo deje por defecto , si nuestra configuraci√≥n es correcta nos dir√° que la conexi√≥n se ha realizado satisfactoriamente :\nNos mostrara un resumen de la configuraci√≥n dada anteriormente :\n5.4 Prueba de funcionamiento Montaremos el mismo escenario que en debian para comprobar su funcionamiento , el proceso es el mismo .\nConfiguraremos las direcciones ips de las maquinas y comprobamos que tengan conectividad a trav√©s de solarputty .\nPC1 :\nPC2:\nPodemos observar que ambos equipos tienen conectividad a trav√©s del escenario .\n6 Instalaci√≥n Wireshark en Windows 6.1 Instalaci√≥n La instalaci√≥n de este producto es muy sencilla , si hemos instalado GNS3 anteriormente y hemos marcado la casilla de este , se nos habr√° instalado autom√°ticamente .\nPor el contrario si partimos desde cero podemos hacer su instalaci√≥n , bajandonoslo de su sitio web oficial :\nCuando abramos el instalador nos pedir√° permisos de administrador , se lo concedemos :\nSi al igual que yo lo has instalado con GNS3 nos detectara que ya existe una instalaron , as√≠ que yo la cancelare .\nSi no lo tuvi√©semos la instalaci√≥n es id√©ntica a cualquier programa que hemos instalado en la practica . Aqu√≠ te lo muestro , lo primero que veras sera una pantalla informativa del ejecutable :\nAl igual que todos los programas te pedir√° que aceptes los t√©rminos y condiciones de uso :\nSeleccionaremos los productos que deseemos instalar en mi caso todos :\nAdem√°s nos preguntara que accesos directos y donde los queremos crear\nSeleccionaremos la ruta donde queremos que se instale :\nSeleccionaremos si nos interesa el paquete Ncap .(Lo hemos instalado con GNS3)\nA continuaci√≥n nos preguntara para instalar la extensi√≥n que nos permite analizar trafico USB , en mi caso la desmarcare ya que no me interesa .\nEsperaremos a que finalice la instalaci√≥n y le daremos a siguiente :\nNos informara de que la instalaci√≥n ha sido realizada correctamente :\n6.2 Prueba de funcionamiento He realizado una petici√≥n DNS a www.sevillafc.es y aqu√≠ podemos ver la consulta DNS :\n7 GNS VM Si queremos desplegar maquinas virtuales en una instancia virtual desplegaremos la maquina virtual que nos da GNS3 para que este lleve la carga de la Virtualizaci√≥n .\nNos descargaremos la OVA desde la pagina web oficial\nUna vez descargada la importaremos en Vmware y le daremos las caracter√≠sticas hardware que consideremos oportuno :\nUna vez echo esto abriremos GNS3 y editaremos las preferencias de GNS VM y seleccionaremos la maquina virtual que acabamos de importar :\nSe nos iniciara la maquina virtual y podremos ver los datos de la misma en la pesta√±a info :\nLanzaremos el set-up wizard desde la pesta√±a help de GNS3 y seleccionaremos la opci√≥n de ejecutar las apilances en una maquina virtual :\nSeleccionaremos la configuraci√≥n de nuestra maquina virtual :\nSeleccionaremos de nuevo nuestra maquina virtual y las caracter√≠sticas hardware que deseemos :\nSolo nos quedara importar los dispositivos en la maquina virtual , esto se hace igual que hemos echo anteriormente cambiando el sitio donde lo importamos :\nSi queremos ver donde se ejecutara un dispositivo podemos verlo a trav√©s de preferencias :\nAdem√°s podemos ver en apartado servers sumarry el consumo de recursos de nuestras maquinas :\n8 Conclusi√≥n Podemos ver que la instalaci√≥n es infinitamente mas c√≥moda en Windows ya que autom√°ticamente te instala las dependencias, siendo la t√≠pica instalaci√≥n de ‚Äúsiguiente a siguiente ‚Äù .\nAdem√°s en Windows al acabar la instalaci√≥n el producto estaba listo para usarse y no he sufrido ning√∫n error al iniciar el programa ni al usar sus caracter√≠sticas como si me ha pasado en Debian .\n9 Bibliograf√≠a Documentacion oficial wireshark\nPaquete wireshark en debian\nRequisitos m√≠nimos wireshark\nError ‚ÄúVPCS executable version must be \u0026gt;=0.6.1 but not 0.8‚Äù Descarga VPCS\n","date":"September 8, 2023","hero":"/images/redes/instalacion_wireshark_gns3/portada_instalacion_wireshark_gns3.png","permalink":"https://www.javiercd.es/posts/redes/instalacion_wireshark_gns3/instalacion-gns3-y-wireshark/","summary":"\u003cblockquote\u003e\n\u003cp\u003e\u003cstrong\u003e‚ö†Ô∏è Advertencia:\u003c/strong\u003e Este post fue desarrollado para Debian 11. Si tienes una versi√≥n m√°s reciente, puedes revisar el post para Debian 12 que encontrar√°s en el apartado de redes de esta misma p√°gina. La √∫nica parte que no deber√≠as seguir si cumples con esta condici√≥n es la instalaci√≥n de GNS3. Todo el resto del contenido sigue siendo valido .\u003c/p\u003e\u003c/blockquote\u003e\n\u003c!-- ![2](/images/redes/instalacion_wireshark_gns3/portada_instalacion_wireshark_gns3.jpeg)\r\n\r\n![](/images/redes/instalacion_wireshark_gns3/Aspose.Words.7be2264a-b643-4cb1-9a61-896b263a0d52.003.jpeg) --\u003e\r\n\u003ch2 id=\"1-introducci√≥n\"\u003e1. \u003cstrong\u003eIntroducci√≥n\u003c/strong\u003e\u003c/h2\u003e\n\u003cp\u003eWireshark es un analizador de protocolos utilizado para realizar an√°lisis y solucionar problemas en redes de comunicaciones, para an√°lisis de datos y protocolos, y como una herramienta did√°ctica.\u003c/p\u003e","tags":["Redes","Wireshark","GNS3"],"title":"Instalaci√≥n GNS3 y Wireshark en Debian"},{"categories":null,"contents":"Configuraci√≥n del servidor DHCP bajo Debian En este art√≠culo aprender√°s c√≥mo configurar el servidor DHCP isc-dhcp-server. Adem√°s, configuraremos una reserva de IP y lo configuraremos para que funcione en dos √°mbitos diferentes.\nEn mi caso esta es la configuraci√≥n de red de mi servidor DHCP .\n# Red externa del router auto ens4 iface ens4 inet dhcp # Red interna 1 auto ens5 iface ens5 inet static address 192.168.10.1 netmask 255.255.255.0 # SNAT para la red ens5 , recuerda activar el bit de forwarding post-up iptables -t nat -A POSTROUTING -o ens4 -j MASQUERADE post-down iptables -t nat -D POSTROUTING -o ens4 -j MASQUERADE # Red interna 2 auto ens6 iface ens6 inet static address 192.168.20.1 netmask 255.255.255.0 Instalaci√≥n del servidor isc-dhcp-server Para instalar el servidor DHCP en Debian, ejecutamos el siguiente comando:\nsudo apt update \u0026amp;\u0026amp; sudo apt install isc-dhcp-server Cuando APT acabe , te devolver√° un error indicando que el servicio esta mal configurado , puedes ignorarlo ya que a continuaci√≥n vamos a realizar la configuraci√≥n del mismo.\nConfiguraci√≥n del servicio isc-dhcp-server Lo primero que debemos hacer es configurar la interfaz de red por la que va a operar el servidor DHCP. Para ello, editamos el archivo de configuraci√≥n de la interfaz:\nsudo nano /etc/default/isc-dhcp-server A√±adimos la interfaz que distribuir√° las direcciones IP, por ejemplo para la red1 seria:\nINTERFACESv4=\u0026#34;ens5\u0026#34; Luego configuramos el servidor DHCP con las siguientes caracter√≠sticas:\nRango de direcciones a repartir: 192.168.10.100 - 192.168.0.110 M√°scara de red: 255.255.255.0 Duraci√≥n de la concesi√≥n: 1 hora Puerta de enlace: 192.168.10.1 Servidores DNS: 8.8.8.8 Editamos el archivo de configuraci√≥n de isc-dhcp-server:\nsudo nano /etc/dhcp/dhcpd.conf Dentro de este , los par√°metros mas importantes son :\nmax-lease-time: Tiempo de la concesi√≥n de la direcci√≥n IP default-lease-time: Tiempo de renovaci√≥n de la concesi√≥n option routers: Indicamos la direcci√≥n red de la puerta de enlace que se utiliza para salir a internet. option domain-name-server: Se pone las direcciones IP de los servidores DNS que va a utilizar el cliente. option domain¬≠-name: Nombre del dominio que se manda al cliente. option subnet¬≠mask: Subred enviada a los clientes. option broadcast-¬≠address: Direcci√≥n de difusi√≥n de la red. En mi caso , dentro del fichero a√±adir√© el siguiente c√≥digo para configurar la red1:\nsubnet 192.168.10.0 netmask 255.255.255.0 { range 192.168.10.100 192.168.10.110; option routers 192.168.10.1; option domain-name-servers 8.8.8.8; default-lease-time 3600; max-lease-time 3600; } Con esta configuraci√≥n, el servidor DHCP proporcionar√° direcciones dentro del rango indicado y asignar√° la puerta de enlace y el servidor DNS especificados.\nPara aplicar los cambios, reiniciamos el servicio de DHCP:\nsudo systemctl restart isc-dhcp-server Configuraci√≥n de los clientes para obtener un direccionamiento din√°mico Para que los clientes obtengan direcciones IP de manera din√°mica, debemos asegurarnos de que sus configuraciones de red est√©n configuradas para usar DHCP.\nEn un cliente Debian Editamos la configuraci√≥n de red para usar DHCP. Primero, abrimos el archivo /etc/network/interfaces:\nsudo nano /etc/network/interfaces Aseg√∫rate de que la configuraci√≥n de la interfaz se vea de esta manera:\nauto ens4 iface ens4 inet dhcp Reiniciamos la interfaz de red para aplicar los cambios:\ndebian@cliente1:~$ sudo ifdown ens4 \u0026amp;\u0026amp; sudo ifup ens4 Veremos que al hacer esto , nos mostrara la salida del cliente DHCP del proceso que ha seguido para configurarse :\nifdown: interface ens4 not configured Internet Systems Consortium DHCP Client 4.4.3-P1 Copyright 2004-2022 Internet Systems Consortium. All rights reserved. For info, please visit https://www.isc.org/software/dhcp/ Listening on LPF/ens4/0c:07:6b:9a:00:00 Sending on LPF/ens4/0c:07:6b:9a:00:00 Sending on Socket/fallback Created duid \u0026#34;\\000\\001\\000\\001/\\251\\\\\\227\\014\\007k\\232\\000\\000\u0026#34;. DHCPDISCOVER on ens4 to 255.255.255.255 port 67 interval 8 DHCPOFFER of 192.168.10.100 from 192.168.10.1 DHCPREQUEST for 192.168.10.100 on ens4 to 255.255.255.255 port 67 DHCPACK of 192.168.10.100 from 192.168.10.1 bound to 192.168.10.100 -- renewal in 1479 seconds. Viendo la salida anterior , podemos ver que configuraci√≥n nos ha dado el servidor DHCP , pero tambi√©n podemos comprobarla con varios comandos . Como por ejemplo :\ndebian@cliente1:~$ ip -4 a 1: lo: \u0026lt;LOOPBACK,UP,LOWER_UP\u0026gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 2: ens4: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000 altname enp0s4 inet 192.168.10.100/24 brd 192.168.10.255 scope global dynamic ens4 valid_lft 3508sec preferred_lft 3508sec üí° Tip:\nEn el caso de que quieras modificar la configuraci√≥n del DHCP o simplemente volver a solicitar la configuraci√≥n al servidor DHCP estos comandos te ser√°n de utilidad. En sistemas Windows, el comando ipconfig /release libera la concesi√≥n DHCP actual, mientras que ipconfig /renew solicita una nueva.\nEn sistemas Linux, la liberaci√≥n se realiza con dhclient -r y la renovaci√≥n con dhclient.\nComprobaci√≥n de las concesiones de direcciones Para ver las concesiones de direcciones en el servidor, abrimos el archivo de registros de DHCP, que normalmente se encuentra en:\ndebian@router:~$ sudo cat /var/lib/dhcp/dhcpd.leases # The format of this file is documented in the dhcpd.leases(5) manual page. # This lease file was written by isc-dhcp-4.4.3-P1 # authoring-byte-order entry is generated, DO NOT DELETE authoring-byte-order little-endian; server-duid \u0026#34;\\000\\001\\000\\001/\\251[u\\014\\306\\312)\\000\\001\u0026#34;; lease 192.168.10.100 { starts 6 2025/05/03 23:00:40; ends 0 2025/05/04 00:00:40; cltt 6 2025/05/03 23:00:40; binding state active; next binding state free; rewind binding state free; hardware ethernet 0c:07:6b:9a:00:00; uid \u0026#34;\\377k\\232\\000\\000\\000\\001\\000\\001/\\251\\\\\\227\\014\\007k\\232\\000\\000\u0026#34;; client-hostname \u0026#34;cliente1\u0026#34;; } Es importante no editar este archivo manualmente, ya que cualquier modificaci√≥n puede causar problemas en el servidor DHCP.\nReserva de una direcci√≥n IP Para reservar una direcci√≥n IP para un cliente espec√≠fico, editamos el archivo de configuraci√≥n del servidor DHCP:\nsudo nano /etc/dhcp/dhcpd.conf A√±adimos la siguiente configuraci√≥n para reservar una direcci√≥n IP basada en la direcci√≥n MAC del cliente:\nhost nombre_cliente { hardware ethernet 00:11:22:33:44:55; fixed-address 192.168.10.120; } Una vez a√±adida la reserva, reiniciamos el servicio DHCP:\nsudo systemctl restart isc-dhcp-server Comprobamos en el cliente (Windows o Linux) si la IP reservada ha sido asignada correctamente utilizando el comando ipconfig o ip a.\nConfigurar dos √°mbitos Si queremos que el servidor DHCP administre direcciones para dos redes diferentes, como 192.168.10.0 y 192.168.20.0, debemos agregar una nueva interfaz de red.\nA√±adimos la nueva interfaz de red al archivo /etc/default/isc-dhcp-server:\nINTERFACESv4=\u0026#34;ens5 ens6\u0026#34; Luego configuramos un segundo rango de direcciones en el archivo de configuraci√≥n de isc-dhcp-server:\nsudo nano /etc/dhcp/dhcpd.conf A√±adimos lo siguiente:\nsubnet 192.168.20.0 netmask 255.255.255.0 { range 192.168.20.100 192.168.2.110; option routers 192.168.20.1; option domain-name-servers 8.8.8.8; default-lease-time 3600; max-lease-time 3600; } Finalmente, reiniciamos el servicio DHCP:\nsudo systemctl restart isc-dhcp-server Ahora veras en los clientes de esta segunda red que el servicio DHCP les ha asignado la configuraci√≥n de red configurada .\n","date":"September 8, 2023","hero":"/images/servicios/dhcp_v4/isc-dhcp.webp","permalink":"https://www.javiercd.es/posts/servicios/dhcp/instalacion_y_configuracion_de_un_servidor_dhcp_en_linux/dhcp_ipv4/","summary":"\u003ch1 id=\"configuraci√≥n-del-servidor-dhcp-bajo-debian\"\u003eConfiguraci√≥n del servidor DHCP bajo Debian\u003c/h1\u003e\n\u003cp\u003eEn este art√≠culo aprender√°s c√≥mo configurar el servidor DHCP \u003ccode\u003eisc-dhcp-server\u003c/code\u003e. Adem√°s, configuraremos una reserva de IP y lo configuraremos para que funcione en dos √°mbitos diferentes.\u003c/p\u003e\n\u003cp\u003eEn mi caso esta es la configuraci√≥n de red de mi servidor DHCP .\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Red externa del router\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eauto ens4\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eiface ens4 inet dhcp\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Red interna 1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eauto ens5 \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eiface ens5 inet static \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        address 192.168.10.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        netmask 255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        \u003cspan style=\"color:#75715e\"\u003e# SNAT para la red ens5 , recuerda activar el bit de forwarding\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        post-up iptables -t nat -A POSTROUTING -o ens4 -j MASQUERADE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        post-down iptables -t nat -D POSTROUTING -o ens4 -j MASQUERADE\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e# Red interna 2\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eauto ens6 \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eiface ens6 inet static \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        address 192.168.20.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e        netmask 255.255.255.0\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"instalaci√≥n-del-servidor-isc-dhcp-server\"\u003eInstalaci√≥n del servidor isc-dhcp-server\u003c/h2\u003e\n\u003cp\u003ePara instalar el servidor DHCP en Debian, ejecutamos el siguiente comando:\u003c/p\u003e","tags":["Servicios","NAT","SMR","DHCP","SNAT"],"title":"Instalaci√≥n y configuraci√≥n de un servidor DHCP en Linux"},{"categories":null,"contents":"En ocasiones, es necesario actualizar el almacenamiento de nuestro sistema Debian para satisfacer las crecientes necesidades de espacio y mejorar la organizaci√≥n del disco. En esta gu√≠a, exploraremos el proceso de migraci√≥n desde un disco con una √∫nica partici√≥n hacia uno con mayor capacidad, adem√°s de dividirlo en particiones separadas para una gesti√≥n m√°s eficiente.\nEste proceso no solo ampliar√° el espacio de almacenamiento disponible, sino que tambi√©n brindar√° una estructura m√°s ordenada al sistema, facilitando tareas como la gesti√≥n de respaldos, el rendimiento del sistema y la administraci√≥n del espacio en disco.\nCaracter√≠sticas de la maquina Crea una m√°quina virtual en virt-manager con las siguientes caracter√≠sticas:\nSe instalar√° sistema operativo GNU/Linux Debian11. Tama√±o de memoria: 1GB. CPU:1 Tama√±o de disco duro: 2GB Detalles del hipervisor: chipset:Q35 Firmware: UEFIx86 Esquema de particiones La instalaci√≥n de debian la realizar√°s, con el siguiente esquema de particiones: partici√≥n efi: 50MB\npartici√≥n /: 2GB\nswap: el resto de espacio sobrante.\nNo se instalar√° ning√∫n entorno de escritorio.\nUna vez instalado el sistema, nos damos cuenta que estar√≠amos muy justos de espacio.\nAmpliaci√≥n del disco Particionado A√±ade un disco a tu sistema de 10GB.\nParticiona este disco, eligiendo el tama√±o apropiado para cada una de las particiones, teniendo en cuentas que cada partici√≥n ser√° asignada a un directorio de los indicados:\n/boot/efi FAT32 partici√≥n efi ‚Äì\u0026gt; 100MB / ext4 ‚Äì\u0026gt; 8GB\n/home ext4 ‚Äì\u0026gt;1GB\n/var ext4 ‚Äì\u0026gt; 400MB\n/usr ext4 ‚Äì\u0026gt; 400MB\nswap swap ‚Äì\u0026gt; 200MB\nDando sistema de ficheros a las particiones Para darle formato a esta partici√≥n /boot/efi FAT32 partici√≥n efi ‚Äì\u0026gt; 100MB\nPara estas particiones le dar√© formato ext4: / ext4 ‚Äì\u0026gt; 8GB\n/home ext4 ‚Äì\u0026gt;1GB\n/var ext4 ‚Äì\u0026gt; 400MB\n/usr ext4 ‚Äì\u0026gt; 400MB\nPara dar formato de swap: swap swap ‚Äì\u0026gt; 200MB\nPara ‚Äúactivar la swap‚Äù ‚Äì\u0026gt; sudo swapon dev/vdb6 y posteriormente para hacerlo permanente lo a√±adiremos al /etc/fstab .\nNos quedar√≠a el disco con los siguientes formatos :\nMigraci√≥n de datos Partici√≥n EFI A continuaci√≥n realizaremos una copia fidedigna de cada una de nuestras particiones para ello , creare un directorio para montar cada disco en un directorio con su nombre :\nY montaremos las particiones en estos directorios :\nComenzaremos a pasar la informaci√≥n de nuestras particiones . Es importante usar el par√°metro a (lo mismo que dpR) que permite hacer la copia recursivamente adem√°s se conservan intactos los permisos y enlaces que se encuentren en el sistema. Con el par√°metro f, forzamos la copia.\nCopia de la partici√≥n EFI :\nPartici√≥n HOME Lo montaremos en un directorio cualquiera , a continuaci√≥n lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobaci√≥n de forma manual .\nAhora lo a√±adiremos al fstab :\nLo montamos con un mount -a . Lo desmontamos y borraremos el directorio home del antiguo disco :\nPartici√≥n VAR Lo montaremos en un directorio cualquiera , a continuaci√≥n lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobaci√≥n de forma manual .\nAhora lo a√±adiremos al fstab :\nLo montamos con un mount -a . Lo desmontamos y borraremos el directorio var del antiguo disco :\nPartici√≥n USR Lo montaremos en un directorio cualquiera , a continuaci√≥n lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobaci√≥n de forma manual .\nAhora lo a√±adiremos al fstab :\nLo montamos con un mount -a :\nLo desmontamos y borraremos el directorio home del antiguo disco :\nY volveremos a montarlos con un mount -a .\nPartici√≥n RAIZ Lo montaremos en un directorio cualquiera , a continuaci√≥n lo copiaremos con rsync y con el comando diff comprobaremos si hay archivos diferentes en los directorios para ahorrarnos hacer la comprobaci√≥n de forma manual .\nExcluyendo los directorios que hemos separado anteriormente :\nAhora lo a√±adiremos al fstab :\nPara montar esta partici√≥n deberemos de reiniciar el sistema .\nGenerar la nueva EFI Para esto hay que seguir un procedimiento distinto , lo primero que haremos sera darle formato fat32 a la partici√≥n . Despu√©s igual que las dem√°s la montaremos y instalaremos un nuevo grub especificando donde queremos instalarlo , en el segundo disco.\nAhora lo a√±adiremos al fstab :\nReiniciaremos el equipo y comprobaremos que funciona :\nAhora actualizaremos el grub :\nAhora para construir el nuevo efi tendremos que a trav√©s de un cd live o desde el modo rescate construir un nuevo grub :\nMontamos nuestra nueva partici√≥n del sistema y le damos a reinstalar el cargador de arranque grub :\nUna vez hecho esto apagamos la maquina y ponemos el segundo disco primero e el orden de arranque y reiniciamos el equipo :\nCuando reinicie elegimos la primera opci√≥n que es el arranque de vdb :\nY habremos conseguido migrar el sistema a un disco mas grande :\nMi /etc/fstab ha quedado de la siguiente manera :\nBibliograf√≠a Migrar de un disco a otro Copiar particiones Recuperar grub ","date":"September 8, 2023","hero":"/images/sistemas/migracion_de_sistema_de_ficheros/portada.jpg","permalink":"https://www.javiercd.es/posts/sistemas/migraciones/migracion_sistema_de_ficheros/sistemas-de-ficheros/","summary":"\u003cp\u003eEn ocasiones, es necesario actualizar el almacenamiento de nuestro sistema Debian para satisfacer las crecientes necesidades de espacio y mejorar la organizaci√≥n del disco. En esta gu√≠a, exploraremos el proceso de migraci√≥n desde un disco con una √∫nica partici√≥n hacia uno con mayor capacidad, adem√°s de dividirlo en particiones separadas para una gesti√≥n m√°s eficiente.\u003c/p\u003e\n\u003cp\u003eEste proceso no solo ampliar√° el espacio de almacenamiento disponible, sino que tambi√©n brindar√° una estructura m√°s ordenada al sistema, facilitando tareas como la gesti√≥n de respaldos, el rendimiento del sistema y la administraci√≥n del espacio en disco.\u003c/p\u003e","tags":["Debian 12","Sistemas","ISO","ASO"],"title":"Migraci√≥n de un sistema de ficheros"},{"categories":null,"contents":"NAT con iptables En este art√≠culo aprender√°s a configurar un peque√±o escenario en el cual podr√°s configurar una serie de servicios. Crear√°s el escenario descrito a continuacion , adem√°s, har√°s que a trav√©s de una red interna, usando un servidor Linux, tengas acceso a Internet configurando SNAT en el mismo haciendo uso de iptables.\nInstalaci√≥n del entorno de pruebas Vamos a instalar el siguiente entorno:\nConfiguraci√≥n de VirtualBox Servidor debian :\nCliente windows\nCliente debian\nConfiguraci√≥n de red Lo primero que haremos sera configurar las tarjetas de red de nuestras maquinas .\nServidor debian Editamos el fichero con nano /ect/network/interfaces como superusuario y a√±adimos las siguientes lineas .\nLos cuadros rojos corresponden a la configuraci√≥n de las tarjetas de red enp0s3(tarjeta externa) y enp0s8(red interna). El cuadro azul corresponde a las reglas iptables para permitir las peticiones al exterior y prohibir las interiores .\nCliente debian Editamos el fichero con nano /etc/network/interfaces como superusuario y a√±adimos las siguientes lineas .La puerta de enlace sera la direcci√≥n ip de la tarjeta del servidor interna .\nCliente Windows 10 En windows 10 configuramos manualmente accediendo a conexiones de red \u0026gt; configuracion del adaptador \u0026gt; ipv4 y le asignamos lo siguiente .Al igual que el cliente debian cambiando la direcci√≥n ip . He puesto dns de Google porque utilizo mi red movil .\nConfiguraci√≥n de nat en el servidor Modificar el fichero /etc/sysctl.conf. Hay que descomentar la l√≠nea :\nComprobamos si se ha aplicado\nComprobaci√≥n de internet en los clientes Windows 10 Debian 11 ","date":"September 8, 2023","hero":"/images/servicios/nat_iptables/portada_iptables.jpeg","permalink":"https://www.javiercd.es/posts/servicios/nat_iptables/nat_iptables/","summary":"\u003ch1 id=\"nat-con-iptables\"\u003eNAT con iptables\u003c/h1\u003e\n\u003cp\u003eEn este art√≠culo aprender√°s a configurar un peque√±o escenario en el cual podr√°s configurar una serie de servicios. Crear√°s el escenario descrito a continuacion , adem√°s, har√°s que a trav√©s de una red interna, usando un servidor Linux, tengas acceso a Internet configurando SNAT en el mismo haciendo uso de iptables.\u003c/p\u003e\n\u003ch2 id=\"instalaci√≥n-del-entorno-de-pruebas\"\u003eInstalaci√≥n del entorno de pruebas\u003c/h2\u003e\n\u003cp\u003eVamos a instalar el siguiente entorno:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/nat_iptables/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.001.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003ch3 id=\"configuraci√≥n-de-virtualbox\"\u003eConfiguraci√≥n de VirtualBox\u003c/h3\u003e\n\u003cp\u003eServidor debian :\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT"],"title":"NAT con iptables"},{"categories":null,"contents":"El Protocolo de Resoluci√≥n de Direcciones (ARP) es fundamental en redes inform√°ticas para mapear direcciones IP a direcciones f√≠sicas de capa de enlace (MAC). Su funci√≥n principal es encontrar la direcci√≥n MAC asociada a una direcci√≥n IP espec√≠fica en una red local. Cuando un dispositivo necesita comunicarse con otro en la misma red, utiliza ARP para determinar la direcci√≥n MAC del destino antes de enviar datos.\n¬øCrees que la pregunta ARP es un mensaje de difusi√≥n? Realiza una captura en Wireshark de una petici√≥n ARP y anal√≠zala para justificar tu respuesta. Si , es un mensaje de difusi√≥n ya que en la cabecera podemos ver que el destino tiene una direcci√≥n de broadcast . Esta direcci√≥n es la que tiene todos sus bits a 1 que en las direcciones mac se traduce en FF:FF:FF:FF:FF:FF .\nCuando esta le llegue , en este caso al que tiene la direcci√≥n IP 192.168.1.1 nos devolver√° la petici√≥n y en el origen obtendremos su direcci√≥n MAC.\n¬øCrees que la respuesta ARP es un mensaje de difusi√≥n? Realiza una captura en Wireshark de una respuesta ARP y anal√≠zala para justificar tu respuesta. Podemos ver en la respuesta que en la direcci√≥n de destino viene la del pc que mando la pregunta , por lo que la respuesta no es un mensaje de broadcast sino una comunicaci√≥n punto a punto .\nLos ordenadores de una red almacenan en memoria una cach√© con las correspondencias IP-MAC que van conociendo. Explica el proceso de actualizaci√≥n de la cach√© ARP despu√©s de observar como se va rellenando en las m√°quinas de un peque√±o escenario en GNS3 con una red local con cuatro ordenadores conectados a un switch. Ve comprobando como cambia la cach√© ARP de todos los ordenadores cuando vas haciendo ping entre un ordenador y otro. Cuando hacemos un ping el emisor y el receptor ‚Äúse a√±aden mutuamente a la tabla ARP‚Äù , si las consultamos en ambas veremos que est√°n incluidos :\nPodemos ver que el tiempo por el que se guardan en cache es de 120 segundos , cuando este tiempo se acaba, se borra la entrada.\nMientras que en los pcs que no han intervenido no almacenaran nada en la cache arp sobre la ‚Äútransacci√≥n realizada‚Äù:\nAnaliza el comando ip neigh para ver las posibilidades que ofrece y piensa cual puede ser el uso real de cada una de ellas. Este comando nos permite interactuar con la tabla arp donde se guardan la relaci√≥n de direcciones IP-MAC . Por ejemplo podemos visualizarla , a√±adir entradas o borrarlas as√≠ como modificarlas . Adem√°s podemos cambiar el tiempo durante el cual se guarda una petici√≥n en la tabla .\nPor ejemplo , listar el contenido :\nPodemos resumir sus funciones :\nMostrar la tabla ARP completa: ip neighbour show Agregar una entrada a la tabla ARP: ip neighbour add (IP) lladdr {MAC} dev {interface} Eliminar una entrada de la tabla ARP: ip neighbour del {IP} dev {interface} Establecer el tiempo de vida de una entrada en la tabla ARP: ip neighbour change {IP} dev {interface} nud {state} Buscar una entrada espec√≠fica en la tabla ARP: ip neighbour | grep {IP} B√°sicamente esto es lo que debemos conocer para poder controlar las tablas ARP con el comando IP en sustituci√≥n (o como complemento) a ¬´arp¬ª.\nAverigua qu√© es un ARP gratuito y cu√°l es el sentido de su existencia. Es una solicitud emitida por un dispositivo con el objetivo de actualizar la tabla arp del resto de dispositivos de una red . Este simplemente informa a los dem√°s dispositivos de la red de su propia direcci√≥n IP y MAC .\nEl prop√≥sito principal de las ARP gratuitas es asegurar que todos los dispositivos en una red tengan la informaci√≥n m√°s actualizada posible sobre las direcciones IP y MAC de los dem√°s dispositivos en la red.\nUna de sus utilidades es detectar conflictos de IP\u0026rsquo;s, \u0026ldquo;esta ip ya est√° cogida\u0026rdquo; esto es debido a que otro equipo ha respondido con estos paquetes.\nPor lo que a partir de esta informaci√≥n se puede resolver esta incidencia.\nExplica con tus palabras en qu√© se basa un ataque ARP Spoofing y c√≥mo se lleva a cabo. ¬øPuede usarse como t√©cnica de ataque desde tu casa a una red ajena? ¬øC√≥mo podr√≠amos defendernos de √©l? El ataque viene a modificar el flujo de los datos enviados desde un PC V√≠ctima que pasa a trav√©s de un Gateway para hacer un ataque de tipo MITM (Man in the Middle) consiguiendo que el tr√°fico de la v√≠ctima pase por una m√°quina Atacante de forma inocua para la v√≠ctima.\nAs√≠ el atacante intercepta los mensajes y es capaz de obtener todo el trafico de la red obteniendo contrase√±as e informaci√≥n confidencial o sensible .\nLos pasos que sigue un atacante al realizar este ataque son :\nEscanear la red , para obtener una relaci√≥n de los dispositivos conectados . Enviar paquetes arp falsos para asociar en las v√≠ctimas su direcci√≥n ip a su propia mac. Una vez que el cliente ha sido ‚Äúenga√±ado‚Äù , el atacante comenzara a interceptar todo el trafico. Estos ataques solo se producen si el atacante consigue acceso a tu red local , as√≠ que para protegernos podemos usar :\nHerramientas de detecci√≥n de ARP Spoofing . Utilizar un firewall , ya que ese es capaz de bloquear paquetes ARP sospechosos . Utilizar protocolos como Ipsec y SSL/TLS . Configurar la tabla arp de manera est√°tica. Hay dos tipos de ataques a switches llamados MAC Flooding y MAC Spoofing. ¬øEn qu√© consisten y c√≥mo podemos defendernos de ellos? MAC Flooding consiste en llenar la tabla arp de un dispositivo de red , por ejemplo un switch y hacer que este no sea capaz de localizar a que boca va el trafico a si este lo mandara por todas las bocas provocando que en el peor de los casos dejar sin servicio al dispositivo .\nPara mitigar este ataque se recomienda configurar un limite en el tama√±o de la tabla ARP y la detecci√≥n y bloqueo de trafico sospechoso .\nMientras que el MAC Spoofing consiste en falsificar una direcci√≥n MAC para interceptar un determinado trafico , pudiendo tener acceso a contenido privado .\nPara mitigar este ataque en el caso de que suplante una maquina de mi red y tenga acceso a contenido podemos implementar herramientas de segundo factor de autentificaron o usar certificados digitales .\nAdem√°s podemos implementar en nuestra red las siguientes estrategias :\nEntradas est√°ticas en tabla ARP\nLa primera soluci√≥n que existe corresponde a trabajar con rutas est√°ticas en los equipos de red. Esto permite invalidar los mensajes ARP, debido a que las IP se asocian una direcci√≥n MAC y esta no cambia en el tiempo. Es una soluci√≥n simple y en general se aplica para asegurar que la puerta de enlace predetermina sea realmente la de la red y no un atacante. Sin embargo, es una estrategia dif√≠cil de aplicar si se posee una red con una gran cantidad de terminales.\nDHCP snooping\nEs una estrategia que mantiene un registro de las MAC que est√°n conectadas en cada puerto y detecta inmediatamente si existe una suplantaci√≥n. Varios fabricantes de equipos de red incorpora esta soluci√≥n en sus equipos, como es el caso de CISCO.\nDynamic ARP Inspection\nPara evitar la suplantaci√≥n de ARP (ARP spoofing) y el envenenamiento por ARP (ARP poisoning) resultante, un switch debe garantizar que solo se transmitan ARP Requests y ARP Replies v√°lidas.\nLa Inspecci√≥n Din√°mica de ARP/ Dynamic ARP Inspection (DAI) requiere de DHCP snooping y ayuda a prevenir ataques ARP as√≠:\nNo retransmitiendo respuestas/Replies ARP invalidas o gratuitas/gratuitous a otros puertos en la misma VLAN. Intercepta todas las solicitudes/Requests y respuestas/Replies ARP en puertos no confiables. Verificando cada paquete interceptado para un enlace v√°lido de IP a MAC. Descarte y registro de respuestas no v√°lidas de ARP para evitar el envenenamiento por ARP. Error-disabling la interfaz si se excede el n√∫mero de paquetes ARP DAI configurado. RARP\nRARP es Reversal ARP, esto quiere decir que consulta a partir de una direcci√≥n MAC la IP correspondiente. En caso de que retorne m√°s de una direcci√≥n IP, entonces la MAC ha sido clonada.\nBibliograf√≠a ip neigh arp spoofing ARP gratuitos medidas de mitigaci√≥n ","date":"September 8, 2023","hero":"/images/redes/arp/portada.png","permalink":"https://www.javiercd.es/posts/redes/arp/arp/","summary":"\u003cp\u003eEl Protocolo de Resoluci√≥n de Direcciones (ARP) es fundamental en redes inform√°ticas para mapear direcciones IP a direcciones f√≠sicas de capa de enlace (MAC). Su funci√≥n principal es encontrar la direcci√≥n MAC asociada a una direcci√≥n IP espec√≠fica en una red local. Cuando un dispositivo necesita comunicarse con otro en la misma red, utiliza ARP para determinar la direcci√≥n MAC del destino antes de enviar datos.\u003c/p\u003e\n\u003ch2 id=\"crees-que-la-pregunta-arp-es-un-mensaje-de-difusi√≥n-realiza-una-captura-en-wireshark-de-una-petici√≥n-arp-y-anal√≠zala-para-justificar-tu-respuesta\"\u003e¬øCrees que la pregunta ARP es un mensaje de difusi√≥n? Realiza una captura en Wireshark de una petici√≥n ARP y anal√≠zala para justificar tu respuesta.\u003c/h2\u003e\n\u003cp\u003eSi , es un mensaje de difusi√≥n ya que en la cabecera podemos ver que el destino tiene una direcci√≥n de broadcast . Esta direcci√≥n es la que tiene todos sus bits a 1 que en las direcciones mac se traduce en FF:FF:FF:FF:FF:FF .\u003c/p\u003e","tags":["Redes","ARP"],"title":"Protocolo ARP"},{"categories":null,"contents":"servidor SSH bajo debian Gesti√≥n remota usando SSH Lo primeros que deberemos de hacer sera instalarnos el paquete en el servidor y el cliente :\nPor seguridad se suele no permitir la conexi√≥n del root al servidor; para ello, se debe modificar el archivo /etc/ssh/sshd_config, y se pone la siguiente opci√≥n:\nY reiniciamos el servicio para que se apliquen los cambios :\nConectarse al servidor ssh Vamos a instalarnos el cliente ssh, para ello:\nPara acceder desde el cliente al servidor tecleamos:\nNos abr√≠amos conectado remotamente\nEjecuci√≥n remota de aplicaciones gr√°ficas Mediante ssh existe la posibilidad de ejecutar aplicaciones gr√°ficas en el servidor y manejarlas y visualizarlas en el cliente. El servidor ssh deber√° tener activada la redirecci√≥n del protocolo X, es decir, deber√° tener el siguiente par√°metro en el archivo de configuraci√≥n /etc/ssh/sshd_config:\nEn mi caso ya estaba habilitado , si no lo tuvi√©semos lo cambiamos y reiniciamos el servicio para que se apliquen los cambios . Ahora deberemos de conectarnos con el par√°metro -X :\ny posteriormente podemos ejecutar cualquier aplicaci√≥n gr√°fica, por ejemplo, gedit:\nSe nos abrir√° el programa gr√°ficamente :\nAhora vemos en el servidor que se ha creado :\nTransferir ficheros con ssh Para copiar un fichero desde el cliente al servidor introducimos el siguiente comando :\nAhora vamos a comprobar si se ha copiado al servidor :\nAcceso remoto por cifrado asimetric√≥ Configuracion del acceso por claves Vamos a generar nuestras claves desde nuestro cliente :\nAhora vamos a a√±adirla a nuestro servidor :\nUna vez echo esto deshabilitamos el acceso con contrase√±a en el servidor editando el archivo /etc/ssh/sshd_config :\nA continuaci√≥n solo debemos reiniciar el servicio y al volver a registrarnos, ya estaremos utilizando clave publica :\nSi nos intentamos registrar con usuario el cual no tenemos la clave publica nos dir√° lo siguiente :\nCambio de puerto Ahora vamos a editar el fichero de configuraci√≥n para indicar el puerto :\nY reiniciaremos el servicio :\nAhora si nos intentamos conectar como lo hemos hecho anterior mente , nos dara el siguiente error :\nPara conectarnos deberemos de especificar el puerto por el cual nos conectamos con -p :\nConectarnos con un cliente de acceso remoto usando t√∫neles Usaremos kitty , cuando lo abramos en la primera pantalla introducimos la ip del servidor y el puerto que haya configurado en el servidor para el ssh en mi caso 2222\nAhora a√±adimos el puerto por el cual nos conectaremos usando el t√∫nel y despu√©s la ip seguida de dos puntos y el mismo puerto .\nAhora introducimos nuestro usuario y contrase√±a y nos habremos conectado :\nSi queremos hacer lo mismo pero usando una clave publica desde windows , pulsamos windows +r y escribimos lo siguiente :\nY generamos las claves publicas :\nAhora vamos a la ruta que lo hemos guardado copiamos la clave publica y la introducimos en el servidor , por comodidad la he copiado desde el cliente usando ssh.\nUna vez a√±adida guardamos el archivo :\nVamos a desactivar la autenticaci√≥n por contrase√±a y reiniciamos el servicio\nAhora desde el kitty deberemos de irnos al apartado ssh\u0026gt;auth , le damos a browse y seleccionamos nuestra clave privada , que deber√° tener la extension .ppk . Yo la copie en otro directorio por comodidad para las pruebas .\nY nos conectamos :\nAqu√≠ hemos combinado conectarnos con kitty usando un t√∫nel + otro puerto + clave publica .\nVNCserver Lo instalamos con el siguiente comando :\nA continuaci√≥n configuramos las credenciales de configuraci√≥n para administradores y usuarios de acceso con el siguiente comando :\nAhora vamos al cliente y introducimos la ip seguida del puerto por dos puntos, si no lo sabemos lo podemos mirar con :\nNos saldr√° una advertencia al no estar cifrada la comunicaci√≥n , le damos a continuar y introducimos la contrase√±a de acceso , que hayamos puesto anteriormente :\nComo no tenemos entrono grafico en el servidor no nos mostrara imagen pero podemos ver que hemos establecido conexi√≥n tanto en windows como en Linux :\nGesti√≥n de p√°ginas web mediante ssh 1.Una vez creado los dos sitio virtuales deseamos establecer una conexi√≥n segura a cada uno de nuestros sitios, para ello debemos establecer un t√∫nel ssh de la misma manera que lo hemos establecido para establecer una conexi√≥n remota por vnc .\n2.Crear un t√∫nel desde el cliente ssh para que el acceso a la secci√≥n privada de la web de departamentos se establezca por el puerto 9999\n3.Con ambos t√∫neles establecidos comprobar que el acceso a la web iesgn.org se puede realizar sin problemas por el puerto 80\nSolo he conseguido hacer a mi pagina por defecto , para eso hacemos un t√∫nel con kitty por ejemplo:\nAhora a√±adimos los puertos origen y destino del puerto :\nAhora nos registramos con nuestro usuario :\nUna vez establecido el t√∫nel introducimos en el navegador localhost:8888 :\nY as√≠ hemos establecido una conexi√≥n segura web .\nSi cerramos el t√∫nel perderemos la conexi√≥n :\n","date":"September 8, 2023","hero":"/images/servicios/ssh/portada-ssh.png","permalink":"https://www.javiercd.es/posts/servicios/ssh/ssh/","summary":"\u003ch1 id=\"servidor-ssh-bajo-debian\"\u003eservidor SSH bajo debian\u003c/h1\u003e\n\u003ch2 id=\"gesti√≥n-remota-usando-ssh\"\u003eGesti√≥n remota usando SSH\u003c/h2\u003e\n\u003cp\u003eLo primeros que deberemos de hacer sera instalarnos el paquete  en el servidor y el cliente :\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ssh/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.079.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003ePor seguridad se suele no permitir la conexi√≥n del root al servidor; para ello, se debe modificar el archivo /etc/ssh/sshd_config, y se pone la siguiente opci√≥n:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ssh/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.080.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eY reiniciamos el servicio para que se apliquen los cambios :\u003c/p\u003e\n\u003ch3 id=\"conectarse-al-servidor-ssh\"\u003eConectarse al servidor ssh\u003c/h3\u003e\n\u003cp\u003e\u003cimg src=\"/servicios/ssh/img/Aspose.Words.5fca9cc1-3c81-4853-a5ed-a70b0122341b.081.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003cp\u003eVamos a  instalarnos el cliente ssh, para ello:\u003c/p\u003e","tags":["Servicios","NAT","SMR","IPTABLES","SNAT","SSH","FORWARDING"],"title":"SSH bajo debian "},{"categories":null,"contents":"Storage Spaces es una caracter√≠stica de almacenamiento definido por software en el sistema operativo Windows Server que permite a los administradores de sistemas combinar varios discos f√≠sicos en un √∫nico espacio de almacenamiento l√≥gico llamado \u0026ldquo;pool de almacenamiento\u0026rdquo;. Este pool de almacenamiento se puede utilizar para crear espacios de almacenamiento virtuales llamados \u0026ldquo;espacios de almacenamiento\u0026rdquo; que ofrecen diversas funciones de redundancia y capacidades avanzadas de administraci√≥n de almacenamiento.\nGrupos de almacenamiento Los siguientes cmdlets de Windows PowerShell realizan la misma funci√≥n que el procedimiento anterior. Escriba cada cmdlet en una sola l√≠nea, aunque aqu√≠ pueden aparecer con saltos de l√≠nea entre varias l√≠neas aqu√≠ debido a restricciones de formato.\nEl siguiente ejemplo muestra qu√© discos f√≠sicos est√°n disponibles en el grupo primordial.\nGet-StoragePool -IsPrimordial $true | Get-PhysicalDisk -CanPool $True El siguiente ejemplo crea un nuevo grupo de almacenamiento denominado StoragePool1 que usa todos los discos disponibles:\nNew-StoragePool ‚ÄìFriendlyName StoragePool1 ‚ÄìStorageSubsystemFriendlyName \u0026#34;Windows Storage\\*\u0026#34; ‚ÄìPhysicalDisks (Get-PhysicalDisk ‚ÄìCanPool $True) Por defecto el tipo de aprovisionamiento es mirror.\nSi necesitamos a√±adir mas discos :\nAdd-PhysicalDisk -StoragePoolFriendlyName StoragePool1 -PhysicalDisks (Get-PhysicalDisk - CanPool $True) Crear un disco virtual Vamos a crear un disco virtual :\nNew-VirtualDisk ‚ÄìStoragePoolFriendlyName StoragePool1 ‚ÄìFriendlyName VirtualDisk1 ‚ÄìSize (8GB) Autom√°ticamente nos creara un volumen y nos lo montara en una letra disponible: :\nPodemos interactuar con el y guardar informaci√≥n :\nVemos que este es el ‚Äúequivalente‚Äù a LVM en Windows . Vemos que hay similitudes no solo en la estructura a la hora de crearlo si no que tambi√©n podemos observar que hacen referencia en la documentaci√≥n oficial a RAID 5 y RAID 6:\nA la forma de almacenar los datos en ya sea en stripes o guardando el espacio completo , al igual que sucede en Linux :\nBibliograf√≠a Documentaci√≥n oficial ","date":"September 8, 2023","hero":"/images/sistemas/storage_spaces/portada.png","permalink":"https://www.javiercd.es/posts/sistemas/almacenamiento_servidor_independiente/almacenamiento_servidor_independiente/","summary":"\u003cp\u003eStorage Spaces es una caracter√≠stica de almacenamiento definido por software en el sistema operativo Windows Server que permite a los administradores de sistemas combinar varios discos f√≠sicos en un √∫nico espacio de almacenamiento l√≥gico llamado \u0026ldquo;pool de almacenamiento\u0026rdquo;. Este pool de almacenamiento se puede utilizar para crear espacios de almacenamiento virtuales llamados \u0026ldquo;espacios de almacenamiento\u0026rdquo; que ofrecen diversas funciones de redundancia y capacidades avanzadas de administraci√≥n de almacenamiento.\u003c/p\u003e\n\u003ch2 id=\"grupos-de-almacenamiento\"\u003eGrupos de almacenamiento\u003c/h2\u003e\n\u003cp\u003eLos siguientes cmdlets de Windows PowerShell realizan la misma funci√≥n que el procedimiento anterior. Escriba cada cmdlet en una sola l√≠nea, aunque aqu√≠ pueden aparecer con saltos de l√≠nea entre varias l√≠neas aqu√≠ debido a restricciones de formato.\u003c/p\u003e","tags":["Linux","Sistemas","ISO","ASO"],"title":"Storage Spaces en Windows Server"},{"categories":null,"contents":"Introducci√≥n En este post detallado, exploramos el proceso de configuraci√≥n de t√∫neles IPv6 a IPv4 y viceversa en entornos Linux y Cisco. A medida que la migraci√≥n hacia IPv6 gana importancia, la capacidad de establecer comunicaciones entre redes IPv4 e IPv6 se vuelve fundamental. Cubriremos los conceptos b√°sicos de la configuraci√≥n de t√∫neles, incluyendo los tipos de t√∫neles m√°s comunes, como 6to4 y Teredo. Adem√°s, proporcionaremos instrucciones paso a paso para la configuraci√≥n tanto en sistemas Linux como en dispositivos Cisco.\nT√∫neles 6to4 en Cisco 1. Configuraci√≥n de las interfaces de red de los routers R1 FastEthernet 0/0 Prefijo de red: 3333:db7::/64 Enlace: FE80::C801:20FF:FE69:0 Global: 3333:DB7::C801:20FF:FE69:0 FastEthernet 1/0 FastEthernet 2/0 Para los clientes del router R1, configuraremos SLAAC:\nR2 FastEthernet 0/0 Prefijo de red: 3333:db7:1::/64 Enlace: FE80::C802:20FF:FE79:0 Global: 3333:DB7:1:0:C802:20FF:FE79:0 FastEthernet 1/0 FastEthernet 2/0 Para los clientes del router R2, configuraremos SLAAC:\nR3 FastEthernet 0/0 Prefijo de red: 3333:db7:2::/64 Enlace: FE80::C803:20FF:FE89:0 Global: 3333:DB7:2:0:C803:20FF:FE89:0 FastEthernet 1/0 FastEthernet 2/0 Para los clientes del router R3, configuraremos SLAAC:\nNota: En este escenario, no es necesario configurar rutas IPv4 manualmente, ya que con la configuraci√≥n dada en las tarjetas de red, el tr√°fico ser√° enrutable en IPv4.\n2. T√∫neles GRE GRE es un protocolo de t√∫nel VPN de sitio a sitio no seguro que puede encapsular una amplia variedad de paquetes de protocolos dentro de t√∫neles IP. Esto permite que una organizaci√≥n transmita otros protocolos a trav√©s de una WAN basada en IP.\nEsto permite agregar una cabecera IPv4 a un paquete IPv6 para que pueda viajar por redes IPv4.\nR1 ‚Üí R3 Crearemos una interfaz de t√∫nel:\nConfiguraci√≥n de T√∫nel GRE con IPv6 sobre IPv4 Establecemos el modo del t√∫nel a GRE con IP que encapsular√° nuestros paquetes IPv6 dentro de IPv4:\nLe asignamos una direcci√≥n IPv4 a nuestro t√∫nel:\nEstablecemos la direcci√≥n WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la direcci√≥n WAN del extremo del t√∫nel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento din√°mico:\nEste comando agrega la red del t√∫nel a OSPF:\nAsignamos una direcci√≥n IPv6 a nuestro t√∫nel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:0A00:0001::1/64:\nCreamos la ruta para llegar a la red:\nCreamos una interfaz de t√∫nel:\nEstablecemos el modo del t√∫nel a GRE con IP que encapsular√° nuestros paquetes IPv6 dentro de IPv4:\nLe asignamos una direcci√≥n IPv4 a nuestro t√∫nel:\nEstablecemos la direcci√≥n WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la direcci√≥n WAN del extremo del t√∫nel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento din√°mico:\nEste comando agrega la red del t√∫nel a OSPF:\nAsignamos una direcci√≥n IPv6 a nuestro t√∫nel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:0A00:0002::1/64:\nCreamos la ruta para llegar a la red:\nCreamos una interfaz de t√∫nel:\nEstablecemos el modo del t√∫nel a GRE con IP que encapsular√° nuestros paquetes IPv6 dentro de IPv4:\nLe asignamos una direcci√≥n IPv4 a nuestro t√∫nel:\nEstablecemos la direcci√≥n WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la direcci√≥n WAN del extremo del t√∫nel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento din√°mico:\nEste comando agrega la red del t√∫nel a OSPF:\nAsignamos una direcci√≥n IPv6 a nuestro t√∫nel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:1400:0001:\nCreamos la ruta para llegar a la red:\nR3 ‚Üí R1 Creamos una interfaz de t√∫nel:\nEstablecemos el modo del t√∫nel a GRE con IP, que encapsular√° nuestros paquetes IPv6 dentro de IPv4:\nAsignamos una direcci√≥n IPv4 a nuestro t√∫nel:\nEstablecemos la direcci√≥n WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la direcci√≥n WAN del extremo del t√∫nel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento din√°mico:\nEste comando agrega la red del t√∫nel a OSPF:\nAsignamos una direcci√≥n IPv6 a nuestro t√∫nel, con el prefijo de red 2002 a partir de la IPv4 del router 2002:1400:0002::1/64:\nCreamos la ruta para llegar a la red:\nR3 ‚Üí R2 Creamos una interfaz de t√∫nel:\nEstablecemos el modo del t√∫nel a GRE con IP, que encapsular√° nuestros paquetes IPv6 dentro de IPv4:\nAsignamos una direcci√≥n IPv4 a nuestro t√∫nel:\nEstablecemos la direcci√≥n WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la direcci√≥n WAN del extremo del t√∫nel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento din√°mico:\nEste comando agrega la red del t√∫nel a OSPF:\nAsignamos una direcci√≥n IPv6 a nuestro t√∫nel, con el prefijo de red 2002 a partir de la IPv4 del router 30.0.0.2 ‚Üí 2002:1e00:0002::1/64:\nCreamos la ruta para llegar a la red:\nR2 ‚Üí R3 Creamos una interfaz de t√∫nel:\nEstablecemos el modo del t√∫nel a GRE con IP, que encapsular√° nuestros paquetes IPv6 dentro de IPv4:\nAsignamos una direcci√≥n IPv4 a nuestro t√∫nel:\nEstablecemos la direcci√≥n WAN de nuestro router, FastEthernet 1/0:\nEstablecemos la direcci√≥n WAN del extremo del t√∫nel (R2):\nHabilitamos OSPF, que es un protocolo de enrutamiento din√°mico:\nEste comando agrega la red del t√∫nel a OSPF:\nAsignamos una direcci√≥n IPv6 a nuestro t√∫nel, con el prefijo de red 2002 a partir de la IPv4 del router 30.0.0.1 ‚Üí 2002:1e00:0001::1/64:\nCreamos la ruta para llegar a la red:\n3. Comprobaciones de funcionamiento Vamos a comprobar que se han creado los t√∫neles. Para ello, introduciremos el siguiente comando en los tres routers de nuestro escenario:\nEsto aparecer√° una vez ambos extremos del t√∫nel se hayan creado. Si no, no aparecer√° nada. En nuestro caso, podemos ver que los t√∫neles se han creado exitosamente.\nPing Comprobaremos el funcionamiento de los t√∫neles haciendo un ping.\nPC1 ‚Üí 3333:db7::e60:ddff:fea6:0 PC2 ‚Üí 3333:db7:1:0:e2e:3bff:fe83:0 PC3 ‚Üí 3333:db7:2:0:e62:5dff:fedf:0 PC1 ‚Üí PC2\nPC1 ‚Üí PC3\nPC2 ‚Üí PC1\nPC2 ‚Üí PC3\nPC3 ‚Üí PC1\nPC3 ‚Üí PC2\nVemos que tenemos conectividad entre todas nuestras m√°quinas del escenario con IPv6, aunque tengamos que atravesar redes IPv4.\nTraceroute Vamos a comprobar la trayectoria que siguen los paquetes.\nTrayectoria que sigue un paquete PC1 a PC2:\nTrayectoria que sigue un paquete PC1 a PC3:\nTrayectoria que sigue un paquete PC2 a PC1:\nTrayectoria que sigue un paquete PC2 a PC3:\nTrayectoria que sigue un paquete PC3 a PC1:\nTrayectoria que sigue un paquete PC3 a PC2:\n4. Estudio de un paquete encapsulado Antes de pasar por el t√∫nel\nPaquete que viaja de PC1 a PC2.\nVemos que, al no haber atravesado el t√∫nel a√∫n, no tiene las cabeceras IPv4, solo tiene las IPv6. Podemos ver que el origen es PC1 y el destino es PC3:\nVeremos c√≥mo, en el siguiente tramo, una vez atraviese el t√∫nel, el router le pondr√° una cabecera IPv4 para que pueda atravesar ese tramo.\nDespu√©s de atravesar el t√∫nel Si nos fijamos en un paquete que ha atravesado un t√∫nel, podemos ver que tiene \u0026ldquo;2 niveles de red\u0026rdquo;:\nSi nos fijamos en el nivel de red, vemos que las IPs de origen y destino son las de los extremos del t√∫nel. Adem√°s, vemos que utiliza el protocolo 47, lo que significa que ha atravesado un t√∫nel GRE.\nPor √∫ltimo, podemos ver en la cabecera IPv6 que no se distingue de una que no ha atravesado un t√∫nel.\nUna vez llega a la red de destino Vemos que, una vez llega al destino (es decir, una vez ha recorrido el tramo IPv4 y vuelve a entrar a la red IPv6), el router eliminar√° la cabecera correspondiente a IPv4 y dejar√° la de IPv6 para que el paquete llegue a su destino.\nVemos que la cabecera IPv6 sigue intacta, es la misma durante todo el trayecto del paquete:\nT√∫neles 6to4 en Linux 1. Configuraci√≥n de las interfaces de red Voy a respetar las direcciones IPv4 del escenario con Cisco.\nR1 Para aplicar la configuraci√≥n, haremos un sudo systemctl restart networking.service.\nVoy a configurar SLAAC para configurar los clientes de nuestra red IPv6. Previamente, tendremos que tener instalado el paquete radvd con sudo apt install radvd.\nUna vez configurado el servicio, reiniciaremos radvd y nuestros clientes se configurar√°n autom√°ticamente con el prefijo indicado.\nR2 Para aplicar la configuraci√≥n, haremos un sudo systemctl restart networking.service.\nVoy a configurar SLAAC para configurar los clientes de nuestra red IPv6. Previamente, tendremos que tener instalado el paquete radvd con sudo apt install radvd.\nUna vez configurado el servicio, reiniciaremos radvd y nuestros clientes se configurar√°n autom√°ticamente con el prefijo indicado.\nR3 Para aplicar la configuraci√≥n, haremos un sudo systemctl restart networking.service.\nVoy a configurar SLAAC para configurar los clientes de nuestra red IPv6. Previamente, tendremos que tener instalado el paquete radvd con sudo apt install radvd.\nUna vez configurado el servicio, reiniciaremos radvd y nuestros clientes se configurar√°n autom√°ticamente con el prefijo indicado.\nNota: En este escenario no es necesario que configuremos rutas IPv4 manualmente, ya que con la configuraci√≥n dada en las tarjetas de red, el escenario estar√° enrutado en IPv4.\nSin embargo, ser√° necesario para todos los routers que habilitemos el bit de forwarding tanto para IPv4 como para IPv6.\nPara ello, editamos el fichero sudo nano /etc/sysctl.conf y descomentamos las siguientes l√≠neas:\nEsto mismo lo repetiremos para cada uno de nuestros routers y reiniciaremos para que se apliquen los cambios.\n2. Configuraci√≥n de los t√∫neles SIT El funcionamiento es similar a los t√∫neles GRE en Cisco. Este coger√° nuestros paquetes y, a trav√©s de una interfaz tipo t√∫nel, le a√±adir√° una cabecera IPv4 para que pueda atravesar redes IPv4.\nUna vez el t√∫nel est√© levantado, le diremos al router que, para llegar al prefijo de la red X, tendr√° que utilizar este t√∫nel para que le a√±ada la cabecera a nuestros paquetes.\nPara mayor comodidad, he creado un peque√±o script en cada router con los comandos necesarios para que el t√∫nel funcione.\nConsta de 4 comandos:\nCrear√° la interfaz de t√∫nel con el destino y, a continuaci√≥n, el origen de este. Levantar√° la tarjeta de red. Le asignar√° la IPv6 al t√∫nel a partir de la direcci√≥n IPv4 de origen del mismo. Crearemos la ruta del tr√°fico que utilizar√° el t√∫nel. Podemos ponerle al t√∫nel el nombre que deseemos. En mi caso, he puesto tunnel seguido de un n√∫mero para poder identificarlos.\nT√∫neles de R2 As√≠ quedar√≠a el \u0026ldquo;script\u0026rdquo; de los t√∫neles de R2:\nUna vez creado el script, le daremos permiso y lo ejecutaremos:\nComprobaremos que las interfaces se han creado correctamente:\nT√∫neles de R3 As√≠ quedar√≠a el \u0026ldquo;script\u0026rdquo; de los t√∫neles de R3:\nUna vez creado el script, le daremos permiso y lo ejecutaremos:\nComprobaremos que las interfaces se han creado correctamente:\n3. Comprobaci√≥n de funcionamiento PC1 ‚Üí 3333:db7::e47:bfff:fe86:0 PC2 ‚Üí 2222:db7::ebc:f6ff:fe7d:0 PC3 ‚Üí 4444:db7::e43:78ff:fec6:0 Ping PC1 ‚Üí PC2\nPC1 ‚Üí PC3\nPC2 ‚Üí PC1\nPC2 ‚Üí PC3\nPC3 ‚Üí PC1\nPC3 ‚Üí PC2\nTraceroute Una vez que hemos comprobado que tenemos conectividad, vamos a ver si los paquetes utilizan los t√∫neles.\nPC1 ‚Üí PC2\nPC1 ‚Üí PC3\nPC2 ‚Üí PC1\nPC2 ‚Üí PC3\nPC3 ‚Üí PC1\nPC3 ‚Üí PC2\n4. Estudio de un paquete encapsulado Antes de pasar por el t√∫nel Paquete que viaja de PC1 a PC2.\nVemos que, al no haber atravesado el t√∫nel a√∫n, no tiene las cabeceras IPv4, solo tiene las IPv6. Podemos ver que el origen es PC1 y el destino es PC3:\nVeremos c√≥mo, en el siguiente tramo, una vez atraviese el t√∫nel, el router le pondr√° una cabecera IPv4 para que pueda atravesar ese tramo.\nDespu√©s de atravesar el t√∫nel Si nos fijamos en un paquete que ha atravesado un t√∫nel, podemos ver que tiene \u0026ldquo;2 niveles de red\u0026rdquo;.\nSi nos fijamos en el nivel de red, vemos que las IPs de origen y destino son las de los extremos del t√∫nel. Adem√°s, vemos que utiliza el protocolo 47, lo que significa que ha atravesado un t√∫nel GRE.\nPor √∫ltimo, podemos ver en la cabecera IPv6 que no se distingue de una que no ha atravesado un t√∫nel.\nUna vez llega a la red de destino Vemos que, una vez llega al destino (es decir, una vez ha recorrido el tramo IPv4 y vuelve a entrar a la red IPv6), el router eliminar√° la cabecera correspondiente a IPv4 y dejar√° la de IPv6 para que el paquete llegue a su destino.\nVemos que la cabecera IPv6 sigue intacta, es la misma durante todo el trayecto del paquete:\nBibliograf√≠a T√∫neles autom√°ticos 6to4 T√∫neles Autom√°ticos Para Ipv6 T√∫neles GRE T√∫neles SIT 6to4 Linux ","date":"September 8, 2023","hero":"/images/redes/tuneles_ipv6/portada.png","permalink":"https://www.javiercd.es/posts/redes/tuneles_ipv6/tuneles_ipv6/","summary":"\u003ch2 id=\"introducci√≥n\"\u003eIntroducci√≥n\u003c/h2\u003e\n\u003cp\u003eEn este post detallado, exploramos el proceso de configuraci√≥n de t√∫neles IPv6 a IPv4 y viceversa en entornos Linux y Cisco. A medida que la migraci√≥n hacia IPv6 gana importancia, la capacidad de establecer comunicaciones entre redes IPv4 e IPv6 se vuelve fundamental. Cubriremos los conceptos b√°sicos de la configuraci√≥n de t√∫neles, incluyendo los tipos de t√∫neles m√°s comunes, como 6to4 y Teredo. Adem√°s, proporcionaremos instrucciones paso a paso para la configuraci√≥n tanto en sistemas Linux como en dispositivos Cisco.\u003c/p\u003e","tags":["Redes","IPv6","IPv4","Cisco","Linux"],"title":"T√∫neles IPv6"},{"categories":null,"contents":"Introducci√≥n Vives en UNDERWORLD. En tu mundo, se presentan diferentes tipos de especies con un √∫nico fin, ‚Äúcruzarse‚Äù entre s√≠. Estas criaturas son:\nVAMPIROS\nLIC√ÅNTROPOS: hombres lobo con la capacidad de regresar a su estado humano.\nHOMBRES LOBO: hombres lobo que tras su primera conversi√≥n a lobo, no pudieron regresar a su estado humano.\nHUMANOS: unos mierdecillas.\nT√ö: un guerrero inform√°tico con superpoderes como darse la vuelta a un juego que todav√≠a no ha salido al mercado o poseer la facultad de volverse invisible cuando sale de fiesta y trata de cortejar a una f√©mina dici√©ndole frases del tipo: ¬øquieres que te compile el kernel nena?\nEl aspecto de UNDERWORLD es el siguiente:\n1.Enturar el escenario Tablas de enrutamiento a ‚Äúpapel‚Äù ROUTER HUMANO 192.168.1.0/24 0.0.0.0 F0/0 192.168.2.0/24 0.0.0.0 F1/0 192.168.3.0/24 192.168.2.2 F1/0 192.168.4.0/24 192.168.2.2 F1/0 192.168.5.0/24 192.168.2.2 F1/0 192.168.6.0/24 192.168.2.2 F1/0 192.168.7.0/24 192.168.2.2 F1/0 0.0.0.0/0 192.168.2.2 F1/0 ROUTER VAMPIROS 192.168.1.0/24 192.168.2.1 F1/0 192.168.2.0/24 0.0.0.0 F1/0 192.168.3.0/24 0.0.0.0 F0/0 192.168.4.0/24 0.0.0.0 F2/0 192.168.5.0/24 192.168.4.2 F2/0 192.168.6.0/24 192.168.4.2 F2/0 192.168.7.0/24 192.168.4.2 F2/0 0.0.0.0/0 192.168.4.2 F2/0 ROUTER LIC√ÅNTROPOS 192.168.1.0/24 192.168.4.1 F2/0 192.168.2.0/24 192.168.4.1 F2/0 192.168.3.0/24 192.168.4.1 F2/0 192.168.4.0/24 0.0.0.0 F2/0 192.168.5.0/24 0.0.0.0 F0/0 192.168.6.0/24 0.0.0.0 F1/0 192.168.7.0/24 192.168.6.2 F1/0 0.0.0.0/0 192.168.4.1 F1/0 ROUTER HOMBRE LOBO 192.168.1.0/24 192.168.6.1 F1/0 192.168.2.0/24 192.168.6.1 F1/0 192.168.3.0/24 192.168.6.1 F1/0 192.168.4.0/24 192.168.6.1 F1/0 192.168.5.0/24 192.168.6.1 F1/0 192.168.6.0/24 0.0.0.0 F1/0 192.168.7.0/24 0.0.0.0 F0/0 0.0.0.0/0 192.168.6.1 F1/0 2.Configuraci√≥n direcciones Ips interfaces Router humanos Guardamos la configuraci√≥n :\nRouter vampiros Guardamos la configuraci√≥n :\nRouter lic√°ntropos Guardamos la configuraci√≥n :\nRouter vampiros Guardamos la configuraci√≥n :\n3. A√±adiendo la tabla de enrutamiento a los routers Router humanos Nos creara por defecto las rutas a las redes que estamos conectados solo necesitaremos a√±adir la ruta por defecto :\nNos quedar√≠a la tabla de enrutamiento :\nGuardamos la configuraci√≥n :\nRouter vampiros A√±adiremos las siguientes rutas :\nAs√≠ quedar√≠a la tabla de enrutamiento :\nGuardamos la configuraci√≥n :\nRouter lic√°ntropos A√±adimos las siguientes rutas :\nAs√≠ quedar√≠a nuestra tabla de enrutamiento :\nGuardamos la configuraci√≥n :\nRouter hombres lobo A√±adimos las siguientes rutas :\nAs√≠ quedar√≠a nuestra tabla de enrutamiento :\nGuardamos la configuraci√≥n :\n4.Prueba de enrutamiento Para no hacer muy extenso este apartado comprobare que desde PC1 llego a todos los PCs:\n5.Configuraci√≥n ACLs Todo el mundo utiliza la red para mandarse mensajitos y ligar (por lo que deber√°s configurar la red para que esto sea posible en un principio, es decir, que todos los equipos tengan conexi√≥n entre s√≠). T√∫, que ya est√°s hasta la *#%?! de tanto bicho raro como consecuencia de los cruces que se producen cuando un vampiro se cruza por ejemplo con un lic√°ntropo y el hijo de √©stos con un hombre lobo y as√≠ sucesivamente, decides ponerle fin a la historia haciendo lo siguiente, meti√©ndole unas cuantas ACLs a los routers que los comunican:\nLos VAMPIROS no podr√°n comunicarse con el resto de especies. Creamos la regla para denegar el trafico de la red 192.168.3.0:\nLa aplicamos a la interfaz FastEthernet 0/0(192.168.3.1) y la aplicamos a la salida de esta :\nComprobaremos que los PCs de la red de Vampiros no pueden comunicarse con el resto , nos dice que hay una ACL cort√°ndonos el paso :\nSi desde cualquier otro reino nos comunicamos con ellos los mensajes ser√°n capaces de llegar a ellos sin embargo la respuesta no llegaran ya que la ACL lo impide , la respuesta es cortada ya que sale de la red de los vampiros :\nLos HOMBRES LOBO y los LIC√ÅNTROPOS, dado que no son tan repulsivos cuando se cruzan, podr√°n comunicarse entre s√≠. Con el resto de especies no tendr√°n comunicaci√≥n. Este apartado podemos darle diferentes soluciones , yo he optado por poner una ACL , en la interfaz F2/0 del router de lic√°ntropos .\nCreamos la ACL :\nY la aplicamos de salida de la interfaz F2/0 de salida :\nComprobaremos que la ACL funciona , haciendo pings entre las maquinas.\nDesde PC7 vemos que no nos permite salir del router de lic√°ntropos , este nos corta la comunicaci√≥n pero sin embargo podemos llegar a las dem√°s redes :\nDesde PC5 podemos observar el mismo resultado :\nDesde PC1 vemos que no obtenemos respuesta ya que solo estamos cortando el trafico de salida impidiendo que las maquinas de ‚Äúdentro‚Äù se comuniquen con las de fuera .\nHUMANOS tampoco podr√°n comunicarse con el resto de especies\nCon el esquema actual de ACLs no seria necesario implementar una nueva regla en ya que con el esquema actual no es posible la comunicaci√≥n con ellos . Aunque los mensajes que PC1 realice lleguen a su destino este no recibir√° ninguna respuesta .\nPero si aun as√≠ queremos impedir que los humanos puedan enviar mensajes a los dem√°s desde su red implementaremos la siguiente regla en su router :\nAhora estamos cortando los mensajes de los humanos desde el Router 1:\n6.Servidor DHCP Al final decides hacer negocio con las especies raras porque no tienen ni pajolera idea de inform√°tica y eres contratado por estos entes malignos para que lleves a cabo las siguientes tareas:\nHombres lobo\nLos hombres lobo que son bastante burros metiendo direcciones IP a sus m√°quinas, te piden que les configures el servicio DHCP para que todas sus m√°quinas reciban autom√°ticamente una IP libre:\nTendremos que hacer los siguientes pasos :\nEl comando ip dhcp excluded-address 192.168.7.1 ‚Äì\u0026gt; Se√±alamos las direcciones que no queremos que se repartan por DHCP , es decir las exclusiones . El comando ip dhcp pool HOMBRES_LOBO nombramos al rango de direcciones que estamos repartiendo Nos meter√° a la configuraci√≥n del rango, ahora le decimos la red que queremos que reparta las direcciones network 192.168.7.0 255.255.255.0 Ahora le indicaremos que puerta de enlace queremos que asigne default-router 192.168.7.1 Si quisi√©ramos configurar un servidor DNS , por ejemplo el de google seria as√≠ dns-server 8.8.8.8 Podemos ver que el servidor DHCP esta funcionando correctamente con los par√°metros que le hemos indicado anteriormente :\nLic√°ntropos\nLos lic√°ntropos por su parte, te contratan para que les asignes tambi√©n por DHCP sus IPs, pero te indican que no pueden recibir las primeras 10 direcciones de su rango (sin contar la de red ni la de la puerta de enlace), ya que √©stas, est√°n reservadas para los jefes de su clan que est√°n de viaje y volver√°n en unos d√≠as.\nDeclaramos las ips que vamos a excluir :\nNombramos al rango de direcciones que estamos repartiendo para as√≠ poder configurarlo:\nLe decimos la red que queremos que reparta las direcciones :\nAhora le indicaremos que puerta de enlace queremos que asigne :\nComprobaremos que el servidor dhcp esta funcionando :\n7.Modificaci√≥n ACLs Permitir ligar con las vampiros\nDe tanto hacer negocio con los vampiros, te fijas en un par de vampiritas que est√°n de muy buen ver y te gustar√≠a poder enviarles mensajitos desde el chalet que te acabas de comprar en HUMANLAND con el pastizal que les est√°s sacando a las pobres ‚Äúcriaturicas‚Äù. Tu IP es la 192.168.1.4 y la de SELENE y SONJA son la 192.168.3.4 y 192.168.3.5 respectivamente. A√±ade una m√°quina a HUMANLAND para tu equipo denominado IT KNIGHT y 2 m√°quinas denominadas SELENE y SONJA con las mencionadas IPs en TRANSILVANIA.\nSi queremos realizar esto deberemos de configurar ACLs avanzadas para poder controlar el origen y el destino de los paquetes.\nLa sintaxis es bastante sencilla en este caso :\npermit ip IP_ORIGEN WILDCARD IP_DESTINO WILDCARD Crearemos la ACL para los humanos :\nTambi√©n crearemos la ACL para los vampiros :\nLa aplicaremos a la interfaz de entrada en cada red , ambas son la FastEthernet 0/0 :\n*****Deberemos de haber quitado anteriormente las lista asignada a la interfaz si no dar√° un error , para quitarla es el mismo comando que para ponerla poniendo un no delante .\nAhora comprobaremos la efectividad de estas reglas que hemos implementado :\nIT KNIGHT ‚Äì\u0026gt; SELENE y SONJA\nVemos que solo nos permite el trafico hacia estos dos host espec√≠ficos tal y como hemos indicado en nuestras ACLs\nSELENE ‚Äì\u0026gt; IT KNIGHT\nVemos que solo nos permite el trafico hacia estos dos host espec√≠ficos tal y como hemos indicado en nuestras ACLs , si intentamos comunicarnos con otro host cortara el trafico la ACL:\nSONJA‚Äì\u0026gt; IT KNIGHT\nVemos que solo nos permite el trafico hacia estos dos host espec√≠ficos tal y como hemos indicado en nuestras ACLs , si intentamos comunicarnos con otro host cortara el trafico la ACL:\nTambi√©n podemos ver las estad√≠sticas de la ACL en el router fij√°ndonos en los hits de la regla para ver si est√°n funcionando :\nAunque en ninguna de las listas hemos especificado en deny any , no seria necesario ya que esta impl√≠cito , es decir por defecto al no cumplirse ninguna regla desechara el trafico .\n8. Servidor web Desde que no se puede ligar en UNDERWORLD, est√°n todos m√°s aburridos que un ajo, as√≠ que decides ponerles un servidor WEB interno a UNDERWORLD. A√±ade al router PUENTE 1, un servidor denominado FICHEROS que tendr√° la IP 192.168.8.2/24, creando las ACLs necesarias para que la comunidad entera de UNDERWORLD, pueda entretenerse viendo algunas web chulas.\nLo primero sera configurar la nueva interfaz del router de los HUMANOS:\nLo siguiente sera configurar para nuestro esquema actual en el router de VAMPIROS la ruta a la nueva red para que se route el escenario correctamente :\nYa por ultimo configuraremos la ip de nuestro debian de forma est√°tica con la direcci√≥n 192.168.8.2:\nAdem√°s le instalaremos apache (deberemos hacerlo previamente conectado a la nube NAT ) :\nUna vez ya tenemos el servidor web preparado y enrutado en nuestro escenario , vamos a modificar las distintas ACLs para que solo puedan llegar al servidor web por el puerto 80 .\nEn el router de los humanos a√±adimos la siguiente regla , la cual permite todo el trafico hacia el host 192.168.8.2 que vaya al puerto 80:\nPara refrescar la lista y que se apliquen los cambios deberemos de volver a asign√°rsela al router :\nAhora haremos lo mismo con el router de los vampiros ya que tiene configuradas ACLs extendidas al igual que los humanos :\nAhora vamos a configurar una ACL avanzada para los lic√°ntropos y los hombres lobo :\nVamos a comprobar que NO podemos hacerle ping al servidor desde los VPCs:\nEn resumen hemos mantenido las reglas anteriores pero hemos permitido el trafico al servidor web siempre y cuando venga por el puerto 80 , por eso no podemos hacerle ping .\nVamos a comprobar que podemos acceder al servidor web desde las redes : ‚Äì\u0026gt;HUMANOS :\n‚Äì\u0026gt;VAMPIROS:\n‚Äì\u0026gt;LIC√ÅNTROPOS:\n‚Äì\u0026gt; HOMBRES LOBO :\n","date":"September 8, 2023","hero":"/images/redes/underworld/portada_underwolrd.webp","permalink":"https://www.javiercd.es/posts/redes/underworld/underworld/","summary":"\u003ch2 id=\"introducci√≥n\"\u003eIntroducci√≥n\u003c/h2\u003e\n\u003cp\u003eVives en UNDERWORLD. En tu mundo, se presentan diferentes tipos de especies con un √∫nico fin, ‚Äúcruzarse‚Äù entre s√≠. Estas criaturas son:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eVAMPIROS\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eLIC√ÅNTROPOS: hombres lobo con la capacidad de regresar a su estado humano.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHOMBRES LOBO: hombres lobo que tras su primera conversi√≥n a lobo, no pudieron regresar a su estado humano.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eHUMANOS: unos mierdecillas.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eT√ö: un guerrero inform√°tico con superpoderes como darse la vuelta a un juego que todav√≠a no ha salido al mercado o poseer la facultad de volverse invisible cuando sale de fiesta y trata de cortejar a una f√©mina dici√©ndole frases del tipo: ¬øquieres que te compile el kernel nena?\u003c/p\u003e","tags":["Redes","Wireshark","GNS3","Cisco","Enrutamiento","ACLS"],"title":"Underworld"},{"categories":null,"contents":"El mundo de UNDERWORLD ha evolucionado mucho en los √∫ltimos meses, as√≠ que debes realizar tareas de administraci√≥n de la red para afrontar la nueva situaci√≥n.\nPor un lado, se ha descubierto Internet en el Inframundo, de forma que cada uno de los submundos (recuerda: vampiros, lic√°ntropos, hombres lobo y humanos) se conecta a un router que, a su vez, les conecta a uno de los dos grandes routers que forman la Internet de Underworld, llamados Marcus (para humanos y vampiros) y Alexander (para hombres lobo y lic√°ntropos). Marcus y Alexander est√°n conectados entre s√≠.\nEl esquema ser√≠a el siguiente:\nPor otro lado, los seres del inframundo han descubierto una vulnerabilidad en los routers CISCO que les permite saltarse las listas de control de acceso, volviendo al caos que lograste impedir en su d√≠a con las ACL.\nTu tarea consistir√° entonces en:\nSustituir en la infraestructura de red los routers CISCO por m√°quinas Linux siguiendo el esquema de la figura. Configurar adecuadamente las m√°quinas Linux para que funcionen como routers. Crear las tablas de enrutamiento necesarias para que todas las m√°quinas se comuniquen con todas en principio, teniendo en cuenta que las redes internas tendr√°n direcciones privadas y en Internet tendremos direcciones p√∫blicas. Configurar los cortafuegos necesarios en los routers para que: Los VAMPIROS no puedan comunicarse con el resto de especies. Los HOMBRES LOBO y los LIC√ÅNTROPOS, dado que no son tan repulsivos cuando se cruzan, podr√°n comunicarse entre s√≠. Con el resto de especies no tendr√°n comunicaci√≥n. HUMANOS tampoco podr√°n comunicarse con el resto de especies. Configurar el servicio DHCP que ten√≠an los hombres lobo y los lic√°ntropos en las mismas condiciones que ten√≠an cuando se usaban routers CISCO. Configurar en los cortafuegos las reglas necesarias para que, desde HUMANLAND, IT KNIGHT siga comunic√°ndose con sus dos vampiras favoritas (SONJA Y SELENE). Realiza las configuraciones necesarias para montar en HUMANLAND un servidor web accesible desde cualquier parte de UNDERWORLD. Preparaci√≥n del escenario en Linux Configuraci√≥n de las tarjetas de red Lo primero que haremos sera a√±adir las tarjetas de red necesarias a cada router , para ello con la maquina apagada hacemos sobre la misma clic derecho \u0026gt; configuraci√≥n \u0026gt; network y a√±adimos los slots que sean necesarios para cada maquina :\nNecesitaremos el siguiente numero de tarjetas de red por cada dispositivo :\nRouter 1 , 2 ,3 y 4 : Necesitaran 2 tarjetas de red MARCUS y ALEXANDER : Necesitaran 3 tarjetas de red PCs : Necesitaran 1 tarjeta de red Una vez hecho esto editaremos el fichero /etc/network/interfaces para realizar nuestra configuraci√≥n de red .\nPosteriormente reiniciaremos el servicio networking con systemctl restart networking.service para que se aplique la configuraci√≥n de red que hemos indicado .\nConfiguraci√≥n de la tarjeta de red Router 1 :\nConfiguraci√≥n de la tarjeta de red Router 2 :\nConfiguraci√≥n de la tarjeta de red Router 3 :\nConfiguraci√≥n de la tarjeta de red Router 4 :\nConfiguraci√≥n de la tarjeta de red Router MARCUS :\nConfiguraci√≥n de la tarjeta de red Router ALEXANDER :\nActivar el bit de forwarding Si queremos hacer que una maquina Linux actu√© como router , es decir que enroute los paquetes que no tienen como destino esta deberemos de activar el bit de forwarding .\nAdem√°s aprovecharemos para activar el bit de forwarding permanentemente en los routers del escenario para ello editamos el fichero /etc/sysctl.conf y descomentamos esta linea :\nEsto mismo repetiremos para los 6 routers que tenemos en el escenario :\nRouter 1:\nRouter 2:\nRouter 3:\nRouter 4:\nRouter MARCUS:\nRouter ALEXANDER:\nAhora todas nuestras maquinas est√°n configuradas para actuar como routers y encaminaran los paquetes que le lleguen y no sean para esta .\nConfiguraci√≥n de rutas Aqu√≠ te mostrare si he a√±adido alguna ruta manualmente y las tablas de enrutamiento de los dispositivos .\nRouter MARCUS:\nRouter ALEXANDER:\nRouter 1:\nRouter 2:\nRouter 4:\nTeniendo la configuraci√≥n de red que tengo en las tarjetas solo he a√±adido 2 rutas manuales , en los routers de MARCUS y ALEXANDER en el resto no ha sido necesario ya que esta se genera autom√°ticamente con la puerta de enlace que hayamos colocado al configurar las interfaces de red .\nPodr√≠a haberme ahorrado escribirlas si les hubiese colocado en las interfaz que esta configurada en la red 100.X.X.X la direcci√≥n ip del otro como puerta de enlace .\nPrueba de conectividad Vamos a comprobar que hemos realizado el enrutamiento correctamente as√≠ que voy a lanzar un ping desde cada router a cada uno de los extremos del escenario .\nRouter 1 :\nRouter 2 :\nRouter 3:\nRouter 4:\nQueda comprobado que tenemos conectividad entre todos los routers , los PCS no podr√°n tener ‚Äúconectividad‚Äù hasta que configuremos el SNAT .\nConfiguraci√≥n DHCP Lic√°ntropos Los lic√°ntropos por su parte, te contratan para que les asignes tambi√©n por DHCP sus IPs, pero te indican que no pueden recibir las primeras 10 direcci√≥nes de su rango (sin contar la de red ni la de la puerta de enlace), ya que √©stas, est√°n reservadas para los jefes de su clan que est√°n de viaje y volver√°n en unos d√≠as.\nCon la maquina conectada a la nube NAT y la tarjeta que este conectada configurada por DHCP nos descargaremos el servidor DHCP , para esto primero deberemos de hacer un apt update ya que la maquina no trae cargados los repositorios en memoria :\nCuando acabe de instalarse nos dar√° un error , este es debido a que no esta configurado el servicio y no sabe por que interfaz tiene que repartir direcci√≥nes el servidor :\nPara ello editaremos el fichero /etc/default/isc-dhcp-server y a√±adiremos el nombre de la tarjeta en la secci√≥n de IPV4 :\nAhora configuraremos el √°mbito con los requisitos que nos solicitan los lic√°ntropos para ello editaremos el fichero /etc/dhcp/dhcpd.conf :\nTendremos que tener en cuenta que la configuraci√≥n que pongamos aqu√≠ sea coherente con la configuraci√≥n de red que tenemos , tenemos que tener en cuenta que tenemos una /28 as√≠ que en este caso solo podremos tener 14 direcci√≥nes asignables .\nPero si seguimos el enunciado las 10 primeras no las quieren por lo que solo podremos asignar 3 a nuestros clientes .\nUna vez hecho esto reiniciaremos el servicio :\nY veremos si esta funcionando , viendo el estado :\nLe asignaremos ip a un PC para comprobar que funciona :\nHombres lobo Los hombres lobo que son bastante burros metiendo direcci√≥nes IP a sus m√°quinas, te piden que les configures el servicio DHCP para que todas sus m√°quinas reciban autom√°ticamente una IP libre.\nCon la maquina conectada a la nube NAT y la tarjeta que este conectada configurada por DHCP nos descargaremos el servidor DHCP , para esto primero deberemos de hacer un apt update ya que la maquina no trae cargados los repositorios en memoria :\nCuando acabe de instalarse nos dar√° un error , este es debido a que no esta configurado el servicio y no sabe por que interfaz tiene que repartir direcci√≥nes el servidor :\nPara ello editaremos el fichero /etc/default/isc-dhcp-server y a√±adiremos el nombre de la tarjeta en la secci√≥n de IPV4 :\nPor suerte los hombres lobo son menos exigentes y ellos quieres que se reparta su rango de direcci√≥nes completo as√≠ que para ello editaremos el fichero /etc/dhcp/dhcpd.conf :\nAhora reiniciaremos el servicio :\nComprobaremos el estado del mismo para comprobar que este funcionando correctamente :\nLe asignaremos una direcci√≥n a un cliente para asegurarnos que todo funciona correctamente :\nConfiguraci√≥n SNAT Para acabar la fase de preparaci√≥n necesitaremos de configurar SNAT para que las distintas razas puedan comunicarse entre si .\nRouter 1 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aqu√≠ vemos una captura entre el Router 1 y el PC1 :\nVemos que una vez fuera de la red entre R1 y MARCUS se ha aplicado SNAT :\nRouter 2 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aqu√≠ vemos una captura entre el Router 2 y el PC3. Vemos que el origen es una direcci√≥n ip privada :\nVemos que una vez fuera de la red entre R2 y MARCUS se ha aplicado SNAT , ya que el origen ahora es una direcci√≥n ip publica :\nRouter 3 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aqu√≠ vemos una captura entre el Router 3 y el PC5. Vemos que el origen es una direcci√≥n ip privada :\nVemos que una vez fuera de la red entre R3 y ALEXANDER se ha aplicado SNAT , ya que el origen ahora es una direcci√≥n ip publica :\nRouter 4 :\nMe he creado un archivo llamado iptables para guardar todas las reglas de la practica :\nPara demostrar que funciona la regla , aqu√≠ vemos una captura entre el Router 4 y el PC7. Vemos que el origen es una direcci√≥n ip privada :\nVemos que una vez fuera de la red entre R4 y ALEXANDER se ha aplicado SNAT , ya que el origen ahora es una direcci√≥n ip publica :\nCon el escenario actual cualquier PC es capaz de llegar a todas las direcci√≥nes publicas de nuestra red :\nConfiguraci√≥n DNAT Para que las maquinas puedan comunicarse entre si se les ha instalado ssh , as√≠ que tendremos que configurar el DNAT .\nR1\nPara esta red como tenemos dos clientes le he cambiado el puerto que usa el ssh :\nComprobamos que puedo conectarme a ambos host desde otra red , as√≠ vemos que funciona el DNAT.\nSonja:\nSelene:\nR2\nEn esta red solo tenemos un cliente que queremos que se pueda acceder desde el exterior as√≠ que solo tendremos una regla de DNAT :\nPara comprobar la regla me meter√© desde los vampiros a los humanos :\nR3\nEn esta red al haber un servicio DHCP corriendo para que la regla de DNAT funcione correctamente deberemos de hacerle una reserva a nuestro host o configurarle la tarjeta de manera est√°tica.\nYo har√© lo primero por comodidad , para ello nos dirigimos al fichero /etc/dhcp/dhcpd.conf y escribimos lo siguiente:\nhost NombreDeLaReserva { hardware ethernet DIR_MAC_HOST; fixed-address IP_RESERVA;} Una vez hecho esto reiniciamos el servicio :\nY pondr√© la siguiente regla:\nAhora vamos a comprobar que me puedo conectar a este host:\nR4\nEn esta red tambi√©n le configuraremos una reserva en el servidor para que nuestras reglas se mantengan activas , en este caso le asignare la direcci√≥n 192.168.4.5.\nReiniciaremos el servicio y comprobamos que nuestro host tenga asignada la ip de la reserva , en caso contrario solicitaremos otra con dhclient :\nAhora a√±adiremos la regla de DNAT para que se pueda llegar al servidor ssh :\nComprobamos que la regla esta funcionando y podemos conectarnos desde otra red :\nConfiguraci√≥n cortafuegos Los Vampiros no puedan comunicarse con el resto de especies Pondr√© una pol√≠tica por defecto DROP en la tabla FORWARD para que tire todo el trafico proveniente de la red de los vampiros :\nComprobaremos que los vampiros son incapaces de llegar a las dem√°s redes :\nPodemos ver los hits que ha realizado para ver que esta funcionando la regla :\nPermitir comunicaci√≥n entre Hombres Lobo y Lic√°ntropos Los HOMBRES LOBO y los LIC√ÅNTROPOS, dado que no son tan repulsivos cuando se cruzan, podr√°n comunicarse entre s√≠. Con el resto de especies no tendr√°n comunicaci√≥n.\nPondr√© una pol√≠tica por defecto DROP en la tabla FORWARD y a continuaci√≥n permitir√© el trafico que entre por la interfaz ens4 y salga por la ens5 , y la inversa para permitir el trafico entre esta dos redes :\nVemos que entre ellos pueden comunicarse sin embargo no pueden acceder a los Humanos ni a los Vampiros :\nComprobaremos que las reglas tienen hits :\nHUMANOS tampoco podr√°n comunicarse con el resto de especies Con las reglas que tenemos actualmente la comunicaci√≥n con otras especies por parte de los humanos no es posible, podemos ver que en R2 sin ninguna regla adicional no podemos conectarnos :\nVemos que no podemos comunicarnos :\nSi queremos prohibir el trafico en nuestro router y no depender de las reglas externas en caso de que estas cambien a√±adiremos una pol√≠tica por defecto DROP :\nVeremos los hits en la pol√≠tica por defecto :\nConfigurar en los cortafuegos las reglas necesarias para que, desde HUMANLAND, IT KNIGHT siga comunic√°ndose con sus dos vampiros favoritas (SONJA Y SELENE). Las ips de estas maquinas son :\nIT KNIGHT (SSH)‚Äì\u0026gt; 192.168.2.3:22 SONJA (SSH) ‚Äì\u0026gt; 192.168.1.4:22 SELENE (SSH) ‚Äì\u0026gt; 192.168.1.5:2222 En el router 1 las reglas necesarias para poder permitir esta comunicaci√≥n son :\nEn el router 2 las reglas necesarias para poder permitir esta comunicaci√≥n son :\nVamos a ir comprobando acci√≥n a acci√≥n para asegurarnos de que estas reglas realizan su cometido.\nSELENE ‚Äì\u0026gt; ITKNIGHT\nEn el router 1 :\nEn el router 2:\nSONJA ‚Äì\u0026gt; ITKNIGHT\nHacemos ssh :\nVemos los hits del router 1:\nVemos los hits del router 2(Misma regla que el apartado anterior) :\nITKNIGHT ‚Äì\u0026gt; SONJA\nHacemos ssh :\nVemos los hits del router 1 :\nVemos los hits del router 2 :\nITKNIGHT ‚Äì\u0026gt; SELENE\nLanzamos el ssh :\nVemos los hits del router 1 :\nVemos los hits del router 2:\nServidor web HUMANLAND Realiza las configuraciones necesarias para montar en HUMANLAND un servidor web accesible desde cualquier parte de UNDERWORLD.\nLe he dado a este la ip 192.168.2.10 .\nLo primero que debemos de configurar es el DNAT en el router R2(HUMALAND):\nAhora en el router 2 permitiremos que se reciban peticiones al servidor y sus respuestas :\nEn el router 1 permitimos que puedan hacer peticiones y sus respuestas :\nPara terminar en ALEXANDER permitimos que puedan atravesar peticiones web :\nVamos a comprobar que se pueden acceder desde todas las redes .\nVAMPIROS :\nComprobamos los hits en router 1 :\nHOMBRES LOBO Y LIC√ÅNTROPOS\nHacemos la petici√≥n web desde ambas redes :\nComprobamos los hits en router ALEXANDER :\nPor ultimo vemos los hits en el Router 2 (HUMANOS) de la regla DNAT\nEscenario con routers Cisco Configuraci√≥n de las interfaces R1\nR2\nR3\nR4\nMARCUS\nALEXANDER\nTablas de enrutamiento R1\nA√±adimos la ruta por defecto :\nAs√≠ quedar√≠a la tabla de enrutamiento de R1:\nR2\nA√±adimos la ruta por defecto :\nAs√≠ quedar√≠a la tabla de enrutamiento de R2:\nR3\nA√±adimos la ruta por defecto :\nAs√≠ quedar√≠a la tabla de enrutamiento de R3:\nR4\nA√±adimos la ruta por defecto :\nAs√≠ quedar√≠a la tabla de enrutamiento de R4:\nMARCUS\nA√±adimos la ruta por defecto :\nAs√≠ quedar√≠a la tabla de enrutamiento de MARCUS:\nALEXANDER\nA√±adimos la ruta por defecto :\nAs√≠ quedar√≠a la tabla de enrutamiento de ALEXANDER:\nPrueba de conectividad Vamos a comprobar que hemos realizado el enrutamiento correctamente as√≠ que voy a lanzar un ping desde cada router a cada uno de los extremos del escenario .\nR1 ‚Üí A los extremos :\nR2 ‚Üí A los extremos :\nR3 ‚Äì\u0026gt; a los extremos:\nR4 ‚Äì\u0026gt; a los extremos\nConfiguraci√≥n DHCP Lic√°ntropos Los lic√°ntropos por su parte, te contratan para que les asignes tambi√©n por DHCP sus IPs, pero te indican que no pueden recibir las primeras 10 direcci√≥nes de su rango (sin contar la de red ni la de la puerta de enlace), ya que √©stas, est√°n reservadas para los jefes de su clan que est√°n de viaje y volver√°n en unos d√≠as.\nLo primero que haremos sera establecer el rango de IP¬¥s excluidas del conjunto (pool) direcci√≥nes que podr√° asignar el servicio indicando la ip inicial y final del rango, ambas incluidas:\nPonemos un nombre al rango del servicio DHCP:\nDefinimos la red a la que dar√° servicio de DHCP:\nIncluimos la puerta de enlace que ofrecer√° el servicio :\nCon esto ya tendr√≠amos montado el servidor DHCP , con el siguiente comando podemos ver las estad√≠sticas del servicio para ver si este esta funcionando :\nComprobaremos a dem√°s que se ha realizado la concesi√≥n a nuestro host :\nDHCP Hombres lobo Los hombres lobo que son bastante burros metiendo direcci√≥nes IP a sus m√°quinas, te piden que les configures el servicio DHCP para que todas sus m√°quinas reciban autom√°ticamente una IP libre.\nEn el apartado anterior detallo cada apartado de la configuraci√≥n de un servidor DHCP en cisco , aqu√≠ te muestro la configuraci√≥n para la red de los Hombre Lobo :\nComprobaremos que esta funcionando :\nConfiguraci√≥n SNAT Router 1:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nEl SNAT estar√≠a funcionando , as√≠ que vamos a comprobarlo :\nVemos que la regla tiene HITS:\nRouter 2:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nEl SNAT estar√≠a funcionando , as√≠ que vamos a comprobarlo viendo si la regla tiene HITS:\nRouter 3:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nEl SNAT estar√≠a funcionando , as√≠ que vamos a comprobarlo viendo si la regla tiene HITS:\nRouter 4:\nLo primero que haremos sera crear una acl para permitir el trafico que queremos hacer SNAT :\nLe asignaremos a la interfaz interna de nuestra red esta regla :\nAhora crearemos un pool con las ips publicas , el comando seria este no sale completo en la terminal :\nActivamos el NAT :\nIndicamos que interfaz es de ‚Äúdentro‚Äù :\nIndicamos la interfaz de ‚Äúfuera‚Äù:\nEl SNAT estar√≠a funcionando , as√≠ que vamos a comprobarlo viendo si la regla tiene HITS:\nConfiguraci√≥n de DNAT R1\nComprobaci√≥n :\nR2\nComprobaci√≥n :\nR3\nComprobaci√≥n :\nR4\nComprobaci√≥n :\nConfiguraci√≥n cortafuegos Los Vampiros no puedan comunicarse con el resto de especies Para ello vamos a borrar la regla existente que hay en la lista :\nAhora denegaremos el trafico saliente de la red de los vampiros :\nComprobamos que no pueden comunicarse :\nMiramos los hits de las reglas :\nPermitir comunicaci√≥n entre Hombres Lobo y Lic√°ntropos Los HOMBRES LOBO y los LIC√ÅNTROPOS, dado que no son tan repulsivos cuando se cruzan, podr√°n comunicarse entre s√≠. Con el resto de especies no tendr√°n comunicaci√≥n.\nCon estas dos reglas permitimos a cualquier host de nuestra redes locales salir cuando el destino es los hombres lobos o los lic√°ntropos :\nR3-‚Üí 180.0.0.1 R4 ‚Äì\u0026gt; 190.0.0.1 Vemos que nos tira los paquetes que no van desde HL a LC o de LC a HL :\nHUMANOS tampoco podr√°n comunicarse con el resto de especies Con las reglas que tenemos actualmente la comunicaci√≥n con otras especies por parte de los humanos no es posible, podemos ver que en R2 sin ninguna regla adicional no podemos conectarnos ya que nuestros paquetes llegaran a las redes .\nPara que verdaderamente los humanos no puedan comunicarse sin depender de las reglas de los demos reinos , vamos a impedir que estos salgan del reino :\nSi lo comprobamos ahora ellos no podr√°n salir del reino :\nMiramos los hits :\nConfigurar en los cortafuegos las reglas necesarias para que, desde HUMANLAND, IT KNIGHT siga comunic√°ndose con sus dos vampiros favoritas (SONJA Y SELENE). Las ips de estas maquinas son :\nIT KNIGHT (SSH) -‚Äì\u0026gt; 192.168.2.3:22 SONJA (SSH) -‚Äì\u0026gt; 192.168.1.4:22 SELENE (SSH) -‚Äì\u0026gt; 192.168.1.5:2222 Para permitir que los vampiros puedan salir a comunicarse con los humanos :\nPermitimos los mensajes de salida a la publica de los vampiros cuando el puerto sea el 22 y 2222:\nAhora vamos a permitir que los vampiros puedan conectarse a los humanos usando el puerto 22 :\nNo se porque no funciona .. solo va si no coloco ninguna regla incluso permitiendo TODO el trafico ssh tampoco ‚Ä¶ Tambi√©n he permitido todo el ICMP pero nada sigue ocurriendo lo mismo .\nEl nat y el SNAT est√°n funcionando bien pero a la hora de hacer las reglas ssh pasa lo siguiente en la red local al ser mandados de vuelta el router los corta a pesar de que el trafico esta permitido\n","date":"September 8, 2023","hero":"/images/redes/underworld_evolution/portada.jpeg","permalink":"https://www.javiercd.es/posts/redes/underworld_evolution/underworld_evolution/","summary":"\u003cp\u003eEl mundo de UNDERWORLD ha evolucionado mucho en los √∫ltimos meses, as√≠ que debes realizar tareas de administraci√≥n de la red para afrontar la nueva situaci√≥n.\u003c/p\u003e\n\u003cp\u003ePor un lado, se ha descubierto Internet en el Inframundo, de forma que cada uno de los submundos (recuerda: vampiros, lic√°ntropos, hombres lobo y humanos) se conecta a un router que, a su vez, les conecta a uno de los dos grandes routers que forman la Internet de Underworld, llamados Marcus (para humanos y vampiros) y Alexander (para hombres lobo y lic√°ntropos). Marcus y Alexander est√°n conectados entre s√≠.\u003c/p\u003e","tags":["Redes","SNAT","DNAT","Cisco","Linux"],"title":"Underworld evolution"}]