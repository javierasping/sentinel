<!doctype html><html lang=en><head><title>VPN Wireguard remote access</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ddf4c4775d35e5bc3dd64c797b179f99eaf85cf9811e64bd08f8c44a68d0b229.css integrity="sha256-3fTEd1015bw91kx5exefmer4XPmBHmS9CPjESmjQsik="><link rel=icon type=image/png href=/images/site/avatar_hu_f10227dc088ad43a.jpg><meta property="og:title" content="Atlas"><meta property="og:type" content="website"><meta property="og:description" content="Portfolio and personal blog of Francisco Javier Cruces Doval"><meta property="og:image" content="/images/author/john.png"><meta property="og:url" content="https://www.javiercd.es"><meta name=description content="VPN Wireguard remote access"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/en><img src=/images/site/masthead_hu_f10227dc088ad43a.png id=logo alt=Logo>
Atlas</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/en#home>Home</a></li><li class=nav-item><a class=nav-link href=/en#about>About Me</a></li><li class=nav-item><a class=nav-link href=/en#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/en#education>Education</a></li><li class=nav-item><a class=nav-link href=/en#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/en#accomplishments>Certifications</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/en/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/vpn/acceso_remoto_wireguard/acceso_remoto_wireguard><span class="fi fi-es"></span>
Español
</a><a class="dropdown-item nav-link languages-item" href=/en/posts/vpn/acceso_remoto_wireguard/acceso_remoto_wireguard><span class="fi fi-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/en/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/en/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/ci_cd/> CI / CD Jenkins</a><ul><li><a class=list-link href=/en/posts/ci_cd/practica_jenkins/ title="CI / CD practice with Jenkins">CI / CD practice with Jenkins</a></li><li><a class=list-link href=/en/posts/ci_cd/taller1_jenkins/ title="Workshop 1 Ortho-rector of markdown documents (test)">Workshop 1 Ortho-rector of markdown documents (test)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller2_jenkins/ title="Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)">Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller3_jenkins/ title="Workshop 3 Continuous integration of django application (Test)">Workshop 3 Continuous integration of django application (Test)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/base_de_datos/> Database</a><ul><li><a class=list-link href=/en/posts/base_de_datos/instalar_mariadb/ title="Install MariaDB in Debian">Install MariaDB in Debian</a></li><li><a class=list-link href=/en/posts/base_de_datos/interconexion_de_servidores/ title="Interconnection of database servers">Interconnection of database servers</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalacion_oracle_19c_debian12/ title="Oracle 19c installation under Debian 12">Oracle 19c installation under Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalar_postgresql/ title="PostgreSQL installation in Debian 12">PostgreSQL installation in Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/oracle_acceso_remoto/ title="Remote access configuration in Oracle">Remote access configuration in Oracle</a></li><li><a class=list-link href=/en/posts/base_de_datos/acceso_remoto_mariadb/ title="Remote access in MariaDB">Remote access in MariaDB</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/docker/> Docker</a><ul><li><a class=list-link href=/en/posts/docker/instalar_docker_compose/ title="Docker Compose Installation on Ubuntu 24">Docker Compose Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/instalar_docker_ubuntu24/ title="Docker Installation on Ubuntu 24">Docker Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/taller1/ title="Workshop 1 Storage and networks in Docker">Workshop 1 Storage and networks in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller2/ title="Workshop 2 Multicontainer Scenarios in Docker">Workshop 2 Multicontainer Scenarios in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller3/ title="Workshop 3 Image creation Docker">Workshop 3 Image creation Docker</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/cortafuegos/> Firewall</a><ul><li><a class=list-link href=/en/posts/cortafuegos/fortinet_cli/ title="Fortinet CLI">Fortinet CLI</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_uno/ title="Perimetral with Fortinet I">Perimetral with Fortinet I</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_dos/ title="Perimetral with Fortinet II">Perimetral with Fortinet II</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_uno/ title="Perimetral with Nftables I">Perimetral with Nftables I</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_dos/ title="Perimetral with Nftables II">Perimetral with Nftables II</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/drivers/> Linux Drivers</a><ul><li><a class=list-link href=/en/posts/drivers/nvidia_driver/ title="Drivers Nvidia">Drivers Nvidia</a></li><li><a class=list-link href=/en/posts/drivers/nvidia_optimus/ title="How to choose which graph to use on my laptop with Linux">How to choose which graph to use on my laptop with Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/redes/> Networks</a><ul><li><a class=list-link href=/en/posts/redes/android_gns3/ title="Android GNS3-KVM">Android GNS3-KVM</a></li><li><a class=list-link href=/en/posts/redes/escenario_ipv6_basico/ title="Basic IPv6 scenario">Basic IPv6 scenario</a></li><li><a class=list-link href=/en/posts/redes/instalacion_wireshark_gns3/ title="GNS3 and Wireshark installation">GNS3 and Wireshark installation</a></li><li><a class=list-link href=/en/posts/redes/instalar_gns3_debian12/ title="GNS3 installation in Debian 12">GNS3 installation in Debian 12</a></li><li><a class=list-link href=/en/posts/redes/switches_gns3/ title="GNS3 switch configuration">GNS3 switch configuration</a></li><li><a class=list-link href=/en/posts/redes/tuneles_ipv6/ title="IPV6 Tunnels">IPV6 Tunnels</a></li><li><a class=list-link href=/en/posts/redes/configuracion_de_nat/ title="NAT in Cisco and Linux">NAT in Cisco and Linux</a></li><li><a class=list-link href=/en/posts/redes/comandos_de_supervision_de_redes/ title="Network monitoring commands">Network monitoring commands</a></li><li><a class=list-link href=/en/posts/redes/enroutamiento_openstack/ title="OpenStack routing">OpenStack routing</a></li><li><a class=list-link href=/en/posts/redes/arp/ title="Protocol ARP">Protocol ARP</a></li><li><a class=list-link href=/en/posts/redes/underworld/ title=Underworld>Underworld</a></li><li><a class=list-link href=/en/posts/redes/underworld_evolution/ title="Underworld evolution">Underworld evolution</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/> Observability</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/metricas/> Metrics</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/metricas/prometheus/> Prometheus</a><ul><li><a class=list-link href=/en/posts/observabilidad/metricas/prometheus/instalacion_basica_docker_compose/ title="Installation of Prometheus with Docker Compose and Node Exporter on Debian 12">Installation of Prometheus with Docker Compose and Node Exporter on Debian 12</a></li></ul></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/seguridad/> Security</a><ul><li><a class=list-link href=/en/posts/seguridad/forense/ title="Forensic computer">Forensic computer</a></li><li><a class=list-link href=/en/posts/seguridad/https_autofirmado/ title=HTTPS>HTTPS</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/> Services</a><ul><li><a class=list-link href=/en/posts/servicios/apache/ title=Apache>Apache</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dhcp/> DHCP</a><ul><li><a class=list-link href=/en/posts/servicios/dhcp/instalacion_y_configuracion_de_un_servidor_dhcp_en_linux/ title="Installation and Configuration of a DHCP Server on Linux">Installation and Configuration of a DHCP Server on Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/> DNS</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/bind9/> BIND9</a><ul><li><a class=list-link href=/en/posts/servicios/dns/bind9/dns_esclavo/ title="Configuring a Slave DNS Server with BIND9">Configuring a Slave DNS Server with BIND9</a></li><li><a class=list-link href=/en/posts/servicios/dns/bind9/instalacion_basica/ title="Installation and Configuration of BIND9 on Linux">Installation and Configuration of BIND9 on Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/dnsmasq/> DNSMASQ</a><ul><li><a class=list-link href=/en/posts/servicios/dns/dnsmasq/instalacion_basica/ title="Local Server with DNSMasq">Local Server with DNSMasq</a></li></ul></li></ul></li><li><a class=list-link href=/en/posts/servicios/ftp/ title=FTP>FTP</a></li><li><a class=list-link href=/en/posts/servicios/nat_iptables/ title="NAT with iptables">NAT with iptables</a></li><li><a class=list-link href=/en/posts/servicios/ssh/ title=SSH>SSH</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/> Systems</a><ul><li><a class=list-link href=/en/posts/sistemas/ad_ubuntu/ title="Active Directory in Ubuntu">Active Directory in Ubuntu</a></li><li><a class=list-link href=/en/posts/sistemas/recoleccion_logs_journald/ title="Centralized collection of logs journald">Centralized collection of logs journald</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/compilaciones_linux/> Compilations in LINUX</a><ul><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/ title="Compilation of a C-program using a Makefile">Compilation of a C-program using a Makefile</a></li><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/ title="Compilation of a kernel">Compilation of a kernel</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/ title="Creation of an automated installation system">Creation of an automated installation system</a></li><li><a class=list-link href=/en/posts/sistemas/samba_debian/ title="Install and configure samba in Debian">Install and configure samba in Debian</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/comandos_linux/> Linux Command</a><ul><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ title="Kernel parameter modification exercises">Kernel parameter modification exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/comandos_procesos/ title="Linux processes">Linux processes</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ title="Module management exercises">Module management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/gestion_de_paquetes/ title="Package management">Package management</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/empaquetadores_compresores/ title="Packaging and compressors">Packaging and compressors</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ title="Paid management exercises">Paid management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/programacion_tareas/ title="Task programming">Task programming</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/migraciones/> Migration in Linnux</a><ul><li><a class=list-link href=/en/posts/sistemas/migraciones/migracion_sistema_de_ficheros/ title="File system">File system</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/ title="Migtation from CentOS stream 8 to CentOS stream 9">Migtation from CentOS stream 8 to CentOS stream 9</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/eliminacion_systemd/ title="Systemd elimination">Systemd elimination</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/transformacion_instancia_cloud/ title="Transformation instance cloud">Transformation instance cloud</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/nfs_debian/ title="NFS in Debian">NFS in Debian</a></li><li><a class=list-link href=/en/posts/sistemas/activacion_selinux/ title="SELinux activation configuration">SELinux activation configuration</a></li><li><a class=list-link href=/en/posts/sistemas/comparticion_de_directorios_en_windows/ title="Share resources in Windows">Share resources in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/ssh_windows/ title="Ssh service in Windows">Ssh service in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/almacenamiento_servidor_independiente/ title="Storage Spaces in Windows Server">Storage Spaces in Windows Server</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/en/posts/vpn/> VPN</a><ul class=active><li><a class=list-link href=/en/posts/vpn/comparativa_ovpn_wire/ title="OpenVPN and Wireguard Comparative">OpenVPN and Wireguard Comparative</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_openvpn/ title="OpenVPN remote access">OpenVPN remote access</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_strongswang/ title="Remote access Ipsec StrongSwan">Remote access Ipsec StrongSwan</a></li><li><a class=list-link href=/en/posts/vpn/ipsec_cisco/ title="Site-to-Site IPsec Cisco">Site-to-Site IPsec Cisco</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_fortinet/ title="Site-to-Site IPsec Fortinet">Site-to-Site IPsec Fortinet</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_openvpn/ title="Site-to-Site OpenVPN">Site-to-Site OpenVPN</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_wireguard/ title="Site-to-Site Wireguard">Site-to-Site Wireguard</a></li><li><a class="active list-link" href=/en/posts/vpn/acceso_remoto_wireguard/ title="Wireguard remote access">Wireguard remote access</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/iaw/> Web applications</a><ul><li><a class=list-link href=/en/posts/iaw/lamp/ title="LAMP stack installation">LAMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/lemp/ title="LEMP stack installation">LEMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/wordpress/ title="WordPress LAMP">WordPress LAMP</a></li><li><a class=list-link href=/en/posts/iaw/wordpress_lemp/ title="WordPress LEMP">WordPress LEMP</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/vpn/wireguard_acceso_remoto.png)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu_2aff0fda0501496d.png alt="Author Image"><h5 class=author-name>Francisco Javier Cruces Doval</h5><p class=text-muted>Thursday, March 28, 2024 | 9 minutes</p></div><div class=title><h1>VPN Wireguard remote access</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/en/tags/vpn/ class="btn btn-sm btn-info">VPN</a></li><li class=rounded><a href=/en/tags/cisco/ class="btn btn-sm btn-info">CISCO</a></li><li class=rounded><a href=/en/tags/linux/ class="btn btn-sm btn-info">LINUX</a></li><li class=rounded><a href=/en/tags/debian/ class="btn btn-sm btn-info">DEBIAN</a></li><li class=rounded><a href=/en/tags/wireguard/ class="btn btn-sm btn-info">WIREGUARD</a></li></ul></div><div class=post-content id=post-content><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240114150833.png alt></p><p>First I will configure the server machine as a VPN remote access and server server as a VPN client. I will then set up a Windows and Android client.</p><p>The first thing we will do is to install both the Wireguard package in both machines:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@servidor1:~# sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install wireguard
</span></span><span style=display:flex><span>debian@servidor2:~$ sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install wireguard
</span></span></code></pre></div><p>Let&rsquo;s generate the pairs of keys that will be used to encrypt the connection. We will need a key for the server and a couple of additional keys for each client.</p><p>We&rsquo;ll start with the server key pair 1:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ wg genkey | sudo tee /etc/wireguard/server_private.key | wg pubkey | sudo tee /etc/wireguard/server_public.key
</span></span><span style=display:flex><span>2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Puedes visualizar la clave privada posteriormente :</span>
</span></span><span style=display:flex><span>debian@servidor1:~$ sudo cat /etc/wireguard/server_private.key
</span></span><span style=display:flex><span>2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Puedes visualizar la clave publica posteriormente :</span>
</span></span><span style=display:flex><span>debian@servidor1:~$ sudo cat /etc/wireguard/server_public.key
</span></span><span style=display:flex><span>2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>We move to the service2 and generate yours:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#Generamos el par de claves para el cliente de acceso remoto servidor2</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ wg genkey | sudo tee /etc/wireguard/client_private.key | wg pubkey | sudo tee /etc/wireguard/client_public.key
</span></span><span style=display:flex><span>gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Puedes visualizar la clave privada posteriormente :</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ sudo cat /etc/wireguard/client_private.key
</span></span><span style=display:flex><span>8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Puedes visualizar la clave publica posteriormente :</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ sudo cat /etc/wireguard/client_public.key
</span></span><span style=display:flex><span>gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>Once the keys are generated, we will proceed to configure the Wireguard remote access server, in my case I will call the wg0.conf configuration file. I&rsquo;m gonna add you in every parameter of the configuration a comment so you know what you have to put in every field:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Interface<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#IP que tendrá el túnel VPN , en concreto la interfaz wg0 que es como has llamado el fichero de conf</span>
</span></span><span style=display:flex><span>Address <span style=color:#f92672>=</span> 10.99.99.1
</span></span><span style=display:flex><span><span style=color:#75715e>#Clave privada del servidor</span>
</span></span><span style=display:flex><span>PrivateKey <span style=color:#f92672>=</span> 2Gg3EnKD+rdyMPEjMikZTwq2w0m78KrEcUsAJ/8icFA<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Puerto de escucha , 51820 es el puerto por defecto de Wireguard</span>
</span></span><span style=display:flex><span>ListenPort <span style=color:#f92672>=</span> <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Si no tienes activado el bit de forwarding por defecto puedes hacerlo asi :</span>
</span></span><span style=display:flex><span>PreUp <span style=color:#f92672>=</span> sysctl -w net.ipv4.ip_forward<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Este apartado hace referencia a la configuración de los clientes :</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Clave pública del cliente</span>
</span></span><span style=display:flex><span>Publickey <span style=color:#f92672>=</span> gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#IP del túnel VPN del cliente</span>
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 10.99.99.2/32
</span></span><span style=display:flex><span><span style=color:#75715e>#Tiempo de espera que tendrá activo el túnel si no hay trafico</span>
</span></span><span style=display:flex><span>PersistentKeepAlive <span style=color:#f92672>=</span> <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><p>We will now set up a debian client, I have given the same name to the configuration file so the interface will also be called wg0:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor2:~$ sudo cat /etc/wireguard/wg0.conf
</span></span><span style=display:flex><span>  <span style=color:#f92672>[</span>Interface<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    Address <span style=color:#f92672>=</span> 10.99.99.2/24
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Clave privada del cliente</span>
</span></span><span style=display:flex><span>    PrivateKey <span style=color:#f92672>=</span> 8IdsSwunfU5zJQzS5nZg4D//cFEbRa+27HGOQE1V90k<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Puerto de escucha del servidor</span>
</span></span><span style=display:flex><span>    ListenPort <span style=color:#f92672>=</span> <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Clave pública del servidor</span>
</span></span><span style=display:flex><span>    PublicKey <span style=color:#f92672>=</span> 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>    AllowedIPs <span style=color:#f92672>=</span> 0.0.0.0/0
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Punto de acceso del servidor</span>
</span></span><span style=display:flex><span>    Endpoint <span style=color:#f92672>=</span> 90.0.0.2:51820
</span></span><span style=display:flex><span>    <span style=color:#75715e>#Tiempo de espera de la conexión</span>
</span></span><span style=display:flex><span>    PersistentKeepalive <span style=color:#f92672>=</span> <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><p>Once we have configured both files we will lift the tunnel, for this we have several ways to do it, personally the most comfortable I see is using the wg-quick command.</p><p>We raise the tunnel on the server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo wg-quick up wg0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] sysctl -w net.ipv4.ip_forward=1</span>
</span></span><span style=display:flex><span>net.ipv4.ip_forward <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip link add wg0 type wireguard</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] wg setconf wg0 /dev/fd/63</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip -4 address add 10.99.99.1 dev wg0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip link set mtu 1420 up dev wg0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip -4 route add 10.99.99.2/32 dev wg0</span>
</span></span></code></pre></div><p>We raise the other end, in this case our client is servant2:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor2:~$ sudo wg-quick up wg0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip link add wg0 type wireguard</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] wg setconf wg0 /dev/fd/63</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip -4 address add 10.99.99.2/24 dev wg0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip link set mtu 1420 up dev wg0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] wg set wg0 fwmark 51820</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip -4 rule add not fwmark 51820 table 51820</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] ip -4 rule add table main suppress_prefixlength 0</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] sysctl -q net.ipv4.conf.all.src_valid_mark=1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#] iptables-restore -n</span>
</span></span></code></pre></div><p>Once this is done we will check that at both ends we have created a new interface, which is called the same as our configuration file without the .conf extension.</p><p>We check that it was created in servant1:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ ip -4 a
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>65536</span> qdisc noqueue state UNKNOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc fq_codel state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    altname enp0s3
</span></span><span style=display:flex><span>    inet 90.0.0.2/24 brd 90.0.0.255 scope global ens3
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc fq_codel state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    altname enp0s4
</span></span><span style=display:flex><span>    inet 192.168.0.1/24 brd 192.168.0.255 scope global ens4
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>6: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1420</span> qdisc noqueue state UNKNOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    inet 10.99.99.1/32 scope global wg0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>We check that it was created in servers2:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor2:~$ ip -4 a
</span></span><span style=display:flex><span>1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>65536</span> qdisc noqueue state UNKNOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    inet 127.0.0.1/8 scope host lo
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc fq_codel state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    altname enp0s3
</span></span><span style=display:flex><span>    inet 100.0.0.2/24 brd 100.0.0.255 scope global ens3
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1500</span> qdisc fq_codel state UP group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    altname enp0s4
</span></span><span style=display:flex><span>    inet 192.168.1.1/24 brd 192.168.1.255 scope global ens4
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span><span style=display:flex><span>6: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu <span style=color:#ae81ff>1420</span> qdisc noqueue state UNKNOWN group default qlen <span style=color:#ae81ff>1000</span>
</span></span><span style=display:flex><span>    inet 10.99.99.2/24 scope global wg0
</span></span><span style=display:flex><span>       valid_lft forever preferred_lft forever
</span></span></code></pre></div><p>We will also check the routes that have been created on the server and on the client:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ ip r
</span></span><span style=display:flex><span>default via 90.0.0.1 dev ens3 onlink 
</span></span><span style=display:flex><span>10.99.99.2 dev wg0 scope link 
</span></span><span style=display:flex><span>10.99.99.4 dev wg0 scope link 
</span></span><span style=display:flex><span>90.0.0.0/24 dev ens3 proto kernel scope link src 90.0.0.2 
</span></span><span style=display:flex><span>192.168.0.0/24 dev ens4 proto kernel scope link src 192.168.0.1 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@servidor2:~$ ip r
</span></span><span style=display:flex><span>default via 100.0.0.1 dev ens3 onlink 
</span></span><span style=display:flex><span>10.99.99.0/24 dev wg0 proto kernel scope link src 10.99.99.2 
</span></span><span style=display:flex><span>100.0.0.0/24 dev ens3 proto kernel scope link src 100.0.0.2 
</span></span><span style=display:flex><span>192.168.1.0/24 dev ens4 proto kernel scope link src 192.168.1.1 
</span></span></code></pre></div><p>Let&rsquo;s check that from our client (server 2) we have access to the different machines of our network:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>##Ping con el túnel del extremo servidor1</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ ping 10.99.99.1 -c <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>PING 10.99.99.1 <span style=color:#f92672>(</span>10.99.99.1<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 10.99.99.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>14.9 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- 10.99.99.1 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> packets transmitted, <span style=color:#ae81ff>1</span> received, 0% packet loss, time 0ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#f92672>=</span> 14.862/14.862/14.862/0.000 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##Pings con cliente1 :</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ ping 192.168.0.2 -c <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>PING 192.168.0.2 <span style=color:#f92672>(</span>192.168.0.2<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 192.168.0.2: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> time<span style=color:#f92672>=</span>17.5 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- 192.168.0.2 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> packets transmitted, <span style=color:#ae81ff>1</span> received, 0% packet loss, time 0ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#f92672>=</span> 17.503/17.503/17.503/0.000 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Ping con cliente2</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ ping 192.168.0.3 -c <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>PING 192.168.0.3 <span style=color:#f92672>(</span>192.168.0.3<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 192.168.0.3: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>63</span> time<span style=color:#f92672>=</span>16.5 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- 192.168.0.3 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> packets transmitted, <span style=color:#ae81ff>1</span> received, 0% packet loss, time 0ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#f92672>=</span> 16.522/16.522/16.522/0.000 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>##Ping con la ip privada del servidor1</span>
</span></span><span style=display:flex><span>debian@servidor2:~$ ping 192.168.0.1 -c <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>PING 192.168.0.1 <span style=color:#f92672>(</span>192.168.0.1<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 192.168.0.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>20.3 ms
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>--- 192.168.0.1 ping statistics ---
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> packets transmitted, <span style=color:#ae81ff>1</span> received, 0% packet loss, time 0ms
</span></span><span style=display:flex><span>rtt min/avg/max/mdev <span style=color:#f92672>=</span> 20.272/20.272/20.272/0.000 ms
</span></span></code></pre></div><p>Although my stage is set, the private IP addresses are not erased we will check that the traffic goes through the tunnel, making use of traceroute:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor2:~$ traceroute 192.168.0.2
</span></span><span style=display:flex><span>traceroute to 192.168.0.2 <span style=color:#f92672>(</span>192.168.0.2<span style=color:#f92672>)</span>, <span style=color:#ae81ff>30</span> hops max, <span style=color:#ae81ff>60</span> byte packets
</span></span><span style=display:flex><span> <span style=color:#ae81ff>1</span>  10.99.99.1 <span style=color:#f92672>(</span>10.99.99.1<span style=color:#f92672>)</span>  18.692 ms  28.987 ms  28.951 ms
</span></span><span style=display:flex><span> <span style=color:#ae81ff>2</span>  192.168.0.2 <span style=color:#f92672>(</span>192.168.0.2<span style=color:#f92672>)</span>  28.912 ms  28.877 ms  28.859 ms
</span></span></code></pre></div><h3 id=android-client-configuration>android client configuration</h3><p>The virtual android machine is quite uncomfortable to control, so I&rsquo;m going to generate the keys and your configuration file on the server. Then we&rsquo;ll get him out of this with Apache.</p><p>We generate the keys to android:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ wg genkey | tee androidprivate | wg pubkey &gt; androidpublic
</span></span><span style=display:flex><span>debian@servidor1:~$ cat androidprivate 
</span></span><span style=display:flex><span>CBY5o2iko7xXQrNAFcFDIKohOngawB1uvws7aDDgl0g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>debian@servidor1:~$ cat androidpublic 
</span></span><span style=display:flex><span>cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>The configuration file would be as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo cat android.conf 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Interface<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Address <span style=color:#f92672>=</span> 10.99.99.4
</span></span><span style=display:flex><span>PrivateKey <span style=color:#f92672>=</span> CBY5o2iko7xXQrNAFcFDIKohOngawB1uvws7aDDgl0g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>ListenPort <span style=color:#f92672>=</span> <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Publickey <span style=color:#f92672>=</span> 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 0.0.0.0/0
</span></span><span style=display:flex><span>Endpoint <span style=color:#f92672>=</span> 90.0.0.2:51820
</span></span></code></pre></div><p>I have installed apache and will copy this file to the document root to get it to the android machine. I use this medium as it is a fictional scenario.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo cp android.conf /var/www/html/
</span></span></code></pre></div><p>From a terminal, as the browser does not work too well we download the file:
<img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127122826.png alt></p><p>Now let&rsquo;s add this new client to the server configuration file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo cat /etc/wireguard/wg0.conf
</span></span><span style=display:flex><span><span style=color:#75715e>#Al final del todo :)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Publickey <span style=color:#f92672>=</span> cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 10.99.99.4/32
</span></span><span style=display:flex><span>PersistentKeepAlive <span style=color:#f92672>=</span> <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><p>Don&rsquo;t forget to restart the tunnel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo wg-quick down wg0
</span></span><span style=display:flex><span>debian@servidor1:~$ sudo wg-quick up wg0
</span></span></code></pre></div><p>Now open the wireguard application and give it import from file and activate the connection. Activate the tunnel and make sure the handshake occurs:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127123150.png alt></p><p>If we open a terminal we can pings the customers:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127123551.png alt></p><p>Windows client configuration</p><p>We&rsquo;re going to repeat the process but now with our Windows client.</p><p>In order to copy and paste, I will make the key generation of this client in the service machine.</p><p>We&rsquo;ll start by generating the key pair.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ wg genkey | tee winprivate | wg pubkey &gt; winpublic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@servidor1:~$ cat winprivate 
</span></span><span style=display:flex><span>QKGQEdrB9FBYRZsLNgc3qr9m8/lx+uc9n5vvj67I9m8<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@servidor1:~$ cat winpublic 
</span></span><span style=display:flex><span>E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo<span style=color:#f92672>=</span>
</span></span></code></pre></div><p>We create the configuration file for this client:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ cat win.conf 
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Interface<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Address <span style=color:#f92672>=</span> 10.99.99.5
</span></span><span style=display:flex><span>PrivateKey <span style=color:#f92672>=</span> QKGQEdrB9FBYRZsLNgc3qr9m8/lx+uc9n5vvj67I9m8<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>ListenPort <span style=color:#f92672>=</span> <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Publickey <span style=color:#f92672>=</span> 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 0.0.0.0/0
</span></span><span style=display:flex><span>Endpoint <span style=color:#f92672>=</span> 90.0.0.2:51820
</span></span></code></pre></div><p>I&rsquo;ll move it to the document root so I can download it on my Windows, don&rsquo;t do this in a real environment.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo cp win.conf /var/www/html/
</span></span></code></pre></div><p>Remember to set up this new customer in the service machine:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo nano /etc/wireguard/wg0.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Publickey <span style=color:#f92672>=</span> E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 10.99.99.5/32
</span></span><span style=display:flex><span>PersistentKeepAlive <span style=color:#f92672>=</span> <span style=color:#ae81ff>25</span>
</span></span></code></pre></div><p>For the changes to be applied, restart the tunnel:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo wg-quick down wg0
</span></span><span style=display:flex><span>debian@servidor1:~$ sudo wg-quick up wg0
</span></span></code></pre></div><p>Once we have all set up, access the Windows machine and download the configuration file:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127124840.png alt></p><p>Open the wireguard application and select to import from file:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127124507.png alt></p><p>Once the tunnel is activated and the handshake has been checked:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127125205.png alt></p><p>If we return to our Windows, we will have created a new interface:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127125336.png alt></p><p>And we&rsquo;ll have connectivity to the network machines 192.168.0.0 / 24:</p><p><img src=/vpn/acceso_remoto_wireguard/img/Pastedimage20240127125609.png alt></p><p>By way of curiosity we can see on the server that customers are connected:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@servidor1:~$ sudo wg show
</span></span><span style=display:flex><span>interface: wg0
</span></span><span style=display:flex><span>  public key: 2/RjGUbiQuaFR7atYaQ8lcczz2wXxO9aIwfzZEMPXCQ<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  private key: <span style=color:#f92672>(</span>hidden<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  listening port: <span style=color:#ae81ff>51820</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>peer: cBGl5QWOsbZyI2GN1MXDxUsfeMmI5sKnp3VkxW9lO3g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  endpoint: 100.0.0.2:51820
</span></span><span style=display:flex><span>  allowed ips: 10.99.99.4/32
</span></span><span style=display:flex><span>  latest handshake: <span style=color:#ae81ff>1</span> minute, <span style=color:#ae81ff>14</span> seconds ago
</span></span><span style=display:flex><span>  transfer: 6.43 KiB received, <span style=color:#ae81ff>788</span> B sent
</span></span><span style=display:flex><span>  persistent keepalive: every <span style=color:#ae81ff>25</span> seconds
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>peer: E8VdupsWJ7vCTO7SF3oXUciUrsRgJ3p6T+F5UbbLngo<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  endpoint: 100.0.0.2:49981
</span></span><span style=display:flex><span>  allowed ips: 10.99.99.5/32
</span></span><span style=display:flex><span>  latest handshake: <span style=color:#ae81ff>1</span> minute, <span style=color:#ae81ff>32</span> seconds ago
</span></span><span style=display:flex><span>  transfer: 46.23 KiB received, 1.64 KiB sent
</span></span><span style=display:flex><span>  persistent keepalive: every <span style=color:#ae81ff>25</span> seconds
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>peer: gS2ED2zfzMHBttMpFhH3MvRpr8D4ALEDTumNcib8A2g<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  allowed ips: 10.99.99.2/32
</span></span><span style=display:flex><span>  persistent keepalive: every <span style=color:#ae81ff>25</span> seconds
</span></span></code></pre></div></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvpn%2facceso_remoto_wireguard%2facceso_remoto_wireguard%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvpn%2facceso_remoto_wireguard%2facceso_remoto_wireguard%2f&text=VPN%20Wireguard%20remote%20access&via=Atlas" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvpn%2facceso_remoto_wireguard%2facceso_remoto_wireguard%2f&title=VPN%20Wireguard%20remote%20access" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvpn%2facceso_remoto_wireguard%2facceso_remoto_wireguard%2f&title=VPN%20Wireguard%20remote%20access" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=VPN%20Wireguard%20remote%20access https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvpn%2facceso_remoto_wireguard%2facceso_remoto_wireguard%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=VPN%20Wireguard%20remote%20access&body=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvpn%2facceso_remoto_wireguard%2facceso_remoto_wireguard%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/javierasping/sentinel/edit/main/content/posts/vpn/acceso_remoto_wireguard/acceso_remoto_wireguard.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#android-client-configuration>android client configuration</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#about>About Me</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#accomplishments>Certifications</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contacto@javiercd.es target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contacto@javiercd.es</span></a></li><li><a href=https://github.com/javierasping target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>javierasping</span></a></li><li><a href=https://www.linkedin.com/in/javiercd target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Francisco Javier Cruces Doval</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2023 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.29119cfdb8d2f06f4caaea7b9908096b5c109c5174eab5fca7e4e0efb0ffcaa0.js integrity="sha256-KRGc/bjS8G9Mqup7mQgJa1wQnFF06rX8p+Tg77D/yqA=" defer></script></body></html>