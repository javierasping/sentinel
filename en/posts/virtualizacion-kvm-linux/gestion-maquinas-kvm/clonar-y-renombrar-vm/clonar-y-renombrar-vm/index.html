<!doctype html><html lang=en><head><title>Clone and rename virtual machines in KVM</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ddf4c4775d35e5bc3dd64c797b179f99eaf85cf9811e64bd08f8c44a68d0b229.css integrity="sha256-3fTEd1015bw91kx5exefmer4XPmBHmS9CPjESmjQsik="><link rel=icon type=image/png href=/images/site/avatar_hu_f10227dc088ad43a.jpg><meta property="og:title" content="Atlas"><meta property="og:type" content="website"><meta property="og:description" content="Portfolio and personal blog of Francisco Javier Cruces Doval"><meta property="og:image" content="/images/author/john.png"><meta property="og:url" content="https://www.javiercd.es"><meta name=description content="Learn how to clone and rename virtual machines in KVM using virt-clone, virt-sysprep, and virt-customize to create reusable templates."><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/en><img src=/images/site/masthead_hu_f10227dc088ad43a.png id=logo alt=Logo>
Atlas</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/en#home>Home</a></li><li class=nav-item><a class=nav-link href=/en#about>About Me</a></li><li class=nav-item><a class=nav-link href=/en#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/en#education>Education</a></li><li class=nav-item><a class=nav-link href=/en#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/en#accomplishments>Certifications</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/en/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/clonar-y-renombrar-vm><span class="fi fi-es"></span>
Espa√±ol
</a><a class="dropdown-item nav-link languages-item" href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/clonar-y-renombrar-vm><span class="fi fi-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/en/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/en/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/ci_cd/> CI / CD Jenkins</a><ul><li><a class=list-link href=/en/posts/ci_cd/practica_jenkins/ title="CI / CD practice with Jenkins">CI / CD practice with Jenkins</a></li><li><a class=list-link href=/en/posts/ci_cd/taller1_jenkins/ title="Workshop 1 Ortho-rector of markdown documents (test)">Workshop 1 Ortho-rector of markdown documents (test)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller2_jenkins/ title="Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)">Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller3_jenkins/ title="Workshop 3 Continuous integration of django application (Test)">Workshop 3 Continuous integration of django application (Test)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/base_de_datos/> Database</a><ul><li><a class=list-link href=/en/posts/base_de_datos/instalar_mariadb/ title="Install MariaDB in Debian">Install MariaDB in Debian</a></li><li><a class=list-link href=/en/posts/base_de_datos/interconexion_de_servidores/ title="Interconnection of database servers">Interconnection of database servers</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalacion_oracle_19c_debian12/ title="Oracle 19c installation under Debian 12">Oracle 19c installation under Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalar_postgresql/ title="PostgreSQL installation in Debian 12">PostgreSQL installation in Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/oracle_acceso_remoto/ title="Remote access configuration in Oracle">Remote access configuration in Oracle</a></li><li><a class=list-link href=/en/posts/base_de_datos/acceso_remoto_mariadb/ title="Remote access in MariaDB">Remote access in MariaDB</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/docker/> Docker</a><ul><li><a class=list-link href=/en/posts/docker/instalar_docker_compose/ title="Docker Compose Installation on Ubuntu 24">Docker Compose Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/instalar_docker_ubuntu24/ title="Docker Installation on Ubuntu 24">Docker Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/taller1/ title="Workshop 1 Storage and networks in Docker">Workshop 1 Storage and networks in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller2/ title="Workshop 2 Multicontainer Scenarios in Docker">Workshop 2 Multicontainer Scenarios in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller3/ title="Workshop 3 Image creation Docker">Workshop 3 Image creation Docker</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/cortafuegos/> Firewall</a><ul><li><a class=list-link href=/en/posts/cortafuegos/fortinet_cli/ title="Fortinet CLI">Fortinet CLI</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_uno/ title="Perimetral with Fortinet I">Perimetral with Fortinet I</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_dos/ title="Perimetral with Fortinet II">Perimetral with Fortinet II</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_uno/ title="Perimetral with Nftables I">Perimetral with Nftables I</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_dos/ title="Perimetral with Nftables II">Perimetral with Nftables II</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/drivers/> Linux Drivers</a><ul><li><a class=list-link href=/en/posts/drivers/nvidia_driver/ title="Drivers Nvidia">Drivers Nvidia</a></li><li><a class=list-link href=/en/posts/drivers/nvidia_optimus/ title="How to choose which graph to use on my laptop with Linux">How to choose which graph to use on my laptop with Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/redes/> Networks</a><ul><li><a class=list-link href=/en/posts/redes/android_gns3/ title="Android GNS3-KVM">Android GNS3-KVM</a></li><li><a class=list-link href=/en/posts/redes/escenario_ipv6_basico/ title="Basic IPv6 scenario">Basic IPv6 scenario</a></li><li><a class=list-link href=/en/posts/redes/instalacion_wireshark_gns3/ title="GNS3 and Wireshark installation">GNS3 and Wireshark installation</a></li><li><a class=list-link href=/en/posts/redes/instalar_gns3_debian12/ title="GNS3 installation in Debian 12">GNS3 installation in Debian 12</a></li><li><a class=list-link href=/en/posts/redes/switches_gns3/ title="GNS3 switch configuration">GNS3 switch configuration</a></li><li><a class=list-link href=/en/posts/redes/tuneles_ipv6/ title="IPV6 Tunnels">IPV6 Tunnels</a></li><li><a class=list-link href=/en/posts/redes/configuracion_de_nat/ title="NAT in Cisco and Linux">NAT in Cisco and Linux</a></li><li><a class=list-link href=/en/posts/redes/comandos_de_supervision_de_redes/ title="Network monitoring commands">Network monitoring commands</a></li><li><a class=list-link href=/en/posts/redes/enroutamiento_openstack/ title="OpenStack routing">OpenStack routing</a></li><li><a class=list-link href=/en/posts/redes/arp/ title="Protocol ARP">Protocol ARP</a></li><li><a class=list-link href=/en/posts/redes/underworld/ title=Underworld>Underworld</a></li><li><a class=list-link href=/en/posts/redes/underworld_evolution/ title="Underworld evolution">Underworld evolution</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/> Observability</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/metricas/> Metrics</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/metricas/prometheus/> Prometheus</a><ul><li><a class=list-link href=/en/posts/observabilidad/metricas/prometheus/instalacion_basica_docker_compose/ title="Installation of Prometheus with Docker Compose and Node Exporter on Debian 12">Installation of Prometheus with Docker Compose and Node Exporter on Debian 12</a></li></ul></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/seguridad/> Security</a><ul><li><a class=list-link href=/en/posts/seguridad/forense/ title="Forensic computer">Forensic computer</a></li><li><a class=list-link href=/en/posts/seguridad/https_autofirmado/ title=HTTPS>HTTPS</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/> Services</a><ul><li><a class=list-link href=/en/posts/servicios/apache/ title=Apache>Apache</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dhcp/> DHCP</a><ul><li><a class=list-link href=/en/posts/servicios/dhcp/instalacion_y_configuracion_de_un_servidor_dhcp_en_linux/ title="Installation and Configuration of a DHCP Server on Linux">Installation and Configuration of a DHCP Server on Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/> DNS</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/bind9/> BIND9</a><ul><li><a class=list-link href=/en/posts/servicios/dns/bind9/dns_esclavo/ title="Configuring a Slave DNS Server with BIND9">Configuring a Slave DNS Server with BIND9</a></li><li><a class=list-link href=/en/posts/servicios/dns/bind9/instalacion_basica/ title="Installation and Configuration of BIND9 on Linux">Installation and Configuration of BIND9 on Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/dnsmasq/> DNSMASQ</a><ul><li><a class=list-link href=/en/posts/servicios/dns/dnsmasq/instalacion_basica/ title="Local Server with DNSMasq">Local Server with DNSMasq</a></li></ul></li></ul></li><li><a class=list-link href=/en/posts/servicios/ftp/ title=FTP>FTP</a></li><li><a class=list-link href=/en/posts/servicios/nat_iptables/ title="NAT with iptables">NAT with iptables</a></li><li><a class=list-link href=/en/posts/servicios/ssh/ title=SSH>SSH</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/> Systems</a><ul><li><a class=list-link href=/en/posts/sistemas/ad_ubuntu/ title="Active Directory in Ubuntu">Active Directory in Ubuntu</a></li><li><a class=list-link href=/en/posts/sistemas/recoleccion_logs_journald/ title="Centralized collection of logs journald">Centralized collection of logs journald</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/compilaciones_linux/> Compilations in LINUX</a><ul><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/ title="Compilation of a C-program using a Makefile">Compilation of a C-program using a Makefile</a></li><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/ title="Compilation of a kernel">Compilation of a kernel</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/ title="Creation of an automated installation system">Creation of an automated installation system</a></li><li><a class=list-link href=/en/posts/sistemas/samba_debian/ title="Install and configure samba in Debian">Install and configure samba in Debian</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/comandos_linux/> Linux Command</a><ul><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ title="Kernel parameter modification exercises">Kernel parameter modification exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/comandos_procesos/ title="Linux processes">Linux processes</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ title="Module management exercises">Module management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/gestion_de_paquetes/ title="Package management">Package management</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/empaquetadores_compresores/ title="Packaging and compressors">Packaging and compressors</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ title="Paid management exercises">Paid management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/programacion_tareas/ title="Task programming">Task programming</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/migraciones/> Migration in Linnux</a><ul><li><a class=list-link href=/en/posts/sistemas/migraciones/migracion_sistema_de_ficheros/ title="File system">File system</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/ title="Migtation from CentOS stream 8 to CentOS stream 9">Migtation from CentOS stream 8 to CentOS stream 9</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/eliminacion_systemd/ title="Systemd elimination">Systemd elimination</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/transformacion_instancia_cloud/ title="Transformation instance cloud">Transformation instance cloud</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/nfs_debian/ title="NFS in Debian">NFS in Debian</a></li><li><a class=list-link href=/en/posts/sistemas/activacion_selinux/ title="SELinux activation configuration">SELinux activation configuration</a></li><li><a class=list-link href=/en/posts/sistemas/comparticion_de_directorios_en_windows/ title="Share resources in Windows">Share resources in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/ssh_windows/ title="Ssh service in Windows">Ssh service in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/almacenamiento_servidor_independiente/ title="Storage Spaces in Windows Server">Storage Spaces in Windows Server</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/en/posts/virtualizacion-kvm-linux/> Virtualization (KVM on Linux)</a><ul class=active><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/virtualizacion-kvm-linux/introduccion-kvm/> Introduction to virtualization with KVM</a><ul><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/introduccion-kvm/conceptos-virtualizacion/ title="Virtualization basics in Linux">Virtualization basics in Linux</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/introduccion-kvm/tipo-hipervisores/ title="Types of hypervisors">Types of hypervisors</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/introduccion-kvm/arquitectura-kvm/ title="KVM architecture and operation">KVM architecture and operation</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/virtualizacion-kvm-linux/instalacion-kvm/> Installation and configuration</a><ul><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/instalacion-kvm/instalar-kvm-libvirt/ title="Install KVM and libvirt">Install KVM and libvirt</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/instalacion-kvm/validar-host-kvm/ title="Validate KVM host">Validate KVM host</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/> Virtual machine management</a><ul class=active><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/crear-vm-virtinstall/ title="Create VM with virt-install">Create VM with virt-install</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/componentes-vm/ title="VM components">VM components</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/administrar-virsh/ title="Manage with virsh">Manage with virsh</a></li><li><a class="active list-link" href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/ title="Clone and rename VMs">Clone and rename VMs</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/ampliar-recursos-vm/ title="Expand VM resources">Expand VM resources</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/snapshots-kvm/ title="Snapshots in KVM">Snapshots in KVM</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/plantilla-debian13/ title="Virtual machine templates">Virtual machine templates</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/virtualizacion-kvm-linux/redes-kvm/> Networking in KVM</a><ul><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/redes-kvm/tipos-redes-kvm/ title="Network types in KVM">Network types in KVM</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/redes-kvm/crear-redes-virtuales-privadas-kvm/ title="Create and configure private virtual networks">Create and configure private virtual networks</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/redes-kvm/crear-interfaz-puente/ title="Create bridge interface">Create bridge interface</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/virtualizacion-kvm-linux/almacenamiento-kvm/> Storage in KVM</a><ul><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/almacenamiento-kvm/introduccion-almacenamiento-kvm/ title="Introduction to storage">Introduction to storage</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/almacenamiento-kvm/gestion-pools-almacenamiento/ title="Managing pools">Managing pools</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/almacenamiento-kvm/gestion-volumenes-virsh/ title="Volumes (virsh)">Volumes (virsh)</a></li><li><a class=list-link href=/en/posts/virtualizacion-kvm-linux/almacenamiento-kvm/redimension-discos-vms/ title="Resizing disks (VMs)">Resizing disks (VMs)</a></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/vpn/> VPN</a><ul><li><a class=list-link href=/en/posts/vpn/comparativa_ovpn_wire/ title="OpenVPN and Wireguard Comparative">OpenVPN and Wireguard Comparative</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_openvpn/ title="OpenVPN remote access">OpenVPN remote access</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_strongswang/ title="Remote access Ipsec StrongSwan">Remote access Ipsec StrongSwan</a></li><li><a class=list-link href=/en/posts/vpn/ipsec_cisco/ title="Site-to-Site IPsec Cisco">Site-to-Site IPsec Cisco</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_fortinet/ title="Site-to-Site IPsec Fortinet">Site-to-Site IPsec Fortinet</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_openvpn/ title="Site-to-Site OpenVPN">Site-to-Site OpenVPN</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_wireguard/ title="Site-to-Site Wireguard">Site-to-Site Wireguard</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_wireguard/ title="Wireguard remote access">Wireguard remote access</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/iaw/> Web applications</a><ul><li><a class=list-link href=/en/posts/iaw/lamp/ title="LAMP stack installation">LAMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/lemp/ title="LEMP stack installation">LEMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/wordpress/ title="WordPress LAMP">WordPress LAMP</a></li><li><a class=list-link href=/en/posts/iaw/wordpress_lemp/ title="WordPress LEMP">WordPress LEMP</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/virtualizacion-kvm-linux/gestion-vm/hacer-clones.png)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu_2aff0fda0501496d.png alt="Author Image"><h5 class=author-name>Francisco Javier Cruces Doval</h5><p class=text-muted>Thursday, October 16, 2025 | 7 minutes</p></div><div class=title><h1>Clone and rename virtual machines in KVM</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/en/tags/kvm/ class="btn btn-sm btn-info">KVM</a></li><li class=rounded><a href=/en/tags/virtualization/ class="btn btn-sm btn-info">Virtualization</a></li><li class=rounded><a href=/en/tags/libvirt/ class="btn btn-sm btn-info">Libvirt</a></li><li class=rounded><a href=/en/tags/linux/ class="btn btn-sm btn-info">Linux</a></li><li class=rounded><a href=/en/tags/vm/ class="btn btn-sm btn-info">VM</a></li><li class=rounded><a href=/en/tags/cloning/ class="btn btn-sm btn-info">Cloning</a></li></ul></div><div class=post-content id=post-content><p>One of the advantages of virtualization is the ability to clone virtual machines to quickly create homogeneous environments. However, when we clone a VM that contains an operating system, the clone inherits unique identifiers such as the <strong>machine ID</strong>, <strong>MAC</strong> addresses, host <strong>SSH</strong> keys, etc., which should be unique for each machine.</p><p>In this guide we will cover how to:</p><ul><li>Clone virtual machines with <code>virt-clone</code></li><li>Generalize clones with <code>virt-sysprep</code></li><li>Customize new instances with <code>virt-customize</code></li><li>Rename virtual machines with <code>virsh domrename</code></li><li>Troubleshoot common issues after cloning</li></ul><hr><h2 id=prerequisites>Prerequisites</h2><p>Make sure the following packages are installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Debian/Ubuntu</span>
</span></span><span style=display:flex><span>sudo apt install libguestfs-tools virtinst
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># RHEL/Fedora/AlmaLinux</span>
</span></span><span style=display:flex><span>sudo dnf install libguestfs-tools virt-install
</span></span></code></pre></div><p><strong>Key packages:</strong></p><ul><li><code>virt-clone</code>: Tool for cloning virtual machines (included in <code>virtinst</code>)</li><li><code>virt-sysprep</code>: Tool for generalizing VMs (included in <code>libguestfs-tools</code>)</li><li><code>virt-customize</code>: Tool for customizing VMs without booting them (included in <code>libguestfs-tools</code>)</li></ul><hr><h2 id=1-prepare-the-base-virtual-machine>1. Prepare the base virtual machine</h2><p>Before cloning, it‚Äôs advisable to prepare a <strong>reference machine</strong> with all the baseline configuration you need (installed packages, users, basic network configuration, etc.).</p><p>In our example, we‚Äôll use a VM called <code>debian13</code> as the base machine.</p><h3 id=shut-down-the-virtual-machine>Shut down the virtual machine</h3><p>Before cloning, we must shut it down:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh shutdown debian13
</span></span></code></pre></div><p>Verify that it is completely powered off:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code> Id   Name              State
----------------------------------
 -    debian13          shut off
</code></pre><hr><h2 id=2-clone-the-virtual-machine-with-virt-clone>2. Clone the virtual machine with virt-clone</h2><p><code>virt-clone</code> creates a full copy of a virtual machine, including its XML configuration and virtual disks.</p><h3 id=option-1-automatic-cloning-auto-generated-disk-name>Option 1: Automatic cloning (auto-generated disk name)</h3><p>You can use <code>--auto-clone</code> so that <code>virt-clone</code> automatically generates the disk name by adding the <code>-clone</code> suffix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian13 --name debian13-clone --auto-clone
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>Allocating &#39;debian13-clone.qcow2&#39;    | 20 GB  00:00:05

Clone &#39;debian13-clone&#39; created successfully.
</code></pre><h3 id=option-2-specify-a-custom-disk-name>Option 2: Specify a custom disk name</h3><p>For more control over the disk name, use the <code>--file</code> parameter:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian13 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template.qcow2
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>Allocating &#39;debian-template.qcow2&#39;   | 20 GB  00:00:05

Clone &#39;debian-template&#39; created successfully.
</code></pre><h3 id=clone-multiple-disks>Clone multiple disks</h3><p>If your VM has multiple disks, you can specify multiple <code>--file</code> parameters:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian13 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template-disk1.qcow2 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template-disk2.qcow2
</span></span></code></pre></div><hr><h2 id=3-rename-virtual-machines-with-virsh-domrename>3. Rename virtual machines with virsh domrename</h2><p>You can change a VM‚Äôs name easily with <code>virsh domrename</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh domrename debian13-clone debian-base-image
</span></span></code></pre></div><p>Expected output:</p><pre tabindex=0><code>Domain successfully renamed
</code></pre><p>Verify the change:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><p>Output:</p><pre tabindex=0><code> Id   Name                State
-----------------------------------
 -    debian13            shut off
 -    debian-base-image   shut off
 -    debian-template     shut off
</code></pre><blockquote><p><strong>Note:</strong> The <code>virsh domrename</code> command only changes the VM name in libvirt; it does <strong>not</strong> rename the disk file. If you also want to rename the disk, do it manually and then edit the XML configuration with <code>virsh edit</code>.</p></blockquote><hr><h2 id=4-generalize-the-vm-with-virt-sysprep>4. Generalize the VM with virt-sysprep</h2><p><code>virt-sysprep</code> removes machine-specific configurations to turn it into a <strong>reusable template</strong>. This tool is inspired by Microsoft Windows‚Äô <code>sysprep</code> utility.</p><h3 id=what-does-virt-sysprep-do>What does virt-sysprep do?</h3><p><code>virt-sysprep</code> performs multiple cleanup operations automatically:</p><ul><li>Removes the <strong>machine-id</strong> and it will be regenerated on next boot</li><li>Deletes <strong>host SSH keys</strong> (they can be regenerated automatically or manually)</li><li>Clears the <strong>command history</strong> (bash_history)</li><li>Removes fixed <strong>MAC addresses</strong></li><li>Deletes <strong>system logs</strong></li><li>Cleans the <strong>package cache</strong></li><li>Deletes <strong>temporary files</strong></li><li>And much more&mldr;</li></ul><h3 id=basic-usage-of-virt-sysprep>Basic usage of virt-sysprep</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template
</span></span></code></pre></div><p>Output (excerpt):</p><pre tabindex=0><code>[   0.0] Examining the guest ...
[   5.2] Performing &#34;abrt-data&#34; ...
[   5.2] Performing &#34;backup-files&#34; ...
[   5.3] Performing &#34;bash-history&#34; ...
[   5.3] Performing &#34;machine-id&#34; ...
[   5.3] Performing &#34;net-hwaddr&#34; ...
[   5.3] Performing &#34;ssh-hostkeys&#34; ...
[   5.4] Performing &#34;tmp-files&#34; ...
[   5.4] Performing &#34;utmp&#34; ...
[   5.5] Setting a random seed
[   5.5] Setting the machine ID in /etc/machine-id
</code></pre><h3 id=virt-sysprep-with-additional-options>virt-sysprep with additional options</h3><p>You can set the <strong>hostname</strong> and the <strong>root password</strong> during generalization:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--root-password password:MySecurePassword123!
</span></span></code></pre></div><h3 id=useful-virt-sysprep-options>Useful virt-sysprep options</h3><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code>--hostname NAME</code></td><td>Sets the host name</td></tr><tr><td><code>--root-password password:PASS</code></td><td>Sets the root password</td></tr><tr><td><code>--firstboot SCRIPT</code></td><td>Runs a script on first boot</td></tr><tr><td><code>--operations LIST</code></td><td>Specifies which operations to perform (all by default)</td></tr><tr><td><code>--enable OPERATIONS</code></td><td>Enables specific operations</td></tr><tr><td><code>--disable OPERATIONS</code></td><td>Disables specific operations</td></tr></tbody></table><p>Example disabling SSH host key removal:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template --operations all,-ssh-hostkeys
</span></span></code></pre></div><hr><h2 id=5-create-new-vms-from-the-template>5. Create new VMs from the template</h2><p>Once you have a generalized <strong>machine image</strong>, you can quickly create multiple instances:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-debian-01.qcow2
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-debian-02 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-debian-02.qcow2
</span></span></code></pre></div><p>Verify the created VMs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><hr><h2 id=6-customize-vms-with-virt-customize>6. Customize VMs with virt-customize</h2><p><code>virt-customize</code> lets you modify a VM <strong>without booting it</strong>, which is ideal for quickly customizing clones.</p><h3 id=basic-example-set-hostname-and-password>Basic example: Set hostname and password</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-customize -d vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password usuario:password:MyPassword123!
</span></span></code></pre></div><p>Output:</p><pre tabindex=0><code>[   0.0] Examining the guest ...
[   3.1] Setting a random seed
[   3.1] Setting the hostname: vm-debian-01
[   4.2] Setting passwords
[   5.0] Finishing off
</code></pre><h3 id=advanced-options-for-virt-customize>Advanced options for virt-customize</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-customize -d vm-debian-02 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-debian-02 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--root-password password:RootPass123! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password admin:password:AdminPass123! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--ssh-inject admin:file:/home/user/.ssh/id_rsa.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;apt update &amp;&amp; apt install -y nginx&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--timezone Europe/Madrid <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;systemctl enable nginx&#39;</span>
</span></span></code></pre></div><h3 id=useful-options-table>Useful options table</h3><table><thead><tr><th>Option</th><th>Description</th></tr></thead><tbody><tr><td><code>--hostname NAME</code></td><td>Sets the hostname</td></tr><tr><td><code>--password USER:password:PASS</code></td><td>Sets a user‚Äôs password</td></tr><tr><td><code>--ssh-inject USER:file:KEY.pub</code></td><td>Injects a public SSH key</td></tr><tr><td><code>--run-command 'COMMAND'</code></td><td>Runs a command inside the VM</td></tr><tr><td><code>--install PACKAGES</code></td><td>Installs packages (comma-separated)</td></tr><tr><td><code>--timezone ZONE</code></td><td>Sets the time zone</td></tr><tr><td><code>--update</code></td><td>Updates all packages</td></tr><tr><td><code>--selinux-relabel</code></td><td>Restores SELinux labels</td></tr></tbody></table><h3 id=customization-with-a-script>Customization with a script</h3><p>You can run a complete script:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-customize -d vm-debian-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--upload /path/to/config.sh:/tmp/config.sh <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;bash /tmp/config.sh&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--delete /tmp/config.sh
</span></span></code></pre></div><hr><h2 id=7-common-problems-and-solutions>7. Common problems and solutions</h2><h3 id=problem-1-error-connecting-via-ssh---connection-refused>Problem 1: Error connecting via SSH - &ldquo;Connection refused&rdquo;</h3><p><strong>Cause:</strong> The host SSH keys were removed by <code>virt-sysprep</code>.</p><p><strong>Symptoms:</strong> When checking the SSH service status inside the VM:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl status sshd
</span></span></code></pre></div><p>You will see errors such as:</p><pre tabindex=0><code>sshd[387]: error: Could not load host key: /etc/ssh/ssh_host_rsa_key
sshd[387]: error: Could not load host key: /etc/ssh/ssh_host_ecdsa_key
sshd[387]: error: Could not load host key: /etc/ssh/ssh_host_ed25519_key
sshd[387]: fatal: No supported key exchange algorithms [preauth]
</code></pre><p><strong>Solution 1:</strong> Regenerate all SSH keys automatically:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ssh-keygen -A
</span></span><span style=display:flex><span>sudo systemctl restart sshd
</span></span></code></pre></div><p>Output:</p><pre tabindex=0><code>ssh-keygen: generating new host keys: RSA DSA ECDSA ED25519
</code></pre><p><strong>Solution 2:</strong> Regenerate keys manually one by one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ssh-keygen -f /etc/ssh/ssh_host_rsa_key -N <span style=color:#e6db74>&#39;&#39;</span> -t rsa
</span></span><span style=display:flex><span>sudo ssh-keygen -f /etc/ssh/ssh_host_ecdsa_key -N <span style=color:#e6db74>&#39;&#39;</span> -t ecdsa
</span></span><span style=display:flex><span>sudo ssh-keygen -f /etc/ssh/ssh_host_ed25519_key -N <span style=color:#e6db74>&#39;&#39;</span> -t ed25519
</span></span><span style=display:flex><span>sudo systemctl restart sshd
</span></span></code></pre></div><p><strong>Solution 3:</strong> Prevent virt-sysprep from deleting SSH keys:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template --operations all,-ssh-hostkeys
</span></span></code></pre></div><blockquote><p><strong>Warning:</strong> If you keep the SSH keys in the template, all cloned VMs will share the same host keys, which is a security risk. Only do this in lab environments.</p></blockquote><h3 id=problem-2-warning-remote-host-identification-has-changed>Problem 2: &ldquo;WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!&rdquo;</h3><p><strong>Cause:</strong> The host‚Äôs SSH keys changed and the client still has the old key in <code>~/.ssh/known_hosts</code>.</p><p><strong>Solution:</strong> Remove the old entry from the <code>known_hosts</code> file:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -f <span style=color:#e6db74>&#34;/home/usuario/.ssh/known_hosts&#34;</span> -R <span style=color:#e6db74>&#34;192.168.122.50&#34;</span>
</span></span></code></pre></div><p>Or manually edit the <code>~/.ssh/known_hosts</code> file and remove the corresponding line.</p><h3 id=problem-3-duplicate-mac-addresses>Problem 3: Duplicate MAC addresses</h3><p><strong>Cause:</strong> When cloning without <code>virt-sysprep</code>, VMs may have the same MAC address.</p><p><strong>Solution:</strong> <code>virt-clone</code> automatically generates new MAC addresses. If you encounter issues, edit the VM:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh edit vm-debian-01
</span></span></code></pre></div><p>Find the <code>&lt;interface></code> section and remove or modify the <code>&lt;mac address='...'/></code> line. Libvirt will generate a new one on boot.</p><h3 id=problem-4-duplicate-machine-id>Problem 4: Duplicate machine-id</h3><p><strong>Cause:</strong> The <code>/etc/machine-id</code> file is identical across all cloned VMs.</p><p><strong>Solution:</strong> <code>virt-sysprep</code> already takes care of this. If you did it manually, regenerate the machine-id:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo rm /etc/machine-id
</span></span><span style=display:flex><span>sudo systemd-machine-id-setup
</span></span></code></pre></div><hr><h2 id=8-recommended-complete-workflow>8. Recommended complete workflow</h2><p>Here‚Äôs a complete workflow to create and deploy multiple VMs:</p><h3 id=step-1-create-and-configure-the-base-vm>Step 1: Create and configure the base VM</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Create base VM (assuming you already have it)</span>
</span></span><span style=display:flex><span>virsh list --all
</span></span></code></pre></div><h3 id=step-2-shut-down-and-clone>Step 2: Shut down and clone</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh shutdown debian13
</span></span><span style=display:flex><span>virt-clone --original debian13 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/debian-template.qcow2
</span></span></code></pre></div><h3 id=step-3-generalize-the-template>Step 3: Generalize the template</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo virt-sysprep -d debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--root-password password:TemplatePass123!
</span></span></code></pre></div><h3 id=step-4-create-new-instances>Step 4: Create new instances</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Create VM 1</span>
</span></span><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-web-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-web-01.qcow2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Customize VM 1</span>
</span></span><span style=display:flex><span>sudo virt-customize -d vm-web-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-web-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password admin:password:AdminWeb01! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--ssh-inject admin:file:/home/user/.ssh/id_rsa.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;apt update &amp;&amp; apt install -y nginx&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create VM 2</span>
</span></span><span style=display:flex><span>virt-clone --original debian-template <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--name vm-db-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--file /var/lib/libvirt/images/vm-db-01.qcow2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Customize VM 2</span>
</span></span><span style=display:flex><span>sudo virt-customize -d vm-db-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--hostname vm-db-01 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--password admin:password:AdminDB01! <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--ssh-inject admin:file:/home/user/.ssh/id_rsa.pub <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--run-command <span style=color:#e6db74>&#39;apt update &amp;&amp; apt install -y postgresql&#39;</span>
</span></span></code></pre></div><h3 id=step-5-start-and-verify>Step 5: Start and verify</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>virsh start vm-web-01
</span></span><span style=display:flex><span>virsh start vm-db-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check assigned IPs</span>
</span></span><span style=display:flex><span>virsh domifaddr vm-web-01
</span></span><span style=display:flex><span>virsh domifaddr vm-db-01
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Connect via SSH</span>
</span></span><span style=display:flex><span>ssh admin@192.168.122.X
</span></span></code></pre></div><hr><h2 id=9-summary-of-main-commands>9. Summary of main commands</h2><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><code>virt-clone --original VM --name NEW --auto-clone</code></td><td>Clone a VM with an automatic disk name</td></tr><tr><td><code>virt-clone --original VM --name NEW --file DISK.qcow2</code></td><td>Clone specifying the disk name</td></tr><tr><td><code>virsh domrename OLD NEW</code></td><td>Rename a virtual machine</td></tr><tr><td><code>sudo virt-sysprep -d VM</code></td><td>Generalize a VM by removing unique identifiers</td></tr><tr><td><code>sudo virt-customize -d VM --hostname NAME</code></td><td>Customize a VM without booting it</td></tr><tr><td><code>sudo ssh-keygen -A</code></td><td>Regenerate all SSH host keys</td></tr><tr><td><code>virsh edit VM</code></td><td>Edit a VM‚Äôs XML configuration</td></tr></tbody></table><hr><h2 id=references>References</h2><ul><li><a href=https://github.com/josedom24/curso_virtualizacion_linux target=_blank rel=noopener>curso_virtualizacion_linux ‚Äî GitHub</a></li><li><a href=https://linux.die.net/man/1/virt-clone target=_blank rel=noopener>virt-clone official documentation</a></li><li><a href=https://libguestfs.org/virt-sysprep.1.html target=_blank rel=noopener>virt-sysprep official documentation</a></li><li><a href=https://libguestfs.org/virt-customize.1.html target=_blank rel=noopener>virt-customize official documentation</a></li><li><a href=https://libguestfs.org/ target=_blank rel=noopener>libguestfs - Tools for accessing and modifying VM disk images</a></li></ul></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f&text=Clone%20and%20rename%20virtual%20machines%20in%20KVM&via=Atlas" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f&title=Clone%20and%20rename%20virtual%20machines%20in%20KVM" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f&title=Clone%20and%20rename%20virtual%20machines%20in%20KVM" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Clone%20and%20rename%20virtual%20machines%20in%20KVM https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Clone%20and%20rename%20virtual%20machines%20in%20KVM&body=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fvirtualizacion-kvm-linux%2fgestion-maquinas-kvm%2fclonar-y-renombrar-vm%2fclonar-y-renombrar-vm%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/javierasping/sentinel/edit/main/content/posts/virtualizacion-kvm-linux/gestion-maquinas-kvm/clonar-y-renombrar-vm/clonar-y-renombrar-vm.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#prerequisites>Prerequisites</a></li><li><a href=#1-prepare-the-base-virtual-machine>1. Prepare the base virtual machine</a><ul><li><a href=#shut-down-the-virtual-machine>Shut down the virtual machine</a></li></ul></li><li><a href=#2-clone-the-virtual-machine-with-virt-clone>2. Clone the virtual machine with virt-clone</a><ul><li><a href=#option-1-automatic-cloning-auto-generated-disk-name>Option 1: Automatic cloning (auto-generated disk name)</a></li><li><a href=#option-2-specify-a-custom-disk-name>Option 2: Specify a custom disk name</a></li><li><a href=#clone-multiple-disks>Clone multiple disks</a></li></ul></li><li><a href=#3-rename-virtual-machines-with-virsh-domrename>3. Rename virtual machines with virsh domrename</a></li><li><a href=#4-generalize-the-vm-with-virt-sysprep>4. Generalize the VM with virt-sysprep</a><ul><li><a href=#what-does-virt-sysprep-do>What does virt-sysprep do?</a></li><li><a href=#basic-usage-of-virt-sysprep>Basic usage of virt-sysprep</a></li><li><a href=#virt-sysprep-with-additional-options>virt-sysprep with additional options</a></li><li><a href=#useful-virt-sysprep-options>Useful virt-sysprep options</a></li></ul></li><li><a href=#5-create-new-vms-from-the-template>5. Create new VMs from the template</a></li><li><a href=#6-customize-vms-with-virt-customize>6. Customize VMs with virt-customize</a><ul><li><a href=#basic-example-set-hostname-and-password>Basic example: Set hostname and password</a></li><li><a href=#advanced-options-for-virt-customize>Advanced options for virt-customize</a></li><li><a href=#useful-options-table>Useful options table</a></li><li><a href=#customization-with-a-script>Customization with a script</a></li></ul></li><li><a href=#7-common-problems-and-solutions>7. Common problems and solutions</a><ul><li><a href=#problem-1-error-connecting-via-ssh---connection-refused>Problem 1: Error connecting via SSH - &ldquo;Connection refused&rdquo;</a></li><li><a href=#problem-2-warning-remote-host-identification-has-changed>Problem 2: &ldquo;WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!&rdquo;</a></li><li><a href=#problem-3-duplicate-mac-addresses>Problem 3: Duplicate MAC addresses</a></li><li><a href=#problem-4-duplicate-machine-id>Problem 4: Duplicate machine-id</a></li></ul></li><li><a href=#8-recommended-complete-workflow>8. Recommended complete workflow</a><ul><li><a href=#step-1-create-and-configure-the-base-vm>Step 1: Create and configure the base VM</a></li><li><a href=#step-2-shut-down-and-clone>Step 2: Shut down and clone</a></li><li><a href=#step-3-generalize-the-template>Step 3: Generalize the template</a></li><li><a href=#step-4-create-new-instances>Step 4: Create new instances</a></li><li><a href=#step-5-start-and-verify>Step 5: Start and verify</a></li></ul></li><li><a href=#9-summary-of-main-commands>9. Summary of main commands</a></li><li><a href=#references>References</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#about>About Me</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#accomplishments>Certifications</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contacto@javiercd.es target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contacto@javiercd.es</span></a></li><li><a href=https://github.com/javierasping target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>javierasping</span></a></li><li><a href=https://www.linkedin.com/in/javiercd target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Francisco Javier Cruces Doval</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">¬© 2023 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.88e12b83fd69c92e719c3aa554a42e6d0f20fb72d76bd329f31250ef3bd11899.js integrity="sha256-iOErg/1pyS5xnDqlVKQubQ8g+3LXa9Mp8xJQ7zvRGJk=" defer></script></body></html>