<!doctype html><html lang=en><head><title>Implementation of a perimeter firewall with Fortinet I</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ddf4c4775d35e5bc3dd64c797b179f99eaf85cf9811e64bd08f8c44a68d0b229.css integrity="sha256-3fTEd1015bw91kx5exefmer4XPmBHmS9CPjESmjQsik="><link rel=icon type=image/png href=/images/site/avatar_hu_f10227dc088ad43a.jpg><meta property="og:url" content="https://www.javiercd.es/en/posts/cortafuegos/fortinet_uno/fortinet_uno/"><meta property="og:site_name" content="Atlas"><meta property="og:title" content="Implementation of a perimeter firewall with Fortinet I"><meta property="og:description" content="Implementation of a perimeter firewall with Fortinet I"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-28T10:00:00+00:00"><meta property="article:modified_time" content="2024-03-28T10:00:00+00:00"><meta property="article:tag" content="FIREWALL"><meta property="article:tag" content="LINUX"><meta property="article:tag" content="DEBIAN"><meta property="article:tag" content="FORTINET"><meta name=twitter:card content="summary"><meta name=twitter:title content="Implementation of a perimeter firewall with Fortinet I"><meta name=twitter:description content="Implementation of a perimeter firewall with Fortinet I"><meta name=description content="Implementation of a perimeter firewall with Fortinet I"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script>theme=localStorage.getItem("darkmode:color-scheme")||"system",theme=="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/en><img src=/images/site/masthead_hu_f10227dc088ad43a.png id=logo alt=Logo>
Atlas</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/en#home>Home</a></li><li class=nav-item><a class=nav-link href=/en#about>About Me</a></li><li class=nav-item><a class=nav-link href=/en#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/en#education>Education</a></li><li class=nav-item><a class=nav-link href=/en#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/en#accomplishments>Certifications</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/en/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="flag-icon flag-icon-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/cortafuegos/fortinet_uno/fortinet_uno><span class="flag-icon flag-icon-es"></span>
Espa√±ol
</a><a class="dropdown-item nav-link languages-item" href=/en/posts/cortafuegos/fortinet_uno/fortinet_uno><span class="flag-icon flag-icon-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/en/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/en/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/ci_cd/> CI / CD Jenkins</a><ul><li><a class=list-link href=/en/posts/ci_cd/practica_jenkins/ title="CI / CD practice with Jenkins">CI / CD practice with Jenkins</a></li><li><a class=list-link href=/en/posts/ci_cd/taller1_jenkins/ title="Workshop 1 Ortho-rector of markdown documents (test)">Workshop 1 Ortho-rector of markdown documents (test)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller2_jenkins/ title="Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)">Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller3_jenkins/ title="Workshop 3 Continuous integration of django application (Test)">Workshop 3 Continuous integration of django application (Test)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/base_de_datos/> Database</a><ul><li><a class=list-link href=/en/posts/base_de_datos/instalar_mariadb/ title="Install MariaDB in Debian">Install MariaDB in Debian</a></li><li><a class=list-link href=/en/posts/base_de_datos/interconexion_de_servidores/ title="Interconnection of database servers">Interconnection of database servers</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalacion_oracle_19c_debian12/ title="Oracle 19c installation under Debian 12">Oracle 19c installation under Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalar_postgresql/ title="PostgreSQL installation in Debian 12">PostgreSQL installation in Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/oracle_acceso_remoto/ title="Remote access configuration in Oracle">Remote access configuration in Oracle</a></li><li><a class=list-link href=/en/posts/base_de_datos/acceso_remoto_mariadb/ title="Remote access in MariaDB">Remote access in MariaDB</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/docker/> Docker</a><ul><li><a class=list-link href=/en/posts/docker/instalar_docker_compose/ title="Docker Compose Installation on Ubuntu 24">Docker Compose Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/instalar_docker_ubuntu24/ title="Docker Installation on Ubuntu 24">Docker Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/taller1/ title="Workshop 1 Storage and networks in Docker">Workshop 1 Storage and networks in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller2/ title="Workshop 2 Multicontainer Scenarios in Docker">Workshop 2 Multicontainer Scenarios in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller3/ title="Workshop 3 Image creation Docker">Workshop 3 Image creation Docker</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/en/posts/cortafuegos/> Firewall</a><ul class=active><li><a class=list-link href=/en/posts/cortafuegos/fortinet_cli/ title="Fortinet CLI">Fortinet CLI</a></li><li><a class="active list-link" href=/en/posts/cortafuegos/fortinet_uno/ title="Perimetral with Fortinet I">Perimetral with Fortinet I</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_dos/ title="Perimetral with Fortinet II">Perimetral with Fortinet II</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_uno/ title="Perimetral with Nftables I">Perimetral with Nftables I</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_dos/ title="Perimetral with Nftables II">Perimetral with Nftables II</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/drivers/> Linux Drivers</a><ul><li><a class=list-link href=/en/posts/drivers/nvidia_driver/ title="Drivers Nvidia">Drivers Nvidia</a></li><li><a class=list-link href=/en/posts/drivers/nvidia_optimus/ title="How to choose which graph to use on my laptop with Linux">How to choose which graph to use on my laptop with Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/redes/> Networks</a><ul><li><a class=list-link href=/en/posts/redes/android_gns3/ title="Android GNS3-KVM">Android GNS3-KVM</a></li><li><a class=list-link href=/en/posts/redes/escenario_ipv6_basico/ title="Basic IPv6 scenario">Basic IPv6 scenario</a></li><li><a class=list-link href=/en/posts/redes/instalacion_wireshark_gns3/ title="GNS3 and Wireshark installation">GNS3 and Wireshark installation</a></li><li><a class=list-link href=/en/posts/redes/instalar_gns3_debian12/ title="GNS3 installation in Debian 12">GNS3 installation in Debian 12</a></li><li><a class=list-link href=/en/posts/redes/switches_gns3/ title="GNS3 switch configuration">GNS3 switch configuration</a></li><li><a class=list-link href=/en/posts/redes/tuneles_ipv6/ title="IPV6 Tunnels">IPV6 Tunnels</a></li><li><a class=list-link href=/en/posts/redes/configuracion_de_nat/ title="NAT in Cisco and Linux">NAT in Cisco and Linux</a></li><li><a class=list-link href=/en/posts/redes/comandos_de_supervision_de_redes/ title="Network monitoring commands">Network monitoring commands</a></li><li><a class=list-link href=/en/posts/redes/enroutamiento_openstack/ title="OpenStack routing">OpenStack routing</a></li><li><a class=list-link href=/en/posts/redes/arp/ title="Protocol ARP">Protocol ARP</a></li><li><a class=list-link href=/en/posts/redes/underworld/ title=Underworld>Underworld</a></li><li><a class=list-link href=/en/posts/redes/underworld_evolution/ title="Underworld evolution">Underworld evolution</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/seguridad/> Security</a><ul><li><a class=list-link href=/en/posts/seguridad/forense/ title="Forensic computer">Forensic computer</a></li><li><a class=list-link href=/en/posts/seguridad/https_autofirmado/ title=HTTPS>HTTPS</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/> Services</a><ul><li><a class=list-link href=/en/posts/servicios/apache/ title=Apache>Apache</a></li><li><a class=list-link href=/en/posts/servicios/dhcp/ title=DHCP>DHCP</a></li><li><a class=list-link href=/en/posts/servicios/dns/ title=DNS>DNS</a></li><li><a class=list-link href=/en/posts/servicios/ftp/ title=FTP>FTP</a></li><li><a class=list-link href=/en/posts/servicios/nat_iptables/ title="NAT with iptables">NAT with iptables</a></li><li><a class=list-link href=/en/posts/servicios/ssh/ title=SSH>SSH</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/> Systems</a><ul><li><a class=list-link href=/en/posts/sistemas/ad_ubuntu/ title="Active Directory in Ubuntu">Active Directory in Ubuntu</a></li><li><a class=list-link href=/en/posts/sistemas/recoleccion_logs_journald/ title="Centralized collection of logs journald">Centralized collection of logs journald</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/compilaciones_linux/> Compilations in LINUX</a><ul><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/ title="Compilation of a C-program using a Makefile">Compilation of a C-program using a Makefile</a></li><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/ title="Compilation of a kernel">Compilation of a kernel</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/ title="Creation of an automated installation system">Creation of an automated installation system</a></li><li><a class=list-link href=/en/posts/sistemas/samba_debian/ title="Install and configure samba in Debian">Install and configure samba in Debian</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/comandos_linux/> Linux Command</a><ul><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ title="Kernel parameter modification exercises">Kernel parameter modification exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/comandos_procesos/ title="Linux processes">Linux processes</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ title="Module management exercises">Module management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/gestion_de_paquetes/ title="Package management">Package management</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/empaquetadores_compresores/ title="Packaging and compressors">Packaging and compressors</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ title="Paid management exercises">Paid management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/programacion_tareas/ title="Task programming">Task programming</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/migraciones/> Migration in Linnux</a><ul><li><a class=list-link href=/en/posts/sistemas/migraciones/migracion_sistema_de_ficheros/ title="File system">File system</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/ title="Migtation from CentOS stream 8 to CentOS stream 9">Migtation from CentOS stream 8 to CentOS stream 9</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/eliminacion_systemd/ title="Systemd elimination">Systemd elimination</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/transformacion_instancia_cloud/ title="Transformation instance cloud">Transformation instance cloud</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/nfs_debian/ title="NFS in Debian">NFS in Debian</a></li><li><a class=list-link href=/en/posts/sistemas/activacion_selinux/ title="SELinux activation configuration">SELinux activation configuration</a></li><li><a class=list-link href=/en/posts/sistemas/comparticion_de_directorios_en_windows/ title="Share resources in Windows">Share resources in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/ssh_windows/ title="Ssh service in Windows">Ssh service in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/almacenamiento_servidor_independiente/ title="Storage Spaces in Windows Server">Storage Spaces in Windows Server</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/vpn/> VPN</a><ul><li><a class=list-link href=/en/posts/vpn/comparativa_ovpn_wire/ title="OpenVPN and Wireguard Comparative">OpenVPN and Wireguard Comparative</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_openvpn/ title="OpenVPN remote access">OpenVPN remote access</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_strongswang/ title="Remote access Ipsec StrongSwan">Remote access Ipsec StrongSwan</a></li><li><a class=list-link href=/en/posts/vpn/ipsec_cisco/ title="Site-to-Site IPsec Cisco">Site-to-Site IPsec Cisco</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_fortinet/ title="Site-to-Site IPsec Fortinet">Site-to-Site IPsec Fortinet</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_openvpn/ title="Site-to-Site OpenVPN">Site-to-Site OpenVPN</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_wireguard/ title="Site-to-Site Wireguard">Site-to-Site Wireguard</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_wireguard/ title="Wireguard remote access">Wireguard remote access</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/iaw/> Web applications</a><ul><li><a class=list-link href=/en/posts/iaw/lamp/ title="LAMP stack installation">LAMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/lemp/ title="LEMP stack installation">LEMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/wordpress/ title="WordPress LAMP">WordPress LAMP</a></li><li><a class=list-link href=/en/posts/iaw/wordpress_lemp/ title="WordPress LEMP">WordPress LEMP</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/cortafuegos/fortinet1.png)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu_2aff0fda0501496d.png alt="Author Image"><h5 class=author-name>Francisco Javier Cruces Doval</h5><p class=text-muted>Thursday, March 28, 2024 | 10 minutes</p></div><div class=title><h1>Implementation of a perimeter firewall with Fortinet I</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/en/tags/firewall/ class="btn btn-sm btn-info">FIREWALL</a></li><li class=rounded><a href=/en/tags/linux/ class="btn btn-sm btn-info">LINUX</a></li><li class=rounded><a href=/en/tags/debian/ class="btn btn-sm btn-info">DEBIAN</a></li><li class=rounded><a href=/en/tags/fortinet/ class="btn btn-sm btn-info">FORTINET</a></li></ul></div><div class=post-content id=post-content><p>Before you start the practice, the scenario you see in the practice is as similar as I can ride to the original practice. I have used version 7.0.9-1 of FortiGate, as the higher versions bring some restrictions. You can download the image from this [link](<a href=https://drive.google.com/drive/folders/ target=_blank rel=noopener>https://drive.google.com/drive/folders/</a> 1VGmeLN5inkWNNNUsIvq9ewGUzJLTLkiM).</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320223139.png alt></p><h3 id=firewall-start-up>Firewall start-up</h3><p>FortiGate devices are made with the IP 192.168.1.99 / 24, as I am from GNS3 do not need to connect to this interface with a device and change the configuration. Since I can do it from the console.</p><p>By default through that port is enabled the administration by http, https, ssh and telnet.</p><p>In my case I will connect from the console, change your hostname and configure port 1 to take IP for DHCP.</p><p>The default user is admin and the blank password. When we first log in, it will force us to change it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FortiGate-VM64-KVM login: admin
</span></span><span style=display:flex><span>Password: 
</span></span><span style=display:flex><span>You are forced to change your password. Please input a new password.
</span></span><span style=display:flex><span>New Password: 
</span></span><span style=display:flex><span>Confirm Password: 
</span></span><span style=display:flex><span>Welcome!
</span></span></code></pre></div><p>The first thing I&rsquo;ll do is change your hostname, as you see it is similar to swan as we have a configuration mode:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FortiGate-VM64-KVM <span style=color:#75715e># conf sys global</span>
</span></span><span style=display:flex><span>FortiGate-VM64-KVM <span style=color:#f92672>(</span>global<span style=color:#f92672>)</span> <span style=color:#75715e># set hostname FGT</span>
</span></span><span style=display:flex><span>FortiGate-VM64-KVM <span style=color:#f92672>(</span>global<span style=color:#f92672>)</span> <span style=color:#75715e># end</span>
</span></span></code></pre></div><p>Now we&rsquo;re going to set up port 1 by DHCP so that from client 2 you can set it up without having to manually change the IP of it. In addition I will set up the access by http and https to be able to configure it from a browser:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FGT <span style=color:#75715e># show system interface port1</span>
</span></span><span style=display:flex><span>config system interface
</span></span><span style=display:flex><span>    edit <span style=color:#e6db74>&#34;port1&#34;</span>
</span></span><span style=display:flex><span>        set vdom <span style=color:#e6db74>&#34;root&#34;</span>
</span></span><span style=display:flex><span>        set mode dhcp
</span></span><span style=display:flex><span>        set allowaccess ping https ssh http fgfm
</span></span><span style=display:flex><span>        set type physical
</span></span><span style=display:flex><span>        set snmp-index <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    next
</span></span><span style=display:flex><span>end
</span></span></code></pre></div><p>Now let&rsquo;s see the IP that the DHCP has assigned you with the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>FGT <span style=color:#75715e># get system interface </span>
</span></span><span style=display:flex><span><span style=color:#f92672>==</span> <span style=color:#f92672>[</span> port1 <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>name: port1   mode: dhcp    ip: 192.168.122.77 255.255.255.0   status: up    netbios-forward: disable    type: physical   ring-rx: <span style=color:#ae81ff>0</span>   ring-tx: <span style=color:#ae81ff>0</span>   netflow-sampler: disable    sflow-sampler: disable    src-check: enable    explicit-web-proxy: disable    explicit-ftp-proxy: disable    proxy-captive-portal: disable    mtu-override: disable    wccp: disable    drop-overlapped-fragment: disable    drop-fragment: disable  
</span></span></code></pre></div><p>Now from any machine that has access to the &rsquo;external&rsquo; network we can connect to the FW:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320225245.png alt></p><p>When you log in you will see a panel with general information about the device status:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320225435.png alt></p><p>LAN Network Configuration</p><p>As you have seen in the topology image, the LAN network is connected to port 2. We will therefore proceed to set it up.</p><p>Let&rsquo;s go to Network > Interfaces, select port 2 and click to edit in the top bar:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320230138.png alt></p><p>Once inside the interface configuration screen, you can customize the port by assigning an alias. In addition, to facilitate future management, I have assigned the LAN role to the port2, indicating that it will be used for a local network. I have subsequently configured the IP address of it, assigning it to the 192.168.100.1 / 24. In addition, I have created an object with that IP, which will facilitate the reference to this IP address in future settings, eliminating the need to remember the IP.</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320230527.png alt></p><p>Let&rsquo;s continue with the interface configuration. From the LAN network, where we will be most of the time, I will allow access via HTTPS and SSH to configure the FortiGate. I&rsquo;ll also let you respond to the pings to ensure connectivity with it. In addition, each interface can be a DHCP server, so I will set you one for the LAN. Finally, I will activate the option to detect devices, so I will have control over who is connected to the network.</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320231025.png alt></p><p>Once you set up the administrative access from the LAN, I will remove the administrative access from the port 1 interface as this serious Internet (WAN).</p><p>So I&rsquo;ll change the ROL to WAN and take away administrative access:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320231953.png alt></p><p>If you remember earlier we marked the Device connection box in the LAN interface, if we want to see the devices connected to this network we access Security Fabric > Asset Identify Center:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320232223.png alt></p><p>For later sections, as I will perform the practice of node firewall, it is interesting to create an object with that host. So you don&rsquo;t need to remember your IP:</p><p><img src=/cortafuegos/fortinet_uno/img/add_object_cliente1.png alt></p><p>Although I have not mentioned anything above, the default policy of these devices is DROP in all directions:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320232353.png alt></p><p>Now we are going to create a new policy that allows for the traffic from the LAN to the Internet (WAN) in any direction. This policy would be similar to those we have at home, where we can access any website. In addition, from here we can say that you do SNAT, which will allow us to navigate the Internet. We can also configure to which interface this SNAT will be made.</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320232648.png alt></p><p>To end the initial configuration, we will create the default route to get out on the Internet. For this we will go to Network > Static Routes:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320233928.png alt></p><p>Once this policy has been implemented, we can start the practice, we can also access the Internet from customer 1:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320233557.png alt></p><h3 id=firewall-rules>Firewall rules</h3><p>To begin with, I will deactivate the previous policy, and at the end of it will remove the tic that activates it:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320234721.png alt></p><p>It is thus inactive:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240320234740.png alt></p><h3 id=local-network-equipment-should-be-able-to-have-an-external-connection>Local network equipment should be able to have an external connection.</h3><p>To configure the SNAT on FortiGate devices, it is a little different since in every rule we will allow we will have to mark the box if we want to do NAT.</p><p>We can also specify all possible options that we can think of, in my case I will leave this section unactivated and I will do it in the following rules. The image you see below is to indicate where it would be activated. We can also indicate why we want the traffic out. This is useful if we have two or more Internet outputs to make a load rocker.</p><p>Once here within the interface configuration we tell you that the interface is NAT type, we can also tell you not to do PAT.</p><p><img src=/cortafuegos/fortinet_uno/img/fw_1_a.png alt></p><h3 id=we-allowed-to-do-ping-from-the-lan-to-the-firewall-machine>We allowed to do ping from the LAN to the firewall machine.</h3><p>In these devices it would not be a rule as such, but this particular option is indicated from the administrative access option of the interface:</p><p><img src=/cortafuegos/fortinet_uno/img/fw_2_a.png alt></p><p>Once applied, if we go to client 1 we can do ping to the firewall:</p><p><img src=/cortafuegos/fortinet_uno/img/cliente1_ping_fw.png alt></p><h3 id=allows-to-make-ssh-connections-from-lan-equipment>Allows to make ssh connections from LAN equipment</h3><p>We will create the rule that allows SSH traffic, here at the source we can put either the cliente1 (we create the object in the preparation of the stage) or directly put all at the origin:</p><p><img src=/cortafuegos/fortinet_uno/img/fw_3_a.png alt></p><p>Although I currently have only one client in my scheme, stick to the statement if I want ALL LAN customers to make ssh at source I have to allow all:</p><p><img src=/cortafuegos/fortinet_uno/img/fw_3_a_2.png alt></p><p>As I explained in paragraph a of the practice, in this type of device we have to tell you whether we want the rule to be NAT-type to do SNAT or not.</p><p>Once the rule is applied, we can connect by ssh from the cliente1:</p><p><img src=/cortafuegos/fortinet_uno/img/cliente1_ssh_atlas.png alt></p><p>Let&rsquo;s make sure the rule has hits:</p><p><img src=/cortafuegos/fortinet_uno/img/fw_3_a_hits.png alt></p><h3 id=allows-navigation-on-lan-network>Allows navigation on LAN network</h3><p>For this we will create 2 rules for the LAN network. One that allows DNS and another to allow HTTPS and HTTP traffic, in addition to both rules it will be necessary to indicate that it is done NAT.</p><p><img src=/cortafuegos/fortinet_uno/img/fw_4_a_dns.png alt></p><p><img src=/cortafuegos/fortinet_uno/img/fw_4_a_https.png alt></p><p>As you have fixed, I have not indicated the port number, but that these devices have objects called services in which the port numbers of these are stored. We can create the objects we want and customize the existing ones according to our needs.</p><p>Let&rsquo;s check that we can navigate on client 1:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322192235.png alt></p><p>Needless to say, of course we can do a dig, with the current rule we can do it to any DNS server:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322192456.png alt></p><p>Let&rsquo;s check that we have hits in the rules:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322192318.png alt></p><h3 id=install-a-post-server-on-the-lan-machine-it-allows-access-from-the-outside-and-from-the-firewall-to-the-post-server-to-prove-it-you-can-run-a-telnet-to-port-25-tcp>Install a post server on the LAN machine. It allows access from the outside and from the firewall to the post server. To prove it you can run a telnet to port 25 tcp.</h3><p>As we are currently allowed to navigation only by https it is essential that the machine repositories are configured we can install packages on our client, so we will install postfix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt install postfix -y
</span></span></code></pre></div><p>Now we&rsquo;re gonna set up the first DNAT rule we&rsquo;re gonna have on stage. To do this we will have to create a virtual IP and tell you which is the external IP (WAN) and the IP where we are going to do the DNAT (LAN).</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322202326.png alt></p><p>Now let&rsquo;s add the rule in our policy, in the destination of the rule we will indicate the virtual IP that we just created and we indicate the SMTP service that has the 25 TCP port configured:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322203152.png alt></p><p>And let&rsquo;s check that from an external client, as is Client 2 we can access Customer 1:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322202558.png alt></p><p>Let&rsquo;s check that the rule we just created has hits:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322203530.png alt></p><h3 id=allows-to-make-ssh-connections-from-outside-to-the-lan>Allows to make ssh connections from outside to the LAN</h3><p>To do this, we will have to recreate a new virtual IP as it previously specified that this IP was only used for the SMTP protocol. So I&rsquo;m gonna create a new one:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322204310.png alt></p><p>Once the new virtual IP is created for the ssh, we will create the DNAT rule:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322204626.png alt></p><p>Let&rsquo;s try our new rule from client 2:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322204918.png alt></p><p>Let&rsquo;s check the hits of our new rule:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322205046.png alt></p><h2 id=--modifies-the-previous-rule-so-that-when-we-access-from-the-outside-by-ssh-we-have-to-connect-to-port-2222-although-the-ssh-server-is-configured-to-access-by-port-22># # Modifies the previous rule, so that when we access from the outside by ssh we have to connect to port 2222, although the ssh server is configured to access by port 22.</h2><p>To do this we will have to generate a new service that is in port 2222:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322205327.png alt></p><p>Now we are going to modify our virtual IP by modifying the service by the new one we have created with the 2222 port and we will make a port forweding to the 22 port:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322205425.png alt></p><p>Once this has been done, we can access ssh using the 2222 port and redirect us to 22. We don&rsquo;t need to change the rules, only with this we can access:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322205611.png alt></p><p>We will check the hits of the rules, plus in the Virtual IP section we also have a hit counter:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322205747.png alt></p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322205954.png alt></p><h3 id=it-allows-dns-queries-from-the-lan-only-to-the-8888-server-check-that-you-cant-make-a-dig--1111>It allows DNS queries from the LAN only to the 8.8.8.8 server. Check that you can&rsquo;t make a dig @ 1.1.1.1.</h3><p>For this we will modify the rule that allows DNS queries and we will indicate that the destination is only 8.8.8.8.</p><p>First we will need to create a new object with the Google DNS server IP:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322210309.png alt></p><p>Now we change the rule and put this object as a destination:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322210344.png alt></p><p>Let&rsquo;s check the change of the rule, so we can only do dns consultations at 8.8.8.8:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322210423.png alt></p><p>We can check that the hits have gone up:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322210549.png alt></p><h3 id=allows-lan-equipment-to-browse-the-internet-except-for-the--page>Allows LAN equipment to browse the Internet, except for the <a href=https://www.realbetisbalompie.es target=_blank rel=noopener>www.realbetisbalompie.es</a> page</h3><p>These new generation firewalls bring a series of services that filter us at the application level that allows us to detect key words to filter the content (drugs, pornography, weapons&mldr;), in this firewall the filtering by key words is a payment service, you have to pay a license. It also allows us to create filters to block certain web pages, which in this case is free.</p><p>The first thing is to create our web _ filter policy:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322211146.png alt></p><p>And we add in it a new filter per URL:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322211118.png alt></p><p>We now turn to the rule that allows us to traffic https and in security we add the web filter we have just created:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322211227.png alt></p><p>To the left I will access from the browser of my physical machine and I can access the page of the evil one, however if I access from client 1 the firewall does not let us access:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322211357.png alt></p><p>If we access FortiView Destinations we can see the pages that our filter has blocked:</p><p><img src=/cortafuegos/fortinet_uno/img/Pastedimage20240322211950.png alt></p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fcortafuegos%2ffortinet_uno%2ffortinet_uno%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fcortafuegos%2ffortinet_uno%2ffortinet_uno%2f&text=Implementation%20of%20a%20perimeter%20firewall%20with%20Fortinet%20I&via=Atlas" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fcortafuegos%2ffortinet_uno%2ffortinet_uno%2f&title=Implementation%20of%20a%20perimeter%20firewall%20with%20Fortinet%20I" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fcortafuegos%2ffortinet_uno%2ffortinet_uno%2f&title=Implementation%20of%20a%20perimeter%20firewall%20with%20Fortinet%20I" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Implementation%20of%20a%20perimeter%20firewall%20with%20Fortinet%20I https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fcortafuegos%2ffortinet_uno%2ffortinet_uno%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Implementation%20of%20a%20perimeter%20firewall%20with%20Fortinet%20I&body=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fcortafuegos%2ffortinet_uno%2ffortinet_uno%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/javierasping/sentinel/edit/main/content/posts/cortafuegos/fortinet_uno/fortinet_uno.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#firewall-start-up>Firewall start-up</a></li><li><a href=#firewall-rules>Firewall rules</a></li><li><a href=#local-network-equipment-should-be-able-to-have-an-external-connection>Local network equipment should be able to have an external connection.</a></li><li><a href=#we-allowed-to-do-ping-from-the-lan-to-the-firewall-machine>We allowed to do ping from the LAN to the firewall machine.</a></li><li><a href=#allows-to-make-ssh-connections-from-lan-equipment>Allows to make ssh connections from LAN equipment</a></li><li><a href=#allows-navigation-on-lan-network>Allows navigation on LAN network</a></li><li><a href=#install-a-post-server-on-the-lan-machine-it-allows-access-from-the-outside-and-from-the-firewall-to-the-post-server-to-prove-it-you-can-run-a-telnet-to-port-25-tcp>Install a post server on the LAN machine. It allows access from the outside and from the firewall to the post server. To prove it you can run a telnet to port 25 tcp.</a></li><li><a href=#allows-to-make-ssh-connections-from-outside-to-the-lan>Allows to make ssh connections from outside to the LAN</a></li></ul></li><li><a href=#--modifies-the-previous-rule-so-that-when-we-access-from-the-outside-by-ssh-we-have-to-connect-to-port-2222-although-the-ssh-server-is-configured-to-access-by-port-22># # Modifies the previous rule, so that when we access from the outside by ssh we have to connect to port 2222, although the ssh server is configured to access by port 22.</a><ul><li><a href=#it-allows-dns-queries-from-the-lan-only-to-the-8888-server-check-that-you-cant-make-a-dig--1111>It allows DNS queries from the LAN only to the 8.8.8.8 server. Check that you can&rsquo;t make a dig @ 1.1.1.1.</a></li><li><a href=#allows-lan-equipment-to-browse-the-internet-except-for-the--page>Allows LAN equipment to browse the Internet, except for the <a href=http://www.realbetisbalompie.es>www.realbetisbalompie.es</a> page</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#about>About Me</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#accomplishments>Certifications</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contacto@javiercd.es target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contacto@javiercd.es</span></a></li><li><a href=https://github.com/javierasping target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>javierasping</span></a></li><li><a href=https://www.linkedin.com/in/javiercd target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Francisco Javier Cruces Doval</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">¬© 2023 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.b6e81adc7ec7b607dcd44cb550d5ac0e8aa374ad64c95daf8eddf470660f2331.js integrity="sha256-tuga3H7Htgfc1Ey1UNWsDoqjdK1kyV2vjt30cGYPIzE=" defer></script></body></html>