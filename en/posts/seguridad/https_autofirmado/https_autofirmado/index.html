<!doctype html><html lang=en><head><title>Create certification authority (CA) and self-signed certificates in Linux</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ddf4c4775d35e5bc3dd64c797b179f99eaf85cf9811e64bd08f8c44a68d0b229.css integrity="sha256-3fTEd1015bw91kx5exefmer4XPmBHmS9CPjESmjQsik="><link rel=icon type=image/png href=/images/site/avatar_hu_f10227dc088ad43a.jpg><meta property="og:title" content="Atlas"><meta property="og:type" content="website"><meta property="og:description" content="Portfolio and personal blog of Francisco Javier Cruces Doval"><meta property="og:image" content="/images/author/john.png"><meta property="og:url" content="https://www.javiercd.es"><meta name=description content="Create certification authority (CA) and self-signed certificates in Linux"><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/en><img src=/images/site/masthead_hu_f10227dc088ad43a.png id=logo alt=Logo>
Atlas</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/en#home>Home</a></li><li class=nav-item><a class=nav-link href=/en#about>About Me</a></li><li class=nav-item><a class=nav-link href=/en#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/en#education>Education</a></li><li class=nav-item><a class=nav-link href=/en#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/en#accomplishments>Certifications</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/en/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/seguridad/https_autofirmado/https_autofirmado><span class="fi fi-es"></span>
Español
</a><a class="dropdown-item nav-link languages-item" href=/en/posts/seguridad/https_autofirmado/https_autofirmado><span class="fi fi-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/en/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/en/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/ci_cd/> CI / CD Jenkins</a><ul><li><a class=list-link href=/en/posts/ci_cd/practica_jenkins/ title="CI / CD practice with Jenkins">CI / CD practice with Jenkins</a></li><li><a class=list-link href=/en/posts/ci_cd/taller1_jenkins/ title="Workshop 1 Ortho-rector of markdown documents (test)">Workshop 1 Ortho-rector of markdown documents (test)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller2_jenkins/ title="Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)">Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller3_jenkins/ title="Workshop 3 Continuous integration of django application (Test)">Workshop 3 Continuous integration of django application (Test)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/base_de_datos/> Database</a><ul><li><a class=list-link href=/en/posts/base_de_datos/instalar_mariadb/ title="Install MariaDB in Debian">Install MariaDB in Debian</a></li><li><a class=list-link href=/en/posts/base_de_datos/interconexion_de_servidores/ title="Interconnection of database servers">Interconnection of database servers</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalacion_oracle_19c_debian12/ title="Oracle 19c installation under Debian 12">Oracle 19c installation under Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalar_postgresql/ title="PostgreSQL installation in Debian 12">PostgreSQL installation in Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/oracle_acceso_remoto/ title="Remote access configuration in Oracle">Remote access configuration in Oracle</a></li><li><a class=list-link href=/en/posts/base_de_datos/acceso_remoto_mariadb/ title="Remote access in MariaDB">Remote access in MariaDB</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/docker/> Docker</a><ul><li><a class=list-link href=/en/posts/docker/instalar_docker_compose/ title="Docker Compose Installation on Ubuntu 24">Docker Compose Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/instalar_docker_ubuntu24/ title="Docker Installation on Ubuntu 24">Docker Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/taller1/ title="Workshop 1 Storage and networks in Docker">Workshop 1 Storage and networks in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller2/ title="Workshop 2 Multicontainer Scenarios in Docker">Workshop 2 Multicontainer Scenarios in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller3/ title="Workshop 3 Image creation Docker">Workshop 3 Image creation Docker</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/cortafuegos/> Firewall</a><ul><li><a class=list-link href=/en/posts/cortafuegos/fortinet_cli/ title="Fortinet CLI">Fortinet CLI</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_uno/ title="Perimetral with Fortinet I">Perimetral with Fortinet I</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_dos/ title="Perimetral with Fortinet II">Perimetral with Fortinet II</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_uno/ title="Perimetral with Nftables I">Perimetral with Nftables I</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_dos/ title="Perimetral with Nftables II">Perimetral with Nftables II</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/drivers/> Linux Drivers</a><ul><li><a class=list-link href=/en/posts/drivers/nvidia_driver/ title="Drivers Nvidia">Drivers Nvidia</a></li><li><a class=list-link href=/en/posts/drivers/nvidia_optimus/ title="How to choose which graph to use on my laptop with Linux">How to choose which graph to use on my laptop with Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/redes/> Networks</a><ul><li><a class=list-link href=/en/posts/redes/android_gns3/ title="Android GNS3-KVM">Android GNS3-KVM</a></li><li><a class=list-link href=/en/posts/redes/escenario_ipv6_basico/ title="Basic IPv6 scenario">Basic IPv6 scenario</a></li><li><a class=list-link href=/en/posts/redes/instalacion_wireshark_gns3/ title="GNS3 and Wireshark installation">GNS3 and Wireshark installation</a></li><li><a class=list-link href=/en/posts/redes/instalar_gns3_debian12/ title="GNS3 installation in Debian 12">GNS3 installation in Debian 12</a></li><li><a class=list-link href=/en/posts/redes/switches_gns3/ title="GNS3 switch configuration">GNS3 switch configuration</a></li><li><a class=list-link href=/en/posts/redes/tuneles_ipv6/ title="IPV6 Tunnels">IPV6 Tunnels</a></li><li><a class=list-link href=/en/posts/redes/configuracion_de_nat/ title="NAT in Cisco and Linux">NAT in Cisco and Linux</a></li><li><a class=list-link href=/en/posts/redes/comandos_de_supervision_de_redes/ title="Network monitoring commands">Network monitoring commands</a></li><li><a class=list-link href=/en/posts/redes/enroutamiento_openstack/ title="OpenStack routing">OpenStack routing</a></li><li><a class=list-link href=/en/posts/redes/arp/ title="Protocol ARP">Protocol ARP</a></li><li><a class=list-link href=/en/posts/redes/underworld/ title=Underworld>Underworld</a></li><li><a class=list-link href=/en/posts/redes/underworld_evolution/ title="Underworld evolution">Underworld evolution</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/en/posts/seguridad/> Security</a><ul class=active><li><a class=list-link href=/en/posts/seguridad/forense/ title="Forensic computer">Forensic computer</a></li><li><a class="active list-link" href=/en/posts/seguridad/https_autofirmado/ title=HTTPS>HTTPS</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/> Services</a><ul><li><a class=list-link href=/en/posts/servicios/apache/ title=Apache>Apache</a></li><li><a class=list-link href=/en/posts/servicios/dhcp/ title=DHCP>DHCP</a></li><li><a class=list-link href=/en/posts/servicios/dns/ title=DNS>DNS</a></li><li><a class=list-link href=/en/posts/servicios/ftp/ title=FTP>FTP</a></li><li><a class=list-link href=/en/posts/servicios/nat_iptables/ title="NAT with iptables">NAT with iptables</a></li><li><a class=list-link href=/en/posts/servicios/ssh/ title=SSH>SSH</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/> Systems</a><ul><li><a class=list-link href=/en/posts/sistemas/ad_ubuntu/ title="Active Directory in Ubuntu">Active Directory in Ubuntu</a></li><li><a class=list-link href=/en/posts/sistemas/recoleccion_logs_journald/ title="Centralized collection of logs journald">Centralized collection of logs journald</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/compilaciones_linux/> Compilations in LINUX</a><ul><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/ title="Compilation of a C-program using a Makefile">Compilation of a C-program using a Makefile</a></li><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/ title="Compilation of a kernel">Compilation of a kernel</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/ title="Creation of an automated installation system">Creation of an automated installation system</a></li><li><a class=list-link href=/en/posts/sistemas/samba_debian/ title="Install and configure samba in Debian">Install and configure samba in Debian</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/comandos_linux/> Linux Command</a><ul><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ title="Kernel parameter modification exercises">Kernel parameter modification exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/comandos_procesos/ title="Linux processes">Linux processes</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ title="Module management exercises">Module management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/gestion_de_paquetes/ title="Package management">Package management</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/empaquetadores_compresores/ title="Packaging and compressors">Packaging and compressors</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ title="Paid management exercises">Paid management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/programacion_tareas/ title="Task programming">Task programming</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/migraciones/> Migration in Linnux</a><ul><li><a class=list-link href=/en/posts/sistemas/migraciones/migracion_sistema_de_ficheros/ title="File system">File system</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/ title="Migtation from CentOS stream 8 to CentOS stream 9">Migtation from CentOS stream 8 to CentOS stream 9</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/eliminacion_systemd/ title="Systemd elimination">Systemd elimination</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/transformacion_instancia_cloud/ title="Transformation instance cloud">Transformation instance cloud</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/nfs_debian/ title="NFS in Debian">NFS in Debian</a></li><li><a class=list-link href=/en/posts/sistemas/activacion_selinux/ title="SELinux activation configuration">SELinux activation configuration</a></li><li><a class=list-link href=/en/posts/sistemas/comparticion_de_directorios_en_windows/ title="Share resources in Windows">Share resources in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/ssh_windows/ title="Ssh service in Windows">Ssh service in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/almacenamiento_servidor_independiente/ title="Storage Spaces in Windows Server">Storage Spaces in Windows Server</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/vpn/> VPN</a><ul><li><a class=list-link href=/en/posts/vpn/comparativa_ovpn_wire/ title="OpenVPN and Wireguard Comparative">OpenVPN and Wireguard Comparative</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_openvpn/ title="OpenVPN remote access">OpenVPN remote access</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_strongswang/ title="Remote access Ipsec StrongSwan">Remote access Ipsec StrongSwan</a></li><li><a class=list-link href=/en/posts/vpn/ipsec_cisco/ title="Site-to-Site IPsec Cisco">Site-to-Site IPsec Cisco</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_fortinet/ title="Site-to-Site IPsec Fortinet">Site-to-Site IPsec Fortinet</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_openvpn/ title="Site-to-Site OpenVPN">Site-to-Site OpenVPN</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_wireguard/ title="Site-to-Site Wireguard">Site-to-Site Wireguard</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_wireguard/ title="Wireguard remote access">Wireguard remote access</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/iaw/> Web applications</a><ul><li><a class=list-link href=/en/posts/iaw/lamp/ title="LAMP stack installation">LAMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/lemp/ title="LEMP stack installation">LEMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/wordpress/ title="WordPress LAMP">WordPress LAMP</a></li><li><a class=list-link href=/en/posts/iaw/wordpress_lemp/ title="WordPress LEMP">WordPress LEMP</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/seguridad/certificados_ssl.png)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu_2aff0fda0501496d.png alt="Author Image"><h5 class=author-name>Francisco Javier Cruces Doval</h5><p class=text-muted>Thursday, March 28, 2024 | 15 minutes</p></div><div class=title><h1>Create certification authority (CA) and self-signed certificates in Linux</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/en/tags/linux/ class="btn btn-sm btn-info">LINUX</a></li><li class=rounded><a href=/en/tags/debian/ class="btn btn-sm btn-info">DEBIAN</a></li><li class=rounded><a href=/en/tags/https/ class="btn btn-sm btn-info">HTTPS</a></li></ul></div><div class=post-content id=post-content><p>At first a student will establish a Certified Authority and sign a certificate for the other student&rsquo;s page. We will then test it on the Apache and Nginx web servers.</p><h3 id=create-the-certifying-authority>Create the certifying authority</h3><p>Step 1: Creating directories and files</p><p>The first step will be to generate a directory in which you will locate your certification authority, in order to maintain an organization at all times. The directory name will be CA /. In turn, you have to generate several subdirectories within it:</p><ul><li>certsdb: The signed certificates shall be stored in that directory.</li><li>certreqs: In that directory, the certificate signature application files (CSR) shall be stored.</li><li>crl: The list of certificates that have been revoked (CRL) shall be stored in that directory.</li><li>private: The private key of the certifying authority shall be stored in this directory.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ sudo mkdir /CA
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ cd !$
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo mkdir certsdb certreqs crl private
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo chmod <span style=color:#ae81ff>700</span> private/
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo touch index.txt
</span></span></code></pre></div><p>Once the directories are generated, move into the father CA / directory. When you are within it, you list the content in a graphic way so you can appreciate that everything has been generated correctly, making use of tree.
You&rsquo;ll see that the 4 directories have been properly generated. Before continuing it is recommended to change the permissions to 700 to the private directory /, as it will contain the private key of the CA and we are interested that only the owner has access to it.
In addition, we will need in the current directory a file that will act as a database for existing index.txt name certificates</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo tree -p
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>drwxr-xr-x<span style=color:#f92672>]</span>  .
</span></span><span style=display:flex><span>├── <span style=color:#f92672>[</span>drwxr-xr-x<span style=color:#f92672>]</span>  certreqs
</span></span><span style=display:flex><span>├── <span style=color:#f92672>[</span>drwxr-xr-x<span style=color:#f92672>]</span>  certsdb
</span></span><span style=display:flex><span>├── <span style=color:#f92672>[</span>drwxr-xr-x<span style=color:#f92672>]</span>  crl
</span></span><span style=display:flex><span>├── <span style=color:#f92672>[</span>-rw-r--r--<span style=color:#f92672>]</span>  index.txt
</span></span><span style=display:flex><span>└── <span style=color:#f92672>[</span>drwx------<span style=color:#f92672>]</span>  private
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span> directories, <span style=color:#ae81ff>1</span> file
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ 
</span></span></code></pre></div><h3 id=step-2-openssl-configuration-file>Step 2: Openssl configuration file</h3><p>The most likely is that you want to use an openssl configuration file other than that of our machine, so try to make the certifying authority as isolated as possible from it, so make a copy of your native configuration file and adapt it to your needs. This file is normally found in / usr / lib / ssl / openssl.cnf, although it may also be in / etc / openssl.cnf or in / usr / share / ssl / openssl.cnf, you will have to copy it to the current directory and modify it with a text editor.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo cp /usr/lib/ssl/openssl.cnf ./
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ ls -l
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>32</span>
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> root root  <span style=color:#ae81ff>4096</span> Jan  <span style=color:#ae81ff>8</span> 19:22 certreqs
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> root root  <span style=color:#ae81ff>4096</span> Jan  <span style=color:#ae81ff>8</span> 19:22 certsdb
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#ae81ff>2</span> root root  <span style=color:#ae81ff>4096</span> Jan  <span style=color:#ae81ff>8</span> 19:22 crl
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root     <span style=color:#ae81ff>0</span> Jan  <span style=color:#ae81ff>8</span> 19:23 index.txt
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>12332</span> Jan  <span style=color:#ae81ff>8</span> 19:26 openssl.cnf
</span></span><span style=display:flex><span>drwx------ <span style=color:#ae81ff>2</span> root root  <span style=color:#ae81ff>4096</span> Jan  <span style=color:#ae81ff>8</span> 19:22 private
</span></span></code></pre></div><p>Within it, appropriate adaptations must be made to make use of the directories previously generated, as well as to indicate certain basic information about the certifying authority, which your partner must know, as it will be requested at the time of the generation of the certificate signature application file. The amendments to be made are as follows:</p><p>dir = / root / CA
certs = $dir / certsdb
new _ certs _ dir = $certs</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span> CA_default <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>dir             <span style=color:#f92672>=</span> /CA           <span style=color:#75715e># Where everything is kept</span>
</span></span><span style=display:flex><span>certs           <span style=color:#f92672>=</span> $dir/certsdb          <span style=color:#75715e># Where the issued certs are kept</span>
</span></span><span style=display:flex><span>crl_dir         <span style=color:#f92672>=</span> $dir/crl              <span style=color:#75715e># Where the issued crl are kept</span>
</span></span><span style=display:flex><span>database        <span style=color:#f92672>=</span> $dir/index.txt        <span style=color:#75715e># database index file.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#unique_subject = no                    # Set to &#39;no&#39; to allow creation of</span>
</span></span><span style=display:flex><span>                                        <span style=color:#75715e># several certs with same subject.</span>
</span></span><span style=display:flex><span>new_certs_dir   <span style=color:#f92672>=</span> $certs                <span style=color:#75715e># default place for new certs.</span>
</span></span></code></pre></div><p>countryName _ default = EN
stateOrProvinceName _ default = Sevilla
localityName _ default = Two Sisters
0.organizationName _ default = IES Gonzalo Nazareno
organization</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span> req_distinguished_name <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>countryName                     <span style=color:#f92672>=</span> Country Name <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> letter code<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>countryName_default             <span style=color:#f92672>=</span> ES
</span></span><span style=display:flex><span>countryName_min                 <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>countryName_max                 <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>stateOrProvinceName             <span style=color:#f92672>=</span> State or Province Name <span style=color:#f92672>(</span>full name<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>stateOrProvinceName_default     <span style=color:#f92672>=</span> Sevilla   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>localityName                    <span style=color:#f92672>=</span> Dos Hermanas
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>0.organizationName              <span style=color:#f92672>=</span> Organization Name <span style=color:#f92672>(</span>eg, company<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>0.organizationName_default      <span style=color:#f92672>=</span> IES Gonzalo Nazareno
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#we can do this but it is not needed normally :-)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#1.organizationName             = Second Organization Name (eg, company)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#1.organizationName_default     = World Wide Web Pty Ltd</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>organizationalUnitName          <span style=color:#f92672>=</span> Organizational Unit Name <span style=color:#f92672>(</span>eg, section<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>organizationalUnitName_default  <span style=color:#f92672>=</span> Informatica
</span></span></code></pre></div><p>#challenge
#challenge
#challenge
#unstructural</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span> req_attributes <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>challengePassword               <span style=color:#f92672>=</span> A challenge password
</span></span><span style=display:flex><span>challengePassword_min           <span style=color:#f92672>=</span> <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>challengePassword_max           <span style=color:#f92672>=</span> <span style=color:#ae81ff>20</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>unstructuredName                <span style=color:#f92672>=</span> An optional company name
</span></span></code></pre></div><h3 id=step-3-creation-and-signature-of-our-own-certificate>Step 3: Creation and signature of our own certificate</h3><p>After that, you will have everything ready to generate your key pair and a certificate signature application file that you will then self-sign, running the command for:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo openssl req -new -newkey rsa:4096 -keyout private/cakey.pem -out careq.pem -config ./openssl.cnf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Enter PEM pass phrase:
</span></span><span style=display:flex><span>Verifying - Enter PEM pass phrase:
</span></span><span style=display:flex><span>-----
</span></span><span style=display:flex><span>You are about to be asked to enter information that will be incorporated
</span></span><span style=display:flex><span>into your certificate request.
</span></span><span style=display:flex><span>What you are about to enter is what is called a Distinguished Name or a DN.
</span></span><span style=display:flex><span>There are quite a few fields but you can leave some blank
</span></span><span style=display:flex><span>For some fields there will be a default value,
</span></span><span style=display:flex><span>If you enter <span style=color:#e6db74>&#39;.&#39;</span>, the field will be left blank.
</span></span><span style=display:flex><span>-----
</span></span><span style=display:flex><span>Country Name <span style=color:#f92672>(</span><span style=color:#ae81ff>2</span> letter code<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>ES<span style=color:#f92672>]</span>:ES
</span></span><span style=display:flex><span>State or Province Name <span style=color:#f92672>(</span>full name<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Sevilla<span style=color:#f92672>]</span>:Sevilla
</span></span><span style=display:flex><span>Dos Hermanas <span style=color:#f92672>[]</span>:
</span></span><span style=display:flex><span>Organization Name <span style=color:#f92672>(</span>eg, company<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>IES Gonzalo Nazareno<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>Organizational Unit Name <span style=color:#f92672>(</span>eg, section<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Informatica<span style=color:#f92672>]</span>:
</span></span><span style=display:flex><span>Common Name <span style=color:#f92672>(</span>e.g. server FQDN or YOUR name<span style=color:#f92672>)</span> <span style=color:#f92672>[]</span>:javiercruces.iesgn.org
</span></span><span style=display:flex><span>Email Address <span style=color:#f92672>[]</span>:javierasping@gmail.com
</span></span></code></pre></div><p>As you can see, a passing sentence is requested to protect the private key that we are going to generate, as well as certain basic information for the certificate signature application file, which must match that we have previously entered into the openssl configuration file. The last two fields are not generic, so we must fill them out on a case-by-case basis. After that, we will be able to proceed with the self-signing of the certificate, which we will then have to provide to customers to include in their list of CA certificates, so that they are not shown the warning when using HTTPS. As I mentioned earlier, in a real situation, this process is usually carried out by companies with a certain reputation whose certificate is imported by default in the browsers. To do this, run the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo openssl ca -create_serial -out cacert.pem -days <span style=color:#ae81ff>365</span> -keyfile private/cakey.pem -selfsign -extensions v3_ca -config ./openssl.cnf -infiles careq.pem
</span></span><span style=display:flex><span>Using configuration from ./openssl.cnf
</span></span><span style=display:flex><span>Enter pass phrase <span style=color:#66d9ef>for</span> private/cakey.pem:
</span></span><span style=display:flex><span>Check that the request matches the signature
</span></span><span style=display:flex><span>Signature ok
</span></span><span style=display:flex><span>Certificate Details:
</span></span><span style=display:flex><span>        Serial Number:
</span></span><span style=display:flex><span>            74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f2
</span></span><span style=display:flex><span>        Validity
</span></span><span style=display:flex><span>            Not Before: Jan  <span style=color:#ae81ff>8</span> 19:57:17 <span style=color:#ae81ff>2024</span> GMT
</span></span><span style=display:flex><span>            Not After : Jan  <span style=color:#ae81ff>7</span> 19:57:17 <span style=color:#ae81ff>2025</span> GMT
</span></span><span style=display:flex><span>        Subject:
</span></span><span style=display:flex><span>            countryName               <span style=color:#f92672>=</span> ES
</span></span><span style=display:flex><span>            stateOrProvinceName       <span style=color:#f92672>=</span> Sevilla
</span></span><span style=display:flex><span>            organizationName          <span style=color:#f92672>=</span> IES Gonzalo Nazareno
</span></span><span style=display:flex><span>            organizationalUnitName    <span style=color:#f92672>=</span> Informatica
</span></span><span style=display:flex><span>            commonName                <span style=color:#f92672>=</span> javiercruces.iesgn.org
</span></span><span style=display:flex><span>            emailAddress              <span style=color:#f92672>=</span> javierasping@gmail.com
</span></span><span style=display:flex><span>        X509v3 extensions:
</span></span><span style=display:flex><span>            X509v3 Subject Key Identifier: 
</span></span><span style=display:flex><span>                E3:9C:A3:CF:0E:33:EB:83:45:40:00:9B:04:4A:A9:9B:C8:8C:A9:62
</span></span><span style=display:flex><span>            X509v3 Authority Key Identifier: 
</span></span><span style=display:flex><span>                E3:9C:A3:CF:0E:33:EB:83:45:40:00:9B:04:4A:A9:9B:C8:8C:A9:62
</span></span><span style=display:flex><span>            X509v3 Basic Constraints: critical
</span></span><span style=display:flex><span>                CA:TRUE
</span></span><span style=display:flex><span>Certificate is to be certified <span style=color:#66d9ef>until</span> Jan  <span style=color:#ae81ff>7</span> 19:57:17 <span style=color:#ae81ff>2025</span> GMT <span style=color:#f92672>(</span><span style=color:#ae81ff>365</span> days<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Sign the certificate? <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>:y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> out of <span style=color:#ae81ff>1</span> certificate requests certified, commit? <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>y
</span></span><span style=display:flex><span>Write out database with <span style=color:#ae81ff>1</span> new entries
</span></span><span style=display:flex><span>Data Base Updated
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ 
</span></span></code></pre></div><p>Where:</p><ul><li>create _ serial: We suggest that you generate a 128 bit serial to start. Thanks to that randomness, if we had to start again, we would not overwrite the existing ones. It&rsquo;s very important.</li><li>out: We specify where the signed certificate will be stored. In this case, in the current directory, with the name cact.pem.</li><li>Days: We specify the validity on days of the signed certificate. In this case, 365 days.</li><li>keyfile: We indicate the private key to use to sign that certificate. In this case, the one generated in the previous step, private / cakey.pem.</li><li>selfsign: Let&rsquo;s tell openssl we&rsquo;re going to sign the certificate.</li><li>extensions: We indicate to openssl the section of the configuration file in which the extensions to use are found. In this case, v3 _ ca.</li><li>config: We specify openssl using the modified configuration file, not the native one, with the name openssl.cnf.</li><li>unfaithful: We indicate what we want to sign, in this case, the CSR for our new certifying authority created in the previous step, with the name careq.pem.</li></ul><p>As you can see at the output of the command, we have been asked to make sure that even if the private key reached bad hands, they cannot make fraudulent signatures. In addition, before signing the certificate, we have been shown all the information concerning the certificate, and we have been asked for confirmation.
To verify that the certificate of the certifying authority is contained in the current directory, list the content of the certificate and check that, in fact, there is a cact.pem file that is the result of signing the application file of the Careq.pem. certificate.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo tree
</span></span><span style=display:flex><span>.
</span></span><span style=display:flex><span>├── cacert.pem
</span></span><span style=display:flex><span>├── careq.pem
</span></span><span style=display:flex><span>├── certreqs
</span></span><span style=display:flex><span>├── certsdb
</span></span><span style=display:flex><span>│   └── 741E8AF82445149E28F183047C7D6C0F5F3BACF2.pem
</span></span><span style=display:flex><span>├── crl
</span></span><span style=display:flex><span>├── index.txt
</span></span><span style=display:flex><span>├── index.txt.attr
</span></span><span style=display:flex><span>├── index.txt.old
</span></span><span style=display:flex><span>├── openssl.cnf
</span></span><span style=display:flex><span>├── private
</span></span><span style=display:flex><span>│   └── cakey.pem
</span></span><span style=display:flex><span>└── serial
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>5</span> directories, <span style=color:#ae81ff>9</span> files
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ 
</span></span></code></pre></div><h3 id=step-4-signature-of-licence-applications>Step 4: Signature of licence applications</h3><p>It is all ready to proceed to sign the certificate for your partner&rsquo;s server, so you must place your certificate signature application file within certreqs /, which is where they should be located.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ sudo ls -l /CA/certreqs/
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>1785</span> Jan <span style=color:#ae81ff>11</span> 10:00 peperc.csr
</span></span></code></pre></div><p>You can proceed to sign it, using the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo openssl ca -config openssl.cnf -extensions v3_req -days <span style=color:#ae81ff>3650</span> -notext -md sha256 -in certreqs/peperc.csr -out certsdb/pepe.csr.pem
</span></span><span style=display:flex><span>Using configuration from openssl.cnf
</span></span><span style=display:flex><span>Enter pass phrase <span style=color:#66d9ef>for</span> /CA/private/cakey.pem:
</span></span><span style=display:flex><span>Check that the request matches the signature
</span></span><span style=display:flex><span>Signature ok
</span></span><span style=display:flex><span>Certificate Details:
</span></span><span style=display:flex><span>        Serial Number:
</span></span><span style=display:flex><span>            74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f3
</span></span><span style=display:flex><span>        Validity
</span></span><span style=display:flex><span>            Not Before: Jan <span style=color:#ae81ff>11</span> 10:01:58 <span style=color:#ae81ff>2024</span> GMT
</span></span><span style=display:flex><span>            Not After : Jan  <span style=color:#ae81ff>8</span> 10:01:58 <span style=color:#ae81ff>2034</span> GMT
</span></span><span style=display:flex><span>        Subject:
</span></span><span style=display:flex><span>            countryName               <span style=color:#f92672>=</span> ES
</span></span><span style=display:flex><span>            stateOrProvinceName       <span style=color:#f92672>=</span> Sevilla
</span></span><span style=display:flex><span>            organizationName          <span style=color:#f92672>=</span> IES Gonzalo Nazareno
</span></span><span style=display:flex><span>            commonName                <span style=color:#f92672>=</span> pfoter15
</span></span><span style=display:flex><span>            emailAddress              <span style=color:#f92672>=</span> pepepfoter15@gmail.com
</span></span><span style=display:flex><span>        X509v3 extensions:
</span></span><span style=display:flex><span>            X509v3 Basic Constraints: 
</span></span><span style=display:flex><span>                CA:FALSE
</span></span><span style=display:flex><span>            X509v3 Key Usage: 
</span></span><span style=display:flex><span>                Digital Signature, Non Repudiation, Key Encipherment
</span></span><span style=display:flex><span>Certificate is to be certified <span style=color:#66d9ef>until</span> Jan  <span style=color:#ae81ff>8</span> 10:01:58 <span style=color:#ae81ff>2034</span> GMT <span style=color:#f92672>(</span><span style=color:#ae81ff>3650</span> days<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Sign the certificate? <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>:y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> out of <span style=color:#ae81ff>1</span> certificate requests certified, commit? <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>y
</span></span><span style=display:flex><span>Write out database with <span style=color:#ae81ff>1</span> new entries
</span></span><span style=display:flex><span>Database updated
</span></span></code></pre></div><p>Where:</p><ul><li>config: We specify openssl using the modified configuration file, not the native one, with the name openssl.cnf.</li><li>out: We specify where the signed certificate will be stored. In this case, within the certsdb / directory, with the name nombre.crt.</li><li>infidel: We indicate what we want to sign, in this case, the CSR of our partner, located in certreqs / with name nombre.csr.</li></ul><p>At first, the certificate is already signed within certsdb /, so to verify it, you will list the content of that directory.</p><p>There must be a total of 3 files within it: one corresponding to the certificate of the certifying authority itself, and two corresponding to your partner, which are exactly the same but with different names, one with one identifier and the other with a common name that we have established in order to identify it more easily.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ sudo ls -l /CA/certsdb/
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>7429</span> Jan  <span style=color:#ae81ff>8</span> 19:57 741E8AF82445149E28F183047C7D6C0F5F3BACF2.pem
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>2139</span> Jan <span style=color:#ae81ff>11</span> 10:02 741E8AF82445149E28F183047C7D6C0F5F3BACF3.pem
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root root <span style=color:#ae81ff>2139</span> Jan <span style=color:#ae81ff>11</span> 10:02 pepe.csr.pem
</span></span></code></pre></div><h3 id=step-5-sending-certificates-to-the-web-server>Step 5: Sending certificates to the web server.</h3><p>So far your share has come, as only the certsdb / nombre.crt file, which is its signed certificate, together with the certificate of the certifying authority, which contains the public key, would be allowed to be sent to your partner, in order to be able to verify that signature on its certificate, the name of cact.pem. Finally, you will show the content of the index.txt file, which is a kind of flat text database with information on the certificates signed by the certifying authority. Within it, we find basic information corresponding to the two signed certificates: that of the certification authority itself and that of our partner, in addition to its current state of validity.</p><p>I&rsquo;m going to send and bring me from the instance of pepe the different files, he has configured my public key so that I can connect:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ scp javiercd.csr 172.22.200.113:/home/debian/ 
</span></span><span style=display:flex><span>javiercd.csr                          100% <span style=color:#ae81ff>1886</span>   839.4KB/s   00:00   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ scp 172.22.200.113:/home/debian/peperc.csr ./ 
</span></span><span style=display:flex><span>peperc.csr                            100% <span style=color:#ae81ff>1785</span>   432.6KB/s   00:00   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>-- Le envio su certificado firmado
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ scp 172.22.200.113:/CA/certsdb/pepe.csr.pem
</span></span><span style=display:flex><span>pepe.csr.pem                           100% <span style=color:#ae81ff>1785</span>   432.6KB/s   00:00
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ scp /CA/cacert.pem  172.22.200.113:/home/debian/pub_javi.pem 
</span></span><span style=display:flex><span>cacert.pem                            100% <span style=color:#ae81ff>7429</span>   582.6KB/s   00:00    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ scp 172.22.200.113:/CA/cacert.pem ./pub_pepe.pem 
</span></span><span style=display:flex><span>cacert.pem                            100% <span style=color:#ae81ff>7389</span>     1.2MB/s   00:00   
</span></span></code></pre></div><h2 id=task-2-configure-https>Task 2: Configure HTTPS</h2><h3 id=step-1-key-creation-and-certificate-application>Step 1: Key creation and certificate application.</h3><p>The first thing you have to do is create a certificate signature application (CSR or Certificate Signing Request) and get it to your partner. In this case, let&rsquo;s do it with openssl, but it could be done with other multiple software options.</p><p>To create a certificate signature application, we must first have a private key that will be associated with it, so we will generate a 4096 bit RSA private key, which will be stored in /etc/ssl/private/, running the command for it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ sudo openssl genrsa <span style=color:#ae81ff>4096</span> &gt; javiercd.key
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ sudo mv javiercd.key /etc/ssl/private/
</span></span></code></pre></div><p>Once generated, we will change the permissions of it to 400, so that only the owner can read the content, as it is a private key. This step is not mandatory but is recommended for safety. Write the command necessary for it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ sudo chmod <span style=color:#ae81ff>400</span> /etc/ssl/private/javiercd.key
</span></span></code></pre></div><p>After that, we will create a .csr file of application for a certificate signature to be signed by the certifying authority (CA) created by our partner. This file does not contain confidential information, so it will not import the route where we store it or the assigned permits. In my case, I will store it in the current directory, running the openssl req command, with the options:</p><ul><li>new: We indicate that the creation of the application for a certificate is interactive, as it will ask for certain parameters.</li><li>key: We indicate the private key to associate with this application for a certificate. In this case, the one generated in the previous step, /etc/ssl/private/tunombre.key.</li><li>out: We specify where the certificate signature application will be stored. In this case, in the current directory, with the name tunombre.csr.</li></ul><p>During the execution, you will ask us for a series of values to identify the certificate, which we will have to fill in according to the configuration we have made in the certification unit.</p><p>This information will have to be given to us by the certifying authority, except for the last two values, which in the case of the Common Name, you will put the FQDN of the web on which we want to configure HTTPS. In addition, you will need to enter your email in the Email Address section.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo openssl ca -config openssl.cnf -extensions v3_req -days <span style=color:#ae81ff>3650</span> -notext -md sha256 -in certreqs/peperc.csr -out certsdb/pepe.csr.pem
</span></span><span style=display:flex><span>Using configuration from openssl.cnf
</span></span><span style=display:flex><span>Enter pass phrase <span style=color:#66d9ef>for</span> /CA/private/cakey.pem:
</span></span><span style=display:flex><span>Check that the request matches the signature
</span></span><span style=display:flex><span>Signature ok
</span></span><span style=display:flex><span>Certificate Details:
</span></span><span style=display:flex><span>        Serial Number:
</span></span><span style=display:flex><span>            74:1e:8a:f8:24:45:14:9e:28:f1:83:04:7c:7d:6c:0f:5f:3b:ac:f3
</span></span><span style=display:flex><span>        Validity
</span></span><span style=display:flex><span>            Not Before: Jan <span style=color:#ae81ff>11</span> 10:01:58 <span style=color:#ae81ff>2024</span> GMT
</span></span><span style=display:flex><span>            Not After : Jan  <span style=color:#ae81ff>8</span> 10:01:58 <span style=color:#ae81ff>2034</span> GMT
</span></span><span style=display:flex><span>        Subject:
</span></span><span style=display:flex><span>            countryName               <span style=color:#f92672>=</span> ES
</span></span><span style=display:flex><span>            stateOrProvinceName       <span style=color:#f92672>=</span> Sevilla
</span></span><span style=display:flex><span>            organizationName          <span style=color:#f92672>=</span> IES Gonzalo Nazareno
</span></span><span style=display:flex><span>            commonName                <span style=color:#f92672>=</span> pfoter15
</span></span><span style=display:flex><span>            emailAddress              <span style=color:#f92672>=</span> pepepfoter15@gmail.com
</span></span><span style=display:flex><span>        X509v3 extensions:
</span></span><span style=display:flex><span>            X509v3 Basic Constraints: 
</span></span><span style=display:flex><span>                CA:FALSE
</span></span><span style=display:flex><span>            X509v3 Key Usage: 
</span></span><span style=display:flex><span>                Digital Signature, Non Repudiation, Key Encipherment
</span></span><span style=display:flex><span>Certificate is to be certified <span style=color:#66d9ef>until</span> Jan  <span style=color:#ae81ff>8</span> 10:01:58 <span style=color:#ae81ff>2034</span> GMT <span style=color:#f92672>(</span><span style=color:#ae81ff>3650</span> days<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Sign the certificate? <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>:y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> out of <span style=color:#ae81ff>1</span> certificate requests certified, commit? <span style=color:#f92672>[</span>y/n<span style=color:#f92672>]</span>y
</span></span><span style=display:flex><span>Write out database with <span style=color:#ae81ff>1</span> new entries
</span></span><span style=display:flex><span>Database updated
</span></span></code></pre></div><p>To verify that the signature request file has been correctly generated, list the content of the current directory. There must be a file named tunombre.csr that you must send to your partner, so that it is signed by the corresponding certifying authority that you have created.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ ls -l 
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>16</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root   root   <span style=color:#ae81ff>1886</span> Jan <span style=color:#ae81ff>11</span> 09:40 javiercd.csr
</span></span></code></pre></div><p>In my case I&rsquo;ll get it to you using SCP:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ scp javiercd.csr 172.22.200.113:/home/debian/ 
</span></span><span style=display:flex><span>javiercd.csr                          100% <span style=color:#ae81ff>1886</span>   839.4KB/s   00:00   
</span></span></code></pre></div><p>Once signed, I&rsquo;ll get it from your server.</p><h3 id=step-2-certificate-storage-on-the-server>Step 2: Certificate storage on the server</h3><p>In addition to that signed certificate, you must send us the public key of the certification authority, that is, the certificate of the certificate, so that you can verify your signature on our certificate.
Store both files in /etc/ssl/certs/ and list the contents of that directory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:~$ sudo mv javiercd.csr.pem /etc/ssl/certs/
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ sudo mv pub_pepe.pem /etc/ssl/certs
</span></span></code></pre></div><p>There must be a file of the name tunombre.crt that is the result of the signature of the application for signature of the certificate that we have previously sent you, and another of the name cact.pem, which is the certificate of the certifying authority, with which the signature of the certifying authority on that certificate of the server will then be checked.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/certs | grep javi
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> debian debian   <span style=color:#ae81ff>2175</span> Jan <span style=color:#ae81ff>11</span> 10:05 javiercd.csr.pem
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/certs | grep pepe
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> root   root     <span style=color:#ae81ff>7389</span> Jan <span style=color:#ae81ff>11</span> 11:24 pub_pepe.pem
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo ls -l /etc/ssl/private/ 
</span></span><span style=display:flex><span>total <span style=color:#ae81ff>8</span>
</span></span><span style=display:flex><span>-r-------- <span style=color:#ae81ff>1</span> debian debian   <span style=color:#ae81ff>3272</span> Jan <span style=color:#ae81ff>11</span> 09:37 javiercd.key
</span></span></code></pre></div><h3 id=step-3-apache-configuration>Step 3: Apache configuration</h3><p>As apache2 included a default VirtualHost for incoming requests by port 80 (HTTP), it contains a default one for incoming requests by port 443 (HTTPS), by name default-ssl, which by default is disabled, so we will proceed to modify it taking into account the following directives:</p><ul><li>ServerName: As in the previous VirtualHost, we will have to indicate the domain name through which we will access the server.</li><li>SSLEngine: Activates the SSL engine, necessary to make use of HTTPS, so its value should be on.</li><li>SSLCertificateFile: We indicate the route of the server certificate signed by the CA. In this case, / etc / ssl / certs / tunombre.crt.</li><li>SSLCertificateKeyFile: We indicate the route of the private key associated with the server certificate. In this case, / etc / ssl / private / tunombre.key.</li><li>SSLCACertificateFile: We indicate the route of the CA certificate with which we will check the signature of our certificate. In this case, / etc / ssl / certs / cact.pem.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo a2enmod ssl 
</span></span><span style=display:flex><span>debian@javiercrucesCA:/CA$ sudo a2ensite default-ssl.conf 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ sudo cat /etc/apache2/sites-available/default-ssl.conf 
</span></span><span style=display:flex><span>&lt;VirtualHost *:80&gt; 
</span></span><span style=display:flex><span>  ServerName javiercruces.iesgn.org
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Redirect permanent / https://javiercruces.iesgn.org/
</span></span><span style=display:flex><span>&lt;/VirtualHost&gt;
</span></span><span style=display:flex><span>&lt;VirtualHost *:443&gt;
</span></span><span style=display:flex><span>	ServerAdmin webmaster@localhost
</span></span><span style=display:flex><span>	ServerName javiercruces.iesgn.org
</span></span><span style=display:flex><span>	DocumentRoot /var/www/html
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	ErrorLog <span style=color:#e6db74>${</span>APACHE_LOG_DIR<span style=color:#e6db74>}</span>/error.log
</span></span><span style=display:flex><span>	CustomLog <span style=color:#e6db74>${</span>APACHE_LOG_DIR<span style=color:#e6db74>}</span>/access.log combined
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	SSLEngine on
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	SSLCertificateFile      /etc/ssl/certs/javiercd.csr.pem
</span></span><span style=display:flex><span>	SSLCertificateKeyFile   /etc/ssl/private/javiercd.key
</span></span><span style=display:flex><span>&lt;/VirtualHost&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>debian@javiercrucesCA:~$ sudo systemctl reload apache2.service 
</span></span></code></pre></div><p>Demonstration:</p><p><img src=/seguridad/https_autofirmado/img/Pastedimage20240111115927.png alt></p><h3 id=step-4-nginx-configuration>Step 4: Nginx configuration</h3><p>Let&rsquo;s force the https configuration on Nginx</p><p>Here&rsquo;s the virtualhost configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>debian@javiercrucesCA:/var/www/sad$ sudo cat /etc/nginx/sites-available/default 
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    listen 80;
</span></span><span style=display:flex><span>    listen <span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:80;
</span></span><span style=display:flex><span>    server_name javiercruces.iesgn.org;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Redirección a HTTPS</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>301</span> https://$host$request_uri;
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    listen <span style=color:#ae81ff>443</span> ssl;
</span></span><span style=display:flex><span>    listen <span style=color:#f92672>[</span>::<span style=color:#f92672>]</span>:443 ssl;
</span></span><span style=display:flex><span>    root /var/www/sad;
</span></span><span style=display:flex><span>    index  index.php index.html index.htm;
</span></span><span style=display:flex><span>    server_name moodle.javiercd.es;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ssl_certificate /etc/ssl/certs/javiercd.csr.pem;
</span></span><span style=display:flex><span>    ssl_certificate_key /etc/ssl/private/javiercd.key;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><img src=/seguridad/https_autofirmado/img/Pastedimage20240111191950.png alt></p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fseguridad%2fhttps_autofirmado%2fhttps_autofirmado%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fseguridad%2fhttps_autofirmado%2fhttps_autofirmado%2f&text=Create%20certification%20authority%20%28CA%29%20and%20self-signed%20certificates%20in%20Linux&via=Atlas" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fseguridad%2fhttps_autofirmado%2fhttps_autofirmado%2f&title=Create%20certification%20authority%20%28CA%29%20and%20self-signed%20certificates%20in%20Linux" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fseguridad%2fhttps_autofirmado%2fhttps_autofirmado%2f&title=Create%20certification%20authority%20%28CA%29%20and%20self-signed%20certificates%20in%20Linux" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Create%20certification%20authority%20%28CA%29%20and%20self-signed%20certificates%20in%20Linux https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fseguridad%2fhttps_autofirmado%2fhttps_autofirmado%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Create%20certification%20authority%20%28CA%29%20and%20self-signed%20certificates%20in%20Linux&body=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fseguridad%2fhttps_autofirmado%2fhttps_autofirmado%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/javierasping/sentinel/edit/main/content/posts/seguridad/https_autofirmado/https_autofirmado.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><ul><li><a href=#create-the-certifying-authority>Create the certifying authority</a></li><li><a href=#step-2-openssl-configuration-file>Step 2: Openssl configuration file</a></li><li><a href=#step-3-creation-and-signature-of-our-own-certificate>Step 3: Creation and signature of our own certificate</a></li><li><a href=#step-4-signature-of-licence-applications>Step 4: Signature of licence applications</a></li><li><a href=#step-5-sending-certificates-to-the-web-server>Step 5: Sending certificates to the web server.</a></li></ul></li><li><a href=#task-2-configure-https>Task 2: Configure HTTPS</a><ul><li><a href=#step-1-key-creation-and-certificate-application>Step 1: Key creation and certificate application.</a></li><li><a href=#step-2-certificate-storage-on-the-server>Step 2: Certificate storage on the server</a></li><li><a href=#step-3-apache-configuration>Step 3: Apache configuration</a></li><li><a href=#step-4-nginx-configuration>Step 4: Nginx configuration</a></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#about>About Me</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#accomplishments>Certifications</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contacto@javiercd.es target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contacto@javiercd.es</span></a></li><li><a href=https://github.com/javierasping target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>javierasping</span></a></li><li><a href=https://www.linkedin.com/in/javiercd target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Francisco Javier Cruces Doval</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2023 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.b6e81adc7ec7b607dcd44cb550d5ac0e8aa374ad64c95daf8eddf470660f2331.js integrity="sha256-tuga3H7Htgfc1Ey1UNWsDoqjdK1kyV2vjt30cGYPIzE=" defer></script></body></html>