<!doctype html><html lang=en><head><title>Underworld evolution</title><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.ddf4c4775d35e5bc3dd64c797b179f99eaf85cf9811e64bd08f8c44a68d0b229.css integrity="sha256-3fTEd1015bw91kx5exefmer4XPmBHmS9CPjESmjQsik="><link rel=icon type=image/png href=/images/site/avatar_hu_f10227dc088ad43a.jpg><meta property="og:title" content="Atlas"><meta property="og:type" content="website"><meta property="og:description" content="Portfolio and personal blog of Francisco Javier Cruces Doval"><meta property="og:image" content="/images/author/john.png"><meta property="og:url" content="https://www.javiercd.es"><meta name=description content="A scenario in which we will configure routing, SNAT, DNAT, and firewalls with Linux and Windows devices."><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GVDYVWJLRH"></script><script>var dnt,doNotTrack=!1;if(null&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GVDYVWJLRH")}</script><script integrity="sha256-DO4ugzEwhTW1Id1UIWn0gUJWaebCYOypeTit6LW4QB4=">let theme=localStorage.getItem("theme-scheme")||localStorage.getItem("darkmode:color-scheme")||"light";theme==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?theme="dark":theme="light"),document.documentElement.setAttribute("data-theme",theme)</script></head><body class="type-posts kind-page" data-bs-spy=scroll data-bs-target=#TableOfContents data-bs-offset=80><div class="container-fluid bg-secondary wrapper"><nav class="navbar navbar-expand-xl top-navbar shadow" id=top-navbar><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<i data-feather=sidebar></i>
</button>
<a class=navbar-brand href=/en><img src=/images/site/masthead_hu_f10227dc088ad43a.png id=logo alt=Logo>
Atlas</a>
<button class="navbar-toggler navbar-light" id=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#top-nav-items aria-label=menu>
<i data-feather=menu></i></button><div class="collapse navbar-collapse dynamic-navbar" id=top-nav-items><ul class="nav navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=/en#home>Home</a></li><li class=nav-item><a class=nav-link href=/en#about>About Me</a></li><li class=nav-item><a class=nav-link href=/en#skills>Skills</a></li><li class=nav-item><a class=nav-link href=/en#education>Education</a></li><li class=nav-item><a class=nav-link href=/en#recent-posts>Recent Posts</a></li><li class=nav-item><a class=nav-link href=/en#accomplishments>Certifications</a></li><div id=top-navbar-divider></div><li class=nav-item><a class=nav-link id=blog-link href=/en/posts>Posts</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=languageSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><span class="fi fi-gb"></span>
English</a><div class=dropdown-menu aria-labelledby=languageSelector><a class="dropdown-item nav-link languages-item" href=/posts/redes/underworld_evolution/underworld_evolution><span class="fi fi-es"></span>
Espa√±ol
</a><a class="dropdown-item nav-link languages-item" href=/en/posts/redes/underworld_evolution/underworld_evolution><span class="fi fi-gb"></span>
English</a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=theme-icon src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=theme-icon src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=theme-icon src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/masthead_hu_f10227dc088ad43a.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/en/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/en/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/ci_cd/> CI / CD Jenkins</a><ul><li><a class=list-link href=/en/posts/ci_cd/practica_jenkins/ title="CI / CD practice with Jenkins">CI / CD practice with Jenkins</a></li><li><a class=list-link href=/en/posts/ci_cd/taller1_jenkins/ title="Workshop 1 Ortho-rector of markdown documents (test)">Workshop 1 Ortho-rector of markdown documents (test)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller2_jenkins/ title="Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)">Workshop 2 Valid HTML5 check and surge.sh deployment (test and deploy)</a></li><li><a class=list-link href=/en/posts/ci_cd/taller3_jenkins/ title="Workshop 3 Continuous integration of django application (Test)">Workshop 3 Continuous integration of django application (Test)</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/base_de_datos/> Database</a><ul><li><a class=list-link href=/en/posts/base_de_datos/instalar_mariadb/ title="Install MariaDB in Debian">Install MariaDB in Debian</a></li><li><a class=list-link href=/en/posts/base_de_datos/interconexion_de_servidores/ title="Interconnection of database servers">Interconnection of database servers</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalacion_oracle_19c_debian12/ title="Oracle 19c installation under Debian 12">Oracle 19c installation under Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/instalar_postgresql/ title="PostgreSQL installation in Debian 12">PostgreSQL installation in Debian 12</a></li><li><a class=list-link href=/en/posts/base_de_datos/oracle_acceso_remoto/ title="Remote access configuration in Oracle">Remote access configuration in Oracle</a></li><li><a class=list-link href=/en/posts/base_de_datos/acceso_remoto_mariadb/ title="Remote access in MariaDB">Remote access in MariaDB</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/docker/> Docker</a><ul><li><a class=list-link href=/en/posts/docker/instalar_docker_compose/ title="Docker Compose Installation on Ubuntu 24">Docker Compose Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/instalar_docker_ubuntu24/ title="Docker Installation on Ubuntu 24">Docker Installation on Ubuntu 24</a></li><li><a class=list-link href=/en/posts/docker/taller1/ title="Workshop 1 Storage and networks in Docker">Workshop 1 Storage and networks in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller2/ title="Workshop 2 Multicontainer Scenarios in Docker">Workshop 2 Multicontainer Scenarios in Docker</a></li><li><a class=list-link href=/en/posts/docker/taller3/ title="Workshop 3 Image creation Docker">Workshop 3 Image creation Docker</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/cortafuegos/> Firewall</a><ul><li><a class=list-link href=/en/posts/cortafuegos/fortinet_cli/ title="Fortinet CLI">Fortinet CLI</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_uno/ title="Perimetral with Fortinet I">Perimetral with Fortinet I</a></li><li><a class=list-link href=/en/posts/cortafuegos/fortinet_dos/ title="Perimetral with Fortinet II">Perimetral with Fortinet II</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_uno/ title="Perimetral with Nftables I">Perimetral with Nftables I</a></li><li><a class=list-link href=/en/posts/cortafuegos/nftables_dos/ title="Perimetral with Nftables II">Perimetral with Nftables II</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/drivers/> Linux Drivers</a><ul><li><a class=list-link href=/en/posts/drivers/nvidia_driver/ title="Drivers Nvidia">Drivers Nvidia</a></li><li><a class=list-link href=/en/posts/drivers/nvidia_optimus/ title="How to choose which graph to use on my laptop with Linux">How to choose which graph to use on my laptop with Linux</a></li></ul></li><li><i data-feather=minus-circle></i><a class="active list-link" href=/en/posts/redes/> Networks</a><ul class=active><li><a class=list-link href=/en/posts/redes/android_gns3/ title="Android GNS3-KVM">Android GNS3-KVM</a></li><li><a class=list-link href=/en/posts/redes/escenario_ipv6_basico/ title="Basic IPv6 scenario">Basic IPv6 scenario</a></li><li><a class=list-link href=/en/posts/redes/instalacion_wireshark_gns3/ title="GNS3 and Wireshark installation">GNS3 and Wireshark installation</a></li><li><a class=list-link href=/en/posts/redes/instalar_gns3_debian12/ title="GNS3 installation in Debian 12">GNS3 installation in Debian 12</a></li><li><a class=list-link href=/en/posts/redes/switches_gns3/ title="GNS3 switch configuration">GNS3 switch configuration</a></li><li><a class=list-link href=/en/posts/redes/tuneles_ipv6/ title="IPV6 Tunnels">IPV6 Tunnels</a></li><li><a class=list-link href=/en/posts/redes/configuracion_de_nat/ title="NAT in Cisco and Linux">NAT in Cisco and Linux</a></li><li><a class=list-link href=/en/posts/redes/comandos_de_supervision_de_redes/ title="Network monitoring commands">Network monitoring commands</a></li><li><a class=list-link href=/en/posts/redes/enroutamiento_openstack/ title="OpenStack routing">OpenStack routing</a></li><li><a class=list-link href=/en/posts/redes/arp/ title="Protocol ARP">Protocol ARP</a></li><li><a class=list-link href=/en/posts/redes/underworld/ title=Underworld>Underworld</a></li><li><a class="active list-link" href=/en/posts/redes/underworld_evolution/ title="Underworld evolution">Underworld evolution</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/> Observability</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/metricas/> Metrics</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/observabilidad/metricas/prometheus/> Prometheus</a><ul><li><a class=list-link href=/en/posts/observabilidad/metricas/prometheus/instalacion_basica_docker_compose/ title="Installation of Prometheus with Docker Compose and Node Exporter on Debian 12">Installation of Prometheus with Docker Compose and Node Exporter on Debian 12</a></li></ul></li></ul></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/seguridad/> Security</a><ul><li><a class=list-link href=/en/posts/seguridad/forense/ title="Forensic computer">Forensic computer</a></li><li><a class=list-link href=/en/posts/seguridad/https_autofirmado/ title=HTTPS>HTTPS</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/> Services</a><ul><li><a class=list-link href=/en/posts/servicios/apache/ title=Apache>Apache</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dhcp/> DHCP</a><ul><li><a class=list-link href=/en/posts/servicios/dhcp/instalacion_y_configuracion_de_un_servidor_dhcp_en_linux/ title="Installation and Configuration of a DHCP Server on Linux">Installation and Configuration of a DHCP Server on Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/> DNS</a><ul><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/bind9/> BIND9</a><ul><li><a class=list-link href=/en/posts/servicios/dns/bind9/dns_esclavo/ title="Configuring a Slave DNS Server with BIND9">Configuring a Slave DNS Server with BIND9</a></li><li><a class=list-link href=/en/posts/servicios/dns/bind9/instalacion_basica/ title="Installation and Configuration of BIND9 on Linux">Installation and Configuration of BIND9 on Linux</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/servicios/dns/dnsmasq/> DNSMASQ</a><ul><li><a class=list-link href=/en/posts/servicios/dns/dnsmasq/instalacion_basica/ title="Local Server with DNSMasq">Local Server with DNSMasq</a></li></ul></li></ul></li><li><a class=list-link href=/en/posts/servicios/ftp/ title=FTP>FTP</a></li><li><a class=list-link href=/en/posts/servicios/nat_iptables/ title="NAT with iptables">NAT with iptables</a></li><li><a class=list-link href=/en/posts/servicios/ssh/ title=SSH>SSH</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/> Systems</a><ul><li><a class=list-link href=/en/posts/sistemas/ad_ubuntu/ title="Active Directory in Ubuntu">Active Directory in Ubuntu</a></li><li><a class=list-link href=/en/posts/sistemas/recoleccion_logs_journald/ title="Centralized collection of logs journald">Centralized collection of logs journald</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/compilaciones_linux/> Compilations in LINUX</a><ul><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_programa_en_c_utilizando_un_makefile/ title="Compilation of a C-program using a Makefile">Compilation of a C-program using a Makefile</a></li><li><a class=list-link href=/en/posts/sistemas/compilaciones_linux/compilacion_de_un_kernel/ title="Compilation of a kernel">Compilation of a kernel</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/creacion_de_un_sistema_automatizado_de_instalacion/ title="Creation of an automated installation system">Creation of an automated installation system</a></li><li><a class=list-link href=/en/posts/sistemas/samba_debian/ title="Install and configure samba in Debian">Install and configure samba in Debian</a></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/comandos_linux/> Linux Command</a><ul><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_modificacion_de_parametros_del_kernel/ title="Kernel parameter modification exercises">Kernel parameter modification exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/comandos_procesos/ title="Linux processes">Linux processes</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_de_manejo_de_modulos/ title="Module management exercises">Module management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/gestion_de_paquetes/ title="Package management">Package management</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/empaquetadores_compresores/ title="Packaging and compressors">Packaging and compressors</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/ejercicios_gestion_de_paqueteria/ title="Paid management exercises">Paid management exercises</a></li><li><a class=list-link href=/en/posts/sistemas/comandos_linux/programacion_tareas/ title="Task programming">Task programming</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/sistemas/migraciones/> Migration in Linnux</a><ul><li><a class=list-link href=/en/posts/sistemas/migraciones/migracion_sistema_de_ficheros/ title="File system">File system</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/paso_de_centos_stream_8_a_centos_stream_9/ title="Migtation from CentOS stream 8 to CentOS stream 9">Migtation from CentOS stream 8 to CentOS stream 9</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/eliminacion_systemd/ title="Systemd elimination">Systemd elimination</a></li><li><a class=list-link href=/en/posts/sistemas/migraciones/transformacion_instancia_cloud/ title="Transformation instance cloud">Transformation instance cloud</a></li></ul></li><li><a class=list-link href=/en/posts/sistemas/nfs_debian/ title="NFS in Debian">NFS in Debian</a></li><li><a class=list-link href=/en/posts/sistemas/activacion_selinux/ title="SELinux activation configuration">SELinux activation configuration</a></li><li><a class=list-link href=/en/posts/sistemas/comparticion_de_directorios_en_windows/ title="Share resources in Windows">Share resources in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/ssh_windows/ title="Ssh service in Windows">Ssh service in Windows</a></li><li><a class=list-link href=/en/posts/sistemas/almacenamiento_servidor_independiente/ title="Storage Spaces in Windows Server">Storage Spaces in Windows Server</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/vpn/> VPN</a><ul><li><a class=list-link href=/en/posts/vpn/comparativa_ovpn_wire/ title="OpenVPN and Wireguard Comparative">OpenVPN and Wireguard Comparative</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_openvpn/ title="OpenVPN remote access">OpenVPN remote access</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_strongswang/ title="Remote access Ipsec StrongSwan">Remote access Ipsec StrongSwan</a></li><li><a class=list-link href=/en/posts/vpn/ipsec_cisco/ title="Site-to-Site IPsec Cisco">Site-to-Site IPsec Cisco</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_fortinet/ title="Site-to-Site IPsec Fortinet">Site-to-Site IPsec Fortinet</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_openvpn/ title="Site-to-Site OpenVPN">Site-to-Site OpenVPN</a></li><li><a class=list-link href=/en/posts/vpn/site_to_site_wireguard/ title="Site-to-Site Wireguard">Site-to-Site Wireguard</a></li><li><a class=list-link href=/en/posts/vpn/acceso_remoto_wireguard/ title="Wireguard remote access">Wireguard remote access</a></li></ul></li><li><i data-feather=plus-circle></i><a class=list-link href=/en/posts/iaw/> Web applications</a><ul><li><a class=list-link href=/en/posts/iaw/lamp/ title="LAMP stack installation">LAMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/lemp/ title="LEMP stack installation">LEMP stack installation</a></li><li><a class=list-link href=/en/posts/iaw/wordpress/ title="WordPress LAMP">WordPress LAMP</a></li><li><a class=list-link href=/en/posts/iaw/wordpress_lemp/ title="WordPress LEMP">WordPress LEMP</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/redes/underworld_evolution/portada.jpeg)></div><div class=page-content><div class="author-profile ms-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu_2aff0fda0501496d.png alt="Author Image"><h5 class=author-name>Francisco Javier Cruces Doval</h5><p class=text-muted>Friday, September 8, 2023 | 16 minutes</p></div><div class=title><h1>Underworld evolution</h1></div><div class=tags><ul style=padding-left:0><li class=rounded><a href=/en/tags/networking/ class="btn btn-sm btn-info">Networking</a></li><li class=rounded><a href=/en/tags/snat/ class="btn btn-sm btn-info">SNAT</a></li><li class=rounded><a href=/en/tags/dnat/ class="btn btn-sm btn-info">DNAT</a></li><li class=rounded><a href=/en/tags/cisco/ class="btn btn-sm btn-info">Cisco</a></li><li class=rounded><a href=/en/tags/linux/ class="btn btn-sm btn-info">Linux</a></li></ul></div><div class=post-content id=post-content><p>The world of UNDERWORLD has evolved greatly in recent months, so you must perform network management tasks to face the new situation.</p><p>On one hand, the Internet has been discovered in the Underworld, allowing each of the sub-worlds (remember: vampires, werewolves, lycanthropes, and humans) to connect to a router that, in turn, connects them to one of the two large routers that form Underworld&rsquo;s Internet, called Marcus (for humans and vampires) and Alexander (for werewolves and lycanthropes). Marcus and Alexander are connected to each other.</p><p>The scheme would be as follows:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.001.jpeg alt></p><p>On the other hand, the beings of the underworld have discovered a vulnerability in CISCO routers that allows them to bypass the access control lists, returning to the chaos you previously prevented with the ACLs.</p><p>Your tasks will consist of:</p><ol><li>Replacing the CISCO routers in the network infrastructure with Linux machines following the scheme shown.</li><li>Properly configure the Linux machines to function as routers.</li><li>Create the necessary routing tables for all machines to communicate with each other, considering that internal networks will have private addresses and we will have public addresses on the Internet.</li><li>Configure the necessary firewalls on the routers so that:<ul><li>VAMPIRES cannot communicate with the other species.</li><li>WEREWOLVES and LYCANTHROPES, since they are not so repulsive when they meet, can communicate with each other. They will not have communication with the other species.</li><li>HUMANS will also not be able to communicate with the other species.</li></ul></li><li>Configure the DHCP service that the werewolves and lycanthropes had under the same conditions they had when using CISCO routers.</li><li>Configure the firewalls with the necessary rules so that, from HUMANLAND, IT KNIGHT can continue communicating with his two favorite vampires (SONJA and SELENE).</li><li>Perform the necessary configurations to set up a web server in HUMANLAND accessible from anywhere in UNDERWORLD.</li></ol><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.002.jpeg alt></p><h2 id=preparation-of-the-scenario-in-linux>Preparation of the scenario in Linux</h2><h3 id=configuration-of-the-network-interfaces>Configuration of the network interfaces</h3><p>The first thing we will do is add the necessary network interfaces to each router. To do this, with the machine turned off, we right-click > settings > network and add the slots that are needed for each machine:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.003.png alt></p><p>We will need the following number of network interfaces for each device:</p><ul><li>Router 1, 2, 3, and 4: will need 2 network interfaces</li><li>MARCUS and ALEXANDER: will need 3 network interfaces</li><li>PCs: will need 1 network interface</li></ul><p>Once this is done, we will edit the file /etc/network/interfaces to perform our network configuration.</p><p>Subsequently, we will restart the networking service with systemctl restart networking.service so that the network configuration we indicated is applied.</p><p>Configuration of the network interface Router 1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.004.png alt></p><p>Configuration of the network interface Router 2:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.005.png alt></p><p>Configuration of the network interface Router 3:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.006.png alt></p><p>Configuration of the network interface Router 4:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.007.png alt></p><p>Configuration of the network interface Router MARCUS:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.008.png alt></p><p>Configuration of the network interface Router ALEXANDER:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.009.png alt></p><h4 id=enabling-the-forwarding-bit>Enabling the forwarding bit</h4><p>If we want to make a Linux machine act as a router, which means it routes packets that are not destined for it, we must enable the forwarding bit.</p><p>Additionally, we will take this opportunity to permanently enable the forwarding bit on the routers of the scenario by editing the file /etc/sysctl.conf and uncommenting this line:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.010.png alt></p><p>We will repeat this for the six routers we have in the scenario:</p><p><strong>Router 1:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.011.png alt></p><p><strong>Router 2:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.012.png alt></p><p><strong>Router 3:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.013.png alt></p><p><strong>Router 4:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.014.png alt></p><p><strong>Router MARCUS:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.015.png alt></p><p><strong>Router ALEXANDER:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.016.png alt></p><p>Now all our machines are configured to act as routers and will route any packets that are sent to them that are not for them.</p><h4 id=route-configuration>Route configuration</h4><p>Here I will show if I have added any routes manually and the routing tables of the devices.</p><p><strong>Router MARCUS:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.017.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.018.png alt></p><p><strong>Router ALEXANDER:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.019.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.020.png alt></p><p><strong>Router 1:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.021.png alt></p><p><strong>Router 2:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.022.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.023.png alt></p><p><strong>Router 4:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.024.png alt></p><p>With the network configuration I have on the interfaces, I have only added 2 manual routes on the routers of MARCUS and ALEXANDER; in the rest it was not necessary since it is generated automatically with the gateway we placed when configuring the network interfaces.</p><p>I could have saved writing them if I had placed the IP of the other as the gateway on the interface configured in the network 100.X.X.X.</p><h4 id=connectivity-test>Connectivity test</h4><p>We are going to check if we have routed correctly, so I will ping from each router to each one of the edges of the scenario.</p><p><strong>Router 1:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.025.png alt></p><p><strong>Router 2:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.026.png alt></p><p><strong>Router 3:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.027.png alt></p><p><strong>Router 4:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.028.png alt></p><p>It is confirmed that we have connectivity between all routers; the PCs will not have ‚Äúconnectivity‚Äù until we configure the SNAT.</p><h3 id=dhcp-configuration>DHCP Configuration</h3><h4 id=lycanthropes>Lycanthropes</h4><p>The lycanthropes, on their part, hire you to assign their IPs via DHCP as well, but they indicate that they cannot receive the first 10 addresses of their range (not counting the network one or the gateway), as these are reserved for the leaders of their clan who are traveling and will return in a few days.</p><p>With the machine connected to the NAT cloud and the interface that is connected configured via DHCP, we will download the DHCP server; to do this, we must first run an apt update because the machine does not have the repositories loaded in memory:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.029.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.030.png alt></p><p>When it finishes installing, it will give us an error; this is because the service is not configured and does not know which interface the server should assign addresses to:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.031.jpeg alt=ref1></p><p>To do this, we will edit the file /etc/default/isc-dhcp-server and add the name of the interface in the IPV4 section:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.032.png alt></p><p>Now we will configure the scope with the requirements requested by the lycanthropes by editing the file /etc/dhcp/dhcpd.conf:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.033.png alt></p><p>We must keep in mind that the configuration we put here is consistent with the network configuration we have; we need to consider that we have a /28, so in this case, we can only have 14 assignable addresses.</p><p>But if we follow the statement, they do not want the first 10, so we can only assign 3 to our clients.</p><p>Once this is done, we will restart the service:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.034.png alt></p><p>And we will see if it is working, checking the status:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.035.jpeg alt></p><p>We will assign an IP to a PC to check that it works:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.036.png alt></p><h4 id=werewolves>Werewolves</h4><p>The werewolves, who are quite clumsy at entering IP addresses into their machines, ask you to configure the DHCP service for all their machines to receive an IP automatically.</p><p>With the machine connected to the NAT cloud and the interface that is connected configured via DHCP, we will download the DHCP server; to do this, we must first run an apt update because the machine does not have the repositories loaded in memory:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.037.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.038.png alt></p><p>When it finishes installing, it will give us an error; this is because the service is not configured and does not know which interface the server should assign addresses to:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.031.jpeg alt=ref1></p><p>To do this, we will edit the file /etc/default/isc-dhcp-server and add the name of the interface in the IPV4 section:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.039.png alt></p><p>Fortunately, the werewolves are less demanding, and they want the entire range of addresses distributed, so for this, we will edit the file /etc/dhcp/dhcpd.conf:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.040.png alt></p><p>Now we will restart the service:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.041.png alt></p><p>We will check the status to ensure that it is working correctly:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.042.jpeg alt></p><p>We will assign an address to a client to make sure everything works correctly:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.043.png alt></p><h3 id=snat-configuration>SNAT Configuration</h3><p>To complete the preparation phase, we will need to configure SNAT so that the different races can communicate with each other.</p><p><strong>Router 1:</strong></p><p>I created a file called iptables to save all the rules from the practice:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.044.png alt></p><p>To demonstrate that the rule works, here is a capture between Router 1 and PC1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.045.png alt></p><p>We see that once outside the network between R1 and MARCUS, SNAT has been applied:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.046.png alt></p><p><strong>Router 2:</strong></p><p>I created a file called iptables to save all the rules from the practice:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.047.png alt></p><p>To demonstrate that the rule works, here is a capture between Router 2 and PC3. We see that the source is a private IP address:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.048.png alt></p><p>We see that once outside the network between R2 and MARCUS, SNAT has been applied, since the source is now a public IP address:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.049.png alt></p><p><strong>Router 3:</strong></p><p>I created a file called iptables to save all the rules from the practice:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.050.png alt></p><p>To demonstrate that the rule works, here is a capture between Router 3 and PC5. We see that the source is a private IP address:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.051.png alt></p><p>We see that once outside the network between R3 and ALEXANDER, SNAT has been applied, since the source is now a public IP address:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.052.png alt></p><p><strong>Router 4:</strong></p><p>I created a file called iptables to save all the rules from the practice:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.053.png alt></p><p>To demonstrate that the rule works, here is a capture between Router 4 and PC7. We see that the source is a private IP address:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.054.png alt></p><p>We see that once outside the network between R4 and ALEXANDER, SNAT has been applied since the source is now a public IP address:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.055.png alt></p><p>With the current scenario, any PC is capable of reaching all public addresses in our network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.056.png alt></p><h3 id=dnat-configuration>DNAT Configuration</h3><p>For the machines to be able to communicate with each other, ssh has been installed on them, so we will need to configure DNAT.</p><p><strong>R1</strong></p><p>For this network, since we have two clients, I changed the port that ssh uses:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.057.png alt></p><p>We check that I can connect to both hosts from another network, thus confirming that DNAT works.</p><p>Sonja:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.058.png alt></p><p>Selene:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.059.png alt></p><p><strong>R2</strong></p><p>In this network, we only have one client that we want to be accessible from the outside, so we will only have one DNAT rule:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.060.png alt></p><p>To check the rule, I will connect from the vampires to the humans:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.061.png alt></p><p><strong>R3</strong></p><p>In this network, since there is a DHCP service running, for the DNAT rule to function correctly, we must reserve our host or configure the interface statically.</p><p>I will do the former for convenience, for this we go to the file /etc/dhcp/dhcpd.conf and write the following:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-BASH data-lang=BASH><span style=display:flex><span>host ReservationName <span style=color:#f92672>{</span> hardware ethernet HOST_MAC_ADDR; fixed-address RESERVED_IP;<span style=color:#f92672>}</span>
</span></span></code></pre></div><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.062.png alt></p><p>Once this is done, we restart the service:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.063.png alt></p><p>And I will set the following rule:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.064.png alt></p><p>Now let&rsquo;s check that I can connect to this host:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.065.jpeg alt></p><p><strong>R4</strong></p><p>In this network, we will also configure a reservation on the server to keep our rules active; in this case, I will assign the address 192.168.4.5.</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.066.png alt></p><p>We will restart the service and check that our host has been assigned the reserved IP; if not, we will request another with dhclient:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.067.png alt></p><p>Now we will add the DNAT rule so that the ssh server can be reached:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.068.png alt></p><p>We check that the rule is functioning, and we can connect from another network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.069.jpeg alt></p><h3 id=firewall-configuration>Firewall Configuration</h3><h4 id=vampires-cannot-communicate-with-the-other-species>Vampires cannot communicate with the other species</h4><p>I will set a default DROP policy in the FORWARD table to block all traffic coming from the vampire network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.070.png alt></p><p>We will verify that the vampires are unable to reach the other networks:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.071.png alt></p><p>We can see the hits it has made to confirm that the rule is working:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.072.png alt></p><h4 id=allow-communication-between-werewolves-and-lycanthropes>Allow communication between Werewolves and Lycanthropes</h4><p>WEREWOLVES and LYCANTHROPES, since they are not so repulsive when they cross paths, will be able to communicate with each other. They will not have communication with the other species.</p><p>I will set a default DROP policy in the FORWARD table, then allow traffic that comes in through interface ens4 and goes out through ens5, and vice versa to permit traffic between these two networks:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.073.png alt></p><p>We see that they can communicate with each other; however, they cannot access Humans or Vampires:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.074.jpeg alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.075.jpeg alt></p><p>We will check that the rules have hits:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.076.png alt></p><h4 id=humans-will-also-not-be-able-to-communicate-with-the-other-species>HUMANS will also not be able to communicate with the other species</h4><p>With the rules we currently have, communication between Humans and other species is not possible; we can see that in R2 without any additional rules, we cannot connect:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.077.png alt></p><p>We see that we cannot communicate:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.078.png alt></p><p>If we want to prohibit human traffic on our router and not rely on external rules in case they change, we will add a default DROP policy:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.079.png alt></p><p>We will see the hits in the default policy:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.080.png alt></p><h4 id=configure-the-necessary-rules-in-the-firewalls-so-that-from-humanland-it-knight-can-continue-communicating-with-his-two-favorite-vampires-sonja-and-selene>Configure the necessary rules in the firewalls so that, from HUMANLAND, IT KNIGHT can continue communicating with his two favorite vampires (SONJA and SELENE).</h4><p>The IPs of these machines are:</p><ul><li>IT KNIGHT (SSH) ‚Äì> 192.168.2.3:22</li><li>SONJA (SSH) ‚Äì> 192.168.1.4:22</li><li>SELENE (SSH) ‚Äì> 192.168.1.5:2222</li></ul><p>In router 1, the necessary rules to allow this communication are:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.081.jpeg alt></p><p>In router 2, the necessary rules to allow this communication are:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.082.jpeg alt></p><p>We will check action by action to ensure that these rules fulfill their purpose.</p><p><strong>SELENE ‚Äì> ITKNIGHT</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.083.png alt></p><p>In router 1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.084.jpeg alt></p><p>In router 2:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.085.jpeg alt></p><p><strong>SONJA ‚Äì> ITKNIGHT</strong></p><p>We ssh:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.086.png alt></p><p>We see the hits from router 1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.087.jpeg alt></p><p>We see the hits from router 2 (same rule as the previous section):</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.088.jpeg alt></p><p><strong>ITKNIGHT ‚Äì> SONJA</strong></p><p>We ssh:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.089.png alt></p><p>We see the hits from router 1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.090.jpeg alt></p><p>We see the hits from router 2:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.091.jpeg alt></p><p><strong>ITKNIGHT ‚Äì> SELENE</strong></p><p>We launch the ssh:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.092.png alt></p><p>We see the hits from router 1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.093.jpeg alt></p><p>We see the hits from router 2:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.094.jpeg alt></p><h3 id=humanland-web-server>HUMANLAND Web Server</h3><p>Perform the necessary configurations to set up a web server in HUMANLAND accessible from anywhere in UNDERWORLD.</p><p>I have assigned it the IP 192.168.2.10.</p><p>The first thing we must configure is the DNAT on router R2 (HUMANLAND):</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.095.png alt></p><p>Now in router 2, we will allow requests to the server and their responses:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.096.png alt></p><p>In router 1, we allow requests and their responses:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.097.png alt></p><p>Finally, in ALEXANDER, we allow web requests to pass through:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.098.png alt></p><p>Let&rsquo;s check that it can be accessed from all networks.</p><p><strong>VAMPIRES:</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.099.png alt></p><p>We check the hits in router 1:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.100.png alt></p><p><strong>WEREWOLVES AND LYCANTHROPES</strong></p><p>We make the web request from both networks:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.101.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.102.png alt></p><p>We check the hits in router ALEXANDER:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.103.jpeg alt></p><p>Finally, we see the hits in Router 2 (HUMANS) for the DNAT rule:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.104.png alt></p><h2 id=scenario-with-cisco-routers>Scenario with Cisco routers</h2><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.105.jpeg alt></p><h3 id=configuration-of-the-interfaces>Configuration of the interfaces</h3><p><strong>R1</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.106.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.107.png alt></p><p><strong>R2</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.108.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.109.png alt></p><p><strong>R3</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.110.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.111.png alt></p><p><strong>R4</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.112.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.113.png alt></p><p><strong>MARCUS</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.114.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.115.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.116.png alt></p><p><strong>ALEXANDER</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.117.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.118.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.119.png alt></p><h4 id=routing-tables>Routing Tables</h4><p><strong>R1</strong></p><p>We add the default route:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.120.png alt></p><p>Thus, R1&rsquo;s routing table will look like:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.121.png alt></p><p><strong>R2</strong></p><p>We add the default route:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.122.png alt></p><p>Thus, R2&rsquo;s routing table will look like:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.123.png alt></p><p><strong>R3</strong></p><p>We add the default route:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.124.png alt></p><p>Thus, R3&rsquo;s routing table will look like:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.125.png alt></p><p><strong>R4</strong></p><p>We add the default route:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.126.png alt></p><p>Thus, R4&rsquo;s routing table will look like:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.127.png alt></p><p><strong>MARCUS</strong></p><p>We add the default route:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.128.png alt></p><p>Thus, MARCUS&rsquo;s routing table will look like:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.129.png alt></p><p><strong>ALEXANDER</strong></p><p>We add the default route:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.130.png alt></p><p>Thus, ALEXANDER&rsquo;s routing table will look like:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.131.png alt></p><h4 id=connectivity-test-1>Connectivity Test</h4><p>We will check that we have routed correctly, so I will ping from each router to each of the edges of the scenario.</p><p>R1 ‚Üí to the edges:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.132.png alt></p><p>R2 ‚Üí to the edges:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.133.png alt></p><p>R3 ‚Üí to the edges:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.134.jpeg alt></p><p>R4 ‚Üí to the edges:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.135.png alt></p><h3 id=dhcp-configuration-lycanthropes>DHCP Configuration Lycanthropes</h3><p>The lycanthropes, on their part, hire you to assign their IPs via DHCP as well, but they indicate that they cannot receive the first 10 addresses of their range (not counting the network one or the gateway), as these are reserved for the leaders of their clan who are traveling and will return in a few days.</p><p>The first thing we will do is establish the range of excluded IPs from the set (pool) of addresses that the service will assign by indicating the initial and final IP of the range, both included:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.136.png alt></p><p>We name the DHCP service range:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.137.png alt></p><p>We define the network to which it will provide DHCP service:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.138.png alt></p><p>We include the gateway that will offer the service:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.139.png alt></p><p>With this, we would have set up the DHCP server. With the following command, we can view the service statistics to see if it is running:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.140.png alt></p><p>We will also confirm that the lease has been granted to our host:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.141.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.142.jpeg alt></p><h3 id=dhcp-werewolves>DHCP Werewolves</h3><p>The werewolves, who are quite clumsy at entering IP addresses into their machines, ask you to configure the DHCP service for all their machines to receive an available IP automatically.</p><p>In the previous section, I detailed each part of the configuration of a DHCP server in Cisco; here I show you the configuration for the Werewolf network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.143.png alt></p><p>We will check that it is working:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.144.png alt></p><h3 id=snat-configuration-1>SNAT Configuration</h3><p><strong>Router 1:</strong></p><p>The first step is to create an ACL to allow the traffic we want to perform SNAT on:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.145.png alt></p><p>We will assign this rule to the internal interface of our network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.146.png alt></p><p>Now we will create a pool with the public IPs; the command would be this, but it does not show completely in the terminal:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.147.png alt></p><p>We enable NAT:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.148.png alt></p><p>We indicate which interface is for ‚Äúinside‚Äù:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.149.png alt></p><p>We specify the ‚Äúoutside‚Äù interface:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.150.png alt></p><p>The SNAT should be working, so let&rsquo;s verify it:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.151.png alt></p><p>We see that the rule has HITS:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.152.png alt></p><p><strong>Router 2:</strong></p><p>The first step is to create an ACL to allow the traffic we want to perform SNAT on:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.153.png alt></p><p>We will assign this rule to the internal interface of our network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.154.png alt></p><p>Now we will create a pool with the public IPs; the command would be this, but it does not show completely in the terminal:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.155.png alt></p><p>We enable NAT:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.156.png alt></p><p>We indicate which interface is for ‚Äúinside‚Äù:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.157.png alt></p><p>We specify the ‚Äúoutside‚Äù interface:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.158.png alt></p><p>The SNAT should be working, so let&rsquo;s verify it by checking if the rule has HITS:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.159.png alt></p><p><strong>Router 3:</strong></p><p>The first step is to create an ACL to allow the traffic we want to perform SNAT on:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.160.png alt></p><p>We will assign this rule to the internal interface of our network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.161.png alt></p><p>Now we will create a pool with the public IPs; the command would be this, but it does not show completely in the terminal:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.162.png alt></p><p>We enable NAT:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.163.png alt></p><p>We indicate which interface is for ‚Äúinside‚Äù:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.164.png alt></p><p>We specify the ‚Äúoutside‚Äù interface:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.165.png alt></p><p>The SNAT should be working, so let&rsquo;s verify it by checking if the rule has HITS:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.166.png alt></p><p><strong>Router 4:</strong></p><p>The first step is to create an ACL to allow the traffic we want to perform SNAT on:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.167.png alt></p><p>We will assign this rule to the internal interface of our network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.168.png alt></p><p>Now we will create a pool with the public IPs; the command would be this, but it does not show completely in the terminal:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.169.png alt></p><p>We enable NAT:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.170.png alt></p><p>We indicate which interface is for ‚Äúinside‚Äù:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.171.png alt></p><p>We specify the &ldquo;outside&rdquo; interface:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.172.png alt></p><p>The SNAT should be working, so let&rsquo;s verify it by checking if the rule has HITS:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.173.png alt></p><h3 id=dnat-configuration-1>DNAT Configuration</h3><p><strong>R1</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.174.png alt></p><p>Checking:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.175.png alt></p><p><strong>R2</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.176.png alt></p><p>Checking:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.177.png alt></p><p><strong>R3</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.178.png alt></p><p>Checking:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.179.png alt></p><p><strong>R4</strong></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.180.png alt></p><p>Checking:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.181.png alt></p><h3 id=firewall-configuration-1>Firewall Configuration</h3><h4 id=vampires-cannot-communicate-with-the-other-species-1>Vampires cannot communicate with the other species</h4><p>For this, we will delete the existing rule in the list:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.182.png alt></p><p>Now we will deny outgoing traffic from the vampire network:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.183.png alt></p><p>We confirm they cannot communicate:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.184.png alt></p><p>We look at the hits from the rules:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.185.png alt></p><h4 id=allow-communication-between-werewolves-and-lycanthropes-1>Allow communication between Werewolves and Lycanthropes</h4><p>WEREWOLVES and LYCANTHROPES, since they are not so repulsive when they cross paths, will be able to communicate with each other. They will not have communication with the other species.</p><p>With these two rules, we allow any host from our local networks to exit when the destination is werewolves or lycanthropes:</p><ul><li>R3 ‚Üí 180.0.0.1</li><li>R4 ‚Üí 190.0.0.1</li></ul><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.186.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.187.png alt></p><p>We see that it blocks the packets that are not from HL to LC or from LC to HL:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.188.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.189.png alt></p><h4 id=humans-will-also-not-be-able-to-communicate-with-the-other-species-1>HUMANS will also not be able to communicate with the other species</h4><p>With the rules we currently have, communication with other species by humans is not possible; we can see that in R2 without any additional rules, we cannot connect since our packets will reach the networks.</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.190.png alt></p><p>To truly prevent humans from communicating without depending on the rules of the other kingdoms, we will prevent them from exiting the kingdom:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.191.png alt></p><p>If we check now, they will not be able to exit the kingdom:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.192.png alt></p><p>We look at the hits:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.193.png alt></p><h4 id=configure-the-necessary-rules-in-the-firewalls-so-that-from-humanland-it-knight-can-continue-communicating-with-his-two-favorite-vampires-sonja-and-selene-1>Configure the necessary rules in the firewalls so that, from HUMANLAND, IT KNIGHT can continue communicating with his two favorite vampires (SONJA and SELENE).</h4><p>The IPs of these machines are:</p><ul><li>IT KNIGHT (SSH) ‚Äì> 192.168.2.3:22</li><li>SONJA (SSH) ‚Äì> 192.168.1.4:22</li><li>SELENE (SSH) ‚Äì> 192.168.1.5:2222</li></ul><p>To allow the vampires to communicate with humans:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.194.png alt></p><p>We allow outgoing messages to the public of the vampires when the port is 22 and 2222:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.195.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.196.png alt></p><p>Now we will allow the vampires to connect to the humans using port 22:</p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.197.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.198.png alt></p><p><img src=/redes/underworld_evolution/img/Aspose.Words.04ad4cb2-a1f8-43f3-8027-b24afbf6f8f8.199.jpeg alt></p><p>I don‚Äôt know why it‚Äôs not working&mldr; it only goes through if I don‚Äôt place any rules; even allowing ALL SSH traffic doesn‚Äôt help&mldr; I have also allowed all ICMP, but it still occurs.</p><p>The nat and SNAT are working fine, but when it comes to making the ssh rules, the following happens in the local network. Since the router drops them back despite the traffic being allowed.</p></div><div class="row ps-3 pe-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn icon-button bg-facebook" href="https://www.facebook.com/sharer.php?u=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fredes%2funderworld_evolution%2funderworld_evolution%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn icon-button bg-twitter" href="https://twitter.com/share?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fredes%2funderworld_evolution%2funderworld_evolution%2f&text=Underworld%20evolution&via=Atlas" target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn icon-button bg-reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fredes%2funderworld_evolution%2funderworld_evolution%2f&title=Underworld%20evolution" target=_blank><i class="fab fa-reddit"></i>
</a><a class="btn icon-button bg-linkedin" href="https://www.linkedin.com/shareArticle?url=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fredes%2funderworld_evolution%2funderworld_evolution%2f&title=Underworld%20evolution" target=_blank><i class="fab fa-linkedin"></i>
</a><a class="btn icon-button bg-whatsapp" href="https://api.whatsapp.com/send?text=Underworld%20evolution https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fredes%2funderworld_evolution%2funderworld_evolution%2f" target=_blank><i class="fab fa-whatsapp"></i>
</a><a class="btn icon-button" href="mailto:?subject=Underworld%20evolution&body=https%3a%2f%2fwww.javiercd.es%2fen%2fposts%2fredes%2funderworld_evolution%2funderworld_evolution%2f" target=_blank><i class="fas fa-envelope-open-text"></i></a></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/javierasping/sentinel/edit/main/content/posts/redes/underworld_evolution/underworld_evolution.en.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>
Improve this page</a></div></div><hr><div class="row next-prev-navigator"></div><hr></div></div></div><a id=scroll-to-top class=btn type=button data-bs-toggle=tooltip data-bs-placement=left title="Scroll to top"><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center ps-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#preparation-of-the-scenario-in-linux>Preparation of the scenario in Linux</a><ul><li><a href=#configuration-of-the-network-interfaces>Configuration of the network interfaces</a><ul><li><a href=#enabling-the-forwarding-bit>Enabling the forwarding bit</a></li><li><a href=#route-configuration>Route configuration</a></li><li><a href=#connectivity-test>Connectivity test</a></li></ul></li><li><a href=#dhcp-configuration>DHCP Configuration</a><ul><li><a href=#lycanthropes>Lycanthropes</a></li><li><a href=#werewolves>Werewolves</a></li></ul></li><li><a href=#snat-configuration>SNAT Configuration</a></li><li><a href=#dnat-configuration>DNAT Configuration</a></li><li><a href=#firewall-configuration>Firewall Configuration</a><ul><li><a href=#vampires-cannot-communicate-with-the-other-species>Vampires cannot communicate with the other species</a></li><li><a href=#allow-communication-between-werewolves-and-lycanthropes>Allow communication between Werewolves and Lycanthropes</a></li><li><a href=#humans-will-also-not-be-able-to-communicate-with-the-other-species>HUMANS will also not be able to communicate with the other species</a></li><li><a href=#configure-the-necessary-rules-in-the-firewalls-so-that-from-humanland-it-knight-can-continue-communicating-with-his-two-favorite-vampires-sonja-and-selene>Configure the necessary rules in the firewalls so that, from HUMANLAND, IT KNIGHT can continue communicating with his two favorite vampires (SONJA and SELENE).</a></li></ul></li><li><a href=#humanland-web-server>HUMANLAND Web Server</a></li></ul></li><li><a href=#scenario-with-cisco-routers>Scenario with Cisco routers</a><ul><li><a href=#configuration-of-the-interfaces>Configuration of the interfaces</a><ul><li><a href=#routing-tables>Routing Tables</a></li><li><a href=#connectivity-test-1>Connectivity Test</a></li></ul></li><li><a href=#dhcp-configuration-lycanthropes>DHCP Configuration Lycanthropes</a></li><li><a href=#dhcp-werewolves>DHCP Werewolves</a></li><li><a href=#snat-configuration-1>SNAT Configuration</a></li><li><a href=#dnat-configuration-1>DNAT Configuration</a></li><li><a href=#firewall-configuration-1>Firewall Configuration</a><ul><li><a href=#vampires-cannot-communicate-with-the-other-species-1>Vampires cannot communicate with the other species</a></li><li><a href=#allow-communication-between-werewolves-and-lycanthropes-1>Allow communication between Werewolves and Lycanthropes</a></li><li><a href=#humans-will-also-not-be-able-to-communicate-with-the-other-species-1>HUMANS will also not be able to communicate with the other species</a></li><li><a href=#configure-the-necessary-rules-in-the-firewalls-so-that-from-humanland-it-knight-can-continue-communicating-with-his-two-favorite-vampires-sonja-and-selene-1>Configure the necessary rules in the firewalls so that, from HUMANLAND, IT KNIGHT can continue communicating with his two favorite vampires (SONJA and SELENE).</a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-start"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#about>About Me</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#education>Education</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#recent-posts>Recent Posts</a></li><li class=nav-item><a class=smooth-scroll href=https://www.javiercd.es/en/#accomplishments>Certifications</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:contacto@javiercd.es target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>contacto@javiercd.es</span></a></li><li><a href=https://github.com/javierasping target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>javierasping</span></a></li><li><a href=https://www.linkedin.com/in/javiercd target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>Francisco Javier Cruces Doval</span></a></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>Liability Notice:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-start"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu_b3360284c55cf72d.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">¬© 2023 Copyright.</div><div class="col-md-4 text-end"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.29119cfdb8d2f06f4caaea7b9908096b5c109c5174eab5fca7e4e0efb0ffcaa0.js integrity="sha256-KRGc/bjS8G9Mqup7mQgJa1wQnFF06rX8p+Tg77D/yqA=" defer></script></body></html>